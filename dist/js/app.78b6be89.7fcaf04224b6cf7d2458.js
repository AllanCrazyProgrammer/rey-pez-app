(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["app.78b6be89"],{"28ce":function(a,t,o){"use strict";var s=function(){var a=this,t=a._self._c;return t("div",{staticClass:"joselito-cuentas-menu-container"},[t("h1",[a._v("Menú de Cuentas Joselito")]),t("div",{staticClass:"actions-container"},[t("router-link",{staticClass:"action-button back-btn",attrs:{to:"/cuentas-mexico"}},[a._v(" Cuentas México ")]),t("router-link",{staticClass:"action-button new-cuenta-btn",attrs:{to:"/cuentas-joselito/nueva"}},[a._v(" Nueva Cuenta ")]),t("router-link",{staticClass:"action-button ventas-ganancias-btn",attrs:{to:"/ventas-ganancias-joselito"}},[a._v(" Ventas y Ganancias ")]),t("button",{staticClass:"action-button abonos-btn",on:{click:function(t){a.showAbonosModal=!0}}},[a._v(" Abonos ")]),t("PreciosHistorialModal",{attrs:{clienteActual:"joselito"}}),t("StashModalV2",{attrs:{cliente:"joselito"}})],1),a.showAbonosModal?t("div",{staticClass:"modal"},[t("div",{staticClass:"modal-content"},[t("div",{staticClass:"modal-header"},[t("h2",[a._v("Historial de Abonos")]),t("button",{staticClass:"close-modal-btn",on:{click:function(t){a.showAbonosModal=!1}}},[a._v("×")])]),t("div",{staticClass:"fecha-filtros"},[t("div",{staticClass:"fecha-grupo"},[t("label",[a._v("Desde:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.fechaInicio,expression:"fechaInicio"}],staticClass:"fecha-input",attrs:{type:"date"},domProps:{value:a.fechaInicio},on:{change:a.calcularTotalAbonos,input:function(t){t.target.composing||(a.fechaInicio=t.target.value)}}})]),t("div",{staticClass:"fecha-grupo"},[t("label",[a._v("Hasta:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.fechaFin,expression:"fechaFin"}],staticClass:"fecha-input",attrs:{type:"date"},domProps:{value:a.fechaFin},on:{change:a.calcularTotalAbonos,input:function(t){t.target.composing||(a.fechaFin=t.target.value)}}})])]),null!==a.totalAbonosPeriodo?t("div",{staticClass:"total-abonos"},[t("span",{staticClass:"total-label"},[a._v("Total de abonos en el periodo:")]),t("span",{staticClass:"total-monto"},[a._v("$"+a._s(a.formatNumber(a.totalAbonosPeriodo)))])]):a._e(),t("div",{staticClass:"abonos-list"},[0===a.abonosHistorial.length?t("div",{staticClass:"no-records"},[a._v(" No hay abonos registrados. ")]):t("div",a._l(a.abonosHistorial,(function(o,s){return t("div",{key:s,staticClass:"abono-item"},[t("div",{staticClass:"abono-fecha"},[a._v(a._s(a.formatDate(o.fecha)))]),t("div",{staticClass:"abono-details"},[t("span",{staticClass:"abono-monto"},[a._v("$"+a._s(a.formatNumber(o.monto)))]),t("span",{staticClass:"abono-descripcion"},[a._v(a._s(o.descripcion))])])])})),0)]),t("button",{staticClass:"close-btn",on:{click:function(t){a.showAbonosModal=!1}}},[a._v("Cerrar")])])]):a._e(),t("div",{staticClass:"cuentas-list"},[t("h2",[a._v("Registros de Cuentas")]),a.error?t("div",{staticClass:"error-message"},[a._v(" Error al cargar los datos: "+a._s(a.error)+" ")]):a.isLoading?t("div",{staticClass:"loading"},[a._v("Cargando registros...")]):0===a.cuentas.length?t("div",{staticClass:"no-records"},[a._v(" No hay registros de cuentas que coincidan con el filtro. ")]):t("ul",a._l(a.cuentas,(function(o){return t("li",{key:o.id,staticClass:"cuenta-item",class:{"tiene-observacion":o.tieneObservacion}},[t("div",{staticClass:"cuenta-content"},[t("span",{staticClass:"cuenta-date"},[a._v(a._s(a.formatDate(o.fecha)))]),t("p",{staticClass:"cuenta-summary"},[t("span",[a._v("Saldo Hoy: $"+a._s(a.formatNumber(o.saldoHoy)))]),t("span",[a._v("Total Acumulado: $"+a._s(a.formatNumber(o.totalNota)))])]),o.tieneObservacion?t("div",{staticClass:"observacion-badge",on:{click:function(t){return a.mostrarObservacion(o)}}},[a._v(" Ver observación ")]):a._e(),o.abonos&&o.abonos.length>0?t("div",{staticClass:"abonos-info"},a._l(o.abonos,(function(o,s){return t("p",{key:s,staticClass:"abono-detail"},[t("span",{staticClass:"abono-label"},[a._v("Abono:")]),t("span",{staticClass:"abono-monto"},[a._v("$"+a._s(a.formatNumber(o.monto)))]),t("span",{staticClass:"abono-descripcion"},[a._v(a._s(o.descripcion||"Sin descripción"))])])})),0):a._e()]),t("div",{staticClass:"cuenta-actions"},[t("button",{staticClass:"edit-btn",on:{click:function(t){return a.editarCuenta(o.id)}}},[a._v("Editar")]),t("button",{staticClass:"delete-btn",on:{click:function(t){return a.borrarCuenta(o.id)}}},[a._v("Borrar")])])])})),0)]),a.showObservacionModal?t("div",{staticClass:"modal-overlay"},[t("div",{staticClass:"modal-content"},[t("h3",[a._v("Observación")]),t("p",{staticClass:"observacion-text"},[a._v(a._s(a.observacionActual))]),t("div",{staticClass:"modal-buttons"},[t("button",{staticClass:"btn-cerrar",on:{click:function(t){a.showObservacionModal=!1}}},[a._v("Cerrar")])])])]):a._e(),a.showSaveMessage&&a.lastSaveMessage?[t("div",{staticClass:"save-message"},[a._v(" "+a._s(a.lastSaveMessage)+" ")])]:a._e()],2)},e=[],n=(o("14d9"),o("13d5"),o("dc59")),i=o("1494"),c=o("74c9"),r=o("666c"),l=o("3f5a"),u={name:"JoselitoCuentasMenu",components:{BackButton:c["a"],PreciosHistorialModal:r["a"],StashModalV2:l["a"]},data(){return{cuentas:[],isLoading:!0,unsubscribe:null,error:null,showAbonosModal:!1,fechaInicio:"",fechaFin:"",totalAbonosPeriodo:null,abonosHistorial:[],showObservacionModal:!1,observacionActual:"",lastSaveMessage:"",showSaveMessage:!1,saveMessageTimer:null}},methods:{async loadCuentas(){try{this.isLoading=!0;const a=Object(i["c"])(n["a"],"cuentasJoselito"),t=Object(i["o"])(a,Object(i["l"])("fecha","asc"));this.unsubscribe=Object(i["k"])(t,async a=>{const t=a.docs.map(a=>{const t=a.data(),o=(t.cobros||[]).reduce((a,t)=>a+(parseFloat(t.monto)||0),0),s=(t.abonos||[]).reduce((a,t)=>a+(parseFloat(t.monto)||0),0);return{id:a.id,fecha:t.fecha,saldoHoy:t.totalGeneralVenta||0,totalCobros:o,totalAbonos:s,totalNota:t.nuevoSaldoAcumulado||0,nuevoSaldoAcumulado:t.nuevoSaldoAcumulado||0,saldoAcumuladoAnterior:t.saldoAcumuladoAnterior||0,abonos:t.abonos||[],tieneObservacion:t.tieneObservacion||!1,observacion:t.observacion||""}}),o=t.sort((a,t)=>new Date(a.fecha)-new Date(t.fecha));let s=0;const e=[];for(let n=0;n<o.length;n++){const a=o[n],t=a.saldoHoy-a.totalCobros-a.totalAbonos;s+=t;const i=0===n?0:o[n-1].nuevoSaldoAcumulado;a.saldoAcumuladoAnterior===i&&a.nuevoSaldoAcumulado===s||e.push({id:a.id,updates:{saldoAcumuladoAnterior:i,nuevoSaldoAcumulado:s}}),a.totalNota=s,a.saldoAcumuladoAnterior=i,s<=0&&(s=0)}e.length>0&&await Promise.all(e.map(({id:a,updates:t})=>Object(i["s"])(Object(i["e"])(n["a"],"cuentasJoselito",a),t))),this.cuentas=o.reverse(),this.isLoading=!1})}catch(a){console.error("Error al cargar cuentas: ",a),this.error=a.message,this.cuentas=[],this.isLoading=!1}},formatDate(a){const t=new Date(a);return t.setMinutes(t.getMinutes()+t.getTimezoneOffset()),t.toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"})},formatNumber(a){return a.toLocaleString("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2})},editarCuenta(a){this.$router.push(`/cuentas-joselito/${a}?edit=true`)},async borrarCuenta(a){if(confirm("¿Estás seguro de que quieres borrar este registro de cuenta?"))try{await Object(i["d"])(Object(i["e"])(n["a"],"cuentasJoselito",a)),"Registro de cuenta borrado con éxito"===this.lastSaveMessage&&this.showSaveMessage||(this.lastSaveMessage="Registro de cuenta borrado con éxito",this.showSaveMessage=!0,this.saveMessageTimer&&clearTimeout(this.saveMessageTimer),this.saveMessageTimer=setTimeout(()=>{this.showSaveMessage=!1},3e3))}catch(t){console.error("Error al borrar el registro de cuenta: ",t),"Error al borrar el registro de cuenta"===this.lastSaveMessage&&this.showSaveMessage||(this.lastSaveMessage="Error al borrar el registro de cuenta",this.showSaveMessage=!0,this.saveMessageTimer&&clearTimeout(this.saveMessageTimer),this.saveMessageTimer=setTimeout(()=>{this.showSaveMessage=!1},3e3))}},calcularTotalAbonos(){if(!this.fechaInicio||!this.fechaFin)return void(this.totalAbonosPeriodo=null);const a=new Date(this.fechaInicio),t=new Date(this.fechaFin);t.setHours(23,59,59,999);const o=this.abonosHistorial.filter(o=>{const s=new Date(o.fecha);return s>=a&&s<=t});this.totalAbonosPeriodo=o.reduce((a,t)=>a+(parseFloat(t.monto)||0),0)},async cargarHistorialAbonos(){try{const a=Object(i["c"])(n["a"],"cuentasJoselito"),t=await Object(i["g"])(a);let o=[];t.forEach(a=>{const t=a.data();t.abonos&&t.abonos.length>0&&t.abonos.forEach(a=>{o.push({...a,fecha:t.fecha})})}),this.abonosHistorial=o.sort((a,t)=>new Date(t.fecha)-new Date(a.fecha)),this.fechaInicio&&this.fechaFin&&this.calcularTotalAbonos()}catch(a){console.error("Error al cargar historial de abonos:",a)}},mostrarObservacion(a){this.observacionActual=a.observacion,this.showObservacionModal=!0}},watch:{showAbonosModal(a){a&&this.cargarHistorialAbonos()}},created(){this.loadCuentas()},beforeUnmount(){this.unsubscribe&&this.unsubscribe()}},d=u,b=(o("d23a"),o("2877")),v=Object(b["a"])(d,s,e,!1,null,"2ac6fb1a",null);t["a"]=v.exports},4935:function(a,t,o){},"5f7c":function(a,t,o){"use strict";o("71db")},"71db":function(a,t,o){},"79d5":function(a,t,o){"use strict";o("aba6")},"9e53":function(a,t,o){"use strict";o("13d5");var s=function(){var a=this,t=a._self._c;return t("div",{staticClass:"otilio-cuentas-menu-container"},[t("h1",[a._v("Menú de Cuentas Independientes Otilio")]),t("div",{staticClass:"actions-container"},[t("router-link",{staticClass:"action-button back-btn",attrs:{to:"/cuentas-otilio"}},[a._v(" Volver a Cuentas Otilio ")]),t("router-link",{staticClass:"action-button new-cuenta-btn",attrs:{to:"/cuentas-otilio-independiente/nueva"}},[a._v(" Nueva Cuenta ")]),t("button",{staticClass:"action-button abonos-btn",on:{click:function(t){a.showAbonosModal=!0}}},[a._v(" Abonos ")]),t("PreciosHistorialModal",{attrs:{clienteActual:"otilioIndependiente"}}),t("StashModalV2",{attrs:{cliente:"otilioIndependiente"}})],1),a.showAbonosModal?t("div",{staticClass:"modal"},[t("div",{staticClass:"modal-content"},[t("div",{staticClass:"modal-header"},[t("h2",[a._v("Historial de Abonos")]),t("button",{staticClass:"close-modal-btn",on:{click:function(t){a.showAbonosModal=!1}}},[a._v("×")])]),t("div",{staticClass:"fecha-filtros"},[t("div",{staticClass:"fecha-grupo"},[t("label",[a._v("Desde:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.fechaInicio,expression:"fechaInicio"}],staticClass:"fecha-input",attrs:{type:"date"},domProps:{value:a.fechaInicio},on:{change:a.calcularTotalAbonos,input:function(t){t.target.composing||(a.fechaInicio=t.target.value)}}})]),t("div",{staticClass:"fecha-grupo"},[t("label",[a._v("Hasta:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.fechaFin,expression:"fechaFin"}],staticClass:"fecha-input",attrs:{type:"date"},domProps:{value:a.fechaFin},on:{change:a.calcularTotalAbonos,input:function(t){t.target.composing||(a.fechaFin=t.target.value)}}})])]),null!==a.totalAbonosPeriodo?t("div",{staticClass:"total-abonos"},[t("span",{staticClass:"total-label"},[a._v("Total de abonos en el periodo:")]),t("span",{staticClass:"total-monto"},[a._v("$"+a._s(a.formatNumber(a.totalAbonosPeriodo)))])]):a._e(),t("div",{staticClass:"abonos-list"},[0===a.abonosHistorial.length?t("div",{staticClass:"no-records"},[a._v(" No hay abonos registrados. ")]):t("div",a._l(a.abonosHistorial,(function(o,s){return t("div",{key:s,staticClass:"abono-item"},[t("div",{staticClass:"abono-fecha"},[a._v(a._s(a.formatDate(o.fecha)))]),t("div",{staticClass:"abono-details"},[t("span",{staticClass:"abono-monto"},[a._v("$"+a._s(a.formatNumber(o.monto)))]),t("span",{staticClass:"abono-descripcion"},[a._v(a._s(o.descripcion))])])])})),0)]),t("button",{staticClass:"close-btn",on:{click:function(t){a.showAbonosModal=!1}}},[a._v("Cerrar")])])]):a._e(),t("div",{staticClass:"cuentas-list"},[t("h2",[a._v("Registros de Cuentas Independientes")]),a.error?t("div",{staticClass:"error-message"},[a._v(" Error al cargar los datos: "+a._s(a.error)+" ")]):a.isLoading?t("div",{staticClass:"loading"},[a._v("Cargando registros...")]):0===a.cuentas.length?t("div",{staticClass:"no-records"},[a._v(" No hay registros de cuentas que coincidan con el filtro. ")]):t("ul",a._l(a.cuentas,(function(o){return t("li",{key:o.id,staticClass:"cuenta-item",class:{"tiene-observacion":o.tieneObservacion}},[t("div",{staticClass:"cuenta-content"},[t("span",{staticClass:"cuenta-date"},[a._v(a._s(a.formatDate(o.fecha)))]),t("p",{staticClass:"cuenta-summary"},[t("span",[a._v("Saldo Hoy: $"+a._s(a.formatNumber(o.saldoHoy)))]),t("span",[a._v("Total Acumulado: $"+a._s(a.formatNumber(o.totalNota)))])]),o.tieneObservacion?t("div",{staticClass:"observacion-badge",on:{click:function(t){return a.mostrarObservacion(o)}}},[a._v(" Ver observación ")]):a._e(),o.abonos&&o.abonos.length>0?t("div",{staticClass:"abonos-info"},[a._l(o.abonos,(function(o,s){return t("p",{key:s,staticClass:"abono-detail"},[t("span",{staticClass:"abono-label"},[a._v("Abono:")]),t("span",{staticClass:"abono-monto"},[a._v("$"+a._s(a.formatNumber(o.monto)))]),t("span",{staticClass:"abono-descripcion"},[a._v(a._s(o.descripcion||"Sin descripción"))])])})),t("p",{staticClass:"total-abonos-dia"},[t("span",{staticClass:"total-label"},[a._v("Total")]),t("span",{staticClass:"total-monto"},[a._v("$"+a._s(a.formatNumber(o.abonos.reduce((a,t)=>a+(parseFloat(t.monto)||0),0))))])])],2):a._e()]),t("div",{staticClass:"cuenta-actions"},[t("button",{staticClass:"edit-btn",on:{click:function(t){return a.editarCuenta(o.id)}}},[a._v("Editar")]),t("button",{staticClass:"delete-btn",on:{click:function(t){return a.borrarCuenta(o.id)}}},[a._v("Borrar")])])])})),0)]),a.showObservacionModal?t("div",{staticClass:"modal-overlay"},[t("div",{staticClass:"modal-content"},[t("h3",[a._v("Observación")]),t("p",{staticClass:"observacion-text"},[a._v(a._s(a.observacionActual))]),t("div",{staticClass:"modal-buttons"},[t("button",{staticClass:"btn-cerrar",on:{click:function(t){a.showObservacionModal=!1}}},[a._v("Cerrar")])])])]):a._e()])},e=[],n=(o("14d9"),o("dc59")),i=o("1494"),c=o("74c9"),r=o("666c"),l=o("3f5a"),u={name:"OtilioIndependienteCuentasMenu",components:{BackButton:c["a"],PreciosHistorialModal:r["a"],StashModalV2:l["a"]},data(){return{cuentas:[],isLoading:!0,unsubscribe:null,error:null,showAbonosModal:!1,abonosHistorial:[],fechaInicio:"",fechaFin:"",totalAbonosPeriodo:null,showObservacionModal:!1,observacionActual:""}},methods:{async loadCuentas(){try{this.isLoading=!0;const a=Object(i["c"])(n["a"],"cuentasOtilioIndependiente"),t=Object(i["o"])(a,Object(i["l"])("fecha","asc"));this.unsubscribe=Object(i["k"])(t,async a=>{const t=a.docs.map(a=>{const t=a.data(),o=(t.cobros||[]).reduce((a,t)=>a+(parseFloat(t.monto)||0),0),s=(t.abonos||[]).reduce((a,t)=>a+(parseFloat(t.monto)||0),0);return{id:a.id,fecha:t.fecha,saldoHoy:t.totalGeneralVenta||0,totalCobros:o,totalAbonos:s,totalNota:t.nuevoSaldoAcumulado||0,nuevoSaldoAcumulado:t.nuevoSaldoAcumulado||0,saldoAcumuladoAnterior:t.saldoAcumuladoAnterior||0,abonos:t.abonos||[],tieneObservacion:Boolean(t.tieneObservacion)||!1,observacion:String(t.observacion||"")}}),o=t.sort((a,t)=>new Date(a.fecha)-new Date(t.fecha));let s=0;const e=[];for(let n=0;n<o.length;n++){const a=o[n],t=a.saldoHoy-a.totalCobros-a.totalAbonos;s+=t;const i=0===n?0:o[n-1].nuevoSaldoAcumulado;a.saldoAcumuladoAnterior===i&&a.nuevoSaldoAcumulado===s||e.push({id:a.id,updates:{saldoAcumuladoAnterior:i,nuevoSaldoAcumulado:s}}),a.totalNota=s,a.saldoAcumuladoAnterior=i,s<=0&&(s=0)}e.length>0&&await Promise.all(e.map(({id:a,updates:t})=>Object(i["s"])(Object(i["e"])(n["a"],"cuentasOtilioIndependiente",a),t))),this.cuentas=o.reverse(),this.isLoading=!1})}catch(a){console.error("Error al cargar cuentas: ",a),this.error=a.message,this.cuentas=[],this.isLoading=!1}},formatDate(a){const t=new Date(a);return t.setMinutes(t.getMinutes()+t.getTimezoneOffset()),t.toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"})},formatNumber(a){return a.toLocaleString("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2})},editarCuenta(a){this.$router.push(`/cuentas-otilio-independiente/${a}?edit=true`)},async borrarCuenta(a){if(confirm("¿Estás seguro de que quieres borrar este registro de cuenta?"))try{await Object(i["d"])(Object(i["e"])(n["a"],"cuentasOtilioIndependiente",a)),alert("Registro de cuenta borrado con éxito")}catch(t){console.error("Error al borrar el registro de cuenta: ",t),alert("Error al borrar el registro de cuenta")}},calcularTotalAbonos(){if(!this.fechaInicio||!this.fechaFin)return void(this.totalAbonosPeriodo=null);const a=new Date(this.fechaInicio),t=new Date(this.fechaFin);t.setHours(23,59,59,999);const o=this.abonosHistorial.filter(o=>{const s=new Date(o.fecha);return s>=a&&s<=t});this.totalAbonosPeriodo=o.reduce((a,t)=>a+(parseFloat(t.monto)||0),0)},async cargarHistorialAbonos(){try{const a=Object(i["c"])(n["a"],"cuentasOtilioIndependiente"),t=await Object(i["g"])(a);let o=[];t.forEach(a=>{const t=a.data();t.abonos&&t.abonos.length>0&&t.abonos.forEach(a=>{o.push({...a,fecha:t.fecha})})}),this.abonosHistorial=o.sort((a,t)=>new Date(t.fecha)-new Date(a.fecha)),this.fechaInicio&&this.fechaFin&&this.calcularTotalAbonos()}catch(a){console.error("Error al cargar historial de abonos:",a)}},mostrarObservacion(a){a&&a.observacion?(this.observacionActual=a.observacion,this.showObservacionModal=!0):console.error("No hay observación disponible para mostrar")}},watch:{showAbonosModal(a){a&&this.cargarHistorialAbonos()}},created(){this.loadCuentas()},beforeUnmount(){this.unsubscribe&&this.unsubscribe()}},d=u,b=(o("79d5"),o("2877")),v=Object(b["a"])(d,s,e,!1,null,"2c9ec021",null);t["a"]=v.exports},"9f85":function(a,t,o){"use strict";o("13d5");var s=function(){var a=this,t=a._self._c;return t("div",{staticClass:"otilio-cuentas-menu-container"},[t("h1",[a._v("Menú de Cuentas Otilio")]),t("div",{staticClass:"actions-container"},[t("router-link",{staticClass:"action-button back-btn",attrs:{to:"/cuentas-mexico"}},[a._v(" Cuentas México ")]),t("router-link",{staticClass:"action-button new-cuenta-btn",attrs:{to:"/cuentas-otilio/nueva"}},[a._v(" Nueva Cuenta ")]),t("router-link",{staticClass:"action-button independiente-btn",attrs:{to:"/cuentas-otilio-independiente"}},[a._v(" Cuentas Independientes ")]),t("button",{staticClass:"action-button abonos-btn",on:{click:function(t){a.showAbonosModal=!0}}},[a._v(" Abonos ")]),t("button",{staticClass:"action-button observaciones-btn",on:{click:function(t){a.showObservacionesModal=!0}}},[a._v(" Ver Observaciones ")]),t("PreciosHistorialModal",{attrs:{clienteActual:"otilio"}}),t("StashModalV2",{attrs:{cliente:"otilio"}}),t("ObservacionesModal",{attrs:{isVisible:a.showObservacionesModal},on:{cerrar:function(t){a.showObservacionesModal=!1}}})],1),a.showAbonosModal?t("div",{staticClass:"modal"},[t("div",{staticClass:"modal-content"},[t("div",{staticClass:"modal-header"},[t("h2",[a._v("Historial de Abonos")]),t("button",{staticClass:"close-modal-btn",on:{click:function(t){a.showAbonosModal=!1}}},[a._v("×")])]),t("div",{staticClass:"fecha-filtros"},[t("div",{staticClass:"fecha-grupo"},[t("label",[a._v("Desde:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.fechaInicio,expression:"fechaInicio"}],staticClass:"fecha-input",attrs:{type:"date"},domProps:{value:a.fechaInicio},on:{change:a.calcularTotalAbonos,input:function(t){t.target.composing||(a.fechaInicio=t.target.value)}}})]),t("div",{staticClass:"fecha-grupo"},[t("label",[a._v("Hasta:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.fechaFin,expression:"fechaFin"}],staticClass:"fecha-input",attrs:{type:"date"},domProps:{value:a.fechaFin},on:{change:a.calcularTotalAbonos,input:function(t){t.target.composing||(a.fechaFin=t.target.value)}}})])]),null!==a.totalAbonosPeriodo?t("div",{staticClass:"total-abonos"},[t("span",{staticClass:"total-label"},[a._v("Total de abonos en el periodo:")]),t("span",{staticClass:"total-monto"},[a._v("$"+a._s(a.formatNumber(a.totalAbonosPeriodo)))])]):a._e(),t("div",{staticClass:"abonos-list"},[0===a.abonosHistorial.length?t("div",{staticClass:"no-records"},[a._v(" No hay abonos registrados. ")]):t("div",a._l(a.abonosHistorial,(function(o,s){return t("div",{key:s,staticClass:"abono-item"},[t("div",{staticClass:"abono-fecha"},[a._v(a._s(a.formatDate(o.fecha)))]),t("div",{staticClass:"abono-details"},[t("span",{staticClass:"abono-monto"},[a._v("$"+a._s(a.formatNumber(o.monto)))]),t("span",{staticClass:"abono-descripcion"},[a._v(a._s(o.descripcion))])])])})),0)]),t("button",{staticClass:"close-btn",on:{click:function(t){a.showAbonosModal=!1}}},[a._v("Cerrar")])])]):a._e(),t("div",{staticClass:"cuentas-list"},[t("h2",[a._v("Registros de Cuentas")]),a.error?t("div",{staticClass:"error-message"},[a._v(" Error al cargar los datos: "+a._s(a.error)+" ")]):a.isLoading?t("div",{staticClass:"loading"},[a._v("Cargando registros...")]):0===a.cuentas.length?t("div",{staticClass:"no-records"},[a._v(" No hay registros de cuentas que coincidan con el filtro. ")]):t("ul",a._l(a.cuentas,(function(o){return t("li",{key:o.id,staticClass:"cuenta-item",class:{"tiene-observacion":o.tieneObservacion}},[t("div",{staticClass:"cuenta-content"},[t("span",{staticClass:"cuenta-date"},[a._v(a._s(a.formatDate(o.fecha)))]),t("p",{staticClass:"cuenta-summary"},[t("span",[a._v("Saldo Hoy: $"+a._s(a.formatNumber(o.saldoHoy)))]),t("span",[a._v("Total Acumulado: $"+a._s(a.formatNumber(o.totalNota)))])]),o.tieneObservacion?t("div",{staticClass:"observacion-badge",on:{click:function(t){return a.mostrarObservacion(o)}}},[a._v(" Ver observación ")]):a._e(),o.abonos&&o.abonos.length>0?t("div",{staticClass:"abonos-info"},[a._l(o.abonos,(function(o,s){return t("p",{key:s,staticClass:"abono-detail"},[t("span",{staticClass:"abono-label"},[a._v("Abono:")]),t("span",{staticClass:"abono-monto"},[a._v("$"+a._s(a.formatNumber(o.monto)))]),t("span",{staticClass:"abono-descripcion"},[a._v(a._s(o.descripcion||"Sin descripción"))])])})),t("p",{staticClass:"total-abonos-dia"},[t("span",{staticClass:"total-label"},[a._v("Total")]),t("span",{staticClass:"total-monto"},[a._v("$"+a._s(a.formatNumber(o.abonos.reduce((a,t)=>a+(parseFloat(t.monto)||0),0))))])])],2):a._e()]),t("div",{staticClass:"cuenta-actions"},[t("button",{staticClass:"edit-btn",on:{click:function(t){return a.editarCuenta(o.id)}}},[a._v("Editar")]),t("button",{staticClass:"delete-btn",on:{click:function(t){return a.borrarCuenta(o.id)}}},[a._v("Borrar")])])])})),0)]),a.showObservacionModal?t("div",{staticClass:"modal-overlay"},[t("div",{staticClass:"modal-content"},[t("h3",[a._v("Observación")]),t("p",{staticClass:"observacion-text"},[a._v(a._s(a.observacionActual))]),t("div",{staticClass:"modal-buttons"},[t("button",{staticClass:"btn-cerrar",on:{click:function(t){a.showObservacionModal=!1}}},[a._v("Cerrar")])])])]):a._e()])},e=[],n=(o("14d9"),o("dc59")),i=o("1494"),c=o("74c9"),r=o("666c"),l=o("3f5a"),u=o("912b"),d={name:"OtilioCuentasMenu",components:{BackButton:c["a"],PreciosHistorialModal:r["a"],StashModalV2:l["a"],ObservacionesModal:u["a"]},data(){return{cuentas:[],isLoading:!0,unsubscribe:null,error:null,showAbonosModal:!1,abonosHistorial:[],fechaInicio:"",fechaFin:"",totalAbonosPeriodo:null,showObservacionModal:!1,observacionActual:"",showObservacionesModal:!1}},methods:{async loadCuentas(){try{this.isLoading=!0;const a=Object(i["c"])(n["a"],"cuentasOtilio"),t=Object(i["o"])(a,Object(i["l"])("fecha","asc"));this.unsubscribe=Object(i["k"])(t,async a=>{const t=a.docs.map(a=>{const t=a.data(),o=(t.cobros||[]).reduce((a,t)=>a+(parseFloat(t.monto)||0),0),s=(t.abonos||[]).reduce((a,t)=>a+(parseFloat(t.monto)||0),0);return{id:a.id,fecha:t.fecha,saldoHoy:t.totalGeneralVenta||0,totalCobros:o,totalAbonos:s,totalNota:t.nuevoSaldoAcumulado||0,nuevoSaldoAcumulado:t.nuevoSaldoAcumulado||0,saldoAcumuladoAnterior:t.saldoAcumuladoAnterior||0,abonos:t.abonos||[],tieneObservacion:Boolean(t.tieneObservacion)||!1,observacion:String(t.observacion||"")}}),o=t.sort((a,t)=>new Date(a.fecha)-new Date(t.fecha));let s=0;const e=[];for(let n=0;n<o.length;n++){const a=o[n],t=a.saldoHoy-a.totalCobros-a.totalAbonos;s+=t;const i=0===n?0:o[n-1].nuevoSaldoAcumulado;a.saldoAcumuladoAnterior===i&&a.nuevoSaldoAcumulado===s||e.push({id:a.id,updates:{saldoAcumuladoAnterior:i,nuevoSaldoAcumulado:s}}),a.totalNota=s,a.saldoAcumuladoAnterior=i,s<=0&&(s=0)}e.length>0&&await Promise.all(e.map(({id:a,updates:t})=>Object(i["s"])(Object(i["e"])(n["a"],"cuentasOtilio",a),t))),this.cuentas=o.reverse(),this.isLoading=!1})}catch(a){console.error("Error al cargar cuentas: ",a),this.error=a.message,this.cuentas=[],this.isLoading=!1}},formatDate(a){const t=new Date(a);return t.setMinutes(t.getMinutes()+t.getTimezoneOffset()),t.toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"})},formatNumber(a){return a.toLocaleString("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2})},editarCuenta(a){this.$router.push(`/cuentas-otilio/${a}?edit=true`)},async borrarCuenta(a){if(confirm("¿Estás seguro de que quieres borrar este registro de cuenta?"))try{await Object(i["d"])(Object(i["e"])(n["a"],"cuentasOtilio",a)),alert("Registro de cuenta borrado con éxito")}catch(t){console.error("Error al borrar el registro de cuenta: ",t),alert("Error al borrar el registro de cuenta")}},calcularTotalAbonos(){if(!this.fechaInicio||!this.fechaFin)return void(this.totalAbonosPeriodo=null);const a=new Date(this.fechaInicio),t=new Date(this.fechaFin);t.setHours(23,59,59,999);const o=this.abonosHistorial.filter(o=>{const s=new Date(o.fecha);return s>=a&&s<=t});this.totalAbonosPeriodo=o.reduce((a,t)=>a+(parseFloat(t.monto)||0),0)},async cargarHistorialAbonos(){try{const a=Object(i["c"])(n["a"],"cuentasOtilio"),t=await Object(i["g"])(a);let o=[];t.forEach(a=>{const t=a.data();t.abonos&&t.abonos.length>0&&t.abonos.forEach(a=>{o.push({...a,fecha:t.fecha})})}),this.abonosHistorial=o.sort((a,t)=>new Date(t.fecha)-new Date(a.fecha)),this.fechaInicio&&this.fechaFin&&this.calcularTotalAbonos()}catch(a){console.error("Error al cargar historial de abonos:",a)}},mostrarObservacion(a){a&&a.observacion?(this.observacionActual=a.observacion,this.showObservacionModal=!0):console.error("No hay observación disponible para mostrar")}},watch:{showAbonosModal(a){a&&this.cargarHistorialAbonos()}},created(){this.loadCuentas()},beforeUnmount(){this.unsubscribe&&this.unsubscribe()}},b=d,v=(o("5f7c"),o("2877")),h=Object(v["a"])(b,s,e,!1,null,"ab7526c6",null);t["a"]=h.exports},aba6:function(a,t,o){},d23a:function(a,t,o){"use strict";o("4935")}}]);