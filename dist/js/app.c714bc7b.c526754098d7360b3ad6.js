(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["app.c714bc7b"],{"41cb":function(e,a,t){"use strict";var o=t("2b0e"),n=t("8c4f"),r=(t("f549"),t("bb51")),s=t("f411"),c=t("98cf"),i=t("4e00"),l=t("32e5"),d=t("9302"),u=t("1155"),m=t("2cc6"),p=t("4c52"),h=t("4c57"),f=t("505e"),g=t("f515"),b=t("fcb3"),w=t("24d5"),y=t("4786"),v=t("28ce"),M=t("74a9"),k=t("320e"),A=t("0ae9"),V=t("c8b7"),C=t("b34e"),I=t("f458"),O=t("4dc0"),j=t("9aeb"),E=t("a55b"),S=t("9f85"),x=t("85fe"),q=t("05af"),N=t("c5f5"),z=t("f125"),$=(t("0042"),t("cc98")),F=t("3420"),P=t("d918"),L=t("92c9"),D=t("e524");o["default"].use(n["a"]);const G=[{path:"/login",name:"Login",component:E["a"]},{path:"/noteMenu",name:"NoteMenu",component:s["a"]},{path:"/",name:"home",component:r["a"]},{path:"/sale-note/:noteId?",name:"SaleNote",component:()=>Promise.resolve().then(t.bind(null,"98cf"))},{path:"/add-client",name:"AddClient",component:i["a"]},{path:"/editar-nota/:noteId",name:"editar-nota",component:c["default"],props:!0},{path:"/sacadas",name:"SacadasMenu",component:d["a"]},{path:"/sacadas/new",name:"NuevaSacada",component:l["a"]},{path:"/sacadas/:id",name:"DetalleSacada",component:l["a"],props:!0},{path:"/gestionar-productos",name:"GestionarProductos",component:u["a"]},{path:"/gestionar-medidas",name:"GestionarMedidas",component:m["a"]},{path:"/gestionar-proveedores",name:"GestionarProveedores",component:p["a"]},{path:"/existencias",name:"Existencias",component:h["a"]},{path:"/cuentas-mexico",name:"CuentasMexico",component:f["a"]},{path:"/cuentas-ozuna",name:"ozuna-cuentas-menu",component:g["a"]},{path:"/cuentas-ozuna/nueva",name:"nueva-cuenta-ozuna",component:b["a"]},{path:"/cuentas-ozuna/:id",name:"ver-cuenta-ozuna",component:b["a"]},{path:"/cuentas-ozuna/:id?",name:"CuentasOzuna",component:b["a"]},{path:"/cuentas-catarro",name:"catarro-cuentas-menu",component:w["a"]},{path:"/cuentas-catarro/nueva",name:"nueva-cuenta-catarro",component:y["a"]},{path:"/cuentas-catarro/:id",name:"ver-cuenta-catarro",component:y["a"]},{path:"/cuentas-catarro/:id?",name:"CuentasCatarro",component:y["a"]},{path:"/cuentas-joselito",name:"joselito-cuentas-menu",component:v["a"]},{path:"/cuentas-joselito/nueva",name:"nueva-cuenta-joselito",component:M["a"]},{path:"/cuentas-joselito/:id",name:"ver-cuenta-joselito",component:M["a"]},{path:"/cuentas-joselito/:id?",name:"CuentasJoselito",component:M["a"]},{path:"/embarques-menu",name:"EmbarquesMenu",component:k["a"]},{path:"/ventas-ganancias-catarro",name:"VentasYGananciasCatarro",component:A["a"]},{path:"/ventas-ganancias-joselito",name:"VentasYGananciasJoselito",component:V["a"]},{path:"/embarques",name:"ListaEmbarques",component:C["a"]},{path:"/embarques/:id",name:"EditarEmbarque",component:I["a"]},{path:"/nuevo-embarque",name:"NuevoEmbarque",component:I["a"]},{path:"/embarques/:id/rendimientos",name:"Rendimientos",component:O["default"],props:!0},{path:"/cuenta-fletes",name:"CuentaFletes",component:j["a"]},{path:"/cuentas-otilio",name:"otilio-cuentas-menu",component:S["a"]},{path:"/cuentas-otilio/nueva",name:"nueva-cuenta-otilio",component:x["a"]},{path:"/cuentas-otilio/:id",name:"ver-cuenta-otilio",component:x["a"]},{path:"/cuentas-otilio/:id?",name:"CuentasOtilio",component:x["a"]},{path:"/procesos",name:"ProcesosMenu",component:q["a"]},{path:"/procesos/preparacion",name:"Preparacion",component:N["a"]},{path:"/procesos/pedidos",name:"PedidosMenu",component:z["a"]},{path:"/procesos/pedidos/nuevo",name:"NuevoPedido",component:P["a"]},{path:"/procesos/pedidos/crudo",name:"PedidosCrudo",component:$["a"]},{path:"/procesos/pedidos/limpio",name:"PedidosLimpio",component:P["a"]},{path:"/procesos/pedidos-crudos-impresion",name:"PedidoCrudosImpresion",component:F["a"],props:!0},{path:"/procesos/pedidos-limpio-impresion",name:"PedidoLimpioImpresion",component:L["a"],props:!0},{path:"/procesos/bitacoras",name:"Bitacoras",component:D["a"]}],J=new n["a"]({mode:"history",base:"/",routes:G});J.beforeEach((e,a,t)=>{const o=localStorage.getItem("user"),n=!!o;"/login"===e.path&&n?t("/"):"/login"===e.path||n?t():t("/login")}),a["a"]=J},"6d4d":function(e,a,t){"use strict";t.d(a,"a",(function(){return c}));t("14d9"),t("13d5");var o=t("e499"),n=t.n(o),r=t("4ebb"),s=t.n(r);"object"===typeof s.a&&(s.a.pdfMake&&s.a.pdfMake.vfs?n.a.vfs=s.a.pdfMake.vfs:s.a.vfs?n.a.vfs=s.a.vfs:n.a.vfs=s.a),"undefined"===typeof window||window.pdfMake||(window.pdfMake=n.a);const c=async(e,a)=>{try{const t=await u("https://res.cloudinary.com/hwkcovsmr/image/upload/v1620946647/samples/REY_PEZ_LOGO_nsotww.png"),o=(null===a||void 0===a?void 0:a.nombresMedidasPersonalizados)||{},r=e=>{if(!e)return"Sin fecha";let a;if(e&&"function"===typeof e.toDate?a=e.toDate():"string"===typeof e?a=new Date(e):e instanceof Date&&(a=e),isNaN(a.getTime()))return"Fecha inválida";const t=new Date(a.getTime()+6e4*a.getTimezoneOffset());return t.toLocaleDateString("es-MX",{year:"numeric",month:"2-digit",day:"2-digit",timeZone:"America/Mexico_City"})},s={content:[{columns:[{image:t,width:80,alignment:"left",margin:[0,0,0,5]},{text:"Reporte de Rendimientos",style:"header",alignment:"center",margin:[0,10,0,0]},{stack:[{text:"Fecha: "+r(a.fecha),alignment:"right",margin:[0,10,0,0]}]}]},{text:"\n",height:5},i(e,o,a)],styles:{header:{fontSize:24,bold:!0,color:"#3760b0",margin:[0,0,0,5]},tableHeader:{bold:!0,fontSize:20,color:"white",fillColor:"#3760b0"},rendimientoAlto:{color:"#27ae60",bold:!0},rendimientoBajo:{color:"#000000"},costoStyle:{color:"#e74c3c",bold:!0}},defaultStyle:{fontSize:18},footer:function(e,a){return{columns:[{text:"© 2024 Rey Pez - Tampico, Tamps.",alignment:"center",margin:[0,5,0,0],fontSize:8,color:"#3760b0"}]}}};a.notaRendimientos&&(s.content.push({text:"\n",height:5}),s.content.push({text:"Nota:",style:"header",color:"red",alignment:"center",margin:[0,10,0,0]}),s.content.push({text:" "+a.notaRendimientos,style:"header",alignment:"center",color:"black",margin:[0,10,0,0]})),n.a.createPdf(s).open()}catch(t){console.error("Error al generar el PDF de rendimientos:",t)}};function i(e,a,t){const o=e.reduce((e,t)=>{const o=a[t.medida]||t.medida;return o.includes("mixta")||o.includes("Mixta")?(e["Mixta"]||(e["Mixta"]={medida:"Mixta",kilosCrudos:0,totalEmbarcado:0,costoFinal:t.costoFinal}),t.kilosCrudos&&("object"===typeof t.kilosCrudos?e["Mixta"].kilosCrudos+=(parseFloat(t.kilosCrudos.medida1)||0)+(parseFloat(t.kilosCrudos.medida2)||0):e["Mixta"].kilosCrudos+=parseFloat(t.kilosCrudos)||0),e["Mixta"].totalEmbarcado+=parseFloat(t.totalEmbarcado)||0):e[o]={medida:o,kilosCrudos:parseFloat(t.kilosCrudos)||0,totalEmbarcado:parseFloat(t.totalEmbarcado)||0,costoFinal:t.costoFinal},e},{}),n=Object.values(o).some(e=>e.costoFinal&&"0"!==e.costoFinal&&0!==e.costoFinal),r=t.mostrarColumnaCosto&&n,s=[[{text:"Kilos en Crudo",style:"tableHeader"},{text:"Medida",style:"tableHeader"},{text:"Rendimiento",style:"tableHeader"},...r?[{text:"Costo Final",style:"tableHeader"}]:[]],...Object.values(o).map(e=>{const a=e.totalEmbarcado>0?e.kilosCrudos/e.totalEmbarcado:0,t=a>1?"rendimientoAlto":"rendimientoBajo";let o=e.medida;if(e.medidasIncluidas){const a=Array.from(e.medidasIncluidas);o=`Mixta (${a.join(", ")})`}return[l(e.kilosCrudos),o,{text:`(${d(a)})`,style:t},...r?[{text:e.costoFinal?"$"+Number(e.costoFinal).toFixed(1):"",style:"costoStyle"}]:[]]})];return{table:{headerRows:1,widths:r?["*","*","*","*"]:["*","*","*"],body:s},layout:{hLineWidth:function(e,a){return 0===e||e===a.table.body.length?1.5:.5},vLineWidth:function(e,a){return 0===e||e===a.table.widths.length?1.5:.5},hLineColor:function(e,a){return 0===e||e===a.table.body.length?"#3760b0":"#cccccc"},vLineColor:function(e,a){return 0===e||e===a.table.widths.length?"#3760b0":"#cccccc"},fillColor:function(e,a,t){return e%2===0?"#f8f9fa":null},paddingLeft:function(e){return 4},paddingRight:function(e){return 4},paddingTop:function(e){return 2},paddingBottom:function(e){return 2}}}}function l(e){if("number"===typeof e)return(e%1===0?Math.floor(e):e.toFixed(1))+" kg";if("object"===typeof e&&null!==e){const a=(Number(e.medida1)||0)+(Number(e.medida2)||0);return(a%1===0?Math.floor(a):a.toFixed(1))+" kg"}const a=Number(e);return(a%1===0?Math.floor(a):a.toFixed(1))+" kg"}function d(e){return Number(e).toFixed(2)}function u(e){return new Promise((a,t)=>{const o=new Image;o.crossOrigin="Anonymous",o.onload=function(){const e=document.createElement("canvas");e.width=o.width,e.height=o.height;const t=e.getContext("2d");t.drawImage(o,0,0);const n=e.toDataURL("image/png");a(n)},o.onerror=t,o.src=e})}},f549:function(e,a,t){"use strict";t.d(a,"a",(function(){return c}));var o=t("be92"),n=t("dc59"),r=t("e1bd");const s=[{username:"allan",password:"noseno"},{username:"edgar",password:"noseno"}],c=Object(o["c"])("auth",{state:()=>({user:null,isAuthenticated:!1,userId:null}),actions:{async login(e,a){try{const t=s.find(t=>t.username===e&&t.password===a);if(t){const e=Object(r["a"])();return this.userId=e,this.user={username:t.username},this.isAuthenticated=!0,Object(n["b"])(e,t.username),localStorage.setItem("user",JSON.stringify({...this.user,userId:e})),!0}return!1}catch(t){return console.error("Error en login:",t),!1}},logout(){this.user=null,this.isAuthenticated=!1,this.userId=null,localStorage.removeItem("user")},checkAuth(){try{const e=localStorage.getItem("user");if(e){const a=JSON.parse(e);this.user={username:a.username},this.userId=a.userId,this.isAuthenticated=!0,this.userId&&Object(n["b"])(this.userId,a.username)}}catch(e){console.error("Error al verificar autenticación:",e),this.logout()}}},getters:{isLoggedIn:e=>e.isAuthenticated,currentUser:e=>e.user}})},fa1c:function(e,a,t){"use strict";var o=t("c1df"),n=t.n(o);t("898b");n.a.locale("es")},fa40:function(e,a,t){"use strict";t("d9e2"),t("14d9"),t("13d5");var o=t("1494");t("fa1c");const n=e=>{if(!e)return"";let a=e.toLowerCase();a=a.trim();const t=a.includes("c/c"),o=a.includes("s/c");let n="";return t?(n="c/c",a=a.replace(/c\/c|cc|conc/g,"").trim()):o&&(n="s/c",a=a.replace(/s\/c|sc|sinc/g,"").trim()),a=a.replace(/-/g," "),a.includes("med")&&(a.includes("gde")||a.includes("grande"))&&(a="med gde"),a.includes("med")&&(a.includes("ch")||a.includes("chica"))&&(a="med ch"),a.includes("med")&&(a.includes("esp")||a.includes("especial"))&&(a="med esp"),a.includes("med gde")||a.includes("med ch")||a.includes("med esp")||(a=a.replace(/\s+/g,"")),a=a.replace(/-/g,"/"),n&&(a=`${a} ${n}`),a=a.replace(/c\/c|cc|conc/g,"c/c"),a=a.replace(/s\/c|sc|sinc/g,"s/c"),a.includes("med gde")||a.includes("med ch")||a.includes("med esp")||(a=a.replace(/^medium$|^med$/g,"med")),a=a.replace(/^grande$|^gde$/g,"gde"),a=a.replace(/^especial$|^esp$/g,"esp"),a},r=(e,a,t=!1)=>{if(!e)return a;const o=e.toLowerCase().trim(),n=/^(\d+)-(\d+)$/.exec(o);if(n){const e=parseInt(n[1])||0,a=parseInt(n[2])||0,o=19!==a||t?a:20,r=e*o;return r}const r=o.includes("crudo");if(r&&/^\d+\*\d+(\+\d+)?$/.test(o)){const e=o.split(/[\*\+]/);if(e.length>=2){const a=parseInt(e[0])||0,t=parseInt(e[1])||0,o=19===t?20:t;let n=0;e.length>2&&(n=parseInt(e[2])||0);const r=a*o+n;return r}}return a},s=async(e,a)=>{try{const t=Object(o["h"])(),n=Object(o["c"])(t,e),r=Object(o["o"])(n,Object(o["s"])("fecha","<",a)),s=await Object(o["g"])(r);if(s.empty)return console.log("No se encontraron cuentas anteriores"),0;const c=s.docs.map(e=>{const a=e.data();return{id:e.id,fecha:a.fecha,nuevoSaldoAcumulado:a.nuevoSaldoAcumulado||0}}).sort((e,a)=>new Date(a.fecha)-new Date(e.fecha));return c.length>0?c[0].nuevoSaldoAcumulado:0}catch(t){return console.error("Error al obtener saldo acumulado anterior:",t),0}},c=async(e,a)=>{try{const t=Object(o["h"])(),n=Object(o["c"])(t,e),r=Object(o["o"])(n,Object(o["s"])("fecha","==",a)),s=await Object(o["g"])(r);return!s.empty}catch(t){throw console.error("Error al verificar si existe cuenta para la fecha:",t),t}},i=async e=>{try{const a=Object(o["h"])(),t=Object(o["c"])(a,"precios"),r=Object(o["o"])(t,Object(o["l"])("fecha","desc")),s=await Object(o["g"])(r),c=new Map,i=new Map,l=[];s.docs.forEach(a=>{const t=a.data(),o=t.producto,r=n(t.producto);l.push({original:o,normalizada:r,precio:t.precio,clienteId:t.clienteId||"general"}),t.clienteId===e?i.has(r)||i.set(r,t.precio):t.clienteId||c.has(r)||c.set(r,t.precio)}),console.log("=== Normalización de medidas para precios ==="),console.log("Medidas específicas para",e,":",Array.from(i.entries())),console.log("Medidas generales:",Array.from(c.entries())),console.log("Detalles de normalización:",l);const d=["Med c/c","Med-gde c/c","Med Gde c/c","MedGde c/c","Med-Esp c/c","Med Esp c/c"];console.log("=== Casos de prueba de normalización ==="),d.forEach(e=>{const a=n(e),t=i.get(a)||c.get(a)||0;console.log(`${e} -> ${a} -> Precio: ${t}`)});const u=new Map([...c,...i]);return u}catch(a){return console.error("Error al obtener precios de venta:",a),new Map}},l=e=>{if(!e)return 0;if(e.includes("-")){const a=e.split("-");if(2===a.length)return parseInt(a[1])||0}return parseInt(e)||0},d=(e,a={},t=new Map)=>{if(!e||!Array.isArray(e))return[];const o=new Map;return e.forEach(e=>{if(!e.medida)return;const a=n(e.medida);let s=0;if("c/h20"===e.tipo){const a=e.reporteTaras||[],t=e.reporteBolsas||[];for(let e=0;e<a.length;e++){const o=parseInt(a[e])||0,n=parseInt(t[e])||0;s+=o*n}s*=e.camaronNeto||.65}else if(s=Array.isArray(e.kilos)?e.kilos.reduce((e,a)=>e+(Number(a)||0),0):Number(e.kilos)||0,e.restarTaras){const a=(e.taras||[]).reduce((e,a)=>e+(Number(a)||0),0);s-=3*a}const c=e.precio||e.costo||0,i=t.get(a)||e.precioVenta||c,l=r(e.medida,s,!0);if(o.has(a)){const e=o.get(a);e.kilos+=l,e.costo=c,e.precioVenta=i,e.total=e.kilos*e.costo}else o.set(a,{kilos:l,medida:e.medida,costo:c,precioVenta:i,total:l*c})}),a&&Object.values(a).forEach(e=>{e.forEach(e=>{e.items&&Array.isArray(e.items)&&e.items.forEach(e=>{if(!e.talla)return;const a=e.talla,r=n(a);let s=0;if(e.taras){const a=e.taras.split("-");if(2===a.length){const e=parseInt(a[0])||0,t=parseInt(a[1])||0;s=e*t}else s=parseInt(e.taras)||0}let c=0;e.sobrante&&e.mostrarSobrante&&(c=l(e.sobrante));const i=a.toLowerCase().includes("med c/c")&&"10-19"===e.taras&&"1-10"===e.sobrante,d=i?200:s+c,u=e.precio||0,m=t.get(r)||e.precioVenta||u;if(o.has(r)){const a=o.get(r);a.kilos+=d,e.precio&&(a.costo=u,a.precioVenta=m),a.total=a.kilos*a.costo}else o.set(r,{kilos:d,medida:a,costo:u,precioVenta:m,total:d*u,esCrudo:!0})})})}),Array.from(o.values())},u=(e,a={},t=new Map)=>{if(!e||!Array.isArray(e))return[];const o=d(e,a,t),s=new Map;e.forEach(e=>{if(!e.medida)return;const a=n(e.medida);let o=0;if("c/h20"===e.tipo){const a=e.reporteTaras||[],t=e.reporteBolsas||[];for(let e=0;e<a.length;e++){const n=parseInt(a[e])||0,r=parseInt(t[e])||0;o+=n*r}o*=e.camaronNeto||.65}else if(o=Array.isArray(e.kilos)?e.kilos.reduce((e,a)=>e+(Number(a)||0),0):Number(e.kilos)||0,e.restarTaras){const a=(e.taras||[]).reduce((e,a)=>e+(Number(a)||0),0);o-=3*a}const c=t.get(a)||e.precioVenta||e.precio||0,i=r(e.medida,o,!1);if(s.has(a)){const e=s.get(a);e.kilosVenta+=i,e.precioVenta=c,e.totalVenta=e.kilosVenta*e.precioVenta}else s.set(a,{kilosVenta:i,medida:e.medida,precioVenta:c,totalVenta:i*c,ganancia:0})}),a&&Object.values(a).forEach(e=>{e.forEach(e=>{e.items&&Array.isArray(e.items)&&e.items.forEach(e=>{if(!e.talla)return;const a=e.talla,o=n(a);let r=0;if(e.taras){const a=e.taras.split("-");if(2===a.length){const e=parseInt(a[0])||0;let t=parseInt(a[1])||0;19===t&&(t=20),r=e*t}else r=parseInt(e.taras)||0}let c=0;e.sobrante&&e.mostrarSobrante&&(c=l(e.sobrante));const i=a.toLowerCase().includes("med c/c")&&"10-19"===e.taras&&"1-10"===e.sobrante,d=i?210:r+c,u=t.get(o)||e.precioVenta||e.precio||0;if(s.has(o)){const a=s.get(o);a.kilosVenta+=d,e.precio&&(a.precioVenta=u),a.totalVenta=a.kilosVenta*a.precioVenta}else s.set(o,{kilosVenta:d,medida:a,precioVenta:u,totalVenta:d*u,ganancia:0,esCrudo:!0})})})});const c=Array.from(s.values());return c.forEach(e=>{const a=o.find(a=>n(a.medida)===n(e.medida));a&&(e.ganancia=e.totalVenta-a.total)}),c},m=async e=>{const{fecha:a,productos:t,clienteCrudos:o}=e,n=o&&o["1"]||[],r=await i("joselito"),c=d(t,{1:n},r),l=u(t,{1:n},r),m=c.reduce((e,a)=>e+(a.total||0),0),p=l.reduce((e,a)=>e+(a.totalVenta||0),0),h=await s("cuentasJoselito",a);return{fecha:a,items:c,itemsVenta:l,saldoAcumuladoAnterior:h,cobros:[],abonos:[],totalGeneral:m,totalGeneralVenta:p,nuevoSaldoAcumulado:h+p,estadoPagado:!1,tieneObservacion:!1,observacion:"",ultimaActualizacion:(new Date).toISOString()}},p=async e=>{const{fecha:a,productos:t,clienteCrudos:o}=e,n=o&&o["2"]||[],r=await i("catarro"),c=d(t,{2:n},r),l=u(t,{2:n},r),m=c.reduce((e,a)=>e+(a.total||0),0),p=l.reduce((e,a)=>e+(a.totalVenta||0),0),h=await s("cuentasCatarro",a);return{fecha:a,items:c,itemsVenta:l,saldoAcumuladoAnterior:h,cobros:[],abonos:[],totalGeneral:m,totalGeneralVenta:p,nuevoSaldoAcumulado:h+p,estadoPagado:!1,tieneObservacion:!1,observacion:"",ultimaActualizacion:(new Date).toISOString()}},h=async e=>{const{fecha:a,productos:t,clienteCrudos:o}=e,n=o&&o["4"]||[],r=await i("ozuna"),c=f(t,{4:n},r),l=g(t,{4:n},r),d=c.reduce((e,a)=>e+(a.total||0),0),u=l.reduce((e,a)=>e+(a.totalVenta||0),0),m=await s("cuentasOzuna",a);return{fecha:a,items:c,itemsVenta:l,saldoAcumuladoAnterior:m,cobros:[],abonos:[],totalGeneral:d,totalGeneralVenta:u,nuevoSaldoAcumulado:m+u,estadoPagado:!1,tieneObservacion:!1,observacion:"",ultimaActualizacion:(new Date).toISOString()}},f=(e,a={},t=new Map)=>{if(!e||!Array.isArray(e))return[];const o=new Map;return e.forEach(e=>{if(!e||!e.medida)return;const a=n(e.medida||"");let s=0;if("c/h20"===e.tipo){const a=e.reporteTaras||[],t=e.reporteBolsas||[];for(let e=0;e<a.length;e++){const o=parseInt(a[e])||0,n=parseInt(t[e])||0;s+=o*n}s*=e.camaronNeto||.65}else if(s=Array.isArray(e.kilos)?e.kilos.reduce((e,a)=>e+(Number(a)||0),0):Number(e.kilos)||0,e.restarTaras){const a=(e.taras||[]).reduce((e,a)=>e+(Number(a)||0),0);s-=3*a}let c=0;e.esMaquila?c=20:(c=t.get(a)||e.precio||e.costo||0,0===c&&(c=60));const i=e.esMaquila?c:t.get(a)||e.precioVenta||c,l=r(e.medida||"",Math.max(0,s),!0),d=Boolean(e.esMaquila),u=(e.medida||"Sin medida")+(d?" (Maquila)":" (Venta)"),m=`${a}-${d?"maquila":"venta"}`;if(o.has(m)){const e=o.get(m);e.kilos+=l,e.total=e.kilos*e.costo}else o.set(m,{kilos:l,medida:u,costo:c,precioVenta:i,total:l*c,esMaquila:d})}),a&&Object.values(a).forEach(e=>{e&&Array.isArray(e)&&e.forEach(e=>{e&&e.items&&Array.isArray(e.items)&&e.items.forEach(e=>{if(!e||!e.talla)return;const a=e.talla||"",r=n(a);let s=0;if(e.taras){const a=String(e.taras).split("-");if(2===a.length){const e=parseInt(a[0])||0,t=parseInt(a[1])||0;s=e*t}else s=parseInt(e.taras)||0}let c=0;e.sobrante&&e.mostrarSobrante&&(c=l(String(e.sobrante)));const i=a.toLowerCase().includes("med c/c")&&"10-19"===e.taras&&"1-10"===e.sobrante,d=i?200:s+c,u=Boolean(e.esMaquila);let m=0;u?m=20:(m=t.get(r)||e.precio||0,0===m&&(m=60));const p=u?m:t.get(r)||e.precioVenta||m,h=a+(u?" (Maquila)":" (Venta)"),f=`${r}-${u?"maquila":"venta"}`;if(o.has(f)){const e=o.get(f);e.kilos+=d,e.total=e.kilos*e.costo}else o.set(f,{kilos:d,medida:h,costo:m,precioVenta:p,total:d*m,esCrudo:!0,esMaquila:u})})})}),Array.from(o.values())},g=(e,a={},t=new Map)=>{if(!e||!Array.isArray(e))return[];const o=f(e,a,t),s=new Map;e.forEach(e=>{if(!e||!e.medida)return;const a=n(e.medida||"");let o=0;if("c/h20"===e.tipo){const a=e.reporteTaras||[],t=e.reporteBolsas||[];for(let e=0;e<a.length;e++){const n=parseInt(a[e])||0,r=parseInt(t[e])||0;o+=n*r}o*=e.camaronNeto||.65}else if(o=Array.isArray(e.kilos)?e.kilos.reduce((e,a)=>e+(Number(a)||0),0):Number(e.kilos)||0,e.restarTaras){const a=(e.taras||[]).reduce((e,a)=>e+(Number(a)||0),0);o-=3*a}const c=Boolean(e.esMaquila);let i=0;c?i=20:(i=t.get(a)||e.precioVenta||e.precio||0,0===i&&(i=65));const l=r(e.medida||"",Math.max(0,o),!1),d=(e.medida||"Sin medida")+(c?" (Maquila)":" (Venta)"),u=`${a}-${c?"maquila":"venta"}`;if(s.has(u)){const e=s.get(u);e.kilosVenta+=l,e.totalVenta=e.kilosVenta*e.precioVenta}else s.set(u,{kilosVenta:l,medida:d,precioVenta:i,totalVenta:l*i,ganancia:0,esMaquila:c})}),a&&Object.values(a).forEach(e=>{e&&Array.isArray(e)&&e.forEach(e=>{e&&e.items&&Array.isArray(e.items)&&e.items.forEach(e=>{if(!e||!e.talla)return;const a=e.talla||"",o=n(a);let r=0;if(e.taras){const a=String(e.taras).split("-");if(2===a.length){const e=parseInt(a[0])||0;let t=parseInt(a[1])||0;19===t&&(t=20),r=e*t}else r=parseInt(e.taras)||0}let c=0;e.sobrante&&e.mostrarSobrante&&(c=l(String(e.sobrante)));const i=a.toLowerCase().includes("med c/c")&&"10-19"===e.taras&&"1-10"===e.sobrante,d=i?210:r+c,u=Boolean(e.esMaquila);let m=0;u?m=20:(m=t.get(o)||e.precioVenta||e.precio||0,0===m&&(m=65));const p=a+(u?" (Maquila)":" (Venta)"),h=`${o}-${u?"maquila":"venta"}`;if(s.has(h)){const e=s.get(h);e.kilosVenta+=d,e.totalVenta=e.kilosVenta*e.precioVenta}else s.set(h,{kilosVenta:d,medida:p,precioVenta:m,totalVenta:d*m,ganancia:0,esCrudo:!0,esMaquila:u})})})});const c=Array.from(s.values());return c.forEach(e=>{const a=o.find(a=>n(String(a.medida).replace(" (Maquila)","").replace(" (Venta)",""))===n(String(e.medida).replace(" (Maquila)","").replace(" (Venta)",""))&&a.esMaquila===e.esMaquila);e.ganancia=a?e.totalVenta-a.total:0}),c},b=e=>{if(Array.isArray(e))return e.map(e=>b(e));if(void 0===e)return null;if(null!==e&&"object"===typeof e){const a={};return Object.keys(e).forEach(t=>{const o=e[t];a[t]=void 0!==o?b(o):null}),a}return e},w=async(e,a)=>{try{console.log("Iniciando creación de cuenta Ozuna desde embarque");const t=await c("cuentasOzuna",e.fecha);if(t)throw new Error("Ya existe una cuenta de Ozuna registrada para esta fecha.");const n=await h(e),r=b(n),s=Object(o["h"])(),i=await Object(o["b"])(Object(o["c"])(s,"cuentasOzuna"),r);if(console.log("Cuenta de Ozuna creada con ID:",i.id),a){const e=`${window.location.origin}/#/cuentas-ozuna/${i.id}?edit=true`;window.open(e,"_blank")}return i.id}catch(t){throw console.error("Error al crear cuenta de Ozuna:",t),t}},y=async(e,a)=>{try{console.log("Iniciando creación de cuenta Joselito desde embarque");const t=await c("cuentasJoselito",e.fecha);if(t)throw new Error("Ya existe una cuenta de Joselito registrada para esta fecha.");const n=await m(e),r=b(n),s=Object(o["h"])(),i=await Object(o["b"])(Object(o["c"])(s,"cuentasJoselito"),r);if(console.log("Cuenta de Joselito creada con ID:",i.id),a){const e=`${window.location.origin}/#/cuentas-joselito/${i.id}?edit=true`;window.open(e,"_blank")}return i.id}catch(t){throw console.error("Error al crear cuenta de Joselito:",t),t}},v=async(e,a)=>{try{console.log("Iniciando creación de cuenta Catarro desde embarque");const t=await c("cuentasCatarro",e.fecha);if(t)throw new Error("Ya existe una cuenta de Catarro registrada para esta fecha.");const n=await p(e),r=b(n),s=Object(o["h"])(),i=await Object(o["b"])(Object(o["c"])(s,"cuentasCatarro"),r);if(console.log("Cuenta de Catarro creada con ID:",i.id),a){const e=`${window.location.origin}/#/cuentas-catarro/${i.id}?edit=true`;window.open(e,"_blank")}return i.id}catch(t){throw console.error("Error al crear cuenta de Catarro:",t),t}};a["a"]={crearCuentaJoselito:y,crearCuentaCatarro:v,crearCuentaOzuna:w}}}]);