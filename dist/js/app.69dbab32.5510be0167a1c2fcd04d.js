(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["app.69dbab32"],{3387:function(a,e,t){},"4dc0":function(a,e,t){"use strict";t.r(e);var i=function(){var a=this,e=a._self._c;return e("div",{staticClass:"rendimientos-container"},[e("div",{staticClass:"header-container"},[e("button",{staticClass:"btn-volver",on:{click:a.volverAEmbarque}},[e("i",{staticClass:"fas fa-arrow-left"}),a._v(" Volver al Embarque ")]),e("h2",[a._v("Rendimientos por Medida")]),e("button",{staticClass:"btn-nota",on:{click:a.abrirModalNota}},[e("i",{staticClass:"fas fa-sticky-note"}),a._v(" Agregar Nota ")]),e("button",{staticClass:"btn-costos",on:{click:a.irAGestionCostos}},[e("i",{staticClass:"fas fa-dollar-sign"}),a._v(" Gesti√≥n de Costos ")]),e("button",{staticClass:"btn-configuracion",on:{click:a.abrirModalConfiguracion}},[e("i",{staticClass:"fas fa-cog"}),a._v(" Configurar Pesos ")]),e("button",{staticClass:"btn-pdf",on:{click:a.generarPDF}},[e("i",{staticClass:"fas fa-file-pdf"}),a._v(" Generar PDF ")])]),a.embarqueData?e("div",{staticClass:"rendimientos-grid"},a._l(a.medidasUnicas,(function(t,i){var s;return e("div",{key:i,staticClass:"rendimiento-card"},[e("div",{staticClass:"medida-info"},[e("div",{staticClass:"medida-header"},[e("span",{staticClass:"medida-label editable-label",on:{click:function(e){return a.editarNombreMedida(t)}}},[a._v(" "+a._s(a.obtenerNombreMedidaPersonalizado(t))+" ")]),e("div",{staticClass:"controles-medida"},[e("div",{staticClass:"ocultar-control"},[e("input",{directives:[{name:"model",rawName:"v-model",value:a.medidaOculta[t],expression:"medidaOculta[medida]"}],attrs:{type:"checkbox",id:"ocultar-"+i},domProps:{checked:Array.isArray(a.medidaOculta[t])?a._i(a.medidaOculta[t],null)>-1:a.medidaOculta[t]},on:{change:[function(e){var i=a.medidaOculta[t],s=e.target,r=!!s.checked;if(Array.isArray(i)){var o=null,n=a._i(i,o);s.checked?n<0&&a.$set(a.medidaOculta,t,i.concat([o])):n>-1&&a.$set(a.medidaOculta,t,i.slice(0,n).concat(i.slice(n+1)))}else a.$set(a.medidaOculta,t,r)},a.guardarEstadoOculto]}}),e("label",{attrs:{for:"ocultar-"+i}},[a._v("Ocultar en PDF")])]),e("div",{staticClass:"analizar-ganancia-control"},[e("input",{directives:[{name:"model",rawName:"v-model",value:a.analizarGanancia[t],expression:"analizarGanancia[medida]"}],attrs:{type:"checkbox",id:"analizar-"+i},domProps:{checked:Array.isArray(a.analizarGanancia[t])?a._i(a.analizarGanancia[t],null)>-1:a.analizarGanancia[t]},on:{change:[function(e){var i=a.analizarGanancia[t],s=e.target,r=!!s.checked;if(Array.isArray(i)){var o=null,n=a._i(i,o);s.checked?n<0&&a.$set(a.analizarGanancia,t,i.concat([o])):n>-1&&a.$set(a.analizarGanancia,t,i.slice(0,n).concat(i.slice(n+1)))}else a.$set(a.analizarGanancia,t,r)},a.guardarEstadoAnalisis]}}),e("label",{attrs:{for:"analizar-"+i}},[a._v("Analizar ganancia")])]),e("div",{staticClass:"maquila-ganancia-control"},[e("input",{directives:[{name:"model",rawName:"v-model",value:a.analizarMaquilaGanancia[t],expression:"analizarMaquilaGanancia[medida]"}],attrs:{type:"checkbox",id:"maquila-"+i},domProps:{checked:Array.isArray(a.analizarMaquilaGanancia[t])?a._i(a.analizarMaquilaGanancia[t],null)>-1:a.analizarMaquilaGanancia[t]},on:{change:[function(e){var i=a.analizarMaquilaGanancia[t],s=e.target,r=!!s.checked;if(Array.isArray(i)){var o=null,n=a._i(i,o);s.checked?n<0&&a.$set(a.analizarMaquilaGanancia,t,i.concat([o])):n>-1&&a.$set(a.analizarMaquilaGanancia,t,i.slice(0,n).concat(i.slice(n+1)))}else a.$set(a.analizarMaquilaGanancia,t,r)},a.guardarEstadoAnalisis]}}),e("label",{attrs:{for:"maquila-"+i}},[a._v("Maquila ganancia")])]),a.analizarMaquilaGanancia[t]?e("div",{staticClass:"maquila-precio-input"},[e("input",{directives:[{name:"model",rawName:"v-model",value:a.precioMaquila[t],expression:"precioMaquila[medida]"}],staticClass:"precio-maquila-input",attrs:{type:"number",step:"0.01",placeholder:"Precio por kg"},domProps:{value:a.precioMaquila[t]},on:{input:[function(e){e.target.composing||a.$set(a.precioMaquila,t,e.target.value)},a.guardarEstadoAnalisis]}})]):a._e()])]),e("div",{staticClass:"input-group"},[a.esMedidaMix(t)?[e("div",{staticClass:"mix-inputs"},[e("div",{staticClass:"mix-input"},[e("label",{staticClass:"editable-label",on:{click:function(e){return a.editarEtiqueta(t,"medida1")}}},[a._v(" "+a._s(a.obtenerEtiqueta(t,"medida1"))+": ")]),e("input",{directives:[{name:"model",rawName:"v-model",value:a.kilosCrudos[t].medida1,expression:"kilosCrudos[medida].medida1"}],attrs:{type:"number",placeholder:"Kilos medida 1"},domProps:{value:a.kilosCrudos[t].medida1},on:{input:[function(e){e.target.composing||a.$set(a.kilosCrudos[t],"medida1",e.target.value)},function(e){return a.calcularRendimiento(t)}]}})]),e("div",{staticClass:"mix-input"},[e("label",{staticClass:"editable-label",on:{click:function(e){return a.editarEtiqueta(t,"medida2")}}},[a._v(" "+a._s(a.obtenerEtiqueta(t,"medida2"))+": ")]),e("input",{directives:[{name:"model",rawName:"v-model",value:a.kilosCrudos[t].medida2,expression:"kilosCrudos[medida].medida2"}],attrs:{type:"number",placeholder:"Kilos medida 2"},domProps:{value:a.kilosCrudos[t].medida2},on:{input:[function(e){e.target.composing||a.$set(a.kilosCrudos[t],"medida2",e.target.value)},function(e){return a.calcularRendimiento(t)}]}})])])]:[e("label",[a._v("Kilos en crudo:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:a.kilosCrudos[t],expression:"kilosCrudos[medida]"}],attrs:{type:"number",placeholder:"Ingrese kilos"},domProps:{value:a.kilosCrudos[t]},on:{input:[function(e){e.target.composing||a.$set(a.kilosCrudos,t,e.target.value)},function(e){return a.calcularRendimiento(t)}]}})]],2),e("div",{staticClass:"resultados"},[e("p",[a._v("Total embarcado: "+a._s(a.formatearNumero(a.obtenerTotalEmbarcado(t)))+" kg")]),e("p",{staticClass:"rendimiento"},[a._v(" Rendimiento: "),e("span",{class:{"rendimiento-alto":a.getRendimiento(t)>1}},[a._v(" "+a._s(a.getRendimiento(t).toFixed(2))+" ")])]),a.gananciasCalculadas[t]&&a.analizarGanancia[t]?e("div",{staticClass:"ganancia-info"},[a._m(0,!0),e("div",{staticClass:"ganancia-detalles"},[e("div",{staticClass:"ganancia-item"},[e("span",{staticClass:"label"},[a._v("Precio de Venta:")]),e("div",{staticClass:"precio-venta-container"},[e("span",{staticClass:"valor precio-venta"},[a._v("$"+a._s(a.formatearPrecio(a.gananciasCalculadas[t].precioVenta)))]),a.gananciasCalculadas[t].esPromedio?e("span",{staticClass:"precio-promedio-badge",attrs:{title:"Precio promedio ponderado. Clientes con precios espec√≠ficos: "+a.gananciasCalculadas[t].clientesConEspecifico.join(", ")}},[a._v(" üìä Promedio ")]):a.gananciasCalculadas[t].esEspecifico?e("span",{staticClass:"precio-especifico-badge",attrs:{title:"Precio espec√≠fico m√°s reciente para "+a.gananciasCalculadas[t].clienteEspecifico}},[a._v(" üìå "+a._s(a.gananciasCalculadas[t].clienteEspecifico)+" ")]):e("span",{staticClass:"precio-general-badge",attrs:{title:"Precio general"}},[a._v(" üåê General ")])])]),e("div",{staticClass:"ganancia-item"},[e("span",{staticClass:"label"},[a._v("Costo Final:")]),e("div",{staticClass:"costo-final-container"},[e("span",{staticClass:"valor costo-final"},[a._v("$"+a._s(a.formatearPrecio(a.gananciasCalculadas[t].costoFinal)))]),a.aplicarCostoExtra[t]?e("span",{staticClass:"costo-extra-indicator"},[a._v(" (+ $"+a._s((null===(s=a.embarqueData)||void 0===s?void 0:s.costoExtra)||18)+" extra) ")]):a._e()])]),e("div",{staticClass:"ganancia-item"},[e("span",{staticClass:"label"},[a._v("Ganancia/kg:")]),e("span",{staticClass:"valor ganancia-unitaria",class:{"ganancia-positiva":a.gananciasCalculadas[t].gananciaUnitaria>0,"ganancia-negativa":a.gananciasCalculadas[t].gananciaUnitaria<0}},[a._v(" $"+a._s(a.formatearPrecio(a.gananciasCalculadas[t].gananciaUnitaria))+" ")])]),e("div",{staticClass:"ganancia-item ganancia-total-item"},[e("span",{staticClass:"label"},[a._v("Ganancia Total:")]),e("span",{staticClass:"valor ganancia-total",class:{"ganancia-positiva":a.gananciasCalculadas[t].gananciaTotal>0,"ganancia-negativa":a.gananciasCalculadas[t].gananciaTotal<0}},[a._v(" $"+a._s(a.formatearPrecio(a.gananciasCalculadas[t].gananciaTotal))+" ")])]),e("div",{staticClass:"ganancia-fecha"},[e("span",{staticClass:"fecha-precio"},[a._v("Precio del: "+a._s(a.formatearFecha(a.gananciasCalculadas[t].fechaPrecio)))])])])]):a.analizarGanancia[t]?e("div",{staticClass:"sin-precio-venta"},[e("p",{staticClass:"aviso-sin-precio"},[a._v("‚ö†Ô∏è No se encontr√≥ precio de venta para esta medida")])]):a._e(),a.analizarMaquilaGanancia[t]?e("div",{staticClass:"maquila-ganancia-info"},[a._m(1,!0),e("div",{staticClass:"maquila-ganancia-detalles"},[e("div",{staticClass:"ganancia-item"},[e("span",{staticClass:"label"},[a._v("Kilos Embarcados:")]),e("span",{staticClass:"valor"},[a._v(a._s(a.formatearNumero(a.obtenerTotalEmbarcado(t)))+" kg")])]),e("div",{staticClass:"ganancia-item"},[e("span",{staticClass:"label"},[a._v("Precio Maquila:")]),e("span",{staticClass:"valor precio-maquila"},[a._v("$"+a._s(a.formatearPrecio(a.precioMaquila[t]||0)))])]),e("div",{staticClass:"ganancia-item ganancia-total-item"},[e("span",{staticClass:"label"},[a._v("Ganancia Total Maquila:")]),e("span",{staticClass:"valor ganancia-total ganancia-positiva"},[a._v(" $"+a._s(a.formatearPrecio(a.calcularGananciaMaquila(t)))+" ")])])])]):a._e()])])])})),0):e("div",[e("p",[a._v("Cargando datos del embarque...")])]),a.embarqueData&&a.obtenerTallasCrudosUnicas().length>0?e("div",{staticClass:"crudos-ganancias-section"},[e("h2",[a._v("üí∞ Ganancias de Crudos por Talla")]),e("div",{staticClass:"crudos-ganancias-grid"},a._l(a.obtenerTallasCrudosUnicas(),(function(t){return e("div",{key:"crudo-"+t,staticClass:"crudo-ganancia-card"},[e("div",{staticClass:"crudo-ganancia-header"},[e("h4",[a._v(a._s(t))]),e("div",{staticClass:"crudo-ganancia-controls"},[e("label",{staticClass:"checkbox-container"},[e("input",{directives:[{name:"model",rawName:"v-model",value:a.analizarGananciaCrudos[t],expression:"analizarGananciaCrudos[talla]"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(a.analizarGananciaCrudos[t])?a._i(a.analizarGananciaCrudos[t],null)>-1:a.analizarGananciaCrudos[t]},on:{change:[function(e){var i=a.analizarGananciaCrudos[t],s=e.target,r=!!s.checked;if(Array.isArray(i)){var o=null,n=a._i(i,o);s.checked?n<0&&a.$set(a.analizarGananciaCrudos,t,i.concat([o])):n>-1&&a.$set(a.analizarGananciaCrudos,t,i.slice(0,n).concat(i.slice(n+1)))}else a.$set(a.analizarGananciaCrudos,t,r)},a.guardarEstadoAnalisisCrudos]}}),e("span",{staticClass:"checkmark"}),a._v(" Analizar ganancia ")])])]),a.gananciasCalculadasCrudos[t]&&a.analizarGananciaCrudos[t]?e("div",{staticClass:"crudo-ganancia-info"},[e("div",{staticClass:"crudo-ganancia-detalles"},[e("div",{staticClass:"ganancia-item"},[e("span",{staticClass:"label"},[a._v("Total Kilos:")]),e("span",{staticClass:"valor"},[a._v(a._s(a.formatearNumero(a.gananciasCalculadasCrudos[t].totalKilos))+" kg")])]),e("div",{staticClass:"ganancia-item"},[e("span",{staticClass:"label"},[a._v("Precio Promedio:")]),e("div",{staticClass:"precio-container"},[e("span",{staticClass:"valor precio-venta"},[a._v("$"+a._s(a.formatearPrecio(a.gananciasCalculadasCrudos[t].precioVenta)))]),a.gananciasCalculadasCrudos[t].hayPreciosIndividuales?e("span",{staticClass:"precio-individual-badge",attrs:{title:"Incluye precios individuales"}},[a._v(" üìù Individual ")]):e("span",{staticClass:"precio-sistema-badge",attrs:{title:"Precio del sistema"}},[a._v(" üåê Sistema ")])])]),e("div",{staticClass:"ganancia-item"},[e("span",{staticClass:"label"},[a._v("Costo Base:")]),e("span",{staticClass:"valor costo-base"},[a._v("$"+a._s(a.formatearPrecio(a.gananciasCalculadasCrudos[t].costoBase)))])]),e("div",{staticClass:"ganancia-item"},[e("span",{staticClass:"label"},[a._v("Ganancia/kg:")]),e("span",{staticClass:"valor ganancia-unitaria",class:{"ganancia-positiva":a.gananciasCalculadasCrudos[t].gananciaUnitaria>0,"ganancia-negativa":a.gananciasCalculadasCrudos[t].gananciaUnitaria<0}},[a._v(" $"+a._s(a.formatearPrecio(a.gananciasCalculadasCrudos[t].gananciaUnitaria))+" ")])]),e("div",{staticClass:"ganancia-item ganancia-total-item"},[e("span",{staticClass:"label"},[a._v("Ganancia Total:")]),e("span",{staticClass:"valor ganancia-total",class:{"ganancia-positiva":a.gananciasCalculadasCrudos[t].gananciaTotal>0,"ganancia-negativa":a.gananciasCalculadasCrudos[t].gananciaTotal<0}},[a._v(" $"+a._s(a.formatearPrecio(a.gananciasCalculadasCrudos[t].gananciaTotal))+" ")])]),a.deberMostrarDetallePorCliente(t)?e("div",{staticClass:"detalles-clientes"},[e("h5",[a._v("Detalle por Cliente:")]),a._l(a.gananciasCalculadasCrudos[t].detallesPorCliente,(function(t){return e("div",{key:t.cliente,staticClass:"detalle-cliente"},[e("span",{staticClass:"cliente-nombre"},[a._v(a._s(t.cliente)+":")]),e("span",{staticClass:"cliente-kilos"},[a._v(a._s(a.formatearNumero(t.kilos))+"kg")]),e("span",{staticClass:"cliente-precio"},[a._v("$"+a._s(a.formatearPrecio(t.precioVenta)))]),e("span",{staticClass:"cliente-ganancia",class:{"ganancia-positiva":t.gananciaTotal>0,"ganancia-negativa":t.gananciaTotal<0}},[a._v(" $"+a._s(a.formatearPrecio(t.gananciaTotal))+" ")]),e("span",{staticClass:"fuente-precio",attrs:{title:"Fuente del precio: "+t.fuentePrecio}},[a._v(" "+a._s("individual"===t.fuentePrecio?"üìù":"sistema-especifico"===t.fuentePrecio?"üìå":"üåê")+" ")])])}))],2):a._e()])]):a.analizarGananciaCrudos[t]?e("div",{staticClass:"sin-datos-crudo"},[e("p",{staticClass:"aviso-sin-datos"},[a._v("‚ö†Ô∏è No se encontraron datos de venta para esta talla")])]):e("div",{staticClass:"sin-analisis-crudo"},[e("p",{staticClass:"aviso-sin-analisis"},[a._v("Activar an√°lisis de ganancia para ver detalles")])])])})),0)]):a._e(),a.mostrarModal?e("div",{staticClass:"modal-overlay"},[e("div",{staticClass:"modal-content"},[e("h3",[a._v("Agregar Nota")]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:a.nota,expression:"nota"}],attrs:{placeholder:"Escriba su nota aqu√≠...",rows:"4"},domProps:{value:a.nota},on:{input:function(e){e.target.composing||(a.nota=e.target.value)}}}),e("div",{staticClass:"modal-buttons"},[e("button",{staticClass:"btn-guardar",on:{click:a.guardarNota}},[a._v("Guardar")]),e("button",{staticClass:"btn-cancelar",on:{click:a.cerrarModal}},[a._v("Cancelar")])])])]):a._e(),a.mostrarModalConfiguracion?e("div",{staticClass:"modal-overlay"},[e("div",{staticClass:"modal-content"},[e("h3",[a._v("Configurar Pesos de Taras")]),e("div",{staticClass:"configuracion-grid"},[e("div",{staticClass:"config-item"},[e("label",[a._v("Peso para c√°lculo de costos:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:a.pesoTaraCosto,expression:"pesoTaraCosto"}],attrs:{type:"number",min:"1",max:"50",placeholder:"Peso en kg"},domProps:{value:a.pesoTaraCosto},on:{input:function(e){e.target.composing||(a.pesoTaraCosto=e.target.value)}}}),e("small",{staticClass:"config-help"},[a._v("Peso por defecto usado para calcular costos de crudos")])]),e("div",{staticClass:"config-item"},[e("label",[a._v("Peso para c√°lculo de ventas:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:a.pesoTaraVenta,expression:"pesoTaraVenta"}],attrs:{type:"number",min:"1",max:"50",placeholder:"Peso en kg"},domProps:{value:a.pesoTaraVenta},on:{input:function(e){e.target.composing||(a.pesoTaraVenta=e.target.value)}}}),e("small",{staticClass:"config-help"},[a._v("Peso por defecto usado para calcular ventas de crudos")])])]),e("div",{staticClass:"modal-buttons"},[e("button",{staticClass:"btn-guardar",on:{click:a.guardarConfiguracion}},[a._v("Guardar")]),e("button",{staticClass:"btn-cancelar",on:{click:a.cerrarModalConfiguracion}},[a._v("Cancelar")])])])]):a._e()])},s=[function(){var a=this,e=a._self._c;return e("div",{staticClass:"ganancia-header"},[e("h4",[a._v("üí∞ An√°lisis de Ganancia")])])},function(){var a=this,e=a._self._c;return e("div",{staticClass:"maquila-ganancia-header"},[e("h4",[a._v("üè≠ Maquila Ganancia")])])}],r=(t("14d9"),t("13d5"),t("88e6"),t("70cc"),t("eb03"),t("22e5c"),t("c01e"),t("fa76"),t("8306"),t("1494")),o=t("2ef0"),n=t("6d4d"),c={name:"Rendimientos",data(){return{kilosCrudos:{},medidasUnicas:[],embarqueData:null,guardadoAutomaticoActivo:!1,nombresMedidasPersonalizados:{},mostrarModal:!1,nota:"",medidaOculta:{},preciosVenta:{},gananciasCalculadas:{},gananciasCalculadasCrudos:{},analizarGanancia:{},analizarGananciaCrudos:{},aplicarCostoExtra:{},diasRecientes:3,pesoTaraCosto:19,pesoTaraVenta:20,mostrarModalConfiguracion:!1,analizarMaquilaGanancia:{},precioMaquila:{}}},async created(){await this.cargarEmbarque(),await this.cargarPreciosVenta(),this.guardarCambiosEnTiempoReal=Object(o["debounce"])(this.guardarCambiosEnTiempoReal,300)},async activated(){console.log("Recargando datos de rendimientos..."),await this.cargarEmbarque(),await this.cargarPreciosVenta(),this.$nextTick(()=>{this.calcularGanancias()})},methods:{obtenerNombreCliente(a){if(!this.embarqueData||!this.embarqueData.clientes)return"";const e=this.embarqueData.clientes.find(e=>e.id.toString()===a.toString());return e?e.nombre:""},calcularTarasCrudosPorMedida(){if(!this.embarqueData||!this.embarqueData.clientes)return{};const a={};return this.embarqueData.clientes.forEach(e=>{e.crudos&&Array.isArray(e.crudos)&&e.crudos.forEach(t=>{t&&t.items&&Array.isArray(t.items)&&t.items.forEach(t=>{if(t.talla){const i="Ozuna"!==e.nombre||t.esVenta;if(i){const i=t.talla;a[i]||(a[i]={totalTaras:0,totalKilos:0,detalles:[]});let s=0,r=0;if(t.taras){const a=/^(\d+)-(\d+)$/.exec(t.taras);if(a){const e=parseInt(a[1])||0;let t=parseInt(a[2])||0;19===t&&(t=this.pesoTaraCosto),s+=e,r+=e*t}else{const[a,e]=t.taras.split("-").map(Number);s+=a||0,r+=(a||0)*(e||0)}}if(t.sobrante){const a=/^(\d+)-(\d+)$/.exec(t.sobrante);if(a){const e=parseInt(a[1])||0;let t=parseInt(a[2])||0;19===t&&(t=this.pesoTaraCosto),s+=e,r+=e*t}else{const[a,e]=t.sobrante.split("-").map(Number);s+=a||0,r+=(a||0)*(e||0)}}a[i].totalTaras+=s,a[i].totalKilos+=r,s>0&&a[i].detalles.push({cliente:e.nombre,taras:t.taras,sobrante:t.sobrante,tarasCalculadas:s,kilosCalculados:r})}}})})}),a},calcularCostosCrudos(a){if(!a||!this.embarqueData)return{};const e={},t=this.embarqueData.costosPorMedida||{},i=Object.keys(a);return i.forEach(a=>{const i=Number(t[a])||0,s=i+3.5;e[a]={costoBase:i,costoFinal:s}}),e},obtenerClienteIdParaPrecios(a){const e=a.toLowerCase();return e.includes("joselito")?"joselito":e.includes("catarro")?"catarro":e.includes("otilio")?"otilio":e.includes("ozuna")?"ozuna":null},async cargarEmbarque(){try{const a=Object(r["h"])(),e=this.$route.params.id,t=Object(r["e"])(a,"embarques",e),i=await Object(r["f"])(t);if(i.exists()){this.embarqueData=i.data(),this.nombresMedidasPersonalizados=this.embarqueData.nombresMedidasPersonalizados||{},this.obtenerMedidasUnicas(),this.medidaOculta=this.embarqueData.medidaOculta||{},this.analizarGanancia=this.embarqueData.analizarGanancia||{},this.analizarGananciaCrudos=this.embarqueData.analizarGananciaCrudos||{},this.aplicarCostoExtra=this.embarqueData.aplicarCostoExtra||{},this.analizarMaquilaGanancia=this.embarqueData.analizarMaquilaGanancia||{},this.precioMaquila=this.embarqueData.precioMaquila||{},this.pesoTaraCosto=this.embarqueData.pesoTaraCosto||19,this.pesoTaraVenta=this.embarqueData.pesoTaraVenta||20;const a=this.embarqueData.kilosCrudos||{};this.kilosCrudos={...a},this.medidasUnicas.forEach(a=>{this.kilosCrudos[a]||(this.esMedidaMix(a)?this.$set(this.kilosCrudos,a,{medida1:0,medida2:0,etiqueta1:"Kilos en crudo (Medida 1)",etiqueta2:"Kilos en crudo (Medida 2)"}):this.$set(this.kilosCrudos,a,0))}),this.guardadoAutomaticoActivo=!0,Object.keys(this.preciosVenta).length>0&&this.calcularGanancias()}else console.error("No se encontr√≥ el embarque")}catch(a){console.error("Error al cargar el embarque:",a)}},async cargarPreciosVenta(){try{const a=Object(r["h"])(),e=Object(r["c"])(a,"precios"),t=Object(r["o"])(e,Object(r["l"])("fecha","desc")),i=await Object(r["g"])(t),s=new Map;i.docs.forEach(a=>{const e={id:a.id,...a.data()},t=e.producto.toLowerCase().trim();s.has(t)||s.set(t,[]),s.get(t).push(e)});const o={};s.forEach((a,e)=>{const t=a.sort((a,e)=>new Date(e.fecha)-new Date(a.fecha));o[e]=t}),this.preciosVenta=o,this.embarqueData&&this.calcularGanancias()}catch(a){console.error("Error al cargar precios de venta:",a)}},encontrarPreciosParaMedida(a){let e=this.preciosVenta[a.toLowerCase().trim()];if(e&&e.length>0)return{medidaEncontrada:a,precios:e};const t=a.toLowerCase().trim().replace(" maquila ozuna","").replace(/\s+(vayon|ahumada|sin\s+cal|cal|c\/c|crudo|limpio).*$/g,"").trim();if(e=this.preciosVenta[t],e&&e.length>0)return{medidaEncontrada:t,precios:e};const i=t.replace(/-/g," "),s=t.replace(/ /g,"-");if(e=this.preciosVenta[i],e&&e.length>0)return{medidaEncontrada:i,precios:e};if(e=this.preciosVenta[s],e&&e.length>0)return{medidaEncontrada:s,precios:e};const r=t.toLowerCase();for(const[o,n]of Object.entries(this.preciosVenta)){const a=o.toLowerCase().trim();if(r.includes(a)&&a.length>2)return{medidaEncontrada:o,precios:n};if(a.includes(r)&&r.length>2)return{medidaEncontrada:o,precios:n}}return null},obtenerPrecioVentaParaFecha(a,e,t=null){const i=this.encontrarPreciosParaMedida(a);if(!i)return console.log(`[${a}] No se encontraron precios para ninguna variaci√≥n`),console.log(`[${a}] Precios disponibles:`,Object.keys(this.preciosVenta)),null;const{medidaEncontrada:s,precios:r}=i;s!==a&&console.log(`[${a}] Precio encontrado como: ${s}`);const o=new Date(e).toISOString().split("T")[0],n=new Date(o),c=(new Date).toISOString().split("T")[0],l=new Date(c),d=Math.floor((l-n)/864e5),u=d<=this.diasRecientes,m=o>=c,h=u||m;if(r&&0!==r.length||console.log(`[${a}] ‚ö†Ô∏è No se encontraron precios disponibles`),h){let a="";if(m?a="(embarque de hoy/futuro)":u&&(a=`(embarque reciente: hace ${d} d√≠a${1!==d?"s":""})`),t){const a=r.find(a=>a.clienteId===t);if(a)return a}const e=r.find(a=>!a.clienteId);if(e)return e}else{if(t)for(const a of r){const e=new Date(a.fecha).toISOString().split("T")[0];if(e<=o&&a.clienteId===t)return a}for(const a of r){const e=new Date(a.fecha).toISOString().split("T")[0];if(e<=o&&!a.clienteId)return a}}const p=r.filter(a=>!a.clienteId);return p.length>0?p[p.length-1]:r[r.length-1]},calcularCostoFinal(a){var e,t;const i=(null===(e=this.embarqueData)||void 0===e?void 0:e.costosPorMedida)||{},s=Number(i[a])||0,r=this.getRendimiento(a),o=Math.round(100*r)/100,n=Number(null===(t=this.embarqueData)||void 0===t?void 0:t.costoExtra)||18,c=this.aplicarCostoExtra[a]||!1;return c?Math.round(s*o+n):Math.round(s*o)},calcularGanancias(){if(!this.embarqueData)return;const a=this.embarqueData.fecha||(new Date).toISOString().split("T")[0],e={};this.medidasUnicas.forEach(t=>{var i;if(!this.analizarGanancia[t])return;const s=this.calcularCostoFinal(t),r=(null===(i=this.embarqueData)||void 0===i?void 0:i.costosPorMedida)||{},o=Number(r[t])||0,n=this.obtenerClientesConMedida(t),c=this.calcularPrecioYGanancias(t,a,n,s,o);c&&(e[t]=c)}),this.gananciasCalculadas=e,this.calcularGananciasCrudos()},calcularPrecioYGanancias(a,e,t,i,s){var r;let o=[],n=0,c=0,l=0;const d=this.obtenerPrecioVentaParaFecha(a,e,null),u=d?new Date(d.fecha):null;if(t.forEach(({cliente:t,totalEmbarcado:s})=>{const r=this.obtenerClienteIdParaPrecios(t.nombre),m=this.obtenerPrecioVentaParaFecha(a,e,r);let h=d,p=!1;if(m&&m.clienteId){const a=new Date(m.fecha);(!u||a>u)&&(h=m,p=!0)}if(h){const a=Math.round(h.precio),e=Math.round(a-i),r=Math.round(e*s);o.push({cliente:t.nombre,precioVenta:a,totalEmbarcado:s,gananciaUnitaria:e,gananciaTotal:r,fechaPrecio:h.fecha,esEspecifico:p,clienteId:h.clienteId||null}),n+=s,c+=r,l+=a*s}}),0===o.length)return null;const m=n>0?Math.round(l/n):0,h=o.filter(a=>a.esEspecifico),p=new Set(o.map(a=>a.precioVenta)),C=p.size>1,b=1===o.length;console.log(`[${a}] C√°lculo de precios:`,{fechaEmbarque:e,precioGeneral:d?{precio:d.precio,fecha:d.fecha,clienteId:d.clienteId}:null,fechaGeneral:null===d||void 0===d?void 0:d.fecha,clientesConEspecifico:h.map(a=>({cliente:a.cliente,precio:a.precioVenta,fecha:a.fechaPrecio,clienteId:a.clienteId})),precioPromedio:m,tieneMultiplesPrecios:C,soloUnCliente:b,totalClientes:o.length,detallesPorCliente:o.map(a=>({cliente:a.cliente,precio:a.precioVenta,fecha:a.fechaPrecio,esEspecifico:a.esEspecifico}))});let g={esPromedio:C,esEspecifico:!1,clienteEspecifico:null,clientesConEspecifico:h.map(a=>a.cliente),fechaMasReciente:o.reduce((a,e)=>{const t=new Date(e.fechaPrecio);return!a||t>a?t:a},null)};return 1===h.length&&b&&(g.esEspecifico=!0,g.esPromedio=!1,g.clienteEspecifico=h[0].cliente),{precioVenta:m,costoFinal:Math.round(i),costoBase:Math.round(s||0),gananciaUnitaria:Math.round(m-i),gananciaTotal:c,totalEmbarcado:Math.round(n),fechaPrecio:null===(r=g.fechaMasReciente)||void 0===r?void 0:r.toISOString().split("T")[0],esPromedio:g.esPromedio,esEspecifico:g.esEspecifico,clienteEspecifico:g.clienteEspecifico,clientesConEspecifico:g.clientesConEspecifico,detallesPorCliente:o}},obtenerTallasCrudosUnicas(){if(!this.embarqueData||!this.embarqueData.clientes)return[];const a=new Set;return this.embarqueData.clientes.forEach(e=>{e.crudos&&Array.isArray(e.crudos)&&e.crudos.forEach((t,i)=>{t&&t.items&&Array.isArray(t.items)&&t.items.forEach((t,i)=>{if(t.talla){const i="Ozuna"!==e.nombre||t.esVenta;i?(a.add(t.talla)):0}})})}),Array.from(a).sort()},calcularGananciasCrudos(){if(!this.embarqueData)return;const a=this.embarqueData.fecha||(new Date).toISOString().split("T")[0],e={},t=this.obtenerTallasCrudosUnicas();t.forEach(t=>{if(!this.analizarGananciaCrudos[t])return;const i=this.calcularGananciasPorTallaCrudo(t,a);i&&(e[t]=i)}),this.gananciasCalculadasCrudos=e},calcularGananciasPorTallaCrudo(a,e){var t;if(!this.embarqueData||!this.embarqueData.clientes)return null;let i=0,s=0,r=[],o=!1;const n=this.calcularCostoCrudoPorTalla(a),c=n+3.5,l=this.calcularTarasCrudosPorMedida(),d=(null===(t=l[a])||void 0===t?void 0:t.totalKilos)||0;if(this.embarqueData.clientes.forEach(t=>{t.crudos&&Array.isArray(t.crudos)&&t.crudos.forEach(n=>{n&&n.items&&Array.isArray(n.items)&&n.items.forEach(n=>{if(n.talla===a){const c="Ozuna"!==t.nombre||n.esVenta;if(c){const c=this.calcularKilosCrudosItem(n);i+=c;let l=null,d="";if(n.precio&&n.precio>0)l=n.precio,d="individual",o=!0;else{const i=this.obtenerClienteIdParaPrecios(t.nombre),s=this.obtenerPrecioVentaParaFecha(a,e,i);s&&(l=s.precio,d=s.clienteId?"sistema-especifico":"sistema-general")}l&&c>0&&(s+=l*c,r.push({cliente:t.nombre,kilos:c,precioVenta:l,gananciaUnitaria:0,gananciaTotal:0,fuentePrecio:d,taras:n.taras,sobrante:n.sobrante}))}}})})}),0===i)return null;const u=c*d,m=s-u,h=i>0?s/i:0,p=i>0?m/i:0;r.forEach(a=>{a.gananciaUnitaria=p,a.gananciaTotal=a.gananciaUnitaria*a.kilos});const C={talla:a,totalKilos:Math.round(i),totalKilosCosto:Math.round(d),precioVenta:Math.round(h),costoBase:c,costoTotal:Math.round(u),gananciaUnitaria:Math.round(p),gananciaTotal:Math.round(m),hayPreciosIndividuales:o,detallesPorCliente:r,fechaCalculo:(new Date).toISOString().split("T")[0]};return C},calcularCostoCrudoPorTalla(a){var e;const t=(null===(e=this.embarqueData)||void 0===e?void 0:e.costosPorMedida)||{};let i=Number(t[a])||0,s=a;if(0===i){const e=a.toLowerCase();for(const[a,r]of Object.entries(t))if(a.toLowerCase()===e){i=Number(r)||0,s=a;break}}if(0===i&&(!this.embarqueData.costosPorMedida||0===Object.keys(this.embarqueData.costosPorMedida).length)){var r;console.log(`‚ö†Ô∏è No se encontr√≥ costo para talla ${a}. Inicializando costosPorMedida autom√°ticamente.`),this.inicializarCostosPorMedida();const e=(null===(r=this.embarqueData)||void 0===r?void 0:r.costosPorMedida)||{};if(i=Number(e[a])||0,0===i){const t=a.toLowerCase();for(const[a,r]of Object.entries(e))if(a.toLowerCase()===t){i=Number(r)||0,s=a;break}}}return console.log(`üîç DEBUG - Calculando costo para talla ${a}:`,{tallaBuscada:a,medidaEncontrada:s,costosDisponibles:Object.keys(t),costoEncontrado:t[s],costoCalculado:i,esCrudo:a.includes("c/c"),busquedaCaseInsensitive:a!==s}),i},calcularKilosCrudosItem(a){let e=0,t={talla:a.talla,taras:a.taras,sobrante:a.sobrante,kilosDeTaras:0,kilosDeSobrante:0};if(a.taras){const i=/^(\d+)-(\d+)$/.exec(a.taras);if(i){const a=parseInt(i[1])||0;let s=parseInt(i[2])||0;19===s&&(s=this.pesoTaraVenta),t.kilosDeTaras=a*s,e+=t.kilosDeTaras}else{const[i,s]=a.taras.split("-").map(Number);t.kilosDeTaras=(i||0)*(s||0),e+=t.kilosDeTaras}}if(a.sobrante){const i=/^(\d+)-(\d+)$/.exec(a.sobrante);if(i){const a=parseInt(i[1])||0;let s=parseInt(i[2])||0;19===s&&(s=this.pesoTaraVenta),t.kilosDeSobrante=a*s,e+=t.kilosDeSobrante}else{const[i,s]=a.sobrante.split("-").map(Number);t.kilosDeSobrante=(i||0)*(s||0),e+=t.kilosDeSobrante}}return t.kilosTotales=e,e},async guardarEstadoAnalisisCrudos(){try{const a=Object(r["h"])(),e=this.$route.params.id,t=Object(r["e"])(a,"embarques",e);await Object(r["r"])(t,{analizarGananciaCrudos:this.analizarGananciaCrudos}),console.log("Estado de an√°lisis de ganancia de crudos guardado correctamente")}catch(a){console.error("Error al guardar estado de an√°lisis de crudos:",a)}},async inicializarCostosPorMedida(){try{var a;const e=Object(r["h"])(),t=Object(r["c"])(e,"historial_costos"),i=await Object(r["g"])(t),s=[];i.forEach(a=>{const e=a.data();s.push({...e,id:a.id})}),s.sort((a,e)=>{var t,i,s,r;const o=(null===(t=a.timestamp)||void 0===t||null===(i=t.toDate)||void 0===i?void 0:i.call(t))||new Date(a.timestamp),n=(null===(s=e.timestamp)||void 0===s||null===(r=s.toDate)||void 0===r?void 0:r.call(s))||new Date(e.timestamp);return n-o});const o={},n=new Set;s.forEach(a=>{n.has(a.medida)||(a.eliminado||a.medidaEliminada||(o[a.medida]={costoBase:a.costoBase,fecha:a.fecha,timestamp:a.timestamp,id:a.id}),n.add(a.medida))});const c=(null===(a=this.embarqueData)||void 0===a?void 0:a.costosPorMedida)||{};let l=!1;const d=this.obtenerTallasCrudosUnicas();if(d.forEach(a=>{let e=null;if(o[a])e=o[a];else{const t=a.toLowerCase();for(const[a,i]of Object.entries(o))if(a.toLowerCase()===t){e=i;break}}e&&!c[a]&&(c[a]=e.costoBase,l=!0,console.log(`üí∞ Aplicando costo autom√°tico para ${a}: $${e.costoBase}`))}),l){this.embarqueData.costosPorMedida||(this.embarqueData.costosPorMedida={}),Object.assign(this.embarqueData.costosPorMedida,c);const a=this.$route.params.id,t=Object(r["e"])(e,"embarques",a);await Object(r["r"])(t,{costosPorMedida:c}),console.log("‚úÖ Costos inicializados y guardados autom√°ticamente")}}catch(e){console.error("Error al inicializar costos por medida:",e)}},obtenerNombreClienteDeId(a){const e={joselito:"Joselito",catarro:"Catarro",otilio:"Otilio",ozuna:"Ozuna"};return e[a]||a},obtenerClientesConMedida(a){if(!this.embarqueData||!this.embarqueData.clientes)return[];const e=[],t=a.includes("Maquila Ozuna"),i=a.replace(" Maquila Ozuna","").toLowerCase().trim();return this.embarqueData.clientes.forEach(a=>{let s=0;a.productos.forEach(e=>{if(!e.medida)return;let r=!1;if(r=t?e.medida.toLowerCase().trim()===i&&"Ozuna"===a.nombre&&!e.esVenta:e.medida.toLowerCase().trim()===i&&("Ozuna"!==a.nombre||e.esVenta),r&&!e.refrigerar)if("c/h20"===e.tipo){const a=this.calcularTotalBolsas(e),t=parseFloat(e.camaronNeto)||.65;s+=a*t}else{const a=e.kilos.reduce((a,e)=>a+(Number(e)||0),0),t=this.calcularTotalTaras(e),i=e.restarTaras?3*t:0;s+=a-i}}),s>0&&e.push({cliente:a,totalEmbarcado:s})}),e},async guardarCambiosEnTiempoReal(){if(this.guardadoAutomaticoActivo)try{const a=Object(r["h"])(),e=this.$route.params.id,t=Object(r["e"])(a,"embarques",e);await Object(r["r"])(t,{kilosCrudos:this.kilosCrudos,medidaOculta:this.medidaOculta,analizarGanancia:this.analizarGanancia,analizarGananciaCrudos:this.analizarGananciaCrudos,analizarMaquilaGanancia:this.analizarMaquilaGanancia,precioMaquila:this.precioMaquila}),console.log("Rendimientos guardados:",this.kilosCrudos)}catch(a){console.error("Error al guardar los rendimientos:",a)}},obtenerMedidasUnicas(){if(!this.embarqueData||!this.embarqueData.clientes)return;const a=new Map,e=new Map;this.embarqueData.clientes.forEach(t=>{t.productos.forEach(i=>{if(i.medida){const s=i.medida.toLowerCase().trim();let r=i.medida;if("Ozuna"!==t.nombre||i.esVenta||(r=i.medida+" Maquila Ozuna"),s.endsWith("mix")){const a=s.split(" ")[0];e.set(a,r)}else a.has(r)||a.set(r,r)}})});const t=Array.from(e.keys()).sort();if(t.length>=2)for(let i=0;i<t.length;i+=2)if(i+1<t.length){const e=`${t[i]}-${t[i+1]} mix`;a.set(e,e),this.kilosCrudos[e]||this.$set(this.kilosCrudos,e,{medida1:0,medida2:0,etiqueta1:`Kilos en crudo (${t[i]})`,etiqueta2:`Kilos en crudo (${t[i+1]})`})}this.medidasUnicas=Array.from(a.values())},obtenerTotalEmbarcado(a){if(!this.embarqueData||!this.embarqueData.clientes)return 0;if(a.includes("-")&&a.endsWith("mix")){const[e,t]=a.split("-").map(a=>a.trim()),i=this.calcularTotalParaMedida(e+" mix"),s=this.calcularTotalParaMedida(t.replace(" mix","")+" mix");return i+s}return this.calcularTotalParaMedida(a)},calcularTotalParaMedida(a){const e=a.includes("Maquila Ozuna"),t=a.replace(" Maquila Ozuna","").toLowerCase().trim();return this.embarqueData.clientes.reduce((a,i)=>a+i.productos.filter(a=>!!a.medida&&(e?a.medida.toLowerCase().trim()===t&&"Ozuna"===i.nombre&&!a.esVenta:a.medida.toLowerCase().trim()===t&&("Ozuna"!==i.nombre||a.esVenta))).reduce((a,e)=>{if("c/h20"===e.tipo){const t=this.calcularTotalBolsas(e),i=parseFloat(e.camaronNeto)||.65;return a+t*i}{const t=e.kilos.reduce((a,e)=>a+(Number(e)||0),0),i=this.calcularTotalTaras(e),s=e.restarTaras?3*i:0;return a+(t-s)}},0),0)},obtenerTotalParaRendimiento(a){if(!this.embarqueData||!this.embarqueData.clientes)return 0;const e=a.toLowerCase(),t=this.embarqueData.clientes.flatMap(a=>a.productos.filter(a=>a.medida&&a.medida.toLowerCase()===e)),i=t.some(a=>"c/h20"===a.tipo);return i?this.obtenerTotalEmbarcado(a):this.obtenerTotalReal(a)},obtenerTotalReal(a){if(!this.embarqueData||!this.embarqueData.clientes)return 0;const e=a.includes("Maquila Ozuna"),t=a.replace(" Maquila Ozuna","").toLowerCase().trim();return this.embarqueData.clientes.reduce((a,i)=>a+i.productos.filter(a=>!!a.medida&&(e?a.medida.toLowerCase().trim()===t&&"Ozuna"===i.nombre&&!a.esVenta:a.medida.toLowerCase().trim()===t&&("Ozuna"!==i.nombre||a.esVenta))).reduce((a,e)=>a+this.calcularTotalKilos(e),0),0)},calcularTotalKilos(a){if(!a.kilos)return 0;const e=a.kilos.reduce((a,e)=>a+(Number(e)||0),0),t=(a.taras||[]).reduce((a,e)=>a+(Number(e)||0),0),i=a.restarTaras?3*t:0;return e-i},calcularTotalTaras(a){const e=(a.taras||[]).reduce((a,e)=>a+(Number(e)||0),0),t=(a.tarasExtra||[]).reduce((a,e)=>a+(Number(e)||0),0);return e+t},calcularTotalBolsas(a){const e=a.reporteTaras||[],t=a.reporteBolsas||[];let i=0;for(let s=0;s<e.length;s++){const a=parseInt(e[s])||0,r=parseInt(t[s])||0;i+=a*r}return i},calcularRendimiento(a){const e=this.obtenerTotalEmbarcado(a);if(0===e)return 0;let t;var i,s;this.esMedidaMix(a)?t=Number((null===(i=this.kilosCrudos[a])||void 0===i?void 0:i.medida1)||0)+Number((null===(s=this.kilosCrudos[a])||void 0===s?void 0:s.medida2)||0):t=Number(this.kilosCrudos[a]||0);const r=t/e;return this.guardarCambiosEnTiempoReal(),r},getRendimiento(a){return this.calcularRendimiento(a)||0},volverAEmbarque(){this.$router.push({name:"EditarEmbarque",params:{id:this.$route.params.id}})},esMedidaMix(a){return a.toLowerCase().includes("mix")},obtenerEtiqueta(a,e){return this.kilosCrudos[a]?"medida1"===e?this.kilosCrudos[a].etiqueta1||"Kilos en crudo (Medida 1)":this.kilosCrudos[a].etiqueta2||"Kilos en crudo (Medida 2)":"medida1"===e?"Kilos en crudo (Medida 1)":"Kilos en crudo (Medida 2)"},editarEtiqueta(a,e){this.kilosCrudos[a]||this.$set(this.kilosCrudos,a,{medida1:0,medida2:0,etiqueta1:"Kilos en crudo (Medida 1)",etiqueta2:"Kilos en crudo (Medida 2)"});const t="medida1"===e?this.kilosCrudos[a].etiqueta1:this.kilosCrudos[a].etiqueta2,i=prompt("Ingrese el nuevo nombre para la medida:",t);null!==i&&("medida1"===e?this.$set(this.kilosCrudos[a],"etiqueta1",i):this.$set(this.kilosCrudos[a],"etiqueta2",i),this.guardarCambiosEnTiempoReal())},generarPDF(){var a;const e=this.medidasUnicas.filter(a=>!this.medidaOculta[a]).map(a=>{let e;var t,i;this.esMedidaMix(a)?e={medida1:Number((null===(t=this.kilosCrudos[a])||void 0===t?void 0:t.medida1)||0),medida2:Number((null===(i=this.kilosCrudos[a])||void 0===i?void 0:i.medida2)||0)}:e=Number(this.kilosCrudos[a]||0);const s=this.getRendimiento(a),r=this.calcularCostoFinal(a);return{medida:a,kilosCrudos:e,totalEmbarcado:this.obtenerTotalEmbarcado(a),rendimiento:s,costoFinal:r}}),t={...this.embarqueData,notaRendimientos:(null===(a=this.embarqueData)||void 0===a?void 0:a.notaRendimientos)||"",mostrarColumnaCosto:!0},i=Object.entries(this.gananciasCalculadas).filter(([a])=>!this.medidaOculta[a]&&this.analizarGanancia[a]).reduce((a,[e,t])=>(a[e]=t,a),{}),s=this.calcularTarasCrudosPorMedida(),r=Object.entries(this.gananciasCalculadasCrudos).filter(([a])=>this.analizarGananciaCrudos[a]).reduce((a,[e,t])=>(a[e]=t,a),{}),o=this.calcularCostosCrudos(s),c={pesoTaraCosto:this.pesoTaraCosto,pesoTaraVenta:this.pesoTaraVenta},l={};Object.keys(this.analizarMaquilaGanancia).forEach(a=>{this.analizarMaquilaGanancia[a]&&!this.medidaOculta[a]&&(l[a]={totalEmbarcado:this.obtenerTotalEmbarcado(a),precioMaquila:Number(this.precioMaquila[a])||0,gananciaTotal:this.calcularGananciaMaquila(a)})}),Object(n["a"])(e,t,i,s,r,o,c,l)},obtenerNombreMedidaPersonalizado(a){return this.nombresMedidasPersonalizados[a]||a},async editarNombreMedida(a){const e=this.obtenerNombreMedidaPersonalizado(a),t=prompt("Ingrese el nuevo nombre para la medida:",e);if(null!==t&&""!==t.trim()){this.$set(this.nombresMedidasPersonalizados,a,t.trim());try{const a=Object(r["h"])(),e=this.$route.params.id,t=Object(r["e"])(a,"embarques",e);await Object(r["r"])(t,{nombresMedidasPersonalizados:this.nombresMedidasPersonalizados}),console.log("Nombre de medida actualizado correctamente")}catch(i){console.error("Error al guardar el nuevo nombre:",i)}}},abrirModalNota(){var a;this.nota=(null===(a=this.embarqueData)||void 0===a?void 0:a.notaRendimientos)||"",this.mostrarModal=!0},async guardarNota(){try{const a=Object(r["h"])(),e=this.$route.params.id,t=Object(r["e"])(a,"embarques",e);await Object(r["r"])(t,{notaRendimientos:this.nota}),this.embarqueData.notaRendimientos=this.nota,this.cerrarModal(),console.log("Nota guardada correctamente")}catch(a){console.error("Error al guardar la nota:",a)}},cerrarModal(){this.mostrarModal=!1,this.nota=""},async guardarEstadoOculto(){try{const a=Object(r["h"])(),e=this.$route.params.id,t=Object(r["e"])(a,"embarques",e);await Object(r["r"])(t,{medidaOculta:this.medidaOculta}),console.log("Estado de ocultaci√≥n guardado correctamente")}catch(a){console.error("Error al guardar estado de ocultaci√≥n:",a)}},async guardarEstadoAnalisis(){try{const a=Object(r["h"])(),e=this.$route.params.id,t=Object(r["e"])(a,"embarques",e);await Object(r["r"])(t,{analizarGanancia:this.analizarGanancia,analizarGananciaCrudos:this.analizarGananciaCrudos,analizarMaquilaGanancia:this.analizarMaquilaGanancia,precioMaquila:this.precioMaquila}),console.log("Estado de an√°lisis de ganancia guardado correctamente")}catch(a){console.error("Error al guardar estado de an√°lisis de ganancia:",a)}},irAGestionCostos(){this.$router.push({name:"GestionCostos",params:{id:this.$route.params.id}})},formatearPrecio(a){if(!a)return"0";const e=Math.round(a);return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},formatearNumero(a){if(!a)return"0";const e=Math.floor(a);return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},formatearFecha(a){if(!a)return"";const e=new Date(a);return e.toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})},mostrarIndicadorPrecioReciente(a){if(!this.embarqueData||!this.embarqueData.fecha)return!1;const e=new Date(this.embarqueData.fecha).toISOString().split("T")[0],t=(new Date).toISOString().split("T")[0],i=new Date(e),s=new Date(t),r=Math.floor((s-i)/864e5),o=r<=this.diasRecientes,n=e>=t;return o||n},abrirModalConfiguracion(){this.mostrarModalConfiguracion=!0},cerrarModalConfiguracion(){this.mostrarModalConfiguracion=!1},async guardarConfiguracion(){try{const a=Object(r["h"])(),e=this.$route.params.id,t=Object(r["e"])(a,"embarques",e);await Object(r["r"])(t,{pesoTaraCosto:Number(this.pesoTaraCosto),pesoTaraVenta:Number(this.pesoTaraVenta)}),console.log("Configuraci√≥n de pesos guardada correctamente"),this.cerrarModalConfiguracion(),this.calcularGanancias()}catch(a){console.error("Error al guardar configuraci√≥n de pesos:",a),alert("Error al guardar la configuraci√≥n. Intente nuevamente.")}},deberMostrarDetallePorCliente(a){const e=this.gananciasCalculadasCrudos[a];if(!e||!e.detallesPorCliente)return!1;if(e.detallesPorCliente.length<=1)return!1;const t=e.detallesPorCliente.map(a=>a.precioVenta),i=new Set(t);return i.size>1},calcularGananciaMaquila(a){const e=this.obtenerTotalEmbarcado(a),t=Number(this.precioMaquila[a])||0;return e*t}},watch:{kilosCrudos:{handler(){this.guardarCambiosEnTiempoReal(),this.$nextTick(()=>{this.calcularGanancias()})},deep:!0},analizarGanancia:{handler(){this.$nextTick(()=>{this.calcularGanancias()})},deep:!0},analizarGananciaCrudos:{handler(a,e){const t=Object.keys(a).some(t=>a[t]&&!e[t]);t?this.inicializarCostosPorMedida().then(()=>{this.$nextTick(()=>{this.calcularGananciasCrudos()})}):this.$nextTick(()=>{this.calcularGananciasCrudos()})},deep:!0},pesoTaraCosto:{handler(){this.embarqueData&&this.$nextTick(()=>{this.calcularGanancias()})}},pesoTaraVenta:{handler(){this.embarqueData&&this.$nextTick(()=>{this.calcularGanancias()})}},analizarMaquilaGanancia:{handler(){this.guardarCambiosEnTiempoReal()},deep:!0},precioMaquila:{handler(){this.guardarCambiosEnTiempoReal()},deep:!0}},beforeDestroy(){this.guardarCambiosEnTiempoReal.cancel&&this.guardarCambiosEnTiempoReal.cancel()}},l=c,d=(t("7206"),t("2877")),u=Object(d["a"])(l,i,s,!1,null,"187acc62",null);e["default"]=u.exports},7206:function(a,e,t){"use strict";t("3387")}}]);