(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["app.e346c0ac"],{"2b68":function(t,e,o){"use strict";o("d5fa")},"50ac":function(t,e,o){"use strict";o("d3bc")},a55b:function(t,e,o){"use strict";var n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"login-container"},[e("div",{staticClass:"login-box"},[e("h2",[t._v("Iniciar Sesión")]),e("form",{on:{submit:function(e){return e.preventDefault(),t.handleLogin.apply(null,arguments)}}},[e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"username"}},[t._v("Usuario:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.username,expression:"username"}],staticClass:"form-input",attrs:{type:"text",id:"username",required:""},domProps:{value:t.username},on:{input:function(e){e.target.composing||(t.username=e.target.value)}}})]),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"password"}},[t._v("Contraseña:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.password,expression:"password"}],staticClass:"form-input",attrs:{type:"password",id:"password",required:""},domProps:{value:t.password},on:{input:function(e){e.target.composing||(t.password=e.target.value)}}})]),t.error?e("div",{staticClass:"error-message"},[t._v(" "+t._s(t.error)+" ")]):t._e(),e("button",{staticClass:"login-button",attrs:{type:"submit"}},[t._v(" Iniciar Sesión ")])])])])},a=[],s=(o("14d9"),o("f549")),i={name:"Login",data(){return{username:"",password:"",error:""}},methods:{async handleLogin(){try{const t=Object(s["useAuthStore"])(),e=await t.login(this.username,this.password);e?this.$router.push("/"):this.error="Usuario o contraseña incorrectos"}catch(t){console.error("Error en login:",t),this.error="Error al iniciar sesión"}}}},r=i,l=(o("2b68"),o("2877")),c=Object(l["a"])(r,n,a,!1,null,"6889dfef",null);e["a"]=c.exports},bb51:function(t,e,o){"use strict";var n=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"home"}},[e("b-container",[e("Datos")],1)],1)},a=[],s=o("caa9"),i={name:"home",components:{Datos:s["a"]}},r=i,l=o("2877"),c=Object(l["a"])(r,n,a,!1,null,null,null);e["a"]=c.exports},d3bc:function(t,e,o){},d5fa:function(t,e,o){},f411:function(t,e,o){"use strict";var n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"notes-wrapper"},[e("div",{staticClass:"button-container"},[e("div",{staticClass:"button-wrapper"},[e("button",{on:{click:t.goToSaleNote}},[t._v("Nueva nota")])]),e("div",{staticClass:"button-wrapper"},[e("button",{on:{click:t.goToAddClient}},[t._v("Agregar Cliente")])])]),e("div",{staticClass:"notes-container"},[e("div",{staticClass:"filter-container"},[e("select",{directives:[{name:"model",rawName:"v-model",value:t.paymentFilter,expression:"paymentFilter"}],on:{change:function(e){var o=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.paymentFilter=e.target.multiple?o:o[0]}}},[e("option",{attrs:{value:"all"}},[t._v("Todas")]),e("option",{attrs:{value:"paid"}},[t._v("Pagadas")]),e("option",{attrs:{value:"unpaid"}},[t._v("No Pagadas")])])]),e("h2",[t._v("Notas por Cliente")]),t._l(t.filteredNotesByClient,(function(o,n){return e("div",{key:n},[e("details",[e("summary",[t._v(" "+t._s(n)+" - Debe: "+t._s(t._f("currency")(t.totalDebtByClient[n]))+" "),t.clientBalances[n]>0?e("span",{staticClass:"balance-favor"},[t._v(" Saldo a favor: "+t._s(t._f("currency")(t.clientBalances[n]))+" ")]):t._e(),e("span",{staticClass:"note-count"},[t._v("("+t._s(o.length)+")")])]),e("ul",t._l(o,(function(o){return e("li",{key:o.id},[e("button",{attrs:{tabindex:"0"},on:{click:function(e){return t.goToEditNote(o.id)}}},[t._v(" Nota "+t._s(o.folio)+" - "+t._s(o.currentDate)+" ")])])})),0),e("div",{staticClass:"client-actions"},[e("button",{staticClass:"abono-button",on:{click:function(e){return t.showAbonoModal(n)}}},[t._v("Realizar Abono")]),e("button",{staticClass:"abonos-history-button",on:{click:function(e){return t.showAbonosHistory(n)}}},[t._v("Ver Abonos")])])])])}))],2),t.showModal?e("div",{staticClass:"modal"},[e("div",{staticClass:"modal-content"},[e("h2",[t._v("Realizar Abono para "+t._s(t.selectedClient))]),e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.abonoAmount,expression:"abonoAmount",modifiers:{number:!0}}],attrs:{type:"number",placeholder:"Cantidad a abonar"},domProps:{value:t.abonoAmount},on:{input:function(e){e.target.composing||(t.abonoAmount=t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),e("button",{on:{click:t.realizarAbono}},[t._v("Confirmar Abono")]),e("button",{on:{click:t.closeModal}},[t._v("Cancelar")])])]):t._e(),t.showAbonosHistoryModal?e("div",{staticClass:"modal"},[e("div",{staticClass:"modal-content"},[e("h2",[t._v("Historial de Abonos para "+t._s(t.selectedClient))]),e("table",{staticClass:"abonos-history-table"},[t._m(0),e("tbody",t._l(t.paginatedAbonos,(function(o,n){return e("tr",{key:n},[e("td",[t._v(t._s(t.formatDate(o.fecha)))]),e("td",[t._v(t._s(t._f("currency")(o.monto)))]),e("td",[e("button",{staticClass:"delete-button",on:{click:function(e){return t.openDeleteAbonoModal(o.globalIndex)}}},[t._v("Borrar")])])])})),0)]),e("div",{staticClass:"pagination"},[e("button",{attrs:{disabled:1===t.currentPage},on:{click:t.prevPage}},[t._v("Anterior")]),e("span",[t._v("Página "+t._s(t.currentPage)+" de "+t._s(t.totalPages))]),e("button",{attrs:{disabled:t.currentPage===t.totalPages},on:{click:t.nextPage}},[t._v("Siguiente")])]),e("button",{on:{click:t.closeAbonosHistoryModal}},[t._v("Cerrar")])])]):t._e(),t.showDeleteAbonoModal?e("div",{staticClass:"modal"},[e("div",{staticClass:"modal-content"},[e("h2",[t._v("Confirmar borrado de abono")]),e("p",[t._v("¿Estás seguro de que quieres borrar este abono?")]),e("button",{on:{click:t.deleteAbono}},[t._v("Confirmar")]),e("button",{on:{click:t.closeDeleteAbonoModal}},[t._v("Cancelar")])])]):t._e()])},a=[function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",[t._v("Fecha")]),e("th",[t._v("Monto")]),e("th",[t._v("Acciones")])])])}],s=(o("14d9"),o("13d5"),o("dc59")),i=o("1494"),r={name:"NoteMenu",data(){return{notesByClient:{},paymentFilter:"unpaid",showModal:!1,selectedClient:"",abonoAmount:0,showAbonosHistoryModal:!1,clientAbonosHistory:[],showDeleteAbonoModal:!1,selectedAbonoIndex:null,selectedAbonoNote:null,currentPage:1,abonosPerPage:7,clientBalances:{}}},methods:{goToSaleNote(){this.$router.push({name:"SaleNote"})},goToAddClient(){this.$router.push({name:"AddClient"})},async fetchNotes(){try{const t=await Object(i["g"])(Object(i["c"])(s["a"],"notes")),e=t.docs.map(t=>({id:t.id,...t.data()}));this.notesByClient=e.reduce((t,e)=>(t[e.client]||(t[e.client]=[]),t[e.client].push(e),t),{});for(let o in this.notesByClient)this.notesByClient[o].sort((t,e)=>new Date(e.currentDate)-new Date(t.currentDate));await this.fetchClientBalances()}catch(t){console.error("Error fetching notes: ",t)}},async fetchClientBalances(){try{const t=await Object(i["g"])(Object(i["c"])(s["a"],"clientBalances"));this.clientBalances={},t.docs.forEach(t=>{this.clientBalances[t.id]=t.data().balance||0})}catch(t){console.error("Error fetching client balances: ",t)}},async updateClientBalance(t,e){try{const o=Object(i["e"])(s["a"],"clientBalances",t);await Object(i["r"])(o,{balance:e},{merge:!0}),this.clientBalances[t]=e}catch(o){console.error("Error updating client balance: ",o)}},goToEditNote(t){this.$router.push({name:"editar-nota",params:{noteId:t}})},showAbonoModal(t){this.selectedClient=t,this.abonoAmount="",this.showModal=!0},closeModal(){this.showModal=!1,this.selectedClient="",this.abonoAmount=0},async realizarAbono(){if(this.abonoAmount<=0)return void alert("Por favor ingrese una cantidad válida");let t=this.abonoAmount;const e=[],o=new Date,n=[...this.notesByClient[this.selectedClient]].sort((t,e)=>new Date(t.currentDate)-new Date(e.currentDate)).filter(t=>!t.isPaid);for(let s of n){if(t<=0)break;const n=s.products.reduce((t,e)=>t+e.kilos*e.pricePerKilo,0),a=s.flete||0,i=n-a,r=s.abonos.reduce((t,e)=>t+e.monto,0),l=i-r;if(l>0){const n=Math.min(t,l);s.abonos.push({monto:n,fecha:o.toISOString().split("T")[0]}),s.isPaid=i<=r+n,t-=n,e.push(s)}}try{for(let t of e){const e=Object(i["e"])(s["a"],"notes",t.id);await Object(i["s"])(e,{abonos:t.abonos,isPaid:t.isPaid})}if(t>0){const e=this.clientBalances[this.selectedClient]||0,o=e+t;await this.updateClientBalance(this.selectedClient,o),alert("Abono aplicado con éxito. Saldo a favor: $"+t.toLocaleString("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2}))}else alert("Abono aplicado con éxito");this.closeModal(),await this.fetchNotes()}catch(a){console.error("Error al actualizar las notas:",a),alert("Hubo un error al aplicar el abono")}},async showAbonosHistory(t){this.selectedClient=t,this.clientAbonosHistory=[],this.currentPage=1;const e=this.notesByClient[t];let o=0;for(let n of e)n.abonos&&n.abonos.length>0&&n.abonos.forEach((t,e)=>{this.clientAbonosHistory.push({...t,noteId:n.id,abonoIndex:e,globalIndex:o++})});this.clientAbonosHistory.sort((t,e)=>new Date(e.fecha)-new Date(t.fecha)),this.showAbonosHistoryModal=!0},closeAbonosHistoryModal(){this.showAbonosHistoryModal=!1,this.clientAbonosHistory=[]},formatDate(t){const e={year:"numeric",month:"long",day:"numeric"};return new Date(t).toLocaleDateString("es-ES",e)},prevPage(){this.currentPage>1&&this.currentPage--},nextPage(){this.currentPage<this.totalPages&&this.currentPage++},openDeleteAbonoModal(t){const e=this.clientAbonosHistory[t];this.selectedAbonoIndex=e.abonoIndex,this.selectedAbonoNote=e.noteId,this.showDeleteAbonoModal=!0},async deleteAbono(){if(this.selectedAbonoNote)try{const t=Object(i["e"])(s["a"],"notes",this.selectedAbonoNote),e=await Object(i["f"])(t);if(e.exists()){const o=e.data(),n=o.abonos.filter((t,e)=>e!==this.selectedAbonoIndex);await Object(i["s"])(t,{abonos:n}),this.clientAbonosHistory=this.clientAbonosHistory.filter(t=>!(t.noteId===this.selectedAbonoNote&&t.abonoIndex===this.selectedAbonoIndex));const a=this.notesByClient[this.selectedClient].findIndex(t=>t.id===this.selectedAbonoNote);-1!==a&&(this.notesByClient[this.selectedClient][a].abonos=n),this.closeDeleteAbonoModal(),this.currentPage=Math.min(this.currentPage,this.totalPages),alert("Abono eliminado con éxito"),await this.fetchNotes()}}catch(t){console.error("Error al eliminar el abono:",t),alert("Hubo un error al eliminar el abono")}},closeDeleteAbonoModal(){this.showDeleteAbonoModal=!1,this.selectedAbonoIndex=null,this.selectedAbonoNote=null}},computed:{filteredNotesByClient(){const t={};for(const[e,o]of Object.entries(this.notesByClient))t[e]=o.filter(t=>"all"===this.paymentFilter||("paid"===this.paymentFilter?t.isPaid:!t.isPaid)),0===t[e].length&&delete t[e];return t},totalDebtByClient(){const t={};for(const[e,o]of Object.entries(this.notesByClient))t[e]=o.reduce((t,e)=>{const o=e.products.reduce((t,e)=>t+e.kilos*e.pricePerKilo,0),n=e.flete||0,a=o-n,s=e.abonos.reduce((t,e)=>t+e.monto,0),i=a-s;return t+(e.isPaid?0:i)},0);return t},paginatedAbonos(){const t=(this.currentPage-1)*this.abonosPerPage,e=t+this.abonosPerPage;return this.clientAbonosHistory.slice(t,e)},totalPages(){return Math.ceil(this.clientAbonosHistory.length/this.abonosPerPage)}},filters:{currency(t){return t?new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(t):"$0.00"}},async mounted(){await this.fetchNotes()}},l=r,c=(o("50ac"),o("2877")),d=Object(c["a"])(l,n,a,!1,null,"0031e422",null);e["a"]=d.exports}}]);