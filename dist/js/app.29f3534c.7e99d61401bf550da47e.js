(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["app.29f3534c"],{"05af":function(a,o,t){"use strict";var e=function(){var a=this,o=a._self._c;return o("div",{staticClass:"procesos-menu"},[a._m(0),o("div",{staticClass:"menu-options"},[o("router-link",{staticClass:"btn-action btn-pedidos",attrs:{to:"/procesos/pedidos","aria-label":"Gestionar pedidos"}},[o("i",{staticClass:"icon"},[a._v("üìù")]),o("span",[a._v("Pedidos")])]),o("router-link",{staticClass:"btn-action btn-preparacion",attrs:{to:"/procesos/preparacion","aria-label":"Gestionar preparaci√≥n"}},[o("i",{staticClass:"icon"},[a._v("üë®‚Äçüç≥")]),o("span",[a._v("Preparaci√≥n")])]),o("router-link",{staticClass:"btn-action btn-bitacoras",attrs:{to:"/procesos/bitacoras","aria-label":"Ver bit√°coras de mantenimiento"}},[o("i",{staticClass:"icon"},[a._v("üìã")]),o("span",[a._v("Bit√°coras")])]),o("router-link",{staticClass:"btn-action btn-deudas",attrs:{to:"/procesos/deudas","aria-label":"Gestionar deudas"}},[o("i",{staticClass:"icon"},[a._v("üí∞")]),o("span",[a._v("Deudas")])]),o("router-link",{staticClass:"btn-action btn-barcos",attrs:{to:"/barcos","aria-label":"Gestionar deudas de barcos"}},[o("i",{staticClass:"icon"},[a._v("‚õµ")]),o("span",[a._v("Barcos")])]),o("router-link",{staticClass:"btn-action btn-prestamos",attrs:{to:"/procesos/prestamos","aria-label":"Gestionar pr√©stamos"}},[o("i",{staticClass:"icon"},[a._v("üè¶")]),o("span",[a._v("Pr√©stamos")])])],1)])},s=[function(){var a=this,o=a._self._c;return o("div",{staticClass:"header-section"},[o("div",{staticClass:"header-content"},[o("h1",{staticClass:"main-title"},[o("i",{staticClass:"icon-process"},[a._v("‚öôÔ∏è")]),a._v(" Men√∫ de Procesos ")]),o("p",{staticClass:"subtitle"},[a._v("Gestiona todos los procesos de tu negocio de manera eficiente")])])])}],r={name:"ProcesosMenu"},i=r,n=(t("7f1a"),t("2877")),c=Object(n["a"])(i,e,s,!1,null,"3a5ee55b",null);o["a"]=c.exports},"2c81":function(a,o,t){"use strict";t("fbd0")},"2edd":function(a,o,t){"use strict";var e=function(){var a,o,t,e,s,r,i,n,c,d,l,u,m,v,p,b,f,h,g,_=this,C=_._self._c;return C("div",{staticClass:"prestamos-trabajadores-container"},[C("div",{staticClass:"back-button-container"},[C("BackButton",{attrs:{to:"/procesos/prestamos"}})],1),C("h1",[_._v("Pr√©stamos a Trabajadores")]),C("div",{staticClass:"filtros-container"},[C("div",{staticClass:"filtro"},[C("label",{attrs:{for:"filtroTrabajador"}},[_._v("Trabajador:")]),C("select",{directives:[{name:"model",rawName:"v-model",value:_.filtroTrabajador,expression:"filtroTrabajador"}],attrs:{id:"filtroTrabajador"},on:{change:function(a){var o=Array.prototype.filter.call(a.target.options,(function(a){return a.selected})).map((function(a){var o="_value"in a?a._value:a.value;return o}));_.filtroTrabajador=a.target.multiple?o:o[0]}}},[C("option",{attrs:{value:""}},[_._v("Todos")]),_._l(_.trabajadores,(function(a){return C("option",{key:a.id,domProps:{value:a.id}},[_._v(" "+_._s(a.nombre)+" ")])}))],2)]),C("div",{staticClass:"filtro"},[C("label",{attrs:{for:"filtroEstado"}},[_._v("Estado:")]),C("select",{directives:[{name:"model",rawName:"v-model",value:_.filtroEstado,expression:"filtroEstado"}],attrs:{id:"filtroEstado"},on:{change:function(a){var o=Array.prototype.filter.call(a.target.options,(function(a){return a.selected})).map((function(a){var o="_value"in a?a._value:a.value;return o}));_.filtroEstado=a.target.multiple?o:o[0]}}},[C("option",{attrs:{value:""}},[_._v("Todos")]),C("option",{attrs:{value:"activo"}},[_._v("Con Deuda")]),C("option",{attrs:{value:"pagado"}},[_._v("Sin Deuda")])])])]),C("div",{staticClass:"resumen-container"},[C("div",{staticClass:"resumen-card activos"},[C("h3",[_._v("Trabajadores con Deuda")]),C("p",[_._v(_._s(_.cuentasConDeuda))])]),C("div",{staticClass:"resumen-card pendiente"},[C("h3",[_._v("Total Pendiente")]),C("p",[_._v("$"+_._s(_.formatNumber(_.totalPendienteGeneral)))])]),C("div",{staticClass:"resumen-card total-prestado"},[C("h3",[_._v("Total Prestado")]),C("p",[_._v("$"+_._s(_.formatNumber(_.totalPrestadoGeneral)))])])]),C("div",{staticClass:"acciones-container"},[C("button",{staticClass:"btn-nuevo-prestamo",on:{click:_.mostrarModalNuevoPrestamo}},[C("i",{staticClass:"fas fa-plus"}),_._v(" Nuevo Pr√©stamo ")]),C("button",{staticClass:"btn-nuevo-trabajador",on:{click:_.mostrarModalNuevoTrabajador}},[C("i",{staticClass:"fas fa-user-plus"}),_._v(" Nuevo Trabajador ")])]),_.cargando?C("div",{staticClass:"loading-spinner"},[C("div",{staticClass:"spinner"}),C("p",[_._v("Cargando cuentas...")])]):0===_.cuentasTrabajadores.length?C("div",{staticClass:"no-data"},[C("p",[_._v("No hay cuentas registradas.")]),C("button",{staticClass:"btn-nuevo-prestamo",on:{click:_.mostrarModalNuevoPrestamo}},[_._v(" Crear Nuevo Pr√©stamo ")])]):C("div",{staticClass:"cuentas-container"},_._l(_.cuentasFiltradas,(function(a){return C("div",{key:a.trabajadorId,staticClass:"cuenta-card",class:{"sin-deuda":a.saldoPendiente<=0}},[C("div",{staticClass:"cuenta-header"},[C("div",{staticClass:"cuenta-info"},[C("h3",{staticClass:"trabajador-nombre"},[_._v(_._s(a.trabajadorNombre))]),C("div",{staticClass:"cuenta-stats"},[C("div",{staticClass:"stat"},[C("span",{staticClass:"label"},[_._v("Total Prestado:")]),C("span",{staticClass:"value prestado"},[_._v("$"+_._s(_.formatNumber(a.totalPrestado)))])]),C("div",{staticClass:"stat"},[C("span",{staticClass:"label"},[_._v("Total Abonado:")]),C("span",{staticClass:"value abonado"},[_._v("$"+_._s(_.formatNumber(a.totalAbonado)))])]),C("div",{staticClass:"stat saldo"},[C("span",{staticClass:"label"},[_._v("Saldo Pendiente:")]),C("span",{staticClass:"value",class:a.saldoPendiente<=0?"pagado":"pendiente"},[_._v(" $"+_._s(_.formatNumber(a.saldoPendiente))+" ")])])])]),C("div",{staticClass:"cuenta-acciones"},[C("button",{staticClass:"btn-historial",attrs:{title:"Ver historial completo"},on:{click:function(o){return _.verHistorial(a)}}},[C("i",{staticClass:"fas fa-history"}),_._v(" Historial ")]),C("button",{staticClass:"btn-abono",attrs:{disabled:a.saldoPendiente<=0,title:"Agregar abono"},on:{click:function(o){return _.agregarAbonoCuenta(a)}}},[C("i",{staticClass:"fas fa-money-bill"}),_._v(" Abonar ")])])]),C("div",{staticClass:"cuenta-resumen"},[C("div",{staticClass:"progress-bar"},[C("div",{staticClass:"progress-fill",style:{width:a.porcentajePagado+"%"}})]),C("span",{staticClass:"progress-text"},[_._v(_._s(a.porcentajePagado)+"% pagado")])])])})),0),_.showModalNuevoPrestamo?C("div",{staticClass:"modal-overlay",on:{click:_.closeModalOnOverlay}},[C("div",{staticClass:"modal-content",on:{click:function(a){a.stopPropagation()}}},[C("div",{staticClass:"modal-header"},[C("h2",[_._v("Nuevo Pr√©stamo a Trabajador")]),C("button",{staticClass:"close-button",on:{click:function(a){_.showModalNuevoPrestamo=!1}}},[_._v("√ó")])]),C("div",{staticClass:"modal-body"},[C("form",{staticClass:"form-prestamo",on:{submit:function(a){return a.preventDefault(),_.guardarNuevoPrestamo.apply(null,arguments)}}},[C("div",{staticClass:"form-group"},[C("label",{attrs:{for:"trabajadorSelect"}},[_._v("Trabajador:")]),C("select",{directives:[{name:"model",rawName:"v-model",value:_.nuevoPrestamo.trabajadorId,expression:"nuevoPrestamo.trabajadorId"}],attrs:{id:"trabajadorSelect",required:""},on:{change:function(a){var o=Array.prototype.filter.call(a.target.options,(function(a){return a.selected})).map((function(a){var o="_value"in a?a._value:a.value;return o}));_.$set(_.nuevoPrestamo,"trabajadorId",a.target.multiple?o:o[0])}}},[C("option",{attrs:{value:""}},[_._v("Seleccionar trabajador")]),_._l(_.trabajadores,(function(a){return C("option",{key:a.id,domProps:{value:a.id}},[_._v(" "+_._s(a.nombre)+" ")])}))],2)]),C("div",{staticClass:"form-group"},[C("label",{attrs:{for:"fechaPrestamo"}},[_._v("Fecha:")]),C("input",{directives:[{name:"model",rawName:"v-model",value:_.nuevoPrestamo.fecha,expression:"nuevoPrestamo.fecha"}],attrs:{id:"fechaPrestamo",type:"date",required:""},domProps:{value:_.nuevoPrestamo.fecha},on:{input:function(a){a.target.composing||_.$set(_.nuevoPrestamo,"fecha",a.target.value)}}})]),C("div",{staticClass:"form-group"},[C("label",{attrs:{for:"montoPrestamo"}},[_._v("Monto:")]),C("input",{directives:[{name:"model",rawName:"v-model.number",value:_.nuevoPrestamo.monto,expression:"nuevoPrestamo.monto",modifiers:{number:!0}}],attrs:{id:"montoPrestamo",type:"number",required:"",min:"1",step:"0.01"},domProps:{value:_.nuevoPrestamo.monto},on:{input:function(a){a.target.composing||_.$set(_.nuevoPrestamo,"monto",_._n(a.target.value))},blur:function(a){return _.$forceUpdate()}}})]),C("div",{staticClass:"form-group"},[C("label",{attrs:{for:"descripcionPrestamo"}},[_._v("Descripci√≥n:")]),C("textarea",{directives:[{name:"model",rawName:"v-model",value:_.nuevoPrestamo.descripcion,expression:"nuevoPrestamo.descripcion"}],attrs:{id:"descripcionPrestamo",rows:"3",placeholder:"Descripci√≥n del pr√©stamo (opcional)"},domProps:{value:_.nuevoPrestamo.descripcion},on:{input:function(a){a.target.composing||_.$set(_.nuevoPrestamo,"descripcion",a.target.value)}}})]),C("div",{staticClass:"form-actions"},[C("button",{staticClass:"btn-cancelar",attrs:{type:"button"},on:{click:function(a){_.showModalNuevoPrestamo=!1}}},[_._v("Cancelar")]),C("button",{staticClass:"btn-guardar",attrs:{type:"submit",disabled:_.guardando}},[_._v(" "+_._s(_.guardando?"Guardando...":"Guardar Pr√©stamo")+" ")])])])])])]):_._e(),_.showModalNuevoTrabajador?C("div",{staticClass:"modal-overlay",on:{click:_.closeModalOnOverlay}},[C("div",{staticClass:"modal-content",on:{click:function(a){a.stopPropagation()}}},[C("div",{staticClass:"modal-header"},[C("h2",[_._v("Nuevo Trabajador")]),C("button",{staticClass:"close-button",on:{click:function(a){_.showModalNuevoTrabajador=!1}}},[_._v("√ó")])]),C("div",{staticClass:"modal-body"},[C("form",{staticClass:"form-trabajador",on:{submit:function(a){return a.preventDefault(),_.guardarNuevoTrabajador.apply(null,arguments)}}},[C("div",{staticClass:"form-group"},[C("label",{attrs:{for:"nombreTrabajador"}},[_._v("Nombre:")]),C("input",{directives:[{name:"model",rawName:"v-model",value:_.nuevoTrabajador.nombre,expression:"nuevoTrabajador.nombre"}],attrs:{id:"nombreTrabajador",type:"text",required:"",placeholder:"Nombre completo del trabajador"},domProps:{value:_.nuevoTrabajador.nombre},on:{input:function(a){a.target.composing||_.$set(_.nuevoTrabajador,"nombre",a.target.value)}}})]),C("div",{staticClass:"form-group"},[C("label",{attrs:{for:"contactoTrabajador"}},[_._v("Contacto:")]),C("input",{directives:[{name:"model",rawName:"v-model",value:_.nuevoTrabajador.contacto,expression:"nuevoTrabajador.contacto"}],attrs:{id:"contactoTrabajador",type:"text",placeholder:"Tel√©fono o email (opcional)"},domProps:{value:_.nuevoTrabajador.contacto},on:{input:function(a){a.target.composing||_.$set(_.nuevoTrabajador,"contacto",a.target.value)}}})]),C("div",{staticClass:"form-group"},[C("label",{attrs:{for:"puestoTrabajador"}},[_._v("Puesto:")]),C("input",{directives:[{name:"model",rawName:"v-model",value:_.nuevoTrabajador.puesto,expression:"nuevoTrabajador.puesto"}],attrs:{id:"puestoTrabajador",type:"text",placeholder:"Puesto de trabajo (opcional)"},domProps:{value:_.nuevoTrabajador.puesto},on:{input:function(a){a.target.composing||_.$set(_.nuevoTrabajador,"puesto",a.target.value)}}})]),C("div",{staticClass:"form-actions"},[C("button",{staticClass:"btn-cancelar",attrs:{type:"button"},on:{click:function(a){_.showModalNuevoTrabajador=!1}}},[_._v("Cancelar")]),C("button",{staticClass:"btn-guardar",attrs:{type:"submit",disabled:_.guardando}},[_._v(" "+_._s(_.guardando?"Guardando...":"Guardar Trabajador")+" ")])])])])])]):_._e(),_.showDetalleModal?C("div",{staticClass:"modal-overlay",on:{click:_.closeModalOnOverlay}},[C("div",{staticClass:"modal-content modal-large",on:{click:function(a){a.stopPropagation()}}},[C("div",{staticClass:"modal-header"},[C("h2",[_._v("Detalle del Pr√©stamo")]),C("button",{staticClass:"close-button",on:{click:function(a){_.showDetalleModal=!1}}},[_._v("√ó")])]),C("div",{staticClass:"modal-body"},[C("div",{staticClass:"prestamo-info"},[C("div",{staticClass:"info-grid"},[C("div",{staticClass:"info-item"},[C("strong",[_._v("Trabajador:")]),C("span",[_._v(_._s(null===(a=_.prestamoSeleccionado)||void 0===a?void 0:a.trabajadorNombre))])]),C("div",{staticClass:"info-item"},[C("strong",[_._v("Fecha:")]),C("span",[_._v(_._s(_.formatearFecha(null===(o=_.prestamoSeleccionado)||void 0===o?void 0:o.fecha)))])]),C("div",{staticClass:"info-item"},[C("strong",[_._v("Monto Inicial:")]),C("span",[_._v("$"+_._s(_.formatNumber(null===(t=_.prestamoSeleccionado)||void 0===t?void 0:t.montoInicial)))])]),C("div",{staticClass:"info-item"},[C("strong",[_._v("Estado:")]),C("span",{class:"estado-badge "+(null===(e=_.prestamoSeleccionado)||void 0===e?void 0:e.estado)},[_._v(" "+_._s("activo"===(null===(s=_.prestamoSeleccionado)||void 0===s?void 0:s.estado)?"Activo":"Pagado")+" ")])])]),null!==(r=_.prestamoSeleccionado)&&void 0!==r&&r.descripcion?C("div",{staticClass:"descripcion"},[C("strong",[_._v("Descripci√≥n:")]),C("p",[_._v(_._s(_.prestamoSeleccionado.descripcion))])]):_._e()]),C("h3",[_._v("Historial de Abonos")]),0===_.abonos.length?C("div",{staticClass:"no-abonos"},[C("p",[_._v("No hay abonos registrados para este pr√©stamo.")])]):C("table",{staticClass:"tabla-abonos"},[_._m(0),C("tbody",_._l(_.abonos,(function(a,o){return C("tr",{key:o},[C("td",[_._v(_._s(_.formatearFecha(a.fecha)))]),C("td",[_._v(_._s(a.descripcion))]),C("td",[_._v("$"+_._s(_.formatNumber(a.monto)))]),C("td",[C("button",{staticClass:"btn-eliminar-sm",on:{click:function(a){return _.eliminarAbono(o)}}},[C("i",{staticClass:"fas fa-trash-alt"})])])])})),0),C("tfoot",[C("tr",[C("td",{staticClass:"total-label",attrs:{colspan:"2"}},[_._v("Total Abonos")]),C("td",[_._v("$"+_._s(_.formatNumber(_.totalAbonos)))]),C("td")])])]),C("div",{staticClass:"resumen-prestamo"},[C("div",{staticClass:"resumen-item"},[C("span",[_._v("Monto inicial:")]),C("span",[_._v("$"+_._s(_.formatNumber(null===(i=_.prestamoSeleccionado)||void 0===i?void 0:i.montoInicial)))])]),C("div",{staticClass:"resumen-item"},[C("span",[_._v("Total abonos:")]),C("span",[_._v("$"+_._s(_.formatNumber(_.totalAbonos)))])]),C("div",{staticClass:"resumen-item total"},[C("span",[_._v("Saldo pendiente:")]),C("span",[_._v("$"+_._s(_.formatNumber(_.calcularSaldoPendiente())))])])])])])]):_._e(),_.showAbonoModal?C("div",{staticClass:"modal-overlay",on:{click:_.closeModalOnOverlay}},[C("div",{staticClass:"modal-content",on:{click:function(a){a.stopPropagation()}}},[C("div",{staticClass:"modal-header"},[C("h2",[_._v("Agregar Abono")]),C("button",{staticClass:"close-button",on:{click:function(a){_.showAbonoModal=!1}}},[_._v("√ó")])]),C("div",{staticClass:"modal-body"},[C("div",{staticClass:"prestamo-info"},[C("p",[C("strong",[_._v("Trabajador:")]),_._v(" "+_._s(null===(n=_.prestamoSeleccionado)||void 0===n?void 0:n.trabajadorNombre))]),C("p",[C("strong",[_._v("Saldo Pendiente:")]),_._v(" $"+_._s(_.formatNumber(null===(c=_.prestamoSeleccionado)||void 0===c?void 0:c.saldoPendiente)))])]),C("form",{staticClass:"form-abono",on:{submit:function(a){return a.preventDefault(),_.guardarAbono.apply(null,arguments)}}},[C("div",{staticClass:"form-group"},[C("label",{attrs:{for:"fechaAbono"}},[_._v("Fecha:")]),C("input",{directives:[{name:"model",rawName:"v-model",value:_.nuevoAbono.fecha,expression:"nuevoAbono.fecha"}],attrs:{id:"fechaAbono",type:"date",required:""},domProps:{value:_.nuevoAbono.fecha},on:{input:function(a){a.target.composing||_.$set(_.nuevoAbono,"fecha",a.target.value)}}})]),C("div",{staticClass:"form-group"},[C("label",{attrs:{for:"descripcionAbono"}},[_._v("Descripci√≥n:")]),C("input",{directives:[{name:"model",rawName:"v-model",value:_.nuevoAbono.descripcion,expression:"nuevoAbono.descripcion"}],attrs:{id:"descripcionAbono",type:"text",required:"",placeholder:"Ej: Descuento de n√≥mina, Pago efectivo, etc."},domProps:{value:_.nuevoAbono.descripcion},on:{input:function(a){a.target.composing||_.$set(_.nuevoAbono,"descripcion",a.target.value)}}})]),C("div",{staticClass:"form-group"},[C("label",{attrs:{for:"montoAbono"}},[_._v("Monto:")]),C("input",{directives:[{name:"model",rawName:"v-model.number",value:_.nuevoAbono.monto,expression:"nuevoAbono.monto",modifiers:{number:!0}}],attrs:{id:"montoAbono",type:"number",required:"",min:"1",max:null===(d=_.prestamoSeleccionado)||void 0===d?void 0:d.saldoPendiente,step:"0.01"},domProps:{value:_.nuevoAbono.monto},on:{input:function(a){a.target.composing||_.$set(_.nuevoAbono,"monto",_._n(a.target.value))},blur:function(a){return _.$forceUpdate()}}})]),C("div",{staticClass:"form-actions"},[C("button",{staticClass:"btn-cancelar",attrs:{type:"button"},on:{click:function(a){_.showAbonoModal=!1}}},[_._v("Cancelar")]),C("button",{staticClass:"btn-guardar",attrs:{type:"submit",disabled:_.guardando}},[_._v(" "+_._s(_.guardando?"Guardando...":"Guardar Abono")+" ")])])])])])]):_._e(),_.showHistorialModal?C("div",{staticClass:"modal-overlay",on:{click:_.closeModalOnOverlay}},[C("div",{staticClass:"modal-content modal-large",on:{click:function(a){a.stopPropagation()}}},[C("div",{staticClass:"modal-header"},[C("h2",[_._v("Historial Completo - "+_._s(null===(l=_.cuentaSeleccionada)||void 0===l?void 0:l.trabajadorNombre))]),C("button",{staticClass:"close-button",on:{click:function(a){_.showHistorialModal=!1}}},[_._v("√ó")])]),C("div",{staticClass:"modal-body"},[C("div",{staticClass:"cuenta-resumen-modal"},[C("div",{staticClass:"resumen-stats"},[C("div",{staticClass:"stat-card prestado"},[C("h4",[_._v("Total Prestado")]),C("p",[_._v("$"+_._s(_.formatNumber(null===(u=_.cuentaSeleccionada)||void 0===u?void 0:u.totalPrestado)))])]),C("div",{staticClass:"stat-card abonado"},[C("h4",[_._v("Total Abonado")]),C("p",[_._v("$"+_._s(_.formatNumber(null===(m=_.cuentaSeleccionada)||void 0===m?void 0:m.totalAbonado)))])]),C("div",{staticClass:"stat-card pendiente"},[C("h4",[_._v("Saldo Pendiente")]),C("p",[_._v("$"+_._s(_.formatNumber(null===(v=_.cuentaSeleccionada)||void 0===v?void 0:v.saldoPendiente)))])])]),C("div",{staticClass:"progress-section"},[C("div",{staticClass:"progress-bar-large"},[C("div",{staticClass:"progress-fill-large",style:{width:(null===(p=_.cuentaSeleccionada)||void 0===p?void 0:p.porcentajePagado)+"%"}})]),C("span",{staticClass:"progress-text-large"},[_._v(_._s(null===(b=_.cuentaSeleccionada)||void 0===b?void 0:b.porcentajePagado)+"% pagado")])])]),C("h3",[_._v("Historial de Movimientos")]),0===_.historialCompleto.length?C("div",{staticClass:"no-historial"},[C("p",[_._v("No hay movimientos registrados.")])]):C("div",{staticClass:"historial-container"},_._l(_.historialCompleto,(function(a,o){return C("div",{key:o,staticClass:"movimiento-item",class:a.tipo},[C("div",{staticClass:"movimiento-icon"},[C("i",{class:"prestamo"===a.tipo?"fas fa-arrow-up":"fas fa-arrow-down"})]),C("div",{staticClass:"movimiento-info"},[C("div",{staticClass:"movimiento-header"},[C("span",{staticClass:"movimiento-tipo"},[_._v(" "+_._s("prestamo"===a.tipo?"Pr√©stamo Otorgado":"Abono Recibido")+" ")]),C("span",{staticClass:"movimiento-fecha"},[_._v(_._s(_.formatearFecha(a.fecha)))])]),C("div",{staticClass:"movimiento-descripcion"},[_._v(_._s(a.descripcion))]),C("div",{staticClass:"movimiento-monto",class:a.tipo},[_._v(" "+_._s("prestamo"===a.tipo?"+":"-")+"$"+_._s(_.formatNumber(a.monto))+" ")])]),C("div",{staticClass:"movimiento-actions"},[C("button",{staticClass:"btn-eliminar-sm",attrs:{title:"Eliminar"},on:{click:function(o){return _.eliminarMovimiento(a)}}},[C("i",{staticClass:"fas fa-trash-alt"})])])])})),0)])])]):_._e(),_.showAbonoModal?C("div",{staticClass:"modal-overlay",on:{click:_.closeModalOnOverlay}},[C("div",{staticClass:"modal-content",on:{click:function(a){a.stopPropagation()}}},[C("div",{staticClass:"modal-header"},[C("h2",[_._v("Agregar Abono")]),C("button",{staticClass:"close-button",on:{click:function(a){_.showAbonoModal=!1}}},[_._v("√ó")])]),C("div",{staticClass:"modal-body"},[C("div",{staticClass:"prestamo-info"},[C("p",[C("strong",[_._v("Trabajador:")]),_._v(" "+_._s(null===(f=_.cuentaSeleccionada)||void 0===f?void 0:f.trabajadorNombre))]),C("p",[C("strong",[_._v("Saldo Pendiente:")]),_._v(" $"+_._s(_.formatNumber(null===(h=_.cuentaSeleccionada)||void 0===h?void 0:h.saldoPendiente)))])]),C("form",{staticClass:"form-abono",on:{submit:function(a){return a.preventDefault(),_.guardarAbono.apply(null,arguments)}}},[C("div",{staticClass:"form-group"},[C("label",{attrs:{for:"fechaAbono"}},[_._v("Fecha:")]),C("input",{directives:[{name:"model",rawName:"v-model",value:_.nuevoAbono.fecha,expression:"nuevoAbono.fecha"}],attrs:{id:"fechaAbono",type:"date",required:""},domProps:{value:_.nuevoAbono.fecha},on:{input:function(a){a.target.composing||_.$set(_.nuevoAbono,"fecha",a.target.value)}}})]),C("div",{staticClass:"form-group"},[C("label",{attrs:{for:"descripcionAbono"}},[_._v("Descripci√≥n:")]),C("input",{directives:[{name:"model",rawName:"v-model",value:_.nuevoAbono.descripcion,expression:"nuevoAbono.descripcion"}],attrs:{id:"descripcionAbono",type:"text",required:"",placeholder:"Ej: Descuento de n√≥mina, Pago efectivo, etc."},domProps:{value:_.nuevoAbono.descripcion},on:{input:function(a){a.target.composing||_.$set(_.nuevoAbono,"descripcion",a.target.value)}}})]),C("div",{staticClass:"form-group"},[C("label",{attrs:{for:"montoAbono"}},[_._v("Monto:")]),C("input",{directives:[{name:"model",rawName:"v-model.number",value:_.nuevoAbono.monto,expression:"nuevoAbono.monto",modifiers:{number:!0}}],attrs:{id:"montoAbono",type:"number",required:"",min:"1",max:null===(g=_.cuentaSeleccionada)||void 0===g?void 0:g.saldoPendiente,step:"0.01"},domProps:{value:_.nuevoAbono.monto},on:{input:function(a){a.target.composing||_.$set(_.nuevoAbono,"monto",_._n(a.target.value))},blur:function(a){return _.$forceUpdate()}}})]),C("div",{staticClass:"form-actions"},[C("button",{staticClass:"btn-cancelar",attrs:{type:"button"},on:{click:function(a){_.showAbonoModal=!1}}},[_._v("Cancelar")]),C("button",{staticClass:"btn-guardar",attrs:{type:"submit",disabled:_.guardando}},[_._v(" "+_._s(_.guardando?"Guardando...":"Guardar Abono")+" ")])])])])])]):_._e()])},s=[function(){var a=this,o=a._self._c;return o("thead",[o("tr",[o("th",[a._v("Fecha")]),o("th",[a._v("Descripci√≥n")]),o("th",[a._v("Monto")]),o("th",[a._v("Acciones")])])])}],r=(t("14d9"),t("13d5"),t("dc59")),i=t("1494"),n=t("74c9"),c={name:"PrestamosTrabajadores",components:{BackButton:n["a"]},data(){return{prestamos:[],trabajadores:[],cuentasTrabajadores:[],historialCompleto:[],cargando:!0,guardando:!1,filtroTrabajador:"",filtroEstado:"",showModalNuevoPrestamo:!1,showModalNuevoTrabajador:!1,showHistorialModal:!1,showAbonoModal:!1,cuentaSeleccionada:null,nuevoPrestamo:{trabajadorId:"",fecha:"",monto:null,descripcion:""},nuevoTrabajador:{nombre:"",contacto:"",puesto:""},nuevoAbono:{fecha:"",descripcion:"",monto:null}}},computed:{cuentasFiltradas(){return this.cuentasTrabajadores.filter(a=>(!this.filtroTrabajador||a.trabajadorId===this.filtroTrabajador)&&(!("activo"===this.filtroEstado&&a.saldoPendiente<=0)&&!("pagado"===this.filtroEstado&&a.saldoPendiente>0)))},cuentasConDeuda(){return this.cuentasFiltradas.filter(a=>a.saldoPendiente>0).length},totalPendienteGeneral(){return this.cuentasFiltradas.reduce((a,o)=>a+o.saldoPendiente,0)},totalPrestadoGeneral(){return this.cuentasFiltradas.reduce((a,o)=>a+o.totalPrestado,0)}},methods:{obtenerFechaActual(){const a=new Date,o=a.getFullYear(),t=String(a.getMonth()+1).padStart(2,"0"),e=String(a.getDate()).padStart(2,"0");return`${o}-${t}-${e}`},formatNumber(a){return a?a.toLocaleString("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00"},formatearFecha(a){if(!a)return"";const o=new Date(a+"T00:00:00"),t={year:"numeric",month:"long",day:"numeric"};return o.toLocaleDateString("es-ES",t)},async cargarPrestamos(){try{this.cargando=!0;const a=await Object(i["g"])(Object(i["o"])(Object(i["c"])(r["a"],"prestamosTrabajadores"),Object(i["l"])("fechaCreacion","desc")));this.prestamos=a.docs.map(a=>({id:a.id,...a.data()})),await this.agruparCuentasPorTrabajador()}catch(a){console.error("Error al cargar pr√©stamos: ",a)}finally{this.cargando=!1}},async agruparCuentasPorTrabajador(){const a=new Map;for(const t of this.prestamos){a.has(t.trabajadorId)||a.set(t.trabajadorId,{trabajadorId:t.trabajadorId,trabajadorNombre:t.trabajadorNombre,totalPrestado:0,totalAbonado:0,saldoPendiente:0,prestamos:[]});const o=a.get(t.trabajadorId);o.totalPrestado+=t.montoInicial,o.prestamos.push(t)}for(const[t,e]of a){let a=0;for(const t of e.prestamos)try{const o=await Object(i["g"])(Object(i["c"])(r["a"],"prestamosTrabajadores",t.id,"abonos"));let e=0;o.forEach(a=>{const o=a.data();e+=o.monto||0}),a+=e,t.saldoPendienteReal=t.montoInicial-e}catch(o){console.error(`Error al cargar abonos para pr√©stamo ${t.id}:`,o)}e.totalAbonado=a,e.saldoPendiente=e.totalPrestado-e.totalAbonado,e.porcentajePagado=e.totalPrestado>0?Math.round(e.totalAbonado/e.totalPrestado*100):0}this.cuentasTrabajadores=Array.from(a.values())},async cargarTrabajadores(){try{const a=await Object(i["g"])(Object(i["c"])(r["a"],"trabajadores"));this.trabajadores=a.docs.map(a=>({id:a.id,...a.data()}))}catch(a){console.error("Error al cargar trabajadores: ",a)}},mostrarModalNuevoPrestamo(){this.nuevoPrestamo={trabajadorId:"",fecha:this.obtenerFechaActual(),monto:null,descripcion:""},this.showModalNuevoPrestamo=!0},mostrarModalNuevoTrabajador(){this.nuevoTrabajador={nombre:"",contacto:"",puesto:""},this.showModalNuevoTrabajador=!0},async guardarNuevoPrestamo(){if(this.nuevoPrestamo.trabajadorId&&this.nuevoPrestamo.monto)try{this.guardando=!0;const a=this.trabajadores.find(a=>a.id===this.nuevoPrestamo.trabajadorId);await Object(i["b"])(Object(i["c"])(r["a"],"prestamosTrabajadores"),{trabajadorId:this.nuevoPrestamo.trabajadorId,trabajadorNombre:a.nombre,fecha:this.nuevoPrestamo.fecha,montoInicial:this.nuevoPrestamo.monto,saldoPendiente:this.nuevoPrestamo.monto,descripcion:this.nuevoPrestamo.descripcion,estado:"activo",fechaCreacion:new Date}),this.showModalNuevoPrestamo=!1,await this.cargarPrestamos(),alert("Pr√©stamo registrado correctamente")}catch(a){console.error("Error al guardar pr√©stamo: ",a),alert("Error al guardar pr√©stamo: "+a.message)}finally{this.guardando=!1}else alert("Por favor complete todos los campos requeridos")},async guardarNuevoTrabajador(){if(this.nuevoTrabajador.nombre)try{this.guardando=!0,await Object(i["b"])(Object(i["c"])(r["a"],"trabajadores"),{nombre:this.nuevoTrabajador.nombre,contacto:this.nuevoTrabajador.contacto,puesto:this.nuevoTrabajador.puesto,fechaCreacion:new Date}),this.showModalNuevoTrabajador=!1,await this.cargarTrabajadores(),alert("Trabajador registrado correctamente")}catch(a){console.error("Error al guardar trabajador: ",a),alert("Error al guardar trabajador: "+a.message)}finally{this.guardando=!1}else alert("Por favor ingrese el nombre del trabajador")},async verHistorial(a){this.cuentaSeleccionada=a;const o=[];a.prestamos.forEach(a=>{o.push({tipo:"prestamo",fecha:a.fecha,fechaCreacion:a.fechaCreacion,descripcion:a.descripcion||"Pr√©stamo otorgado",monto:a.montoInicial,id:a.id})});try{const t=await Promise.all(a.prestamos.map(async a=>{const o=await Object(i["g"])(Object(i["c"])(r["a"],"prestamosTrabajadores",a.id,"abonos"));return o.docs.map(o=>({id:o.id,prestamoId:a.id,...o.data()}))}));t.flat().forEach(a=>{o.push({tipo:"abono",fecha:a.fecha,fechaCreacion:a.fechaCreacion,descripcion:a.descripcion,monto:a.monto,id:a.id,prestamoId:a.prestamoId})})}catch(t){console.error("Error al cargar abonos para historial: ",t)}this.historialCompleto=o.sort((a,o)=>new Date(o.fechaCreacion)-new Date(a.fechaCreacion)),this.showHistorialModal=!0},agregarAbonoCuenta(a){this.cuentaSeleccionada=a,this.nuevoAbono={fecha:this.obtenerFechaActual(),descripcion:"",monto:null},this.showAbonoModal=!0},async verDetalle(a){this.prestamoSeleccionado=a,this.abonos=[];try{const o=await Object(i["g"])(Object(i["o"])(Object(i["c"])(r["a"],"prestamosTrabajadores",a.id,"abonos"),Object(i["l"])("fechaCreacion","desc")));this.abonos=o.docs.map(a=>({id:a.id,...a.data()})),this.showDetalleModal=!0}catch(o){console.error("Error al cargar detalle del pr√©stamo: ",o)}},agregarAbono(a){this.prestamoSeleccionado=a,this.nuevoAbono={fecha:this.obtenerFechaActual(),descripcion:"",monto:null},this.showAbonoModal=!0},async guardarAbono(){if(this.nuevoAbono.descripcion&&this.nuevoAbono.monto)if(this.nuevoAbono.monto<=0)alert("El monto del abono debe ser mayor a cero");else if(this.nuevoAbono.monto>this.cuentaSeleccionada.saldoPendiente)alert("El monto del abono no puede ser mayor al saldo pendiente");else try{this.guardando=!0;const a=this.cuentaSeleccionada.prestamos.sort((a,o)=>new Date(o.fechaCreacion)-new Date(a.fechaCreacion))[0];if(!a)return void alert("Error: No se encontr√≥ un pr√©stamo para asociar el abono");await Object(i["b"])(Object(i["c"])(r["a"],"prestamosTrabajadores",a.id,"abonos"),{descripcion:this.nuevoAbono.descripcion,monto:this.nuevoAbono.monto,fecha:this.nuevoAbono.fecha,fechaCreacion:new Date});const o=await Object(i["g"])(Object(i["c"])(r["a"],"prestamosTrabajadores",a.id,"abonos"));let t=0;o.forEach(a=>{t+=a.data().monto||0});const e=a.montoInicial-t;await Object(i["s"])(Object(i["e"])(r["a"],"prestamosTrabajadores",a.id),{saldoPendiente:e,estado:e<=0?"pagado":"activo"}),this.showAbonoModal=!1,await this.cargarPrestamos(),alert("Abono registrado correctamente")}catch(a){console.error("Error al guardar abono: ",a),alert("Error al guardar abono: "+a.message)}finally{this.guardando=!1}else alert("Por favor complete todos los campos del abono")},async eliminarPrestamo(a){if(confirm(`¬øEst√° seguro que desea eliminar el pr√©stamo de ${a.trabajadorNombre}? Esta acci√≥n no se puede deshacer.`))try{this.cargando=!0;const o=await Object(i["g"])(Object(i["c"])(r["a"],"prestamosTrabajadores",a.id,"abonos")),t=Object(i["u"])(r["a"]);o.forEach(o=>{t.delete(Object(i["e"])(r["a"],"prestamosTrabajadores",a.id,"abonos",o.id))}),await t.commit(),await Object(i["d"])(Object(i["e"])(r["a"],"prestamosTrabajadores",a.id)),this.prestamos=this.prestamos.filter(o=>o.id!==a.id),alert("Pr√©stamo eliminado correctamente")}catch(o){console.error("Error al eliminar el pr√©stamo: ",o),alert("Error al eliminar el pr√©stamo: "+o.message)}finally{this.cargando=!1}},async eliminarAbono(a){if(!confirm("¬øEst√° seguro de eliminar este abono?"))return;const o=this.abonos[a];try{this.guardando=!0,await Object(i["d"])(Object(i["e"])(r["a"],"prestamosTrabajadores",this.prestamoSeleccionado.id,"abonos",o.id)),this.abonos.splice(a,1);const t=this.calcularSaldoPendiente();await Object(i["s"])(Object(i["e"])(r["a"],"prestamosTrabajadores",this.prestamoSeleccionado.id),{saldoPendiente:t,estado:t<=0?"pagado":"activo"}),this.prestamos=this.prestamos.map(a=>a.id===this.prestamoSeleccionado.id?{...a,saldoPendiente:t,estado:t<=0?"pagado":"activo"}:a),this.prestamoSeleccionado.saldoPendiente=t,this.prestamoSeleccionado.estado=t<=0?"pagado":"activo"}catch(t){console.error("Error al eliminar abono: ",t),alert("Error al eliminar abono: "+t.message)}finally{this.guardando=!1}},async eliminarMovimiento(a){try{if("abono"===a.tipo){if(!confirm("¬øEliminar este abono? Esta acci√≥n no se puede deshacer."))return;await Object(i["d"])(Object(i["e"])(r["a"],"prestamosTrabajadores",a.prestamoId,"abonos",a.id));const o=Object(i["e"])(r["a"],"prestamosTrabajadores",a.prestamoId),t=await Object(i["f"])(o);if(t.exists()){const e=t.data(),s=await Object(i["g"])(Object(i["c"])(r["a"],"prestamosTrabajadores",a.prestamoId,"abonos"));let n=0;s.forEach(a=>{n+=a.data().monto||0});const c=(e.montoInicial||0)-n;await Object(i["s"])(o,{saldoPendiente:c,estado:c<=0?"pagado":"activo"})}}else if("prestamo"===a.tipo){if(!confirm("¬øEliminar este pr√©stamo y todos sus abonos? Esta acci√≥n no se puede deshacer."))return;const o=await Object(i["g"])(Object(i["c"])(r["a"],"prestamosTrabajadores",a.id,"abonos")),t=Object(i["u"])(r["a"]);o.forEach(o=>{t.delete(Object(i["e"])(r["a"],"prestamosTrabajadores",a.id,"abonos",o.id))}),await t.commit(),await Object(i["d"])(Object(i["e"])(r["a"],"prestamosTrabajadores",a.id))}if(await this.cargarPrestamos(),this.cuentaSeleccionada){const a=this.cuentasTrabajadores.find(a=>a.trabajadorId===this.cuentaSeleccionada.trabajadorId);a?this.verHistorial(a):this.showHistorialModal=!1}}catch(o){console.error("Error al eliminar movimiento: ",o),alert("Error al eliminar: "+o.message)}},calcularSaldoPendiente(){var a;return(null===(a=this.prestamoSeleccionado)||void 0===a?void 0:a.montoInicial)-this.totalAbonos},closeModalOnOverlay(a){a.target===a.currentTarget&&(this.showModalNuevoPrestamo=!1,this.showModalNuevoTrabajador=!1,this.showHistorialModal=!1,this.showAbonoModal=!1)}},async mounted(){await Promise.all([this.cargarPrestamos(),this.cargarTrabajadores()])}},d=c,l=(t("aac9"),t("2877")),u=Object(l["a"])(d,e,s,!1,null,"77a4434a",null);o["a"]=u.exports},"3e3b":function(a,o,t){"use strict";t("b216")},"767f":function(a,o,t){"use strict";var e=function(){var a,o,t,e,s,r,i,n,c,d,l,u,m,v,p,b,f,h,g,_=this,C=_._self._c;return C("div",{staticClass:"prestamos-despicadoras-container"},[C("div",{staticClass:"back-button-container"},[C("BackButton",{attrs:{to:"/procesos/prestamos"}})],1),C("h1",[_._v("Pr√©stamos a Despicadoras")]),C("div",{staticClass:"filtros-container"},[C("div",{staticClass:"filtro"},[C("label",{attrs:{for:"filtroDespicadora"}},[_._v("Despicadora:")]),C("select",{directives:[{name:"model",rawName:"v-model",value:_.filtroDespicadora,expression:"filtroDespicadora"}],attrs:{id:"filtroDespicadora"},on:{change:function(a){var o=Array.prototype.filter.call(a.target.options,(function(a){return a.selected})).map((function(a){var o="_value"in a?a._value:a.value;return o}));_.filtroDespicadora=a.target.multiple?o:o[0]}}},[C("option",{attrs:{value:""}},[_._v("Todas")]),_._l(_.despicadoras,(function(a){return C("option",{key:a.id,domProps:{value:a.id}},[_._v(" "+_._s(a.nombre)+" ")])}))],2)]),C("div",{staticClass:"filtro"},[C("label",{attrs:{for:"filtroEstado"}},[_._v("Estado:")]),C("select",{directives:[{name:"model",rawName:"v-model",value:_.filtroEstado,expression:"filtroEstado"}],attrs:{id:"filtroEstado"},on:{change:function(a){var o=Array.prototype.filter.call(a.target.options,(function(a){return a.selected})).map((function(a){var o="_value"in a?a._value:a.value;return o}));_.filtroEstado=a.target.multiple?o:o[0]}}},[C("option",{attrs:{value:""}},[_._v("Todos")]),C("option",{attrs:{value:"activo"}},[_._v("Con Deuda")]),C("option",{attrs:{value:"pagado"}},[_._v("Sin Deuda")])])])]),C("div",{staticClass:"resumen-container"},[C("div",{staticClass:"resumen-card activos"},[C("h3",[_._v("Despicadoras con Deuda")]),C("p",[_._v(_._s(_.cuentasConDeuda))])]),C("div",{staticClass:"resumen-card pendiente"},[C("h3",[_._v("Total Pendiente")]),C("p",[_._v("$"+_._s(_.formatNumber(_.totalPendienteGeneral)))])]),C("div",{staticClass:"resumen-card total-prestado"},[C("h3",[_._v("Total Prestado")]),C("p",[_._v("$"+_._s(_.formatNumber(_.totalPrestadoGeneral)))])])]),C("div",{staticClass:"acciones-container"},[C("button",{staticClass:"btn-nuevo-prestamo",on:{click:_.mostrarModalNuevoPrestamo}},[C("i",{staticClass:"fas fa-plus"}),_._v(" Nuevo Pr√©stamo ")]),C("button",{staticClass:"btn-nueva-despicadora",on:{click:_.mostrarModalNuevaDespicadora}},[C("i",{staticClass:"fas fa-building"}),_._v(" Nueva Despicadora ")])]),_.cargando?C("div",{staticClass:"loading-spinner"},[C("div",{staticClass:"spinner"}),C("p",[_._v("Cargando cuentas...")])]):0===_.cuentasDespicadoras.length?C("div",{staticClass:"no-data"},[C("p",[_._v("No hay cuentas registradas.")]),C("button",{staticClass:"btn-nuevo-prestamo",on:{click:_.mostrarModalNuevoPrestamo}},[_._v(" Crear Nuevo Pr√©stamo ")])]):C("div",{staticClass:"cuentas-container"},_._l(_.cuentasFiltradas,(function(a){return C("div",{key:a.despicadoraId,staticClass:"cuenta-card",class:{"sin-deuda":a.saldoPendiente<=0}},[C("div",{staticClass:"cuenta-header"},[C("div",{staticClass:"cuenta-info"},[C("h3",{staticClass:"despicadora-nombre"},[_._v(_._s(a.despicadoraNombre))]),C("div",{staticClass:"cuenta-stats"},[C("div",{staticClass:"stat"},[C("span",{staticClass:"label"},[_._v("Total Prestado:")]),C("span",{staticClass:"value prestado"},[_._v("$"+_._s(_.formatNumber(a.totalPrestado)))])]),C("div",{staticClass:"stat"},[C("span",{staticClass:"label"},[_._v("Total Abonado:")]),C("span",{staticClass:"value abonado"},[_._v("$"+_._s(_.formatNumber(a.totalAbonado)))])]),C("div",{staticClass:"stat saldo"},[C("span",{staticClass:"label"},[_._v("Saldo Pendiente:")]),C("span",{staticClass:"value",class:a.saldoPendiente<=0?"pagado":"pendiente"},[_._v(" $"+_._s(_.formatNumber(a.saldoPendiente))+" ")])])])]),C("div",{staticClass:"cuenta-acciones"},[C("button",{staticClass:"btn-historial",attrs:{title:"Ver historial completo"},on:{click:function(o){return _.verHistorial(a)}}},[C("i",{staticClass:"fas fa-history"}),_._v(" Historial ")]),C("button",{staticClass:"btn-abono",attrs:{disabled:a.saldoPendiente<=0,title:"Agregar abono"},on:{click:function(o){return _.agregarAbonoCuenta(a)}}},[C("i",{staticClass:"fas fa-money-bill"}),_._v(" Abonar ")])])]),C("div",{staticClass:"cuenta-resumen"},[C("div",{staticClass:"progress-bar"},[C("div",{staticClass:"progress-fill",style:{width:a.porcentajePagado+"%"}})]),C("span",{staticClass:"progress-text"},[_._v(_._s(a.porcentajePagado)+"% pagado")])])])})),0),_.showModalNuevoPrestamo?C("div",{staticClass:"modal-overlay",on:{click:_.closeModalOnOverlay}},[C("div",{staticClass:"modal-content",on:{click:function(a){a.stopPropagation()}}},[C("div",{staticClass:"modal-header"},[C("h2",[_._v("Nuevo Pr√©stamo a Despicadora")]),C("button",{staticClass:"close-button",on:{click:function(a){_.showModalNuevoPrestamo=!1}}},[_._v("√ó")])]),C("div",{staticClass:"modal-body"},[C("form",{staticClass:"form-prestamo",on:{submit:function(a){return a.preventDefault(),_.guardarNuevoPrestamo.apply(null,arguments)}}},[C("div",{staticClass:"form-group"},[C("label",{attrs:{for:"despicadoraSelect"}},[_._v("Despicadora:")]),C("select",{directives:[{name:"model",rawName:"v-model",value:_.nuevoPrestamo.despicadoraId,expression:"nuevoPrestamo.despicadoraId"}],attrs:{id:"despicadoraSelect",required:""},on:{change:function(a){var o=Array.prototype.filter.call(a.target.options,(function(a){return a.selected})).map((function(a){var o="_value"in a?a._value:a.value;return o}));_.$set(_.nuevoPrestamo,"despicadoraId",a.target.multiple?o:o[0])}}},[C("option",{attrs:{value:""}},[_._v("Seleccionar despicadora")]),_._l(_.despicadoras,(function(a){return C("option",{key:a.id,domProps:{value:a.id}},[_._v(" "+_._s(a.nombre)+" ")])}))],2)]),C("div",{staticClass:"form-group"},[C("label",{attrs:{for:"fechaPrestamo"}},[_._v("Fecha:")]),C("input",{directives:[{name:"model",rawName:"v-model",value:_.nuevoPrestamo.fecha,expression:"nuevoPrestamo.fecha"}],attrs:{id:"fechaPrestamo",type:"date",required:""},domProps:{value:_.nuevoPrestamo.fecha},on:{input:function(a){a.target.composing||_.$set(_.nuevoPrestamo,"fecha",a.target.value)}}})]),C("div",{staticClass:"form-group"},[C("label",{attrs:{for:"montoPrestamo"}},[_._v("Monto:")]),C("input",{directives:[{name:"model",rawName:"v-model.number",value:_.nuevoPrestamo.monto,expression:"nuevoPrestamo.monto",modifiers:{number:!0}}],attrs:{id:"montoPrestamo",type:"number",required:"",min:"1",step:"0.01"},domProps:{value:_.nuevoPrestamo.monto},on:{input:function(a){a.target.composing||_.$set(_.nuevoPrestamo,"monto",_._n(a.target.value))},blur:function(a){return _.$forceUpdate()}}})]),C("div",{staticClass:"form-group"},[C("label",{attrs:{for:"descripcionPrestamo"}},[_._v("Descripci√≥n:")]),C("textarea",{directives:[{name:"model",rawName:"v-model",value:_.nuevoPrestamo.descripcion,expression:"nuevoPrestamo.descripcion"}],attrs:{id:"descripcionPrestamo",rows:"3",placeholder:"Descripci√≥n del pr√©stamo (opcional)"},domProps:{value:_.nuevoPrestamo.descripcion},on:{input:function(a){a.target.composing||_.$set(_.nuevoPrestamo,"descripcion",a.target.value)}}})]),C("div",{staticClass:"form-actions"},[C("button",{staticClass:"btn-cancelar",attrs:{type:"button"},on:{click:function(a){_.showModalNuevoPrestamo=!1}}},[_._v("Cancelar")]),C("button",{staticClass:"btn-guardar",attrs:{type:"submit",disabled:_.guardando}},[_._v(" "+_._s(_.guardando?"Guardando...":"Guardar Pr√©stamo")+" ")])])])])])]):_._e(),_.showModalNuevaDespicadora?C("div",{staticClass:"modal-overlay",on:{click:_.closeModalOnOverlay}},[C("div",{staticClass:"modal-content",on:{click:function(a){a.stopPropagation()}}},[C("div",{staticClass:"modal-header"},[C("h2",[_._v("Nueva Despicadora")]),C("button",{staticClass:"close-button",on:{click:function(a){_.showModalNuevaDespicadora=!1}}},[_._v("√ó")])]),C("div",{staticClass:"modal-body"},[C("form",{staticClass:"form-despicadora",on:{submit:function(a){return a.preventDefault(),_.guardarNuevaDespicadora.apply(null,arguments)}}},[C("div",{staticClass:"form-group"},[C("label",{attrs:{for:"nombreDespicadora"}},[_._v("Nombre:")]),C("input",{directives:[{name:"model",rawName:"v-model",value:_.nuevaDespicadora.nombre,expression:"nuevaDespicadora.nombre"}],attrs:{id:"nombreDespicadora",type:"text",required:"",placeholder:"Nombre de la despicadora"},domProps:{value:_.nuevaDespicadora.nombre},on:{input:function(a){a.target.composing||_.$set(_.nuevaDespicadora,"nombre",a.target.value)}}})]),C("div",{staticClass:"form-group"},[C("label",{attrs:{for:"contactoDespicadora"}},[_._v("Contacto:")]),C("input",{directives:[{name:"model",rawName:"v-model",value:_.nuevaDespicadora.contacto,expression:"nuevaDespicadora.contacto"}],attrs:{id:"contactoDespicadora",type:"text",placeholder:"Tel√©fono o email (opcional)"},domProps:{value:_.nuevaDespicadora.contacto},on:{input:function(a){a.target.composing||_.$set(_.nuevaDespicadora,"contacto",a.target.value)}}})]),C("div",{staticClass:"form-group"},[C("label",{attrs:{for:"direccionDespicadora"}},[_._v("Direcci√≥n:")]),C("textarea",{directives:[{name:"model",rawName:"v-model",value:_.nuevaDespicadora.direccion,expression:"nuevaDespicadora.direccion"}],attrs:{id:"direccionDespicadora",rows:"2",placeholder:"Direcci√≥n (opcional)"},domProps:{value:_.nuevaDespicadora.direccion},on:{input:function(a){a.target.composing||_.$set(_.nuevaDespicadora,"direccion",a.target.value)}}})]),C("div",{staticClass:"form-actions"},[C("button",{staticClass:"btn-cancelar",attrs:{type:"button"},on:{click:function(a){_.showModalNuevaDespicadora=!1}}},[_._v("Cancelar")]),C("button",{staticClass:"btn-guardar",attrs:{type:"submit",disabled:_.guardando}},[_._v(" "+_._s(_.guardando?"Guardando...":"Guardar Despicadora")+" ")])])])])])]):_._e(),_.showDetalleModal?C("div",{staticClass:"modal-overlay",on:{click:_.closeModalOnOverlay}},[C("div",{staticClass:"modal-content modal-large",on:{click:function(a){a.stopPropagation()}}},[C("div",{staticClass:"modal-header"},[C("h2",[_._v("Detalle del Pr√©stamo")]),C("button",{staticClass:"close-button",on:{click:function(a){_.showDetalleModal=!1}}},[_._v("√ó")])]),C("div",{staticClass:"modal-body"},[C("div",{staticClass:"prestamo-info"},[C("div",{staticClass:"info-grid"},[C("div",{staticClass:"info-item"},[C("strong",[_._v("Despicadora:")]),C("span",[_._v(_._s(null===(a=_.prestamoSeleccionado)||void 0===a?void 0:a.despicadoraNombre))])]),C("div",{staticClass:"info-item"},[C("strong",[_._v("Fecha:")]),C("span",[_._v(_._s(_.formatearFecha(null===(o=_.prestamoSeleccionado)||void 0===o?void 0:o.fecha)))])]),C("div",{staticClass:"info-item"},[C("strong",[_._v("Monto Inicial:")]),C("span",[_._v("$"+_._s(_.formatNumber(null===(t=_.prestamoSeleccionado)||void 0===t?void 0:t.montoInicial)))])]),C("div",{staticClass:"info-item"},[C("strong",[_._v("Estado:")]),C("span",{class:"estado-badge "+(null===(e=_.prestamoSeleccionado)||void 0===e?void 0:e.estado)},[_._v(" "+_._s("activo"===(null===(s=_.prestamoSeleccionado)||void 0===s?void 0:s.estado)?"Activo":"Pagado")+" ")])])]),null!==(r=_.prestamoSeleccionado)&&void 0!==r&&r.descripcion?C("div",{staticClass:"descripcion"},[C("strong",[_._v("Descripci√≥n:")]),C("p",[_._v(_._s(_.prestamoSeleccionado.descripcion))])]):_._e()]),C("h3",[_._v("Historial de Abonos")]),0===_.abonos.length?C("div",{staticClass:"no-abonos"},[C("p",[_._v("No hay abonos registrados para este pr√©stamo.")])]):C("table",{staticClass:"tabla-abonos"},[_._m(0),C("tbody",_._l(_.abonos,(function(a,o){return C("tr",{key:o},[C("td",[_._v(_._s(_.formatearFecha(a.fecha)))]),C("td",[_._v(_._s(a.descripcion))]),C("td",[_._v("$"+_._s(_.formatNumber(a.monto)))]),C("td",[C("button",{staticClass:"btn-eliminar-sm",on:{click:function(a){return _.eliminarAbono(o)}}},[C("i",{staticClass:"fas fa-trash-alt"})])])])})),0),C("tfoot",[C("tr",[C("td",{staticClass:"total-label",attrs:{colspan:"2"}},[_._v("Total Abonos")]),C("td",[_._v("$"+_._s(_.formatNumber(_.totalAbonos)))]),C("td")])])]),C("div",{staticClass:"resumen-prestamo"},[C("div",{staticClass:"resumen-item"},[C("span",[_._v("Monto inicial:")]),C("span",[_._v("$"+_._s(_.formatNumber(null===(i=_.prestamoSeleccionado)||void 0===i?void 0:i.montoInicial)))])]),C("div",{staticClass:"resumen-item"},[C("span",[_._v("Total abonos:")]),C("span",[_._v("$"+_._s(_.formatNumber(_.totalAbonos)))])]),C("div",{staticClass:"resumen-item total"},[C("span",[_._v("Saldo pendiente:")]),C("span",[_._v("$"+_._s(_.formatNumber(_.calcularSaldoPendiente())))])])])])])]):_._e(),_.showAbonoModal?C("div",{staticClass:"modal-overlay",on:{click:_.closeModalOnOverlay}},[C("div",{staticClass:"modal-content",on:{click:function(a){a.stopPropagation()}}},[C("div",{staticClass:"modal-header"},[C("h2",[_._v("Agregar Abono")]),C("button",{staticClass:"close-button",on:{click:function(a){_.showAbonoModal=!1}}},[_._v("√ó")])]),C("div",{staticClass:"modal-body"},[C("div",{staticClass:"prestamo-info"},[C("p",[C("strong",[_._v("Despicadora:")]),_._v(" "+_._s(null===(n=_.prestamoSeleccionado)||void 0===n?void 0:n.despicadoraNombre))]),C("p",[C("strong",[_._v("Saldo Pendiente:")]),_._v(" $"+_._s(_.formatNumber(null===(c=_.prestamoSeleccionado)||void 0===c?void 0:c.saldoPendiente)))])]),C("form",{staticClass:"form-abono",on:{submit:function(a){return a.preventDefault(),_.guardarAbono.apply(null,arguments)}}},[C("div",{staticClass:"form-group"},[C("label",{attrs:{for:"fechaAbono"}},[_._v("Fecha:")]),C("input",{directives:[{name:"model",rawName:"v-model",value:_.nuevoAbono.fecha,expression:"nuevoAbono.fecha"}],attrs:{id:"fechaAbono",type:"date",required:""},domProps:{value:_.nuevoAbono.fecha},on:{input:function(a){a.target.composing||_.$set(_.nuevoAbono,"fecha",a.target.value)}}})]),C("div",{staticClass:"form-group"},[C("label",{attrs:{for:"descripcionAbono"}},[_._v("Descripci√≥n:")]),C("input",{directives:[{name:"model",rawName:"v-model",value:_.nuevoAbono.descripcion,expression:"nuevoAbono.descripcion"}],attrs:{id:"descripcionAbono",type:"text",required:"",placeholder:"Ej: Pago parcial, Transferencia, etc."},domProps:{value:_.nuevoAbono.descripcion},on:{input:function(a){a.target.composing||_.$set(_.nuevoAbono,"descripcion",a.target.value)}}})]),C("div",{staticClass:"form-group"},[C("label",{attrs:{for:"montoAbono"}},[_._v("Monto:")]),C("input",{directives:[{name:"model",rawName:"v-model.number",value:_.nuevoAbono.monto,expression:"nuevoAbono.monto",modifiers:{number:!0}}],attrs:{id:"montoAbono",type:"number",required:"",min:"1",max:null===(d=_.prestamoSeleccionado)||void 0===d?void 0:d.saldoPendiente,step:"0.01"},domProps:{value:_.nuevoAbono.monto},on:{input:function(a){a.target.composing||_.$set(_.nuevoAbono,"monto",_._n(a.target.value))},blur:function(a){return _.$forceUpdate()}}})]),C("div",{staticClass:"form-actions"},[C("button",{staticClass:"btn-cancelar",attrs:{type:"button"},on:{click:function(a){_.showAbonoModal=!1}}},[_._v("Cancelar")]),C("button",{staticClass:"btn-guardar",attrs:{type:"submit",disabled:_.guardando}},[_._v(" "+_._s(_.guardando?"Guardando...":"Guardar Abono")+" ")])])])])])]):_._e(),_.showHistorialModal?C("div",{staticClass:"modal-overlay",on:{click:_.closeModalOnOverlay}},[C("div",{staticClass:"modal-content modal-large",on:{click:function(a){a.stopPropagation()}}},[C("div",{staticClass:"modal-header"},[C("h2",[_._v("Historial Completo - "+_._s(null===(l=_.cuentaSeleccionada)||void 0===l?void 0:l.despicadoraNombre))]),C("button",{staticClass:"close-button",on:{click:function(a){_.showHistorialModal=!1}}},[_._v("√ó")])]),C("div",{staticClass:"modal-body"},[C("div",{staticClass:"cuenta-resumen-modal"},[C("div",{staticClass:"resumen-stats"},[C("div",{staticClass:"stat-card prestado"},[C("h4",[_._v("Total Prestado")]),C("p",[_._v("$"+_._s(_.formatNumber(null===(u=_.cuentaSeleccionada)||void 0===u?void 0:u.totalPrestado)))])]),C("div",{staticClass:"stat-card abonado"},[C("h4",[_._v("Total Abonado")]),C("p",[_._v("$"+_._s(_.formatNumber(null===(m=_.cuentaSeleccionada)||void 0===m?void 0:m.totalAbonado)))])]),C("div",{staticClass:"stat-card pendiente"},[C("h4",[_._v("Saldo Pendiente")]),C("p",[_._v("$"+_._s(_.formatNumber(null===(v=_.cuentaSeleccionada)||void 0===v?void 0:v.saldoPendiente)))])])]),C("div",{staticClass:"progress-section"},[C("div",{staticClass:"progress-bar-large"},[C("div",{staticClass:"progress-fill-large",style:{width:(null===(p=_.cuentaSeleccionada)||void 0===p?void 0:p.porcentajePagado)+"%"}})]),C("span",{staticClass:"progress-text-large"},[_._v(_._s(null===(b=_.cuentaSeleccionada)||void 0===b?void 0:b.porcentajePagado)+"% pagado")])])]),C("h3",[_._v("Historial de Movimientos")]),0===_.historialCompleto.length?C("div",{staticClass:"no-historial"},[C("p",[_._v("No hay movimientos registrados.")])]):C("div",{staticClass:"historial-container"},_._l(_.historialCompleto,(function(a,o){return C("div",{key:o,staticClass:"movimiento-item",class:a.tipo},[C("div",{staticClass:"movimiento-icon"},[C("i",{class:"prestamo"===a.tipo?"fas fa-arrow-up":"fas fa-arrow-down"})]),C("div",{staticClass:"movimiento-info"},[C("div",{staticClass:"movimiento-header"},[C("span",{staticClass:"movimiento-tipo"},[_._v(" "+_._s("prestamo"===a.tipo?"Pr√©stamo Otorgado":"Abono Recibido")+" ")]),C("span",{staticClass:"movimiento-fecha"},[_._v(_._s(_.formatearFecha(a.fecha)))])]),C("div",{staticClass:"movimiento-descripcion"},[_._v(_._s(a.descripcion))]),C("div",{staticClass:"movimiento-monto",class:a.tipo},[_._v(" "+_._s("prestamo"===a.tipo?"+":"-")+"$"+_._s(_.formatNumber(a.monto))+" ")])]),C("div",{staticClass:"movimiento-actions"},[C("button",{staticClass:"btn-eliminar-sm",attrs:{title:"Eliminar"},on:{click:function(o){return _.eliminarMovimiento(a)}}},[C("i",{staticClass:"fas fa-trash-alt"})])])])})),0)])])]):_._e(),_.showAbonoModal?C("div",{staticClass:"modal-overlay",on:{click:_.closeModalOnOverlay}},[C("div",{staticClass:"modal-content",on:{click:function(a){a.stopPropagation()}}},[C("div",{staticClass:"modal-header"},[C("h2",[_._v("Agregar Abono")]),C("button",{staticClass:"close-button",on:{click:function(a){_.showAbonoModal=!1}}},[_._v("√ó")])]),C("div",{staticClass:"modal-body"},[C("div",{staticClass:"prestamo-info"},[C("p",[C("strong",[_._v("Despicadora:")]),_._v(" "+_._s(null===(f=_.cuentaSeleccionada)||void 0===f?void 0:f.despicadoraNombre))]),C("p",[C("strong",[_._v("Saldo Pendiente:")]),_._v(" $"+_._s(_.formatNumber(null===(h=_.cuentaSeleccionada)||void 0===h?void 0:h.saldoPendiente)))])]),C("form",{staticClass:"form-abono",on:{submit:function(a){return a.preventDefault(),_.guardarAbono.apply(null,arguments)}}},[C("div",{staticClass:"form-group"},[C("label",{attrs:{for:"fechaAbono"}},[_._v("Fecha:")]),C("input",{directives:[{name:"model",rawName:"v-model",value:_.nuevoAbono.fecha,expression:"nuevoAbono.fecha"}],attrs:{id:"fechaAbono",type:"date",required:""},domProps:{value:_.nuevoAbono.fecha},on:{input:function(a){a.target.composing||_.$set(_.nuevoAbono,"fecha",a.target.value)}}})]),C("div",{staticClass:"form-group"},[C("label",{attrs:{for:"descripcionAbono"}},[_._v("Descripci√≥n:")]),C("input",{directives:[{name:"model",rawName:"v-model",value:_.nuevoAbono.descripcion,expression:"nuevoAbono.descripcion"}],attrs:{id:"descripcionAbono",type:"text",required:"",placeholder:"Ej: Pago parcial, Transferencia, etc."},domProps:{value:_.nuevoAbono.descripcion},on:{input:function(a){a.target.composing||_.$set(_.nuevoAbono,"descripcion",a.target.value)}}})]),C("div",{staticClass:"form-group"},[C("label",{attrs:{for:"montoAbono"}},[_._v("Monto:")]),C("input",{directives:[{name:"model",rawName:"v-model.number",value:_.nuevoAbono.monto,expression:"nuevoAbono.monto",modifiers:{number:!0}}],attrs:{id:"montoAbono",type:"number",required:"",min:"1",max:null===(g=_.cuentaSeleccionada)||void 0===g?void 0:g.saldoPendiente,step:"0.01"},domProps:{value:_.nuevoAbono.monto},on:{input:function(a){a.target.composing||_.$set(_.nuevoAbono,"monto",_._n(a.target.value))},blur:function(a){return _.$forceUpdate()}}})]),C("div",{staticClass:"form-actions"},[C("button",{staticClass:"btn-cancelar",attrs:{type:"button"},on:{click:function(a){_.showAbonoModal=!1}}},[_._v("Cancelar")]),C("button",{staticClass:"btn-guardar",attrs:{type:"submit",disabled:_.guardando}},[_._v(" "+_._s(_.guardando?"Guardando...":"Guardar Abono")+" ")])])])])])]):_._e()])},s=[function(){var a=this,o=a._self._c;return o("thead",[o("tr",[o("th",[a._v("Fecha")]),o("th",[a._v("Descripci√≥n")]),o("th",[a._v("Monto")]),o("th",[a._v("Acciones")])])])}],r=(t("14d9"),t("13d5"),t("dc59")),i=t("1494"),n=t("74c9"),c={name:"PrestamosDespicadoras",components:{BackButton:n["a"]},data(){return{prestamos:[],despicadoras:[],cuentasDespicadoras:[],historialCompleto:[],cargando:!0,guardando:!1,filtroDespicadora:"",filtroEstado:"",showModalNuevoPrestamo:!1,showModalNuevaDespicadora:!1,showHistorialModal:!1,showAbonoModal:!1,cuentaSeleccionada:null,nuevoPrestamo:{despicadoraId:"",fecha:"",monto:null,descripcion:""},nuevaDespicadora:{nombre:"",contacto:"",direccion:""},nuevoAbono:{fecha:"",descripcion:"",monto:null}}},computed:{cuentasFiltradas(){return this.cuentasDespicadoras.filter(a=>(!this.filtroDespicadora||a.despicadoraId===this.filtroDespicadora)&&(!("activo"===this.filtroEstado&&a.saldoPendiente<=0)&&!("pagado"===this.filtroEstado&&a.saldoPendiente>0)))},cuentasConDeuda(){return this.cuentasFiltradas.filter(a=>a.saldoPendiente>0).length},totalPendienteGeneral(){return this.cuentasFiltradas.reduce((a,o)=>a+o.saldoPendiente,0)},totalPrestadoGeneral(){return this.cuentasFiltradas.reduce((a,o)=>a+o.totalPrestado,0)}},methods:{obtenerFechaActual(){const a=new Date,o=a.getFullYear(),t=String(a.getMonth()+1).padStart(2,"0"),e=String(a.getDate()).padStart(2,"0");return`${o}-${t}-${e}`},formatNumber(a){return a?a.toLocaleString("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00"},formatearFecha(a){if(!a)return"";const o=new Date(a+"T00:00:00"),t={year:"numeric",month:"long",day:"numeric"};return o.toLocaleDateString("es-ES",t)},async cargarPrestamos(){try{this.cargando=!0;const a=await Object(i["g"])(Object(i["o"])(Object(i["c"])(r["a"],"prestamosDespicadoras"),Object(i["l"])("fechaCreacion","desc")));this.prestamos=a.docs.map(a=>({id:a.id,...a.data()})),await this.agruparCuentasPorDespicadora()}catch(a){console.error("Error al cargar pr√©stamos: ",a)}finally{this.cargando=!1}},async agruparCuentasPorDespicadora(){const a=new Map;for(const t of this.prestamos){a.has(t.despicadoraId)||a.set(t.despicadoraId,{despicadoraId:t.despicadoraId,despicadoraNombre:t.despicadoraNombre,totalPrestado:0,totalAbonado:0,saldoPendiente:0,prestamos:[]});const o=a.get(t.despicadoraId);o.totalPrestado+=t.montoInicial,o.prestamos.push(t)}for(const[t,e]of a){let a=0;for(const t of e.prestamos)try{const o=await Object(i["g"])(Object(i["c"])(r["a"],"prestamosDespicadoras",t.id,"abonos"));let e=0;o.forEach(a=>{const o=a.data();e+=o.monto||0}),a+=e,t.saldoPendienteReal=t.montoInicial-e}catch(o){console.error(`Error al cargar abonos para pr√©stamo ${t.id}:`,o)}e.totalAbonado=a,e.saldoPendiente=e.totalPrestado-e.totalAbonado,e.porcentajePagado=e.totalPrestado>0?Math.round(e.totalAbonado/e.totalPrestado*100):0}this.cuentasDespicadoras=Array.from(a.values())},async cargarDespicadoras(){try{const a=await Object(i["g"])(Object(i["c"])(r["a"],"despicadoras"));this.despicadoras=a.docs.map(a=>({id:a.id,...a.data()}))}catch(a){console.error("Error al cargar despicadoras: ",a)}},mostrarModalNuevoPrestamo(){this.nuevoPrestamo={despicadoraId:"",fecha:this.obtenerFechaActual(),monto:null,descripcion:""},this.showModalNuevoPrestamo=!0},mostrarModalNuevaDespicadora(){this.nuevaDespicadora={nombre:"",contacto:"",direccion:""},this.showModalNuevaDespicadora=!0},async guardarNuevoPrestamo(){if(this.nuevoPrestamo.despicadoraId&&this.nuevoPrestamo.monto)try{this.guardando=!0;const a=this.despicadoras.find(a=>a.id===this.nuevoPrestamo.despicadoraId);await Object(i["b"])(Object(i["c"])(r["a"],"prestamosDespicadoras"),{despicadoraId:this.nuevoPrestamo.despicadoraId,despicadoraNombre:a.nombre,fecha:this.nuevoPrestamo.fecha,montoInicial:this.nuevoPrestamo.monto,saldoPendiente:this.nuevoPrestamo.monto,descripcion:this.nuevoPrestamo.descripcion,estado:"activo",fechaCreacion:new Date}),this.showModalNuevoPrestamo=!1,await this.cargarPrestamos(),alert("Pr√©stamo registrado correctamente")}catch(a){console.error("Error al guardar pr√©stamo: ",a),alert("Error al guardar pr√©stamo: "+a.message)}finally{this.guardando=!1}else alert("Por favor complete todos los campos requeridos")},async guardarNuevaDespicadora(){if(this.nuevaDespicadora.nombre)try{this.guardando=!0,await Object(i["b"])(Object(i["c"])(r["a"],"despicadoras"),{nombre:this.nuevaDespicadora.nombre,contacto:this.nuevaDespicadora.contacto,direccion:this.nuevaDespicadora.direccion,fechaCreacion:new Date}),this.showModalNuevaDespicadora=!1,await this.cargarDespicadoras(),alert("Despicadora registrada correctamente")}catch(a){console.error("Error al guardar despicadora: ",a),alert("Error al guardar despicadora: "+a.message)}finally{this.guardando=!1}else alert("Por favor ingrese el nombre de la despicadora")},async verHistorial(a){this.cuentaSeleccionada=a;const o=[];a.prestamos.forEach(a=>{o.push({tipo:"prestamo",fecha:a.fecha,fechaCreacion:a.fechaCreacion,descripcion:a.descripcion||"Pr√©stamo otorgado",monto:a.montoInicial,id:a.id})});try{const t=await Promise.all(a.prestamos.map(async a=>{const o=await Object(i["g"])(Object(i["c"])(r["a"],"prestamosDespicadoras",a.id,"abonos"));return o.docs.map(o=>({id:o.id,prestamoId:a.id,...o.data()}))}));t.flat().forEach(a=>{o.push({tipo:"abono",fecha:a.fecha,fechaCreacion:a.fechaCreacion,descripcion:a.descripcion,monto:a.monto,id:a.id,prestamoId:a.prestamoId})})}catch(t){console.error("Error al cargar abonos para historial: ",t)}this.historialCompleto=o.sort((a,o)=>new Date(o.fechaCreacion)-new Date(a.fechaCreacion)),this.showHistorialModal=!0},agregarAbonoCuenta(a){this.cuentaSeleccionada=a,this.nuevoAbono={fecha:this.obtenerFechaActual(),descripcion:"",monto:null},this.showAbonoModal=!0},async verDetalle(a){this.prestamoSeleccionado=a,this.abonos=[];try{const o=await Object(i["g"])(Object(i["o"])(Object(i["c"])(r["a"],"prestamosDespicadoras",a.id,"abonos"),Object(i["l"])("fechaCreacion","desc")));this.abonos=o.docs.map(a=>({id:a.id,...a.data()})),this.showDetalleModal=!0}catch(o){console.error("Error al cargar detalle del pr√©stamo: ",o)}},agregarAbono(a){this.prestamoSeleccionado=a,this.nuevoAbono={fecha:this.obtenerFechaActual(),descripcion:"",monto:null},this.showAbonoModal=!0},async guardarAbono(){if(this.nuevoAbono.descripcion&&this.nuevoAbono.monto)if(this.nuevoAbono.monto<=0)alert("El monto del abono debe ser mayor a cero");else if(this.nuevoAbono.monto>this.cuentaSeleccionada.saldoPendiente)alert("El monto del abono no puede ser mayor al saldo pendiente");else try{this.guardando=!0;const a=this.cuentaSeleccionada.prestamos.sort((a,o)=>new Date(o.fechaCreacion)-new Date(a.fechaCreacion))[0];if(!a)return void alert("Error: No se encontr√≥ un pr√©stamo para asociar el abono");await Object(i["b"])(Object(i["c"])(r["a"],"prestamosDespicadoras",a.id,"abonos"),{descripcion:this.nuevoAbono.descripcion,monto:this.nuevoAbono.monto,fecha:this.nuevoAbono.fecha,fechaCreacion:new Date});const o=await Object(i["g"])(Object(i["c"])(r["a"],"prestamosDespicadoras",a.id,"abonos"));let t=0;o.forEach(a=>{t+=a.data().monto||0});const e=a.montoInicial-t;await Object(i["s"])(Object(i["e"])(r["a"],"prestamosDespicadoras",a.id),{saldoPendiente:e,estado:e<=0?"pagado":"activo"}),this.showAbonoModal=!1,await this.cargarPrestamos(),alert("Abono registrado correctamente")}catch(a){console.error("Error al guardar abono: ",a),alert("Error al guardar abono: "+a.message)}finally{this.guardando=!1}else alert("Por favor complete todos los campos del abono")},async eliminarPrestamo(a){if(confirm(`¬øEst√° seguro que desea eliminar el pr√©stamo de ${a.despicadoraNombre}? Esta acci√≥n no se puede deshacer.`))try{this.cargando=!0;const o=await Object(i["g"])(Object(i["c"])(r["a"],"prestamosDespicadoras",a.id,"abonos")),t=Object(i["u"])(r["a"]);o.forEach(o=>{t.delete(Object(i["e"])(r["a"],"prestamosDespicadoras",a.id,"abonos",o.id))}),await t.commit(),await Object(i["d"])(Object(i["e"])(r["a"],"prestamosDespicadoras",a.id)),this.prestamos=this.prestamos.filter(o=>o.id!==a.id),alert("Pr√©stamo eliminado correctamente")}catch(o){console.error("Error al eliminar el pr√©stamo: ",o),alert("Error al eliminar el pr√©stamo: "+o.message)}finally{this.cargando=!1}},async eliminarAbono(a){if(!confirm("¬øEst√° seguro de eliminar este abono?"))return;const o=this.abonos[a];try{this.guardando=!0,await Object(i["d"])(Object(i["e"])(r["a"],"prestamosDespicadoras",this.prestamoSeleccionado.id,"abonos",o.id)),this.abonos.splice(a,1);const t=this.calcularSaldoPendiente();await Object(i["s"])(Object(i["e"])(r["a"],"prestamosDespicadoras",this.prestamoSeleccionado.id),{saldoPendiente:t,estado:t<=0?"pagado":"activo"}),this.prestamos=this.prestamos.map(a=>a.id===this.prestamoSeleccionado.id?{...a,saldoPendiente:t,estado:t<=0?"pagado":"activo"}:a),this.prestamoSeleccionado.saldoPendiente=t,this.prestamoSeleccionado.estado=t<=0?"pagado":"activo"}catch(t){console.error("Error al eliminar abono: ",t),alert("Error al eliminar abono: "+t.message)}finally{this.guardando=!1}},async eliminarMovimiento(a){try{if("abono"===a.tipo){if(!confirm("¬øEliminar este abono? Esta acci√≥n no se puede deshacer."))return;await Object(i["d"])(Object(i["e"])(r["a"],"prestamosDespicadoras",a.prestamoId,"abonos",a.id));const o=Object(i["e"])(r["a"],"prestamosDespicadoras",a.prestamoId),t=await Object(i["f"])(o);if(t.exists()){const e=t.data(),s=await Object(i["g"])(Object(i["c"])(r["a"],"prestamosDespicadoras",a.prestamoId,"abonos"));let n=0;s.forEach(a=>{n+=a.data().monto||0});const c=(e.montoInicial||0)-n;await Object(i["s"])(o,{saldoPendiente:c,estado:c<=0?"pagado":"activo"})}}else if("prestamo"===a.tipo){if(!confirm("¬øEliminar este pr√©stamo y todos sus abonos? Esta acci√≥n no se puede deshacer."))return;const o=await Object(i["g"])(Object(i["c"])(r["a"],"prestamosDespicadoras",a.id,"abonos")),t=Object(i["u"])(r["a"]);o.forEach(o=>{t.delete(Object(i["e"])(r["a"],"prestamosDespicadoras",a.id,"abonos",o.id))}),await t.commit(),await Object(i["d"])(Object(i["e"])(r["a"],"prestamosDespicadoras",a.id))}if(await this.cargarPrestamos(),this.cuentaSeleccionada){const a=this.cuentasDespicadoras.find(a=>a.despicadoraId===this.cuentaSeleccionada.despicadoraId);a?this.verHistorial(a):this.showHistorialModal=!1}}catch(o){console.error("Error al eliminar movimiento: ",o),alert("Error al eliminar: "+o.message)}},calcularSaldoPendiente(){var a;return(null===(a=this.prestamoSeleccionado)||void 0===a?void 0:a.montoInicial)-this.totalAbonos},closeModalOnOverlay(a){a.target===a.currentTarget&&(this.showModalNuevoPrestamo=!1,this.showModalNuevaDespicadora=!1,this.showHistorialModal=!1,this.showAbonoModal=!1)}},async mounted(){await Promise.all([this.cargarPrestamos(),this.cargarDespicadoras()])}},d=c,l=(t("3e3b"),t("2877")),u=Object(l["a"])(d,e,s,!1,null,"37ea9cf7",null);o["a"]=u.exports},"7f1a":function(a,o,t){"use strict";t("ef72")},"98d3":function(a,o,t){"use strict";var e=function(){var a=this,o=a._self._c;return o("div",{staticClass:"prestamos-menu-container"},[o("div",{staticClass:"back-button-container"},[o("BackButton",{attrs:{to:"/procesos"}})],1),o("h1",{staticClass:"menu-title"},[a._v("Gesti√≥n de Pr√©stamos")]),a._m(0),o("div",{staticClass:"actions-container"},[o("router-link",{staticClass:"action-button despicadoras",attrs:{to:"/procesos/prestamos/despicadoras"}},[o("div",{staticClass:"button-content"},[o("i",{staticClass:"fas fa-industry"}),o("div",{staticClass:"button-text"},[o("h3",[a._v("Pr√©stamos a Despicadoras")]),o("p",[a._v("Gestiona pr√©stamos otorgados a las despicadoras")])])]),o("i",{staticClass:"fas fa-arrow-right"})]),o("router-link",{staticClass:"action-button trabajadores",attrs:{to:"/procesos/prestamos/trabajadores"}},[o("div",{staticClass:"button-content"},[o("i",{staticClass:"fas fa-users"}),o("div",{staticClass:"button-text"},[o("h3",[a._v("Pr√©stamos a Trabajadores")]),o("p",[a._v("Gestiona pr√©stamos otorgados a empleados")])])]),o("i",{staticClass:"fas fa-arrow-right"})])],1),o("div",{staticClass:"resumen-container"},[o("div",{staticClass:"resumen-card"},[o("h3",[a._v("Resumen General")]),o("div",{staticClass:"resumen-stats"},[o("div",{staticClass:"stat-item"},[o("span",{staticClass:"stat-label"},[a._v("Total Pr√©stamos Activos:")]),o("span",{staticClass:"stat-value"},[a._v(a._s(a.totalPrestamosActivos))])]),o("div",{staticClass:"stat-item"},[o("span",{staticClass:"stat-label"},[a._v("Monto Total Pendiente:")]),o("span",{staticClass:"stat-value"},[a._v("$"+a._s(a.formatNumber(a.montoTotalPendiente)))])])])])])])},s=[function(){var a=this,o=a._self._c;return o("div",{staticClass:"menu-description"},[o("p",[a._v("Administra los pr√©stamos otorgados a despicadoras y trabajadores")])])}],r=t("dc59"),i=t("1494"),n=t("74c9"),c={name:"PrestamosMenu",components:{BackButton:n["a"]},data(){return{totalPrestamosActivos:0,montoTotalPendiente:0}},methods:{formatNumber(a){return a?a.toLocaleString("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00"},async cargarResumen(){try{const a=Object(i["o"])(Object(i["c"])(r["a"],"prestamosDespicadoras"),Object(i["t"])("estado","==","activo")),o=await Object(i["g"])(a),t=Object(i["o"])(Object(i["c"])(r["a"],"prestamosTrabajadores"),Object(i["t"])("estado","==","activo")),e=await Object(i["g"])(t);this.totalPrestamosActivos=o.size+e.size;let s=0;o.forEach(a=>{const o=a.data();s+=o.saldoPendiente||0}),e.forEach(a=>{const o=a.data();s+=o.saldoPendiente||0}),this.montoTotalPendiente=s}catch(a){console.error("Error al cargar resumen de pr√©stamos: ",a)}}},async mounted(){await this.cargarResumen()}},d=c,l=(t("2c81"),t("2877")),u=Object(l["a"])(d,e,s,!1,null,"e3e1acd8",null);o["a"]=u.exports},aac9:function(a,o,t){"use strict";t("f970")},b216:function(a,o,t){},ef72:function(a,o,t){},f970:function(a,o,t){},fbd0:function(a,o,t){}}]);