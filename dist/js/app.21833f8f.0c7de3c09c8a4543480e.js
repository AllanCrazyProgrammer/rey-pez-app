(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["app.21833f8f"],{"0165":function(a,t,e){},"052f":function(a,t,e){"use strict";e("d984")},2760:function(a,t,e){},"2e89":function(a,t,e){},"2efd":function(a,t,e){},"3f5a":function(a,t,e){"use strict";var s=function(){var a=this,t=a._self._c;return t("span",[a.renderTrigger?t("button",{staticClass:"stash-button",attrs:{type:"button"},on:{click:a.abrirModal}},[a._v(" Stash ")]):a._e(),a.showModal?t("div",{staticClass:"modal-overlay",on:{click:function(t){return t.target!==t.currentTarget?null:a.cerrarModal.apply(null,arguments)}}},[t("div",{staticClass:"modal-content",on:{click:function(a){a.stopPropagation()}}},[t("h3",[a._v("Sistema de Abonos - "+a._s(a.clienteNombre))]),t("div",{staticClass:"estado-actual"},[t("h4",[a._v("Estado Actual")]),t("div",{staticClass:"estado-cards"},[t("div",{staticClass:"card-estado"},[t("span",{staticClass:"label"},[a._v("Saldo Actual")]),t("span",{staticClass:"value",class:{negativo:a.saldoActual>0,positivo:a.saldoActual<=0}},[a._v(" $"+a._s(a.formatNumber(a.saldoActual))+" ")])]),t("div",{staticClass:"card-estado"},[t("span",{staticClass:"label"},[a._v("Total en Stash")]),t("span",{staticClass:"value verde"},[a._v("$"+a._s(a.formatNumber(a.totalStash)))])]),t("div",{staticClass:"card-estado"},[t("span",{staticClass:"label"},[a._v("Estado")]),t("span",{staticClass:"value",class:{pagado:a.saldoActual<=0,pendiente:a.saldoActual>0}},[a._v(" "+a._s(a.saldoActual<=0?"PAGADO":"PENDIENTE")+" ")])])])]),t("div",{staticClass:"seccion-agregar"},[t("h4",[a._v("Agregar Nuevo Abono al Stash")]),t("div",{staticClass:"form-row"},[t("input",{directives:[{name:"model",rawName:"v-model",value:a.nuevoAbono.fecha,expression:"nuevoAbono.fecha"}],staticClass:"input-field",attrs:{type:"date"},domProps:{value:a.nuevoAbono.fecha},on:{input:function(t){t.target.composing||a.$set(a.nuevoAbono,"fecha",t.target.value)}}}),t("input",{directives:[{name:"model",rawName:"v-model",value:a.nuevoAbono.descripcion,expression:"nuevoAbono.descripcion"}],staticClass:"input-field",attrs:{type:"text",placeholder:"Descripci√≥n (ej: SPEI, Efectivo, etc.)"},domProps:{value:a.nuevoAbono.descripcion},on:{input:function(t){t.target.composing||a.$set(a.nuevoAbono,"descripcion",t.target.value)}}}),t("input",{directives:[{name:"model",rawName:"v-model.number",value:a.nuevoAbono.monto,expression:"nuevoAbono.monto",modifiers:{number:!0}}],staticClass:"input-field",attrs:{type:"number",placeholder:"Monto",step:"0.01"},domProps:{value:a.nuevoAbono.monto},on:{input:function(t){t.target.composing||a.$set(a.nuevoAbono,"monto",a._n(t.target.value))},blur:function(t){return a.$forceUpdate()}}}),t("button",{staticClass:"btn-primary",on:{click:a.agregarAlStash}},[a._v(" Agregar ")])])]),t("div",{staticClass:"seccion-stash"},[t("h4",[a._v("Abonos en Stash ("+a._s(a.stashItems.length)+")")]),a.stashItems.length>0&&a.distribucionAbonos.distribucion.length>0?t("div",{staticClass:"distribucion-cascada-info"},[t("div",{staticClass:"info-header"},[t("span",{staticClass:"icono"},[a._v("üíß")]),t("span",{staticClass:"texto"},[a._v("Distribuci√≥n en Cascada ($"+a._s(a.formatNumber(a.totalStash))+"):")])]),t("div",{staticClass:"distribucion-lista"},a._l(a.distribucionAbonos.distribucion,(function(e,s){return t("div",{key:s,staticClass:"distribucion-item"},[t("div",{staticClass:"distribucion-cuenta"},[t("span",{staticClass:"fecha"},[a._v(a._s(e.cuenta.fechaFormateada))]),t("span",{staticClass:"monto"},[a._v("$"+a._s(a.formatNumber(e.montoAAplicar)))])]),t("div",{staticClass:"distribucion-detalle"},[a._v(" Saldo: $"+a._s(a.formatNumber(e.saldoAntes))+" ‚Üí $"+a._s(a.formatNumber(e.saldoDespues))+" ")])])})),0),a.distribucionAbonos.sobrante>0?t("div",{staticClass:"sobrante-info"},[a._v(" ‚ö†Ô∏è Sobrante sin aplicar: $"+a._s(a.formatNumber(a.distribucionAbonos.sobrante))+" ")]):a._e()]):a._e(),0===a.stashItems.length?t("div",{staticClass:"empty-state"},[a._v(" No hay abonos en el stash ")]):t("div",{staticClass:"stash-list"},a._l(a.stashItems,(function(e){return t("div",{key:e.id,staticClass:"stash-item"},[t("div",{staticClass:"item-info"},[t("span",{staticClass:"fecha"},[a._v(a._s(a.formatearFecha(e.fecha)))]),t("span",{staticClass:"descripcion"},[a._v(a._s(e.descripcion))]),t("span",{staticClass:"monto"},[a._v("$"+a._s(a.formatNumber(e.monto)))])]),t("div",{staticClass:"item-actions"},[t("div",{staticClass:"fecha-aplicacion"},[t("label",{staticClass:"fecha-label"},[a._v("Aplicar a:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.fechasAplicacion[e.id],expression:"fechasAplicacion[item.id]"}],staticClass:"select-fecha",on:{change:[function(t){var s=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(a.fechasAplicacion,e.id,t.target.multiple?s:s[0])},function(t){return a.onFechaAplicacionChange(e.id)}]}},[t("option",{attrs:{value:""}},[a._v("Seleccionar fecha...")]),a._l(a.cuentasDisponibles,(function(e){return t("option",{key:e.id,domProps:{value:e.id}},[a._v(" "+a._s(e.fechaFormateada)+" - $"+a._s(a.formatNumber(e.totalGeneralVenta))+" ")])}))],2)]),t("button",{staticClass:"btn-danger-small",on:{click:function(t){return a.eliminarDelStash(e.id)}}},[a._v(" ‚úï ")])])])})),0)]),a.stashItems.length>0&&a.saldoActual>0?t("div",{staticClass:"seccion-preview"},[t("h4",[a._v("Vista Previa de Aplicaci√≥n")]),t("div",{staticClass:"preview-info"},[t("p",[a._v("Aplicaciones programadas:")]),t("div",{staticClass:"aplicaciones-preview"},a._l(a.stashItems,(function(e){return t("div",{key:e.id,staticClass:"aplicacion-item"},[t("div",{staticClass:"aplicacion-info"},[t("span",{staticClass:"aplicacion-descripcion"},[a._v(a._s(e.descripcion))]),t("span",{staticClass:"aplicacion-monto"},[a._v("$"+a._s(a.formatNumber(e.monto)))])]),t("div",{staticClass:"aplicacion-fecha"},[a.fechasAplicacion[e.id]&&""!==a.fechasAplicacion[e.id]?t("span",{staticClass:"fecha-seleccionada"},[a._v(" ‚Üí "+a._s(a.obtenerFechaCuenta(a.fechasAplicacion[e.id]))+" ")]):t("span",{staticClass:"fecha-pendiente"},[a._v(" ‚ö†Ô∏è Sin fecha seleccionada ")])])])})),0),t("div",{staticClass:"preview-calc"},[t("div",{staticClass:"calc-row"},[t("span",[a._v("Saldo Actual:")]),t("span",[a._v("$"+a._s(a.formatNumber(a.saldoActual)))])]),t("div",{staticClass:"calc-row"},[t("span",[a._v("Total Abonos:")]),t("span",{staticClass:"verde"},[a._v("-$"+a._s(a.formatNumber(a.totalStash)))])]),t("div",{staticClass:"calc-row resultado"},[t("span",[a._v("Resultado:")]),t("span",{class:{positivo:a.saldoResultante<=0,negativo:a.saldoResultante>0}},[a._v(" $"+a._s(a.formatNumber(a.saldoResultante))+" ")])])]),a.saldoResultante<0?t("div",{staticClass:"warning-box"},[a._v(" ‚ö†Ô∏è Habr√° un sobrante de $"+a._s(a.formatNumber(Math.abs(a.saldoResultante)))+" ")]):a._e()])]):a._e(),t("div",{staticClass:"modal-actions"},[a.stashItems.length>0&&a.saldoActual>0?t("button",{staticClass:"btn-aplicar",attrs:{disabled:a.isAplicando||!a.todasFechasSeleccionadas},on:{click:a.validarYMostrarConfirmacion}},[a._v(" "+a._s(a.isAplicando?"Aplicando...":"Aplicar Abonos al Saldo")+" ")]):a._e(),a.stashItems.length>0&&a.distribucionAbonos.distribucion.length>0?t("button",{staticClass:"btn-auto-aplicar",attrs:{disabled:a.isAplicando,title:`Aplicar $${a.formatNumber(a.totalStash)} en cascada a ${a.distribucionAbonos.distribucion.length} cuenta(s)`},on:{click:a.aplicarACuentaMasAntigua}},[a._v(" "+a._s(a.isAplicando?"Aplicando...":"üíß Aplicar en Cascada")+" "),a.distribucionAbonos.distribucion.length>1?t("span",{staticClass:"cascada-count"},[a._v(" ("+a._s(a.distribucionAbonos.distribucion.length)+" cuentas) ")]):a._e()]):a._e(),t("button",{staticClass:"btn-secondary",on:{click:function(t){a.verHistorial=!0}}},[a._v(" Historial de Abonos ")]),t("button",{staticClass:"btn-secondary",on:{click:a.cerrarModal}},[a._v(" Cerrar ")])])])]):a._e(),a.mostrarConfirmacion?t("div",{staticClass:"modal-overlay",on:{click:function(t){if(t.target!==t.currentTarget)return null;a.mostrarConfirmacion=!1}}},[t("div",{staticClass:"modal-content confirmacion",on:{click:function(a){a.stopPropagation()}}},[t("h3",[a._v("‚ö†Ô∏è Confirmaci√≥n de Aplicaci√≥n")]),t("div",{staticClass:"confirmacion-detalle"},[a._m(0),t("div",{staticClass:"lista-confirmacion"},a._l(a.stashItems,(function(e){return t("div",{key:e.id,staticClass:"item-confirmacion"},[t("div",{staticClass:"confirmacion-item-info"},[t("span",[a._v(a._s(a.formatearFecha(e.fecha))+" - "+a._s(e.descripcion))]),t("span",{staticClass:"confirmacion-fecha-aplicacion"},[a._v(" ‚Üí Aplicar a: "+a._s(a.obtenerFechaCuenta(a.fechasAplicacion[e.id]))+" ")])]),t("span",[a._v("$"+a._s(a.formatNumber(e.monto)))])])})),0),t("div",{staticClass:"resumen-confirmacion"},[a._m(1),t("ul",[t("li",[a._v("Se aplicar√° un total de: "),t("strong",[a._v("$"+a._s(a.formatNumber(a.totalStash)))])]),t("li",[a._v("A "+a._s(Object.keys(a.fechasAplicacion).length)+" "+a._s(1===Object.keys(a.fechasAplicacion).length?"cuenta":"cuentas")+" diferentes")]),t("li",[a._v("Resultado estimado del saldo: "),t("strong",{class:{positivo:a.saldoResultante<=0}},[a._v("$"+a._s(a.formatNumber(a.saldoResultante)))])])])])]),t("div",{staticClass:"confirmacion-actions"},[t("button",{staticClass:"btn-danger",on:{click:a.aplicarAbonosIndividuales}},[a._v(" Confirmar y Aplicar ")]),t("button",{staticClass:"btn-secondary",on:{click:function(t){a.mostrarConfirmacion=!1}}},[a._v(" Cancelar ")])])])]):a._e(),a.verHistorial?t("div",{staticClass:"modal-overlay",on:{click:function(t){if(t.target!==t.currentTarget)return null;a.verHistorial=!1}}},[t("div",{staticClass:"modal-content",on:{click:function(a){a.stopPropagation()}}},[t("div",{staticClass:"modal-header"},[t("h3",[a._v("Historial de Abonos")]),t("button",{staticClass:"btn-close-modal",attrs:{title:"Cerrar"},on:{click:function(t){a.verHistorial=!1}}},[a._v(" ‚úï ")])]),0===a.todosLosAbonos.length?t("div",{staticClass:"empty-state"},[a._v(" No hay abonos registrados ")]):t("div",[t("div",{staticClass:"historial-info"},[t("p",[a._v("Mostrando "+a._s(7*(a.paginaActual-1)+1)+"-"+a._s(Math.min(7*a.paginaActual,a.historialPorFecha.length))+" de "+a._s(a.historialPorFecha.length)+" registros")])]),t("div",{staticClass:"historial-grupos"},a._l(a.historialPaginado,(function(e){return t("div",{key:e.id,staticClass:"historial-grupo",class:{"grupo-expandido":a.esGrupoExpandido(e.id)}},[t("div",{staticClass:"grupo-header",on:{click:function(t){return a.toggleGrupoHistorial(e.id)}}},[t("div",{staticClass:"grupo-fecha"},[t("span",{staticClass:"grupo-fecha-texto"},[a._v(a._s(e.fechaLabel))]),t("span",{staticClass:"grupo-meta"},[a._v(a._s(e.abonos.length)+" "+a._s(1===e.abonos.length?"abono":"abonos"))])]),t("div",{staticClass:"grupo-total"},[a._v("$"+a._s(a.formatNumber(e.totalMonto)))]),t("button",{staticClass:"grupo-toggle",attrs:{type:"button","aria-expanded":a.esGrupoExpandido(e.id)}},[t("i",{class:["fas",a.esGrupoExpandido(e.id)?"fa-chevron-up":"fa-chevron-down"]})])]),t("transition",{attrs:{name:"fade"}},[a.esGrupoExpandido(e.id)?t("div",{staticClass:"grupo-detalle"},[e.cuentas.length?t("div",{staticClass:"grupo-resumen"},a._l(e.cuentas,(function(e){return t("div",{key:e.id,staticClass:"grupo-resumen-item"},[t("div",{staticClass:"resumen-cuenta-info"},[t("span",{staticClass:"resumen-cuenta-fecha"},[a._v(a._s(e.fechaCuentaFormateada))]),null!==e.saldoAntes?t("span",{staticClass:"resumen-cuenta-saldo"},[a._v(" Saldo antes: $"+a._s(a.formatNumber(e.saldoAntes))+" ")]):a._e(),null!==e.saldoDespues?t("span",{staticClass:"resumen-cuenta-saldo"},[a._v(" Saldo despu√©s: $"+a._s(a.formatNumber(e.saldoDespues))+" ")]):a._e()]),t("div",{staticClass:"resumen-cuenta-monto"},[a._v(" $"+a._s(a.formatNumber(e.total))+" ")])])})),0):a._e(),t("div",{staticClass:"grupo-abonos"},a._l(e.abonos,(function(e){return t("div",{key:e.uniqueId,staticClass:"abono-item"},[t("div",{staticClass:"abono-main"},[t("div",{staticClass:"abono-left"},[t("div",{staticClass:"abono-fecha"},[t("span",{staticClass:"fecha-cuenta"},[a._v(a._s(e.fechaCuentaFormateada))]),t("div",{staticClass:"historial-fecha-aplicacion"},[e.editandoFecha?[t("label",{staticClass:"editar-fecha-label"},[a._v(" Fecha de registro "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.fechaEditable,expression:"abono.fechaEditable"}],staticClass:"input-fecha-registro",attrs:{type:"datetime-local"},domProps:{value:e.fechaEditable},on:{input:function(t){t.target.composing||a.$set(e,"fechaEditable",t.target.value)}}})]),t("div",{staticClass:"acciones-edicion-fecha"},[t("button",{staticClass:"btn-guardar-fecha",attrs:{disabled:e.guardandoFecha||!e.fechaEditable},on:{click:function(t){return t.stopPropagation(),a.guardarFechaHistorial(e)}}},[a._v(" "+a._s(e.guardandoFecha?"Guardando...":"Guardar")+" ")]),t("button",{staticClass:"btn-cancelar-fecha",attrs:{disabled:e.guardandoFecha},on:{click:function(t){return t.stopPropagation(),a.cancelarEdicionFechaHistorial(e)}}},[a._v(" Cancelar ")])])]:[t("span",[a._v(a._s(a.formatearFechaHora(e.fechaAplicacion)))]),t("button",{staticClass:"btn-editar-fecha",attrs:{title:"Editar fecha de registro"},on:{click:function(t){return t.stopPropagation(),a.iniciarEdicionFechaHistorial(e)}}},[a._v(" Editar ")])]],2)]),t("div",{staticClass:"abono-descripcion"},[a._v(a._s(e.descripcion))]),e.origenDescripcion?t("div",{staticClass:"abono-origen"},[a._v(a._s(e.origenDescripcion))]):a._e()]),t("div",{staticClass:"abono-right"},[t("div",{staticClass:"abono-monto"},[a._v("$"+a._s(a.formatNumber(e.monto)))]),t("button",{staticClass:"btn-eliminar-abono",attrs:{title:"Eliminar abono"},on:{click:function(t){return t.stopPropagation(),a.eliminarAbonoIndividual(e)}}},[a._v(" üóëÔ∏è ")])])])])})),0)]):a._e()])],1)})),0),a.totalPaginas>1?t("div",{staticClass:"paginacion"},[t("button",{staticClass:"btn-paginacion",attrs:{disabled:1===a.paginaActual},on:{click:a.paginaAnterior}},[a._v(" ‚Üê Anterior ")]),t("div",{staticClass:"paginas-numeros"},a._l(a.totalPaginas,(function(e){return t("button",{key:e,class:["btn-numero-pagina",{activa:e===a.paginaActual}],on:{click:function(t){return a.cambiarPagina(e)}}},[a._v(" "+a._s(e)+" ")])})),0),t("button",{staticClass:"btn-paginacion",attrs:{disabled:a.paginaActual===a.totalPaginas},on:{click:a.paginaSiguiente}},[a._v(" Siguiente ‚Üí ")])]):a._e()]),t("div",{staticClass:"modal-actions"},[t("button",{staticClass:"btn-secondary",on:{click:function(t){a.verHistorial=!1}}},[a._v(" Cerrar ")])])])]):a._e()])},i=[function(){var a=this,t=a._self._c;return t("p",[t("strong",[a._v("Est√° a punto de aplicar los siguientes abonos:")])])},function(){var a=this,t=a._self._c;return t("p",[t("strong",[a._v("Resumen:")])])}],o=(e("d9e2"),e("14d9"),e("13d5"),e("2b0e")),n=e("1494"),r=e("dc59"),c={name:"StashModalV2",props:{cliente:{type:String,required:!0},renderTrigger:{type:Boolean,default:!0}},setup(a){const t=Object(o["ref"])(!1),e=Object(o["ref"])(!1),s=Object(o["ref"])(!1),i=Object(o["ref"])(!1),c=Object(o["ref"])(!1),l=Object(o["ref"])(1),d=7,u=Object(o["ref"])([]),m=Object(o["ref"])(0),p=Object(o["ref"])([]),v=Object(o["ref"])([]),h=Object(o["ref"])({}),f=Object(o["ref"])([]),b=()=>{const a=new Date,t=a.getFullYear(),e=String(a.getMonth()+1).padStart(2,"0"),s=String(a.getDate()).padStart(2,"0");return`${t}-${e}-${s}`},g=Object(o["ref"])({fecha:b(),descripcion:"",monto:null}),C=Object(o["computed"])(()=>a.cliente.charAt(0).toUpperCase()+a.cliente.slice(1)),_=Object(o["computed"])(()=>u.value.reduce((a,t)=>a+(t.monto||0),0)),A=Object(o["computed"])(()=>m.value-_.value),S=Object(o["computed"])(()=>u.value.every(a=>h.value[a.id]&&""!==h.value[a.id])),w=Object(o["computed"])(()=>{if(0===v.value.length)return null;const a=[...v.value].sort((a,t)=>new Date(a.fecha)-new Date(t.fecha));return a[0]||null}),T=Object(o["computed"])(()=>[...v.value].sort((a,t)=>new Date(a.fecha)-new Date(t.fecha))),O=Object(o["computed"])(()=>{if(0===u.value.length||0===T.value.length)return{distribucion:[],totalAplicado:0,sobrante:0};const a=_.value;let t=a;const e=[];for(const s of T.value){if(t<=0)break;const a=s.nuevoSaldoAcumulado;if(a<=0)continue;const i=Math.min(t,a);i>0&&(e.push({cuenta:s,montoAAplicar:Math.round(100*i)/100,saldoAntes:a,saldoDespues:Math.max(0,a-i)}),t-=i)}return{distribucion:e,totalAplicado:Math.round(100*(a-t))/100,sobrante:Math.round(100*t)/100}}),y=Object(o["computed"])(()=>{const a=new Map;f.value.forEach(t=>{const e=P(t.fechaAplicacion||t.fechaOriginal||t.fechaCuenta);if(!e)return;a.has(e)||a.set(e,{id:e,fechaISO:e,totalMonto:0,abonos:[],cuentas:new Map});const s=a.get(e),i=Number(t.monto)||0;s.totalMonto+=i,s.abonos.push(t);const o=t.cuentaId||"sin-cuenta-"+t.uniqueId;var n,r;s.cuentas.has(o)||s.cuentas.set(o,{id:o,cuentaId:t.cuentaId,fechaCuentaFormateada:t.fechaCuentaFormateada,total:0,saldoAntes:null!==(n=t.cuentaSaldoAnterior)&&void 0!==n?n:null,saldoDespues:null!==(r=t.cuentaSaldoDespues)&&void 0!==r?r:null});const c=s.cuentas.get(o);var l,d;(c.total+=i,null===c.saldoAntes&&void 0!==t.cuentaSaldoAnterior)&&(c.saldoAntes=null!==(l=t.cuentaSaldoAnterior)&&void 0!==l?l:null);null===c.saldoDespues&&void 0!==t.cuentaSaldoDespues&&(c.saldoDespues=null!==(d=t.cuentaSaldoDespues)&&void 0!==d?d:null)});const t=Array.from(a.values()).map(a=>({id:a.id,fechaISO:a.fechaISO,fechaLabel:M(a.fechaISO),totalMonto:a.totalMonto,cuentas:Array.from(a.cuentas.values()),abonos:a.abonos.sort((a,t)=>new Date(t.fechaAplicacion)-new Date(a.fechaAplicacion))}));return t.sort((a,t)=>new Date(t.fechaISO)-new Date(a.fechaISO))}),I=Object(o["computed"])(()=>Math.ceil(y.value.length/d)),D=Object(o["computed"])(()=>{const a=(l.value-1)*d,t=a+d;return y.value.slice(a,t)}),$=a=>null===a||void 0===a?"0.00":Math.abs(a).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),j=a=>{if(!a)return"";const[t,e,s]=a.split("-"),i=new Date(t,e-1,s);return i.toLocaleDateString("es-ES",{day:"numeric",month:"short",year:"numeric"})},E=a=>{if(!a)return"";const t=new Date(a);return 0===t.getHours()&&0===t.getMinutes()&&0===t.getSeconds()?t.toLocaleDateString("es-ES",{day:"numeric",month:"short",year:"numeric",timeZone:"UTC"}):t.toLocaleString("es-ES")},M=a=>{if(!a)return"";const t=new Date(a);return Number.isNaN(t.getTime())?"":t.toLocaleDateString("es-ES",{day:"numeric",month:"short",year:"numeric",timeZone:"UTC"})},F=a=>{if(!a)return"";const t=new Date(a),e=new Date,s=new Date(e);s.setDate(s.getDate()-1);const i=new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()),o=new Date(e.getFullYear(),e.getMonth(),e.getDate()),n=new Date(s.getFullYear(),s.getMonth(),s.getDate());return i.getTime()===o.getTime()?"Hoy":i.getTime()===n.getTime()?"Ayer":t.toLocaleDateString("es-ES",{day:"numeric",month:"short",year:t.getUTCFullYear()!==e.getFullYear()?"numeric":void 0,timeZone:"UTC"})},N=a=>a?new Date(a).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"}):"",k=a=>{if(!a)return(new Date).toISOString();if(a.includes("T"))return a;const[t,e,s]=a.split("-").map(Number);if(!t||!e||!s)return(new Date).toISOString();const i=a=>String(a).padStart(2,"0");return`${t}-${i(e)}-${i(s)}T00:00:00`},P=a=>{if(!a)return"";const t=new Date(a);if(Number.isNaN(t.getTime()))return"";const e=a=>String(a).padStart(2,"0"),s=t.getUTCFullYear(),i=e(t.getUTCMonth()+1),o=e(t.getUTCDate());return`${s}-${i}-${o}`},x=a=>{if(!a)return"";const t=new Date(a);if(Number.isNaN(t.getTime()))return"";const e=a=>String(a).padStart(2,"0"),s=t.getFullYear(),i=e(t.getMonth()+1),o=e(t.getDate()),n=e(t.getHours()),r=e(t.getMinutes());return`${s}-${i}-${o}T${n}:${r}`},L=a=>{a.mostrarDetalle=!a.mostrarDetalle},z=a=>{if(!a||""===a)return"Sin fecha seleccionada";const t=v.value.find(t=>t.id===a);return t?t.fechaFormateada:"Fecha no encontrada"},V=a=>{const t=h.value[a];console.log(`Fecha de aplicaci√≥n cambiada para item ${a}:`,t),h.value={...h.value}},R=async()=>{try{const t=Object(n["o"])(Object(n["c"])(r["a"],"stash_"+a.cliente),Object(n["l"])("fecha","desc")),e=await Object(n["g"])(t);u.value=e.docs.map(a=>({id:a.id,...a.data()})),u.value.forEach(a=>{h.value[a.id]||(h.value[a.id]="")})}catch(t){console.error("Error cargando stash:",t)}},H=async()=>{try{const t="cuentas"+(a.cliente.charAt(0).toUpperCase()+a.cliente.slice(1)),e=Object(n["o"])(Object(n["c"])(r["a"],t),Object(n["l"])("fecha","desc"),Object(n["j"])(1)),s=await Object(n["g"])(e);if(s.empty)m.value=0;else{const a=s.docs[0].data();if("number"===typeof a.nuevoSaldoAcumulado)m.value=a.nuevoSaldoAcumulado;else{const t=(a.cobros||[]).reduce((a,t)=>a+(parseFloat(t.monto)||0),0),e=(a.abonos||[]).reduce((a,t)=>a+(parseFloat(t.monto)||0),0),s=(a.totalGeneralVenta||0)-t-e;m.value=(a.saldoAcumuladoAnterior||0)+s}}}catch(t){console.error("Error cargando saldo:",t),m.value=0}},q=async()=>{try{const t=Object(n["o"])(Object(n["c"])(r["a"],"historial_aplicaciones_"+a.cliente),Object(n["l"])("fechaAplicacion","desc"),Object(n["j"])(20)),e=await Object(n["g"])(t);p.value=e.docs.map(a=>({id:a.id,...a.data(),mostrarDetalle:!1}))}catch(t){console.error("Error cargando historial:",t)}},U=async()=>{try{const t="cuentas"+(a.cliente.charAt(0).toUpperCase()+a.cliente.slice(1)),e=Object(n["o"])(Object(n["c"])(r["a"],t),Object(n["l"])("fecha","desc"),Object(n["j"])(50)),s=await Object(n["g"])(e),i=[];s.docs.forEach(a=>{const t=a.data(),e=a.id,s=t.fecha,o=j(s);t.abonos&&t.abonos.length>0&&t.abonos.forEach((a,n)=>{i.push({uniqueId:`${e}_${n}_${a.id||Date.now()}`,cuentaId:e,fechaCuenta:s,fechaCuentaFormateada:o,fechaAplicacion:a.fecha||a.fechaAplicacion||(new Date).toISOString(),fechaOriginal:a.fecha||null,cuentaTotal:t.totalGeneralVenta||0,cuentaSaldoAnterior:"number"===typeof t.saldoAcumuladoAnterior?t.saldoAcumuladoAnterior:null,cuentaSaldoDespues:"number"===typeof t.nuevoSaldoAcumulado?t.nuevoSaldoAcumulado:null,descripcion:a.descripcion||"Sin descripci√≥n",monto:a.monto||0,abonoId:a.id,abonoIndex:n,esAplicacionIndividual:a.esAplicacionIndividual||!1,origenDescripcion:a.fechaOriginalStash?`Stash (${j(a.fechaOriginalStash)})`:a.esAplicacionIndividual?"Aplicaci√≥n individual":"Aplicaci√≥n en cascada"})})});const o=i.sort((a,t)=>new Date(t.fechaAplicacion)-new Date(a.fechaAplicacion));f.value=o.map(a=>({...a,fechaAplicacion:a.fechaAplicacion,fechaEditable:x(a.fechaAplicacion),editandoFecha:!1,guardandoFecha:!1})),sa.value={}}catch(t){console.error("Error cargando todos los abonos:",t)}},G=async()=>{try{const t="cuentas"+(a.cliente.charAt(0).toUpperCase()+a.cliente.slice(1)),e=Object(n["o"])(Object(n["c"])(r["a"],t),Object(n["l"])("fecha","desc"),Object(n["j"])(50)),s=await Object(n["g"])(e);v.value=s.docs.map(a=>({id:a.id,fecha:a.data().fecha,totalGeneralVenta:a.data().totalGeneralVenta||0,fechaFormateada:j(a.data().fecha),estadoPagado:a.data().estadoPagado,nuevoSaldoAcumulado:a.data().nuevoSaldoAcumulado||0})).filter(a=>!a.estadoPagado&&a.nuevoSaldoAcumulado>0).sort((a,t)=>new Date(t.fecha)-new Date(a.fecha))}catch(t){console.error("Error cargando cuentas disponibles:",t)}},Y=async()=>{if(g.value.fecha&&g.value.descripcion&&g.value.monto)try{const t=k(g.value.fecha),e=await Object(n["b"])(Object(n["c"])(r["a"],"stash_"+a.cliente),{fecha:g.value.fecha,descripcion:g.value.descripcion,monto:Number(g.value.monto),fechaCreacion:t}),s={id:e.id,fecha:g.value.fecha,descripcion:g.value.descripcion,monto:Number(g.value.monto)};u.value.unshift(s),h.value[e.id]="",g.value={fecha:b(),descripcion:"",monto:null},alert("Abono agregado al stash")}catch(t){console.error("Error agregando al stash:",t),alert("Error al agregar el abono")}else alert("Por favor complete todos los campos")},K=async t=>{if(confirm("¬øEliminar este abono del stash?"))try{await Object(n["d"])(Object(n["e"])(r["a"],"stash_"+a.cliente,t)),u.value=u.value.filter(a=>a.id!==t),delete h.value[t]}catch(e){console.error("Error eliminando del stash:",e),alert("Error al eliminar")}},B=()=>{S.value?e.value=!0:alert("Por favor selecciona una fecha de aplicaci√≥n para todos los abonos del stash.")},J=async()=>{if(!w.value)return void alert("No hay cuentas pendientes de pago disponibles.");if(0===u.value.length)return void alert("No hay abonos en el stash para aplicar.");const a=O.value;let t=`Se aplicar√°n $${$(_.value)} del stash de la siguiente manera:\n\n`;a.distribucion.forEach((a,e)=>{t+=`${e+1}. ${a.cuenta.fechaFormateada}: $${$(a.montoAAplicar)}\n`,t+=`   Saldo antes: $${$(a.saldoAntes)}\n`,t+=`   Saldo despu√©s: $${$(a.saldoDespues)}\n\n`}),a.sobrante>0&&(t+=`‚ö†Ô∏è Sobrante sin aplicar: $${$(a.sobrante)}\n`,t+="(No hay m√°s cuentas pendientes)\n\n"),t+="¬øContinuar con la aplicaci√≥n?";const e=confirm(t);if(e)try{await Z();let t="Abonos aplicados exitosamente:\n";a.distribucion.forEach((a,e)=>{t+=`‚Ä¢ ${a.cuenta.fechaFormateada}: $${$(a.montoAAplicar)}\n`}),a.sobrante>0&&(t+="\n‚ö†Ô∏è Sobrante: $"+$(a.sobrante)),alert(t)}catch(s){console.error("Error aplicando abonos en cascada:",s),alert("Error al aplicar los abonos. Por favor, intente nuevamente.")}},Z=async()=>{if(!i.value){i.value=!0;try{const t="cuentas"+(a.cliente.charAt(0).toUpperCase()+a.cliente.slice(1)),e=[],s=[...T.value],o=u.value.map(a=>({...a,montoRestante:a.monto}));console.log("Iniciando aplicaci√≥n en cascada:",{totalStash:_.value,cuentasDisponibles:s.length,abonosPendientes:o.length});for(const a of s){if(0===o.length)break;const s=Object(n["e"])(r["a"],t,a.id),i=await Object(n["f"])(s);if(!i.exists()){console.warn(`Cuenta ${a.id} no encontrada, saltando...`);continue}const c=i.data(),l=(c.abonos||[]).reduce((a,t)=>a+(t.monto||0),0),d=(c.cobros||[]).reduce((a,t)=>a+(t.monto||0),0),u=(c.totalGeneralVenta||0)-d-l;let m=(c.saldoAcumuladoAnterior||0)+u;if(console.log(`Procesando cuenta ${a.id}:`,{fechaCuenta:a.fecha,saldoInicial:m,abonosPendientes:o.length}),m<=0){console.log(`Cuenta ${a.id} ya est√° pagada, saltando...`);continue}const p=[];let v=0,h=0;while(h<o.length&&m>0){const a=o[h],t=Math.min(a.montoRestante,m);t>.01&&(p.push({descripcion:a.descripcion,monto:Math.round(100*t)/100,fecha:k(a.fecha),fechaOriginalStash:a.fecha}),v+=Math.round(100*t)/100,m-=Math.round(100*t)/100,a.montoRestante-=Math.round(100*t)/100,console.log(`  Aplicando ${t} de abono "${a.descripcion}"`,{montoRestanteAbono:a.montoRestante,saldoRestanteCuenta:m})),a.montoRestante<=.01?o.splice(h,1):h++}if(p.length>0){const s=(c.saldoAcumuladoAnterior||0)+u,i=s-v;console.log(`Aplicando ${p.length} abonos a cuenta ${a.id}:`,{totalAplicado:v,saldoAntes:s,saldoDespues:i}),await Q(a.id,p,t),e.push({cuentaId:a.id,fecha:a.fecha,abonos:p,totalAplicado:v,saldoAntes:s,saldoDespues:Math.max(0,i)})}}const c=e.reduce((a,t)=>a+t.totalAplicado,0),l=o.reduce((a,t)=>a+t.montoRestante,0);console.log("Aplicaci√≥n en cascada completada:",{totalAplicado:c,sobrante:l,cuentasAfectadas:e.length}),await X(e,"cascada"),await W(),await Promise.all([R(),H(),G()])}catch(t){throw console.error("Error en aplicaci√≥n en cascada:",t),t}finally{i.value=!1}}},Q=async(a,t,e)=>{const s=Object(n["e"])(r["a"],e,a),i=await Object(n["f"])(s);if(!i.exists())throw new Error(`Cuenta ${a} no encontrada`);const o=i.data(),c=o.abonos||[],l=[...c,...t],d=l.reduce((a,t)=>a+(t.monto||0),0),u=(o.cobros||[]).reduce((a,t)=>a+(t.monto||0),0),m=(o.totalGeneralVenta||0)-u-d,p=(o.saldoAcumuladoAnterior||0)+m;await Object(n["s"])(s,{abonos:l,nuevoSaldoAcumulado:Math.max(0,p),estadoPagado:p<=0,ultimaActualizacion:(new Date).toISOString()})},X=async(t,e="cascada")=>{try{await Object(n["b"])(Object(n["c"])(r["a"],"historial_aplicaciones_"+a.cliente),{tipo:e,fecha:(new Date).toISOString(),abonosAplicados:t,totalAplicado:t.reduce((a,t)=>a+t.totalAplicado,0),cuentasAfectadas:t.length,descripcion:`Aplicaci√≥n en ${e} a ${t.length} cuenta(s)`})}catch(s){console.error("Error registrando en historial:",s)}},W=async()=>{try{await Promise.all(u.value.map(t=>Object(n["d"])(Object(n["e"])(r["a"],"stash_"+a.cliente,t.id)))),u.value=[],h.value={}}catch(t){throw console.error("Error limpiando stash:",t),t}},aa=async()=>{if(!i.value){i.value=!0,e.value=!1;try{const t="cuentas"+(a.cliente.charAt(0).toUpperCase()+a.cliente.slice(1)),e=[],s=[],o={};u.value.forEach(a=>{const t=h.value[a.id];o[t]||(o[t]=[]),o[t].push(a)});for(const[a,i]of Object.entries(o)){const o=Object(n["e"])(r["a"],t,a),c=await Object(n["f"])(o);if(!c.exists())throw new Error("No se encontr√≥ la cuenta con ID: "+a);const l=c.data(),d=[...l.abonos||[]];i.forEach(t=>{const s=`stash_individual_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,i={id:s,descripcion:t.descripcion+" (Aplicaci√≥n Individual)",monto:t.monto,fecha:k(t.fecha),fechaOriginalStash:t.fecha,esAplicacionIndividual:!0};d.push(i),e.push({...t,abonoId:s,cuentaId:a,fechaAplicacion:l.fecha})}),await Object(n["s"])(o,{abonos:d,ultimaActualizacion:(new Date).toISOString()}),s.push({id:a,fecha:l.fecha,abonos:i.length})}await Object(n["b"])(Object(n["c"])(r["a"],"historial_aplicaciones_"+a.cliente),{fechaAplicacion:(new Date).toISOString(),modo:"individual",montoTotal:_.value,items:e,cuentasAfectadas:s,exitoso:!0,saldoAnterior:m.value,saldoNuevo:A.value});for(const i of u.value)await Object(n["d"])(Object(n["e"])(r["a"],"stash_"+a.cliente,i.id));u.value=[],h.value={},await H(),await q(),alert(`‚úÖ Abonos aplicados correctamente de forma individual\n\nTotal aplicado: $${$(_.value)}\nAplicados a ${Object.keys(o).length} cuentas diferentes\nNuevo saldo: $${$(m.value)}`)}catch(t){console.error("Error aplicando abonos individuales:",t),alert("Error al aplicar los abonos: "+t.message),await Object(n["b"])(Object(n["c"])(r["a"],"historial_aplicaciones_"+a.cliente),{fechaAplicacion:(new Date).toISOString(),modo:"individual",montoTotal:_.value,items:u.value,exitoso:!1,error:t.message})}finally{i.value=!1}}},ta=async t=>{var e;const s="individual"===t.modo,i=s?`¬øEliminar este registro del historial y revertir los abonos individuales?\n\nEsto eliminar√° ${(null===(e=t.items)||void 0===e?void 0:e.length)||0} abonos de las cuentas afectadas.`:`¬øEliminar este registro del historial y revertir el abono de $${$(t.montoTotal)}?\n\nEsto eliminar√° el abono de la cuenta y actualizar√° el saldo.`;if(confirm(i))try{const e="cuentas"+(a.cliente.charAt(0).toUpperCase()+a.cliente.slice(1));if(s&&t.items){for(const a of t.items)if(a.cuentaId&&a.abonoId){const t=Object(n["e"])(r["a"],e,a.cuentaId),s=await Object(n["f"])(t);if(s.exists()){const e=s.data(),i=(e.abonos||[]).filter(t=>t.id!==a.abonoId);await Object(n["s"])(t,{abonos:i,ultimaActualizacion:(new Date).toISOString()})}}}else if(t.cuentaAfectada&&t.abonoId){const a=Object(n["e"])(r["a"],e,t.cuentaAfectada),s=await Object(n["f"])(a);if(s.exists()){const e=s.data(),i=(e.abonos||[]).filter(a=>a.id!==t.abonoId);await Object(n["s"])(a,{abonos:i,ultimaActualizacion:(new Date).toISOString()})}}await Object(n["d"])(Object(n["e"])(r["a"],"historial_aplicaciones_"+a.cliente,t.id)),await H(),await q();const i=s?"‚úÖ Registro eliminado del historial y abonos individuales revertidos\n\nMonto revertido: $"+$(t.montoTotal):"‚úÖ Registro eliminado del historial y abono revertido\n\nMonto revertido: $"+$(t.montoTotal);alert(i)}catch(o){console.error("Error eliminando del historial:",o),alert("Error al eliminar el registro: "+o.message)}},ea=async t=>{const e=confirm(`¬øEliminar este abono?\n\nCuenta: ${t.fechaCuentaFormateada}\nDescripci√≥n: ${t.descripcion}\nMonto: $${$(t.monto)}\n\nEsta acci√≥n actualizar√° el saldo de la cuenta.`);if(e)try{const e="cuentas"+(a.cliente.charAt(0).toUpperCase()+a.cliente.slice(1)),s=Object(n["e"])(r["a"],e,t.cuentaId),i=await Object(n["f"])(s);if(!i.exists())return void alert("Error: No se encontr√≥ la cuenta.");const o=i.data();let c=[...o.abonos||[]];t.abonoId?c=c.filter(a=>a.id!==t.abonoId):c.splice(t.abonoIndex,1);const l=c.reduce((a,t)=>a+(t.monto||0),0),d=(o.cobros||[]).reduce((a,t)=>a+(t.monto||0),0),u=(o.totalGeneralVenta||0)-d-l,m=(o.saldoAcumuladoAnterior||0)+u;await Object(n["s"])(s,{abonos:c,nuevoSaldoAcumulado:Math.max(0,m),estadoPagado:m<=0,ultimaActualizacion:(new Date).toISOString()}),await Object(n["b"])(Object(n["c"])(r["a"],"historial_aplicaciones_"+a.cliente),{fechaAplicacion:(new Date).toISOString(),modo:"eliminacion_abono",abonoEliminado:{descripcion:t.descripcion,monto:t.monto,fechaCuenta:t.fechaCuenta,fechaCuentaFormateada:t.fechaCuentaFormateada},cuentaAfectada:t.cuentaId,nuevoSaldo:m,exitoso:!0}),await Promise.all([U(),H(),G()]),alert(`‚úÖ Abono eliminado exitosamente\n\nSe elimin√≥: $${$(t.monto)}\nDe la cuenta: ${t.fechaCuentaFormateada}`)}catch(s){console.error("Error eliminando abono:",s),alert("Error al eliminar el abono: "+s.message)}},sa=Object(o["ref"])({}),ia=a=>{a.editandoFecha=!0,a.guardandoFecha=!1,a.fechaEditable=x(a.fechaAplicacion)},oa=a=>{a.editandoFecha=!1,a.guardandoFecha=!1,a.fechaEditable=x(a.fechaAplicacion)},na=async t=>{if(!t||!t.cuentaId)return void alert("No se pudo identificar la cuenta del abono.");if(!t.fechaEditable)return void alert("Selecciona una fecha y hora v√°lidas.");const e=new Date(t.fechaEditable);if(Number.isNaN(e.getTime()))alert("La fecha ingresada no es v√°lida.");else if(!t.guardandoFecha){t.guardandoFecha=!0;try{const e=k(t.fechaEditable),i="cuentas"+(a.cliente.charAt(0).toUpperCase()+a.cliente.slice(1)),o=Object(n["e"])(r["a"],i,t.cuentaId),c=await Object(n["f"])(o);if(!c.exists())throw new Error("No se encontr√≥ la cuenta asociada al abono.");const l=c.data(),d=[...l.abonos||[]];let u=-1;var s;if(t.abonoId&&(u=d.findIndex(a=>a.id===t.abonoId)),-1===u)u=null!==(s=t.abonoIndex)&&void 0!==s?s:-1;if(u<0||!d[u])throw new Error("No se pudo localizar el abono dentro de la cuenta.");const m={...d[u],fecha:e,fechaAplicacion:e};d.splice(u,1,m),await Object(n["s"])(o,{abonos:d,ultimaActualizacion:(new Date).toISOString()}),t.fechaAplicacion=e,t.fechaOriginal=e,t.fechaEditable=x(e),t.editandoFecha=!1,f.value=[...f.value].map(a=>a.uniqueId===t.uniqueId?{...a,...t}:a).sort((a,t)=>new Date(t.fechaAplicacion)-new Date(a.fechaAplicacion)),alert("Fecha de registro actualizada.")}catch(i){console.error("Error al actualizar la fecha del abono:",i),alert("No fue posible actualizar la fecha. Intenta nuevamente.")}finally{t.guardandoFecha=!1}}},ra=a=>{const t=!!sa.value[a];sa.value={...sa.value,[a]:!t}},ca=a=>!!sa.value[a],la=a=>{a>=1&&a<=I.value&&(l.value=a)},da=()=>{l.value>1&&l.value--},ua=()=>{l.value<I.value&&l.value++},ma=async()=>{t.value=!0;try{const a=document&&document.body;a&&(a.dataset.prevOverflow=a.style.overflow||"",a.style.overflow="hidden")}catch(a){}try{await Promise.all([R(),H(),G(),U(),q()])}catch(e){console.error("Error al preparar el modal de stash:",e)}},pa=()=>{t.value=!1,e.value=!1,s.value=!1,l.value=1;try{const a=document&&document.body;a&&(a.style.overflow=a.dataset.prevOverflow||"",delete a.dataset.prevOverflow)}catch(a){}};return Object(o["onMounted"])(()=>{R(),H(),q(),G(),U()}),{showModal:t,mostrarConfirmacion:e,verHistorial:s,isAplicando:i,mostrarSeleccionFechas:c,stashItems:u,saldoActual:m,historialAplicaciones:p,cuentasDisponibles:v,fechasAplicacion:h,nuevoAbono:g,todosLosAbonos:f,clienteNombre:C,totalStash:_,saldoResultante:A,todasFechasSeleccionadas:S,cuentaMasAntiguaNoPagada:w,cuentasOrdenadasPorFecha:T,distribucionAbonos:O,historialPorFecha:y,historialPaginado:D,totalPaginas:I,paginaActual:l,formatNumber:$,formatearFecha:j,formatearFechaHora:E,formatearFechaHistorialCabecera:M,formatearFechaDia:F,formatearHora:N,verDetalleHistorial:L,obtenerFechaCuenta:z,onFechaAplicacionChange:V,cargarStash:R,cargarSaldoActual:H,cargarCuentasDisponibles:G,agregarAlStash:Y,eliminarDelStash:K,validarYMostrarConfirmacion:B,aplicarACuentaMasAntigua:J,aplicarAbonosIndividuales:aa,eliminarDelHistorial:ta,eliminarAbonoIndividual:ea,iniciarEdicionFechaHistorial:ia,cancelarEdicionFechaHistorial:oa,guardarFechaHistorial:na,toggleGrupoHistorial:ra,esGrupoExpandido:ca,cargarTodosLosAbonos:U,abrirModal:ma,cerrarModal:pa,cambiarPagina:la,paginaAnterior:da,paginaSiguiente:ua}}},l=c,d=(e("c8f0"),e("2877")),u=Object(d["a"])(l,s,i,!1,null,"134988fe",null);t["a"]=u.exports},4593:function(a,t,e){"use strict";e("5483")},5483:function(a,t,e){},"56d7":function(a,t,e){"use strict";e.r(t);var s=e("2b0e"),i=e("3dfd"),o=e("41cb"),n=e("be92"),r=e("f549"),c=e("5f5b"),l=e("b1e0");e("f9e3"),e("2dd8"),e("15f5");s["default"].use(c["a"]),s["default"].use(l["a"]),s["default"].use(n["a"]);const d=Object(n["b"])();s["default"].config.productionTip=!1;new s["default"]({router:o["a"],pinia:d,render:a=>a(i["a"]),created(){const a=localStorage.getItem("user");if(a){const a=Object(r["useAuthStore"])();a.checkAuth()}}}).$mount("#app");window.fabric||e.e("chunk-2d0a385c").then(e.bind(null,"0314")).then(a=>{window.fabric=a.fabric,console.log("Fabric.js cargado globalmente")}).catch(a=>{console.error("Error al cargar Fabric.js:",a)}),window.pdfMake||Promise.all([Promise.resolve().then(e.t.bind(null,"e499",7)),Promise.resolve().then(e.t.bind(null,"4ebb",7))]).then(([a,t])=>{window.pdfMake=a.default||a,t.default?window.pdfMake.vfs=t.default:t.pdfMake&&t.pdfMake.vfs?window.pdfMake.vfs=t.pdfMake.vfs:window.pdfMake.vfs=t,console.log("pdfMake cargado globalmente")}).catch(a=>{console.error("Error al cargar pdfMake:",a),console.log("Usando versi√≥n de CDN si est√° disponible")})},"5ea5":function(a,t,e){"use strict";var s=function(){var a=this,t=a._self._c;return t("div",{staticClass:"sidebar-clientes",class:{"sidebar-collapsed":a.sidebarCollapsed}},[t("div",{staticClass:"sidebar-header"},[a._m(0),t("button",{staticClass:"toggle-sidebar-btn",attrs:{title:a.sidebarCollapsed?"Expandir":"Colapsar"},on:{click:a.toggleSidebar}},[t("i",{staticClass:"fas",class:a.sidebarCollapsed?"fa-chevron-right":"fa-chevron-left"})])]),t("div",{staticClass:"sidebar-clientes-contenido"},[a._l(a.clientesPredefinidos,(function(e){return t("button",{key:"predefinido-"+e.id,staticClass:"btn-nota-cliente",class:{activo:a.clienteActivoLocal===e.id.toString()},style:{backgroundColor:e.color,color:e.textColor},attrs:{type:"button",title:a.sidebarCollapsed?e.nombre:""},on:{click:function(t){a.seleccionarCliente(e.id.toString())}}},[a.sidebarCollapsed?t("i",{staticClass:"fas fa-user-circle"}):t("span",[a._v(a._s(e.nombre))])])})),a._l(a.clientesPersonalizadosEmbarque,(function(e){return t("button",{key:"personalizado-"+e.id,staticClass:"btn-nota-cliente cliente-personalizado",class:{activo:a.clienteActivoLocal===e.id.toString()},style:{backgroundColor:a.obtenerColorCliente(e.nombre),color:a.obtenerColorTextoCliente(e.nombre)},attrs:{type:"button",title:a.sidebarCollapsed?e.nombre:""},on:{click:function(t){a.seleccionarCliente(e.id.toString())}}},[a.sidebarCollapsed?t("i",{staticClass:"fas fa-user-circle"}):t("span",[a._v(a._s(e.nombre))])])})),t("button",{staticClass:"btn-agregar-cliente",attrs:{type:"button",title:a.sidebarCollapsed?"Agregar Cliente":""},on:{click:a.mostrarModalNuevoCliente}},[t("i",{staticClass:"fas fa-plus"}),a.sidebarCollapsed?a._e():t("span",[a._v("Agregar Cliente")])])],2),t("div",{staticClass:"sidebar-toggle-mobile"},[t("button",{staticClass:"toggle-sidebar-mobile-btn",on:{click:a.toggleSidebar}},[t("i",{staticClass:"fas",class:a.sidebarCollapsed?"fa-chevron-right":"fa-chevron-left"})])]),t("div",{staticClass:"sidebar-resumen",class:{"resumen-collapsed":a.sidebarCollapsed}},[t("div",{staticClass:"resumen-seccion"},[a._m(1),t("div",{staticClass:"sidebar-item"},[t("span",[a._v("Limpio:")]),t("strong",[a._v(a._s(a.calcularTarasLimpio()))])]),t("div",{staticClass:"sidebar-item"},[t("span",[a._v("Crudo:")]),t("strong",[a._v(a._s(a.calcularTarasCrudo()))])]),t("div",{staticClass:"sidebar-item total"},[t("span",[a._v("Total:")]),t("strong",[a._v(a._s(a.calcularTotalTaras())+"-T")])])]),t("div",{staticClass:"resumen-seccion"},[a._m(2),t("div",{staticClass:"sidebar-item"},[t("span",[a._v("Limpio:")]),t("strong",[a._v(a._s(Math.floor(a.calcularKilosLimpio())))])]),t("div",{staticClass:"sidebar-item"},[t("span",[a._v("Crudo:")]),t("strong",[a._v(a._s(a.calcularKilosCrudo()))])]),t("div",{staticClass:"sidebar-item total"},[t("span",[a._v("Total:")]),t("strong",[a._v(a._s(Math.floor(a.calcularTotalKilos())))])])])])])},i=[function(){var a=this,t=a._self._c;return t("h3",[t("i",{staticClass:"fas fa-users"}),a._v(" Clientes")])},function(){var a=this,t=a._self._c;return t("h4",[t("i",{staticClass:"fas fa-balance-scale"}),a._v(" Resumen Taras")])},function(){var a=this,t=a._self._c;return t("h4",[t("i",{staticClass:"fas fa-weight"}),a._v(" Resumen Kilos")])}],o=(e("13d5"),{name:"Sidebar",props:{embarque:{type:Object,required:!0},clientesPredefinidos:{type:Array,required:!0},clientesPersonalizadosEmbarque:{type:Array,required:!0},clienteCrudos:{type:Object,required:!0},clienteActivo:{type:String,default:null}},data(){return{sidebarCollapsed:!1,clienteActivoLocal:null}},created(){this.clienteActivoLocal=this.clienteActivo},watch:{clienteActivo(a){this.clienteActivoLocal=a}},methods:{toggleSidebar(){this.sidebarCollapsed=!this.sidebarCollapsed,this.$emit("toggle-sidebar",this.sidebarCollapsed)},seleccionarCliente(a){this.clienteActivoLocal=a,this.$emit("seleccionar-cliente",a)},mostrarModalNuevoCliente(){this.$emit("mostrar-modal-nuevo-cliente")},obtenerColorCliente(a){const t={Joselito:"#3498db",Catarro:"#e74c3c",Otilio:"#f1c40f",Ozuna:"#2ecc71",Canelo:"#9b59b6"};return t[a]||"#95a5a6"},obtenerColorTextoCliente(a){const t={Otilio:"black"};return t[a]||"white"},calcularTarasLimpio(){return this.embarque.productos.reduce((a,t)=>{const e=t.clienteId,s=this.clientesPredefinidos.find(a=>a.id.toString()===e.toString());return s?a+this.totalTaras(t):a},0)},calcularTarasCrudo(){return Object.entries(this.clienteCrudos).reduce((a,[t,e])=>{const s=this.clientesPredefinidos.find(a=>a.id.toString()===t.toString());return s?a+e.reduce((a,t)=>a+this.calcularTotalCrudos(t),0):a},0)},calcularTotalTaras(){return this.calcularTarasLimpio()+this.calcularTarasCrudo()},calcularKilosLimpio(){return this.embarque.productos.reduce((a,t)=>{const e=t.clienteId,s=this.clientesPredefinidos.find(a=>a.id.toString()===e.toString());if(!s)return a;if("c/h20"===t.tipo){const e=t.reporteTaras||[],s=t.reporteBolsas||[];let i=0;for(let a=0;a<e.length;a++){const t=parseInt(e[a])||0,o=parseInt(s[a])||0;i+=t*o}const o=i*(t.camaronNeto||.65);return a+o}return a+this.totalKilos(t)},0)},calcularKilosCrudo(){return Object.entries(this.clienteCrudos).reduce((a,[t,e])=>{const s=this.clientesPredefinidos.find(a=>a.id.toString()===t.toString());return s?a+e.reduce((a,t)=>t&&t.items&&Array.isArray(t.items)?a+t.items.reduce((a,t)=>a+this.calcularKilosCrudos(t),0):a,0):a},0)},calcularTotalKilos(){const a=parseFloat(this.calcularKilosLimpio()),t=parseFloat(this.calcularKilosCrudo());return a+t},totalTaras(a){const t=(a.taras||[]).reduce((a,t)=>a+(t||0),0),e=(a.tarasExtra||[]).reduce((a,t)=>a+(t||0),0);return t+e},totalKilos(a){const t=(a.kilos||[]).reduce((a,t)=>a+(t||0),0),e=(a.taras||[]).reduce((a,t)=>a+(t||0),0),s=a.restarTaras?3*e:0;return Number((t-s).toFixed(1))},calcularTotalCrudos(a){return a&&a.items&&Array.isArray(a.items)?a.items.reduce((a,t)=>{let e=this.extraerNumero(t.taras),s=this.extraerNumero(t.sobrante);return a+e+s},0):0},calcularKilosCrudos(a){let t=0;if(a.taras){const e=/^(\d+)-(\d+)$/.exec(a.taras);if(e){const a=parseInt(e[1])||0;let s=parseInt(e[2])||0;19===s&&(s=20),t+=a*s}else{const[e,s]=a.taras.split("-").map(Number);t+=e*s}}if(a.sobrante){const e=/^(\d+)-(\d+)$/.exec(a.sobrante);if(e){const a=parseInt(e[1])||0;let s=parseInt(e[2])||0;19===s&&(s=20),t+=a*s}else{const[e,s]=a.sobrante.split("-").map(Number);t+=e*s}}return t},extraerNumero(a){if(!a)return 0;const t=a.toString().match(/^(\d+)/);return t?parseInt(t[1]):0}}}),n=o,r=(e("052f"),e("a277"),e("2877")),c=Object(r["a"])(n,s,i,!1,null,"c4c4e3c8",null);t["a"]=c.exports},"62aa":function(a,t,e){"use strict";e("2e89")},6521:function(a,t,e){"use strict";var s=function(){var a=this,t=a._self._c;return t("transition",{attrs:{name:"fade"}},[a.visible?t("div",{staticClass:"save-status-indicator",class:a.statusClass},[t("div",{staticClass:"status-content"},[t("div",{staticClass:"status-icon"},["saving"===a.status?t("i",{staticClass:"fas fa-spinner fa-spin"}):"success"===a.status?t("i",{staticClass:"fas fa-check-circle"}):"error"===a.status?t("i",{staticClass:"fas fa-exclamation-triangle"}):"quota"===a.status?t("i",{staticClass:"fas fa-pause-circle"}):"pending"===a.status?t("i",{staticClass:"fas fa-clock"}):a._e()]),t("div",{staticClass:"status-message"},[t("div",{staticClass:"status-text"},[a._v(a._s(a.message))]),a.details?t("div",{staticClass:"status-details"},[a._v(a._s(a.details))]):a._e()]),a.pendingCount>0?t("div",{staticClass:"pending-indicator"},[t("span",{staticClass:"pending-badge"},[a._v(a._s(a.pendingCount))])]):a._e()]),a.showProgress?t("div",{staticClass:"progress-bar"},[t("div",{staticClass:"progress-fill",style:{width:a.progressPercent+"%"}})]):a._e()]):a._e()])},i=[],o=(e("14d9"),e("d954"));const n=!1;var r={name:"SaveStatusIndicator",data(){return{visible:!1,status:"idle",message:"",details:"",pendingCount:0,showProgress:!1,progressPercent:0,hideTimeout:null,progressInterval:null,saveManager:null,unsubscribers:[],componentId:`SaveStatusIndicator-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,debug:n}},computed:{statusClass(){return{"status-saving":"saving"===this.status,"status-success":"success"===this.status,"status-error":"error"===this.status,"status-quota":"quota"===this.status,"status-pending":"pending"===this.status}}},mounted(){this.debug&&console.log(`[SaveStatusIndicator ${this.componentId}] Montando componente`),window.__saveStatusIndicatorActive&&window.__saveStatusIndicatorActive!==this.componentId?this.debug&&console.warn(`[SaveStatusIndicator ${this.componentId}] Ya existe otra instancia activa (${window.__saveStatusIndicatorActive}), esta instancia no se activar√°`):(window.__saveStatusIndicatorActive=this.componentId,this.$nextTick(()=>{try{this.saveManager=Object(o["a"])(),this.saveManager?(this.debug&&console.log(`[SaveStatusIndicator ${this.componentId}] SaveManager obtenido, configurando listeners`),this.setupListeners()):(this.debug&&console.warn(`[SaveStatusIndicator ${this.componentId}] No se pudo obtener la instancia del SaveManager`),setTimeout(()=>{window.__saveStatusIndicatorActive===this.componentId?(this.saveManager=Object(o["a"])(),this.saveManager&&(this.debug&&console.log(`[SaveStatusIndicator ${this.componentId}] SaveManager obtenido en reintento, configurando listeners`),this.setupListeners())):this.debug&&console.log(`[SaveStatusIndicator ${this.componentId}] Ya no es la instancia activa, cancelando reintento`)},500))}catch(a){console.error(`[SaveStatusIndicator ${this.componentId}] Error al inicializar SaveManager:`,a)}}))},beforeDestroy(){this.debug&&console.log(`[SaveStatusIndicator ${this.componentId}] Destruyendo componente`),window.__saveStatusIndicatorActive===this.componentId&&(window.__saveStatusIndicatorActive=null,this.debug&&console.log(`[SaveStatusIndicator ${this.componentId}] Instancia activa eliminada`)),this.cleanup()},methods:{setupListeners(){if(!this.saveManager)return void(this.debug&&console.warn("[SaveStatusIndicator] SaveManager no est√° inicializado"));this.cleanupListeners();const a=this.saveManager,t=t=>{const e=this.componentId;return s=>{window.__saveStatusIndicatorActive===e&&(!this._isDestroyed&&this.saveManager?t.call(this,s,a):window.__saveStatusIndicatorActive===e&&this.debug&&console.warn(`[SaveStatusIndicator ${e}] Componente destruido o sin SaveManager, ignorando evento`))}},e=[["operation-scheduled",this.onOperationScheduled],["save-start",this.onSaveStart],["save-success",this.onSaveSuccess],["save-retry",this.onSaveRetry],["save-failed",this.onSaveFailed],["quota-error",this.onQuotaError],["quota-reset",this.onQuotaReset],["batch-start",this.onBatchStart],["batch-complete",this.onBatchComplete],["force-save-start",this.onForceSaveStart],["force-save-complete",this.onForceSaveComplete],["force-save-error",this.onForceSaveError]];e.forEach(([a,e])=>{const s=t(e),i=this.saveManager.addListener(a,s);i&&this.unsubscribers.push(i)})},onOperationScheduled(a,t){const e=t||this.saveManager;if(!e)return;const s=e.getStatus();this.pendingCount=s.pendingOperations,this.visible&&"idle"!==this.status||this.showStatus("pending","Cambios pendientes de guardar",this.pendingCount+" operaci√≥n(es) en cola")},onSaveStart(a){this.showStatus("saving","Guardando cambios...",null,!1)},onSaveSuccess(a,t){const e=t||this.saveManager;if(!e)return;const s=e.getStatus();this.pendingCount=s.pendingOperations,this.pendingCount>0?this.showStatus("pending","Guardado parcial completado",this.pendingCount+" operaci√≥n(es) restantes"):this.showStatus("success","¬°Todos los cambios guardados!",null,!0,3e3)},onSaveRetry(a){this.showStatus("error","Reintentando guardado...",`Intento ${a.attempt} - Pr√≥ximo intento en ${Math.round(a.nextRetryIn/1e3)}s`),this.startProgressBar(a.nextRetryIn)},onSaveFailed(a){this.showStatus("error","Error al guardar cambios","Algunos cambios no pudieron guardarse. Por favor, intenta de nuevo.",!0,1e4)},onQuotaError(a){const t=Math.ceil(a.resetIn/6e4);this.showStatus("quota","L√≠mite de operaciones alcanzado",`Pausando guardado por ${t} minuto(s). Los cambios se guardar√°n autom√°ticamente cuando se restablezca el l√≠mite.`),this.startProgressBar(a.resetIn)},onQuotaReset(a,t){const e=t||this.saveManager;if(!e)return;const s=e.getStatus();this.pendingCount=s.pendingOperations,this.pendingCount>0?this.showStatus("pending","L√≠mite restablecido",`Procesando ${this.pendingCount} operaci√≥n(es) pendientes...`):this.hideStatus()},onBatchStart(a){this.showStatus("saving","Procesando cambios en lote...",a.count+" operaciones")},onBatchComplete(a){this.pendingCount=a.remaining,this.pendingCount>0?this.showStatus("pending","Lote procesado",this.pendingCount+" operaci√≥n(es) restantes"):this.showStatus("success","¬°Todos los cambios guardados!",null,!0,3e3)},onForceSaveStart(a){this.showStatus("saving","Guardando cambios antes de salir...",(a.count||0)+" operaci√≥n(es) pendientes",!1)},onForceSaveComplete(){this.showStatus("success","¬°Cambios guardados exitosamente!","Puedes continuar navegando",!0,2e3)},onForceSaveError(a){this.showStatus("error","Error al guardar cambios","Algunos cambios podr√≠an no haberse guardado",!0,5e3)},showStatus(a,t,e=null,s=!1,i=5e3){this.clearTimeouts(),this.visible=!0,this.status=a,this.message=t,this.details=e,s&&(this.hideTimeout=setTimeout(()=>{this.hideStatus()},i))},hideStatus(){this.visible=!1,this.status="idle",this.message="",this.details="",this.showProgress=!1,this.progressPercent=0},startProgressBar(a){this.showProgress=!0,this.progressPercent=0,this.progressInterval&&clearInterval(this.progressInterval);const t=Date.now(),e=100;this.progressInterval=setInterval(()=>{const e=Date.now()-t;this.progressPercent=Math.min(e/a*100,100),this.progressPercent>=100&&(clearInterval(this.progressInterval),this.showProgress=!1)},e)},clearTimeouts(){this.hideTimeout&&(clearTimeout(this.hideTimeout),this.hideTimeout=null),this.progressInterval&&(clearInterval(this.progressInterval),this.progressInterval=null)},cleanupListeners(){this.unsubscribers&&this.unsubscribers.length>0&&(this.unsubscribers.forEach(a=>{if("function"===typeof a)try{a()}catch(t){this.debug&&console.error("[SaveStatusIndicator] Error al desuscribir listener:",t)}}),this.unsubscribers=[])},cleanup(){this.clearTimeouts(),this.cleanupListeners(),this.saveManager=null}}},c=r,l=(e("4593"),e("2877")),d=Object(l["a"])(c,s,i,!1,null,"41728ef7",null);t["a"]=d.exports},"986d":function(a,t,e){},a277:function(a,t,e){"use strict";e("986d")},c8f0:function(a,t,e){"use strict";e("2760")},caa9:function(a,t,e){"use strict";var s=function(){var a=this,t=a._self._c;return t("div",{staticClass:"datos-container mt-5"},[t("div",{staticClass:"fecha-actual"},[a._v(a._s(a.fechaActual))]),t("b-row",[t("b-col",{staticClass:"mb-3",attrs:{cols:"12",md:"5"}},[t("div",{staticClass:"controles-section"},[t("b-button",{staticClass:"mb-3",attrs:{variant:"danger",block:"",disabled:!a.tieneDatos},on:{click:a.limpiarDatos}},[a._v(" Limpiar datos ")]),t("b-form-textarea",{staticClass:"text-center input-dinero",attrs:{name:"dinero",id:"textarea-dinero",placeholder:"Ingrese cantidades de dinero (una por l√≠nea)",rows:"4","max-rows":"12",state:a.estadoValidacion},on:{input:a.validarEntrada},model:{value:a.datosLocales,callback:function(t){a.datosLocales=t},expression:"datosLocales"}}),a.erroresValidacion.length>0?t("div",{staticClass:"alertas-validacion mt-2"},a._l(a.erroresValidacion,(function(e,s){return t("b-alert",{key:s,staticClass:"alerta-pequena",attrs:{show:"",variant:"warning"}},[a._v(" "+a._s(e)+" ")])})),1):a._e(),t("div",{staticClass:"mt-3 suma-total"},[t("div",{staticClass:"total-container"},[t("span",{staticClass:"etiqueta-total"},[a._v("Total:")]),t("span",{staticClass:"valor-total"},[a._v("$"+a._s(a.formatearNumero(a.sumaTotal)))])]),a.sumaTotal>0?t("div",{staticClass:"promedio-info"},[t("small",[a._v("Promedio: $"+a._s(a.formatearNumero(a.promedioPorLinea)))])]):a._e()])],1)]),t("b-col",{attrs:{cols:"12",md:"7"}},[t("Cuentas",{attrs:{datos:a.datosLocales}})],1)],1)],1)},i=[],o=(e("14d9"),e("13d5"),e("93ae")),n={name:"Datos",components:{Cuentas:o["a"]},props:{datosIniciales:{type:String,default:""}},data(){return{datosLocales:this.datosIniciales,erroresValidacion:[],lineasValidadas:{validas:[]}}},computed:{fechaActual(){const a=new Date,t={year:"numeric",month:"long",day:"numeric",weekday:"long"};return a.toLocaleDateString("es-ES",t)},tieneDatos(){return this.datosLocales.trim().length>0},lineasProcesadas(){return this.datosLocales.split("\n").map(a=>a.trim()).filter(a=>a.length>0)},sumaTotal(){return this.lineasValidadas.validas.reduce((a,t)=>a+t,0)},promedioPorLinea(){const a=this.lineasValidadas.validas.length;return a>0?this.sumaTotal/a:0},estadoValidacion(){return this.tieneDatos?0===this.erroresValidacion.length:null}},methods:{limpiarDatos(){this.datosLocales="",this.erroresValidacion=[],this.lineasValidadas={validas:[]}},validarEntrada(){if(this.erroresValidacion=[],this.lineasValidadas={validas:[]},!this.tieneDatos)return;const a=this.lineasProcesadas;if(a.forEach((a,t)=>{const e=t+1,s=this.validarLinea(a,e);null!==s&&this.lineasValidadas.validas.push(s)}),this.erroresValidacion.length>5){const a=this.erroresValidacion.length-5;this.erroresValidacion=this.erroresValidacion.slice(0,5),this.erroresValidacion.push(`... y ${a} errores m√°s`)}},validarLinea(a,t){const e=a.replace(/[$,\s]/g,"");if(!e)return null;const s=parseFloat(e);return isNaN(s)?(this.erroresValidacion.push(`L√≠nea ${t}: "${a}" no es un n√∫mero v√°lido`),null):s<0?(this.erroresValidacion.push(`L√≠nea ${t}: Los valores negativos no son v√°lidos`),null):s>1e6?(this.erroresValidacion.push(`L√≠nea ${t}: El valor ${s} parece demasiado grande`),null):Math.round(100*s)/100},formatearNumero(a){return"number"!==typeof a||isNaN(a)?"0.00":a.toLocaleString("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2})}},watch:{datosLocales:{handler:"validarEntrada",immediate:!0}}},r=n,c=(e("cffb"),e("2877")),l=Object(c["a"])(r,s,i,!1,null,"de6891c2",null);t["a"]=l.exports},cffb:function(a,t,e){"use strict";e("0165")},d1d7:function(a,t,e){"use strict";var s=function(){var a=this,t=a._self._c;return a.mostrar?t("div",{staticClass:"modal-overlay",on:{click:function(t){return t.target!==t.currentTarget?null:a.cerrarModal.apply(null,arguments)}}},[t("div",{staticClass:"modal-content"},[t("h3",[a._v("Proveedor")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.proveedorLocal,expression:"proveedorLocal"}],staticClass:"input-proveedor",attrs:{type:"text",placeholder:"Nombre del proveedor"},domProps:{value:a.proveedorLocal},on:{keyup:function(t){return!t.type.indexOf("key")&&a._k(t.keyCode,"enter",13,t.key,"Enter")?null:a.guardarProveedor.apply(null,arguments)},input:function(t){t.target.composing||(a.proveedorLocal=t.target.value)}}}),t("div",{staticClass:"modal-buttons"},[t("button",{staticClass:"btn-guardar",on:{click:a.guardarProveedor}},[a._v("Guardar")]),t("button",{staticClass:"btn-cancelar",on:{click:a.cerrarModal}},[a._v("Cancelar")])])])]):a._e()},i=[],o={name:"ProveedorModal",props:{mostrar:{type:Boolean,required:!0},proveedor:{type:String,default:""}},data(){return{proveedorLocal:this.proveedor}},watch:{mostrar(a){a&&(this.proveedorLocal=this.proveedor)}},methods:{cerrarModal(){this.$emit("cerrar")},guardarProveedor(){this.$emit("guardar",this.proveedorLocal),this.cerrarModal()}}},n=o,r=(e("fbdc"),e("2877")),c=Object(r["a"])(n,s,i,!1,null,"69665719",null);t["a"]=c.exports},d984:function(a,t,e){},dc59:function(a,t,e){"use strict";e.d(t,"a",(function(){return c})),e.d(t,"c",(function(){return l})),e.d(t,"b",(function(){return d}));var s=e("bc7b"),i=e("1494"),o=e("7c01");const n={apiKey:"AIzaSyDEXrriJ15Gg2IyPYh56gNktfGaSsP6KeE",authDomain:"reypezapp-1ced2.firebaseapp.com",projectId:"reypezapp-1ced2",storageBucket:"reypezapp-1ced2.appspot.com",messagingSenderId:"512757841511",appId:"1:512757841511:web:d15e6a6276e84c42959ec2",databaseURL:"https://reypezapp-1ced2-default-rtdb.firebaseio.com/"},r=Object(s["a"])(n),c=Object(i["i"])(r,{localCache:Object(i["m"])({tabManager:Object(i["n"])()})}),l=Object(o["a"])(r),d=async(a,t)=>{if(a&&t)try{const e=Object(o["d"])(l,"status/"+a);await Object(o["b"])(e).remove(),await Object(o["e"])(e,{username:t,status:"online",lastSeen:(new Date).toISOString()})}catch(e){console.error("Error al configurar presencia:",e)}}},e7e0:function(a,t,e){"use strict";e.d(t,"a",(function(){return o})),e.d(t,"c",(function(){return n})),e.d(t,"b",(function(){return r}));var s=e("ec26");const i={JOSELITO:"#3498db",CATARRO:"#e74c3c",OTILIO:"#f1c40f",OZUNA:"#2ecc71",VERONICA:"#e67e22",DEFAULT:"#95a5a6"},o=[{id:1,nombre:"Joselito",color:i.JOSELITO,textColor:"white"},{id:2,nombre:"Catarro",color:i.CATARRO,textColor:"white"},{id:3,nombre:"Otilio",color:i.OTILIO,textColor:"black"},{id:4,nombre:"Ozuna",color:i.OZUNA,textColor:"white"},{id:5,nombre:"Veronica",nombreNotas:"Lorena",color:i.VERONICA,textColor:"white"}];function n(a){return{id:Object(s["a"])(),clienteId:a,medida:"",tipo:"",tipoPersonalizado:"",taras:[],kilos:[],reporteTaras:[],reporteBolsas:[],tarasExtra:[],restarTaras:!0,camaronNeto:.65,multiplicadorBolsas:1,showSuggestions:!1,esVenta:!1,isEditing:!0,isNew:!0,noSumarKilos:!1,refrigerar:!1}}function r(){return{talla:"",barco:"",taras:null,sobrante:null,mostrarSobrante:!1}}},fbdc:function(a,t,e){"use strict";e("2efd")},fe3d:function(a,t,e){"use strict";var s=function(){var a=this,t=a._self._c;return a.mostrar?t("div",{staticClass:"modal-overlay"},[t("div",{staticClass:"modal-agenda"},[t("div",{staticClass:"modal-header"},[t("h3",[a._v("Agenda de Transacciones")]),t("button",{staticClass:"btn-cerrar",on:{click:function(t){return a.$emit("cerrar")}}},[a._v("√ó")])]),t("div",{staticClass:"calendario-container"},[t("div",{staticClass:"selector-fecha"},[t("button",{staticClass:"btn-nav",on:{click:function(t){return a.cambiarMes(-1)}}},[a._v("<")]),t("span",{staticClass:"mes-anio"},[a._v(a._s(a.nombreMes)+" "+a._s(a.anioActual))]),t("button",{staticClass:"btn-nav",on:{click:function(t){return a.cambiarMes(1)}}},[a._v(">")])]),t("div",{staticClass:"dias-semana"},a._l(a.diasSemana,(function(e){return t("div",{key:e,staticClass:"dia-nombre"},[a._v(a._s(e))])})),0),t("div",{staticClass:"calendario"},a._l(a.diasCalendario,(function(e,s){return t("div",{key:s,staticClass:"dia-celda",class:{"otro-mes":!e.esMesActual,"dia-actual":e.esHoy,"tiene-registros":a.tieneRegistros(e.fecha),seleccionado:a.esDiaSeleccionado(e.fecha)},on:{click:function(t){return a.seleccionarDia(e)}}},[t("span",{staticClass:"numero-dia"},[a._v(a._s(e.numero))]),a.tieneRegistros(e.fecha)?t("div",{staticClass:"indicador-registros"}):a._e()])})),0)]),a.diaSeleccionado?t("div",{staticClass:"transacciones-container"},[t("div",{staticClass:"dia-seleccionado-header"},[t("h4",[a._v(a._s(a.formatoFechaCompleta))]),t("button",{staticClass:"btn-agregar",on:{click:function(t){a.mostrarFormulario=!0}}},[a._v("+ Agregar transacci√≥n")])]),a.transaccionesDia.length>0&&!a.mostrarFormulario?t("div",{staticClass:"resumen-dia"},[t("div",{staticClass:"resumen-dia-item"},[t("span",[a._v("Total del d√≠a:")]),t("span",[a._v("$"+a._s(a.formatearNumero(a.calcularTotalDia())))])]),t("div",{staticClass:"resumen-dia-item"},[t("span",[a._v("Dep√≥sitos:")]),t("span",{staticClass:"color-deposito"},[a._v("$"+a._s(a.formatearNumero(a.calcularTotalDiaPorTipo("deposito"))))])]),t("div",{staticClass:"resumen-dia-item"},[t("span",[a._v("Transferencias:")]),t("span",{staticClass:"color-transferencia"},[a._v("$"+a._s(a.formatearNumero(a.calcularTotalDiaPorTipo("transferencia"))))])]),t("div",{staticClass:"resumen-dia-item"},[t("span",[a._v("Transacciones:")]),t("span",[a._v(a._s(a.transaccionesDia.length))])])]):a._e(),0!==a.transaccionesDia.length||a.mostrarFormulario?a._e():t("div",{staticClass:"sin-transacciones"},[a._v(" No hay transacciones registradas para este d√≠a. ")]),a.mostrarFormulario?t("div",{staticClass:"formulario-transaccion"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"cliente"}},[a._v("Cliente:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.nuevaTransaccion.cliente,expression:"nuevaTransaccion.cliente"}],staticClass:"input-field",attrs:{id:"cliente"},on:{change:function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(a.nuevaTransaccion,"cliente",t.target.multiple?e:e[0])}}},[t("option",{attrs:{value:"mexico"}},[a._v("M√©xico")]),t("option",{attrs:{value:"ozuna"}},[a._v("Ozuna")]),t("option",{attrs:{value:"catarro"}},[a._v("Catarro")]),t("option",{attrs:{value:"joselito"}},[a._v("Joselito")]),t("option",{attrs:{value:"otilio"}},[a._v("Otilio")]),t("option",{attrs:{value:"veronica"}},[a._v("Ver√≥nica")])])]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"tipo"}},[a._v("Tipo de transacci√≥n:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.nuevaTransaccion.tipo,expression:"nuevaTransaccion.tipo"}],staticClass:"input-field",attrs:{id:"tipo"},on:{change:function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(a.nuevaTransaccion,"tipo",t.target.multiple?e:e[0])}}},[t("option",{attrs:{value:"deposito"}},[a._v("Dep√≥sito")]),t("option",{attrs:{value:"transferencia"}},[a._v("Transferencia")]),t("option",{attrs:{value:"efectivo"}},[a._v("Efectivo")]),t("option",{attrs:{value:"otro"}},[a._v("Otro")])])]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"monto"}},[a._v("Monto:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.nuevaTransaccion.monto,expression:"nuevaTransaccion.monto"}],staticClass:"input-field",attrs:{type:"number",id:"monto",placeholder:"Monto en pesos"},domProps:{value:a.nuevaTransaccion.monto},on:{input:function(t){t.target.composing||a.$set(a.nuevaTransaccion,"monto",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"descripcion"}},[a._v("Descripci√≥n:")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.nuevaTransaccion.descripcion,expression:"nuevaTransaccion.descripcion"}],staticClass:"input-field textarea",attrs:{id:"descripcion",placeholder:"Detalles de la transacci√≥n"},domProps:{value:a.nuevaTransaccion.descripcion},on:{input:function(t){t.target.composing||a.$set(a.nuevaTransaccion,"descripcion",t.target.value)}}})]),t("div",{staticClass:"buttons-container"},[t("button",{staticClass:"btn-guardar",attrs:{disabled:!a.esFormularioValido},on:{click:a.guardarTransaccion}},[a._v(" Guardar ")]),t("button",{staticClass:"btn-cancelar",on:{click:a.cancelarFormulario}},[a._v(" Cancelar ")])])]):a._e(),a.mostrarFormulario||a.mostrarVistaLista?a._e():t("div",{staticClass:"transacciones-agrupadas"},[t("div",{staticClass:"fila-clientes"},[t("div",{staticClass:"cliente-card cliente-card-otilio"},[t("div",{staticClass:"cliente-header cliente-otilio"},[t("h4",[a._v("Otilio")]),a.clientesAgrupados.otilio&&a.clientesAgrupados.otilio.length>0?t("div",{staticClass:"cliente-total"},[a._v(" Total: $"+a._s(a.formatearNumero(a.calcularTotalCliente("otilio")))+" ")]):t("div",{staticClass:"cliente-total sin-datos"},[a._v("Sin transacciones")])]),a.clientesAgrupados.otilio&&a.clientesAgrupados.otilio.length>0?t("div",{staticClass:"cliente-resumen"},[t("div",{staticClass:"resumen-item tipo-deposito"},[t("span",[a._v("Dep√≥sitos:")]),t("span",[a._v("$"+a._s(a.formatearNumero(a.calcularTotalPorTipo("otilio","deposito"))))])]),t("div",{staticClass:"resumen-item tipo-transferencia"},[t("span",[a._v("Transferencias:")]),t("span",[a._v("$"+a._s(a.formatearNumero(a.calcularTotalPorTipo("otilio","transferencia"))))])])]):a._e(),a.clientesAgrupados.otilio&&a.clientesAgrupados.otilio.length>0?t("div",{staticClass:"cliente-contador"},[a._v(" "+a._s(a.clientesAgrupados.otilio.length)+" transacci√≥n(es) ")]):a._e(),a.clientesAgrupados.otilio&&a.clientesAgrupados.otilio.length>0?t("div",{staticClass:"cliente-transacciones"},a._l(a.clientesAgrupados.otilio,(function(e,s){return t("div",{key:"otilio-"+s,staticClass:"transaccion-mini",class:"tipo-"+e.tipo},[t("div",{staticClass:"transaccion-mini-header"},[t("span",[a._v(a._s(a.obtenerTipoTexto(e.tipo)))]),t("span",[a._v("$"+a._s(a.formatearNumero(e.monto)))])]),t("div",{staticClass:"transaccion-mini-hora"},[a._v(a._s(a.formatearHora(e.timestamp)))]),t("div",{staticClass:"transaccion-mini-acciones"},[t("button",{staticClass:"btn-mini",on:{click:function(t){a.editarTransaccion(a.obtenerIndiceTransaccion(e))}}},[a._v("Editar")]),t("button",{staticClass:"btn-mini btn-mini-eliminar",on:{click:function(t){a.eliminarTransaccion(a.obtenerIndiceTransaccion(e))}}},[a._v("Eliminar")])])])})),0):t("div",{staticClass:"cliente-vacio"},[t("button",{staticClass:"btn-agregar-mini cliente-otilio",on:{click:function(t){a.nuevaTransaccion.cliente="otilio",a.mostrarFormulario=!0}}},[a._v(" + Agregar transacci√≥n para Otilio ")])])]),t("div",{staticClass:"cliente-card cliente-card-joselito"},[t("div",{staticClass:"cliente-header cliente-joselito"},[t("h4",[a._v("Joselito")]),a.clientesAgrupados.joselito&&a.clientesAgrupados.joselito.length>0?t("div",{staticClass:"cliente-total"},[a._v(" Total: $"+a._s(a.formatearNumero(a.calcularTotalCliente("joselito")))+" ")]):t("div",{staticClass:"cliente-total sin-datos"},[a._v("Sin transacciones")])]),a.clientesAgrupados.joselito&&a.clientesAgrupados.joselito.length>0?t("div",{staticClass:"cliente-resumen"},[t("div",{staticClass:"resumen-item tipo-deposito"},[t("span",[a._v("Dep√≥sitos:")]),t("span",[a._v("$"+a._s(a.formatearNumero(a.calcularTotalPorTipo("joselito","deposito"))))])]),t("div",{staticClass:"resumen-item tipo-transferencia"},[t("span",[a._v("Transferencias:")]),t("span",[a._v("$"+a._s(a.formatearNumero(a.calcularTotalPorTipo("joselito","transferencia"))))])])]):a._e(),a.clientesAgrupados.joselito&&a.clientesAgrupados.joselito.length>0?t("div",{staticClass:"cliente-contador"},[a._v(" "+a._s(a.clientesAgrupados.joselito.length)+" transacci√≥n(es) ")]):a._e(),a.clientesAgrupados.joselito&&a.clientesAgrupados.joselito.length>0?t("div",{staticClass:"cliente-transacciones"},a._l(a.clientesAgrupados.joselito,(function(e,s){return t("div",{key:"joselito-"+s,staticClass:"transaccion-mini",class:"tipo-"+e.tipo},[t("div",{staticClass:"transaccion-mini-header"},[t("span",[a._v(a._s(a.obtenerTipoTexto(e.tipo)))]),t("span",[a._v("$"+a._s(a.formatearNumero(e.monto)))])]),t("div",{staticClass:"transaccion-mini-hora"},[a._v(a._s(a.formatearHora(e.timestamp)))]),t("div",{staticClass:"transaccion-mini-acciones"},[t("button",{staticClass:"btn-mini",on:{click:function(t){a.editarTransaccion(a.obtenerIndiceTransaccion(e))}}},[a._v("Editar")]),t("button",{staticClass:"btn-mini btn-mini-eliminar",on:{click:function(t){a.eliminarTransaccion(a.obtenerIndiceTransaccion(e))}}},[a._v("Eliminar")])])])})),0):t("div",{staticClass:"cliente-vacio"},[t("button",{staticClass:"btn-agregar-mini cliente-joselito",on:{click:function(t){a.nuevaTransaccion.cliente="joselito",a.mostrarFormulario=!0}}},[a._v(" + Agregar transacci√≥n para Joselito ")])])])]),t("div",{staticClass:"fila-clientes"},[t("div",{staticClass:"cliente-card cliente-card-catarro"},[t("div",{staticClass:"cliente-header cliente-catarro"},[t("h4",[a._v("Catarro")]),a.clientesAgrupados.catarro&&a.clientesAgrupados.catarro.length>0?t("div",{staticClass:"cliente-total"},[a._v(" Total: $"+a._s(a.formatearNumero(a.calcularTotalCliente("catarro")))+" ")]):t("div",{staticClass:"cliente-total sin-datos"},[a._v("Sin transacciones")])]),a.clientesAgrupados.catarro&&a.clientesAgrupados.catarro.length>0?t("div",{staticClass:"cliente-resumen"},[t("div",{staticClass:"resumen-item tipo-deposito"},[t("span",[a._v("Dep√≥sitos:")]),t("span",[a._v("$"+a._s(a.formatearNumero(a.calcularTotalPorTipo("catarro","deposito"))))])]),t("div",{staticClass:"resumen-item tipo-transferencia"},[t("span",[a._v("Transferencias:")]),t("span",[a._v("$"+a._s(a.formatearNumero(a.calcularTotalPorTipo("catarro","transferencia"))))])])]):a._e(),a.clientesAgrupados.catarro&&a.clientesAgrupados.catarro.length>0?t("div",{staticClass:"cliente-contador"},[a._v(" "+a._s(a.clientesAgrupados.catarro.length)+" transacci√≥n(es) ")]):a._e(),a.clientesAgrupados.catarro&&a.clientesAgrupados.catarro.length>0?t("div",{staticClass:"cliente-transacciones"},a._l(a.clientesAgrupados.catarro,(function(e,s){return t("div",{key:"catarro-"+s,staticClass:"transaccion-mini",class:"tipo-"+e.tipo},[t("div",{staticClass:"transaccion-mini-header"},[t("span",[a._v(a._s(a.obtenerTipoTexto(e.tipo)))]),t("span",[a._v("$"+a._s(a.formatearNumero(e.monto)))])]),t("div",{staticClass:"transaccion-mini-hora"},[a._v(a._s(a.formatearHora(e.timestamp)))]),t("div",{staticClass:"transaccion-mini-acciones"},[t("button",{staticClass:"btn-mini",on:{click:function(t){a.editarTransaccion(a.obtenerIndiceTransaccion(e))}}},[a._v("Editar")]),t("button",{staticClass:"btn-mini btn-mini-eliminar",on:{click:function(t){a.eliminarTransaccion(a.obtenerIndiceTransaccion(e))}}},[a._v("Eliminar")])])])})),0):t("div",{staticClass:"cliente-vacio"},[t("button",{staticClass:"btn-agregar-mini cliente-catarro",on:{click:function(t){a.nuevaTransaccion.cliente="catarro",a.mostrarFormulario=!0}}},[a._v(" + Agregar transacci√≥n para Catarro ")])])]),t("div",{staticClass:"cliente-card cliente-card-ozuna"},[t("div",{staticClass:"cliente-header cliente-ozuna"},[t("h4",[a._v("Ozuna")]),a.clientesAgrupados.ozuna&&a.clientesAgrupados.ozuna.length>0?t("div",{staticClass:"cliente-total"},[a._v(" Total: $"+a._s(a.formatearNumero(a.calcularTotalCliente("ozuna")))+" ")]):t("div",{staticClass:"cliente-total sin-datos"},[a._v("Sin transacciones")])]),a.clientesAgrupados.ozuna&&a.clientesAgrupados.ozuna.length>0?t("div",{staticClass:"cliente-resumen"},[t("div",{staticClass:"resumen-item tipo-deposito"},[t("span",[a._v("Dep√≥sitos:")]),t("span",[a._v("$"+a._s(a.formatearNumero(a.calcularTotalPorTipo("ozuna","deposito"))))])]),t("div",{staticClass:"resumen-item tipo-transferencia"},[t("span",[a._v("Transferencias:")]),t("span",[a._v("$"+a._s(a.formatearNumero(a.calcularTotalPorTipo("ozuna","transferencia"))))])])]):a._e(),a.clientesAgrupados.ozuna&&a.clientesAgrupados.ozuna.length>0?t("div",{staticClass:"cliente-contador"},[a._v(" "+a._s(a.clientesAgrupados.ozuna.length)+" transacci√≥n(es) ")]):a._e(),a.clientesAgrupados.ozuna&&a.clientesAgrupados.ozuna.length>0?t("div",{staticClass:"cliente-transacciones"},a._l(a.clientesAgrupados.ozuna,(function(e,s){return t("div",{key:"ozuna-"+s,staticClass:"transaccion-mini",class:"tipo-"+e.tipo},[t("div",{staticClass:"transaccion-mini-header"},[t("span",[a._v(a._s(a.obtenerTipoTexto(e.tipo)))]),t("span",[a._v("$"+a._s(a.formatearNumero(e.monto)))])]),t("div",{staticClass:"transaccion-mini-hora"},[a._v(a._s(a.formatearHora(e.timestamp)))]),t("div",{staticClass:"transaccion-mini-acciones"},[t("button",{staticClass:"btn-mini",on:{click:function(t){a.editarTransaccion(a.obtenerIndiceTransaccion(e))}}},[a._v("Editar")]),t("button",{staticClass:"btn-mini btn-mini-eliminar",on:{click:function(t){a.eliminarTransaccion(a.obtenerIndiceTransaccion(e))}}},[a._v("Eliminar")])])])})),0):t("div",{staticClass:"cliente-vacio"},[t("button",{staticClass:"btn-agregar-mini cliente-ozuna",on:{click:function(t){a.nuevaTransaccion.cliente="ozuna",a.mostrarFormulario=!0}}},[a._v(" + Agregar transacci√≥n para Ozuna ")])])]),t("div",{staticClass:"cliente-card cliente-card-veronica"},[t("div",{staticClass:"cliente-header cliente-veronica"},[t("h4",[a._v("Ver√≥nica")]),a.clientesAgrupados.veronica&&a.clientesAgrupados.veronica.length>0?t("div",{staticClass:"cliente-total"},[a._v(" Total: $"+a._s(a.formatearNumero(a.calcularTotalCliente("veronica")))+" ")]):t("div",{staticClass:"cliente-total sin-datos"},[a._v("Sin transacciones")])]),a.clientesAgrupados.veronica&&a.clientesAgrupados.veronica.length>0?t("div",{staticClass:"cliente-resumen"},[t("div",{staticClass:"resumen-item tipo-deposito"},[t("span",[a._v("Dep√≥sitos:")]),t("span",[a._v("$"+a._s(a.formatearNumero(a.calcularTotalPorTipo("veronica","deposito"))))])]),t("div",{staticClass:"resumen-item tipo-transferencia"},[t("span",[a._v("Transferencias:")]),t("span",[a._v("$"+a._s(a.formatearNumero(a.calcularTotalPorTipo("veronica","transferencia"))))])])]):a._e(),a.clientesAgrupados.veronica&&a.clientesAgrupados.veronica.length>0?t("div",{staticClass:"cliente-contador"},[a._v(" "+a._s(a.clientesAgrupados.veronica.length)+" transacci√≥n(es) ")]):a._e(),a.clientesAgrupados.veronica&&a.clientesAgrupados.veronica.length>0?t("div",{staticClass:"cliente-transacciones"},a._l(a.clientesAgrupados.veronica,(function(e,s){return t("div",{key:"veronica-"+s,staticClass:"transaccion-mini",class:"tipo-"+e.tipo},[t("div",{staticClass:"transaccion-mini-header"},[t("span",[a._v(a._s(a.obtenerTipoTexto(e.tipo)))]),t("span",[a._v("$"+a._s(a.formatearNumero(e.monto)))])]),t("div",{staticClass:"transaccion-mini-hora"},[a._v(a._s(a.formatearHora(e.timestamp)))]),t("div",{staticClass:"transaccion-mini-acciones"},[t("button",{staticClass:"btn-mini",on:{click:function(t){a.editarTransaccion(a.obtenerIndiceTransaccion(e))}}},[a._v("Editar")]),t("button",{staticClass:"btn-mini btn-mini-eliminar",on:{click:function(t){a.eliminarTransaccion(a.obtenerIndiceTransaccion(e))}}},[a._v("Eliminar")])])])})),0):t("div",{staticClass:"cliente-vacio"},[t("button",{staticClass:"btn-agregar-mini cliente-veronica",on:{click:function(t){a.nuevaTransaccion.cliente="veronica",a.mostrarFormulario=!0}}},[a._v(" + Agregar transacci√≥n para Ver√≥nica ")])])])]),t("div",{staticClass:"cambiar-vista"},[t("button",{staticClass:"btn-cambiar-vista",on:{click:function(t){a.mostrarVistaLista=!a.mostrarVistaLista}}},[a._v(" Ver lista completa ")])])]),a.transaccionesDia.length>0&&a.mostrarVistaLista&&!a.mostrarFormulario?t("div",{staticClass:"lista-transacciones"},[a._l(a.transaccionesDia,(function(e,s){return t("div",{key:s,staticClass:"transaccion-item",class:"tipo-"+e.tipo},[t("div",{staticClass:"transaccion-header"},[t("div",{staticClass:"transaccion-tipo"},[a._v(a._s(a.obtenerTipoTexto(e.tipo)))]),t("div",{staticClass:"transaccion-monto"},[a._v("$"+a._s(a.formatearNumero(e.monto)))])]),t("div",{staticClass:"transaccion-cliente"},[a._v("Cliente: "+a._s(a.obtenerClienteTexto(e.cliente)))]),t("div",{staticClass:"transaccion-descripcion"},[a._v(a._s(e.descripcion))]),t("div",{staticClass:"transaccion-hora"},[a._v(a._s(a.formatearHora(e.timestamp)))]),t("div",{staticClass:"transaccion-acciones"},[t("button",{staticClass:"btn-editar",on:{click:function(t){return a.editarTransaccion(s)}}},[a._v("Editar")]),t("button",{staticClass:"btn-eliminar",on:{click:function(t){return a.eliminarTransaccion(s)}}},[a._v("Eliminar")])])])})),t("div",{staticClass:"cambiar-vista"},[t("button",{staticClass:"btn-cambiar-vista",on:{click:function(t){a.mostrarVistaLista=!a.mostrarVistaLista}}},[a._v(" Ver agrupado por cliente ")])])],2):a._e()]):a._e()])]):a._e()},i=[],o=(e("14d9"),e("13d5"),e("dc59")),n=e("1494"),r={name:"TransaccionesAgendaModal",props:{mostrar:{type:Boolean,required:!0},cliente:{type:String,required:!0}},data(){return{mesActual:(new Date).getMonth(),anioActual:(new Date).getFullYear(),diasSemana:["Dom","Lun","Mar","Mi√©","Jue","Vie","S√°b"],meses:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],diaSeleccionado:null,mostrarFormulario:!1,mostrarVistaLista:!1,transacciones:[],nuevaTransaccion:{tipo:"deposito",monto:"",descripcion:"",timestamp:null,cliente:""},editandoIndex:-1}},computed:{nombreMes(){return this.meses[this.mesActual]},diasCalendario(){const a=[],t=new Date(this.anioActual,this.mesActual,1),e=new Date(this.anioActual,this.mesActual+1,0),s=new Date,i=t.getDay();if(i>0){const t=new Date(this.anioActual,this.mesActual,0);for(let e=i-1;e>=0;e--){const i=t.getDate()-e,o=new Date(this.anioActual,this.mesActual-1,i);a.push({numero:i,fecha:o,esMesActual:!1,esHoy:this.esMismaFecha(o,s)})}}for(let n=1;n<=e.getDate();n++){const t=new Date(this.anioActual,this.mesActual,n);a.push({numero:n,fecha:t,esMesActual:!0,esHoy:this.esMismaFecha(t,s)})}const o=42-a.length;for(let n=1;n<=o;n++){const t=new Date(this.anioActual,this.mesActual+1,n);a.push({numero:n,fecha:t,esMesActual:!1,esHoy:this.esMismaFecha(t,s)})}return a},transaccionesDia(){return this.diaSeleccionado?this.transacciones.filter(a=>this.esMismaFecha(new Date(a.timestamp),this.diaSeleccionado.fecha)):[]},formatoFechaCompleta(){if(!this.diaSeleccionado)return"";const a={weekday:"long",year:"numeric",month:"long",day:"numeric"};return this.diaSeleccionado.fecha.toLocaleDateString("es-ES",a)},esFormularioValido(){return this.nuevaTransaccion.tipo&&this.nuevaTransaccion.monto>0&&this.nuevaTransaccion.cliente},clientesAgrupados(){if(!this.diaSeleccionado)return{};const a={otilio:[],joselito:[],catarro:[],ozuna:[],veronica:[],mexico:[]};return this.transaccionesDia.forEach(t=>{t.cliente&&a[t.cliente]&&a[t.cliente].push(t)}),a}},methods:{cambiarMes(a){let t=this.mesActual+a;t>11?(this.mesActual=0,this.anioActual++):t<0?(this.mesActual=11,this.anioActual--):this.mesActual=t,this.cargarTransacciones()},seleccionarDia(a){this.diaSeleccionado=a,this.mostrarFormulario=!1},esMismaFecha(a,t){return a.getDate()===t.getDate()&&a.getMonth()===t.getMonth()&&a.getFullYear()===t.getFullYear()},esDiaSeleccionado(a){return!!this.diaSeleccionado&&this.esMismaFecha(a,this.diaSeleccionado.fecha)},tieneRegistros(a){return this.transacciones.some(t=>this.esMismaFecha(new Date(t.timestamp),a))},formatearNumero(a){return a.toLocaleString("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2})},formatearHora(a){const t=new Date(a);return t.toLocaleTimeString("es-MX",{hour:"2-digit",minute:"2-digit"})},obtenerTipoTexto(a){const t={deposito:"Dep√≥sito",transferencia:"Transferencia",efectivo:"Efectivo",otro:"Otro"};return t[a]||"Otro"},obtenerClienteTexto(a){const t={mexico:"M√©xico",ozuna:"Ozuna",catarro:"Catarro",joselito:"Joselito",otilio:"Otilio",veronica:"Ver√≥nica"};return t[a]||a},cancelarFormulario(){this.mostrarFormulario=!1,this.nuevaTransaccion={tipo:"deposito",monto:"",descripcion:"",timestamp:null,cliente:""},this.editandoIndex=-1},async guardarTransaccion(){if(this.esFormularioValido)try{const a={...this.nuevaTransaccion,monto:parseFloat(this.nuevaTransaccion.monto),timestamp:this.nuevaTransaccion.timestamp||(new Date).toISOString(),fecha:this.diaSeleccionado.fecha.toISOString().split("T")[0]};if(this.editandoIndex>=0){const t=this.transaccionesDia[this.editandoIndex].id,e=Object(n["e"])(o["a"],"transacciones",t);await Object(n["s"])(e,a),this.transacciones=this.transacciones.map(e=>e.id===t?{...a,id:t}:e)}else{const t=await Object(n["b"])(Object(n["c"])(o["a"],"transacciones"),a);this.transacciones.push({...a,id:t.id})}this.cancelarFormulario()}catch(a){console.error("Error al guardar la transacci√≥n:",a),alert("Ocurri√≥ un error al guardar la transacci√≥n. Por favor intenta de nuevo.")}},editarTransaccion(a){const t=this.transaccionesDia[a];this.nuevaTransaccion={tipo:t.tipo,monto:t.monto,descripcion:t.descripcion,timestamp:t.timestamp,cliente:t.cliente||this.cliente},this.editandoIndex=a,this.mostrarFormulario=!0},async eliminarTransaccion(a){if(confirm("¬øEst√°s seguro de que deseas eliminar esta transacci√≥n?"))try{const t=this.transaccionesDia[a].id;await Object(n["d"])(Object(n["e"])(o["a"],"transacciones",t)),this.transacciones=this.transacciones.filter(a=>a.id!==t)}catch(t){console.error("Error al eliminar la transacci√≥n:",t),alert("Ocurri√≥ un error al eliminar la transacci√≥n. Por favor intenta de nuevo.")}},async cargarTransacciones(){try{const a=new Date(this.anioActual,this.mesActual,1),t=new Date(this.anioActual,this.mesActual+1,0),e=a.toISOString().split("T")[0],s=t.toISOString().split("T")[0],i=Object(n["o"])(Object(n["c"])(o["a"],"transacciones"),Object(n["t"])("fecha",">=",e),Object(n["t"])("fecha","<=",s)),r=await Object(n["g"])(i);this.transacciones=[],r.forEach(a=>{this.transacciones.push({id:a.id,...a.data()})})}catch(a){console.error("Error al cargar las transacciones:",a)}},calcularTotalCliente(a){return this.clientesAgrupados[a]?this.clientesAgrupados[a].reduce((a,t)=>a+(parseFloat(t.monto)||0),0):0},calcularTotalPorTipo(a,t){return this.clientesAgrupados[a]?this.clientesAgrupados[a].filter(a=>a.tipo===t).reduce((a,t)=>a+(parseFloat(t.monto)||0),0):0},obtenerIndiceTransaccion(a){return this.transaccionesDia.findIndex(t=>t.id===a.id)},calcularTotalDia(){return this.transaccionesDia.reduce((a,t)=>a+(parseFloat(t.monto)||0),0)},calcularTotalDiaPorTipo(a){return this.transaccionesDia.filter(t=>t.tipo===a).reduce((a,t)=>a+(parseFloat(t.monto)||0),0)}},watch:{mostrar(a){a&&(this.mesActual=(new Date).getMonth(),this.anioActual=(new Date).getFullYear(),this.diaSeleccionado={fecha:new Date,numero:(new Date).getDate(),esMesActual:!0,esHoy:!0},this.cargarTransacciones())},cliente(a){this.mostrar&&(this.nuevaTransaccion.cliente=a,this.cargarTransacciones())}},created(){this.nuevaTransaccion.cliente=this.cliente}},c=r,l=(e("62aa"),e("2877")),d=Object(l["a"])(c,s,i,!1,null,"2e7355c5",null);t["a"]=d.exports}}]);