(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["app.e346c0ac"],{"03df":function(e,t,a){},"05e4":function(e,t,a){"use strict";a("959e")},2155:function(e,t,a){},"2b68":function(e,t,a){"use strict";a("d5fa")},3206:function(e,t,a){"use strict";var o=function(){var e=this,t=e._self._c;return t("div",{staticClass:"nueva-deuda"},[t("div",{staticClass:"back-button-container"},[t("BackButton",{attrs:{to:"/procesos/deudas"}})],1),e._m(0),t("div",{staticClass:"fecha-card"},[e._m(1),t("div",{staticClass:"fecha-container"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.fechaSeleccionada,expression:"fechaSeleccionada"}],staticClass:"modern-input",attrs:{type:"date"},domProps:{value:e.fechaSeleccionada},on:{input:function(t){t.target.composing||(e.fechaSeleccionada=t.target.value)}}}),t("span",{staticClass:"fecha-display"},[e._v(e._s(e.fechaFormateada))])])]),t("div",{staticClass:"proveedor-card"},[e._m(2),t("select",{directives:[{name:"model",rawName:"v-model",value:e.proveedorSeleccionado,expression:"proveedorSeleccionado"}],staticClass:"modern-select",attrs:{required:""},on:{change:function(t){var a=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.proveedorSeleccionado=t.target.multiple?a:a[0]}}},[t("option",{attrs:{value:"",disabled:""}},[e._v("Seleccione un proveedor")]),e._l(e.proveedores,(function(a){return t("option",{key:a.id,domProps:{value:a.id}},[e._v(" "+e._s(a.nombre)+" ")])}))],2),e.proveedorSeleccionado&&e.getNombreProveedor()?t("div",{staticClass:"proveedor-selected-info"},[t("div",{staticClass:"proveedor-color-display"},[t("div",{staticClass:"color-indicator-large",style:{backgroundColor:e.getProveedorColor(e.proveedorSeleccionado)}}),t("div",{staticClass:"proveedor-details"},[t("span",{staticClass:"proveedor-nombre"},[e._v(e._s(e.getNombreProveedor()))]),t("span",{staticClass:"proveedor-label"},[e._v("Proveedor seleccionado")])])])]):e._e()]),e.proveedorSeleccionado?t("div",{staticClass:"productos-card"},[e._m(3),t("ProductoSelector",{attrs:{"proveedor-id":e.proveedorSeleccionado},on:{"agregar-producto":e.addItem}})],1):e._e(),e.items.length>0?t("div",{staticClass:"tabla-container"},[e._m(4),t("div",{staticClass:"tabla-wrapper"},[t("table",{staticClass:"tabla-productos"},[e._m(5),t("tbody",e._l(e.items,(function(a,o){return t("tr",{key:o},[t("td",{staticClass:"editable",on:{click:function(t){return e.editarItem(o,"kilos")}}},[a.editando&&"kilos"===a.campoEditando?t("input",{directives:[{name:"model",rawName:"v-model.number",value:a.kilos,expression:"item.kilos",modifiers:{number:!0}}],staticClass:"table-input",attrs:{type:"number"},domProps:{value:a.kilos},on:{blur:[function(t){return e.finalizarEdicion(o)},function(t){return e.$forceUpdate()}],keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.finalizarEdicion(o)},input:function(t){t.target.composing||e.$set(a,"kilos",e._n(t.target.value))}}}):t("span",[e._v(e._s(e.formatNumber(a.kilos)))])]),t("td",{staticClass:"editable",on:{click:function(t){return e.editarItem(o,"producto")}}},[a.editando&&"producto"===a.campoEditando?t("input",{directives:[{name:"model",rawName:"v-model",value:a.producto,expression:"item.producto"}],staticClass:"table-input",attrs:{type:"text"},domProps:{value:a.producto},on:{blur:function(t){return e.finalizarEdicion(o)},keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.finalizarEdicion(o)},input:function(t){t.target.composing||e.$set(a,"producto",t.target.value)}}}):t("span",[e._v(e._s(a.producto))])]),t("td",{staticClass:"editable",on:{click:function(t){return e.editarItem(o,"precio")}}},[a.editando&&"precio"===a.campoEditando?t("input",{directives:[{name:"model",rawName:"v-model.number",value:a.precio,expression:"item.precio",modifiers:{number:!0}}],staticClass:"table-input",attrs:{type:"number"},domProps:{value:a.precio},on:{blur:[function(t){return e.finalizarEdicion(o)},function(t){return e.$forceUpdate()}],keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.finalizarEdicion(o)},input:function(t){t.target.composing||e.$set(a,"precio",e._n(t.target.value))}}}):t("span",[e._v("$"+e._s(e.formatNumber(a.precio)))])]),t("td",{staticClass:"total-cell"},[e._v("$"+e._s(e.formatNumber(a.total)))]),t("td",{staticClass:"action-column"},[t("button",{staticClass:"btn-delete",on:{click:function(t){return e.removeItem(o)}}},[t("i",{staticClass:"icon-trash"},[e._v("🗑️")])])])])})),0),t("tfoot",[t("tr",{staticClass:"total-row"},[t("td",{staticClass:"total-label",attrs:{colspan:"3"}},[e._v("Total General")]),t("td",{staticClass:"total-amount"},[e._v("$"+e._s(e.formatNumber(e.totalGeneral)))]),t("td")])])])])]):e._e(),e.items.length>0?t("div",{staticClass:"abonos-section"},[t("h2",[e._v("Abonos Iniciales")]),t("div",{staticClass:"abonos"},[e._l(e.abonos,(function(a,o){return t("div",{key:o,staticClass:"input-row"},[t("input",{directives:[{name:"model",rawName:"v-model",value:a.descripcion,expression:"abono.descripcion"}],attrs:{type:"text",placeholder:"Descripción"},domProps:{value:a.descripcion},on:{input:function(t){t.target.composing||e.$set(a,"descripcion",t.target.value)}}}),t("input",{directives:[{name:"model",rawName:"v-model.number",value:a.monto,expression:"abono.monto",modifiers:{number:!0}}],attrs:{type:"number",placeholder:"Monto"},domProps:{value:a.monto},on:{input:function(t){t.target.composing||e.$set(a,"monto",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}}),t("button",{staticClass:"delete-btn",on:{click:function(t){return e.removeAbono(o)}}},[e._v("Eliminar")])])})),t("button",{staticClass:"add-btn",on:{click:e.addAbono}},[e._v("Agregar Abono")])],2),t("div",{staticClass:"resumen"},[t("h3",[e._v("Resumen")]),t("div",{staticClass:"resumen-item"},[t("span",[e._v("Total deuda:")]),t("span",[e._v("$"+e._s(e.formatNumber(e.totalGeneral)))])]),t("div",{staticClass:"resumen-item"},[t("span",[e._v("Total abonos:")]),t("span",[e._v("$"+e._s(e.formatNumber(e.totalAbonos)))])]),t("div",{staticClass:"resumen-item total"},[t("span",[e._v("Saldo pendiente:")]),t("span",[e._v("$"+e._s(e.formatNumber(e.saldoPendiente)))])])])]):e._e(),e.proveedorSeleccionado&&e.items.length>0?t("div",{staticClass:"button-container"},[t("button",{staticClass:"save-button",attrs:{disabled:e.guardando},on:{click:e.guardarDeuda}},[e._v(" "+e._s(e.guardando?"Guardando...":"Guardar Deuda")+" ")])]):e._e()])},r=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"header-section"},[t("div",{staticClass:"header-content"},[t("h1",{staticClass:"main-title"},[t("i",{staticClass:"icon-new"},[e._v("➕")]),e._v(" Nueva Deuda a Proveedor ")]),t("p",{staticClass:"subtitle"},[e._v("Registra una nueva deuda con productos y abonos iniciales")])])])},function(){var e=this,t=e._self._c;return t("h3",{staticClass:"section-title"},[t("i",{staticClass:"icon-calendar"},[e._v("📅")]),e._v(" Fecha de la Deuda ")])},function(){var e=this,t=e._self._c;return t("h3",{staticClass:"section-title"},[t("i",{staticClass:"icon-supplier"},[e._v("🏭")]),e._v(" Seleccionar Proveedor ")])},function(){var e=this,t=e._self._c;return t("h3",{staticClass:"section-title"},[t("i",{staticClass:"icon-products"},[e._v("📦")]),e._v(" Ingresar Productos ")])},function(){var e=this,t=e._self._c;return t("h3",{staticClass:"section-title"},[t("i",{staticClass:"icon-list"},[e._v("📋")]),e._v(" Productos Agregados ")])},function(){var e=this,t=e._self._c;return t("thead",[t("tr",[t("th",[e._v("Kilos")]),t("th",[e._v("Producto")]),t("th",[e._v("Precio")]),t("th",[e._v("Total")]),t("th",[e._v("Acciones")])])])}],i=(a("14d9"),a("13d5"),a("dc59")),s=a("1494"),n=a("74c9"),d=a("687e"),c={name:"NuevaDeuda",components:{BackButton:n["a"],ProductoSelector:d["a"]},data(){return{proveedores:[],proveedorSeleccionado:"",fechaSeleccionada:this.obtenerFechaActual(),items:[],abonos:[],guardando:!1}},computed:{fechaFormateada(){const e=new Date(this.fechaSeleccionada+"T00:00:00"),t={year:"numeric",month:"long",day:"numeric"};return e.toLocaleDateString("es-ES",t)},totalGeneral(){return this.items.reduce((e,t)=>e+t.total,0)},totalAbonos(){return this.abonos.reduce((e,t)=>e+(t.monto||0),0)},saldoPendiente(){return this.totalGeneral-this.totalAbonos}},methods:{obtenerFechaActual(){const e=new Date,t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${t}-${a}-${o}`},async loadProveedores(){try{const e=await Object(s["g"])(Object(s["c"])(i["a"],"proveedoresDeuda"));this.proveedores=e.docs.map(e=>({id:e.id,...e.data()}))}catch(e){console.error("Error al cargar proveedores: ",e)}},getNombreProveedor(){const e=this.proveedores.find(e=>e.id===this.proveedorSeleccionado);return e?e.nombre:""},getProveedorColor(e){const t=this.proveedores.find(t=>t.id===e);return t&&t.color?t.color:"#cccccc"},formatNumber(e){return e?e.toLocaleString("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00"},addItem(e){this.items.push({kilos:e.kilos,producto:e.producto,precio:e.precio,total:e.total,editando:!1,campoEditando:null})},removeItem(e){this.items.splice(e,1)},editarItem(e,t){this.items=this.items.map((a,o)=>o===e?{...a,editando:!0,campoEditando:t}:{...a,editando:!1,campoEditando:null})},finalizarEdicion(e){const t=this.items[e];t.total=t.kilos*t.precio,t.editando=!1,t.campoEditando=null},addAbono(){this.abonos.push({descripcion:"",monto:null,fecha:this.fechaSeleccionada})},removeAbono(e){this.abonos.splice(e,1)},async guardarDeuda(){if(this.proveedorSeleccionado)if(0!==this.items.length)try{this.guardando=!0;const e=await Object(s["b"])(Object(s["c"])(i["a"],"deudas"),{proveedorId:this.proveedorSeleccionado,proveedorNombre:this.getNombreProveedor(),fecha:this.fechaSeleccionada,fechaCreacion:new Date,total:this.totalGeneral,saldoPendiente:this.saldoPendiente,estado:this.saldoPendiente>0?"pendiente":"pagado"}),t=Object(s["c"])(i["a"],"deudas",e.id,"productos");for(const a of this.items)await Object(s["b"])(t,{kilos:a.kilos,producto:a.producto,precio:a.precio,total:a.total});if(this.abonos.length>0){const t=Object(s["c"])(i["a"],"deudas",e.id,"abonos");for(const e of this.abonos)e.descripcion&&e.monto&&await Object(s["b"])(t,{descripcion:e.descripcion,monto:e.monto,fecha:this.fechaSeleccionada,fechaCreacion:new Date})}alert("Deuda guardada correctamente"),this.$router.push("/procesos/deudas/lista")}catch(e){console.error("Error al guardar la deuda: ",e),alert("Error al guardar la deuda: "+e.message)}finally{this.guardando=!1}else alert("Por favor agregue al menos un producto");else alert("Por favor seleccione un proveedor")}},mounted(){this.loadProveedores()}},l=c,u=(a("f740"),a("2877")),v=Object(u["a"])(l,o,r,!1,null,"8a78827c",null);t["a"]=v.exports},"6ad3":function(e,t,a){"use strict";a("e3b7")},"6f4f":function(e,t,a){},8610:function(e,t,a){"use strict";var o=function(){var e=this,t=e._self._c;return t("div",{staticClass:"deudas-menu"},[t("div",{staticClass:"back-button-container"},[t("BackButton",{attrs:{to:"/procesos"}})],1),e._m(0),t("div",{staticClass:"menu-options"},[t("router-link",{staticClass:"btn-action btn-lista",attrs:{to:"/procesos/deudas/lista","aria-label":"Ver lista de deudas"}},[t("i",{staticClass:"icon"},[e._v("📋")]),t("span",[e._v("Lista de Deudas")])]),t("router-link",{staticClass:"btn-action btn-nueva",attrs:{to:"/procesos/deudas/nueva","aria-label":"Crear nueva deuda"}},[t("i",{staticClass:"icon"},[e._v("➕")]),t("span",[e._v("Nueva Deuda")])]),t("button",{staticClass:"btn-action btn-config",attrs:{"aria-label":"Configurar proveedores"},on:{click:e.openProveedoresModal}},[t("i",{staticClass:"icon"},[e._v("⚙️")]),t("span",[e._v("Configurar Proveedores")])])],1),e.showModal?t("div",{staticClass:"modal-overlay",on:{click:e.closeModalOnOverlay}},[t("div",{staticClass:"modal-content modern-modal",on:{click:function(e){e.stopPropagation()}}},[t("div",{staticClass:"modal-header modern-header"},[e._m(1),e._m(2),t("button",{staticClass:"close-button modern-close",on:{click:function(t){e.showModal=!1}}},[t("i",{staticClass:"fas fa-times"},[e._v("✕")])])]),t("div",{staticClass:"modal-body modern-body"},[t("div",{staticClass:"add-proveedor-section"},[e._m(3),t("form",{staticClass:"modern-form",on:{submit:function(t){return t.preventDefault(),e.addProveedor.apply(null,arguments)}}},[t("div",{staticClass:"form-grid"},[t("div",{staticClass:"form-group modern-group"},[e._m(4),t("input",{directives:[{name:"model",rawName:"v-model",value:e.newProveedor.nombre,expression:"newProveedor.nombre"}],staticClass:"modern-input",attrs:{id:"nombre",required:"",placeholder:"Ingrese el nombre del proveedor"},domProps:{value:e.newProveedor.nombre},on:{input:function(t){t.target.composing||e.$set(e.newProveedor,"nombre",t.target.value)}}})]),t("div",{staticClass:"form-group modern-group"},[e._m(5),t("input",{directives:[{name:"model",rawName:"v-model",value:e.newProveedor.telefono,expression:"newProveedor.telefono"}],staticClass:"modern-input",attrs:{id:"telefono",placeholder:"Ingrese el teléfono"},domProps:{value:e.newProveedor.telefono},on:{input:function(t){t.target.composing||e.$set(e.newProveedor,"telefono",t.target.value)}}})])]),t("div",{staticClass:"color-selection"},[e._m(6),t("div",{staticClass:"color-options"},e._l(e.coloresDisponibles,(function(a){return t("div",{key:a.value,staticClass:"color-option",class:{selected:e.newProveedor.color===a.value},on:{click:function(t){e.newProveedor.color=a.value}}},[t("div",{staticClass:"color-circle",style:{backgroundColor:a.value}}),t("span",{staticClass:"color-name"},[e._v(e._s(a.name))])])})),0),t("p",{staticClass:"color-help"},[e._v("Selecciona un color para identificar fácilmente este proveedor en las listas")])]),t("button",{staticClass:"submit-btn modern-submit",attrs:{type:"submit",disabled:!e.newProveedor.nombre||!e.newProveedor.color}},[t("i",{staticClass:"btn-icon"},[e._v("💾")]),t("span",[e._v("Agregar Proveedor")])])])]),t("div",{staticClass:"separator"}),t("div",{staticClass:"proveedores-list-section"},[t("div",{staticClass:"section-header"},[t("i",{staticClass:"section-icon"},[e._v("📋")]),t("h3",[e._v("Proveedores Registrados")]),t("span",{staticClass:"count-badge"},[e._v(e._s(e.proveedores.length))])]),0===e.proveedores.length?t("div",{staticClass:"empty-state"},[t("i",{staticClass:"empty-icon"},[e._v("📭")]),t("p",[e._v("No hay proveedores registrados")]),t("span",[e._v("Agrega tu primer proveedor usando el formulario de arriba")])]):t("div",{staticClass:"proveedores-grid"},e._l(e.sortedProveedores,(function(a){return t("div",{key:a.id,staticClass:"proveedor-card"},[t("div",{staticClass:"proveedor-header"},[t("div",{staticClass:"proveedor-color"},[t("div",{staticClass:"color-indicator",style:{backgroundColor:a.color||"#cccccc"}})]),t("div",{staticClass:"proveedor-actions"},[t("button",{staticClass:"edit-btn",attrs:{title:"Editar proveedor"},on:{click:function(t){return e.editarProveedor(a)}}},[t("i",{staticClass:"fas fa-edit"},[e._v("✏️")])]),t("button",{staticClass:"delete-btn modern-delete",attrs:{title:"Eliminar proveedor"},on:{click:function(t){return e.deleteProveedor(a.id)}}},[t("i",{staticClass:"fas fa-trash"},[e._v("🗑️")])])])]),t("div",{staticClass:"proveedor-content"},[t("h4",{staticClass:"proveedor-nombre"},[e._v(e._s(a.nombre))]),a.telefono?t("p",{staticClass:"proveedor-telefono"},[t("i",{staticClass:"phone-icon"},[e._v("📞")]),e._v(" "+e._s(a.telefono)+" ")]):e._e(),t("span",{staticClass:"proveedor-fecha"},[e._v(" Creado: "+e._s(e.formatearFechaCreacion(a.fechaCreacion))+" ")])])])})),0)])])])]):e._e(),e.showEditModal?t("div",{staticClass:"modal-overlay",on:{click:e.closeEditModalOnOverlay}},[t("div",{staticClass:"modal-content modern-modal small-modal",on:{click:function(e){e.stopPropagation()}}},[t("div",{staticClass:"modal-header modern-header"},[e._m(7),e._m(8),t("button",{staticClass:"close-button modern-close",on:{click:function(t){e.showEditModal=!1}}},[t("i",{staticClass:"fas fa-times"},[e._v("✕")])])]),t("div",{staticClass:"modal-body modern-body"},[t("form",{staticClass:"modern-form",on:{submit:function(t){return t.preventDefault(),e.updateProveedor.apply(null,arguments)}}},[t("div",{staticClass:"form-group modern-group"},[e._m(9),t("input",{directives:[{name:"model",rawName:"v-model",value:e.editingProveedor.nombre,expression:"editingProveedor.nombre"}],staticClass:"modern-input",attrs:{id:"editNombre",required:"",placeholder:"Ingrese el nombre del proveedor"},domProps:{value:e.editingProveedor.nombre},on:{input:function(t){t.target.composing||e.$set(e.editingProveedor,"nombre",t.target.value)}}})]),t("div",{staticClass:"form-group modern-group"},[e._m(10),t("input",{directives:[{name:"model",rawName:"v-model",value:e.editingProveedor.telefono,expression:"editingProveedor.telefono"}],staticClass:"modern-input",attrs:{id:"editTelefono",placeholder:"Ingrese el teléfono"},domProps:{value:e.editingProveedor.telefono},on:{input:function(t){t.target.composing||e.$set(e.editingProveedor,"telefono",t.target.value)}}})]),t("div",{staticClass:"color-selection"},[e._m(11),t("div",{staticClass:"color-options"},e._l(e.coloresDisponibles,(function(a){return t("div",{key:a.value,staticClass:"color-option",class:{selected:e.editingProveedor.color===a.value},on:{click:function(t){e.editingProveedor.color=a.value}}},[t("div",{staticClass:"color-circle",style:{backgroundColor:a.value}}),t("span",{staticClass:"color-name"},[e._v(e._s(a.name))])])})),0)]),t("div",{staticClass:"form-actions"},[t("button",{staticClass:"cancel-btn",attrs:{type:"button"},on:{click:function(t){e.showEditModal=!1}}},[t("i",{staticClass:"btn-icon"},[e._v("❌")]),t("span",[e._v("Cancelar")])]),t("button",{staticClass:"submit-btn modern-submit",attrs:{type:"submit",disabled:!e.editingProveedor.nombre||!e.editingProveedor.color}},[t("i",{staticClass:"btn-icon"},[e._v("💾")]),t("span",[e._v("Guardar Cambios")])])])])])])]):e._e()])},r=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"header-section"},[t("div",{staticClass:"header-content"},[t("h1",{staticClass:"main-title"},[t("i",{staticClass:"icon-debt"},[e._v("💰")]),e._v(" Gestión de Deudas a Proveedores ")]),t("p",{staticClass:"subtitle"},[e._v("Administra las deudas pendientes y proveedores de manera eficiente")])])])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"header-icon"},[t("i",{staticClass:"icon-config"},[e._v("⚙️")])])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"header-text"},[t("h2",[e._v("Gestionar Proveedores")]),t("p",[e._v("Administra los proveedores y asigna colores de identificación")])])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"section-header"},[t("i",{staticClass:"section-icon"},[e._v("➕")]),t("h3",[e._v("Agregar Nuevo Proveedor")])])},function(){var e=this,t=e._self._c;return t("label",{staticClass:"modern-label",attrs:{for:"nombre"}},[t("i",{staticClass:"label-icon"},[e._v("👤")]),e._v(" Nombre del Proveedor ")])},function(){var e=this,t=e._self._c;return t("label",{staticClass:"modern-label",attrs:{for:"telefono"}},[t("i",{staticClass:"label-icon"},[e._v("📞")]),e._v(" Teléfono (opcional) ")])},function(){var e=this,t=e._self._c;return t("label",{staticClass:"modern-label"},[t("i",{staticClass:"label-icon"},[e._v("🎨")]),e._v(" Color de Identificación ")])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"header-icon"},[t("i",{staticClass:"icon-edit"},[e._v("✏️")])])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"header-text"},[t("h2",[e._v("Editar Proveedor")]),t("p",[e._v("Modifica la información del proveedor")])])},function(){var e=this,t=e._self._c;return t("label",{staticClass:"modern-label",attrs:{for:"editNombre"}},[t("i",{staticClass:"label-icon"},[e._v("👤")]),e._v(" Nombre del Proveedor ")])},function(){var e=this,t=e._self._c;return t("label",{staticClass:"modern-label",attrs:{for:"editTelefono"}},[t("i",{staticClass:"label-icon"},[e._v("📞")]),e._v(" Teléfono (opcional) ")])},function(){var e=this,t=e._self._c;return t("label",{staticClass:"modern-label"},[t("i",{staticClass:"label-icon"},[e._v("🎨")]),e._v(" Color de Identificación ")])}],i=a("dc59"),s=a("1494"),n=a("74c9"),d={name:"DeudasMenu",components:{BackButton:n["a"]},data(){return{showModal:!1,showEditModal:!1,proveedores:[],newProveedor:{nombre:"",telefono:"",color:""},editingProveedor:{id:"",nombre:"",telefono:"",color:""},coloresDisponibles:[{name:"Azul",value:"#3498DB"},{name:"Verde",value:"#2ECC71"},{name:"Rojo",value:"#E74C3C"},{name:"Naranja",value:"#F39C12"},{name:"Púrpura",value:"#9B59B6"},{name:"Turquesa",value:"#1ABC9C"},{name:"Rosa",value:"#E91E63"},{name:"Índigo",value:"#673AB7"},{name:"Amarillo",value:"#F1C40F"},{name:"Coral",value:"#FF7675"},{name:"Aguamarina",value:"#00CEC9"},{name:"Lima",value:"#6C5CE7"}]}},computed:{sortedProveedores(){return[...this.proveedores].sort((e,t)=>e.nombre.localeCompare(t.nombre))}},methods:{openProveedoresModal(){this.showModal=!0,this.loadProveedores()},closeModalOnOverlay(e){e.target===e.currentTarget&&(this.showModal=!1)},closeEditModalOnOverlay(e){e.target===e.currentTarget&&(this.showEditModal=!1)},async loadProveedores(){try{const e=await Object(s["g"])(Object(s["c"])(i["a"],"proveedoresDeuda"));this.proveedores=e.docs.map(e=>({id:e.id,...e.data()}))}catch(e){console.error("Error al cargar proveedores: ",e)}},async addProveedor(){try{if(!this.newProveedor.nombre||!this.newProveedor.color)return void alert("Por favor, ingrese el nombre del proveedor y seleccione un color.");await Object(s["b"])(Object(s["c"])(i["a"],"proveedoresDeuda"),{nombre:this.newProveedor.nombre,telefono:this.newProveedor.telefono||"",color:this.newProveedor.color,fechaCreacion:new Date}),this.newProveedor={nombre:"",telefono:"",color:""},this.loadProveedores(),alert("Proveedor agregado exitosamente")}catch(e){console.error("Error al añadir proveedor: ",e),alert("Error al agregar proveedor: "+e.message)}},editarProveedor(e){this.editingProveedor={id:e.id,nombre:e.nombre,telefono:e.telefono||"",color:e.color||"#3498DB"},this.showEditModal=!0},async updateProveedor(){try{if(!this.editingProveedor.nombre||!this.editingProveedor.color)return void alert("Por favor, ingrese el nombre del proveedor y seleccione un color.");await Object(s["r"])(Object(s["e"])(i["a"],"proveedoresDeuda",this.editingProveedor.id),{nombre:this.editingProveedor.nombre,telefono:this.editingProveedor.telefono||"",color:this.editingProveedor.color,fechaModificacion:new Date}),this.showEditModal=!1,this.loadProveedores(),alert("Proveedor actualizado exitosamente")}catch(e){console.error("Error al actualizar proveedor: ",e),alert("Error al actualizar proveedor: "+e.message)}},async deleteProveedor(e){if(confirm("¿Estás seguro de que quieres eliminar este proveedor? Esta acción no se puede deshacer."))try{await Object(s["d"])(Object(s["e"])(i["a"],"proveedoresDeuda",e)),this.loadProveedores(),alert("Proveedor eliminado exitosamente")}catch(t){console.error("Error al eliminar proveedor: ",t),alert("Error al eliminar proveedor: "+t.message)}},formatearFechaCreacion(e){if(!e)return"Fecha no disponible";try{let t;t=e.toDate?e.toDate():e instanceof Date?e:new Date(e);const a={year:"numeric",month:"short",day:"numeric"};return t.toLocaleDateString("es-ES",a)}catch(t){return console.error("Error al formatear fecha:",t),"Fecha inválida"}}},mounted(){this.loadProveedores()}},c=d,l=(a("ad3c"),a("2877")),u=Object(l["a"])(c,o,r,!1,null,"f29747ea",null);t["a"]=u.exports},"959e":function(e,t,a){},"9b35":function(e,t,a){"use strict";var o=function(){var e,t,a,o,r,i,s,n,d,c,l=this,u=l._self._c;return u("div",{staticClass:"lista-deudas"},[u("div",{staticClass:"back-button-container"},[u("BackButton",{attrs:{to:"/procesos/deudas"}})],1),l._m(0),u("div",{staticClass:"filtros-container"},[u("div",{staticClass:"filtros-card"},[l._m(1),u("div",{staticClass:"filtros-grid"},[u("div",{staticClass:"filtro-group"},[u("label",{attrs:{for:"filtroProveedor"}},[l._v("Proveedor:")]),u("select",{directives:[{name:"model",rawName:"v-model",value:l.filtroProveedor,expression:"filtroProveedor"}],staticClass:"modern-select",attrs:{id:"filtroProveedor"},on:{change:function(e){var t=Array.prototype.filter.call(e.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));l.filtroProveedor=e.target.multiple?t:t[0]}}},[u("option",{attrs:{value:""}},[l._v("Todos los proveedores")]),l._l(l.proveedores,(function(e){return u("option",{key:e.id,domProps:{value:e.id}},[l._v(" "+l._s(e.nombre)+" ")])}))],2),l.filtroProveedor?u("div",{staticClass:"proveedor-color-indicator"},[u("div",{staticClass:"color-dot",style:{backgroundColor:l.getProveedorColor(l.filtroProveedor)}}),u("span",[l._v(l._s(l.getNombreProveedorSeleccionado()))])]):l._e()]),u("div",{staticClass:"filtro-group"},[u("label",{attrs:{for:"filtroEstado"}},[l._v("Estado:")]),u("select",{directives:[{name:"model",rawName:"v-model",value:l.filtroEstado,expression:"filtroEstado"}],staticClass:"modern-select",attrs:{id:"filtroEstado"},on:{change:function(e){var t=Array.prototype.filter.call(e.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));l.filtroEstado=e.target.multiple?t:t[0]}}},[u("option",{attrs:{value:""}},[l._v("Todos los estados")]),u("option",{attrs:{value:"pendiente"}},[l._v("No Pagados (Pendientes)")]),u("option",{attrs:{value:"pagado"}},[l._v("Pagados")])])]),u("div",{staticClass:"filtro-group fecha-group"},[u("label",[l._v("Rango de fechas:")]),u("div",{staticClass:"fecha-inputs"},[u("input",{directives:[{name:"model",rawName:"v-model",value:l.filtroFechaDesde,expression:"filtroFechaDesde"}],staticClass:"modern-input",attrs:{type:"date",placeholder:"Desde"},domProps:{value:l.filtroFechaDesde},on:{input:function(e){e.target.composing||(l.filtroFechaDesde=e.target.value)}}}),u("span",{staticClass:"fecha-separator"},[l._v("a")]),u("input",{directives:[{name:"model",rawName:"v-model",value:l.filtroFechaHasta,expression:"filtroFechaHasta"}],staticClass:"modern-input",attrs:{type:"date",placeholder:"Hasta"},domProps:{value:l.filtroFechaHasta},on:{input:function(e){e.target.composing||(l.filtroFechaHasta=e.target.value)}}})])])])])]),u("div",{staticClass:"resumen-container"},[u("div",{staticClass:"resumen-card saldo-pendiente"},[u("div",{staticClass:"card-icon"},[l._v("💰")]),u("div",{staticClass:"card-content"},[u("h3",[l._v("Saldo Pendiente")]),u("p",{staticClass:"amount"},[l._v("$"+l._s(l.formatNumber(l.totalPendiente)))])])])]),u("div",{staticClass:"acciones-container"},[u("router-link",{staticClass:"btn-action btn-nueva-deuda",attrs:{to:"/procesos/deudas/nueva"}},[u("i",{staticClass:"icon"},[l._v("➕")]),u("span",[l._v("Nueva Deuda")])]),u("button",{staticClass:"btn-action btn-historial-precios",on:{click:l.openHistorialPreciosModal}},[u("i",{staticClass:"icon"},[l._v("📈")]),u("span",[l._v("Historial de Precios")])])],1),l.filtroProveedor?u("div",{staticClass:"abonos-proveedor-section"},[u("div",{staticClass:"proveedor-selected-info"},[u("h3",[l._v("Gestión de Abonos - "+l._s(l.getNombreProveedorSeleccionado()))]),u("div",{staticClass:"abonos-actions"},[u("button",{staticClass:"btn-abono-general",attrs:{disabled:!l.tieneDeudasPendientes},on:{click:l.abrirAbonoGeneral}},[u("i",{staticClass:"fas fa-money-check-alt"}),l._v(" Abono General ")]),u("button",{staticClass:"btn-historial-abonos",on:{click:l.abrirHistorialAbonos}},[u("i",{staticClass:"fas fa-history"}),l._v(" Historial de Abonos ")])])])]):l._e(),l.cargando?u("div",{staticClass:"loading-state"},[u("div",{staticClass:"loading-spinner"}),u("p",[l._v("Cargando deudas...")])]):0===l.deudas.length?u("div",{staticClass:"empty-state"},[u("div",{staticClass:"empty-icon"},[l._v("📄")]),u("h3",[l._v("No hay deudas registradas")]),u("p",[l._v("Comienza creando tu primera deuda a proveedores")]),u("router-link",{staticClass:"btn-action btn-nueva-deuda",attrs:{to:"/procesos/deudas/nueva"}},[u("i",{staticClass:"icon"},[l._v("➕")]),u("span",[l._v("Crear Nueva Deuda")])])],1):u("div",{staticClass:"deudas-container"},[u("div",{staticClass:"paginacion-info"},[u("p",[l._v("Mostrando "+l._s(l.totalDeudas)+" deudas agrupadas por proveedor")])]),l._l(l.deudasAgrupadasPorProveedor,(function(e){return u("div",{key:e.proveedor.id,staticClass:"proveedor-grupo"},[u("div",{staticClass:"proveedor-header"},[u("div",{staticClass:"proveedor-title"},[u("div",{staticClass:"proveedor-color-circle",style:{backgroundColor:e.proveedor.color}}),u("h2",{class:["proveedor-nombre","clickeable",{filtrado:l.filtroProveedor===e.proveedor.id}],attrs:{title:l.filtroProveedor===e.proveedor.id?"Haz clic para quitar el filtro":"Haz clic para filtrar por este proveedor"},on:{click:function(t){return l.filtrarPorProveedor(e.proveedor.id)}}},[l._v(" "+l._s(e.proveedor.nombre)+" "),u("i",{class:["fas",l.filtroProveedor===e.proveedor.id?"fa-check-circle":"fa-filter","filter-icon"]})])]),u("div",{staticClass:"proveedor-resumen"},[u("div",{staticClass:"resumen-item"},[u("span",{staticClass:"label"},[l._v("Total Deuda:")]),u("span",{staticClass:"value"},[l._v("$"+l._s(l.formatNumber(e.totalDeuda)))])]),u("div",{staticClass:"resumen-item"},[u("span",{staticClass:"label"},[l._v("Saldo Pendiente:")]),u("span",{staticClass:"value pendiente"},[l._v("$"+l._s(l.formatNumber(e.totalPendiente)))])]),u("div",{staticClass:"resumen-item"},[u("span",{staticClass:"label"},[l._v("Deudas:")]),u("span",{staticClass:"value"},[l._v(l._s(e.deudas.length))])])])]),u("div",{staticClass:"tabla-container-proveedor"},[u("table",{staticClass:"tabla-deudas-proveedor"},[l._m(2,!0),u("tbody",l._l(e.deudas,(function(e){return u("tr",{key:e.id,class:{"deuda-pagada":"pagado"===e.estado}},[u("td",[l._v(l._s(l.formatearFecha(e.fecha)))]),u("td",[l._v("$"+l._s(l.formatNumber(e.total)))]),u("td",[l._v("$"+l._s(l.formatNumber(e.saldoPendiente)))]),u("td",[u("span",{class:"estado-badge "+e.estado},[l._v(" "+l._s("pendiente"===e.estado?"Pendiente":"Pagado")+" ")])]),u("td",{staticClass:"acciones"},[u("button",{staticClass:"btn-detalle",attrs:{title:"Ver detalles"},on:{click:function(t){return l.verDetalle(e)}}},[u("i",{staticClass:"fas fa-eye"})]),u("button",{staticClass:"btn-abono",attrs:{disabled:"pagado"===e.estado,title:"Agregar abono"},on:{click:function(t){return l.agregarAbono(e)}}},[u("i",{staticClass:"fas fa-money-bill"})]),u("button",{staticClass:"btn-eliminar",attrs:{title:"Eliminar deuda"},on:{click:function(t){return l.eliminarDeuda(e)}}},[u("i",{staticClass:"fas fa-trash-alt"})])])])})),0)])])])}))],2),l.showDetalleModal?u("div",{staticClass:"modal-overlay",on:{click:l.closeModalOnOverlay}},[u("div",{staticClass:"modal-content",on:{click:function(e){e.stopPropagation()}}},[u("div",{staticClass:"modal-header"},[u("h2",[l._v("Detalle de Deuda")]),u("button",{staticClass:"close-button",on:{click:function(e){l.showDetalleModal=!1}}},[l._v("×")])]),u("div",{staticClass:"modal-body"},[u("div",{staticClass:"deuda-info editable-container"},[u("p",[u("strong",[l._v("Proveedor:")]),u("span",{staticClass:"editable-field",on:{click:function(e){return l.habilitarEdicionDeuda("proveedorNombre")}}},[l.campoEditandoDeuda&&"proveedorNombre"===l.campoEditandoDeuda?u("input",{directives:[{name:"model",rawName:"v-model",value:l.deudaEditada.proveedorNombre,expression:"deudaEditada.proveedorNombre"}],ref:"inputProveedorNombre",attrs:{type:"text"},domProps:{value:l.deudaEditada.proveedorNombre},on:{blur:l.guardarCambiosDeuda,keyup:function(e){return!e.type.indexOf("key")&&l._k(e.keyCode,"enter",13,e.key,"Enter")?null:l.guardarCambiosDeuda.apply(null,arguments)},input:function(e){e.target.composing||l.$set(l.deudaEditada,"proveedorNombre",e.target.value)}}}):u("span",[l._v(" "+l._s(null===(e=l.deudaSeleccionada)||void 0===e?void 0:e.proveedorNombre)+" ")])])]),u("p",[u("strong",[l._v("Fecha:")]),u("span",{staticClass:"editable-field",on:{click:function(e){return l.habilitarEdicionDeuda("fecha")}}},[l.campoEditandoDeuda&&"fecha"===l.campoEditandoDeuda?u("input",{directives:[{name:"model",rawName:"v-model",value:l.deudaEditada.fecha,expression:"deudaEditada.fecha"}],ref:"inputFecha",attrs:{type:"date"},domProps:{value:l.deudaEditada.fecha},on:{blur:l.guardarCambiosDeuda,keyup:function(e){return!e.type.indexOf("key")&&l._k(e.keyCode,"enter",13,e.key,"Enter")?null:l.guardarCambiosDeuda.apply(null,arguments)},input:function(e){e.target.composing||l.$set(l.deudaEditada,"fecha",e.target.value)}}}):u("span",[l._v(" "+l._s(l.formatearFecha(null===(t=l.deudaSeleccionada)||void 0===t?void 0:t.fecha))+" ")])])]),u("p",[u("strong",[l._v("Estado:")]),u("span",{class:"estado-badge "+(null===(a=l.deudaSeleccionada)||void 0===a?void 0:a.estado)},[l._v(" "+l._s("pendiente"===(null===(o=l.deudaSeleccionada)||void 0===o?void 0:o.estado)?"Pendiente":"Pagado")+" ")])])]),l._m(3),u("table",{staticClass:"tabla-productos"},[l._m(4),u("tbody",l._l(l.productos,(function(e,t){return u("tr",{key:t},[u("td",{staticClass:"editable-cell",on:{click:function(e){return l.habilitarEdicionProducto(t,"kilos")}}},[e.editando&&"kilos"===e.campoEditando?u("input",{directives:[{name:"model",rawName:"v-model.number",value:e.kilos,expression:"producto.kilos",modifiers:{number:!0}}],ref:"inputKilos",refInFor:!0,attrs:{type:"number",step:"0.01"},domProps:{value:e.kilos},on:{blur:[function(e){return l.guardarCambiosProducto(t)},function(e){return l.$forceUpdate()}],keyup:function(e){return!e.type.indexOf("key")&&l._k(e.keyCode,"enter",13,e.key,"Enter")?null:l.guardarCambiosProducto(t)},input:function(t){t.target.composing||l.$set(e,"kilos",l._n(t.target.value))}}}):u("span",[l._v(" "+l._s(l.formatNumber(e.kilos))+" ")])]),u("td",{staticClass:"editable-cell",on:{click:function(e){return l.habilitarEdicionProducto(t,"producto")}}},[e.editando&&"producto"===e.campoEditando?u("input",{directives:[{name:"model",rawName:"v-model",value:e.producto,expression:"producto.producto"}],ref:"inputProducto",refInFor:!0,attrs:{type:"text"},domProps:{value:e.producto},on:{blur:function(e){return l.guardarCambiosProducto(t)},keyup:function(e){return!e.type.indexOf("key")&&l._k(e.keyCode,"enter",13,e.key,"Enter")?null:l.guardarCambiosProducto(t)},input:function(t){t.target.composing||l.$set(e,"producto",t.target.value)}}}):u("span",[l._v(" "+l._s(e.producto)+" ")])]),u("td",{staticClass:"editable-cell",on:{click:function(e){return l.habilitarEdicionProducto(t,"precio")}}},[e.editando&&"precio"===e.campoEditando?u("input",{directives:[{name:"model",rawName:"v-model.number",value:e.precio,expression:"producto.precio",modifiers:{number:!0}}],ref:"inputPrecio",refInFor:!0,attrs:{type:"number",step:"0.01"},domProps:{value:e.precio},on:{blur:[function(e){return l.guardarCambiosProducto(t)},function(e){return l.$forceUpdate()}],keyup:function(e){return!e.type.indexOf("key")&&l._k(e.keyCode,"enter",13,e.key,"Enter")?null:l.guardarCambiosProducto(t)},input:function(t){t.target.composing||l.$set(e,"precio",l._n(t.target.value))}}}):u("span",[l._v(" $"+l._s(l.formatNumber(e.precio))+" ")])]),u("td",[l._v("$"+l._s(l.formatNumber(e.total)))]),u("td",[u("button",{staticClass:"btn-eliminar-sm",on:{click:function(e){return l.eliminarProducto(t)}}},[u("i",{staticClass:"fas fa-trash-alt"})])])])})),0),u("tfoot",[u("tr",[u("td",{staticClass:"total-label",attrs:{colspan:"3"}},[l._v("Total")]),u("td",[l._v("$"+l._s(l.formatNumber(l.totalProductos)))]),u("td")])])]),u("div",{staticClass:"add-product-section"},[u("h4",[l._v("Agregar Producto")]),u("ProductoSelector",{attrs:{"proveedor-id":null===(r=l.deudaSeleccionada)||void 0===r?void 0:r.proveedorId},on:{"agregar-producto":l.agregarProductoDesdeSelector}})],1),u("h3",[l._v("Abonos")]),0===l.abonos.length?u("div",{staticClass:"no-abonos"},[u("p",[l._v("No hay abonos registrados para esta deuda.")])]):u("table",{staticClass:"tabla-abonos"},[l._m(5),u("tbody",l._l(l.abonos,(function(e,t){return u("tr",{key:t},[u("td",{staticClass:"editable-cell",on:{click:function(e){return l.habilitarEdicionAbono(t,"fecha")}}},[e.editando&&"fecha"===e.campoEditando?u("input",{directives:[{name:"model",rawName:"v-model",value:e.fecha,expression:"abono.fecha"}],ref:"inputFechaAbono",refInFor:!0,attrs:{type:"date"},domProps:{value:e.fecha},on:{blur:function(e){return l.guardarCambiosAbono(t)},keyup:function(e){return!e.type.indexOf("key")&&l._k(e.keyCode,"enter",13,e.key,"Enter")?null:l.guardarCambiosAbono(t)},input:function(t){t.target.composing||l.$set(e,"fecha",t.target.value)}}}):u("span",[l._v(" "+l._s(l.formatearFecha(e.fecha))+" ")])]),u("td",{staticClass:"editable-cell",on:{click:function(e){return l.habilitarEdicionAbono(t,"descripcion")}}},[e.editando&&"descripcion"===e.campoEditando?u("input",{directives:[{name:"model",rawName:"v-model",value:e.descripcion,expression:"abono.descripcion"}],ref:"inputDescripcionAbono",refInFor:!0,attrs:{type:"text"},domProps:{value:e.descripcion},on:{blur:function(e){return l.guardarCambiosAbono(t)},keyup:function(e){return!e.type.indexOf("key")&&l._k(e.keyCode,"enter",13,e.key,"Enter")?null:l.guardarCambiosAbono(t)},input:function(t){t.target.composing||l.$set(e,"descripcion",t.target.value)}}}):u("span",[l._v(" "+l._s(e.descripcion)+" ")])]),u("td",{staticClass:"editable-cell",on:{click:function(e){return l.habilitarEdicionAbono(t,"monto")}}},[e.editando&&"monto"===e.campoEditando?u("input",{directives:[{name:"model",rawName:"v-model.number",value:e.monto,expression:"abono.monto",modifiers:{number:!0}}],ref:"inputMontoAbono",refInFor:!0,attrs:{type:"number",step:"0.01"},domProps:{value:e.monto},on:{blur:[function(e){return l.guardarCambiosAbono(t)},function(e){return l.$forceUpdate()}],keyup:function(e){return!e.type.indexOf("key")&&l._k(e.keyCode,"enter",13,e.key,"Enter")?null:l.guardarCambiosAbono(t)},input:function(t){t.target.composing||l.$set(e,"monto",l._n(t.target.value))}}}):u("span",[l._v(" $"+l._s(l.formatNumber(e.monto))+" ")])]),u("td",[u("button",{staticClass:"btn-eliminar-sm",on:{click:function(e){return l.eliminarAbono(t)}}},[u("i",{staticClass:"fas fa-trash-alt"})])])])})),0),u("tfoot",[u("tr",[u("td",{staticClass:"total-label",attrs:{colspan:"2"}},[l._v("Total Abonos")]),u("td",[l._v("$"+l._s(l.formatNumber(l.totalAbonos)))]),u("td")])])]),u("div",{staticClass:"resumen-deuda"},[u("div",{staticClass:"resumen-item"},[u("span",[l._v("Total deuda:")]),u("span",[l._v("$"+l._s(l.formatNumber(null===(i=l.deudaSeleccionada)||void 0===i?void 0:i.total)))])]),u("div",{staticClass:"resumen-item"},[u("span",[l._v("Total abonos:")]),u("span",[l._v("$"+l._s(l.formatNumber(l.totalAbonos)))])]),u("div",{staticClass:"resumen-item total"},[u("span",[l._v("Saldo pendiente:")]),u("span",[l._v("$"+l._s(l.formatNumber(l.calcularSaldoPendiente())))])])]),u("div",{staticClass:"modal-actions"},[u("button",{staticClass:"btn-actualizar",attrs:{disabled:l.guardando},on:{click:l.actualizarDeuda}},[l._v(" "+l._s(l.guardando?"Guardando...":"Actualizar Deuda")+" ")])])])])]):l._e(),l.showAbonoModal?u("div",{staticClass:"modal-overlay",on:{click:l.closeModalOnOverlay}},[u("div",{staticClass:"modal-content",on:{click:function(e){e.stopPropagation()}}},[u("div",{staticClass:"modal-header"},[u("h2",[l._v("Agregar Abono")]),u("button",{staticClass:"close-button",on:{click:function(e){l.showAbonoModal=!1}}},[l._v("×")])]),u("div",{staticClass:"modal-body"},[u("div",{staticClass:"deuda-info"},[u("p",[u("strong",[l._v("Proveedor:")]),l._v(" "+l._s(null===(s=l.deudaSeleccionada)||void 0===s?void 0:s.proveedorNombre))]),u("p",[u("strong",[l._v("Fecha Deuda:")]),l._v(" "+l._s(l.formatearFecha(null===(n=l.deudaSeleccionada)||void 0===n?void 0:n.fecha)))]),u("p",[u("strong",[l._v("Saldo Pendiente:")]),l._v(" $"+l._s(l.formatNumber(null===(d=l.deudaSeleccionada)||void 0===d?void 0:d.saldoPendiente)))])]),u("form",{staticClass:"form-abono",on:{submit:function(e){return e.preventDefault(),l.guardarAbono.apply(null,arguments)}}},[u("div",{staticClass:"form-group"},[u("label",{attrs:{for:"fechaAbono"}},[l._v("Fecha:")]),u("input",{directives:[{name:"model",rawName:"v-model",value:l.nuevoAbono.fecha,expression:"nuevoAbono.fecha"}],attrs:{id:"fechaAbono",type:"date",required:""},domProps:{value:l.nuevoAbono.fecha},on:{input:function(e){e.target.composing||l.$set(l.nuevoAbono,"fecha",e.target.value)}}})]),u("div",{staticClass:"form-group"},[u("label",{attrs:{for:"descripcionAbono"}},[l._v("Descripción:")]),u("input",{directives:[{name:"model",rawName:"v-model",value:l.nuevoAbono.descripcion,expression:"nuevoAbono.descripcion"}],attrs:{id:"descripcionAbono",type:"text",required:"",placeholder:"Ej: Pago parcial, Transferencia, etc."},domProps:{value:l.nuevoAbono.descripcion},on:{input:function(e){e.target.composing||l.$set(l.nuevoAbono,"descripcion",e.target.value)}}})]),u("div",{staticClass:"form-group"},[u("label",{attrs:{for:"montoAbono"}},[l._v("Monto:")]),u("input",{directives:[{name:"model",rawName:"v-model.number",value:l.nuevoAbono.monto,expression:"nuevoAbono.monto",modifiers:{number:!0}}],attrs:{id:"montoAbono",type:"number",required:"",min:"1",max:null===(c=l.deudaSeleccionada)||void 0===c?void 0:c.saldoPendiente},domProps:{value:l.nuevoAbono.monto},on:{input:function(e){e.target.composing||l.$set(l.nuevoAbono,"monto",l._n(e.target.value))},blur:function(e){return l.$forceUpdate()}}})]),u("div",{staticClass:"form-actions"},[u("button",{staticClass:"btn-cancelar",attrs:{type:"button"},on:{click:function(e){l.showAbonoModal=!1}}},[l._v("Cancelar")]),u("button",{staticClass:"btn-guardar",attrs:{type:"submit",disabled:l.guardando}},[l._v(" "+l._s(l.guardando?"Guardando...":"Guardar Abono")+" ")])])])])])]):l._e(),u("PreciosProveedorPanel",{attrs:{mostrar:l.showHistorialPreciosModal,proveedores:l.proveedores},on:{cerrar:function(e){l.showHistorialPreciosModal=!1}}}),u("AbonoGeneralModal",{attrs:{mostrar:l.showAbonoGeneralModal,proveedor:l.proveedorSeleccionadoParaAbono},on:{cerrar:function(e){l.showAbonoGeneralModal=!1},"abono-aplicado":l.onAbonoAplicado}}),u("HistorialAbonosModal",{attrs:{mostrar:l.showHistorialAbonosModal,proveedor:l.proveedorSeleccionadoParaAbono},on:{cerrar:function(e){l.showHistorialAbonosModal=!1},"abono-eliminado":l.onAbonoEliminado}})],1)},r=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"header-section"},[t("div",{staticClass:"header-content"},[t("h1",{staticClass:"main-title"},[t("i",{staticClass:"icon-list"},[e._v("📋")]),e._v(" Lista de Deudas a Proveedores ")]),t("p",{staticClass:"subtitle"},[e._v("Administra y monitorea todas las deudas pendientes")])])])},function(){var e=this,t=e._self._c;return t("h3",{staticClass:"filtros-title"},[t("i",{staticClass:"icon-filter"},[e._v("🔍")]),e._v(" Filtros de Búsqueda ")])},function(){var e=this,t=e._self._c;return t("thead",[t("tr",[t("th",[e._v("Fecha")]),t("th",[e._v("Monto Total")]),t("th",[e._v("Saldo Pendiente")]),t("th",[e._v("Estado")]),t("th",[e._v("Acciones")])])])},function(){var e=this,t=e._self._c;return t("h3",[e._v("Productos "),t("span",{staticClass:"small-text"},[e._v("(haga clic en un campo para editarlo)")])])},function(){var e=this,t=e._self._c;return t("thead",[t("tr",[t("th",[e._v("Kilos")]),t("th",[e._v("Producto")]),t("th",[e._v("Precio")]),t("th",[e._v("Total")]),t("th",[e._v("Acciones")])])])},function(){var e=this,t=e._self._c;return t("thead",[t("tr",[t("th",[e._v("Fecha")]),t("th",[e._v("Descripción")]),t("th",[e._v("Monto")]),t("th",[e._v("Acciones")])])])}],i=(a("14d9"),a("13d5"),a("dc59")),s=a("1494"),n=a("74c9"),d=a("a947"),c=a("687e"),l=a("4c15"),u=a("a54e"),v={name:"ListaDeudas",components:{BackButton:n["a"],PreciosProveedorPanel:d["a"],ProductoSelector:c["a"],AbonoGeneralModal:l["a"],HistorialAbonosModal:u["a"]},data(){return{deudas:[],proveedores:[],cargando:!0,guardando:!1,paginaActual:1,deudasPorPagina:15,filtroProveedor:"",filtroEstado:"pendiente",filtroFechaDesde:"",filtroFechaHasta:"",showDetalleModal:!1,showAbonoModal:!1,showHistorialPreciosModal:!1,showAbonoGeneralModal:!1,showHistorialAbonosModal:!1,deudaSeleccionada:null,productos:[],abonos:[],proveedorSeleccionadoParaAbono:null,nuevoAbono:{fecha:this.obtenerFechaActual(),descripcion:"",monto:null},campoEditandoDeuda:null,deudaEditada:{proveedorNombre:"",fecha:""}}},computed:{deudasFiltradas(){return this.deudas.filter(e=>(!this.filtroProveedor||e.proveedorId===this.filtroProveedor)&&((!this.filtroEstado||e.estado===this.filtroEstado)&&(!(this.filtroFechaDesde&&e.fecha<this.filtroFechaDesde)&&!(this.filtroFechaHasta&&e.fecha>this.filtroFechaHasta))))},totalDeudas(){return this.deudasFiltradas.length},totalPaginas(){return Math.ceil(this.totalDeudas/this.deudasPorPagina)},deudasPaginadas(){const e=(this.paginaActual-1)*this.deudasPorPagina,t=e+this.deudasPorPagina;return this.deudasFiltradas.slice(e,t)},deudasAgrupadasPorProveedor(){const e={};return this.deudasFiltradas.forEach(t=>{const a=t.proveedorId,o=t.proveedorNombre;e[a]||(e[a]={proveedor:{id:a,nombre:o,color:this.getProveedorColor(a)},deudas:[],totalDeuda:0,totalPendiente:0}),e[a].deudas.push(t),e[a].totalDeuda+=t.total,e[a].totalPendiente+=t.saldoPendiente}),Object.values(e).sort((e,t)=>e.proveedor.nombre.localeCompare(t.proveedor.nombre))},paginasVisibles(){const e=[],t=this.totalPaginas,a=this.paginaActual;let o=Math.max(1,a-2),r=Math.min(t,o+4);r-o<4&&(o=Math.max(1,r-4));for(let i=o;i<=r;i++)e.push(i);return e},totalMontoDeudas(){return this.deudasFiltradas.reduce((e,t)=>e+t.total,0)},totalPendiente(){return this.deudasFiltradas.reduce((e,t)=>e+t.saldoPendiente,0)},totalPagado(){return this.deudasFiltradas.reduce((e,t)=>e+(t.total-t.saldoPendiente),0)},totalProductos(){return this.productos.reduce((e,t)=>e+t.total,0)},totalAbonos(){return this.abonos.reduce((e,t)=>e+t.monto,0)},tieneDeudasPendientes(){return this.deudasFiltradas.some(e=>"pendiente"===e.estado)}},methods:{obtenerFechaActual(){const e=new Date,t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${t}-${a}-${o}`},cambiarPagina(e){e>=1&&e<=this.totalPaginas&&(this.paginaActual=e,window.scrollTo({top:0,behavior:"smooth"}))},async loadDeudas(){try{this.cargando=!0;const e=await Object(s["g"])(Object(s["o"])(Object(s["c"])(i["a"],"deudas"),Object(s["l"])("fecha","desc")));this.deudas=e.docs.map(e=>({id:e.id,...e.data()}))}catch(e){console.error("Error al cargar deudas: ",e)}finally{this.cargando=!1}},async loadProveedores(){try{const e=await Object(s["g"])(Object(s["c"])(i["a"],"proveedoresDeuda"));this.proveedores=e.docs.map(e=>({id:e.id,...e.data()}))}catch(e){console.error("Error al cargar proveedores: ",e)}},formatNumber(e){return e?e.toLocaleString("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00"},formatearFecha(e){if(!e)return"";const t=new Date(e+"T00:00:00"),a={year:"numeric",month:"long",day:"numeric"};return t.toLocaleDateString("es-ES",a)},closeModalOnOverlay(e){e.target===e.currentTarget&&(this.showDetalleModal=!1,this.showAbonoModal=!1,this.showHistorialPreciosModal=!1)},async verDetalle(e){this.deudaSeleccionada=e,this.productos=[],this.abonos=[];try{const t=await Object(s["g"])(Object(s["c"])(i["a"],"deudas",e.id,"productos"));this.productos=t.docs.map(e=>({id:e.id,...e.data()}));const a=await Object(s["g"])(Object(s["o"])(Object(s["c"])(i["a"],"deudas",e.id,"abonos"),Object(s["l"])("fechaCreacion","desc")));this.abonos=a.docs.map(e=>({id:e.id,...e.data()})),this.showDetalleModal=!0}catch(t){console.error("Error al cargar detalle de deuda: ",t)}},agregarAbono(e){this.deudaSeleccionada=e,this.nuevoAbono={fecha:this.obtenerFechaActual(),descripcion:"",monto:null},this.showAbonoModal=!0},async guardarAbono(){if(this.nuevoAbono.descripcion&&this.nuevoAbono.monto)if(this.nuevoAbono.monto<=0)alert("El monto del abono debe ser mayor a cero");else if(this.nuevoAbono.monto>this.deudaSeleccionada.saldoPendiente)alert("El monto del abono no puede ser mayor al saldo pendiente");else try{this.guardando=!0,await Object(s["b"])(Object(s["c"])(i["a"],"deudas",this.deudaSeleccionada.id,"abonos"),{descripcion:this.nuevoAbono.descripcion,monto:this.nuevoAbono.monto,fecha:this.nuevoAbono.fecha,fechaCreacion:new Date});const e=this.deudaSeleccionada.saldoPendiente-this.nuevoAbono.monto,t=e<=0?"pagado":"pendiente";await Object(s["r"])(Object(s["e"])(i["a"],"deudas",this.deudaSeleccionada.id),{saldoPendiente:e,estado:t}),this.deudas=this.deudas.map(a=>a.id===this.deudaSeleccionada.id?{...a,saldoPendiente:e,estado:t}:a),this.deudaSeleccionada.saldoPendiente=e,this.deudaSeleccionada.estado=t,this.showAbonoModal=!1,alert("Abono registrado correctamente")}catch(e){console.error("Error al guardar abono: ",e),alert("Error al guardar abono: "+e.message)}finally{this.guardando=!1}else alert("Por favor complete todos los campos del abono")},async eliminarDeuda(e){if(confirm(`¿Está seguro que desea eliminar la deuda de ${e.proveedorNombre}? Esta acción no se puede deshacer.`))try{this.cargando=!0;const t=await Object(s["g"])(Object(s["c"])(i["a"],"deudas",e.id,"productos")),a=Object(s["t"])(i["a"]);t.forEach(t=>{a.delete(Object(s["e"])(i["a"],"deudas",e.id,"productos",t.id))});const o=await Object(s["g"])(Object(s["c"])(i["a"],"deudas",e.id,"abonos"));o.forEach(t=>{a.delete(Object(s["e"])(i["a"],"deudas",e.id,"abonos",t.id))}),await a.commit(),await Object(s["d"])(Object(s["e"])(i["a"],"deudas",e.id)),this.deudas=this.deudas.filter(t=>t.id!==e.id),alert("Deuda eliminada correctamente")}catch(t){console.error("Error al eliminar la deuda: ",t),alert("Error al eliminar la deuda: "+t.message)}finally{this.cargando=!1}},habilitarEdicionDeuda(e){this.campoEditandoDeuda=e,"proveedorNombre"===e?(this.deudaEditada.proveedorNombre=this.deudaSeleccionada.proveedorNombre,this.$nextTick(()=>{this.$refs.inputProveedorNombre.focus()})):"fecha"===e&&(this.deudaEditada.fecha=this.deudaSeleccionada.fecha,this.$nextTick(()=>{this.$refs.inputFecha.focus()}))},async guardarCambiosDeuda(){if(!this.campoEditandoDeuda)return;const e=this.campoEditandoDeuda;if(this.campoEditandoDeuda=null,("proveedorNombre"!==e||this.deudaEditada.proveedorNombre!==this.deudaSeleccionada.proveedorNombre)&&("fecha"!==e||this.deudaEditada.fecha!==this.deudaSeleccionada.fecha))try{await Object(s["r"])(Object(s["e"])(i["a"],"deudas",this.deudaSeleccionada.id),{[e]:this.deudaEditada[e]}),this.deudaSeleccionada[e]=this.deudaEditada[e],this.deudas=this.deudas.map(t=>t.id===this.deudaSeleccionada.id?{...t,[e]:this.deudaEditada[e]}:t)}catch(t){console.error("Error al actualizar deuda: ",t),alert("Error al guardar cambios: "+t.message)}},habilitarEdicionProducto(e,t){this.productos=this.productos.map((a,o)=>o===e?{...a,editando:!0,campoEditando:t}:{...a,editando:!1,campoEditando:null}),this.$nextTick(()=>{const e="input"+(t.charAt(0).toUpperCase()+t.slice(1));this.$refs[e]&&this.$refs[e][0]&&this.$refs[e][0].focus()})},async guardarCambiosProducto(e){const t=this.productos[e];if(t.editando){"kilos"!==t.campoEditando&&"precio"!==t.campoEditando||(t.total=t.kilos*t.precio);try{await Object(s["r"])(Object(s["e"])(i["a"],"deudas",this.deudaSeleccionada.id,"productos",t.id),{kilos:t.kilos,producto:t.producto,precio:t.precio,total:t.total});const e=this.productos.reduce((e,t)=>e+t.total,0),a=e-this.totalAbonos;await Object(s["r"])(Object(s["e"])(i["a"],"deudas",this.deudaSeleccionada.id),{total:e,saldoPendiente:a,estado:a<=0?"pagado":"pendiente"}),this.deudaSeleccionada.total=e,this.deudaSeleccionada.saldoPendiente=a,this.deudaSeleccionada.estado=a<=0?"pagado":"pendiente",this.deudas=this.deudas.map(t=>t.id===this.deudaSeleccionada.id?{...t,total:e,saldoPendiente:a,estado:a<=0?"pagado":"pendiente"}:t),t.editando=!1,t.campoEditando=null}catch(a){console.error("Error al actualizar producto: ",a),alert("Error al guardar cambios del producto: "+a.message)}}},async agregarProducto(){if(this.nuevoProducto.kilos&&this.nuevoProducto.producto&&this.nuevoProducto.precio)try{this.guardando=!0;const e=this.nuevoProducto.kilos*this.nuevoProducto.precio,t=await Object(s["b"])(Object(s["c"])(i["a"],"deudas",this.deudaSeleccionada.id,"productos"),{kilos:this.nuevoProducto.kilos,producto:this.nuevoProducto.producto,precio:this.nuevoProducto.precio,total:e});this.productos.push({id:t.id,kilos:this.nuevoProducto.kilos,producto:this.nuevoProducto.producto,precio:this.nuevoProducto.precio,total:e,editando:!1,campoEditando:null});const a=this.productos.reduce((e,t)=>e+t.total,0),o=a-this.totalAbonos;await Object(s["r"])(Object(s["e"])(i["a"],"deudas",this.deudaSeleccionada.id),{total:a,saldoPendiente:o,estado:o<=0?"pagado":"pendiente"}),this.deudaSeleccionada.total=a,this.deudaSeleccionada.saldoPendiente=o,this.deudaSeleccionada.estado=o<=0?"pagado":"pendiente",this.deudas=this.deudas.map(e=>e.id===this.deudaSeleccionada.id?{...e,total:a,saldoPendiente:o,estado:o<=0?"pagado":"pendiente"}:e),this.nuevoProducto={kilos:null,producto:"",precio:null}}catch(e){console.error("Error al agregar producto: ",e),alert("Error al agregar producto: "+e.message)}finally{this.guardando=!1}else alert("Por favor complete todos los campos del producto")},async eliminarProducto(e){if(!confirm("¿Está seguro de eliminar este producto?"))return;const t=this.productos[e];try{this.guardando=!0,await Object(s["d"])(Object(s["e"])(i["a"],"deudas",this.deudaSeleccionada.id,"productos",t.id)),this.productos.splice(e,1);const a=this.productos.reduce((e,t)=>e+t.total,0),o=a-this.totalAbonos;await Object(s["r"])(Object(s["e"])(i["a"],"deudas",this.deudaSeleccionada.id),{total:a,saldoPendiente:o,estado:o<=0?"pagado":"pendiente"}),this.deudaSeleccionada.total=a,this.deudaSeleccionada.saldoPendiente=o,this.deudaSeleccionada.estado=o<=0?"pagado":"pendiente",this.deudas=this.deudas.map(e=>e.id===this.deudaSeleccionada.id?{...e,total:a,saldoPendiente:o,estado:o<=0?"pagado":"pendiente"}:e)}catch(a){console.error("Error al eliminar producto: ",a),alert("Error al eliminar producto: "+a.message)}finally{this.guardando=!1}},habilitarEdicionAbono(e,t){this.abonos=this.abonos.map((a,o)=>o===e?{...a,editando:!0,campoEditando:t}:{...a,editando:!1,campoEditando:null}),this.$nextTick(()=>{const e=`input${t.charAt(0).toUpperCase()+t.slice(1)}Abono`;this.$refs[e]&&this.$refs[e][0]&&this.$refs[e][0].focus()})},async guardarCambiosAbono(e){var t;const a=this.abonos[e];if(!a.editando)return;const o=(null===(t=this.abonos.find(e=>e.id===a.id))||void 0===t?void 0:t.monto)||0;try{if(await Object(s["r"])(Object(s["e"])(i["a"],"deudas",this.deudaSeleccionada.id,"abonos",a.id),{fecha:a.fecha,descripcion:a.descripcion,monto:a.monto}),a.monto!==o){const e=this.calcularSaldoPendiente();await Object(s["r"])(Object(s["e"])(i["a"],"deudas",this.deudaSeleccionada.id),{saldoPendiente:e,estado:e<=0?"pagado":"pendiente"}),this.deudaSeleccionada.saldoPendiente=e,this.deudaSeleccionada.estado=e<=0?"pagado":"pendiente",this.deudas=this.deudas.map(t=>t.id===this.deudaSeleccionada.id?{...t,saldoPendiente:e,estado:e<=0?"pagado":"pendiente"}:t)}a.editando=!1,a.campoEditando=null}catch(r){console.error("Error al actualizar abono: ",r),alert("Error al guardar cambios del abono: "+r.message)}},async eliminarAbono(e){if(!confirm("¿Está seguro de eliminar este abono?"))return;const t=this.abonos[e];try{this.guardando=!0,await Object(s["d"])(Object(s["e"])(i["a"],"deudas",this.deudaSeleccionada.id,"abonos",t.id)),this.abonos.splice(e,1);const a=this.calcularSaldoPendiente();await Object(s["r"])(Object(s["e"])(i["a"],"deudas",this.deudaSeleccionada.id),{saldoPendiente:a,estado:a<=0?"pagado":"pendiente"}),this.deudaSeleccionada.saldoPendiente=a,this.deudaSeleccionada.estado=a<=0?"pagado":"pendiente",this.deudas=this.deudas.map(e=>e.id===this.deudaSeleccionada.id?{...e,saldoPendiente:a,estado:a<=0?"pagado":"pendiente"}:e)}catch(a){console.error("Error al eliminar abono: ",a),alert("Error al eliminar abono: "+a.message)}finally{this.guardando=!1}},calcularSaldoPendiente(){var e;return(null===(e=this.deudaSeleccionada)||void 0===e?void 0:e.total)-this.totalAbonos},async actualizarDeuda(){try{this.guardando=!0;const e=this.calcularSaldoPendiente(),t=e<=0?"pagado":"pendiente";await Object(s["r"])(Object(s["e"])(i["a"],"deudas",this.deudaSeleccionada.id),{saldoPendiente:e,estado:t}),this.deudaSeleccionada.saldoPendiente=e,this.deudaSeleccionada.estado=t,this.deudas=this.deudas.map(a=>a.id===this.deudaSeleccionada.id?{...a,saldoPendiente:e,estado:t}:a),alert("Deuda actualizada correctamente"),this.showDetalleModal=!1}catch(e){console.error("Error al actualizar deuda: ",e),alert("Error al actualizar deuda: "+e.message)}finally{this.guardando=!1}},openHistorialPreciosModal(){this.showHistorialPreciosModal=!0,0===this.proveedores.length&&this.loadProveedores()},getNombreProveedorSeleccionado(){const e=this.proveedores.find(e=>e.id===this.filtroProveedor);return e?e.nombre:""},getProveedorColor(e){const t=this.proveedores.find(t=>t.id===e);return t&&t.color?t.color:"#cccccc"},abrirAbonoGeneral(){if(!this.filtroProveedor)return void alert("Por favor, seleccione un proveedor primero.");const e=this.proveedores.find(e=>e.id===this.filtroProveedor);e?(this.proveedorSeleccionadoParaAbono=e,this.showAbonoGeneralModal=!0):(alert("No se encontró el proveedor seleccionado. Por favor, actualice la página e intente de nuevo."),console.error("Proveedor no encontrado:",this.filtroProveedor,"en lista:",this.proveedores))},abrirHistorialAbonos(){if(!this.filtroProveedor)return void alert("Por favor, seleccione un proveedor primero.");const e=this.proveedores.find(e=>e.id===this.filtroProveedor);e?(this.proveedorSeleccionadoParaAbono=e,this.showHistorialAbonosModal=!0):(alert("No se encontró el proveedor seleccionado. Por favor, actualice la página e intente de nuevo."),console.error("Proveedor no encontrado:",this.filtroProveedor,"en lista:",this.proveedores))},async onAbonoAplicado(){try{await this.loadDeudas(),console.log("Deudas recargadas después de aplicar abono")}catch(e){console.error("Error al recargar deudas después de aplicar abono:",e)}},async onAbonoEliminado(e){try{if(console.log("Abono eliminado - Info recibida:",e),e&&e.deudaId){const t=this.deudas.findIndex(t=>t.id===e.deudaId);-1!==t&&(this.$set(this.deudas,t,{...this.deudas[t],saldoPendiente:e.nuevoSaldo,estado:e.nuevoEstado}),console.log("Deuda actualizada localmente inmediatamente:",{id:e.deudaId,saldoPendiente:e.nuevoSaldo,estado:e.nuevoEstado})),setTimeout(async()=>{try{await this.actualizarDeudaEspecifica(e.proveedorId),console.log("Verificación desde Firebase completada")}catch(t){console.error("Error en verificación desde Firebase:",t)}},1e3)}else console.log("No hay información específica, recargando todas las deudas..."),await new Promise(e=>setTimeout(e,500)),await this.loadDeudas()}catch(t){console.error("Error al actualizar después de eliminar abono:",t),await this.loadDeudas()}},async actualizarDeudaEspecifica(e){try{const t=Object(s["o"])(Object(s["c"])(i["a"],"deudas"),Object(s["s"])("proveedorId","==",e)),a=await Object(s["g"])(t),o=a.docs.map(e=>({id:e.id,...e.data()}));o.forEach(e=>{const t=this.deudas.findIndex(t=>t.id===e.id);-1!==t&&(this.$set(this.deudas,t,e),console.log("Deuda actualizada localmente:",e.id,"Estado:",e.estado,"Saldo Pendiente:",e.saldoPendiente))})}catch(t){console.error("Error al actualizar deuda específica:",t)}},agregarProductoDesdeSelector(e){this.agregarProductoDirecto(e)},filtrarPorProveedor(e){this.filtroProveedor===e?this.filtroProveedor="":this.filtroProveedor=e,this.paginaActual=1,window.scrollTo({top:0,behavior:"smooth"})},async agregarProductoDirecto(e){try{this.guardando=!0;const t=await Object(s["b"])(Object(s["c"])(i["a"],"deudas",this.deudaSeleccionada.id,"productos"),{kilos:e.kilos,producto:e.producto,precio:e.precio,total:e.total});this.productos.push({id:t.id,kilos:e.kilos,producto:e.producto,precio:e.precio,total:e.total,editando:!1,campoEditando:null});const a=this.productos.reduce((e,t)=>e+t.total,0),o=a-this.totalAbonos;await Object(s["r"])(Object(s["e"])(i["a"],"deudas",this.deudaSeleccionada.id),{total:a,saldoPendiente:o,estado:o<=0?"pagado":"pendiente"}),this.deudaSeleccionada.total=a,this.deudaSeleccionada.saldoPendiente=o,this.deudaSeleccionada.estado=o<=0?"pagado":"pendiente",this.deudas=this.deudas.map(e=>e.id===this.deudaSeleccionada.id?{...e,total:a,saldoPendiente:o,estado:o<=0?"pagado":"pendiente"}:e)}catch(t){console.error("Error al agregar producto: ",t),alert("Error al agregar producto: "+t.message)}finally{this.guardando=!1}}},watch:{filtroProveedor(){this.paginaActual=1},filtroEstado(){this.paginaActual=1},filtroFechaDesde(){this.paginaActual=1},filtroFechaHasta(){this.paginaActual=1}},async mounted(){await Promise.all([this.loadDeudas(),this.loadProveedores()])}},p=v,m=(a("ae67"),a("2877")),b=Object(m["a"])(p,o,r,!1,null,"90e0fa96",null);t["a"]=b.exports},a55b:function(e,t,a){"use strict";var o=function(){var e=this,t=e._self._c;return t("div",{staticClass:"login-container"},[t("div",{staticClass:"login-box"},[t("h2",[e._v("Iniciar Sesión")]),t("form",{on:{submit:function(t){return t.preventDefault(),e.handleLogin.apply(null,arguments)}}},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"username"}},[e._v("Usuario:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.username,expression:"username"}],staticClass:"form-input",attrs:{type:"text",id:"username",required:""},domProps:{value:e.username},on:{input:function(t){t.target.composing||(e.username=t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"password"}},[e._v("Contraseña:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],staticClass:"form-input",attrs:{type:"password",id:"password",required:""},domProps:{value:e.password},on:{input:function(t){t.target.composing||(e.password=t.target.value)}}})]),e.error?t("div",{staticClass:"error-message"},[e._v(" "+e._s(e.error)+" ")]):e._e(),t("button",{staticClass:"login-button",attrs:{type:"submit"}},[e._v(" Iniciar Sesión ")])])])])},r=[],i=(a("14d9"),a("f549")),s={name:"Login",data(){return{username:"",password:"",error:""}},methods:{async handleLogin(){try{const e=Object(i["a"])(),t=await e.login(this.username,this.password);t?this.$router.push("/"):this.error="Usuario o contraseña incorrectos"}catch(e){console.error("Error en login:",e),this.error="Error al iniciar sesión"}}}},n=s,d=(a("2b68"),a("2877")),c=Object(d["a"])(n,o,r,!1,null,"6889dfef",null);t["a"]=c.exports},ad3c:function(e,t,a){"use strict";a("2155")},ae67:function(e,t,a){"use strict";a("6f4f")},bb51:function(e,t,a){"use strict";var o=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"home"}},[t("b-container",[t("Datos")],1)],1)},r=[],i=a("caa9"),s={name:"home",components:{Datos:i["a"]}},n=s,d=a("2877"),c=Object(d["a"])(n,o,r,!1,null,null,null);t["a"]=c.exports},d5fa:function(e,t,a){},e3b7:function(e,t,a){},e524:function(e,t,a){"use strict";var o=function(){var e=this,t=e._self._c;return t("div",{staticClass:"bitacoras-container"},[t("h1",{staticClass:"page-title"},[e._v("Bitácoras de Mantenimiento - Cuartos Fríos")]),t("div",{staticClass:"filters-container"},[t("div",{staticClass:"filter-group"},[t("label",{attrs:{for:"cuarto-select"}},[e._v("Cuarto Frío:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:e.filtrosCuarto,expression:"filtrosCuarto"}],staticClass:"form-control",attrs:{id:"cuarto-select"},on:{change:function(t){var a=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.filtrosCuarto=t.target.multiple?a:a[0]}}},[t("option",{attrs:{value:""}},[e._v("Todos los cuartos")]),t("option",{attrs:{value:"1"}},[e._v("Cuarto Frío #1")]),t("option",{attrs:{value:"2"}},[e._v("Cuarto Frío #2")]),t("option",{attrs:{value:"3"}},[e._v("Cuarto Frío #3")]),t("option",{attrs:{value:"4"}},[e._v("Cuarto Frío #4")]),t("option",{attrs:{value:"5"}},[e._v("Cuarto Frío Don Chuy")])])]),t("div",{staticClass:"filter-group"},[t("label",{attrs:{for:"fecha-desde"}},[e._v("Desde:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.filtroFechaDesde,expression:"filtroFechaDesde"}],staticClass:"form-control",attrs:{type:"date",id:"fecha-desde"},domProps:{value:e.filtroFechaDesde},on:{input:function(t){t.target.composing||(e.filtroFechaDesde=t.target.value)}}})]),t("div",{staticClass:"filter-group"},[t("label",{attrs:{for:"fecha-hasta"}},[e._v("Hasta:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.filtroFechaHasta,expression:"filtroFechaHasta"}],staticClass:"form-control",attrs:{type:"date",id:"fecha-hasta"},domProps:{value:e.filtroFechaHasta},on:{input:function(t){t.target.composing||(e.filtroFechaHasta=t.target.value)}}})]),t("button",{staticClass:"btn-filtrar",on:{click:e.aplicarFiltros}},[t("i",{staticClass:"fas fa-filter"}),e._v(" Filtrar ")])]),t("div",{staticClass:"actions-row"},[t("button",{staticClass:"btn-nueva-bitacora",on:{click:function(t){e.mostrarFormulario=!0}}},[t("i",{staticClass:"fas fa-plus"}),e._v(" Nueva Bitácora ")])]),t("div",{staticClass:"table-responsive"},[t("table",{staticClass:"bitacoras-table"},[e._m(0),t("tbody",[e.cargando?t("tr",[t("td",{staticClass:"loading-data",attrs:{colspan:"7"}},[e._v("Cargando bitácoras...")])]):0===e.bitacoras.length?t("tr",[t("td",{staticClass:"no-data",attrs:{colspan:"7"}},[e._v("No hay bitácoras registradas")])]):e._e(),e._l(e.bitacorasFiltradas,(function(a,o){return t("tr",{key:a.id},[t("td",[e._v(e._s(e.formatearFecha(a.fecha)))]),t("td",[e._v(e._s(e.formatearNombreCuarto(a.cuartoId)))]),t("td",[e._v(e._s(a.temperatura)+"°C")]),t("td",[e._v(e._s(a.tecnico))]),t("td",[e._v(e._s(a.tipoMantenimiento))]),t("td",{class:"estado-"+a.estado.toLowerCase()},[e._v(e._s(a.estado))]),t("td",{staticClass:"acciones"},[t("button",{staticClass:"btn-accion editar",on:{click:function(t){return e.editarBitacora(a)}}},[t("i",{staticClass:"fas fa-edit"})]),t("button",{staticClass:"btn-accion ver",on:{click:function(t){return e.verDetalles(a)}}},[t("i",{staticClass:"fas fa-eye"})]),t("button",{staticClass:"btn-accion eliminar",on:{click:function(t){return e.confirmarEliminarBitacora(a)}}},[t("i",{staticClass:"fas fa-trash"})])])])}))],2)])]),e.mostrarFormulario?t("div",{staticClass:"modal-overlay"},[t("div",{staticClass:"modal-content"},[t("div",{staticClass:"modal-header"},[t("h2",[e._v(e._s(e.modoEdicion?"Editar Bitácora":"Nueva Bitácora"))]),t("button",{staticClass:"btn-cerrar",on:{click:e.cerrarFormulario}},[t("i",{staticClass:"fas fa-times"})])]),t("div",{staticClass:"modal-body"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"cuarto"}},[e._v("Cuarto Frío:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:e.bitacoraActual.cuartoId,expression:"bitacoraActual.cuartoId"}],staticClass:"form-control",attrs:{id:"cuarto",required:""},on:{change:function(t){var a=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(e.bitacoraActual,"cuartoId",t.target.multiple?a:a[0])}}},[t("option",{attrs:{value:"",disabled:""}},[e._v("Seleccione un cuarto frío")]),t("option",{attrs:{value:"1"}},[e._v("Cuarto Frío #1")]),t("option",{attrs:{value:"2"}},[e._v("Cuarto Frío #2")]),t("option",{attrs:{value:"3"}},[e._v("Cuarto Frío #3")]),t("option",{attrs:{value:"4"}},[e._v("Cuarto Frío #4")]),t("option",{attrs:{value:"5"}},[e._v("Cuarto Frío Don Chuy")])])]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"fecha"}},[e._v("Fecha:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.bitacoraActual.fecha,expression:"bitacoraActual.fecha"}],staticClass:"form-control",attrs:{type:"date",id:"fecha",required:""},domProps:{value:e.bitacoraActual.fecha},on:{input:function(t){t.target.composing||e.$set(e.bitacoraActual,"fecha",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"temperatura"}},[e._v("Temperatura (°C):")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.bitacoraActual.temperatura,expression:"bitacoraActual.temperatura"}],staticClass:"form-control",attrs:{type:"number",id:"temperatura",step:"0.1",required:""},domProps:{value:e.bitacoraActual.temperatura},on:{input:function(t){t.target.composing||e.$set(e.bitacoraActual,"temperatura",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"tecnico"}},[e._v("Técnico:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.bitacoraActual.tecnico,expression:"bitacoraActual.tecnico"}],staticClass:"form-control",attrs:{type:"text",id:"tecnico",required:""},domProps:{value:e.bitacoraActual.tecnico},on:{input:function(t){t.target.composing||e.$set(e.bitacoraActual,"tecnico",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"tipo-mantenimiento"}},[e._v("Tipo de Mantenimiento:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:e.bitacoraActual.tipoMantenimiento,expression:"bitacoraActual.tipoMantenimiento"}],staticClass:"form-control",attrs:{id:"tipo-mantenimiento",required:""},on:{change:function(t){var a=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(e.bitacoraActual,"tipoMantenimiento",t.target.multiple?a:a[0])}}},[t("option",{attrs:{value:"",disabled:""}},[e._v("Seleccione tipo")]),t("option",{attrs:{value:"Preventivo"}},[e._v("Preventivo")]),t("option",{attrs:{value:"Correctivo"}},[e._v("Correctivo")]),t("option",{attrs:{value:"Revisión"}},[e._v("Revisión")])])]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"estado"}},[e._v("Estado:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:e.bitacoraActual.estado,expression:"bitacoraActual.estado"}],staticClass:"form-control",attrs:{id:"estado",required:""},on:{change:function(t){var a=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(e.bitacoraActual,"estado",t.target.multiple?a:a[0])}}},[t("option",{attrs:{value:"",disabled:""}},[e._v("Seleccione estado")]),t("option",{attrs:{value:"Óptimo"}},[e._v("Óptimo")]),t("option",{attrs:{value:"Regular"}},[e._v("Regular")]),t("option",{attrs:{value:"Requiere Atención"}},[e._v("Requiere Atención")]),t("option",{attrs:{value:"Crítico"}},[e._v("Crítico")])])]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"observaciones"}},[e._v("Observaciones:")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.bitacoraActual.observaciones,expression:"bitacoraActual.observaciones"}],staticClass:"form-control",attrs:{id:"observaciones",rows:"4"},domProps:{value:e.bitacoraActual.observaciones},on:{input:function(t){t.target.composing||e.$set(e.bitacoraActual,"observaciones",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"acciones"}},[e._v("Acciones Realizadas:")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.bitacoraActual.accionesRealizadas,expression:"bitacoraActual.accionesRealizadas"}],staticClass:"form-control",attrs:{id:"acciones",rows:"4"},domProps:{value:e.bitacoraActual.accionesRealizadas},on:{input:function(t){t.target.composing||e.$set(e.bitacoraActual,"accionesRealizadas",t.target.value)}}})])]),t("div",{staticClass:"modal-footer"},[t("button",{staticClass:"btn-cancelar",on:{click:e.cerrarFormulario}},[e._v("Cancelar")]),t("button",{staticClass:"btn-guardar",attrs:{disabled:e.guardando},on:{click:e.guardarBitacora}},[e._v(" "+e._s(e.guardando?"Guardando...":"Guardar")+" ")])])])]):e._e(),e.mostrarDetalles?t("div",{staticClass:"modal-overlay"},[t("div",{staticClass:"modal-content"},[t("div",{staticClass:"modal-header"},[t("h2",[e._v("Detalles de Bitácora")]),t("button",{staticClass:"btn-cerrar",on:{click:function(t){e.mostrarDetalles=!1}}},[t("i",{staticClass:"fas fa-times"})])]),t("div",{staticClass:"modal-body detalles"},[t("div",{staticClass:"detalle-grupo"},[t("h3",[e._v("Información General")]),t("p",[t("strong",[e._v("Cuarto Frío:")]),e._v(" "+e._s(e.formatearNombreCuarto(e.bitacoraDetalle.cuartoId)))]),t("p",[t("strong",[e._v("Fecha:")]),e._v(" "+e._s(e.formatearFecha(e.bitacoraDetalle.fecha)))]),t("p",[t("strong",[e._v("Temperatura:")]),e._v(" "+e._s(e.bitacoraDetalle.temperatura)+"°C")]),t("p",[t("strong",[e._v("Técnico:")]),e._v(" "+e._s(e.bitacoraDetalle.tecnico))])]),t("div",{staticClass:"detalle-grupo"},[t("h3",[e._v("Mantenimiento")]),t("p",[t("strong",[e._v("Tipo:")]),e._v(" "+e._s(e.bitacoraDetalle.tipoMantenimiento))]),t("p",[t("strong",[e._v("Estado:")]),e._v(" "),t("span",{class:"estado-tag estado-"+e.bitacoraDetalle.estado.toLowerCase()},[e._v(e._s(e.bitacoraDetalle.estado))])])]),t("div",{staticClass:"detalle-grupo"},[t("h3",[e._v("Observaciones")]),t("p",{staticClass:"texto-largo"},[e._v(e._s(e.bitacoraDetalle.observaciones||"Sin observaciones"))])]),t("div",{staticClass:"detalle-grupo"},[t("h3",[e._v("Acciones Realizadas")]),t("p",{staticClass:"texto-largo"},[e._v(e._s(e.bitacoraDetalle.accionesRealizadas||"Sin acciones registradas"))])])]),t("div",{staticClass:"modal-footer"},[t("button",{staticClass:"btn-cerrar-detalles",on:{click:function(t){e.mostrarDetalles=!1}}},[e._v("Cerrar")]),t("button",{staticClass:"btn-editar-detalles",on:{click:e.editarBitacoraDesdeDetalles}},[e._v("Editar")])])])]):e._e(),e.mostrarConfirmacionEliminar?t("div",{staticClass:"modal-overlay"},[t("div",{staticClass:"modal-content modal-confirmacion"},[t("div",{staticClass:"modal-header"},[t("h2",[e._v("Confirmar Eliminación")]),t("button",{staticClass:"btn-cerrar",on:{click:function(t){e.mostrarConfirmacionEliminar=!1}}},[t("i",{staticClass:"fas fa-times"})])]),t("div",{staticClass:"modal-body"},[t("p",{staticClass:"mensaje-confirmacion"},[e._v(" ¿Está seguro que desea eliminar la bitácora del "+e._s(e.formatearFecha(e.bitacoraEliminar.fecha))+" para el "+e._s(e.formatearNombreCuarto(e.bitacoraEliminar.cuartoId))+"? ")]),t("p",{staticClass:"advertencia"},[e._v("Esta acción no se puede deshacer.")])]),t("div",{staticClass:"modal-footer"},[t("button",{staticClass:"btn-cancelar",on:{click:function(t){e.mostrarConfirmacionEliminar=!1}}},[e._v("Cancelar")]),t("button",{staticClass:"btn-eliminar",attrs:{disabled:e.eliminando},on:{click:e.eliminarBitacora}},[e._v(" "+e._s(e.eliminando?"Eliminando...":"Eliminar")+" ")])])])]):e._e()])},r=[function(){var e=this,t=e._self._c;return t("thead",[t("tr",[t("th",[e._v("Fecha")]),t("th",[e._v("Cuarto Frío")]),t("th",[e._v("Temperatura")]),t("th",[e._v("Técnico")]),t("th",[e._v("Tipo de Mantenimiento")]),t("th",[e._v("Estado")]),t("th",[e._v("Acciones")])])])}],i=(a("d9e2"),a("dc59")),s=a("1494"),n={name:"Bitacoras",data(){return{bitacoras:[],mostrarFormulario:!1,mostrarDetalles:!1,mostrarConfirmacionEliminar:!1,modoEdicion:!1,bitacoraActual:this.inicializarBitacora(),bitacoraDetalle:{},bitacoraEliminar:{},filtrosCuarto:"",filtroFechaDesde:"",filtroFechaHasta:"",cargando:!0,guardando:!1,eliminando:!1}},computed:{bitacorasFiltradas(){let e=[...this.bitacoras];return this.filtrosCuarto&&(e=e.filter(e=>e.cuartoId.toString()===this.filtrosCuarto)),this.filtroFechaDesde&&(e=e.filter(e=>new Date(e.fecha)>=new Date(this.filtroFechaDesde))),this.filtroFechaHasta&&(e=e.filter(e=>new Date(e.fecha)<=new Date(this.filtroFechaHasta))),e.sort((e,t)=>new Date(t.fecha)-new Date(e.fecha))}},created(){this.cargarBitacoras()},methods:{inicializarBitacora(){return{id:null,cuartoId:"",fecha:(new Date).toISOString().substr(0,10),temperatura:"",tecnico:"",tipoMantenimiento:"",estado:"",observaciones:"",accionesRealizadas:"",createdAt:null,updatedAt:null}},async cargarBitacoras(){this.cargando=!0;try{const e=Object(s["c"])(i["a"],"bitacoras"),t=Object(s["o"])(e,Object(s["l"])("fecha","desc")),a=await Object(s["g"])(t);this.bitacoras=a.docs.map(e=>{const t=e.data(),a=e.id.toString();return console.log("Cargando bitácora con ID: "+a),{id:a,cuartoId:t.cuartoId||"",fecha:t.fecha||(new Date).toISOString().substr(0,10),temperatura:t.temperatura||0,tecnico:t.tecnico||"",tipoMantenimiento:t.tipoMantenimiento||"",estado:t.estado||"",observaciones:t.observaciones||"",accionesRealizadas:t.accionesRealizadas||"",createdAt:t.createdAt||null,updatedAt:t.updatedAt||null}}),console.log(`Se cargaron ${this.bitacoras.length} bitácoras`)}catch(e){console.error("Error al cargar bitácoras:",e),alert("Error al cargar las bitácoras: "+(e.message||"Error desconocido"))}finally{this.cargando=!1}},formatearFecha(e){if(!e)return"";const t={year:"numeric",month:"long",day:"numeric"};return new Date(e).toLocaleDateString("es-ES",t)},formatearNombreCuarto(e){return e?"5"===e?"Cuarto Frío Don Chuy":"Cuarto Frío #"+e:""},aplicarFiltros(){},editarBitacora(e){this.modoEdicion=!0,this.bitacoraActual={...e},this.mostrarFormulario=!0},verDetalles(e){this.bitacoraDetalle={...e},this.mostrarDetalles=!0},cerrarFormulario(){this.mostrarFormulario=!1,this.modoEdicion=!1,this.bitacoraActual=this.inicializarBitacora(),this.guardando=!1},async guardarBitacora(){if(this.validarFormulario()){this.guardando=!0;try{const e={...this.bitacoraActual,cuartoId:this.bitacoraActual.cuartoId.toString(),temperatura:parseFloat(this.bitacoraActual.temperatura)||0,tecnico:this.bitacoraActual.tecnico.trim(),tipoMantenimiento:this.bitacoraActual.tipoMantenimiento,estado:this.bitacoraActual.estado,observaciones:this.bitacoraActual.observaciones||"",accionesRealizadas:this.bitacoraActual.accionesRealizadas||"",updatedAt:Object(s["p"])()};if(this.modoEdicion){if(!e.id)throw new Error("ID de bitácora no válido para actualización");console.log("Actualizando bitácora con ID:",e.id);const{id:t,...a}=e,o=Object(s["e"])(i["a"],"bitacoras",t.toString());await Object(s["r"])(o,a);const r=this.bitacoras.findIndex(e=>e.id===t);-1!==r&&this.bitacoras.splice(r,1,e),console.log("Bitácora actualizada con éxito")}else{e.createdAt=Object(s["p"])(),console.log("Creando nueva bitácora");const t=await Object(s["b"])(Object(s["c"])(i["a"],"bitacoras"),e),a={...e,id:t.id.toString()};console.log("Nueva bitácora creada con ID:",a.id),this.bitacoras.unshift(a)}this.cerrarFormulario(),alert(this.modoEdicion?"Bitácora actualizada con éxito":"Bitácora creada con éxito")}catch(e){console.error("Error al guardar bitácora:",e),alert("Error al guardar la bitácora: "+(e.message||"Error desconocido"))}finally{this.guardando=!1}}},validarFormulario(){return!!(this.bitacoraActual.cuartoId&&this.bitacoraActual.fecha&&""!==this.bitacoraActual.temperatura&&this.bitacoraActual.tecnico&&this.bitacoraActual.tipoMantenimiento&&this.bitacoraActual.estado)||(alert("Por favor complete todos los campos obligatorios"),!1)},editarBitacoraDesdeDetalles(){this.editarBitacora(this.bitacoraDetalle),this.mostrarDetalles=!1},confirmarEliminarBitacora(e){if(!e||!e.id)return console.error("Intento de eliminar una bitácora sin ID válido:",e),void alert("No se puede eliminar esta bitácora porque no tiene un ID válido");console.log("Preparando eliminación de bitácora con ID:",e.id),this.bitacoraEliminar={...e},this.mostrarConfirmacionEliminar=!0},async eliminarBitacora(){this.eliminando=!0;try{if(!this.bitacoraEliminar||!this.bitacoraEliminar.id)throw new Error("ID de bitácora no válido");const e=this.bitacoraEliminar.id.toString();console.log("Intentando eliminar bitácora con ID:",e);const t=Object(s["e"])(i["a"],"bitacoras",e);await Object(s["d"])(t);const a=this.bitacoras.findIndex(t=>t.id===e);-1!==a&&this.bitacoras.splice(a,1),this.mostrarConfirmacionEliminar=!1,alert("Bitácora eliminada con éxito")}catch(e){console.error("Error al eliminar bitácora:",e),alert("Error al eliminar la bitácora: "+(e.message||"Error desconocido"))}finally{this.eliminando=!1,this.bitacoraEliminar={}}}}},d=n,c=(a("05e4"),a("2877")),l=Object(c["a"])(d,o,r,!1,null,"fc24882a",null);t["a"]=l.exports},f411:function(e,t,a){"use strict";var o=function(){var e=this,t=e._self._c;return t("div",{staticClass:"notes-wrapper"},[t("div",{staticClass:"button-container"},[t("div",{staticClass:"button-wrapper"},[t("button",{on:{click:e.goToSaleNote}},[e._v("Nueva nota")])]),t("div",{staticClass:"button-wrapper"},[t("button",{on:{click:e.goToAddClient}},[e._v("Agregar Cliente")])])]),t("div",{staticClass:"notes-container"},[t("div",{staticClass:"filter-container"},[t("select",{directives:[{name:"model",rawName:"v-model",value:e.paymentFilter,expression:"paymentFilter"}],on:{change:function(t){var a=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.paymentFilter=t.target.multiple?a:a[0]}}},[t("option",{attrs:{value:"all"}},[e._v("Todas")]),t("option",{attrs:{value:"paid"}},[e._v("Pagadas")]),t("option",{attrs:{value:"unpaid"}},[e._v("No Pagadas")])])]),t("h2",[e._v("Notas por Cliente")]),e._l(e.filteredNotesByClient,(function(a,o){return t("div",{key:o},[t("details",[t("summary",[e._v(" "+e._s(o)+" - Debe: "+e._s(e._f("currency")(e.totalDebtByClient[o]))+" "),t("span",{staticClass:"note-count"},[e._v("("+e._s(a.length)+")")])]),t("ul",e._l(a,(function(a){return t("li",{key:a.id},[t("button",{attrs:{tabindex:"0"},on:{click:function(t){return e.goToEditNote(a.id)}}},[e._v(" Nota "+e._s(a.folio)+" - "+e._s(a.currentDate)+" ")])])})),0),t("div",{staticClass:"client-actions"},[t("button",{staticClass:"abono-button",on:{click:function(t){return e.showAbonoModal(o)}}},[e._v("Realizar Abono")]),t("button",{staticClass:"abonos-history-button",on:{click:function(t){return e.showAbonosHistory(o)}}},[e._v("Ver Abonos")])])])])}))],2),e.showModal?t("div",{staticClass:"modal"},[t("div",{staticClass:"modal-content"},[t("h2",[e._v("Realizar Abono para "+e._s(e.selectedClient))]),t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.abonoAmount,expression:"abonoAmount",modifiers:{number:!0}}],attrs:{type:"number",placeholder:"Cantidad a abonar"},domProps:{value:e.abonoAmount},on:{input:function(t){t.target.composing||(e.abonoAmount=e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}}),t("button",{on:{click:e.realizarAbono}},[e._v("Confirmar Abono")]),t("button",{on:{click:e.closeModal}},[e._v("Cancelar")])])]):e._e(),e.showAbonosHistoryModal?t("div",{staticClass:"modal"},[t("div",{staticClass:"modal-content"},[t("h2",[e._v("Historial de Abonos para "+e._s(e.selectedClient))]),t("table",{staticClass:"abonos-history-table"},[e._m(0),t("tbody",e._l(e.paginatedAbonos,(function(a,o){return t("tr",{key:o},[t("td",[e._v(e._s(e.formatDate(a.fecha)))]),t("td",[e._v(e._s(e._f("currency")(a.monto)))]),t("td",[t("button",{staticClass:"delete-button",on:{click:function(t){return e.openDeleteAbonoModal(a.globalIndex)}}},[e._v("Borrar")])])])})),0)]),t("div",{staticClass:"pagination"},[t("button",{attrs:{disabled:1===e.currentPage},on:{click:e.prevPage}},[e._v("Anterior")]),t("span",[e._v("Página "+e._s(e.currentPage)+" de "+e._s(e.totalPages))]),t("button",{attrs:{disabled:e.currentPage===e.totalPages},on:{click:e.nextPage}},[e._v("Siguiente")])]),t("button",{on:{click:e.closeAbonosHistoryModal}},[e._v("Cerrar")])])]):e._e(),e.showDeleteAbonoModal?t("div",{staticClass:"modal"},[t("div",{staticClass:"modal-content"},[t("h2",[e._v("Confirmar borrado de abono")]),t("p",[e._v("¿Estás seguro de que quieres borrar este abono?")]),t("button",{on:{click:e.deleteAbono}},[e._v("Confirmar")]),t("button",{on:{click:e.closeDeleteAbonoModal}},[e._v("Cancelar")])])]):e._e()])},r=[function(){var e=this,t=e._self._c;return t("thead",[t("tr",[t("th",[e._v("Fecha")]),t("th",[e._v("Monto")]),t("th",[e._v("Acciones")])])])}],i=(a("14d9"),a("13d5"),a("dc59")),s=a("1494"),n={name:"NoteMenu",data(){return{notesByClient:{},paymentFilter:"unpaid",showModal:!1,selectedClient:"",abonoAmount:0,showAbonosHistoryModal:!1,clientAbonosHistory:[],showDeleteAbonoModal:!1,selectedAbonoIndex:null,selectedAbonoNote:null,currentPage:1,abonosPerPage:7}},methods:{goToSaleNote(){this.$router.push({name:"SaleNote"})},goToAddClient(){this.$router.push({name:"AddClient"})},async fetchNotes(){try{const e=await Object(s["g"])(Object(s["c"])(i["a"],"notes")),t=e.docs.map(e=>({id:e.id,...e.data()}));this.notesByClient=t.reduce((e,t)=>(e[t.client]||(e[t.client]=[]),e[t.client].push(t),e),{});for(let a in this.notesByClient)this.notesByClient[a].sort((e,t)=>new Date(t.currentDate)-new Date(e.currentDate))}catch(e){console.error("Error fetching notes: ",e)}},goToEditNote(e){this.$router.push({name:"editar-nota",params:{noteId:e}})},showAbonoModal(e){this.selectedClient=e,this.abonoAmount="",this.showModal=!0},closeModal(){this.showModal=!1,this.selectedClient="",this.abonoAmount=0},async realizarAbono(){if(this.abonoAmount<=0)return void alert("Por favor ingrese una cantidad válida");let e=this.abonoAmount;const t=[],a=new Date,o=[...this.notesByClient[this.selectedClient]].sort((e,t)=>new Date(e.currentDate)-new Date(t.currentDate)).filter(e=>!e.isPaid);for(let i of o){if(e<=0)break;const o=i.products.reduce((e,t)=>e+t.kilos*t.pricePerKilo,0),r=i.abonos.reduce((e,t)=>e+t.monto,0),s=o-r;if(s>0){const n=Math.min(e,s);i.abonos.push({monto:n,fecha:a.toISOString().split("T")[0]}),i.isPaid=o<=r+n,e-=n,t.push(i)}}try{for(let e of t){const t=Object(s["e"])(i["a"],"notes",e.id);await Object(s["r"])(t,{abonos:e.abonos,isPaid:e.isPaid})}alert("Abono aplicado con éxito"),this.closeModal(),await this.fetchNotes()}catch(r){console.error("Error al actualizar las notas:",r),alert("Hubo un error al aplicar el abono")}},async showAbonosHistory(e){this.selectedClient=e,this.clientAbonosHistory=[],this.currentPage=1;const t=this.notesByClient[e];let a=0;for(let o of t)o.abonos&&o.abonos.length>0&&o.abonos.forEach((e,t)=>{this.clientAbonosHistory.push({...e,noteId:o.id,abonoIndex:t,globalIndex:a++})});this.clientAbonosHistory.sort((e,t)=>new Date(t.fecha)-new Date(e.fecha)),this.showAbonosHistoryModal=!0},closeAbonosHistoryModal(){this.showAbonosHistoryModal=!1,this.clientAbonosHistory=[]},formatDate(e){const t={year:"numeric",month:"long",day:"numeric"};return new Date(e).toLocaleDateString("es-ES",t)},prevPage(){this.currentPage>1&&this.currentPage--},nextPage(){this.currentPage<this.totalPages&&this.currentPage++},openDeleteAbonoModal(e){const t=this.clientAbonosHistory[e];this.selectedAbonoIndex=t.abonoIndex,this.selectedAbonoNote=t.noteId,this.showDeleteAbonoModal=!0},async deleteAbono(){if(this.selectedAbonoNote)try{const e=Object(s["e"])(i["a"],"notes",this.selectedAbonoNote),t=await Object(s["f"])(e);if(t.exists()){const a=t.data(),o=a.abonos.filter((e,t)=>t!==this.selectedAbonoIndex);await Object(s["r"])(e,{abonos:o}),this.clientAbonosHistory=this.clientAbonosHistory.filter(e=>!(e.noteId===this.selectedAbonoNote&&e.abonoIndex===this.selectedAbonoIndex));const r=this.notesByClient[this.selectedClient].findIndex(e=>e.id===this.selectedAbonoNote);-1!==r&&(this.notesByClient[this.selectedClient][r].abonos=o),this.closeDeleteAbonoModal(),this.currentPage=Math.min(this.currentPage,this.totalPages),alert("Abono eliminado con éxito"),await this.fetchNotes()}}catch(e){console.error("Error al eliminar el abono:",e),alert("Hubo un error al eliminar el abono")}},closeDeleteAbonoModal(){this.showDeleteAbonoModal=!1,this.selectedAbonoIndex=null,this.selectedAbonoNote=null}},computed:{filteredNotesByClient(){const e={};for(const[t,a]of Object.entries(this.notesByClient))e[t]=a.filter(e=>"all"===this.paymentFilter||("paid"===this.paymentFilter?e.isPaid:!e.isPaid)),0===e[t].length&&delete e[t];return e},totalDebtByClient(){const e={};for(const[t,a]of Object.entries(this.notesByClient))e[t]=a.reduce((e,t)=>{const a=t.products.reduce((e,t)=>e+t.kilos*t.pricePerKilo,0)-t.abonos.reduce((e,t)=>e+t.monto,0);return e+(t.isPaid?0:a)},0);return e},paginatedAbonos(){const e=(this.currentPage-1)*this.abonosPerPage,t=e+this.abonosPerPage;return this.clientAbonosHistory.slice(e,t)},totalPages(){return Math.ceil(this.clientAbonosHistory.length/this.abonosPerPage)}},filters:{currency(e){return e?new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(e):"$0.00"}},async mounted(){await this.fetchNotes()}},d=n,c=(a("6ad3"),a("2877")),l=Object(c["a"])(d,o,r,!1,null,"8753db2c",null);t["a"]=l.exports},f740:function(e,t,a){"use strict";a("03df")}}]);