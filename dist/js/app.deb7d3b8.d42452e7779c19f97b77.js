(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["app.deb7d3b8"],{"0d65":function(e,a,t){"use strict";var r=function(){var e=this,a=e._self._c;return a("BaseModal",{attrs:{mostrar:e.mostrar,titulo:"Nueva Medida",textoBotonConfirmar:"Siguiente"},on:{cerrar:function(a){return e.$emit("cerrar")},confirmar:e.guardarMedida}},[a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"medidaInput"}},[e._v("Nombre de la Medida:")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.medidaLocal,expression:"medidaLocal"}],ref:"medidaInput",staticClass:"form-control",attrs:{type:"text",id:"medidaInput",placeholder:"Ej: 16/20, 21/25, 26/30, etc."},domProps:{value:e.medidaLocal},on:{keyup:function(a){return!a.type.indexOf("key")&&e._k(a.keyCode,"enter",13,a.key,"Enter")?null:e.guardarMedida.apply(null,arguments)},input:function(a){a.target.composing||(e.medidaLocal=a.target.value)}}})]),a("div",{staticClass:"ejemplos-medidas"},[a("p",[a("strong",[e._v("Ejemplos:")])]),a("div",{staticClass:"ejemplos-lista"},[a("span",{staticClass:"ejemplo-tag",on:{click:function(a){return e.seleccionarEjemplo("16/20")}}},[e._v("16/20")]),a("span",{staticClass:"ejemplo-tag",on:{click:function(a){return e.seleccionarEjemplo("21/25")}}},[e._v("21/25")]),a("span",{staticClass:"ejemplo-tag",on:{click:function(a){return e.seleccionarEjemplo("26/30")}}},[e._v("26/30")]),a("span",{staticClass:"ejemplo-tag",on:{click:function(a){return e.seleccionarEjemplo("31/35")}}},[e._v("31/35")]),a("span",{staticClass:"ejemplo-tag",on:{click:function(a){return e.seleccionarEjemplo("36/40")}}},[e._v("36/40")]),a("span",{staticClass:"ejemplo-tag",on:{click:function(a){return e.seleccionarEjemplo("41/50")}}},[e._v("41/50")]),a("span",{staticClass:"ejemplo-tag",on:{click:function(a){return e.seleccionarEjemplo("51/60")}}},[e._v("51/60")]),a("span",{staticClass:"ejemplo-tag",on:{click:function(a){return e.seleccionarEjemplo("61/70")}}},[e._v("61/70")])])])])},o=[],i=t("ff7a"),s={name:"MedidaModal",components:{BaseModal:i["a"]},props:{mostrar:{type:Boolean,required:!0},medida:{type:String,default:""}},data(){return{medidaLocal:""}},watch:{mostrar(e){e&&(this.medidaLocal=this.medida,this.$nextTick(()=>{var e;null===(e=this.$refs.medidaInput)||void 0===e||e.focus()}))},medida(e){this.medidaLocal=e}},methods:{guardarMedida(){const e=this.medidaLocal.trim();e?this.$emit("guardar",e):alert("Por favor ingrese el nombre de la medida")},seleccionarEjemplo(e){var a;this.medidaLocal=e,null===(a=this.$refs.medidaInput)||void 0===a||a.focus()}}},n=s,l=(t("d66c"),t("2877")),d=Object(l["a"])(n,r,o,!1,null,"50e98fd6",null);a["a"]=d.exports},1155:function(e,a,t){"use strict";var r=function(){var e=this,a=e._self._c;return a("div",{staticClass:"gestionar-productos-container"},[a("div",{staticClass:"back-button-container"},[a("BackButton",{attrs:{to:"/sacadas"}})],1),a("h1",[e._v("GestiÃ³n de Productos")]),a("div",{staticClass:"actions-container"},[a("router-link",{staticClass:"action-button",attrs:{to:"/gestionar-medidas"}},[e._v(" Gestionar Medidas ")]),a("router-link",{staticClass:"action-button",attrs:{to:"/gestionar-proveedores"}},[e._v(" Gestionar Proveedores ")])],1),a("div",{staticClass:"modify-product-form"},[a("h2",[e._v("Modificar Existencia de Producto")]),a("form",{on:{submit:function(a){return a.preventDefault(),e.modifyProduct.apply(null,arguments)}}},[a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"tipo"}},[e._v("Tipo:")]),a("select",{directives:[{name:"model",rawName:"v-model",value:e.modifyProductData.tipo,expression:"modifyProductData.tipo"}],attrs:{id:"tipo",required:""},on:{change:function(a){var t=Array.prototype.filter.call(a.target.options,(function(e){return e.selected})).map((function(e){var a="_value"in e?e._value:e.value;return a}));e.$set(e.modifyProductData,"tipo",a.target.multiple?t:t[0])}}},[a("option",{attrs:{value:"proveedor"}},[e._v("Proveedor")]),a("option",{attrs:{value:"maquila"}},[e._v("Maquila")])])]),a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"proveedor"}},[e._v("Proveedor/Maquila:")]),a("select",{directives:[{name:"model",rawName:"v-model",value:e.modifyProductData.proveedor,expression:"modifyProductData.proveedor"}],attrs:{id:"proveedor",required:""},on:{change:function(a){var t=Array.prototype.filter.call(a.target.options,(function(e){return e.selected})).map((function(e){var a="_value"in e?e._value:e.value;return a}));e.$set(e.modifyProductData,"proveedor",a.target.multiple?t:t[0])}}},[a("option",{attrs:{value:""}},[e._v("Seleccione un proveedor/maquila")]),e._l(e.proveedoresFiltrados,(function(t){return a("option",{key:t.id,domProps:{value:t.nombre}},[e._v(" "+e._s(t.nombre)+" ")])}))],2)]),a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"medida"}},[e._v("Medida:")]),a("select",{directives:[{name:"model",rawName:"v-model",value:e.modifyProductData.medida,expression:"modifyProductData.medida"}],attrs:{id:"medida",required:""},on:{change:function(a){var t=Array.prototype.filter.call(a.target.options,(function(e){return e.selected})).map((function(e){var a="_value"in e?e._value:e.value;return a}));e.$set(e.modifyProductData,"medida",a.target.multiple?t:t[0])}}},[a("option",{attrs:{value:""}},[e._v("Seleccione una medida")]),e._l(e.medidasFiltradas,(function(t){return a("option",{key:t.id,domProps:{value:t.nombre}},[e._v(" "+e._s(t.nombre)+" ")])}))],2)]),a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"kilos"}},[e._v("Kilos:")]),a("input",{directives:[{name:"model",rawName:"v-model.number",value:e.modifyProductData.kilos,expression:"modifyProductData.kilos",modifiers:{number:!0}}],attrs:{id:"kilos",type:"number",step:"0.1",required:""},domProps:{value:e.modifyProductData.kilos},on:{input:function(a){a.target.composing||e.$set(e.modifyProductData,"kilos",e._n(a.target.value))},blur:function(a){return e.$forceUpdate()}}})]),a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"operacion"}},[e._v("OperaciÃ³n:")]),a("select",{directives:[{name:"model",rawName:"v-model",value:e.modifyProductData.operacion,expression:"modifyProductData.operacion"}],attrs:{id:"operacion",required:""},on:{change:function(a){var t=Array.prototype.filter.call(a.target.options,(function(e){return e.selected})).map((function(e){var a="_value"in e?e._value:e.value;return a}));e.$set(e.modifyProductData,"operacion",a.target.multiple?t:t[0])}}},[a("option",{attrs:{value:"sumar"}},[e._v("Sumar")]),a("option",{attrs:{value:"restar"}},[e._v("Restar")])])]),a("button",{staticClass:"submit-btn",attrs:{type:"submit"}},[e._v("Modificar Existencia")])])]),a("div",{staticClass:"products-list"},[a("h2",[e._v("Existencias Actuales")]),a("ul",e._l(e.existencias,(function(t,r){return a("li",{key:r},[a("strong",[e._v(e._s(r))]),a("ul",e._l(t,(function(t,r){return a("li",{key:r},[e._v(" "+e._s(r)+" - "+e._s(e.formatNumber(t))+" kg ")])})),0)])})),0)]),a("router-link",{staticClass:"back-btn",attrs:{to:"/sacadas"}},[e._v("Volver al MenÃº de Sacadas")])],1)},o=[],i=(t("14d9"),t("2b0e")),s=t("dc59"),n=t("1494"),l=t("74c9"),d={name:"GestionarProductos",components:{BackButton:l["a"]},setup(){const e=Object(i["ref"])({}),a=Object(i["ref"])([]),t=Object(i["ref"])([]),r=Object(i["ref"])({tipo:"proveedor",proveedor:"",medida:"",kilos:null,operacion:"sumar"}),o=async()=>{try{const a=await Object(n["g"])(Object(n["c"])(s["a"],"sacadas")),t={};a.forEach(e=>{const a=e.data();a.entradas.forEach(e=>{t[e.proveedor]||(t[e.proveedor]={}),t[e.proveedor][e.medida]||(t[e.proveedor][e.medida]=0),t[e.proveedor][e.medida]+=e.kilos}),a.salidas.forEach(e=>{t[e.proveedor]||(t[e.proveedor]={}),t[e.proveedor][e.medida]||(t[e.proveedor][e.medida]=0),t[e.proveedor][e.medida]-=e.kilos})}),Object.keys(t).forEach(e=>{t[e]=Object.fromEntries(Object.entries(t[e]).filter(([e,a])=>a>0))}),e.value=t}catch(a){console.error("Error al cargar existencias: ",a)}},l=async()=>{try{const e=await Object(n["g"])(Object(n["c"])(s["a"],"medidas"));a.value=e.docs.map(e=>({id:e.id,...e.data()}))}catch(e){console.error("Error al cargar medidas: ",e)}},d=async()=>{try{const e=await Object(n["g"])(Object(n["c"])(s["a"],"proveedores"));t.value=e.docs.map(e=>({id:e.id,...e.data()}))}catch(e){console.error("Error al cargar proveedores: ",e)}},c=async()=>{try{const{proveedor:e,medida:a,kilos:t,operacion:i}=r.value,l={fecha:new Date,entradas:[],salidas:[]};"sumar"===i?l.entradas.push({proveedor:e,medida:a,kilos:t}):l.salidas.push({proveedor:e,medida:a,kilos:t}),await Object(n["b"])(Object(n["c"])(s["a"],"sacadas"),l),alert("Existencia modificada con Ã©xito"),r.value={tipo:"proveedor",proveedor:"",medida:"",kilos:null,operacion:"sumar"},o()}catch(e){console.error("Error al modificar producto: ",e),alert("Error al modificar la existencia del producto")}},u=e=>e.toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1}),m=Object(i["computed"])(()=>t.value.filter(e=>"proveedor"===r.value.tipo?"maquila"!==e.tipo:"maquila"===e.tipo)),p=Object(i["computed"])(()=>a.value.filter(e=>"proveedor"===r.value.tipo?"general"===e.tipo:"maquila"===e.tipo));return Object(i["onMounted"])(()=>{o(),l(),d()}),{existencias:e,medidas:a,proveedores:t,modifyProductData:r,modifyProduct:c,formatNumber:u,proveedoresFiltrados:m,medidasFiltradas:p}}},c=d,u=(t("e6b2"),t("2877")),m=Object(u["a"])(c,r,o,!1,null,"67f08a69",null);a["a"]=m.exports},"1b56":function(e,a,t){},"2cc6":function(e,a,t){"use strict";var r=function(){var e=this,a=e._self._c;return a("div",{staticClass:"gestionar-medidas-container"},[a("div",{staticClass:"back-button-container"},[a("BackButton",{attrs:{to:"/gestionar-productos"}})],1),a("h1",[e._v("GestiÃ³n de Medidas")]),a("div",{staticClass:"add-medida-form"},[a("h2",[e._v("Agregar Medida")]),a("form",{on:{submit:function(a){return a.preventDefault(),e.addMedida.apply(null,arguments)}}},[a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"medida"}},[e._v("Medida:")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.newMedida.nombre,expression:"newMedida.nombre"}],attrs:{id:"medida",required:"",placeholder:"Ej: 16/20, 21/25, 26/30, etc."},domProps:{value:e.newMedida.nombre},on:{input:function(a){a.target.composing||e.$set(e.newMedida,"nombre",a.target.value)}}})]),a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"tipo"}},[e._v("Tipo:")]),a("select",{directives:[{name:"model",rawName:"v-model",value:e.newMedida.tipo,expression:"newMedida.tipo"}],attrs:{id:"tipo",required:""},on:{change:function(a){var t=Array.prototype.filter.call(a.target.options,(function(e){return e.selected})).map((function(e){var a="_value"in e?e._value:e.value;return a}));e.$set(e.newMedida,"tipo",a.target.multiple?t:t[0])}}},[a("option",{attrs:{value:"general"}},[e._v("General")]),a("option",{attrs:{value:"maquila"}},[e._v("Maquila")])])]),"maquila"===e.newMedida.tipo?a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"maquila"}},[e._v("Maquila:")]),a("select",{directives:[{name:"model",rawName:"v-model",value:e.newMedida.maquilaId,expression:"newMedida.maquilaId"}],attrs:{id:"maquila",required:""},on:{change:function(a){var t=Array.prototype.filter.call(a.target.options,(function(e){return e.selected})).map((function(e){var a="_value"in e?e._value:e.value;return a}));e.$set(e.newMedida,"maquilaId",a.target.multiple?t:t[0])}}},[a("option",{attrs:{value:""}},[e._v("Seleccione una maquila")]),e._l(e.maquilas,(function(t){return a("option",{key:t.id,domProps:{value:t.id}},[e._v(" "+e._s(t.nombre)+" ")])}))],2)]):e._e(),a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"proveedor"}},[e._v("Proveedor:")]),a("select",{directives:[{name:"model",rawName:"v-model",value:e.newMedida.proveedorId,expression:"newMedida.proveedorId"}],attrs:{id:"proveedor"},on:{change:function(a){var t=Array.prototype.filter.call(a.target.options,(function(e){return e.selected})).map((function(e){var a="_value"in e?e._value:e.value;return a}));e.$set(e.newMedida,"proveedorId",a.target.multiple?t:t[0])}}},[a("option",{attrs:{value:""}},[e._v("General")]),e._l(e.proveedores,(function(t){return a("option",{key:t.id,domProps:{value:t.id}},[e._v(" "+e._s(t.nombre)+" ")])}))],2)]),a("button",{staticClass:"submit-btn",attrs:{type:"submit"}},[e._v("Agregar Medida")])])]),a("div",{staticClass:"medidas-list"},[a("h2",[e._v("Lista de Medidas")]),a("h3",[e._v("Medidas Generales")]),a("ul",e._l(e.medidasGenerales,(function(t){return a("li",{key:t.id},[e._v(" "+e._s(t.nombre)+" "),a("button",{staticClass:"delete-btn",on:{click:function(a){return e.deleteMedida(t.id)}}},[e._v("Eliminar")])])})),0),a("h3",[e._v("Medidas de Proveedores")]),e._l(e.proveedores,(function(t){return a("div",{key:t.id},[a("h4",[e._v(e._s(t.nombre))]),a("ul",e._l(e.getMedidasProveedor(t.id),(function(t){return a("li",{key:t.id},[e._v(" "+e._s(t.nombre)+" "),a("button",{staticClass:"delete-btn",on:{click:function(a){return e.deleteMedida(t.id)}}},[e._v("Eliminar")])])})),0)])})),a("h3",[e._v("Medidas de Maquilas")]),e._l(e.maquilas,(function(t){return a("div",{key:t.id},[a("h4",[e._v(e._s(t.nombre))]),a("ul",e._l(e.getMedidasMaquila(t.id),(function(t){return a("li",{key:t.id},[e._v(" "+e._s(t.nombre)+" "),a("button",{staticClass:"delete-btn",on:{click:function(a){return e.deleteMedida(t.id)}}},[e._v("Eliminar")])])})),0)])}))],2)])},o=[],i=t("2b0e"),s=t("dc59"),n=t("1494"),l=t("74c9"),d={name:"GestionarMedidas",components:{BackButton:l["a"]},setup(){const e=Object(i["ref"])([]),a=Object(i["ref"])([]),t=Object(i["ref"])([]),r=Object(i["ref"])({nombre:"",tipo:"general",maquilaId:"",proveedorId:""}),o=async()=>{try{const a=await Object(n["g"])(Object(n["c"])(s["a"],"medidas"));e.value=a.docs.map(e=>({id:e.id,...e.data()}))}catch(a){console.error("Error al cargar medidas: ",a)}},l=async()=>{try{const e=Object(n["o"])(Object(n["c"])(s["a"],"proveedores"),Object(n["t"])("tipo","==","maquila")),a=await Object(n["g"])(e);t.value=a.docs.map(e=>({id:e.id,...e.data()}))}catch(e){console.error("Error al cargar maquilas: ",e)}},d=async()=>{try{const e=await Object(n["g"])(Object(n["c"])(s["a"],"proveedores"));a.value=e.docs.map(e=>({id:e.id,...e.data()}))}catch(e){console.error("Error al cargar proveedores: ",e)}},c=async()=>{try{await Object(n["b"])(Object(n["c"])(s["a"],"medidas"),{nombre:r.value.nombre,tipo:r.value.tipo,maquilaId:"maquila"===r.value.tipo?r.value.maquilaId:null,proveedorId:"general"===r.value.tipo?r.value.proveedorId:null}),r.value={nombre:"",tipo:"general",maquilaId:"",proveedorId:""},o()}catch(e){console.error("Error al aÃ±adir medida: ",e)}},u=async e=>{if(confirm("Â¿EstÃ¡s seguro de que quieres eliminar esta medida?"))try{await Object(n["d"])(Object(n["e"])(s["a"],"medidas",e)),o()}catch(a){console.error("Error al eliminar medida: ",a)}},m=Object(i["computed"])(()=>e.value.filter(e=>"general"===e.tipo&&!e.proveedorId)),p=a=>e.value.filter(e=>"maquila"===e.tipo&&e.maquilaId===a),v=a=>e.value.filter(e=>e.proveedorId===a);return Object(i["onMounted"])(()=>{o(),l(),d()}),{medidas:e,proveedores:a,maquilas:t,newMedida:r,addMedida:c,deleteMedida:u,medidasGenerales:m,getMedidasMaquila:p,getMedidasProveedor:v}}},c=d,u=(t("c3cc"),t("2877")),m=Object(u["a"])(c,r,o,!1,null,"48626452",null);a["a"]=m.exports},4786:function(e,a,t){"use strict";t("e1ab")},"4a6a":function(e,a,t){},"4c52":function(e,a,t){"use strict";var r=function(){var e=this,a=e._self._c;return a("div",{staticClass:"gestionar-proveedores-container"},[a("div",{staticClass:"back-button-container"},[a("BackButton",{attrs:{to:"/gestionar-productos"}})],1),a("h1",[e._v("GestiÃ³n de Proveedores y Maquilas")]),a("div",{staticClass:"add-proveedor-form"},[a("h2",[e._v("Agregar Proveedor/Maquila")]),a("form",{on:{submit:function(a){return a.preventDefault(),e.addProveedor.apply(null,arguments)}}},[a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"nombre"}},[e._v("Nombre:")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.newProveedor.nombre,expression:"newProveedor.nombre"}],attrs:{id:"nombre",required:"",placeholder:"Nombre del proveedor/maquila"},domProps:{value:e.newProveedor.nombre},on:{input:function(a){a.target.composing||e.$set(e.newProveedor,"nombre",a.target.value)}}})]),a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"tipo"}},[e._v("Tipo:")]),a("select",{directives:[{name:"model",rawName:"v-model",value:e.newProveedor.tipo,expression:"newProveedor.tipo"}],attrs:{id:"tipo",required:""},on:{change:function(a){var t=Array.prototype.filter.call(a.target.options,(function(e){return e.selected})).map((function(e){var a="_value"in e?e._value:e.value;return a}));e.$set(e.newProveedor,"tipo",a.target.multiple?t:t[0])}}},[a("option",{attrs:{value:"proveedor"}},[e._v("Proveedor")]),a("option",{attrs:{value:"maquila"}},[e._v("Maquila")])])]),a("button",{staticClass:"submit-btn",attrs:{type:"submit"}},[e._v("Agregar")])])]),a("div",{staticClass:"proveedores-list"},[a("h2",[e._v("Lista de Proveedores y Maquilas")]),a("ul",e._l(e.sortedProveedores,(function(t){return a("li",{key:t.id},[a("div",{staticClass:"proveedor-info"},[a("strong",[e._v(e._s(t.nombre))]),a("span",[e._v("("+e._s("proveedor"===t.tipo?"Proveedor":"Maquila")+")")])]),a("button",{staticClass:"delete-btn",on:{click:function(a){return e.deleteProveedor(t.id)}}},[e._v("Eliminar")])])})),0)])])},o=[],i=t("2b0e"),s=t("dc59"),n=t("1494"),l=t("74c9"),d={name:"GestionarProveedores",components:{BackButton:l["a"]},setup(){const e=Object(i["ref"])([]),a=Object(i["ref"])({nombre:"",tipo:"proveedor"}),t=async()=>{try{const a=await Object(n["g"])(Object(n["c"])(s["a"],"proveedores"));e.value=a.docs.map(e=>({id:e.id,...e.data()}))}catch(a){console.error("Error al cargar proveedores: ",a)}},r=async()=>{try{await Object(n["b"])(Object(n["c"])(s["a"],"proveedores"),{nombre:a.value.nombre,tipo:a.value.tipo}),a.value={nombre:"",tipo:"proveedor"},t()}catch(e){console.error("Error al aÃ±adir proveedor: ",e)}},o=async e=>{if(confirm("Â¿EstÃ¡s seguro de que quieres eliminar este proveedor/maquila?"))try{await Object(n["d"])(Object(n["e"])(s["a"],"proveedores",e)),t()}catch(a){console.error("Error al eliminar proveedor: ",a)}},l=Object(i["computed"])(()=>[...e.value].sort((e,a)=>e.nombre.localeCompare(a.nombre)));return Object(i["onMounted"])(t),{proveedores:e,newProveedor:a,addProveedor:r,deleteProveedor:o,sortedProveedores:l}}},c=d,u=(t("9226"),t("2877")),m=Object(u["a"])(c,r,o,!1,null,"14c80c33",null);a["a"]=m.exports},"6e02":function(e,a,t){"use strict";var r=function(){var e=this,a=e._self._c;return e.mostrar?a("div",{staticClass:"modal-overlay",on:{click:e.cerrarModal}},[a("div",{staticClass:"modal-content",on:{click:function(e){e.stopPropagation()}}},[a("div",{staticClass:"modal-header"},[a("h3",[e._v("Kilos Refrigerados - "+e._s(e.medida))]),a("button",{staticClass:"btn-cerrar",on:{click:e.cerrarModal}},[e._v("Ã—")])]),a("div",{staticClass:"modal-body"},[e._m(0),a("div",{staticClass:"input-section"},[a("div",{staticClass:"total-info"},[a("div",{staticClass:"total-item"},[a("span",{staticClass:"label"},[e._v("Total Necesario:")]),a("span",{staticClass:"value total-necesario"},[e._v(e._s(e.totalKilos)+" kg")])]),a("div",{staticClass:"total-item"},[a("span",{staticClass:"label"},[e._v("Ya Refrigerados:")]),a("span",{staticClass:"value refrigerados"},[e._v(e._s(e.kilosRefrigerados)+" kg")])]),a("div",{staticClass:"total-item resultado"},[a("span",{staticClass:"label"},[e.kilosFaltantes>0?[e._v("Faltan por Conseguir:")]:e.kilosFaltantes<0?[e._v("Sobra disponible:")]:[e._v("Cantidad exacta:")]],2),a("span",{staticClass:"value faltantes",class:{negativo:e.kilosFaltantes<0,sobra:e.kilosFaltantes<0}},[e.kilosFaltantes>=0?[e._v(" "+e._s(e.kilosFaltantes)+" kg ")]:[e._v(" "+e._s(Math.abs(e.kilosFaltantes))+" kg ")]],2)])]),a("div",{staticClass:"input-group"},[a("label",{attrs:{for:"kilosInput"}},[e._v("Kilos Refrigerados Disponibles:")]),a("div",{staticClass:"input-container"},[a("input",{directives:[{name:"model",rawName:"v-model.number",value:e.kilosRefrigerados,expression:"kilosRefrigerados",modifiers:{number:!0}}],ref:"inputKilos",staticClass:"kilos-input",attrs:{id:"kilosInput",type:"number",step:"0.1",min:"0",max:1.5*e.totalKilos,placeholder:"0.0"},domProps:{value:e.kilosRefrigerados},on:{input:[function(a){a.target.composing||(e.kilosRefrigerados=e._n(a.target.value))},e.validarInput],blur:function(a){return e.$forceUpdate()}}}),a("span",{staticClass:"input-unit"},[e._v("kg")])])]),e.kilosFaltantes<0?a("div",{staticClass:"warning-message"},[a("span",{staticClass:"icon-warning"},[e._v("âš ï¸")]),e._v(" Tienes mÃ¡s kilos refrigerados que los necesarios para este pedido ")]):e._e()])]),a("div",{staticClass:"modal-footer"},[a("button",{staticClass:"btn-limpiar",on:{click:e.limpiarKilos}},[a("span",{staticClass:"icon"},[e._v("ðŸ—‘ï¸")]),e._v(" Limpiar ")]),a("button",{staticClass:"btn-cancelar",on:{click:e.cerrarModal}},[e._v(" Cancelar ")]),a("button",{staticClass:"btn-guardar",on:{click:e.guardarKilos}},[a("span",{staticClass:"icon"},[e._v("ðŸ’¾")]),e._v(" Guardar ")])])])]):e._e()},o=[function(){var e=this,a=e._self._c;return a("div",{staticClass:"info-section"},[a("p",{staticClass:"info-text"},[a("span",{staticClass:"icon-info"},[e._v("â„¹ï¸")]),e._v(" Los kilos refrigerados son los que ya tienes disponibles en inventario. Se restarÃ¡n del total necesario para este pedido. ")])])}],i={name:"KilosRefrigeradosModal",props:{mostrar:{type:Boolean,default:!1},medida:{type:String,required:!0},totalKilos:{type:Number,required:!0},kilosRefrigeradosIniciales:{type:Number,default:0}},data(){return{kilosRefrigerados:this.kilosRefrigeradosIniciales||0}},computed:{kilosFaltantes(){return this.totalKilos-this.kilosRefrigerados}},watch:{mostrar(e){e&&(this.kilosRefrigerados=this.kilosRefrigeradosIniciales||0,this.$nextTick(()=>{this.$refs.inputKilos&&(this.$refs.inputKilos.focus(),this.$refs.inputKilos.select())}))},kilosRefrigeradosIniciales(e){this.kilosRefrigerados=e||0}},methods:{cerrarModal(){this.$emit("cerrar")},guardarKilos(){const e=Math.max(0,this.kilosRefrigerados||0);this.$emit("guardar",{medida:this.medida,kilosRefrigerados:e,kilosFaltantes:this.totalKilos-e}),this.cerrarModal()},limpiarKilos(){this.kilosRefrigerados=0},validarInput(){this.kilosRefrigerados<0&&(this.kilosRefrigerados=0),this.kilosRefrigerados&&(this.kilosRefrigerados=Math.round(10*this.kilosRefrigerados)/10)}}},s=i,n=(t("c210"),t("2877")),l=Object(n["a"])(s,r,o,!1,null,"ab5d4c82",null);a["a"]=l.exports},"6f61":function(e,a,t){"use strict";var r=function(){var e,a=this,t=a._self._c;return a.mostrar?t("div",{staticClass:"modal-overlay",on:{click:a.cerrarModal}},[t("div",{staticClass:"modal-content",on:{click:function(e){e.stopPropagation()}}},[t("div",{staticClass:"modal-header"},[t("div",{staticClass:"modal-title-info"},[t("h2",[a._v(a._s((null===(e=a.medida)||void 0===e?void 0:e.nombre)||"Producto"))]),t("span",{staticClass:"proveedor-badge"},[a._v(a._s(a.proveedorNombre))])]),t("button",{staticClass:"close-button",on:{click:function(e){return a.$emit("cerrar")}}},[a._v("Ã—")])]),t("div",{staticClass:"modal-body"},[t("div",{staticClass:"producto-resumen"},[t("div",{staticClass:"precio-actual-section"},[t("div",{staticClass:"precio-principal"},[t("span",{staticClass:"label"},[a._v("Precio Actual")]),t("span",{staticClass:"precio-valor"},[a._v("$"+a._s(a.formatearPrecio(a.precioActual)))]),t("span",{staticClass:"fecha-actual"},[a._v(a._s(a.formatearFecha(a.fechaUltimoPrecio)))])]),t("div",{staticClass:"precio-estadisticas"},[t("div",{staticClass:"stat-item"},[t("span",{staticClass:"stat-numero"},[a._v(a._s(a.totalRegistros))]),t("span",{staticClass:"stat-label"},[a._v("Registros")])]),t("div",{staticClass:"stat-item"},[t("span",{staticClass:"stat-numero"},[a._v("$"+a._s(a.formatearPrecio(a.precioPromedio)))]),t("span",{staticClass:"stat-label"},[a._v("Promedio")])])])])]),t("div",{staticClass:"agregar-precio-section"},[t("div",{staticClass:"section-header"},[t("h3",[a._v("Actualizar Precio")]),t("button",{staticClass:"btn-toggle-form",class:{active:a.mostrarFormulario},on:{click:function(e){a.mostrarFormulario=!a.mostrarFormulario}}},[a._v(" "+a._s(a.mostrarFormulario?"Ã—":"+")+" ")])]),a.mostrarFormulario?t("div",{staticClass:"precio-form"},[t("div",{staticClass:"form-grid"},[t("div",{staticClass:"form-group"},[t("label",[a._v("Nuevo Precio:")]),t("input",{directives:[{name:"model",rawName:"v-model.number",value:a.nuevoPrecio.precio,expression:"nuevoPrecio.precio",modifiers:{number:!0}}],ref:"precioInput",staticClass:"form-control precio-input",attrs:{type:"number",step:"0.01",placeholder:"0.00"},domProps:{value:a.nuevoPrecio.precio},on:{keyup:function(e){return!e.type.indexOf("key")&&a._k(e.keyCode,"enter",13,e.key,"Enter")?null:a.agregarPrecio.apply(null,arguments)},input:function(e){e.target.composing||a.$set(a.nuevoPrecio,"precio",a._n(e.target.value))},blur:function(e){return a.$forceUpdate()}}})]),t("div",{staticClass:"form-group"},[t("label",[a._v("Fecha:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.nuevoPrecio.fecha,expression:"nuevoPrecio.fecha"}],staticClass:"form-control",attrs:{type:"date"},domProps:{value:a.nuevoPrecio.fecha},on:{input:function(e){e.target.composing||a.$set(a.nuevoPrecio,"fecha",e.target.value)}}})])]),t("div",{staticClass:"form-group"},[t("label",[a._v("Notas (opcional):")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.nuevoPrecio.notas,expression:"nuevoPrecio.notas"}],staticClass:"form-control",attrs:{type:"text",placeholder:"Ej: Precio especial, cambio de temporada, etc."},domProps:{value:a.nuevoPrecio.notas},on:{input:function(e){e.target.composing||a.$set(a.nuevoPrecio,"notas",e.target.value)}}})]),t("div",{staticClass:"form-actions"},[t("button",{staticClass:"btn-cancelar",on:{click:a.limpiarFormulario}},[a._v(" Cancelar ")]),t("button",{staticClass:"btn-guardar",attrs:{disabled:a.guardando||!a.esFormularioValido},on:{click:a.agregarPrecio}},[a._v(" "+a._s(a.guardando?"Guardando...":"Guardar Precio")+" ")])])]):a._e()]),t("div",{staticClass:"historial-section"},[t("h3",[a._v("Historial de Precios")]),a.historialPrecios.length>0?t("div",{staticClass:"precios-timeline"},a._l(a.preciosOrdenados,(function(e,r){return t("div",{key:e.id||r,staticClass:"precio-item",class:{"precio-actual":0===r}},[t("div",{staticClass:"precio-fecha-badge"},[a._v(" "+a._s(a.formatearFecha(e.fecha))+" ")]),t("div",{staticClass:"precio-info"},[t("div",{staticClass:"precio-monto"},[t("span",{staticClass:"precio-valor"},[a._v("$"+a._s(a.formatearPrecio(e.precio)))]),0===r?t("span",{staticClass:"actual-badge"},[a._v("Actual")]):a._e()]),e.notas?t("div",{staticClass:"precio-notas"},[a._v(" ðŸ“ "+a._s(e.notas)+" ")]):a._e()]),t("div",{staticClass:"precio-actions"},[t("button",{staticClass:"btn-editar",attrs:{title:"Editar precio"},on:{click:function(t){return a.editarPrecio(e)}}},[a._v(" âœï¸ ")]),a.historialPrecios.length>1?t("button",{staticClass:"btn-eliminar",attrs:{title:"Eliminar precio"},on:{click:function(t){return a.eliminarPrecio(e)}}},[a._v(" ðŸ—‘ï¸ ")]):a._e()])])})),0):t("div",{staticClass:"no-historial"},[t("div",{staticClass:"no-historial-icon"},[a._v("ðŸ“Š")]),t("p",[a._v("No hay historial de precios disponible")])])])])])]):a._e()},o=[],i=(t("14d9"),t("13d5"),t("dc59")),s=t("1494"),n={name:"HistorialPreciosCrudos",props:{mostrar:{type:Boolean,required:!0},medida:{type:Object,default:null},proveedorId:{type:String,required:!0},proveedorNombre:{type:String,required:!0}},emits:["cerrar","actualizado"],data(){return{mostrarFormulario:!1,guardando:!1,nuevoPrecio:{precio:null,fecha:this.obtenerFechaActual(),notas:""},historialPrecios:[]}},computed:{esFormularioValido(){return this.nuevoPrecio.precio&&this.nuevoPrecio.precio>0&&this.nuevoPrecio.fecha},preciosOrdenados(){return this.historialPrecios.length?[...this.historialPrecios].sort((e,a)=>new Date(a.fecha)-new Date(e.fecha)):[]},precioActual(){return this.historialPrecios.length?this.preciosOrdenados[0].precio:0},fechaUltimoPrecio(){var e;return this.historialPrecios.length?this.preciosOrdenados[0].fecha:null===(e=this.medida)||void 0===e?void 0:e.fechaCreacion},totalRegistros(){return this.historialPrecios.length},precioPromedio(){if(!this.historialPrecios.length)return 0;const e=this.historialPrecios.reduce((e,a)=>e+a.precio,0);return e/this.historialPrecios.length}},methods:{cerrarModal(e){e.target===e.currentTarget&&this.$emit("cerrar")},obtenerFechaActual(){const e=new Date;return e.toISOString().split("T")[0]},async cargarHistorialPrecios(){var e;if(null!==(e=this.medida)&&void 0!==e&&e.id)try{const e=Object(s["o"])(Object(s["c"])(i["a"],"historialPreciosCrudos"),Object(s["t"])("medidaId","==",this.medida.id),Object(s["t"])("proveedorId","==",this.proveedorId)),a=await Object(s["g"])(e);this.historialPrecios=a.docs.map(e=>({id:e.id,...e.data()}))}catch(a){console.error("Error al cargar historial de precios:",a),this.historialPrecios=[]}},async agregarPrecio(){if(this.esFormularioValido)try{this.guardando=!0;const e={proveedorId:this.proveedorId,proveedorNombre:this.proveedorNombre,medidaId:this.medida.id,medidaNombre:this.medida.nombre,precio:this.nuevoPrecio.precio,fecha:this.nuevoPrecio.fecha,notas:this.nuevoPrecio.notas||"",fechaCreacion:(new Date).toISOString().split("T")[0]},a=await Object(s["b"])(Object(s["c"])(i["a"],"historialPreciosCrudos"),e);this.historialPrecios.push({id:a.id,...e}),this.limpiarFormulario(),this.$emit("actualizado")}catch(e){console.error("Error al agregar precio: ",e),alert("Error al agregar precio: "+e.message)}finally{this.guardando=!1}else alert("Por favor complete el precio y la fecha")},limpiarFormulario(){this.nuevoPrecio={precio:null,fecha:this.obtenerFechaActual(),notas:""},this.mostrarFormulario=!1},editarPrecio(e){const a=prompt("Nuevo precio:",e.precio);a&&!isNaN(parseFloat(a))&&this.actualizarPrecio(e.id,parseFloat(a))},async actualizarPrecio(e,a){try{await Object(s["s"])(Object(s["e"])(i["a"],"historialPreciosCrudos",e),{precio:a});const t=this.historialPrecios.findIndex(a=>a.id===e);-1!==t&&(this.historialPrecios[t].precio=a),this.$emit("actualizado")}catch(t){console.error("Error al actualizar precio:",t),alert("Error al actualizar precio")}},async eliminarPrecio(e){if(confirm(`Â¿EstÃ¡ seguro de eliminar el precio del ${this.formatearFecha(e.fecha)}?`))try{await Object(s["d"])(Object(s["e"])(i["a"],"historialPreciosCrudos",e.id)),this.historialPrecios=this.historialPrecios.filter(a=>a.id!==e.id),this.$emit("actualizado")}catch(a){console.error("Error al eliminar precio:",a),alert("Error al eliminar precio")}},formatearFecha(e){if(!e)return"";const a=new Date(e+"T00:00:00"),t={day:"numeric",month:"short",year:"numeric"};return a.toLocaleDateString("es-ES",t)},formatearPrecio(e){return e?e.toLocaleString("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00"}},watch:{mostrar(e){e&&(this.cargarHistorialPrecios(),this.limpiarFormulario())},mostrarFormulario(e){e&&this.$nextTick(()=>{this.$refs.precioInput&&this.$refs.precioInput.focus()})}}},l=n,d=(t("ab3e"),t("2877")),c=Object(d["a"])(l,r,o,!1,null,"3cdcea5e",null);a["a"]=c.exports},"73bd":function(e,a,t){"use strict";var r=function(){var e=this,a=e._self._c;return a("div",[a("button",{staticClass:"medidas-btn",on:{click:function(a){e.showModal=!0}}},[a("i",{staticClass:"fas fa-ruler"}),e._v(" Medidas ")]),e.showModal?a("div",{staticClass:"modal-overlay"},[a("div",{staticClass:"modal-content"},[a("div",{staticClass:"modal-header"},[a("h2",[e._v("GestiÃ³n de Medidas")]),a("button",{staticClass:"close-btn",on:{click:e.cerrarModal}},[e._v("Ã—")])]),a("div",{staticClass:"add-medida-form"},[a("h3",[e._v("Agregar Nueva Medida")]),a("div",{staticClass:"form-group"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.newMedida.nombre,expression:"newMedida.nombre"}],staticClass:"medida-input",attrs:{type:"text",placeholder:"Nombre de la medida"},domProps:{value:e.newMedida.nombre},on:{input:function(a){a.target.composing||e.$set(e.newMedida,"nombre",a.target.value)}}}),a("button",{staticClass:"add-btn",on:{click:e.agregarMedida}},[e._v("Agregar")])])]),a("div",{staticClass:"medidas-list"},[a("div",{staticClass:"medidas-grid"},e._l(e.medidasOrdenadas,(function(t){return a("div",{key:t.id,staticClass:"medida-card"},[a("span",{staticClass:"medida-nombre"},[e._v(e._s(t.nombre))]),a("button",{staticClass:"delete-btn",attrs:{title:"Eliminar medida"},on:{click:function(a){return e.eliminarMedida(t.id)}}},[e._v(" Ã— ")])])})),0)]),a("div",{staticClass:"modal-footer"},[a("button",{staticClass:"cancel-btn",on:{click:e.cerrarModal}},[e._v("Cerrar")])])])]):e._e()])},o=[],i=(t("14d9"),t("dc59")),s=t("1494"),n={name:"MedidasModal",data(){return{showModal:!1,medidas:[],newMedida:{tipo:"granja",nombre:""}}},computed:{medidasOrdenadas(){const e=this.medidas.filter(e=>"especial"===e.tipo),a=this.medidas.filter(e=>"granja"===e.tipo);return e.sort((e,a)=>e.nombre.localeCompare(a.nombre)),a.sort((e,a)=>{const t=parseInt(e.nombre.split("/")[0]),r=parseInt(a.nombre.split("/")[0]);return t-r}),[...e,...a]}},methods:{async cargarMedidas(){try{const e=Object(s["c"])(i["a"],"medidas"),a=Object(s["o"])(e,Object(s["l"])("nombre")),t=await Object(s["g"])(a);this.medidas=t.docs.map(e=>({id:e.id,...e.data()}))}catch(e){console.error("Error al cargar medidas:",e),alert("Error al cargar las medidas")}},async agregarMedida(){if(this.newMedida.nombre)try{const e=await Object(s["b"])(Object(s["c"])(i["a"],"medidas"),{tipo:this.newMedida.tipo,nombre:this.newMedida.nombre});this.medidas.push({id:e.id,tipo:this.newMedida.tipo,nombre:this.newMedida.nombre}),this.newMedida.nombre=""}catch(e){console.error("Error al agregar medida:",e),alert("Error al guardar la medida")}else alert("Por favor ingrese el nombre de la medida")},async eliminarMedida(e){if(confirm("Â¿EstÃ¡s seguro de que deseas eliminar esta medida?"))try{await Object(s["d"])(Object(s["e"])(i["a"],"medidas",e)),this.medidas=this.medidas.filter(a=>a.id!==e)}catch(a){console.error("Error al eliminar medida:",a),alert("Error al eliminar la medida")}},cerrarModal(){this.showModal=!1,this.$emit("medidas-actualizadas",this.medidas)}},mounted(){this.cargarMedidas()}},l=n,d=(t("4786"),t("2877")),c=Object(d["a"])(l,r,o,!1,null,"60908f5b",null);a["a"]=c.exports},8841:function(e,a,t){"use strict";t("c582")},9226:function(e,a,t){"use strict";t("928d")},"928d":function(e,a,t){},9362:function(e,a,t){},"9d22":function(e,a,t){},"9df4":function(e,a,t){"use strict";var r=function(){var e=this,a=e._self._c;return e.isOpen?a("div",{staticClass:"modal-overlay",on:{click:e.closeModal}},[a("div",{staticClass:"modal-content",on:{click:function(e){e.stopPropagation()}}},[a("h2",[e._v("Historial de Producto")]),a("div",{staticClass:"form-group"},[a("select",{directives:[{name:"model",rawName:"v-model",value:e.filtros.tipo,expression:"filtros.tipo"}],on:{change:[function(a){var t=Array.prototype.filter.call(a.target.options,(function(e){return e.selected})).map((function(e){var a="_value"in e?e._value:e.value;return a}));e.$set(e.filtros,"tipo",a.target.multiple?t:t[0])},e.resetSelections]}},[a("option",{attrs:{value:""}},[e._v("Seleccionar Tipo")]),a("option",{attrs:{value:"proveedor"}},[e._v("Proveedor")]),a("option",{attrs:{value:"maquila"}},[e._v("Maquila")])]),a("select",{directives:[{name:"model",rawName:"v-model",value:e.filtros.proveedor,expression:"filtros.proveedor"}],on:{change:[function(a){var t=Array.prototype.filter.call(a.target.options,(function(e){return e.selected})).map((function(e){var a="_value"in e?e._value:e.value;return a}));e.$set(e.filtros,"proveedor",a.target.multiple?t:t[0])},e.onProveedorChange]}},[a("option",{attrs:{value:""}},[e._v("Seleccionar "+e._s("maquila"===e.filtros.tipo?"Maquila":"Proveedor"))]),e._l(e.proveedoresFiltrados,(function(t){return a("option",{key:t.id,domProps:{value:t.nombre}},[e._v(" "+e._s(t.nombre)+" ")])}))],2),a("select",{directives:[{name:"model",rawName:"v-model",value:e.filtros.medida,expression:"filtros.medida"}],on:{change:function(a){var t=Array.prototype.filter.call(a.target.options,(function(e){return e.selected})).map((function(e){var a="_value"in e?e._value:e.value;return a}));e.$set(e.filtros,"medida",a.target.multiple?t:t[0])}}},[a("option",{attrs:{value:""}},[e._v("Seleccionar Medida")]),e._l(e.medidasFiltradas,(function(t){return a("option",{key:t.id,domProps:{value:t.nombre}},[e._v(" "+e._s(t.nombre)+" ")])}))],2),a("select",{directives:[{name:"model",rawName:"v-model",value:e.filtros.movimiento,expression:"filtros.movimiento"}],on:{change:function(a){var t=Array.prototype.filter.call(a.target.options,(function(e){return e.selected})).map((function(e){var a="_value"in e?e._value:e.value;return a}));e.$set(e.filtros,"movimiento",a.target.multiple?t:t[0])}}},[a("option",{attrs:{value:""}},[e._v("Tipo de Movimiento")]),a("option",{attrs:{value:"entradas"}},[e._v("Entradas")]),a("option",{attrs:{value:"salidas"}},[e._v("Salidas")]),a("option",{attrs:{value:"ambos"}},[e._v("Ambos")])]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.filtros.fechaDesde,expression:"filtros.fechaDesde"}],attrs:{type:"date",placeholder:"Fecha desde (opcional)",title:"Fecha desde (opcional)"},domProps:{value:e.filtros.fechaDesde},on:{input:function(a){a.target.composing||e.$set(e.filtros,"fechaDesde",a.target.value)}}}),a("input",{directives:[{name:"model",rawName:"v-model",value:e.filtros.fechaHasta,expression:"filtros.fechaHasta"}],attrs:{type:"date",placeholder:"Fecha hasta (opcional)",title:"Fecha hasta (opcional)"},domProps:{value:e.filtros.fechaHasta},on:{input:function(a){a.target.composing||e.$set(e.filtros,"fechaHasta",a.target.value)}}}),a("button",{attrs:{disabled:!e.isFormValid},on:{click:e.buscarHistorial}},[e._v("Buscar")])]),e.historial.length>0?a("div",{staticClass:"results-container"},[a("table",[a("thead",[a("tr",[a("th",[e._v("Fecha")]),a("th",[e._v("Kilos")]),a("th",[e._v("Precio")]),"ambos"===e.filtros.movimiento?a("th",[e._v("Tipo")]):e._e(),a("th",[e._v("Embarcado")])])]),a("tbody",e._l(e.historial,(function(t,r){return a("tr",{key:r},[a("td",[e._v(e._s(e.formatDate(t.fecha)))]),a("td",[e._v(e._s(e.formatNumber(t.kilos))+" kg")]),a("td",[e._v(e._s(t.precio?"$"+t.precio:"-"))]),"ambos"===e.filtros.movimiento?a("td",[a("span",{class:"entradas"===t.tipoMovimiento?"tipo-entrada":"tipo-salida"},[e._v(" "+e._s("entradas"===t.tipoMovimiento?"Entrada":"Salida")+" ")])]):e._e(),a("td",[t.embarqueInfo?a("span",{class:e.getEmbarqueStatusClass(t.embarqueInfo)},[e._v(" "+e._s(e.getEmbarqueStatusText(t.embarqueInfo))+" ")]):a("span",{staticClass:"sin-embarque"},[e._v("-")])])])})),0),a("tfoot",[a("tr",{staticClass:"total-row"},[a("td",[a("strong",[e._v("Total Registros: "+e._s(e.historial.length))])]),a("td",[a("strong",[e._v(e._s(e.formatNumber(e.totalKilos))+" kg")])]),a("td",[a("strong",[e._v(e._s(e.totalConPrecio>0?"$"+e.formatNumber(e.promedioPrecios):"-"))])]),"ambos"===e.filtros.movimiento?a("td"):e._e(),a("td",[a("strong",[e._v(e._s(e.totalEmbarcados)+"/"+e._s(e.historial.length))])])])])])]):e.busquedaRealizada?a("div",{staticClass:"no-results"},[e._v(" No se encontraron registros para los criterios seleccionados. ")]):e._e(),a("button",{staticClass:"close-button",on:{click:e.closeModal}},[e._v("Ã—")])])]):e._e()},o=[],i=(t("14d9"),t("13d5"),t("dc59")),s=t("1494"),n=t("c1df"),l=t.n(n),d={name:"HistorialProductoModal",props:{isOpen:{type:Boolean,required:!0},proveedores:{type:Array,required:!0},medidas:{type:Array,required:!0}},data(){return{filtros:{tipo:"",proveedor:"",medida:"",movimiento:"",fechaDesde:"",fechaHasta:""},historial:[],busquedaRealizada:!1}},computed:{proveedoresFiltrados(){return this.proveedores.filter(e=>e.tipo===this.filtros.tipo)},medidasFiltradas(){if("maquila"===this.filtros.tipo){const e=this.proveedores.find(e=>e.nombre===this.filtros.proveedor);return e?this.medidas.filter(a=>"maquila"===a.tipo&&a.maquilaId===e.id):[]}{const e=this.proveedores.find(e=>e.nombre===this.filtros.proveedor);return e?this.medidas.filter(a=>a.proveedorId===e.id||!a.proveedorId&&"general"===a.tipo):this.medidas.filter(e=>"general"===e.tipo)}},isFormValid(){return this.filtros.tipo&&this.filtros.proveedor&&this.filtros.medida&&this.filtros.movimiento},totalKilos(){return this.historial.reduce((e,a)=>e+a.kilos,0)},totalEmbarcados(){return this.historial.filter(e=>e.embarqueInfo&&e.embarqueInfo.embarcado).length},totalConPrecio(){return this.historial.filter(e=>e.precio&&e.precio>0).length},promedioPrecios(){const e=this.historial.filter(e=>e.precio&&e.precio>0);if(0===e.length)return 0;const a=e.reduce((e,a)=>e+a.precio,0);return a/e.length}},methods:{resetSelections(){this.filtros.proveedor="",this.filtros.medida="",this.historial=[],this.busquedaRealizada=!1},onProveedorChange(){this.filtros.medida="",this.historial=[],this.busquedaRealizada=!1},async buscarHistorial(){try{const e=Object(s["c"])(i["a"],"sacadas"),a=Object(s["o"])(e,Object(s["l"])("fecha","desc")),t=await Object(s["g"])(a);this.historial=[];const r=[];t.docs.forEach(e=>{const a=e.data(),t="ambos"===this.filtros.movimiento?["entradas","salidas"]:[this.filtros.movimiento];t.forEach(e=>{const t=a[e]||[];t.forEach(t=>{if(t.tipo===this.filtros.tipo&&t.proveedor===this.filtros.proveedor&&t.medida===this.filtros.medida){const o=a.fecha.toDate();if(this.filtros.fechaDesde){const e=new Date(this.filtros.fechaDesde);if(o<e)return}if(this.filtros.fechaHasta){const e=new Date(this.filtros.fechaHasta);if(e.setHours(23,59,59,999),o>e)return}r.push({fecha:o,kilos:t.kilos,precio:t.precio,tipoMovimiento:e})}})})}),await this.verificarEmbarques(r),console.log(`[HISTORIAL] BÃºsqueda completada para ${this.filtros.medida}:`),console.log("[HISTORIAL] - Registros encontrados: "+this.historial.length),console.log("[HISTORIAL] - Registros embarcados: "+this.totalEmbarcados),(this.filtros.fechaDesde||this.filtros.fechaHasta)&&console.log(`[HISTORIAL] - Rango de fechas: ${this.filtros.fechaDesde||"Sin lÃ­mite"} a ${this.filtros.fechaHasta||"Sin lÃ­mite"}`),this.busquedaRealizada=!0}catch(e){console.error("Error al buscar historial:",e),alert("Error al buscar el historial")}},formatDate(e){return l()(e).format("DD/MM/YYYY")},formatNumber(e){return e.toLocaleString("es-ES",{minimumFractionDigits:1,maximumFractionDigits:1})},async verificarEmbarques(e){try{const a=Object(s["c"])(i["a"],"embarques"),t=await Object(s["g"])(a),r=new Map;t.docs.forEach(e=>{const a=e.data();let t;if(a.fecha&&"function"===typeof a.fecha.toDate?t=a.fecha.toDate():a.fecha instanceof Date?t=a.fecha:"string"===typeof a.fecha&&(t=new Date(a.fecha)),t){const o=t.toISOString().split("T")[0];r.has(o)||r.set(o,[]),r.get(o).push({id:e.id,data:a})}}),this.historial=e.map(e=>{const a=e.fecha.toISOString().split("T")[0],t=r.get(a)||[];let o=null;for(const r of t)try{const e=this.buscarProductoEnEmbarque(r.data,this.filtros.proveedor,this.filtros.medida);if(e.encontrado){o={embarcado:!0,embarqueId:r.id,kilosEmbarcados:e.kilosEmbarcados,rendimiento:e.rendimiento,medidaEncontrada:e.medidaEncontrada};break}}catch(i){console.error(`[HISTORIAL] Error al procesar embarque ${r.id}:`,i);continue}return!o&&t.length>0&&(o={embarcado:!1,embarqueId:t[0].id,razon:"No encontrado en embarque"}),{...e,embarqueInfo:o}})}catch(a){console.error("Error al verificar embarques:",a),this.historial=e}},buscarProductoEnEmbarque(e,a,t){let r=!1,o=0,i=null,s="";const n=this.normalizarMedida(t);if(e.clientes)for(const d of e.clientes)if(d.productos)for(const e of d.productos){const a=e.medida||"",t=this.normalizarMedida(a);if(this.compararMedidas(n,t)&&(r=!0,s=a,e.kilos&&Array.isArray(e.kilos)&&(o+=e.kilos.reduce((e,a)=>e+(parseFloat(a)||0),0)),e.restarTaras&&e.taras&&Array.isArray(e.taras)))try{const t=e.taras.reduce((e,t,r)=>{if("string"===typeof t&&t.includes("-")){const a=t.split("-"),r=parseInt(a[0])||0;return e+r}return"number"===typeof t?e+t:"string"!==typeof t||isNaN(t)?(console.warn(`[HISTORIAL] Tara invÃ¡lida en Ã­ndice ${r}:`,{tipo:typeof t,valor:t,medida:a}),e):e+(parseInt(t)||0)},0);o-=3*t}catch(l){console.error(`[HISTORIAL] Error procesando taras para medida ${a}:`,{error:l,taras:e.taras})}}if(r&&e.kilosCrudos){let a=null;if(e.kilosCrudos[t])a=e.kilosCrudos[t];else if(e.kilosCrudos[s])a=e.kilosCrudos[s];else for(const[t,r]of Object.entries(e.kilosCrudos))if(this.compararMedidas(n,this.normalizarMedida(t))){a=r;break}if(a){let e=0;e="object"===typeof a&&void 0!==a.medida1?(parseFloat(a.medida1)||0)+(parseFloat(a.medida2)||0):parseFloat(a)||0,e>0&&o>0&&(i=e/o)}}return{encontrado:r,kilosEmbarcados:o,rendimiento:i,medidaEncontrada:s}},normalizarMedida(e){return e?e.toLowerCase().replace(/\s+/g,"").replace(/selecta/g,"sel").replace(/especial/g,"esp").replace(/premium/g,"prem").trim():""},compararMedidas(e,a){if(!e||!a)return!1;if(e===a)return!0;const t=e.match(/\d+/g)||[],r=a.match(/\d+/g)||[];if(t.length===r.length&&t.length>0){const o=t.every((e,a)=>e===r[a]);if(o){const t=this.extraerVariaciones(e),r=this.extraerVariaciones(a);(t.includes("sel")||t.includes("selecta"))&&(r.includes("sel")||r.includes("selecta"));return!0}}return!1},extraerVariaciones(e){const a=[],t=e.toLowerCase();return(t.includes("sel")||t.includes("selecta"))&&a.push("sel","selecta"),(t.includes("esp")||t.includes("especial"))&&a.push("esp","especial"),(t.includes("prem")||t.includes("premium"))&&a.push("prem","premium"),a},getEmbarqueStatusClass(e){return e?e.embarcado?"embarcado-si":"embarcado-no":"sin-embarque"},getEmbarqueStatusText(e){if(!e)return"-";if(e.embarcado){let a="âœ“ SÃ­";return e.kilosEmbarcados&&(a+=` (${this.formatNumber(e.kilosEmbarcados)} kg)`),e.rendimiento&&(a+=" - R: "+e.rendimiento.toFixed(2)),e.medidaEncontrada&&e.medidaEncontrada.toLowerCase()!==this.filtros.medida.toLowerCase()&&(a+=` [${e.medidaEncontrada}]`),a}return"âœ— No"},closeModal(){this.$emit("close"),this.resetSelections()}}},c=d,u=(t("8841"),t("2877")),m=Object(u["a"])(c,r,o,!1,null,"0cae7766",null);a["a"]=m.exports},ab3e:function(e,a,t){"use strict";t("9d22")},c210:function(e,a,t){"use strict";t("c2f9")},c2f9:function(e,a,t){},c3cc:function(e,a,t){"use strict";t("4a6a")},c582:function(e,a,t){},d66c:function(e,a,t){"use strict";t("9362")},e1ab:function(e,a,t){},e6b2:function(e,a,t){"use strict";t("1b56")}}]);