(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["app.c714bc7b"],{"2fe3":function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));a("14d9"),a("13d5"),a("2c66"),a("249d"),a("40e9"),a("907a"),a("986a"),a("1d02"),a("3c5d"),a("6ce5"),a("2834"),a("4ea1");var o=a("e499"),n=a.n(o),r=a("4ebb"),i=a.n(r);try{i.a?n.a.vfs=i.a:"object"===typeof r&&(n.a.vfs=r)}catch(j){console.warn("Error al inicializar pdfMake local:",j)}async function s(e,t,a,o={}){try{if(!e||!e.productos||!Array.isArray(e.productos))return void console.warn("El embarque no contiene datos de productos válidos",{embarque:e});Array.isArray(t)||(console.warn("Lista de clientes no válida, usando array vacío"),t=[]);const r=await E("https://res.cloudinary.com/hwkcovsmr/image/upload/v1620946647/samples/REY_PEZ_LOGO_nsotww.png"),i=[{columns:[{image:r,width:100,alignment:"left",margin:[0,0,0,10]},{text:"Nota de Venta",style:"notaVentaHeader",alignment:"center",margin:[0,20,0,0]},{stack:[{text:"Fecha: "+new Date(e.fecha).toLocaleString("es-MX",{timeZone:"UTC",year:"numeric",month:"2-digit",day:"2-digit"}),alignment:"right",margin:[0,20,0,0]},{text:"Carga con: "+(e.cargaCon||"No especificado"),alignment:"right",margin:[0,5,0,0]}]}]},{text:"\n"},...l(e,t,a,o),...d({...e,kilosCrudos:e.kilosCrudos||{}},t)],s=[{columns:[{image:r,width:100,alignment:"left",margin:[0,0,0,10]},{text:"Nota de Embarque",style:"notaVentaHeader",alignment:"center",margin:[0,20,0,0]},{stack:[{text:"Fecha: "+new Date(e.fecha).toLocaleString("es-MX",{timeZone:"UTC",year:"numeric",month:"2-digit",day:"2-digit"}),alignment:"right",margin:[0,20,0,0]},{text:"Carga con: "+(e.cargaCon||"No especificado"),alignment:"right",margin:[0,5,0,0]}]}]},{text:"\n"},...T(e,t,a,o),...d({...e,kilosCrudos:e.kilosCrudos||{}},t)],u={content:[...i,{text:"",pageBreak:"before"},...s],styles:{notaVentaHeader:{color:"#3760b0",fontSize:30,bold:!0,italics:!0},header:{fontSize:30,bold:!0,color:"#2980b9",margin:[0,0,0,10]},subheader:{fontSize:25,bold:!0,margin:[0,10,0,5]},tableHeader:{bold:!0,fontSize:23,color:"black",fillColor:"#ecf0f1"},clienteJoselito:{color:"#FFFFFF",background:"#0000FF",padding:[2,2,2,2]},clienteCatarro:{color:"#FFFFFF",background:"#FF0000",padding:[2,2,2,2]},clienteOtilio:{color:"#000000",background:"#FFD700",padding:[2,2,2,2]},clienteOzuna:{color:"#FFFFFF",background:"#008000",padding:[2,2,2,2]},clienteElizabeth:{color:"#FFFFFF",background:"#9b59b6",padding:[2,2,2,2]},clienteOtro:{color:"#000000",background:"#808080",padding:[2,2,2,2]},medidaHeader:{fontSize:24,bold:!0,color:"#2c3e50",margin:[0,10,0,5]},precio:{color:"#FFFFFF",background:"#FF0000",padding:[2,2,2,2]},totalPrecio:{color:"#FFFFFF",background:"#9b59b6",padding:[2,2,2,2],bold:!0,fontSize:21},granTotal:{color:"#FFFFFF",background:"#8e44ad",padding:[4,4,4,4],bold:!0,fontSize:24},tipoConAgua:{color:"#2980b9",bold:!0},nota:{fontSize:18,color:"#666666",italics:!0}},defaultStyle:{fontSize:20},footer:function(e,t){return{columns:[{text:" 2025 Rey Pez - Tampico, Tamps.",alignment:"center",margin:[0,10,0,0]}],margin:[40,0,40,0],fontSize:20,color:"#3760b0"}}};n.a.createPdf(u).getBuffer(t=>{new Uint8Array(t);const a=t.toString().match(/\/Page\W/g).length,o=c(e);console.log(`Total de productos: ${o}, Páginas generadas: ${a}`);let r="ninguno";if(o>=8&&o<12?r="moderado":(o>=12||a>2)&&(r="agresivo"),"ninguno"!==r){const e={...u,defaultStyle:{...u.defaultStyle,fontSize:"moderado"===r?16:14},styles:{...u.styles,notaVentaHeader:{...u.styles.notaVentaHeader,fontSize:"moderado"===r?24:20},header:{...u.styles.header,fontSize:"moderado"===r?24:20},subheader:{...u.styles.subheader,fontSize:"moderado"===r?20:17},tableHeader:{...u.styles.tableHeader,fontSize:"moderado"===r?18:15},medidaHeader:{...u.styles.medidaHeader,fontSize:"moderado"===r?20:16},nota:{...u.styles.nota,fontSize:"moderado"===r?15:12},totalPrecio:{...u.styles.totalPrecio,fontSize:"moderado"===r?18:15},granTotal:{...u.styles.granTotal,fontSize:"moderado"===r?20:17}},footer:function(e,t){return{columns:[{text:" 2025 Rey Pez - Tampico, Tamps.",alignment:"center",margin:[0,10,0,0]}],margin:[40,0,40,0],fontSize:"moderado"===r?16:14,color:"#3760b0"}}};n.a.createPdf(e).download("nota-venta.pdf"),console.log("PDF generado con nivel de reducción: "+r)}else n.a.createPdf(u).download("nota-venta.pdf"),console.log("PDF generado sin reducción de escala")})}catch(j){console.error("Error al generar el PDF:",j)}}function c(e){let t=0;return e.productos&&Array.isArray(e.productos)&&(t+=e.productos.filter(e=>{const t=(e.kilos||[]).reduce((e,t)=>e+(Number(t)||0),0);return t>0}).length),e.clienteCrudos&&Object.values(e.clienteCrudos).forEach(e=>{Array.isArray(e)&&e.forEach(e=>{e&&Array.isArray(e.items)&&(t+=e.items.filter(e=>e&&(e.taras||e.sobrante)).length)})}),t}function l(e,t,a,o={}){const n=[];let r=0,i=0;if(!e||!e.productos||!Array.isArray(e.productos))return console.warn("Datos de embarque inválidos o productos no encontrados"),[{text:"No hay datos de productos disponibles",italics:!0,margin:[0,5,0,10]}];Array.isArray(t)||(console.warn("Lista de clientes no válida"),t=[]);const s=e.productos.reduce((e,t)=>(e[t.clienteId]||(e[t.clienteId]=[]),e[t.clienteId].push(t),e),{});let c=!1;return Object.entries(s).forEach(([e])=>{const a=C(e,t);a.toLowerCase().includes("elizabeth")&&(c=!0)}),Object.entries(s).forEach(([l,d])=>{const u=C(l,t),p=g(u),b=a&&a[l],y=o&&o[l],S=d.filter(e=>{const t=v(e,u,y);return t>0});if(n.push({text:"Cliente: "+u,style:["subheader",p],margin:[0,5,0,5]}),S.length>0){let e=S;if(b){const t={};S.forEach(e=>{const a=e.nombreAlternativoPDF||e.medida,o=e.tipo||"",n=e.camaronNeto||.65,r="c/h20"===o?`${a}-${o}-${n}`:`${a}-${o}`;t[r]?(t[r].kilos.push(...e.kilos),t[r].taras.push(...e.taras),e.tarasExtra&&t[r].tarasExtra.push(...e.tarasExtra),e.reporteTaras&&t[r].reporteTaras.push(...e.reporteTaras),e.reporteBolsas&&t[r].reporteBolsas.push(...e.reporteBolsas),t[r].tarasInfo.push(...e.taras.map(t=>({valor:t,restarTaras:e.restarTaras}))),t[r].taras=t[r].tarasInfo.map(e=>e.valor)):t[r]={...e,medida:a,kilos:[...e.kilos],taras:[...e.taras],tarasExtra:[...e.tarasExtra||[]],reporteTaras:[...e.reporteTaras||[]],reporteBolsas:[...e.reporteBolsas||[]],tarasInfo:e.taras.map(t=>({valor:t,restarTaras:e.restarTaras}))}}),e=Object.values(t)}const t=m(e),a=t.some(e=>{const t=v(e,u,y);return t>0});if(a){n.push({text:"Limpio:",style:["subheader",p],margin:[0,5,0,5]},h(t,p,u,y),{text:"\n"});const e=d.reduce((e,t)=>e+w(t),0);e>0&&(r+=e,n.push({text:"Taras de limpio: "+e,margin:[0,5,0,5]},{text:"\n"}))}}if(e.clienteCrudos&&e.clienteCrudos[l]){const t=I(e.clienteCrudos,l,u);if(t){n.push({text:"Crudos:",style:["subheader",p],margin:[0,5,0,5]},f(e.clienteCrudos[l],p),{text:"\n"});const t=e.clienteCrudos[l].reduce((e,t)=>e+t.items.reduce((e,t)=>e+x(t),0),0);t>0&&(i+=t,n.push({text:"Taras de crudo: "+t,margin:[0,5,0,5]},{text:"\n"}))}}const A=S.length>0,E=e.clienteCrudos&&e.clienteCrudos[l]&&e.clienteCrudos[l].some(e=>e.items.some(e=>{const t=k(e,u),a=parseFloat(t);return a>0}));A||E||n.push({text:"No hay medidas registradas para este cliente",italics:!0,margin:[0,5,0,10]},{text:"\n"});let z=0;Object.entries(s).forEach(([e,a])=>{a.forEach(a=>{if(a.precio){const n=o&&o[e],r=v(a,C(e,t),n);z+=r*Number(a.precio)}})}),e.clienteCrudos&&Object.keys(e.clienteCrudos).forEach(a=>{F(e.clienteCrudos,a,t,e=>{if(e.precio){const o=parseFloat(k(e,C(a,t)));z+=o*Number(e.precio)}})}),r+i>0&&n.push(...$(r,i,z,c))}),n}function d(e,t){const a=[];if(!e||!e.productos||!Array.isArray(e.productos))return console.warn("Datos de embarque inválidos o productos no encontrados para rendimientos"),[];const o=e.productos.filter(e=>"4"===e.clienteId&&!e.esVenta);if(o.length>0){a.push({text:"Rendimientos de Maquila:",style:"subheader",margin:[0,20,0,10]});const t={table:{headerRows:1,widths:["33%","33%","34%"],body:[[{text:"Medida",style:"tableHeader"},{text:"Kilos en Crudo",style:"tableHeader"},{text:"Rendimiento",style:"tableHeader"}]]},layout:{hLineWidth:()=>1,vLineWidth:()=>1,hLineColor:()=>"#008000",vLineColor:()=>"#008000"}};let n=0,r=0;const i=o.reduce((e,t)=>{const a=t.medida;return e[a]||(e[a]=[]),e[a].push(t),e},{});Object.entries(i).forEach(([a,o])=>{const i=o.reduce((e,t)=>e+u(t),0);let s=0;const c=a+" Maquila Ozuna";e.kilosCrudos&&e.kilosCrudos[c]&&(s="object"===typeof e.kilosCrudos[c]?Number(e.kilosCrudos[c].medida1||0)+Number(e.kilosCrudos[c].medida2||0):Number(e.kilosCrudos[c]));const l=i>0?s/i:0;n+=s,r+=i,t.table.body.push([{text:a,alignment:"center"},{text:s.toFixed(2)+" kg",alignment:"center"},{text:l.toFixed(2),alignment:"center",color:l>1?"#27ae60":"#000000",bold:l>1}])});const s=r>0?n/r:0;t.table.body.push([{text:"TOTAL",style:"tableHeader",alignment:"center"},{text:n.toFixed(2)+" kg",style:"tableHeader",alignment:"center"},{text:s.toFixed(2),style:"tableHeader",alignment:"center",color:s>1?"#27ae60":"#000000",bold:s>1}]),a.push(t)}return a}function u(e){if("c/h20"===e.tipo){let t=0;const a=e.reporteTaras||[],o=e.reporteBolsas||[];for(let e=0;e<a.length;e++){const n=parseInt(a[e])||0,r=parseInt(o[e])||0;t+=n*r}return t*(e.camaronNeto||.65)}{const t=e.kilos.reduce((e,t)=>e+(Number(t)||0),0),a=e.taras.reduce((e,t)=>e+(Number(t)||0),0),o=(e.tarasExtra||[]).reduce((e,t)=>e+(Number(t)||0),0),n=a+o,r=e.restarTaras?3*n:0;return t-r}}function p(e){return e.split(" ")[0].toLowerCase()}function m(e){return e.sort((e,t)=>{const a=p(e.nombreAlternativoPDF||e.medida),o=p(t.nombreAlternativoPDF||t.medida);if(a!==o)return a.localeCompare(o);if(e.tipo!==t.tipo)return e.tipo.localeCompare(t.tipo);if("c/h20"===e.tipo&&"c/h20"===t.tipo){const a=e.camaronNeto||.65,o=t.camaronNeto||.65;return a-o}return 0})}function h(e,t,a,o=!0){const n=e.filter(e=>{const t=v(e,a,o);return t>0});if(0===n.length)return{table:{headerRows:1,widths:["100%"],body:[[{text:"No hay productos con kilos registrados",italics:!0,alignment:"center"}]]},layout:{hLineWidth:function(e,t){return 0===e||e===t.table.body.length?2:1},vLineWidth:function(e,t){return 0===e||e===t.table.widths.length?2:1},hLineColor:function(e,a){return 0===e||e===a.table.body.length?A(t):"black"},vLineColor:function(e,a){return 0===e||e===a.table.widths.length?A(t):"black"}}};const r=n.some(e=>e.nota&&""!==e.nota.trim()),i=n.some(e=>e.hilos),s=a.toLowerCase().includes("elizabeth"),c=s&&n.some(e=>e.precio&&""!==e.precio.toString().trim()),l=[{text:"Kg",style:"tableHeader"},{text:"Producto",style:"tableHeader"},{text:"Taras",style:"tableHeader"}];s&&c&&(l.push({text:"Precio",style:"tableHeader"}),l.push({text:"Total",style:"tableHeader"})),i&&l.push({text:"Hilos",style:"tableHeader"}),r&&l.push({text:"Notas",style:"tableHeader"});const d=[l];let u,p=0;if(n.forEach(e=>{const t=(e.taras||[]).reduce((e,t)=>e+(t||0),0),n=(e.tarasExtra||[]).reduce((e,t)=>e+(t||0),0),l=t+n;let u=`${l} ${S(e.reporteTaras,e.reporteBolsas)}`;const m=v(e,a,o);if(m>0){const t=[a.toLowerCase().includes("ozuna")?m.toFixed(1)+" kg":Math.round(m)+" kg",s&&c?(e.nombreAlternativoPDF||e.medida||"")+("c/h20"===e.tipo?" c/h2o":"s/h20"===e.tipo?" s/h2o":"otro"===e.tipo?" "+(e.tipoPersonalizado||""):" "+(e.tipo||"")):y(e),u];if(s&&c){t.push(e.precio?{text:"$"+Number(e.precio).toLocaleString("en-US"),style:"precio"}:"");const a=e.precio?m*Number(e.precio):0;p+=a,t.push(e.precio?{text:"$"+Math.round(a).toLocaleString("en-US"),style:"totalPrecio"}:"")}i&&t.push(e.hilos||""),r&&t.push({text:e.nota||"",style:"nota"}),d.push(t)}}),s&&c&&p>0){const e=l.length,t=[{text:"GRAN TOTAL:",bold:!0,alignment:"right",color:"#9b59b6",border:[!0,!0,!0,!0],colSpan:e-1}];for(let a=1;a<e-1;a++)t.push({});t.push({text:"$"+Math.round(p).toLocaleString("en-US"),bold:!0,fontSize:24,color:"#9b59b6",border:[!0,!0,!0,!0],alignment:"center"}),d.push(t)}if(1===d.length)return{table:{headerRows:1,widths:["100%"],body:[[{text:"No hay productos con kilos registrados",italics:!0,alignment:"center"}]]},layout:{hLineWidth:function(e,t){return 0===e||e===t.table.body.length?2:1},vLineWidth:function(e,t){return 0===e||e===t.table.widths.length?2:1},hLineColor:function(e,a){return 0===e||e===a.table.body.length?A(t):"black"},vLineColor:function(e,a){return 0===e||e===a.table.widths.length?A(t):"black"}}};if(s&&c){u=i&&r?["10%","20%","20%","15%","15%","10%","10%"]:i||r?["15%","20%","20%","15%","15%","15%"]:["15%","25%","20%","20%","20%"]}else u=i&&r?["15%","25%","25%","15%","20%"]:i||r?["20%","30%","30%","20%"]:["25%","35%","40%"];return{table:{headerRows:1,widths:u,body:d},layout:{hLineWidth:function(e,t){return 0===e||e===t.table.body.length?2:1},vLineWidth:function(e,t){return 0===e||e===t.table.widths.length?2:1},hLineColor:function(e,a){return 0===e||e===a.table.body.length?A(t):"black"},vLineColor:function(e,a){return 0===e||e===a.table.widths.length?A(t):"black"}}}}function f(e,t){const a=z(t),o=a.toLowerCase().includes("elizabeth"),n=[];let r=!1;try{if(!Array.isArray(e))return console.warn("Los crudos proporcionados no son un array válido"),b(t);e.forEach(e=>{e&&Array.isArray(e.items)?e.items.forEach(t=>{if(!t)return void console.warn("Item no válido en crudo",{crudo:e});const o=k(t,a),i=parseFloat(o);i>0&&(n.push(t),t.precio&&""!==t.precio.toString().trim()&&(r=!0))}):console.warn("Estructura de crudo no válida",{crudo:e})})}catch(j){return console.error("Error al procesar crudos:",j),b(t)}if(0===n.length)return b(t);const i=[{text:"Cantidad",style:"tableHeader"},{text:"Talla",style:"tableHeader"},{text:"Taras",style:"tableHeader"}];r&&(i.push({text:"Precio",style:"tableHeader"}),o&&i.push({text:"Total",style:"tableHeader"}));const s=[i];let c,l=0;if(n.forEach(e=>{const t=k(e,a),n=parseFloat(t),i=[Math.round(n)+" kg",{text:e.talla.replace(/\s*c\/\s*c$/i," c/c"),style:"default",noWrap:!0},x(e)];if(r&&(i.push(e.precio?{text:"$"+Number(e.precio).toLocaleString("en-US"),style:"precio"}:""),o)){const t=e.precio?n*Number(e.precio):0;l+=t,i.push(e.precio?{text:"$"+Math.round(t).toLocaleString("en-US"),style:"totalPrecio"}:"")}s.push(i)}),o&&r&&l>0){const e=i.length,t=[{text:"GRAN TOTAL:",bold:!0,alignment:"right",color:"#9b59b6",border:[!0,!0,!0,!0],colSpan:e-1}];for(let a=1;a<e-1;a++)t.push({});t.push({text:"$"+Math.round(l).toLocaleString("en-US"),bold:!0,fontSize:24,color:"#9b59b6",border:[!0,!0,!0,!0],alignment:"center"}),s.push(t)}return c=r?o?["20%","25%","20%","15%","20%"]:["25%","30%","25%","20%"]:["30%","40%","30%"],{table:{headerRows:1,widths:c,body:s},layout:{hLineWidth:function(e,t){return 0===e||e===t.table.body.length?2:1},vLineWidth:function(e,t){return 0===e||e===t.table.widths.length?2:1},hLineColor:function(e,a){return 0===e||e===a.table.body.length?A(t):"black"},vLineColor:function(e,a){return 0===e||e===a.table.widths.length?A(t):"black"}}}}function b(e){return{table:{headerRows:1,widths:["100%"],body:[[{text:"No hay crudos con kilos registrados",italics:!0,alignment:"center"}]]},layout:{hLineWidth:function(e,t){return 0===e||e===t.table.body.length?2:1},vLineWidth:function(e,t){return 0===e||e===t.table.widths.length?2:1},hLineColor:function(t,a){return 0===t||t===a.table.body.length?A(e):"black"},vLineColor:function(t,a){return 0===t||t===a.table.widths.length?A(e):"black"}}}}function g(e){const t=e.toLowerCase();return t.includes("joselito")?"clienteJoselito":t.includes("catarro")?"clienteCatarro":t.includes("otilio")?"clienteOtilio":t.includes("ozuna")?"clienteOzuna":t.includes("elizabeth")?"clienteElizabeth":"clienteOtro"}function y(e){let t=(e.nombreAlternativoPDF||e.medida||"").trim(),a=e.precio?" $"+Number(e.precio).toLocaleString("en-US"):"";if("c/h20"===e.tipo)return[{text:t+" c/h2o",style:"tipoConAgua"},{text:a,style:"precio"}].filter(e=>e.text);if("s/h20"===e.tipo)return[{text:t+" s/h2o",style:"default"},{text:a,style:"precio"}].filter(e=>e.text);let o="otro"===e.tipo?e.tipoPersonalizado:e.tipo,n=o?`${t} ${o}`:t;return[{text:n,style:"default"},{text:a,style:"precio"}].filter(e=>e.text)}function x(e){let t=0;if(e.taras){const[a]=e.taras.split("-").map(Number);t+=a}if(e.sobrante){const[a]=e.sobrante.split("-").map(Number);t+=a}return t}function C(e,t){if(!t||!Array.isArray(t))return console.warn("La lista de clientes disponibles no es válida"),"Cliente Desconocido";const a=t.find(t=>t.id.toString()===e.toString());return a?a.nombre:"Cliente Desconocido"}function w(e){const t=(e.taras||[]).reduce((e,t)=>e+(t||0),0),a=(e.tarasExtra||[]).reduce((e,t)=>e+(t||0),0);return t+a}function v(e,t,a=!0){const o=(e.kilos||[]).reduce((e,t)=>e+(t||0),0);let n=0;if(e.tarasInfo)n=e.tarasInfo.reduce((e,t)=>e+(t.restarTaras?3*(Number(t.valor)||0):0),0);else{const t=(e.taras||[]).reduce((e,t)=>e+(t||0),0);n=e.restarTaras?3*t:0}let r=o-n;const i=t?t.toLowerCase():"",s=e.tipo||"";if(!e.noSumarKilos&&(s.toLowerCase().includes("s/h2o")||s.toLowerCase().includes("s/h20"))&&(i.includes("catarro")&&(r+=1),a&&(i.includes("otilio")||e.nombreCliente&&e.nombreCliente.toLowerCase().includes("otilio")))){const e=Math.floor(r/100);r+=e}return i.includes("elizabeth")||i.includes("otilio")?Math.round(r):(i.includes("ozuna"),Number(r.toFixed(1)))}function k(e,t){let a=0;if(e.taras){const[o,n]=e.taras.split("-").map(Number),r=t&&t.toLowerCase().includes("elizabeth")?20:20.5;a+=o*r}if(e.sobrante){const[,t]=e.sobrante.split("-").map(Number);a+=t}return t&&t.toLowerCase().includes("elizabeth")?Math.round(a).toString():a.toFixed(1)}function S(e,t){const a={};return e.forEach((e,o)=>{const n=t[o]||"";a[n]||(a[n]=0),a[n]+=parseInt(e||1)}),Object.entries(a).map(([e,t])=>`(${t}-${e})`).join(" ")}function A(e){const t={clienteJoselito:"#0000FF",clienteCatarro:"#FF0000",clienteOtilio:"#FFD700",clienteOzuna:"#008000",clienteElizabeth:"#9b59b6",clienteOtro:"#808080"};return t[e]||"#000000"}function E(e){return new Promise((t,a)=>{const o=new Image;o.crossOrigin="Anonymous",o.onload=function(){const e=document.createElement("canvas");e.width=o.width,e.height=o.height;const a=e.getContext("2d");a.drawImage(o,0,0);const n=e.toDataURL("image/png");t(n)},o.onerror=a,o.src=e})}function z(e){switch(e){case"clienteJoselito":return"joselito";case"clienteCatarro":return"catarro";case"clienteOtilio":return"otilio";case"clienteOzuna":return"ozuna";case"clienteElizabeth":return"elizabeth";default:return"otro"}}function T(e,t,a,o={}){const n=[];let r=0,i=0;if(!e||!e.productos||!Array.isArray(e.productos))return console.warn("Datos de embarque inválidos o productos no encontrados"),[{text:"No hay datos de productos disponibles",italics:!0,margin:[0,5,0,10]}];Array.isArray(t)||(console.warn("Lista de clientes no válida"),t=[]);const s=e.productos.reduce((e,t)=>(e[t.clienteId]||(e[t.clienteId]=[]),e[t.clienteId].push(t),e),{});let c=!1;return Object.entries(s).forEach(([e])=>{const a=C(e,t);a.toLowerCase().includes("elizabeth")&&(c=!0)}),Object.entries(s).forEach(([l,d])=>{const u=C(l,t),p=g(u),h=a&&a[l],f=o&&o[l],b=d.filter(e=>{const t=v(e,u,f);return t>0});if(n.push({text:"Cliente: "+u,style:["subheader",p],margin:[0,5,0,5]}),b.length>0){let e=b;if(h){const t={};b.forEach(e=>{const a=e.nombreAlternativoPDF||e.medida,o=e.tipo||"",n=e.camaronNeto||.65,r="c/h20"===o?`${a}-${o}-${n}`:`${a}-${o}`;t[r]?(t[r].kilos.push(...e.kilos),t[r].taras.push(...e.taras),e.tarasExtra&&t[r].tarasExtra.push(...e.tarasExtra),e.reporteTaras&&t[r].reporteTaras.push(...e.reporteTaras),e.reporteBolsas&&t[r].reporteBolsas.push(...e.reporteBolsas),t[r].tarasInfo.push(...e.taras.map(t=>({valor:t,restarTaras:e.restarTaras}))),t[r].taras=t[r].tarasInfo.map(e=>e.valor)):t[r]={...e,medida:a,kilos:[...e.kilos],taras:[...e.taras],tarasExtra:[...e.tarasExtra||[]],reporteTaras:[...e.reporteTaras||[]],reporteBolsas:[...e.reporteBolsas||[]],tarasInfo:e.taras.map(t=>({valor:t,restarTaras:e.restarTaras}))}}),e=Object.values(t)}const t=m(e),a=t.some(e=>{const t=v(e,u,f);return t>0});if(a){n.push({text:"Limpio:",style:["subheader",p],margin:[0,5,0,5]},L(t,p,u,f),{text:"\n"});const e=d.reduce((e,t)=>e+w(t),0);e>0&&(r+=e,n.push({text:"Taras de limpio: "+e,margin:[0,5,0,5]},{text:"\n"}))}}if(e.clienteCrudos&&e.clienteCrudos[l]){const t=I(e.clienteCrudos,l,u);if(t){n.push({text:"Crudos:",style:["subheader",p],margin:[0,5,0,5]},O(e.clienteCrudos[l],p),{text:"\n"});const t=e.clienteCrudos[l].reduce((e,t)=>e+t.items.reduce((e,t)=>e+x(t),0),0);t>0&&(i+=t,n.push({text:"Taras de crudo: "+t,margin:[0,5,0,5]},{text:"\n"}))}}const y=b.length>0,S=e.clienteCrudos&&e.clienteCrudos[l]&&e.clienteCrudos[l].some(e=>e.items.some(e=>{const t=k(e,u),a=parseFloat(t);return a>0}));y||S||n.push({text:"No hay medidas registradas para este cliente",italics:!0,margin:[0,5,0,10]},{text:"\n"});let A=0;Object.entries(s).forEach(([e,a])=>{a.forEach(a=>{if(a.precio){const n=o&&o[e],r=v(a,C(e,t),n);A+=r*Number(a.precio)}})}),e.clienteCrudos&&Object.keys(e.clienteCrudos).forEach(a=>{F(e.clienteCrudos,a,t,e=>{if(e.precio){const o=parseFloat(k(e,C(a,t)));A+=o*Number(e.precio)}})}),r+i>0&&n.push(...$(r,i,A,c))}),n}function L(e,t,a,o=!0){const n=e.filter(e=>{const t=v(e,a,o);return t>0});if(0===n.length)return{table:{headerRows:1,widths:["100%"],body:[[{text:"No hay productos con kilos registrados",italics:!0,alignment:"center"}]]},layout:{hLineWidth:function(e,t){return 0===e||e===t.table.body.length?2:1},vLineWidth:function(e,t){return 0===e||e===t.table.widths.length?2:1},hLineColor:function(e,a){return 0===e||e===a.table.body.length?A(t):"black"},vLineColor:function(e,a){return 0===e||e===a.table.widths.length?A(t):"black"}}};const r=n.some(e=>e.nota&&""!==e.nota.trim()),i=n.some(e=>e.hilos),s=[{text:"Kg",style:"tableHeader"},{text:"Producto",style:"tableHeader"},{text:"Taras",style:"tableHeader"}];i&&s.push({text:"Hilos",style:"tableHeader"}),r&&s.push({text:"Notas",style:"tableHeader"});const c=[s];if(n.forEach(e=>{const t=(e.taras||[]).reduce((e,t)=>e+(t||0),0),n=(e.tarasExtra||[]).reduce((e,t)=>e+(t||0),0),s=t+n;let l=`${s} ${S(e.reporteTaras,e.reporteBolsas)}`;const d=v(e,a,o);if(d>0){const t=[Math.round(d)+" kg",N(e),l];i&&t.push(e.hilos||""),r&&t.push({text:e.nota||"",style:"nota"}),c.push(t)}}),1===c.length)return{table:{headerRows:1,widths:["100%"],body:[[{text:"No hay productos con kilos registrados",italics:!0,alignment:"center"}]]},layout:{hLineWidth:function(e,t){return 0===e||e===t.table.body.length?2:1},vLineWidth:function(e,t){return 0===e||e===t.table.widths.length?2:1},hLineColor:function(e,a){return 0===e||e===a.table.body.length?A(t):"black"},vLineColor:function(e,a){return 0===e||e===a.table.widths.length?A(t):"black"}}};let l;return l=i&&r?["20%","30%","25%","10%","15%"]:i||r?["25%","35%","25%","15%"]:["25%","45%","30%"],{table:{headerRows:1,widths:l,body:c},layout:{hLineWidth:function(e,t){return 0===e||e===t.table.body.length?2:1},vLineWidth:function(e,t){return 0===e||e===t.table.widths.length?2:1},hLineColor:function(e,a){return 0===e||e===a.table.body.length?A(t):"black"},vLineColor:function(e,a){return 0===e||e===a.table.widths.length?A(t):"black"}}}}function O(e,t){const a=z(t),o=e.map(e=>{const t=e.items.filter(e=>{const t=k(e,a),o=parseFloat(t);return o>0});return{...e,items:t}}).filter(e=>e.items.length>0);if(0===o.length||o.every(e=>0===e.items.length))return{table:{headerRows:1,widths:["100%"],body:[[{text:"No hay crudos con kilos registrados",italics:!0,alignment:"center"}]]},layout:{hLineWidth:function(e,t){return 0===e||e===t.table.body.length?2:1},vLineWidth:function(e,t){return 0===e||e===t.table.widths.length?2:1},hLineColor:function(e,a){return 0===e||e===a.table.body.length?A(t):"black"},vLineColor:function(e,a){return 0===e||e===a.table.widths.length?A(t):"black"}}};const n=[{text:"Cantidad",style:"tableHeader"},{text:"Talla",style:"tableHeader"},{text:"Taras",style:"tableHeader"}],r=[n];if(o.forEach(e=>e.items.forEach(e=>{const t=k(e,a),o=parseFloat(t);if(o>0){const t=[Math.round(o)+" kg",{text:e.talla.replace(/\s*c\/\s*c$/i," c/c"),style:"default",noWrap:!0},x(e)];r.push(t)}})),1===r.length)return{table:{headerRows:1,widths:["100%"],body:[[{text:"No hay crudos con kilos registrados",italics:!0,alignment:"center"}]]},layout:{hLineWidth:function(e,t){return 0===e||e===t.table.body.length?2:1},vLineWidth:function(e,t){return 0===e||e===t.table.widths.length?2:1},hLineColor:function(e,a){return 0===e||e===a.table.body.length?A(t):"black"},vLineColor:function(e,a){return 0===e||e===a.table.widths.length?A(t):"black"}}};const i=["30%","40%","30%"];return{table:{headerRows:1,widths:i,body:r},layout:{hLineWidth:function(e,t){return 0===e||e===t.table.body.length?2:1},vLineWidth:function(e,t){return 0===e||e===t.table.widths.length?2:1},hLineColor:function(e,a){return 0===e||e===a.table.body.length?A(t):"black"},vLineColor:function(e,a){return 0===e||e===a.table.widths.length?A(t):"black"}}}}function N(e){let t=(e.nombreAlternativoPDF||e.medida||"").trim();if("c/h20"===e.tipo)return{text:t+" c/h2o",style:"tipoConAgua"};if("s/h20"===e.tipo)return{text:t+" s/h2o",style:"default"};let a="otro"===e.tipo?e.tipoPersonalizado:e.tipo,o=a?`${t} ${a}`:t;return{text:o,style:"default"}}function F(e,t,a,o){if(e&&e[t])try{const a=e[t];if(!Array.isArray(a))return void console.warn("Crudos no válidos para el cliente "+t,{crudos:a});for(const e of a)if(e&&Array.isArray(e.items))for(const a of e.items)a?o(a):console.warn("Item no válido en crudo para el cliente "+t,{crudo:e});else console.warn("Estructura de crudo no válida para el cliente "+t,{crudo:e})}catch(j){console.error(`Error al procesar crudos para el cliente ${t}:`,j)}}function I(e,t,a){let o=!1;if(!e||!e[t])return!1;try{const n=e[t];if(!Array.isArray(n))return console.warn("Crudos no válidos para el cliente "+t,{crudos:n}),!1;for(const e of n)if(e&&Array.isArray(e.items)){for(const n of e.items){if(!n){console.warn("Item no válido en crudo para el cliente "+t,{crudo:e});continue}const r=k(n,a),i=parseFloat(r);if(i>0){o=!0;break}}if(o)break}else console.warn("Estructura de crudo no válida para el cliente "+t,{crudo:e})}catch(j){return console.error(`Error al verificar kilos crudos para el cliente ${t}:`,j),!1}return o}function $(e,t,a,o){if(e+t<=0)return[];const n=[{text:"Total general de taras: "+(e+t),style:"subheader",width:"100%"}];return o&&(n.push({text:"Total general: $"+Math.round(a).toLocaleString("en-US"),style:["subheader","granTotal"],alignment:"right",width:"50%"}),n[0].width="50%"),[{columns:n,margin:[0,5,0,5]}]}"undefined"!==typeof window&&window.pdfMake&&(console.log("Usando pdfMake global (CDN)"),pdfMake=window.pdfMake)},"41cb":function(e,t,a){"use strict";var o=a("2b0e"),n=a("8c4f"),r=(a("f549"),a("bb51")),i=a("f411"),s=a("98cf"),c=a("4e00"),l=a("32e5"),d=a("9302"),u=a("1155"),p=a("2cc6"),m=a("4c52"),h=a("4c57"),f=a("505e"),b=a("f515"),g=a("fcb3"),y=a("24d5"),x=a("4786f"),C=a("28ce"),w=a("74a9"),v=a("320e"),k=a("0ae9"),S=a("c8b7"),A=a("b34e"),E=a("f458"),z=a("4dc0"),T=a("9aeb"),L=a("586e"),O=a("a55b"),N=a("9f85"),F=a("85fe"),I=a("9e53"),$=a("a593"),j=a("05af"),M=a("c5f5"),V=a("f125"),P=(a("0042"),a("cc985")),D=a("3420"),H=a("d918"),R=a("92c9"),B=a("e524"),W=a("8610"),q=a("3206"),G=a("9b35"),J=a("98d3"),U=a("767f"),K=a("2edd"),_=a("fc3d"),Y=a("38aa"),Z=a("f40d"),X=a("9c33"),Q=a("6e99");o["default"].use(n["a"]);const ee=[{path:"/login",name:"Login",component:O["a"]},{path:"/noteMenu",name:"NoteMenu",component:i["a"]},{path:"/",name:"home",component:r["a"]},{path:"/sale-note/:noteId?",name:"SaleNote",component:()=>Promise.resolve().then(a.bind(null,"98cf"))},{path:"/add-client",name:"AddClient",component:c["a"]},{path:"/editar-nota/:noteId",name:"editar-nota",component:s["default"],props:!0},{path:"/sacadas",name:"SacadasMenu",component:d["a"]},{path:"/sacadas/new",name:"NuevaSacada",component:l["a"]},{path:"/sacadas/:id",name:"DetalleSacada",component:l["a"],props:!0},{path:"/gestionar-productos",name:"GestionarProductos",component:u["a"]},{path:"/gestionar-medidas",name:"GestionarMedidas",component:p["a"]},{path:"/gestionar-proveedores",name:"GestionarProveedores",component:m["a"]},{path:"/existencias",name:"Existencias",component:h["a"]},{path:"/existencias-crudos",name:"ExistenciasCrudos",component:_["a"]},{path:"/existencias-crudos/new",name:"NuevoRegistroCrudos",component:Y["a"]},{path:"/existencias-crudos/:id",name:"EditarRegistroCrudos",component:Y["a"],props:!0},{path:"/cuentas-mexico",name:"CuentasMexico",component:f["a"]},{path:"/cuentas-ozuna",name:"ozuna-cuentas-menu",component:b["a"]},{path:"/cuentas-ozuna/nueva",name:"nueva-cuenta-ozuna",component:g["a"]},{path:"/cuentas-ozuna/:id",name:"ver-cuenta-ozuna",component:g["a"]},{path:"/cuentas-ozuna/:id?",name:"CuentasOzuna",component:g["a"]},{path:"/cuentas-catarro",name:"catarro-cuentas-menu",component:y["a"]},{path:"/cuentas-catarro/nueva",name:"nueva-cuenta-catarro",component:x["a"]},{path:"/cuentas-catarro/:id",name:"ver-cuenta-catarro",component:x["a"]},{path:"/cuentas-catarro/:id?",name:"CuentasCatarro",component:x["a"]},{path:"/cuentas-joselito",name:"joselito-cuentas-menu",component:C["a"]},{path:"/cuentas-joselito/nueva",name:"nueva-cuenta-joselito",component:w["a"]},{path:"/cuentas-joselito/:id",name:"ver-cuenta-joselito",component:w["a"]},{path:"/cuentas-joselito/:id?",name:"CuentasJoselito",component:w["a"]},{path:"/embarques-menu",name:"EmbarquesMenu",component:v["a"]},{path:"/ventas-ganancias-catarro",name:"VentasYGananciasCatarro",component:k["a"]},{path:"/ventas-ganancias-joselito",name:"VentasYGananciasJoselito",component:S["a"]},{path:"/embarques",name:"ListaEmbarques",component:A["a"]},{path:"/embarques/:id",name:"EditarEmbarque",component:E["a"]},{path:"/nuevo-embarque",name:"NuevoEmbarque",component:E["a"]},{path:"/embarques/:id/rendimientos",name:"Rendimientos",component:z["default"],props:!0},{path:"/embarques/:id/costos",name:"GestionCostos",component:L["a"],props:!0},{path:"/cuenta-fletes",name:"CuentaFletes",component:T["a"]},{path:"/cuentas-otilio",name:"otilio-cuentas-menu",component:N["a"]},{path:"/cuentas-otilio/nueva",name:"nueva-cuenta-otilio",component:F["a"]},{path:"/cuentas-otilio/:id",name:"ver-cuenta-otilio",component:F["a"]},{path:"/cuentas-otilio/:id?",name:"CuentasOtilio",component:F["a"]},{path:"/cuentas-otilio-independiente",name:"otilio-independiente-cuentas-menu",component:I["a"]},{path:"/cuentas-otilio-independiente/nueva",name:"nueva-cuenta-otilio-independiente",component:$["a"]},{path:"/cuentas-otilio-independiente/:id",name:"ver-cuenta-otilio-independiente",component:$["a"]},{path:"/cuentas-otilio-independiente/:id?",name:"CuentasOtilioIndependiente",component:$["a"]},{path:"/procesos",name:"ProcesosMenu",component:j["a"]},{path:"/procesos/preparacion",name:"Preparacion",component:M["a"]},{path:"/procesos/pedidos",name:"PedidosMenu",component:V["a"]},{path:"/procesos/pedidos/nuevo",name:"NuevoPedido",component:H["a"]},{path:"/procesos/pedidos/crudo",name:"PedidosCrudo",component:P["a"]},{path:"/procesos/pedidos/limpio",name:"PedidosLimpio",component:H["a"]},{path:"/procesos/pedidos-crudos-impresion",name:"PedidoCrudosImpresion",component:D["a"],props:!0},{path:"/procesos/pedidos-limpio-impresion",name:"PedidoLimpioImpresion",component:R["a"],props:!0},{path:"/procesos/bitacoras",name:"Bitacoras",component:B["a"]},{path:"/procesos/deudas",name:"DeudasMenu",component:W["a"]},{path:"/procesos/deudas/lista",name:"ListaDeudas",component:G["a"]},{path:"/procesos/deudas/nueva",name:"NuevaDeuda",component:q["a"]},{path:"/procesos/prestamos",name:"PrestamosMenu",component:J["a"]},{path:"/procesos/prestamos/despicadoras",name:"PrestamosDespicadoras",component:U["a"]},{path:"/procesos/prestamos/trabajadores",name:"PrestamosTrabajadores",component:K["a"]},{path:"/barcos",name:"BarcosMenu",component:Z["a"]},{path:"/barcos/deudas/nueva",name:"NuevaDeudaBarco",component:X["a"]},{path:"/barcos/deudas/lista",name:"ListaDeudasBarcos",component:Q["a"]}],te=new n["a"]({mode:"history",base:"/",routes:ee});te.beforeEach((e,t,a)=>{try{0;const n=localStorage.getItem("user");let r=!1;if(n)try{const e=JSON.parse(n);r=e&&e.username}catch(o){console.log("Limpiando localStorage corrupto"),localStorage.removeItem("user"),r=!1}if(console.log("Navigation Guard:",{to:e.path,from:t.path,isAuthenticated:r,userString:n?"exists":"null",userParsed:n?JSON.parse(n):null}),"/login"===e.path&&r)return console.log("Redirigiendo a home porque ya está autenticado"),void a("/");if("/login"!==e.path&&!r)return console.log("Redirigiendo a login porque no está autenticado"),void a("/login");console.log("Permitiendo navegación normal"),a()}catch(n){console.error("Error en navigation guard:",n),"/login"===e.path?a():a("/login")}}),t["a"]=te},"692f":function(e,t,a){"use strict";a.d(t,"a",(function(){return v}));a("14d9"),a("13d5"),a("88e6"),a("70cc"),a("eb03"),a("22e5c"),a("c01e"),a("fa76"),a("8306");var o=a("e499"),n=a.n(o),r=a("4ebb"),i=a.n(r);function s(e){const t={1:"#3498db",2:"#e74c3c",3:"#f1c40f",4:"#2ecc71"};return t[e]||"#95a5a6"}function c(e,t,a=100,o=[]){const n=a/100,r=[{text:"",pageBreak:"before"}];let i=0,c=0;const p=120,y=25,x=[],C=[];Object.entries(e).forEach(([e,t])=>{const a=m(t);a>0&&(["1","2","3","4"].includes(e)?x.push([e,t]):C.push([e,t]))});for(let w=0;w<C.length;w+=3){const e=[];for(let t=0;t<3&&w+t<C.length;t++){const[a,r]=C[w+t],x=l(a,o),v=h(r),k=m(r);i+=v,c+=k,e.push({stack:[{columns:[{width:"auto",stack:[{canvas:[{type:"rect",x:0,y:0,w:.8*p,h:y,r:8,color:s(a)}]},{text:x,color:"white",fontSize:11*n,relativePosition:{x:10,y:-20}}]},{text:`${v}T|${f(k)}Kg`,style:"total",alignment:"right",color:s(a),fontSize:11*n}],margin:[0,3,0,3]},...r.map(e=>({stack:[{text:d(e,a),fontSize:11*n,bold:!0,margin:[0,0,0,1],alignment:"center"},{canvas:[{type:"line",x1:0,y1:1,x2:120,y2:1,lineWidth:.5,lineColor:"#000000"}],margin:[0,0,0,1]},{text:0===g(e)?[{text:""+f(u(e)),color:"red",bold:!0}]:[{text:g(e)+"-",bold:!0},{text:""+f(u(e)),color:"red",bold:!0}],fontSize:11*n,margin:[0,1,0,1],alignment:"center"},{text:b(e),fontSize:10*n,margin:[0,0,0,1],alignment:"center"}],margin:[0,0,0,5]}))],width:"32%"})}r.push({columns:e,columnGap:10,margin:[0,0,0,15]})}return x.forEach(([e,t])=>{const a=l(e,o),x=h(t),C=m(t);i+=x,c+=C;const w=t.length;let v=13,k=15;w>30?(v=9,k=6):w>24?(v=10,k=8):w>18?(v=11,k=10):w>12&&(v=12,k=12),r.push({columns:[{width:"auto",stack:[{canvas:[{type:"rect",x:0,y:0,w:p,h:y,r:8,color:s(e)}]},{text:a,color:"white",fontSize:v*n,relativePosition:{x:10,y:-20}}]},{text:`Total: ${x}T | ${f(C)}Kg`,style:"total",alignment:"right",color:s(e),fontSize:v*n}],margin:[0,3,0,3]});let S=3;w>30&&(S=4);const A=[];for(let o=0;o<t.length;o+=S)A.push(t.slice(o,o+S));A.forEach(t=>{r.push({columns:t.map(t=>({stack:[{text:d(t,e),fontSize:v*n,bold:!0,margin:[0,0,0,1],alignment:"center"},{canvas:[{type:"line",x1:0,y1:1,x2:150,y2:1,lineWidth:.5,lineColor:"#000000"}],margin:[0,0,0,1]},{text:0===g(t)?[{text:""+f(u(t)),color:"red",bold:!0}]:[{text:g(t)+"-",bold:!0},{text:""+f(u(t)),color:"red",bold:!0}],fontSize:v*n,margin:[0,1,0,1],alignment:"center"},{text:b(t),fontSize:(v-1)*n,margin:[0,0,0,1],alignment:"center"}],width:100/S+"%",alignment:"center"})),columnGap:5,margin:[0,0,0,k]})}),r.push({canvas:[{type:"line",x1:0,y1:2,x2:515,y2:2,lineWidth:.5,lineColor:"#CCCCCC"}],margin:[0,5,0,5]})}),r}function l(e,t=[]){const a=e.toString();if(Array.isArray(t)&&t.length>0){const e=t.find(e=>{var t,o;return(null===(t=e.id)||void 0===t?void 0:t.toString())===a||(null===(o=e.clienteId)||void 0===o?void 0:o.toString())===a});if(e)return e.nombre||e.nombreCliente}const o={1:"Joselito",2:"Catarro",3:"Otilio",4:"Ozuna"};return o[a]||"Cliente "+a}function d(e,t=null){let a="";const o=[],n="4"===t&&!e.esVenta;return n&&o.push({text:"maquila\n",background:"#2ecc71",color:"white",bold:!0}),"c/h20"===e.tipo?(o.push({text:`${e.textoAlternativo||e.medida||""} ${e.fecha||""} `,color:"black"},{text:`c/h20 (${e.camaronNeto||.65})`,color:"#3498db"}),e.precio&&o.push({text:" $"+Number(e.precio).toLocaleString("en-US"),color:"red",bold:!0}),o):(a=e.textoAlternativo||e.medida||"",e.fecha&&(a+=" "+e.fecha),"3"===e.clienteId&&e.noSumarKilos&&(a+=" sellada"),"otro"===e.tipo?a+=" "+e.tipoPersonalizado:e.tipo&&(a+=" "+e.tipo),o.push({text:a,color:"black"}),e.precio&&o.push({text:" $"+Number(e.precio).toLocaleString("en-US"),color:"red",bold:!0}),o.length>(n?1:0)?o:a)}function u(e){if("c/h20"===e.tipo){const t=e.camaronNeto||.65,a=p(e);return a*t}const t=Array.isArray(e.kilos)?e.kilos.reduce((e,t)=>e+(parseFloat(t)||0),0):0;if(e.restarTaras){const a=3*(Array.isArray(e.taras)?e.taras.reduce((e,t)=>e+(parseInt(t)||0),0):0);return t-a}return t}function p(e){if(!Array.isArray(e.reporteTaras)||!Array.isArray(e.reporteBolsas))return 0;let t=0;for(let a=0;a<e.reporteTaras.length;a++){const o=parseInt(e.reporteTaras[a])||0,n=parseInt(e.reporteBolsas[a])||0;t+=o*n}return t}function m(e){return e.reduce((e,t)=>{if("c/h20"===t.tipo){const a=p(t);return e+a*(t.camaronNeto||.65)}{const a=t.kilos?t.kilos.reduce((e,t)=>e+(parseFloat(t)||0),0):0,o=t.taras?t.taras.reduce((e,t)=>e+(parseInt(t)||0),0):0;return t.restarTaras?e+(a-3*o):e+a}},0)}function h(e){return e.reduce((e,t)=>{const a=t.taras?t.taras.reduce((e,t)=>e+(parseInt(t)||0),0):0,o=t.tarasExtra?t.tarasExtra.reduce((e,t)=>e+(parseInt(t)||0),0):0;return e+a+o},0)}function f(e){return e.toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1})}function b(e){let t="";if(Array.isArray(e.reporteTaras)&&Array.isArray(e.reporteBolsas)){const a=[];let o=[],n=null;for(let t=0;t<e.reporteTaras.length;t++){const r=parseInt(e.reporteTaras[t]),i=parseInt(e.reporteBolsas[t]);isNaN(r)||isNaN(i)||(i===n?o.push(r):(o.length>0&&a.push(`(${o.join(",")}-${n})`),o=[r],n=i))}o.length>0&&null!==n&&a.push(`(${o.join(",")}-${n})`),t=a.join("")}return t}function g(e){const t=e.taras?e.taras.reduce((e,t)=>e+(parseInt(t)||0),0):0,a=e.tarasExtra?e.tarasExtra.reduce((e,t)=>e+(parseInt(t)||0),0):0;return t+a}"object"===typeof i.a&&i.a.hasOwnProperty("default")?n.a.vfs=i.a.default:"object"===typeof i.a&&i.a.pdfMake&&i.a.pdfMake.vfs?n.a.vfs=i.a.pdfMake.vfs:console.error("No se pudo inicializar vfs para pdfMake"),n.a.fonts={Roboto:{normal:"Roboto-Regular.ttf",bold:"Roboto-Medium.ttf",italics:"Roboto-Italic.ttf",bolditalics:"Roboto-MediumItalic.ttf"}};const y={Joselito:"#3498db",Catarro:"#e74c3c",Otilio:"#f1c40f",Ozuna:"#2ecc71",Elizabeth:"#9b59b6"},x=["Med","Med-Esp","Med-Gde","Gde","Extra","Jumbo"],C=e=>e.sort((e,t)=>{const a=e.toUpperCase(),o=t.toUpperCase(),n=x.findIndex(e=>e.toUpperCase()===a),r=x.findIndex(e=>e.toUpperCase()===o);return-1!==n&&-1!==r?n-r:-1!==n?-1:-1!==r?1:e.localeCompare(t)}),w=e=>{if(!Array.isArray(e)||0===e.length)return[];const t=e=>{if("string"===typeof e){const t=e.split("-");return t.length>1?Number(t[1]):0}return 0},a={};e.forEach(e=>{if(!e)return;const o=t(e);a[o]||(a[o]=[]),a[o].push(e)});const o=Object.keys(a).map(Number).sort((e,t)=>19===e?-1:19===t?1:e-t);return o.reduce((e,t)=>e.concat(a[t]),[])},v=(e,t,a,o=[],r=100)=>{let i=[];e.medidasCrudos&&Array.isArray(e.medidasCrudos)&&(i=e.medidasCrudos.map(e=>e.replace("c/c","").trim()),i=C([...new Set(i)])),console.log("Medidas de crudos encontradas:",i);const s=r/100,l={pageSize:"LETTER",pageOrientation:"portrait",content:[{table:{widths:["*","auto","*"],body:[[{text:"Carga: "+e.cargaCon,alignment:"left",fontSize:20*s,border:[!1,!1,!1,!0]},{text:"Embarque",alignment:"center",fontSize:25*s,bold:!0,border:[!1,!1,!1,!0]},{text:""+new Date(new Date(e.fecha).getTime()+864e5).toLocaleDateString("es-MX",{day:"2-digit",month:"short",year:"numeric",timeZone:"America/Mexico_City"}),alignment:"right",fontSize:20*s,border:[!1,!1,!1,!0]}]]},margin:[0,0,0,20*s]}],styles:{header:{fontSize:25*s,bold:!0,alignment:"center",margin:[0,0,0,0]},tableHeader:{bold:!0,fontSize:19*s,fillColor:"#eeeeee",alignment:"center"},clienteHeader:{fontSize:18*s,bold:!0,color:"white"},clienteCell:{bold:!0,fontSize:17*s,alignment:"left",color:"white"},dataCell:{fontSize:19*s,alignment:"center"},total:{fontSize:18*s,bold:!0,color:"white"}}},d=[{text:"Cliente",style:"tableHeader"},...i.map(t=>{const a=e.crudos.find(e=>e.medida.replace("c/c","").trim()===t&&e.textoAlternativo),o=a?a.textoAlternativo:t;return{text:o,style:"tableHeader"}})],u=[],p=new Set(e.crudos.map(e=>e.clienteId));p.forEach(t=>{const o=a(t),n="Joselito"===o?"8A":o,r=y[o]||"#95a5a6",s=[{text:n,style:"clienteCell",fillColor:r}];i.forEach(a=>{const o=e.crudos.filter(e=>e.clienteId===t&&e.medida.replace("c/c","").trim()===a);if(o.length>0){let e=[],t=!1,a=null;o.forEach(o=>{o.taras&&Array.isArray(o.taras)&&(e=e.concat(o.taras.filter(e=>e))),o.precio&&(t=!0,a=o.precio)});const n=w(e),r=[{text:n.join("\n"),style:"dataCell"}];t&&r.push({text:"$"+Number(a).toLocaleString("en-US"),color:"red",bold:!0,fontSize:16}),s.push({stack:r,style:"dataCell"})}else s.push({text:"",style:"dataCell"})}),u.push(s)});const m=[{text:"TOTAL",style:"total",fillColor:"#7f8c8d",alignment:"center"}];let h=0;i.forEach(t=>{let a=[];e.crudos.forEach(e=>{if(e.medida.replace("c/c","").trim()===t&&e.taras&&Array.isArray(e.taras)){const t=e.taras.filter(e=>e);a=a.concat(t)}});const o=w(a);let n=0;o.forEach(e=>{if("string"===typeof e&&e.includes("-")){const t=parseInt(e.split("-")[0]);isNaN(t)||(n+=t)}else"number"===typeof e?n+=e:"string"!==typeof e||isNaN(parseInt(e))||(n+=parseInt(e))}),h+=n,m.push({text:n>0?n.toString():"",style:"total",fillColor:"#7f8c8d",alignment:"center"})}),u.push(m),l.content.push({table:{headerRows:1,widths:[60,...i.map(()=>{const e=Math.min(100,395/i.length);return e})],body:[d,...u]},layout:{hLineWidth:function(e,t){return 1},vLineWidth:function(e,t){return 1},hLineColor:function(e,t){return"#000000"},vLineColor:function(e,t){return"#000000"},paddingLeft:function(e){return 4},paddingRight:function(e){return 4},paddingTop:function(e){return 4},paddingBottom:function(e){return 4}}}),l.content.push({columns:[{width:"*",text:""},{width:"auto",table:{body:[[{text:"GRAN TOTAL:",bold:!0,fontSize:22*s,alignment:"right",margin:[0,0,10,0]},{text:h.toString(),bold:!0,fontSize:22*s,alignment:"center"}]]},layout:"noBorders"},{width:"*",text:""}],margin:[0,15,0,15]}),l.content.push({text:"\n\n"},{text:"Desglose por Medida",style:"header",margin:[0,0,0,10]});const f=[{text:"Medida",style:"tableHeader"},{text:"Cliente",style:"tableHeader"},{text:"Barco",style:"tableHeader"}],b=[];i.forEach(t=>{const o=e.crudos.filter(e=>e.medida.replace("c/c","").trim()===t);if(o.length>0){const e=o[0],n=a(e.clienteId),r="Joselito"===n?"8A":n,i=e.textoAlternativo||t;b.push([{text:i,style:"dataCell",rowSpan:o.length,alignment:"center",verticalAlignment:"middle"},{text:r,style:"clienteCell",fillColor:y[n]||"#95a5a6"},{text:e.barco||"-",style:"dataCell"}]);for(let t=1;t<o.length;t++){const e=o[t],n=a(e.clienteId),r="Joselito"===n?"8A":n;b.push(["",{text:r,style:"clienteCell",fillColor:y[n]||"#95a5a6"},{text:e.barco||"-",style:"dataCell"}])}}}),l.content.push({table:{headerRows:1,widths:["*",100,"*"],body:[f,...b]},layout:{hLineWidth:function(e,t){return 1},vLineWidth:function(e,t){return 1},hLineColor:function(e,t){return"#000000"},vLineColor:function(e,t){return"#000000"},paddingLeft:function(e){return 4},paddingRight:function(e){return 4},paddingTop:function(e){return 4},paddingBottom:function(e){return 4},fillColor:function(e,t){return null},defaultBorder:!0,vLineAlignment:function(e,t){return"center"}}}),b.forEach(e=>{e[0].text&&(e[0]={...e[0],alignment:"center",margin:[0,10,0,10]})}),l.content.push(...c(t,y,r,o)),n.a.createPdf(l).download("resumen-embarque-completo.pdf")}},"6d4d":function(e,t,a){"use strict";a.d(t,"a",(function(){return k}));a("14d9");var o=a("e499"),n=a.n(o),r=a("4ebb"),i=a.n(r);const s=()=>{"object"===typeof i.a&&(i.a.pdfMake&&i.a.pdfMake.vfs?n.a.vfs=i.a.pdfMake.vfs:i.a.vfs?n.a.vfs=i.a.vfs:n.a.vfs=i.a),"undefined"===typeof window||window.pdfMake||(window.pdfMake=n.a)},c={header:{fontSize:24,bold:!0,color:"#3760b0",margin:[0,0,0,5]},tableHeader:{bold:!0,fontSize:14,color:"white",fillColor:"#3760b0"},rendimientoAlto:{color:"#27ae60",bold:!0},rendimientoBajo:{color:"#000000"},costoStyle:{color:"#e74c3c",bold:!0},gananciaPositiva:{color:"#27ae60",bold:!0},gananciaNegativa:{color:"#e74c3c",bold:!0},tableTotal:{bold:!0,fontSize:20,color:"#2c3e50",fillColor:"#e8f4f8"},tableTotalNegativo:{bold:!0,fontSize:20,color:"#e74c3c",fillColor:"#e8f4f8"}},l={hLineWidth:function(e,t){return 0===e||e===t.table.body.length?1.5:.5},vLineWidth:function(e,t){return 0===e||e===t.table.widths.length?1.5:.5},hLineColor:function(e,t){return 0===e||e===t.table.body.length?"#3760b0":"#cccccc"},vLineColor:function(e,t){return 0===e||e===t.table.widths.length?"#3760b0":"#cccccc"},fillColor:function(e,t,a){return e%2===0?"#f8f9fa":null},paddingLeft:function(e){return 4},paddingRight:function(e){return 4},paddingTop:function(e){return 2},paddingBottom:function(e){return 2}},d={hLineWidth:function(e,t){return 0===e||e===t.table.body.length||e===t.table.body.length-1?1.5:.5},vLineWidth:function(e,t){return 0===e||e===t.table.widths.length?1.5:.5},hLineColor:function(e,t){return 0===e||e===t.table.body.length||e===t.table.body.length-1?"#3760b0":"#cccccc"},vLineColor:function(e,t){return 0===e||e===t.table.widths.length?"#3760b0":"#cccccc"},fillColor:function(e,t,a){return e===t.table.body.length-1?"#e8f4f8":e%2===0?"#f8f9fa":null},paddingLeft:function(e){return 4},paddingRight:function(e){return 4},paddingTop:function(e){return 2},paddingBottom:function(e){return 2}},u={defaultStyle:{fontSize:18},footer:function(e,t){return{columns:[{text:"© 2025 Rey Pez - Tampico, Tamps.",alignment:"center",margin:[0,5,0,0],fontSize:8,color:"#3760b0"}]}}};var p=n.a;const m=e=>{if("number"===typeof e)return Math.floor(e)+" kg";if("object"===typeof e&&null!==e){const t=Math.floor((Number(e.medida1)||0)+(Number(e.medida2)||0));return t+" kg"}const t=Math.floor(Number(e));return t+" kg"},h=e=>Number(e).toFixed(2),f=e=>{if(!e)return"0";const t=Math.round(e);return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},b=e=>{if(!e)return"0";const t=Math.floor(e);return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},g=e=>{if(!e)return"Sin fecha";let t;if(e&&"function"===typeof e.toDate?t=e.toDate():"string"===typeof e?t=new Date(e):e instanceof Date&&(t=e),isNaN(t.getTime()))return"Fecha inválida";const a=new Date(t.getTime()+6e4*t.getTimezoneOffset());return a.toLocaleDateString("es-MX",{year:"numeric",month:"2-digit",day:"2-digit",timeZone:"America/Mexico_City"})},y=e=>new Promise((t,a)=>{const o=new Image;o.crossOrigin="Anonymous",o.onload=function(){const e=document.createElement("canvas");e.width=o.width,e.height=o.height;const a=e.getContext("2d");a.drawImage(o,0,0);const n=e.toDataURL("image/png");t(n)},o.onerror=a,o.src=e});a("13d5");const x=(e,t,a)=>{const o=e.reduce((e,a)=>{const o=t[a.medida]||a.medida;return o.includes("mixta")||o.includes("Mixta")?(e["Mixta"]||(e["Mixta"]={medida:"Mixta",kilosCrudos:0,totalEmbarcado:0,costoFinal:0}),a.kilosCrudos&&("object"===typeof a.kilosCrudos?e["Mixta"].kilosCrudos+=(parseFloat(a.kilosCrudos.medida1)||0)+(parseFloat(a.kilosCrudos.medida2)||0):e["Mixta"].kilosCrudos+=parseFloat(a.kilosCrudos)||0),e["Mixta"].totalEmbarcado+=parseFloat(a.totalEmbarcado)||0,e["Mixta"].costoFinal+=parseFloat(a.costoFinal)||0):e[o]={medida:o,kilosCrudos:parseFloat(a.kilosCrudos)||0,totalEmbarcado:parseFloat(a.totalEmbarcado)||0,costoFinal:a.costoFinal||0},e},{}),n=a.mostrarColumnaCosto,r=[[{text:"Kilos en Crudo",style:"tableHeader"},{text:"Medida",style:"tableHeader"},{text:"Rendimiento",style:"tableHeader"},...n?[{text:"Costo Final",style:"tableHeader"}]:[]],...Object.values(o).map(e=>{const t=e.totalEmbarcado>0?e.kilosCrudos/e.totalEmbarcado:0,a=t>1?"rendimientoAlto":"rendimientoBajo";let o=e.medida;if(e.medidasIncluidas){const t=Array.from(e.medidasIncluidas);o=`Mixta (${t.join(", ")})`}return[m(e.kilosCrudos),o,{text:`(${h(t)})`,style:a},...n?[{text:e.costoFinal?"$"+Number(e.costoFinal).toFixed(1):"$0.0",style:"costoStyle"}]:[]]})];return{table:{headerRows:1,widths:n?["25%","25%","25%","25%"]:["35%","35%","30%"],body:r},layout:l}},C=(e,t,a,o={})=>{const n=e&&Object.keys(e).length>0,r=o&&Object.keys(o).length>0;if(!n&&!r)return{text:"No hay datos de ganancias disponibles",style:"header",alignment:"center",margin:[0,10,0,10]};const i=(null===a||void 0===a?void 0:a.medidaOculta)||{},s=n?Object.entries(e).filter(([e])=>!i[e]):[],c=s.map(([e,a])=>{const o=t[e]||e,n=a.gananciaUnitaria||0,r=a.gananciaTotal||0,i=a.totalEmbarcado||0,s=a.precioVenta||0,c=a.costoBase||0;return[o,b(i)+" kg",{stack:[{text:"Compra: $"+f(c),fontSize:14,alignment:"center",margin:[0,0,0,2],color:"#e74c3c"},{text:"Venta: $"+f(s),fontSize:14,alignment:"center",color:"#27ae60"}],alignment:"center"},{text:"$"+f(n),style:n>=0?"gananciaPositiva":"gananciaNegativa"},{text:"$"+f(r),style:r>=0?"gananciaPositiva":"gananciaNegativa"}]}),l=Object.entries(o).map(([e,a])=>{const o=t[e]||e,n=a.precioMaquila||0,r=a.gananciaTotal||0,i=a.totalEmbarcado||0;return[o+" (Maquila)",b(i)+" kg",{stack:[{text:"Compra: N/A",fontSize:14,alignment:"center",margin:[0,0,0,2],color:"#6c757d"},{text:"Venta: $"+f(n),fontSize:14,alignment:"center",color:"#27ae60"}],alignment:"center"},{text:"$"+f(n),style:"gananciaPositiva"},{text:"$"+f(r),style:"gananciaPositiva"}]}),u=s.reduce((e,[t,a])=>e+(a.gananciaTotal||0),0),p=Object.values(o).reduce((e,t)=>e+(t.gananciaTotal||0),0),m=u+p;if(0===c.length&&0===l.length)return{text:"No hay datos de ganancias para mostrar",style:"header",alignment:"center",margin:[0,10,0,10]};const h=[[{text:"Medida",style:"tableHeader"},{text:"Kilos",style:"tableHeader"},{text:"Precios",style:"tableHeader"},{text:"Ganancia/kg",style:"tableHeader"},{text:"Ganancia Total",style:"tableHeader"}],...c,...l,[{text:"TOTAL GANANCIAS",style:"tableTotal"},{text:"",style:"tableTotal"},{text:"",style:"tableTotal"},{text:"",style:"tableTotal"},{text:"$"+f(m),style:m>=0?"tableTotal":"tableTotalNegativo"}]];return{stack:[{text:"Resumen de limpios",style:"header",alignment:"center",margin:[0,0,0,10]},{table:{headerRows:1,widths:["25%","15%","25%","15%","20%"],body:h},layout:d}]}},w=(e,t={})=>{if(0===Object.keys(t).length)return{text:""};const a=Object.values(t).reduce((e,t)=>e+(t.gananciaTotal||0),0),o=Object.values(t).reduce((e,t)=>e+(t.totalKilosCosto||0),0),n=Object.values(t).reduce((e,t)=>e+(t.totalKilos||0),0),r=[[{text:"Medida",style:"tableHeader"},{text:"Kilos",style:"tableHeader"},{text:"Precio",style:"tableHeader"},{text:"Costo",style:"tableHeader"},{text:"Ganancia",style:"tableHeader"}],...Object.entries(t).map(([e,t])=>{const a=t.totalKilos||0,o=t.totalKilosCosto||0,n=t.precioVenta||0,r=t.costoBase||0,i=t.gananciaTotal;return[e,{stack:[{text:`Kilos C: ${Math.floor(o)} kg`,fontSize:14,alignment:"center",margin:[0,0,0,2]},{text:`Kilos V: ${Math.floor(a)} kg`,fontSize:14,alignment:"center"}],alignment:"center"},{text:"$"+f(n),alignment:"center",style:"gananciaPositiva"},{text:"$"+r.toFixed(1),alignment:"center",style:"costoStyle"},{text:"$"+f(i),alignment:"center",style:i>=0?"gananciaPositiva":"gananciaNegativa"}]}),[{text:"TOTAL",style:"tableTotal"},{stack:[{text:`Kilos C: ${Math.floor(o)} kg`,fontSize:14,alignment:"center",margin:[0,0,0,2],bold:!0},{text:`Kilos V: ${Math.floor(n)} kg`,fontSize:14,alignment:"center",bold:!0}],alignment:"center",fillColor:"#e8f4f8"},{text:"",style:"tableTotal"},{text:"",style:"tableTotal"},{text:"$"+f(a),style:a>=0?"tableTotal":"tableTotalNegativo",alignment:"center"}]];return{stack:[{text:"Resumen de Crudos",style:"header",alignment:"center",margin:[0,0,0,10]},{table:{headerRows:1,widths:["25%","20%","18%","18%","19%"],body:r},layout:d}]}},v=(e,t,a)=>{const o=Object.values(e).reduce((e,t)=>e+(t.gananciaTotal||0),0),n=Object.values(t).reduce((e,t)=>e+(t.gananciaTotal||0),0),r=Object.values(a).reduce((e,t)=>e+(t.gananciaTotal||0),0),i=o+n+r;return 0===i?{text:"",margin:[0,0,0,0]}:{text:"TOTAL GENERAL: $"+f(i),style:i>=0?"tableTotal":"tableTotalNegativo",alignment:"center",fontSize:28,margin:[0,10,0,0]}};s();const k=async(e,t,a,o={},n={},r={},i={},s={})=>{try{const l=await y("https://res.cloudinary.com/hwkcovsmr/image/upload/v1620946647/samples/REY_PEZ_LOGO_nsotww.png"),d=(null===t||void 0===t?void 0:t.nombresMedidasPersonalizados)||{},m={content:[{columns:[{image:l,width:80,alignment:"left",margin:[0,0,0,5]},{text:"Reporte de Rendimientos",style:"header",alignment:"center",margin:[0,10,0,0]},{stack:[{text:"Fecha: "+g(t.fecha),alignment:"right",margin:[0,10,0,0]}]}]},{text:"\n",height:5},x(e,d,t),{text:"",pageBreak:"after"},C(a,d,t,s),{text:"\n",height:10},w(o,n,r,i),{text:"\n",height:10},v(a,s,n)],styles:c,...u};t.notaRendimientos&&(m.content.push({text:"\n",height:5}),m.content.push({text:"Nota:",style:"header",color:"red",alignment:"center",margin:[0,10,0,0]}),m.content.push({text:" "+t.notaRendimientos,style:"header",alignment:"center",color:"black",margin:[0,10,0,0]})),p.createPdf(m).open()}catch(l){console.error("Error al generar el PDF de rendimientos:",l)}}},"80ac":function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));a("13d5");var o=a("8baf");a("0da4");const n={Joselito:"#3498db",Catarro:"#e74c3c",Otilio:"#f39c12",Ozuna:"#27ae60",Elizabeth:"#9b59b6"};function r(e,t){const a=new o["default"];a.setFontSize(24),a.setTextColor(55,96,176),a.text("Resumen de Taras",14,20),a.setFontSize(18),a.setTextColor(0,0,0);const n=new Date(e.fecha);n.setDate(n.getDate()+1);const r=n.toLocaleDateString();a.text("Fecha: "+r,14,30),a.setFontSize(18),a.text("Carga con: "+(e.cargaCon||"No especificado"),14,40);const s=i(e,t);a.autoTable({startY:50,head:[["Cliente","Abiertas","Cerradas","Total"]],body:s.filas,foot:[["Total",s.totales.abiertas,s.totales.cerradas,s.totales.total]],theme:"grid",styles:{fontSize:18,cellPadding:8},headStyles:{fillColor:[255,255,255],textColor:[0,0,0],fontSize:20,fontStyle:"bold",halign:"center",lineWidth:1,lineColor:[0,0,0]},footStyles:{fillColor:[255,255,255],textColor:[0,0,0],fontSize:20,fontStyle:"bold",halign:"center",lineWidth:1,lineColor:[0,0,0]},bodyStyles:{fontSize:18,halign:"center"},alternateRowStyles:{fillColor:[248,249,250]},didDrawPage:function(e){const t=a.internal.pageSize,o=t.height?t.height:t.getHeight();a.setFontSize(8),a.setTextColor(55,96,176),a.text("© 2025 Rey Pez - Tampico, Tamps.",t.width/2,o-10,{align:"center"})}}),a.save("resumen-taras.pdf")}function i(e,t){const a=new Map;let o={abiertas:0,cerradas:0,total:0};const r=[{id:"1",nombre:"Joselito"},{id:"2",nombre:"Catarro"},{id:"3",nombre:"Otilio"},{id:"4",nombre:"Ozuna"},{id:"5",nombre:"Elizabeth"}];r.forEach(e=>{a.set(e.nombre,{abiertas:0,cerradas:0})}),e.productos.forEach(e=>{const t=e.clienteId.toString(),n=r.find(e=>e.id===t);if(n){const t=n.nombre,r=s(e),i=a.get(t);i.abiertas+=r,o.abiertas+=r}}),e.clienteCrudos&&Object.entries(e.clienteCrudos).forEach(([e,t])=>{const n=r.find(t=>t.id===e);if(n){const e=n.nombre,r=c(t),i=a.get(e);i.cerradas+=r,o.cerradas+=r}});const i=Array.from(a.entries()).filter(([e,t])=>t.abiertas>0||t.cerradas>0).map(([e,t])=>{const a=t.abiertas+t.cerradas;return[{content:e,styles:{textColor:n[e]||"#000000"}},t.abiertas,t.cerradas,a]});return o.total=o.abiertas+o.cerradas,{filas:i,totales:o}}function s(e){const t=(e.taras||[]).reduce((e,t)=>e+("number"===typeof t?t:0),0),a=(e.tarasExtra||[]).reduce((e,t)=>e+("number"===typeof t?t:0),0);return t+a}function c(e){return e.reduce((e,t)=>e+t.items.reduce((e,t)=>{let a=0;if(t.taras){const[e]=t.taras.split("-").map(Number);isNaN(e)||(a+=e)}if(t.sobrante){const[e]=t.sobrante.split("-").map(Number);isNaN(e)||(a+=e)}return e+a},0),0)}},f549:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var o=a("be92"),n=a("dc59"),r=a("e1bd");const i=[{username:"allan",password:"noseno"},{username:"edgar",password:"noseno"}],s=Object(o["c"])("auth",{state:()=>({user:null,isAuthenticated:!1,userId:null}),actions:{async login(e,t){try{const a=i.find(a=>a.username===e&&a.password===t);if(a){const e=Object(r["a"])();return this.userId=e,this.user={username:a.username},this.isAuthenticated=!0,Object(n["b"])(e,a.username),localStorage.setItem("user",JSON.stringify({...this.user,userId:e})),!0}return!1}catch(a){return console.error("Error en login:",a),!1}},logout(){this.user=null,this.isAuthenticated=!1,this.userId=null,localStorage.removeItem("user")},checkAuth(){try{const e=localStorage.getItem("user");if(e){const t=JSON.parse(e);this.user={username:t.username},this.userId=t.userId,this.isAuthenticated=!0,this.userId&&Object(n["b"])(this.userId,t.username)}}catch(e){console.error("Error al verificar autenticación:",e),this.logout()}}},getters:{isLoggedIn:e=>e.isAuthenticated,currentUser:e=>e.user}})},fa1c:function(e,t,a){"use strict";var o=a("c1df"),n=a.n(o);a("898b");n.a.locale("es")},fa40:function(e,t,a){"use strict";a("d9e2"),a("14d9"),a("13d5");var o=a("1494");a("fa1c");const n=e=>{if(!e)return"";let t=e.toLowerCase().trim();t=t.replace(/\b(ayer|hoy|nuevo|viejo|alt|pdf)\b/g,""),t=t.replace(/\s+/g," ").trim();const a=t.includes("c/c"),o=t.includes("s/c");let n="";return a?(n="c/c",t=t.replace(/c\/c|cc|conc/g,"").trim()):o&&(n="s/c",t=t.replace(/s\/c|sc|sinc/g,"").trim()),t=t.replace(/-/g," "),t.includes("med")&&(t.includes("gde")||t.includes("grande"))&&(t="med gde"),t.includes("med")&&(t.includes("ch")||t.includes("chica"))&&(t="med ch"),t.includes("med")&&(t.includes("esp")||t.includes("especial"))&&(t="med esp"),t.includes("med gde")||t.includes("med ch")||t.includes("med esp")||(t=t.replace(/\s+/g,"")),t=t.replace(/-/g,"/"),n&&(t=`${t} ${n}`),t=t.replace(/c\/c|cc|conc/g,"c/c"),t=t.replace(/s\/c|sc|sinc/g,"s/c"),t.includes("med gde")||t.includes("med ch")||t.includes("med esp")||(t=t.replace(/^medium$|^med$/g,"med")),t=t.replace(/^grande$|^gde$/g,"gde"),t=t.replace(/^especial$|^esp$/g,"esp"),t},r=(e,t,a=!1)=>{if(!e)return t;const o=e.toLowerCase().trim(),n=/^(\d+)-(\d+)$/.exec(o);if(n){const e=parseInt(n[1])||0,t=parseInt(n[2])||0,o=19!==t||a?t:20,r=e*o;return r}const r=o.includes("crudo");if(r&&/^\d+\*\d+(\+\d+)?$/.test(o)){const e=o.split(/[\*\+]/);if(e.length>=2){const t=parseInt(e[0])||0,a=parseInt(e[1])||0,o=19===a?20:a;let n=0;e.length>2&&(n=parseInt(e[2])||0);const r=t*o+n;return r}}return t},i=async(e,t)=>{try{const a=Object(o["h"])(),n=Object(o["c"])(a,e),r=Object(o["o"])(n,Object(o["s"])("fecha","<",t)),i=await Object(o["g"])(r);if(i.empty)return console.log("No se encontraron cuentas anteriores"),0;const s=i.docs.map(e=>{const t=e.data();return{id:e.id,fecha:t.fecha,nuevoSaldoAcumulado:t.nuevoSaldoAcumulado||0}}).sort((e,t)=>new Date(t.fecha)-new Date(e.fecha));return s.length>0?s[0].nuevoSaldoAcumulado:0}catch(a){return console.error("Error al obtener saldo acumulado anterior:",a),0}},s=async(e,t)=>{try{const a=Object(o["h"])(),n=Object(o["c"])(a,e),r=Object(o["o"])(n,Object(o["s"])("fecha","==",t)),i=await Object(o["g"])(r);return!i.empty}catch(a){throw console.error("Error al verificar si existe cuenta para la fecha:",a),a}},c=async(e,t)=>{try{const a=Object(o["h"])(),r=Object(o["c"])(a,"precios"),i=Object(o["o"])(r,Object(o["l"])("fecha","desc")),s=await Object(o["g"])(i),c=t?new Date(t):new Date,l=c.toISOString().split("T")[0],d=new Map,u=new Map,p=[];s.docs.forEach(t=>{const a=t.data(),o=new Date(a.fecha),r=o.toISOString().split("T")[0];if(r<=l){const t=a.producto,o=n(a.producto);p.push({original:t,normalizada:o,precio:a.precio,clienteId:a.clienteId||"general",fecha:r}),a.clienteId===e?u.has(o)||u.set(o,a.precio):a.clienteId||d.has(o)||d.set(o,a.precio)}}),console.log(`=== Normalización de medidas para precios (fecha embarque: ${l}) ===`),console.log("Medidas específicas para",e,":",Array.from(u.entries())),console.log("Medidas generales:",Array.from(d.entries())),console.log("Detalles de normalización:",p);const m=new Map([...d,...u]);return m}catch(a){return console.error("Error al obtener precios de venta:",a),new Map}},l=e=>{if(!e)return 0;if(e.includes("-")){const t=e.split("-");if(2===t.length)return parseInt(t[1])||0}return parseInt(e)||0},d=(e,t={},a=new Map)=>{if(!e||!Array.isArray(e))return[];const o=new Map;e.forEach(e=>{if(!e.medida)return;const t=n(e.medida);let i=0;if("c/h20"===e.tipo){const t=e.reporteTaras||[],a=e.reporteBolsas||[];for(let e=0;e<t.length;e++){const o=parseInt(t[e])||0,n=parseInt(a[e])||0;i+=o*n}i*=e.camaronNeto||.65}else if(i=Array.isArray(e.kilos)?e.kilos.reduce((e,t)=>e+(Number(t)||0),0):Number(e.kilos)||0,e.restarTaras){const t=(e.taras||[]).reduce((e,t)=>e+(Number(t)||0),0);i-=3*t}const s=e.precio||e.costo||0,c=a.get(t)||e.precioVenta||s,l=r(e.medida,i,!0);if(o.has(t)){const e=o.get(t);e.kilos+=l,e.costo=s,e.precioVenta=c,e.total=e.kilos*e.costo}else o.set(t,{kilos:l,medida:e.medida,costo:s,precioVenta:c,total:l*s})}),t&&Object.values(t).forEach(e=>{e.forEach(e=>{e.items&&Array.isArray(e.items)&&e.items.forEach(e=>{if(!e.talla)return;const t=e.talla,r=n(t);let i=0;if(e.taras){const t=/^(\d+)-(\d+(?:\.\d+)?)$/.exec(e.taras);if(t){const e=parseInt(t[1])||0;i=20*e}else i=parseInt(e.taras)||0}let s=0;e.sobrante&&e.mostrarSobrante&&(s=l(e.sobrante));const c=t.toLowerCase().includes("med c/c")&&"10-19"===e.taras&&"1-10"===e.sobrante,d=c?200:i+s,u=e.precio||0,p=a.get(r)||e.precioVenta||u;if(o.has(r)){const t=o.get(r);t.kilos+=d,e.precio&&(t.costo=u,t.precioVenta=p),t.total=t.kilos*t.costo}else o.set(r,{kilos:d,medida:t,costo:u,precioVenta:p,total:d*u})})})});const i=new Map;for(const r of o.values()){const e=n(r.medida);if(i.has(e)){const t=i.get(e);t.kilos+=r.kilos,t.costo=r.costo,t.precioVenta=r.precioVenta,t.total=t.kilos*t.costo}else i.set(e,{...r,medida:e})}return Array.from(i.values())},u=(e,t={},a=new Map)=>{if(!e||!Array.isArray(e))return[];const o=d(e,t,a),i=new Map;e.forEach(e=>{if(!e.medida)return;const t=n(e.medida);let o=0;if("c/h20"===e.tipo){const t=e.reporteTaras||[],a=e.reporteBolsas||[];for(let e=0;e<t.length;e++){const n=parseInt(t[e])||0,r=parseInt(a[e])||0;o+=n*r}o*=e.camaronNeto||.65}else if(o=Array.isArray(e.kilos)?e.kilos.reduce((e,t)=>e+(Number(t)||0),0):Number(e.kilos)||0,e.restarTaras){const t=(e.taras||[]).reduce((e,t)=>e+(Number(t)||0),0);o-=3*t}const s=a.get(t)||e.precioVenta||e.precio||0,c=r(e.medida,o,!1);if(i.has(t)){const e=i.get(t);e.kilosVenta+=c,e.precioVenta=s,e.totalVenta=e.kilosVenta*e.precioVenta}else i.set(t,{kilosVenta:c,medida:e.medida,precioVenta:s,totalVenta:c*s,ganancia:0})}),t&&Object.values(t).forEach(e=>{e.forEach(e=>{e.items&&Array.isArray(e.items)&&e.items.forEach(e=>{if(!e.talla)return;const t=e.talla,o=n(t);let r=0;if(e.taras){const t=/^(\d+)-(\d+(?:\.\d+)?)$/.exec(e.taras);if(t){const e=parseInt(t[1])||0;r=20*e}else r=parseInt(e.taras)||0}let s=0;e.sobrante&&e.mostrarSobrante&&(s=parseInt(e.sobrante.split("-").pop())||0);const c=t.toLowerCase().includes("med c/c")&&"10-19"===e.taras&&"1-10"===e.sobrante,l=c?210:r+s,d=a.get(o)||e.precioVenta||e.precio||0;if(i.has(o)){const t=i.get(o);t.kilosVenta+=l,e.precio&&(t.precioVenta=d),t.totalVenta=t.kilosVenta*t.precioVenta}else i.set(o,{kilosVenta:l,medida:t,precioVenta:d,totalVenta:l*d,ganancia:0,esCrudo:!0})})})});const s=new Map;for(const r of i.values()){const e=n(r.medida);if(s.has(e)){const t=s.get(e);t.kilosVenta+=r.kilosVenta,t.precioVenta=r.precioVenta,t.totalVenta=t.kilosVenta*t.precioVenta}else s.set(e,{...r,medida:e})}const c=Array.from(s.values());return c.forEach(e=>{const t=o.find(t=>n(t.medida)===n(e.medida));t&&(e.ganancia=e.totalVenta-t.total)}),c},p=async e=>{const{fecha:t,productos:a,clienteCrudos:o}=e,n=o&&o["1"]||[],r=await c("joselito",t),s=d(a,{1:n},r),l=u(a,{1:n},r),p=s.reduce((e,t)=>e+(t.total||0),0),m=l.reduce((e,t)=>e+(t.totalVenta||0),0),h=await i("cuentasJoselito",t);return{fecha:t,items:s,itemsVenta:l,saldoAcumuladoAnterior:h,cobros:[],abonos:[],totalGeneral:p,totalGeneralVenta:m,nuevoSaldoAcumulado:h+m,estadoPagado:!1,tieneObservacion:!1,observacion:"",ultimaActualizacion:(new Date).toISOString()}},m=async e=>{const{fecha:t,productos:a,clienteCrudos:o}=e,s=o&&o["2"]||[],d=await c("catarro",t),u=[],p=[];Array.isArray(a)&&a.forEach(e=>{if(e){let o=0;if("c/h20"===e.tipo){const t=e.reporteTaras||[],a=e.reporteBolsas||[];let n=0;for(let e=0;e<t.length;e++){const o=parseInt(t[e])||0,r=parseInt(a[e])||0;n+=o*r}o=n*(e.camaronNeto||.65)}else{var t,a;const n=(null===(t=e.kilos)||void 0===t?void 0:t.reduce((e,t)=>e+(parseFloat(t)||0),0))||0,r=(null===(a=e.taras)||void 0===a?void 0:a.reduce((e,t)=>e+(parseInt(t)||0),0))||0,i=e.restarTaras?3*r:0;o=Number((n-i).toFixed(1))}let i=e.nombreAlternativoPDF||e.medida||"";const s=n(i),c=e.precio||e.costo||0,l=e.precio||d.get(s)||0,m=r(i,o,!0),h=r(i,o,!1);o>0&&(u.push({kilos:m,medida:i,costo:c,total:m*c}),p.push({kilosVenta:h,medida:i,precioVenta:l,totalVenta:h*l,ganancia:h*l-m*c}))}}),Array.isArray(s)&&s.forEach(e=>{e&&Array.isArray(e.items)&&e.items.forEach(e=>{if(e){let t=0;if(e.taras){const a=/^(\d+)-(\d+(?:\.\d+)?)$/.exec(e.taras);if(a){const e=parseInt(a[1])||0;t=20*e}else t=parseInt(e.taras)||0}let a=0;e.sobrante&&e.mostrarSobrante&&(a=l(e.sobrante));const o=(e.talla||"").toLowerCase().includes("med c/c")&&"10-19"===e.taras&&"1-10"===e.sobrante,r=o?200:t+a,i=e.talla||"Crudo",s=n(i),c=e.precio||0,m=e.precio||d.get(s)||0;let h=0;if(e.taras){const t=/^(\d+)-(\d+(?:\.\d+)?)$/.exec(e.taras);if(t){const e=parseInt(t[1])||0;h=20*e}else h=parseInt(e.taras)||0}let f=0;e.sobrante&&e.mostrarSobrante&&(f=l(e.sobrante));const b=o?210:h+f;r>0&&(u.push({kilos:r,medida:i,costo:c,total:r*c,esCrudo:!0}),p.push({kilosVenta:b,medida:i,precioVenta:m,totalVenta:b*m,ganancia:b*m-r*c,esCrudo:!0}))}})});const m=u.reduce((e,t)=>e+(t.total||0),0),h=p.reduce((e,t)=>e+(t.totalVenta||0),0),f=await i("cuentasCatarro",t);return{fecha:t,items:u,itemsVenta:p,saldoAcumuladoAnterior:f,cobros:[],abonos:[],totalGeneral:m,totalGeneralVenta:h,nuevoSaldoAcumulado:f+h,estadoPagado:!1,tieneObservacion:!1,observacion:"",ultimaActualizacion:(new Date).toISOString()}},h=async e=>{const{fecha:t,productos:a,clienteCrudos:o}=e,r=o&&o["4"]||[],s=await c("ozuna",t),l=[];Array.isArray(a)&&a.forEach(e=>{if(e){let o=0;if("c/h20"===e.tipo){const t=e.reporteTaras||[],a=e.reporteBolsas||[];let n=0;for(let e=0;e<t.length;e++){const o=parseInt(t[e])||0,r=parseInt(a[e])||0;n+=o*r}o=n*(e.camaronNeto||.65)}else{var t,a;const n=(null===(t=e.kilos)||void 0===t?void 0:t.reduce((e,t)=>e+(parseFloat(t)||0),0))||0,r=(null===(a=e.taras)||void 0===a?void 0:a.reduce((e,t)=>e+(parseInt(t)||0),0))||0,i=e.restarTaras?3*r:0;o=Number((n-i).toFixed(1))}const r=e.medida||"";let i=0;if(e.esVenta){const t=n(r),a=s.get(t);i=parseFloat(e.precio)||a||0}else i=20;o>0&&l.push({kilos:o,medida:r,costo:i,total:o*i,esVenta:e.esVenta||!1,editando:!1,campoEditando:null})}}),Array.isArray(r)&&r.forEach(e=>{e&&Array.isArray(e.items)&&e.items.forEach(e=>{if(e){let t=0;if(e.taras){const a=/^(\d+)-(\d+)$/.exec(e.taras);if(a){const e=parseInt(a[1])||0;let o=parseInt(a[2])||0;19===o&&(o=20),t+=e*o}else{const a=e.taras.split("-").map(Number);if(a.length>=2){let e=a[1]||0;19===e&&(e=20),t+=(a[0]||0)*e}}}if(e.sobrante){const a=/^(\d+)-(\d+)$/.exec(e.sobrante);if(a){const e=parseInt(a[1])||0;let o=parseInt(a[2])||0;19===o&&(o=20),t+=e*o}else{const a=e.sobrante.split("-").map(Number);if(a.length>=2){let e=a[1]||0;19===e&&(e=20),t+=(a[0]||0)*e}}}const a=t,o=e.medida||e.talla||"Crudo",r=n(o),i=s.get(r),c=parseFloat(e.precio)||i||0;a>0&&l.push({kilos:a,medida:o,costo:c,total:a*c,esVenta:!0,editando:!1,campoEditando:null})}})});const d=l.reduce((e,t)=>e+(t.total||0),0),u=await i("cuentasOzuna",t);return{fecha:t,items:l,saldoAcumuladoAnterior:u,cobros:[],abonos:[],totalGeneral:d,totalSaldo:u+d,nuevoSaldoAcumulado:u+d,ultimaActualizacion:(new Date).toISOString()}},f=async e=>{const{fecha:t,productos:a,clienteCrudos:o}=e,s=o&&o["3"]||[],l=await c("otilio",t),d=[],u=[];Array.isArray(a)&&a.forEach(e=>{if(e){let o=0;if("c/h20"===e.tipo){const t=e.reporteTaras||[],a=e.reporteBolsas||[];let n=0;for(let e=0;e<t.length;e++){const o=parseInt(t[e])||0,r=parseInt(a[e])||0;n+=o*r}o=n*(e.camaronNeto||.65)}else{var t,a;const n=(null===(t=e.kilos)||void 0===t?void 0:t.reduce((e,t)=>e+(parseFloat(t)||0),0))||0,r=(null===(a=e.taras)||void 0===a?void 0:a.reduce((e,t)=>e+(parseInt(t)||0),0))||0,i=e.restarTaras?3*r:0;o=Number((n-i).toFixed(1))}const i=e.medida||"",s=n(i),c=20,p=parseFloat(e.precio)||l.get(s)||0,m=r(i,o,!0),h=r(i,o,!1);o>0&&(d.push({kilos:m,medida:i,costo:c,total:m*c,editando:!1,campoEditando:null}),u.push({kilosVenta:h,medida:i,precioVenta:p,totalVenta:h*p,ganancia:h*p-m*c,editando:!1,campoEditando:null}))}}),Array.isArray(s)&&s.forEach(e=>{e&&Array.isArray(e.items)&&e.items.forEach(e=>{if(e){let t=0;if(e.taras){const a=/^(\d+)-(\d+)$/.exec(e.taras);if(a){const e=parseInt(a[1])||0;let o=parseInt(a[2])||0;19===o&&(o=20),t+=e*o}else{const a=e.taras.split("-").map(Number);if(a.length>=2){let e=a[1]||0;19===e&&(e=20),t+=(a[0]||0)*e}}}if(e.sobrante){const a=/^(\d+)-(\d+)$/.exec(e.sobrante);if(a){const e=parseInt(a[1])||0;let o=parseInt(a[2])||0;19===o&&(o=20),t+=e*o}else{const a=e.sobrante.split("-").map(Number);if(a.length>=2){let e=a[1]||0;19===e&&(e=20),t+=(a[0]||0)*e}}}const a=t,o=t,r=e.medida||e.talla||"Crudo",i=n(r),s=20,c=parseFloat(e.precio)||l.get(i)||0;a>0&&(d.push({kilos:a,medida:r,costo:s,total:a*s,esCrudo:!0,editando:!1,campoEditando:null}),u.push({kilosVenta:o,medida:r,precioVenta:c,totalVenta:o*c,ganancia:o*c-a*s,esCrudo:!0,editando:!1,campoEditando:null}))}})});const p=d.reduce((e,t)=>e+(t.total||0),0),m=u.reduce((e,t)=>e+(t.totalVenta||0),0),h=await i("cuentasOtilio",t);return{fecha:t,items:d,itemsVenta:u,saldoAcumuladoAnterior:h,cobros:[],abonos:[],totalGeneral:p,totalGeneralVenta:m,nuevoSaldoAcumulado:h+m,estadoPagado:!1,tieneObservacion:!1,observacion:"",ultimaActualizacion:(new Date).toISOString()}},b=async(e,t)=>{try{console.log("Iniciando creación de cuenta Joselito desde embarque");const a=await s("cuentasJoselito",e.fecha);if(a)throw new Error("Ya existe una cuenta de Joselito registrada para esta fecha.");const n=await p(e),r=Object(o["h"])(),i=await Object(o["b"])(Object(o["c"])(r,"cuentasJoselito"),n);if(console.log("Cuenta de Joselito creada con ID:",i.id),t){const e=`${window.location.origin}/cuentas-joselito/${i.id}?edit=true`;window.open(e,"_blank")}return i.id}catch(a){throw console.error("Error al crear cuenta de Joselito:",a),a}},g=async(e,t)=>{try{console.log("Iniciando creación de cuenta Catarro desde embarque");const a=await s("cuentasCatarro",e.fecha);if(a)throw new Error("Ya existe una cuenta de Catarro registrada para esta fecha.");const n=await m(e),r=Object(o["h"])(),i=await Object(o["b"])(Object(o["c"])(r,"cuentasCatarro"),n);if(console.log("Cuenta de Catarro creada con ID:",i.id),t){const e=`${window.location.origin}/cuentas-catarro/${i.id}?edit=true`;window.open(e,"_blank")}return i.id}catch(a){throw console.error("Error al crear cuenta de Catarro:",a),a}},y=async(e,t)=>{try{console.log("Iniciando creación de cuenta Ozuna desde embarque");const a=await s("cuentasOzuna",e.fecha);if(a)throw new Error("Ya existe una cuenta de Ozuna registrada para esta fecha.");const n=await h(e),r=Object(o["h"])(),i=await Object(o["b"])(Object(o["c"])(r,"cuentasOzuna"),n);if(console.log("Cuenta de Ozuna creada con ID:",i.id),t){const e=`${window.location.origin}/cuentas-ozuna/${i.id}?edit=true`;window.open(e,"_blank")}return i.id}catch(a){throw console.error("Error al crear cuenta de Ozuna:",a),a}},x=async(e,t)=>{try{console.log("Iniciando creación de cuenta Otilio desde embarque");const a=await s("cuentasOtilio",e.fecha);if(a)throw new Error("Ya existe una cuenta de Otilio registrada para esta fecha.");const n=await f(e),r=Object(o["h"])(),i=await Object(o["b"])(Object(o["c"])(r,"cuentasOtilio"),n);if(console.log("Cuenta de Otilio creada con ID:",i.id),t){const e=`${window.location.origin}/cuentas-otilio/${i.id}?edit=true`;window.open(e,"_blank")}return i.id}catch(a){throw console.error("Error al crear cuenta de Otilio:",a),a}};t["a"]={crearCuentaJoselito:b,crearCuentaCatarro:g,crearCuentaOzuna:y,crearCuentaOtilio:x}}}]);