(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["app.29f3534c"],{"05af":function(a,o,t){"use strict";var e=function(){var a=this,o=a._self._c;return o("div",{staticClass:"procesos-menu"},[a._m(0),o("div",{staticClass:"menu-options"},[o("router-link",{staticClass:"btn-action btn-pedidos",attrs:{to:"/procesos/pedidos","aria-label":"Gestionar pedidos"}},[o("i",{staticClass:"icon"},[a._v("üìù")]),o("span",[a._v("Pedidos")])]),o("router-link",{staticClass:"btn-action btn-preparacion",attrs:{to:"/procesos/preparacion","aria-label":"Gestionar preparaci√≥n"}},[o("i",{staticClass:"icon"},[a._v("üë®‚Äçüç≥")]),o("span",[a._v("Preparaci√≥n")])]),o("router-link",{staticClass:"btn-action btn-bitacoras",attrs:{to:"/procesos/bitacoras","aria-label":"Ver bit√°coras de mantenimiento"}},[o("i",{staticClass:"icon"},[a._v("üìã")]),o("span",[a._v("Bit√°coras")])]),o("router-link",{staticClass:"btn-action btn-deudas",attrs:{to:"/procesos/deudas","aria-label":"Gestionar deudas"}},[o("i",{staticClass:"icon"},[a._v("üí∞")]),o("span",[a._v("Deudas")])]),o("router-link",{staticClass:"btn-action btn-prestamos",attrs:{to:"/procesos/prestamos","aria-label":"Gestionar pr√©stamos"}},[o("i",{staticClass:"icon"},[a._v("üè¶")]),o("span",[a._v("Pr√©stamos")])])],1)])},s=[function(){var a=this,o=a._self._c;return o("div",{staticClass:"header-section"},[o("div",{staticClass:"header-content"},[o("h1",{staticClass:"main-title"},[o("i",{staticClass:"icon-process"},[a._v("‚öôÔ∏è")]),a._v(" Men√∫ de Procesos ")]),o("p",{staticClass:"subtitle"},[a._v("Gestiona todos los procesos de tu negocio de manera eficiente")])])])}],r={name:"ProcesosMenu"},i=r,n=(t("3964"),t("2877")),c=Object(n["a"])(i,e,s,!1,null,"53527424",null);o["a"]=c.exports},"2c81":function(a,o,t){"use strict";t("fbd0")},"2edd":function(a,o,t){"use strict";var e=function(){var a,o,t,e,s,r,i,n,c,d,l=this,m=l._self._c;return m("div",{staticClass:"prestamos-trabajadores-container"},[m("div",{staticClass:"back-button-container"},[m("BackButton",{attrs:{to:"/procesos/prestamos"}})],1),m("h1",[l._v("Pr√©stamos a Trabajadores")]),m("div",{staticClass:"filtros-container"},[m("div",{staticClass:"filtro"},[m("label",{attrs:{for:"filtroTrabajador"}},[l._v("Trabajador:")]),m("select",{directives:[{name:"model",rawName:"v-model",value:l.filtroTrabajador,expression:"filtroTrabajador"}],attrs:{id:"filtroTrabajador"},on:{change:function(a){var o=Array.prototype.filter.call(a.target.options,(function(a){return a.selected})).map((function(a){var o="_value"in a?a._value:a.value;return o}));l.filtroTrabajador=a.target.multiple?o:o[0]}}},[m("option",{attrs:{value:""}},[l._v("Todos")]),l._l(l.trabajadores,(function(a){return m("option",{key:a.id,domProps:{value:a.id}},[l._v(" "+l._s(a.nombre)+" ")])}))],2)]),m("div",{staticClass:"filtro"},[m("label",{attrs:{for:"filtroEstado"}},[l._v("Estado:")]),m("select",{directives:[{name:"model",rawName:"v-model",value:l.filtroEstado,expression:"filtroEstado"}],attrs:{id:"filtroEstado"},on:{change:function(a){var o=Array.prototype.filter.call(a.target.options,(function(a){return a.selected})).map((function(a){var o="_value"in a?a._value:a.value;return o}));l.filtroEstado=a.target.multiple?o:o[0]}}},[m("option",{attrs:{value:""}},[l._v("Todos")]),m("option",{attrs:{value:"activo"}},[l._v("Activo")]),m("option",{attrs:{value:"pagado"}},[l._v("Pagado")])])]),m("div",{staticClass:"filtro-fecha"},[m("label",[l._v("Fecha:")]),m("div",{staticClass:"fecha-inputs"},[m("input",{directives:[{name:"model",rawName:"v-model",value:l.filtroFechaDesde,expression:"filtroFechaDesde"}],attrs:{type:"date",placeholder:"Desde"},domProps:{value:l.filtroFechaDesde},on:{input:function(a){a.target.composing||(l.filtroFechaDesde=a.target.value)}}}),m("span",[l._v("a")]),m("input",{directives:[{name:"model",rawName:"v-model",value:l.filtroFechaHasta,expression:"filtroFechaHasta"}],attrs:{type:"date",placeholder:"Hasta"},domProps:{value:l.filtroFechaHasta},on:{input:function(a){a.target.composing||(l.filtroFechaHasta=a.target.value)}}})])])]),m("div",{staticClass:"resumen-container"},[m("div",{staticClass:"resumen-card activos"},[m("h3",[l._v("Pr√©stamos Activos")]),m("p",[l._v(l._s(l.prestamosActivos))])]),m("div",{staticClass:"resumen-card pendiente"},[m("h3",[l._v("Saldo Pendiente")]),m("p",[l._v("$"+l._s(l.formatNumber(l.totalPendiente)))])])]),m("div",{staticClass:"acciones-container"},[m("button",{staticClass:"btn-nuevo-prestamo",on:{click:l.mostrarModalNuevoPrestamo}},[m("i",{staticClass:"fas fa-plus"}),l._v(" Nuevo Pr√©stamo ")]),m("button",{staticClass:"btn-nuevo-trabajador",on:{click:l.mostrarModalNuevoTrabajador}},[m("i",{staticClass:"fas fa-user-plus"}),l._v(" Nuevo Trabajador ")])]),l.cargando?m("div",{staticClass:"loading-spinner"},[m("div",{staticClass:"spinner"}),m("p",[l._v("Cargando pr√©stamos...")])]):0===l.prestamos.length?m("div",{staticClass:"no-data"},[m("p",[l._v("No hay pr√©stamos registrados.")]),m("button",{staticClass:"btn-nuevo-prestamo",on:{click:l.mostrarModalNuevoPrestamo}},[l._v(" Crear Nuevo Pr√©stamo ")])]):m("div",{staticClass:"tabla-container"},[m("table",{staticClass:"tabla-prestamos"},[l._m(0),m("tbody",l._l(l.prestamosFiltrados,(function(a){return m("tr",{key:a.id,class:{"prestamo-pagado":"pagado"===a.estado}},[m("td",[l._v(l._s(l.formatearFecha(a.fecha)))]),m("td",[l._v(l._s(a.trabajadorNombre))]),m("td",[l._v("$"+l._s(l.formatNumber(a.montoInicial)))]),m("td",[l._v("$"+l._s(l.formatNumber(a.saldoPendiente)))]),m("td",[m("span",{class:"estado-badge "+a.estado},[l._v(" "+l._s("activo"===a.estado?"Activo":"Pagado")+" ")])]),m("td",{staticClass:"acciones"},[m("button",{staticClass:"btn-detalle",attrs:{title:"Ver detalles"},on:{click:function(o){return l.verDetalle(a)}}},[m("i",{staticClass:"fas fa-eye"})]),m("button",{staticClass:"btn-abono",attrs:{disabled:"pagado"===a.estado,title:"Agregar abono"},on:{click:function(o){return l.agregarAbono(a)}}},[m("i",{staticClass:"fas fa-money-bill"})]),m("button",{staticClass:"btn-eliminar",attrs:{title:"Eliminar pr√©stamo"},on:{click:function(o){return l.eliminarPrestamo(a)}}},[m("i",{staticClass:"fas fa-trash-alt"})])])])})),0)])]),l.showModalNuevoPrestamo?m("div",{staticClass:"modal-overlay",on:{click:l.closeModalOnOverlay}},[m("div",{staticClass:"modal-content",on:{click:function(a){a.stopPropagation()}}},[m("div",{staticClass:"modal-header"},[m("h2",[l._v("Nuevo Pr√©stamo a Trabajador")]),m("button",{staticClass:"close-button",on:{click:function(a){l.showModalNuevoPrestamo=!1}}},[l._v("√ó")])]),m("div",{staticClass:"modal-body"},[m("form",{staticClass:"form-prestamo",on:{submit:function(a){return a.preventDefault(),l.guardarNuevoPrestamo.apply(null,arguments)}}},[m("div",{staticClass:"form-group"},[m("label",{attrs:{for:"trabajadorSelect"}},[l._v("Trabajador:")]),m("select",{directives:[{name:"model",rawName:"v-model",value:l.nuevoPrestamo.trabajadorId,expression:"nuevoPrestamo.trabajadorId"}],attrs:{id:"trabajadorSelect",required:""},on:{change:function(a){var o=Array.prototype.filter.call(a.target.options,(function(a){return a.selected})).map((function(a){var o="_value"in a?a._value:a.value;return o}));l.$set(l.nuevoPrestamo,"trabajadorId",a.target.multiple?o:o[0])}}},[m("option",{attrs:{value:""}},[l._v("Seleccionar trabajador")]),l._l(l.trabajadores,(function(a){return m("option",{key:a.id,domProps:{value:a.id}},[l._v(" "+l._s(a.nombre)+" ")])}))],2)]),m("div",{staticClass:"form-group"},[m("label",{attrs:{for:"fechaPrestamo"}},[l._v("Fecha:")]),m("input",{directives:[{name:"model",rawName:"v-model",value:l.nuevoPrestamo.fecha,expression:"nuevoPrestamo.fecha"}],attrs:{id:"fechaPrestamo",type:"date",required:""},domProps:{value:l.nuevoPrestamo.fecha},on:{input:function(a){a.target.composing||l.$set(l.nuevoPrestamo,"fecha",a.target.value)}}})]),m("div",{staticClass:"form-group"},[m("label",{attrs:{for:"montoPrestamo"}},[l._v("Monto:")]),m("input",{directives:[{name:"model",rawName:"v-model.number",value:l.nuevoPrestamo.monto,expression:"nuevoPrestamo.monto",modifiers:{number:!0}}],attrs:{id:"montoPrestamo",type:"number",required:"",min:"1",step:"0.01"},domProps:{value:l.nuevoPrestamo.monto},on:{input:function(a){a.target.composing||l.$set(l.nuevoPrestamo,"monto",l._n(a.target.value))},blur:function(a){return l.$forceUpdate()}}})]),m("div",{staticClass:"form-group"},[m("label",{attrs:{for:"descripcionPrestamo"}},[l._v("Descripci√≥n:")]),m("textarea",{directives:[{name:"model",rawName:"v-model",value:l.nuevoPrestamo.descripcion,expression:"nuevoPrestamo.descripcion"}],attrs:{id:"descripcionPrestamo",rows:"3",placeholder:"Descripci√≥n del pr√©stamo (opcional)"},domProps:{value:l.nuevoPrestamo.descripcion},on:{input:function(a){a.target.composing||l.$set(l.nuevoPrestamo,"descripcion",a.target.value)}}})]),m("div",{staticClass:"form-actions"},[m("button",{staticClass:"btn-cancelar",attrs:{type:"button"},on:{click:function(a){l.showModalNuevoPrestamo=!1}}},[l._v("Cancelar")]),m("button",{staticClass:"btn-guardar",attrs:{type:"submit",disabled:l.guardando}},[l._v(" "+l._s(l.guardando?"Guardando...":"Guardar Pr√©stamo")+" ")])])])])])]):l._e(),l.showModalNuevoTrabajador?m("div",{staticClass:"modal-overlay",on:{click:l.closeModalOnOverlay}},[m("div",{staticClass:"modal-content",on:{click:function(a){a.stopPropagation()}}},[m("div",{staticClass:"modal-header"},[m("h2",[l._v("Nuevo Trabajador")]),m("button",{staticClass:"close-button",on:{click:function(a){l.showModalNuevoTrabajador=!1}}},[l._v("√ó")])]),m("div",{staticClass:"modal-body"},[m("form",{staticClass:"form-trabajador",on:{submit:function(a){return a.preventDefault(),l.guardarNuevoTrabajador.apply(null,arguments)}}},[m("div",{staticClass:"form-group"},[m("label",{attrs:{for:"nombreTrabajador"}},[l._v("Nombre:")]),m("input",{directives:[{name:"model",rawName:"v-model",value:l.nuevoTrabajador.nombre,expression:"nuevoTrabajador.nombre"}],attrs:{id:"nombreTrabajador",type:"text",required:"",placeholder:"Nombre completo del trabajador"},domProps:{value:l.nuevoTrabajador.nombre},on:{input:function(a){a.target.composing||l.$set(l.nuevoTrabajador,"nombre",a.target.value)}}})]),m("div",{staticClass:"form-group"},[m("label",{attrs:{for:"contactoTrabajador"}},[l._v("Contacto:")]),m("input",{directives:[{name:"model",rawName:"v-model",value:l.nuevoTrabajador.contacto,expression:"nuevoTrabajador.contacto"}],attrs:{id:"contactoTrabajador",type:"text",placeholder:"Tel√©fono o email (opcional)"},domProps:{value:l.nuevoTrabajador.contacto},on:{input:function(a){a.target.composing||l.$set(l.nuevoTrabajador,"contacto",a.target.value)}}})]),m("div",{staticClass:"form-group"},[m("label",{attrs:{for:"puestoTrabajador"}},[l._v("Puesto:")]),m("input",{directives:[{name:"model",rawName:"v-model",value:l.nuevoTrabajador.puesto,expression:"nuevoTrabajador.puesto"}],attrs:{id:"puestoTrabajador",type:"text",placeholder:"Puesto de trabajo (opcional)"},domProps:{value:l.nuevoTrabajador.puesto},on:{input:function(a){a.target.composing||l.$set(l.nuevoTrabajador,"puesto",a.target.value)}}})]),m("div",{staticClass:"form-actions"},[m("button",{staticClass:"btn-cancelar",attrs:{type:"button"},on:{click:function(a){l.showModalNuevoTrabajador=!1}}},[l._v("Cancelar")]),m("button",{staticClass:"btn-guardar",attrs:{type:"submit",disabled:l.guardando}},[l._v(" "+l._s(l.guardando?"Guardando...":"Guardar Trabajador")+" ")])])])])])]):l._e(),l.showDetalleModal?m("div",{staticClass:"modal-overlay",on:{click:l.closeModalOnOverlay}},[m("div",{staticClass:"modal-content modal-large",on:{click:function(a){a.stopPropagation()}}},[m("div",{staticClass:"modal-header"},[m("h2",[l._v("Detalle del Pr√©stamo")]),m("button",{staticClass:"close-button",on:{click:function(a){l.showDetalleModal=!1}}},[l._v("√ó")])]),m("div",{staticClass:"modal-body"},[m("div",{staticClass:"prestamo-info"},[m("div",{staticClass:"info-grid"},[m("div",{staticClass:"info-item"},[m("strong",[l._v("Trabajador:")]),m("span",[l._v(l._s(null===(a=l.prestamoSeleccionado)||void 0===a?void 0:a.trabajadorNombre))])]),m("div",{staticClass:"info-item"},[m("strong",[l._v("Fecha:")]),m("span",[l._v(l._s(l.formatearFecha(null===(o=l.prestamoSeleccionado)||void 0===o?void 0:o.fecha)))])]),m("div",{staticClass:"info-item"},[m("strong",[l._v("Monto Inicial:")]),m("span",[l._v("$"+l._s(l.formatNumber(null===(t=l.prestamoSeleccionado)||void 0===t?void 0:t.montoInicial)))])]),m("div",{staticClass:"info-item"},[m("strong",[l._v("Estado:")]),m("span",{class:"estado-badge "+(null===(e=l.prestamoSeleccionado)||void 0===e?void 0:e.estado)},[l._v(" "+l._s("activo"===(null===(s=l.prestamoSeleccionado)||void 0===s?void 0:s.estado)?"Activo":"Pagado")+" ")])])]),null!==(r=l.prestamoSeleccionado)&&void 0!==r&&r.descripcion?m("div",{staticClass:"descripcion"},[m("strong",[l._v("Descripci√≥n:")]),m("p",[l._v(l._s(l.prestamoSeleccionado.descripcion))])]):l._e()]),m("h3",[l._v("Historial de Abonos")]),0===l.abonos.length?m("div",{staticClass:"no-abonos"},[m("p",[l._v("No hay abonos registrados para este pr√©stamo.")])]):m("table",{staticClass:"tabla-abonos"},[l._m(1),m("tbody",l._l(l.abonos,(function(a,o){return m("tr",{key:o},[m("td",[l._v(l._s(l.formatearFecha(a.fecha)))]),m("td",[l._v(l._s(a.descripcion))]),m("td",[l._v("$"+l._s(l.formatNumber(a.monto)))]),m("td",[m("button",{staticClass:"btn-eliminar-sm",on:{click:function(a){return l.eliminarAbono(o)}}},[m("i",{staticClass:"fas fa-trash-alt"})])])])})),0),m("tfoot",[m("tr",[m("td",{staticClass:"total-label",attrs:{colspan:"2"}},[l._v("Total Abonos")]),m("td",[l._v("$"+l._s(l.formatNumber(l.totalAbonos)))]),m("td")])])]),m("div",{staticClass:"resumen-prestamo"},[m("div",{staticClass:"resumen-item"},[m("span",[l._v("Monto inicial:")]),m("span",[l._v("$"+l._s(l.formatNumber(null===(i=l.prestamoSeleccionado)||void 0===i?void 0:i.montoInicial)))])]),m("div",{staticClass:"resumen-item"},[m("span",[l._v("Total abonos:")]),m("span",[l._v("$"+l._s(l.formatNumber(l.totalAbonos)))])]),m("div",{staticClass:"resumen-item total"},[m("span",[l._v("Saldo pendiente:")]),m("span",[l._v("$"+l._s(l.formatNumber(l.calcularSaldoPendiente())))])])])])])]):l._e(),l.showAbonoModal?m("div",{staticClass:"modal-overlay",on:{click:l.closeModalOnOverlay}},[m("div",{staticClass:"modal-content",on:{click:function(a){a.stopPropagation()}}},[m("div",{staticClass:"modal-header"},[m("h2",[l._v("Agregar Abono")]),m("button",{staticClass:"close-button",on:{click:function(a){l.showAbonoModal=!1}}},[l._v("√ó")])]),m("div",{staticClass:"modal-body"},[m("div",{staticClass:"prestamo-info"},[m("p",[m("strong",[l._v("Trabajador:")]),l._v(" "+l._s(null===(n=l.prestamoSeleccionado)||void 0===n?void 0:n.trabajadorNombre))]),m("p",[m("strong",[l._v("Saldo Pendiente:")]),l._v(" $"+l._s(l.formatNumber(null===(c=l.prestamoSeleccionado)||void 0===c?void 0:c.saldoPendiente)))])]),m("form",{staticClass:"form-abono",on:{submit:function(a){return a.preventDefault(),l.guardarAbono.apply(null,arguments)}}},[m("div",{staticClass:"form-group"},[m("label",{attrs:{for:"fechaAbono"}},[l._v("Fecha:")]),m("input",{directives:[{name:"model",rawName:"v-model",value:l.nuevoAbono.fecha,expression:"nuevoAbono.fecha"}],attrs:{id:"fechaAbono",type:"date",required:""},domProps:{value:l.nuevoAbono.fecha},on:{input:function(a){a.target.composing||l.$set(l.nuevoAbono,"fecha",a.target.value)}}})]),m("div",{staticClass:"form-group"},[m("label",{attrs:{for:"descripcionAbono"}},[l._v("Descripci√≥n:")]),m("input",{directives:[{name:"model",rawName:"v-model",value:l.nuevoAbono.descripcion,expression:"nuevoAbono.descripcion"}],attrs:{id:"descripcionAbono",type:"text",required:"",placeholder:"Ej: Descuento de n√≥mina, Pago efectivo, etc."},domProps:{value:l.nuevoAbono.descripcion},on:{input:function(a){a.target.composing||l.$set(l.nuevoAbono,"descripcion",a.target.value)}}})]),m("div",{staticClass:"form-group"},[m("label",{attrs:{for:"montoAbono"}},[l._v("Monto:")]),m("input",{directives:[{name:"model",rawName:"v-model.number",value:l.nuevoAbono.monto,expression:"nuevoAbono.monto",modifiers:{number:!0}}],attrs:{id:"montoAbono",type:"number",required:"",min:"1",max:null===(d=l.prestamoSeleccionado)||void 0===d?void 0:d.saldoPendiente,step:"0.01"},domProps:{value:l.nuevoAbono.monto},on:{input:function(a){a.target.composing||l.$set(l.nuevoAbono,"monto",l._n(a.target.value))},blur:function(a){return l.$forceUpdate()}}})]),m("div",{staticClass:"form-actions"},[m("button",{staticClass:"btn-cancelar",attrs:{type:"button"},on:{click:function(a){l.showAbonoModal=!1}}},[l._v("Cancelar")]),m("button",{staticClass:"btn-guardar",attrs:{type:"submit",disabled:l.guardando}},[l._v(" "+l._s(l.guardando?"Guardando...":"Guardar Abono")+" ")])])])])])]):l._e()])},s=[function(){var a=this,o=a._self._c;return o("thead",[o("tr",[o("th",[a._v("Fecha")]),o("th",[a._v("Trabajador")]),o("th",[a._v("Monto Inicial")]),o("th",[a._v("Saldo Pendiente")]),o("th",[a._v("Estado")]),o("th",[a._v("Acciones")])])])},function(){var a=this,o=a._self._c;return o("thead",[o("tr",[o("th",[a._v("Fecha")]),o("th",[a._v("Descripci√≥n")]),o("th",[a._v("Monto")]),o("th",[a._v("Acciones")])])])}],r=(t("13d5"),t("dc59")),i=t("1494"),n=t("74c9"),c={name:"PrestamosTrabajadores",components:{BackButton:n["a"]},data(){return{prestamos:[],trabajadores:[],abonos:[],cargando:!0,guardando:!1,filtroTrabajador:"",filtroEstado:"",filtroFechaDesde:"",filtroFechaHasta:"",showModalNuevoPrestamo:!1,showModalNuevoTrabajador:!1,showDetalleModal:!1,showAbonoModal:!1,prestamoSeleccionado:null,nuevoPrestamo:{trabajadorId:"",fecha:"",monto:null,descripcion:""},nuevoTrabajador:{nombre:"",contacto:"",puesto:""},nuevoAbono:{fecha:"",descripcion:"",monto:null}}},computed:{prestamosFiltrados(){return this.prestamos.filter(a=>(!this.filtroTrabajador||a.trabajadorId===this.filtroTrabajador)&&((!this.filtroEstado||a.estado===this.filtroEstado)&&(!(this.filtroFechaDesde&&a.fecha<this.filtroFechaDesde)&&!(this.filtroFechaHasta&&a.fecha>this.filtroFechaHasta))))},prestamosActivos(){return this.prestamosFiltrados.filter(a=>"activo"===a.estado).length},totalPendiente(){return this.prestamosFiltrados.reduce((a,o)=>a+o.saldoPendiente,0)},totalAbonos(){return this.abonos.reduce((a,o)=>a+o.monto,0)}},methods:{obtenerFechaActual(){const a=new Date;return a.toISOString().split("T")[0]},formatNumber(a){return a?a.toLocaleString("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00"},formatearFecha(a){if(!a)return"";const o=new Date(a+"T00:00:00"),t={year:"numeric",month:"long",day:"numeric"};return o.toLocaleDateString("es-ES",t)},async cargarPrestamos(){try{this.cargando=!0;const a=await Object(i["g"])(Object(i["o"])(Object(i["c"])(r["a"],"prestamosTrabajadores"),Object(i["l"])("fechaCreacion","desc")));this.prestamos=a.docs.map(a=>({id:a.id,...a.data()}))}catch(a){console.error("Error al cargar pr√©stamos: ",a)}finally{this.cargando=!1}},async cargarTrabajadores(){try{const a=await Object(i["g"])(Object(i["c"])(r["a"],"trabajadores"));this.trabajadores=a.docs.map(a=>({id:a.id,...a.data()}))}catch(a){console.error("Error al cargar trabajadores: ",a)}},mostrarModalNuevoPrestamo(){this.nuevoPrestamo={trabajadorId:"",fecha:this.obtenerFechaActual(),monto:null,descripcion:""},this.showModalNuevoPrestamo=!0},mostrarModalNuevoTrabajador(){this.nuevoTrabajador={nombre:"",contacto:"",puesto:""},this.showModalNuevoTrabajador=!0},async guardarNuevoPrestamo(){if(this.nuevoPrestamo.trabajadorId&&this.nuevoPrestamo.monto)try{this.guardando=!0;const a=this.trabajadores.find(a=>a.id===this.nuevoPrestamo.trabajadorId);await Object(i["b"])(Object(i["c"])(r["a"],"prestamosTrabajadores"),{trabajadorId:this.nuevoPrestamo.trabajadorId,trabajadorNombre:a.nombre,fecha:this.nuevoPrestamo.fecha,montoInicial:this.nuevoPrestamo.monto,saldoPendiente:this.nuevoPrestamo.monto,descripcion:this.nuevoPrestamo.descripcion,estado:"activo",fechaCreacion:new Date}),this.showModalNuevoPrestamo=!1,await this.cargarPrestamos(),alert("Pr√©stamo registrado correctamente")}catch(a){console.error("Error al guardar pr√©stamo: ",a),alert("Error al guardar pr√©stamo: "+a.message)}finally{this.guardando=!1}else alert("Por favor complete todos los campos requeridos")},async guardarNuevoTrabajador(){if(this.nuevoTrabajador.nombre)try{this.guardando=!0,await Object(i["b"])(Object(i["c"])(r["a"],"trabajadores"),{nombre:this.nuevoTrabajador.nombre,contacto:this.nuevoTrabajador.contacto,puesto:this.nuevoTrabajador.puesto,fechaCreacion:new Date}),this.showModalNuevoTrabajador=!1,await this.cargarTrabajadores(),alert("Trabajador registrado correctamente")}catch(a){console.error("Error al guardar trabajador: ",a),alert("Error al guardar trabajador: "+a.message)}finally{this.guardando=!1}else alert("Por favor ingrese el nombre del trabajador")},async verDetalle(a){this.prestamoSeleccionado=a,this.abonos=[];try{const o=await Object(i["g"])(Object(i["o"])(Object(i["c"])(r["a"],"prestamosTrabajadores",a.id,"abonos"),Object(i["l"])("fechaCreacion","desc")));this.abonos=o.docs.map(a=>({id:a.id,...a.data()})),this.showDetalleModal=!0}catch(o){console.error("Error al cargar detalle del pr√©stamo: ",o)}},agregarAbono(a){this.prestamoSeleccionado=a,this.nuevoAbono={fecha:this.obtenerFechaActual(),descripcion:"",monto:null},this.showAbonoModal=!0},async guardarAbono(){if(this.nuevoAbono.descripcion&&this.nuevoAbono.monto)if(this.nuevoAbono.monto<=0)alert("El monto del abono debe ser mayor a cero");else if(this.nuevoAbono.monto>this.prestamoSeleccionado.saldoPendiente)alert("El monto del abono no puede ser mayor al saldo pendiente");else try{this.guardando=!0,await Object(i["b"])(Object(i["c"])(r["a"],"prestamosTrabajadores",this.prestamoSeleccionado.id,"abonos"),{descripcion:this.nuevoAbono.descripcion,monto:this.nuevoAbono.monto,fecha:this.nuevoAbono.fecha,fechaCreacion:new Date});const a=this.prestamoSeleccionado.saldoPendiente-this.nuevoAbono.monto,o=a<=0?"pagado":"activo";await Object(i["r"])(Object(i["e"])(r["a"],"prestamosTrabajadores",this.prestamoSeleccionado.id),{saldoPendiente:a,estado:o}),this.prestamos=this.prestamos.map(t=>t.id===this.prestamoSeleccionado.id?{...t,saldoPendiente:a,estado:o}:t),this.prestamoSeleccionado.saldoPendiente=a,this.prestamoSeleccionado.estado=o,this.showAbonoModal=!1,alert("Abono registrado correctamente")}catch(a){console.error("Error al guardar abono: ",a),alert("Error al guardar abono: "+a.message)}finally{this.guardando=!1}else alert("Por favor complete todos los campos del abono")},async eliminarPrestamo(a){if(confirm(`¬øEst√° seguro que desea eliminar el pr√©stamo de ${a.trabajadorNombre}? Esta acci√≥n no se puede deshacer.`))try{this.cargando=!0;const o=await Object(i["g"])(Object(i["c"])(r["a"],"prestamosTrabajadores",a.id,"abonos")),t=Object(i["t"])(r["a"]);o.forEach(o=>{t.delete(Object(i["e"])(r["a"],"prestamosTrabajadores",a.id,"abonos",o.id))}),await t.commit(),await Object(i["d"])(Object(i["e"])(r["a"],"prestamosTrabajadores",a.id)),this.prestamos=this.prestamos.filter(o=>o.id!==a.id),alert("Pr√©stamo eliminado correctamente")}catch(o){console.error("Error al eliminar el pr√©stamo: ",o),alert("Error al eliminar el pr√©stamo: "+o.message)}finally{this.cargando=!1}},async eliminarAbono(a){if(!confirm("¬øEst√° seguro de eliminar este abono?"))return;const o=this.abonos[a];try{this.guardando=!0,await Object(i["d"])(Object(i["e"])(r["a"],"prestamosTrabajadores",this.prestamoSeleccionado.id,"abonos",o.id)),this.abonos.splice(a,1);const t=this.calcularSaldoPendiente();await Object(i["r"])(Object(i["e"])(r["a"],"prestamosTrabajadores",this.prestamoSeleccionado.id),{saldoPendiente:t,estado:t<=0?"pagado":"activo"}),this.prestamos=this.prestamos.map(a=>a.id===this.prestamoSeleccionado.id?{...a,saldoPendiente:t,estado:t<=0?"pagado":"activo"}:a),this.prestamoSeleccionado.saldoPendiente=t,this.prestamoSeleccionado.estado=t<=0?"pagado":"activo"}catch(t){console.error("Error al eliminar abono: ",t),alert("Error al eliminar abono: "+t.message)}finally{this.guardando=!1}},calcularSaldoPendiente(){var a;return(null===(a=this.prestamoSeleccionado)||void 0===a?void 0:a.montoInicial)-this.totalAbonos},closeModalOnOverlay(a){a.target===a.currentTarget&&(this.showModalNuevoPrestamo=!1,this.showModalNuevoTrabajador=!1,this.showDetalleModal=!1,this.showAbonoModal=!1)}},async mounted(){await Promise.all([this.cargarPrestamos(),this.cargarTrabajadores()])}},d=c,l=(t("df16"),t("2877")),m=Object(l["a"])(d,e,s,!1,null,"cb5b75e2",null);o["a"]=m.exports},"31a2":function(a,o,t){},3964:function(a,o,t){"use strict";t("31a2")},"5ac3":function(a,o,t){"use strict";t("bf77")},"767f":function(a,o,t){"use strict";var e=function(){var a,o,t,e,s,r,i,n,c,d,l=this,m=l._self._c;return m("div",{staticClass:"prestamos-despicadoras-container"},[m("div",{staticClass:"back-button-container"},[m("BackButton",{attrs:{to:"/procesos/prestamos"}})],1),m("h1",[l._v("Pr√©stamos a Despicadoras")]),m("div",{staticClass:"filtros-container"},[m("div",{staticClass:"filtro"},[m("label",{attrs:{for:"filtroDespicadora"}},[l._v("Despicadora:")]),m("select",{directives:[{name:"model",rawName:"v-model",value:l.filtroDespicadora,expression:"filtroDespicadora"}],attrs:{id:"filtroDespicadora"},on:{change:function(a){var o=Array.prototype.filter.call(a.target.options,(function(a){return a.selected})).map((function(a){var o="_value"in a?a._value:a.value;return o}));l.filtroDespicadora=a.target.multiple?o:o[0]}}},[m("option",{attrs:{value:""}},[l._v("Todas")]),l._l(l.despicadoras,(function(a){return m("option",{key:a.id,domProps:{value:a.id}},[l._v(" "+l._s(a.nombre)+" ")])}))],2)]),m("div",{staticClass:"filtro"},[m("label",{attrs:{for:"filtroEstado"}},[l._v("Estado:")]),m("select",{directives:[{name:"model",rawName:"v-model",value:l.filtroEstado,expression:"filtroEstado"}],attrs:{id:"filtroEstado"},on:{change:function(a){var o=Array.prototype.filter.call(a.target.options,(function(a){return a.selected})).map((function(a){var o="_value"in a?a._value:a.value;return o}));l.filtroEstado=a.target.multiple?o:o[0]}}},[m("option",{attrs:{value:""}},[l._v("Todos")]),m("option",{attrs:{value:"activo"}},[l._v("Activo")]),m("option",{attrs:{value:"pagado"}},[l._v("Pagado")])])]),m("div",{staticClass:"filtro-fecha"},[m("label",[l._v("Fecha:")]),m("div",{staticClass:"fecha-inputs"},[m("input",{directives:[{name:"model",rawName:"v-model",value:l.filtroFechaDesde,expression:"filtroFechaDesde"}],attrs:{type:"date",placeholder:"Desde"},domProps:{value:l.filtroFechaDesde},on:{input:function(a){a.target.composing||(l.filtroFechaDesde=a.target.value)}}}),m("span",[l._v("a")]),m("input",{directives:[{name:"model",rawName:"v-model",value:l.filtroFechaHasta,expression:"filtroFechaHasta"}],attrs:{type:"date",placeholder:"Hasta"},domProps:{value:l.filtroFechaHasta},on:{input:function(a){a.target.composing||(l.filtroFechaHasta=a.target.value)}}})])])]),m("div",{staticClass:"resumen-container"},[m("div",{staticClass:"resumen-card activos"},[m("h3",[l._v("Pr√©stamos Activos")]),m("p",[l._v(l._s(l.prestamosActivos))])]),m("div",{staticClass:"resumen-card pendiente"},[m("h3",[l._v("Saldo Pendiente")]),m("p",[l._v("$"+l._s(l.formatNumber(l.totalPendiente)))])])]),m("div",{staticClass:"acciones-container"},[m("button",{staticClass:"btn-nuevo-prestamo",on:{click:l.mostrarModalNuevoPrestamo}},[m("i",{staticClass:"fas fa-plus"}),l._v(" Nuevo Pr√©stamo ")]),m("button",{staticClass:"btn-nueva-despicadora",on:{click:l.mostrarModalNuevaDespicadora}},[m("i",{staticClass:"fas fa-building"}),l._v(" Nueva Despicadora ")])]),l.cargando?m("div",{staticClass:"loading-spinner"},[m("div",{staticClass:"spinner"}),m("p",[l._v("Cargando pr√©stamos...")])]):0===l.prestamos.length?m("div",{staticClass:"no-data"},[m("p",[l._v("No hay pr√©stamos registrados.")]),m("button",{staticClass:"btn-nuevo-prestamo",on:{click:l.mostrarModalNuevoPrestamo}},[l._v(" Crear Nuevo Pr√©stamo ")])]):m("div",{staticClass:"tabla-container"},[m("table",{staticClass:"tabla-prestamos"},[l._m(0),m("tbody",l._l(l.prestamosFiltrados,(function(a){return m("tr",{key:a.id,class:{"prestamo-pagado":"pagado"===a.estado}},[m("td",[l._v(l._s(l.formatearFecha(a.fecha)))]),m("td",[l._v(l._s(a.despicadoraNombre))]),m("td",[l._v("$"+l._s(l.formatNumber(a.montoInicial)))]),m("td",[l._v("$"+l._s(l.formatNumber(a.saldoPendiente)))]),m("td",[m("span",{class:"estado-badge "+a.estado},[l._v(" "+l._s("activo"===a.estado?"Activo":"Pagado")+" ")])]),m("td",{staticClass:"acciones"},[m("button",{staticClass:"btn-detalle",attrs:{title:"Ver detalles"},on:{click:function(o){return l.verDetalle(a)}}},[m("i",{staticClass:"fas fa-eye"})]),m("button",{staticClass:"btn-abono",attrs:{disabled:"pagado"===a.estado,title:"Agregar abono"},on:{click:function(o){return l.agregarAbono(a)}}},[m("i",{staticClass:"fas fa-money-bill"})]),m("button",{staticClass:"btn-eliminar",attrs:{title:"Eliminar pr√©stamo"},on:{click:function(o){return l.eliminarPrestamo(a)}}},[m("i",{staticClass:"fas fa-trash-alt"})])])])})),0)])]),l.showModalNuevoPrestamo?m("div",{staticClass:"modal-overlay",on:{click:l.closeModalOnOverlay}},[m("div",{staticClass:"modal-content",on:{click:function(a){a.stopPropagation()}}},[m("div",{staticClass:"modal-header"},[m("h2",[l._v("Nuevo Pr√©stamo a Despicadora")]),m("button",{staticClass:"close-button",on:{click:function(a){l.showModalNuevoPrestamo=!1}}},[l._v("√ó")])]),m("div",{staticClass:"modal-body"},[m("form",{staticClass:"form-prestamo",on:{submit:function(a){return a.preventDefault(),l.guardarNuevoPrestamo.apply(null,arguments)}}},[m("div",{staticClass:"form-group"},[m("label",{attrs:{for:"despicadoraSelect"}},[l._v("Despicadora:")]),m("select",{directives:[{name:"model",rawName:"v-model",value:l.nuevoPrestamo.despicadoraId,expression:"nuevoPrestamo.despicadoraId"}],attrs:{id:"despicadoraSelect",required:""},on:{change:function(a){var o=Array.prototype.filter.call(a.target.options,(function(a){return a.selected})).map((function(a){var o="_value"in a?a._value:a.value;return o}));l.$set(l.nuevoPrestamo,"despicadoraId",a.target.multiple?o:o[0])}}},[m("option",{attrs:{value:""}},[l._v("Seleccionar despicadora")]),l._l(l.despicadoras,(function(a){return m("option",{key:a.id,domProps:{value:a.id}},[l._v(" "+l._s(a.nombre)+" ")])}))],2)]),m("div",{staticClass:"form-group"},[m("label",{attrs:{for:"fechaPrestamo"}},[l._v("Fecha:")]),m("input",{directives:[{name:"model",rawName:"v-model",value:l.nuevoPrestamo.fecha,expression:"nuevoPrestamo.fecha"}],attrs:{id:"fechaPrestamo",type:"date",required:""},domProps:{value:l.nuevoPrestamo.fecha},on:{input:function(a){a.target.composing||l.$set(l.nuevoPrestamo,"fecha",a.target.value)}}})]),m("div",{staticClass:"form-group"},[m("label",{attrs:{for:"montoPrestamo"}},[l._v("Monto:")]),m("input",{directives:[{name:"model",rawName:"v-model.number",value:l.nuevoPrestamo.monto,expression:"nuevoPrestamo.monto",modifiers:{number:!0}}],attrs:{id:"montoPrestamo",type:"number",required:"",min:"1",step:"0.01"},domProps:{value:l.nuevoPrestamo.monto},on:{input:function(a){a.target.composing||l.$set(l.nuevoPrestamo,"monto",l._n(a.target.value))},blur:function(a){return l.$forceUpdate()}}})]),m("div",{staticClass:"form-group"},[m("label",{attrs:{for:"descripcionPrestamo"}},[l._v("Descripci√≥n:")]),m("textarea",{directives:[{name:"model",rawName:"v-model",value:l.nuevoPrestamo.descripcion,expression:"nuevoPrestamo.descripcion"}],attrs:{id:"descripcionPrestamo",rows:"3",placeholder:"Descripci√≥n del pr√©stamo (opcional)"},domProps:{value:l.nuevoPrestamo.descripcion},on:{input:function(a){a.target.composing||l.$set(l.nuevoPrestamo,"descripcion",a.target.value)}}})]),m("div",{staticClass:"form-actions"},[m("button",{staticClass:"btn-cancelar",attrs:{type:"button"},on:{click:function(a){l.showModalNuevoPrestamo=!1}}},[l._v("Cancelar")]),m("button",{staticClass:"btn-guardar",attrs:{type:"submit",disabled:l.guardando}},[l._v(" "+l._s(l.guardando?"Guardando...":"Guardar Pr√©stamo")+" ")])])])])])]):l._e(),l.showModalNuevaDespicadora?m("div",{staticClass:"modal-overlay",on:{click:l.closeModalOnOverlay}},[m("div",{staticClass:"modal-content",on:{click:function(a){a.stopPropagation()}}},[m("div",{staticClass:"modal-header"},[m("h2",[l._v("Nueva Despicadora")]),m("button",{staticClass:"close-button",on:{click:function(a){l.showModalNuevaDespicadora=!1}}},[l._v("√ó")])]),m("div",{staticClass:"modal-body"},[m("form",{staticClass:"form-despicadora",on:{submit:function(a){return a.preventDefault(),l.guardarNuevaDespicadora.apply(null,arguments)}}},[m("div",{staticClass:"form-group"},[m("label",{attrs:{for:"nombreDespicadora"}},[l._v("Nombre:")]),m("input",{directives:[{name:"model",rawName:"v-model",value:l.nuevaDespicadora.nombre,expression:"nuevaDespicadora.nombre"}],attrs:{id:"nombreDespicadora",type:"text",required:"",placeholder:"Nombre de la despicadora"},domProps:{value:l.nuevaDespicadora.nombre},on:{input:function(a){a.target.composing||l.$set(l.nuevaDespicadora,"nombre",a.target.value)}}})]),m("div",{staticClass:"form-group"},[m("label",{attrs:{for:"contactoDespicadora"}},[l._v("Contacto:")]),m("input",{directives:[{name:"model",rawName:"v-model",value:l.nuevaDespicadora.contacto,expression:"nuevaDespicadora.contacto"}],attrs:{id:"contactoDespicadora",type:"text",placeholder:"Tel√©fono o email (opcional)"},domProps:{value:l.nuevaDespicadora.contacto},on:{input:function(a){a.target.composing||l.$set(l.nuevaDespicadora,"contacto",a.target.value)}}})]),m("div",{staticClass:"form-group"},[m("label",{attrs:{for:"direccionDespicadora"}},[l._v("Direcci√≥n:")]),m("textarea",{directives:[{name:"model",rawName:"v-model",value:l.nuevaDespicadora.direccion,expression:"nuevaDespicadora.direccion"}],attrs:{id:"direccionDespicadora",rows:"2",placeholder:"Direcci√≥n (opcional)"},domProps:{value:l.nuevaDespicadora.direccion},on:{input:function(a){a.target.composing||l.$set(l.nuevaDespicadora,"direccion",a.target.value)}}})]),m("div",{staticClass:"form-actions"},[m("button",{staticClass:"btn-cancelar",attrs:{type:"button"},on:{click:function(a){l.showModalNuevaDespicadora=!1}}},[l._v("Cancelar")]),m("button",{staticClass:"btn-guardar",attrs:{type:"submit",disabled:l.guardando}},[l._v(" "+l._s(l.guardando?"Guardando...":"Guardar Despicadora")+" ")])])])])])]):l._e(),l.showDetalleModal?m("div",{staticClass:"modal-overlay",on:{click:l.closeModalOnOverlay}},[m("div",{staticClass:"modal-content modal-large",on:{click:function(a){a.stopPropagation()}}},[m("div",{staticClass:"modal-header"},[m("h2",[l._v("Detalle del Pr√©stamo")]),m("button",{staticClass:"close-button",on:{click:function(a){l.showDetalleModal=!1}}},[l._v("√ó")])]),m("div",{staticClass:"modal-body"},[m("div",{staticClass:"prestamo-info"},[m("div",{staticClass:"info-grid"},[m("div",{staticClass:"info-item"},[m("strong",[l._v("Despicadora:")]),m("span",[l._v(l._s(null===(a=l.prestamoSeleccionado)||void 0===a?void 0:a.despicadoraNombre))])]),m("div",{staticClass:"info-item"},[m("strong",[l._v("Fecha:")]),m("span",[l._v(l._s(l.formatearFecha(null===(o=l.prestamoSeleccionado)||void 0===o?void 0:o.fecha)))])]),m("div",{staticClass:"info-item"},[m("strong",[l._v("Monto Inicial:")]),m("span",[l._v("$"+l._s(l.formatNumber(null===(t=l.prestamoSeleccionado)||void 0===t?void 0:t.montoInicial)))])]),m("div",{staticClass:"info-item"},[m("strong",[l._v("Estado:")]),m("span",{class:"estado-badge "+(null===(e=l.prestamoSeleccionado)||void 0===e?void 0:e.estado)},[l._v(" "+l._s("activo"===(null===(s=l.prestamoSeleccionado)||void 0===s?void 0:s.estado)?"Activo":"Pagado")+" ")])])]),null!==(r=l.prestamoSeleccionado)&&void 0!==r&&r.descripcion?m("div",{staticClass:"descripcion"},[m("strong",[l._v("Descripci√≥n:")]),m("p",[l._v(l._s(l.prestamoSeleccionado.descripcion))])]):l._e()]),m("h3",[l._v("Historial de Abonos")]),0===l.abonos.length?m("div",{staticClass:"no-abonos"},[m("p",[l._v("No hay abonos registrados para este pr√©stamo.")])]):m("table",{staticClass:"tabla-abonos"},[l._m(1),m("tbody",l._l(l.abonos,(function(a,o){return m("tr",{key:o},[m("td",[l._v(l._s(l.formatearFecha(a.fecha)))]),m("td",[l._v(l._s(a.descripcion))]),m("td",[l._v("$"+l._s(l.formatNumber(a.monto)))]),m("td",[m("button",{staticClass:"btn-eliminar-sm",on:{click:function(a){return l.eliminarAbono(o)}}},[m("i",{staticClass:"fas fa-trash-alt"})])])])})),0),m("tfoot",[m("tr",[m("td",{staticClass:"total-label",attrs:{colspan:"2"}},[l._v("Total Abonos")]),m("td",[l._v("$"+l._s(l.formatNumber(l.totalAbonos)))]),m("td")])])]),m("div",{staticClass:"resumen-prestamo"},[m("div",{staticClass:"resumen-item"},[m("span",[l._v("Monto inicial:")]),m("span",[l._v("$"+l._s(l.formatNumber(null===(i=l.prestamoSeleccionado)||void 0===i?void 0:i.montoInicial)))])]),m("div",{staticClass:"resumen-item"},[m("span",[l._v("Total abonos:")]),m("span",[l._v("$"+l._s(l.formatNumber(l.totalAbonos)))])]),m("div",{staticClass:"resumen-item total"},[m("span",[l._v("Saldo pendiente:")]),m("span",[l._v("$"+l._s(l.formatNumber(l.calcularSaldoPendiente())))])])])])])]):l._e(),l.showAbonoModal?m("div",{staticClass:"modal-overlay",on:{click:l.closeModalOnOverlay}},[m("div",{staticClass:"modal-content",on:{click:function(a){a.stopPropagation()}}},[m("div",{staticClass:"modal-header"},[m("h2",[l._v("Agregar Abono")]),m("button",{staticClass:"close-button",on:{click:function(a){l.showAbonoModal=!1}}},[l._v("√ó")])]),m("div",{staticClass:"modal-body"},[m("div",{staticClass:"prestamo-info"},[m("p",[m("strong",[l._v("Despicadora:")]),l._v(" "+l._s(null===(n=l.prestamoSeleccionado)||void 0===n?void 0:n.despicadoraNombre))]),m("p",[m("strong",[l._v("Saldo Pendiente:")]),l._v(" $"+l._s(l.formatNumber(null===(c=l.prestamoSeleccionado)||void 0===c?void 0:c.saldoPendiente)))])]),m("form",{staticClass:"form-abono",on:{submit:function(a){return a.preventDefault(),l.guardarAbono.apply(null,arguments)}}},[m("div",{staticClass:"form-group"},[m("label",{attrs:{for:"fechaAbono"}},[l._v("Fecha:")]),m("input",{directives:[{name:"model",rawName:"v-model",value:l.nuevoAbono.fecha,expression:"nuevoAbono.fecha"}],attrs:{id:"fechaAbono",type:"date",required:""},domProps:{value:l.nuevoAbono.fecha},on:{input:function(a){a.target.composing||l.$set(l.nuevoAbono,"fecha",a.target.value)}}})]),m("div",{staticClass:"form-group"},[m("label",{attrs:{for:"descripcionAbono"}},[l._v("Descripci√≥n:")]),m("input",{directives:[{name:"model",rawName:"v-model",value:l.nuevoAbono.descripcion,expression:"nuevoAbono.descripcion"}],attrs:{id:"descripcionAbono",type:"text",required:"",placeholder:"Ej: Pago parcial, Transferencia, etc."},domProps:{value:l.nuevoAbono.descripcion},on:{input:function(a){a.target.composing||l.$set(l.nuevoAbono,"descripcion",a.target.value)}}})]),m("div",{staticClass:"form-group"},[m("label",{attrs:{for:"montoAbono"}},[l._v("Monto:")]),m("input",{directives:[{name:"model",rawName:"v-model.number",value:l.nuevoAbono.monto,expression:"nuevoAbono.monto",modifiers:{number:!0}}],attrs:{id:"montoAbono",type:"number",required:"",min:"1",max:null===(d=l.prestamoSeleccionado)||void 0===d?void 0:d.saldoPendiente,step:"0.01"},domProps:{value:l.nuevoAbono.monto},on:{input:function(a){a.target.composing||l.$set(l.nuevoAbono,"monto",l._n(a.target.value))},blur:function(a){return l.$forceUpdate()}}})]),m("div",{staticClass:"form-actions"},[m("button",{staticClass:"btn-cancelar",attrs:{type:"button"},on:{click:function(a){l.showAbonoModal=!1}}},[l._v("Cancelar")]),m("button",{staticClass:"btn-guardar",attrs:{type:"submit",disabled:l.guardando}},[l._v(" "+l._s(l.guardando?"Guardando...":"Guardar Abono")+" ")])])])])])]):l._e()])},s=[function(){var a=this,o=a._self._c;return o("thead",[o("tr",[o("th",[a._v("Fecha")]),o("th",[a._v("Despicadora")]),o("th",[a._v("Monto Inicial")]),o("th",[a._v("Saldo Pendiente")]),o("th",[a._v("Estado")]),o("th",[a._v("Acciones")])])])},function(){var a=this,o=a._self._c;return o("thead",[o("tr",[o("th",[a._v("Fecha")]),o("th",[a._v("Descripci√≥n")]),o("th",[a._v("Monto")]),o("th",[a._v("Acciones")])])])}],r=(t("13d5"),t("dc59")),i=t("1494"),n=t("74c9"),c={name:"PrestamosDespicadoras",components:{BackButton:n["a"]},data(){return{prestamos:[],despicadoras:[],abonos:[],cargando:!0,guardando:!1,filtroDespicadora:"",filtroEstado:"",filtroFechaDesde:"",filtroFechaHasta:"",showModalNuevoPrestamo:!1,showModalNuevaDespicadora:!1,showDetalleModal:!1,showAbonoModal:!1,prestamoSeleccionado:null,nuevoPrestamo:{despicadoraId:"",fecha:"",monto:null,descripcion:""},nuevaDespicadora:{nombre:"",contacto:"",direccion:""},nuevoAbono:{fecha:"",descripcion:"",monto:null}}},computed:{prestamosFiltrados(){return this.prestamos.filter(a=>(!this.filtroDespicadora||a.despicadoraId===this.filtroDespicadora)&&((!this.filtroEstado||a.estado===this.filtroEstado)&&(!(this.filtroFechaDesde&&a.fecha<this.filtroFechaDesde)&&!(this.filtroFechaHasta&&a.fecha>this.filtroFechaHasta))))},prestamosActivos(){return this.prestamosFiltrados.filter(a=>"activo"===a.estado).length},totalPendiente(){return this.prestamosFiltrados.reduce((a,o)=>a+o.saldoPendiente,0)},totalAbonos(){return this.abonos.reduce((a,o)=>a+o.monto,0)}},methods:{obtenerFechaActual(){const a=new Date;return a.toISOString().split("T")[0]},formatNumber(a){return a?a.toLocaleString("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00"},formatearFecha(a){if(!a)return"";const o=new Date(a+"T00:00:00"),t={year:"numeric",month:"long",day:"numeric"};return o.toLocaleDateString("es-ES",t)},async cargarPrestamos(){try{this.cargando=!0;const a=await Object(i["g"])(Object(i["o"])(Object(i["c"])(r["a"],"prestamosDespicadoras"),Object(i["l"])("fechaCreacion","desc")));this.prestamos=a.docs.map(a=>({id:a.id,...a.data()}))}catch(a){console.error("Error al cargar pr√©stamos: ",a)}finally{this.cargando=!1}},async cargarDespicadoras(){try{const a=await Object(i["g"])(Object(i["c"])(r["a"],"despicadoras"));this.despicadoras=a.docs.map(a=>({id:a.id,...a.data()}))}catch(a){console.error("Error al cargar despicadoras: ",a)}},mostrarModalNuevoPrestamo(){this.nuevoPrestamo={despicadoraId:"",fecha:this.obtenerFechaActual(),monto:null,descripcion:""},this.showModalNuevoPrestamo=!0},mostrarModalNuevaDespicadora(){this.nuevaDespicadora={nombre:"",contacto:"",direccion:""},this.showModalNuevaDespicadora=!0},async guardarNuevoPrestamo(){if(this.nuevoPrestamo.despicadoraId&&this.nuevoPrestamo.monto)try{this.guardando=!0;const a=this.despicadoras.find(a=>a.id===this.nuevoPrestamo.despicadoraId);await Object(i["b"])(Object(i["c"])(r["a"],"prestamosDespicadoras"),{despicadoraId:this.nuevoPrestamo.despicadoraId,despicadoraNombre:a.nombre,fecha:this.nuevoPrestamo.fecha,montoInicial:this.nuevoPrestamo.monto,saldoPendiente:this.nuevoPrestamo.monto,descripcion:this.nuevoPrestamo.descripcion,estado:"activo",fechaCreacion:new Date}),this.showModalNuevoPrestamo=!1,await this.cargarPrestamos(),alert("Pr√©stamo registrado correctamente")}catch(a){console.error("Error al guardar pr√©stamo: ",a),alert("Error al guardar pr√©stamo: "+a.message)}finally{this.guardando=!1}else alert("Por favor complete todos los campos requeridos")},async guardarNuevaDespicadora(){if(this.nuevaDespicadora.nombre)try{this.guardando=!0,await Object(i["b"])(Object(i["c"])(r["a"],"despicadoras"),{nombre:this.nuevaDespicadora.nombre,contacto:this.nuevaDespicadora.contacto,direccion:this.nuevaDespicadora.direccion,fechaCreacion:new Date}),this.showModalNuevaDespicadora=!1,await this.cargarDespicadoras(),alert("Despicadora registrada correctamente")}catch(a){console.error("Error al guardar despicadora: ",a),alert("Error al guardar despicadora: "+a.message)}finally{this.guardando=!1}else alert("Por favor ingrese el nombre de la despicadora")},async verDetalle(a){this.prestamoSeleccionado=a,this.abonos=[];try{const o=await Object(i["g"])(Object(i["o"])(Object(i["c"])(r["a"],"prestamosDespicadoras",a.id,"abonos"),Object(i["l"])("fechaCreacion","desc")));this.abonos=o.docs.map(a=>({id:a.id,...a.data()})),this.showDetalleModal=!0}catch(o){console.error("Error al cargar detalle del pr√©stamo: ",o)}},agregarAbono(a){this.prestamoSeleccionado=a,this.nuevoAbono={fecha:this.obtenerFechaActual(),descripcion:"",monto:null},this.showAbonoModal=!0},async guardarAbono(){if(this.nuevoAbono.descripcion&&this.nuevoAbono.monto)if(this.nuevoAbono.monto<=0)alert("El monto del abono debe ser mayor a cero");else if(this.nuevoAbono.monto>this.prestamoSeleccionado.saldoPendiente)alert("El monto del abono no puede ser mayor al saldo pendiente");else try{this.guardando=!0,await Object(i["b"])(Object(i["c"])(r["a"],"prestamosDespicadoras",this.prestamoSeleccionado.id,"abonos"),{descripcion:this.nuevoAbono.descripcion,monto:this.nuevoAbono.monto,fecha:this.nuevoAbono.fecha,fechaCreacion:new Date});const a=this.prestamoSeleccionado.saldoPendiente-this.nuevoAbono.monto,o=a<=0?"pagado":"activo";await Object(i["r"])(Object(i["e"])(r["a"],"prestamosDespicadoras",this.prestamoSeleccionado.id),{saldoPendiente:a,estado:o}),this.prestamos=this.prestamos.map(t=>t.id===this.prestamoSeleccionado.id?{...t,saldoPendiente:a,estado:o}:t),this.prestamoSeleccionado.saldoPendiente=a,this.prestamoSeleccionado.estado=o,this.showAbonoModal=!1,alert("Abono registrado correctamente")}catch(a){console.error("Error al guardar abono: ",a),alert("Error al guardar abono: "+a.message)}finally{this.guardando=!1}else alert("Por favor complete todos los campos del abono")},async eliminarPrestamo(a){if(confirm(`¬øEst√° seguro que desea eliminar el pr√©stamo de ${a.despicadoraNombre}? Esta acci√≥n no se puede deshacer.`))try{this.cargando=!0;const o=await Object(i["g"])(Object(i["c"])(r["a"],"prestamosDespicadoras",a.id,"abonos")),t=Object(i["t"])(r["a"]);o.forEach(o=>{t.delete(Object(i["e"])(r["a"],"prestamosDespicadoras",a.id,"abonos",o.id))}),await t.commit(),await Object(i["d"])(Object(i["e"])(r["a"],"prestamosDespicadoras",a.id)),this.prestamos=this.prestamos.filter(o=>o.id!==a.id),alert("Pr√©stamo eliminado correctamente")}catch(o){console.error("Error al eliminar el pr√©stamo: ",o),alert("Error al eliminar el pr√©stamo: "+o.message)}finally{this.cargando=!1}},async eliminarAbono(a){if(!confirm("¬øEst√° seguro de eliminar este abono?"))return;const o=this.abonos[a];try{this.guardando=!0,await Object(i["d"])(Object(i["e"])(r["a"],"prestamosDespicadoras",this.prestamoSeleccionado.id,"abonos",o.id)),this.abonos.splice(a,1);const t=this.calcularSaldoPendiente();await Object(i["r"])(Object(i["e"])(r["a"],"prestamosDespicadoras",this.prestamoSeleccionado.id),{saldoPendiente:t,estado:t<=0?"pagado":"activo"}),this.prestamos=this.prestamos.map(a=>a.id===this.prestamoSeleccionado.id?{...a,saldoPendiente:t,estado:t<=0?"pagado":"activo"}:a),this.prestamoSeleccionado.saldoPendiente=t,this.prestamoSeleccionado.estado=t<=0?"pagado":"activo"}catch(t){console.error("Error al eliminar abono: ",t),alert("Error al eliminar abono: "+t.message)}finally{this.guardando=!1}},calcularSaldoPendiente(){var a;return(null===(a=this.prestamoSeleccionado)||void 0===a?void 0:a.montoInicial)-this.totalAbonos},closeModalOnOverlay(a){a.target===a.currentTarget&&(this.showModalNuevoPrestamo=!1,this.showModalNuevaDespicadora=!1,this.showDetalleModal=!1,this.showAbonoModal=!1)}},async mounted(){await Promise.all([this.cargarPrestamos(),this.cargarDespicadoras()])}},d=c,l=(t("5ac3"),t("2877")),m=Object(l["a"])(d,e,s,!1,null,"db52fc84",null);o["a"]=m.exports},"98d3":function(a,o,t){"use strict";var e=function(){var a=this,o=a._self._c;return o("div",{staticClass:"prestamos-menu-container"},[o("div",{staticClass:"back-button-container"},[o("BackButton",{attrs:{to:"/procesos"}})],1),o("h1",{staticClass:"menu-title"},[a._v("Gesti√≥n de Pr√©stamos")]),a._m(0),o("div",{staticClass:"actions-container"},[o("router-link",{staticClass:"action-button despicadoras",attrs:{to:"/procesos/prestamos/despicadoras"}},[o("div",{staticClass:"button-content"},[o("i",{staticClass:"fas fa-industry"}),o("div",{staticClass:"button-text"},[o("h3",[a._v("Pr√©stamos a Despicadoras")]),o("p",[a._v("Gestiona pr√©stamos otorgados a las despicadoras")])])]),o("i",{staticClass:"fas fa-arrow-right"})]),o("router-link",{staticClass:"action-button trabajadores",attrs:{to:"/procesos/prestamos/trabajadores"}},[o("div",{staticClass:"button-content"},[o("i",{staticClass:"fas fa-users"}),o("div",{staticClass:"button-text"},[o("h3",[a._v("Pr√©stamos a Trabajadores")]),o("p",[a._v("Gestiona pr√©stamos otorgados a empleados")])])]),o("i",{staticClass:"fas fa-arrow-right"})])],1),o("div",{staticClass:"resumen-container"},[o("div",{staticClass:"resumen-card"},[o("h3",[a._v("Resumen General")]),o("div",{staticClass:"resumen-stats"},[o("div",{staticClass:"stat-item"},[o("span",{staticClass:"stat-label"},[a._v("Total Pr√©stamos Activos:")]),o("span",{staticClass:"stat-value"},[a._v(a._s(a.totalPrestamosActivos))])]),o("div",{staticClass:"stat-item"},[o("span",{staticClass:"stat-label"},[a._v("Monto Total Pendiente:")]),o("span",{staticClass:"stat-value"},[a._v("$"+a._s(a.formatNumber(a.montoTotalPendiente)))])])])])])])},s=[function(){var a=this,o=a._self._c;return o("div",{staticClass:"menu-description"},[o("p",[a._v("Administra los pr√©stamos otorgados a despicadoras y trabajadores")])])}],r=t("dc59"),i=t("1494"),n=t("74c9"),c={name:"PrestamosMenu",components:{BackButton:n["a"]},data(){return{totalPrestamosActivos:0,montoTotalPendiente:0}},methods:{formatNumber(a){return a?a.toLocaleString("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00"},async cargarResumen(){try{const a=Object(i["o"])(Object(i["c"])(r["a"],"prestamosDespicadoras"),Object(i["s"])("estado","==","activo")),o=await Object(i["g"])(a),t=Object(i["o"])(Object(i["c"])(r["a"],"prestamosTrabajadores"),Object(i["s"])("estado","==","activo")),e=await Object(i["g"])(t);this.totalPrestamosActivos=o.size+e.size;let s=0;o.forEach(a=>{const o=a.data();s+=o.saldoPendiente||0}),e.forEach(a=>{const o=a.data();s+=o.saldoPendiente||0}),this.montoTotalPendiente=s}catch(a){console.error("Error al cargar resumen de pr√©stamos: ",a)}}},async mounted(){await this.cargarResumen()}},d=c,l=(t("2c81"),t("2877")),m=Object(l["a"])(d,e,s,!1,null,"e3e1acd8",null);o["a"]=m.exports},bd52:function(a,o,t){},bf77:function(a,o,t){},df16:function(a,o,t){"use strict";t("bd52")},fbd0:function(a,o,t){}}]);