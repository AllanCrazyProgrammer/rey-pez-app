(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["app.cee491b7"],{"1cf6":function(e,t,o){"use strict";o.d(t,"a",(function(){return s}));var a=o("fa1c");const r=e=>e?e.toString().toLowerCase().replace(/\s+/g,"").replace(/[\[\]()]/g,"").replace(/-/g,"/").trim():"",n=(e,t,o=null)=>{if(!Array.isArray(e))return console.warn("[PRECIOS] preciosActuales no es un array válido"),new Map;t||(console.warn("[PRECIOS] No hay fecha del embarque, usando fecha actual como fallback"),t=Object(a["d"])());const n=Object(a["c"])(t),s=new Map,c=new Map,i=[...e].sort((e,t)=>{const o=Object(a["c"])(e.fecha),r=Object(a["c"])(t.fecha);if(o!==r)return o<r?-1:1;const n=e.timestamp||0,s=t.timestamp||0;return n-s});i.forEach(e=>{if(!e.fecha||!e.producto)return;const t=Object(a["c"])(e.fecha);if(Object(a["a"])(t,n)){const a=r(e.producto);if(e.clienteId===o){const o=c.get(a);if(!o||t>=o.fecha){o&&o.fecha;c.set(a,{precio:e.precio,fecha:t,clienteId:e.clienteId,timestamp:e.timestamp||(new Date).getTime()})}}else if(!e.clienteId){const o=s.get(a);if(!o||t>=o.fecha){o&&o.fecha;s.set(a,{precio:e.precio,fecha:t,clienteId:null,timestamp:e.timestamp||(new Date).getTime()})}}}});const l=new Map;for(const[a,r]of s)l.set(a,r.precio);for(const[a,r]of c)l.set(a,r.precio);return l},s=(e,t,o,a=null)=>{const s=n(e,o,a),c=r(t);return s.get(c)||null}},"692f":function(e,t,o){"use strict";o.d(t,"a",(function(){return E}));o("14d9"),o("13d5"),o("88e6"),o("70cc"),o("eb03"),o("22e5c"),o("c01e"),o("fa76"),o("8306");var a=o("e499"),r=o.n(a),n=o("4ebb"),s=o.n(n);function c(e,t=[]){if("5"===e)return!0;if(Array.isArray(t)&&t.length>0){const o=t.find(t=>{var o,a;return(null===(o=t.id)||void 0===o?void 0:o.toString())===e.toString()||(null===(a=t.clienteId)||void 0===a?void 0:a.toString())===e.toString()});if(o){const e=(o.nombre||o.nombreCliente||"").toLowerCase();return e.includes("veronica")||e.includes("lorena")}}return!1}function i(e,t=[]){if(Array.isArray(t)&&t.length>0){const o=t.find(t=>{var o,a;return(null===(o=t.id)||void 0===o?void 0:o.toString())===e.toString()||(null===(a=t.clienteId)||void 0===a?void 0:a.toString())===e.toString()});if(o){const e=(o.nombre||o.nombreCliente||"").toLowerCase();if(e.includes("veronica")||e.includes("lorena"))return"#e67e22"}}const o={1:"#3498db",2:"#e74c3c",3:"#f1c40f",4:"#2ecc71",veronica:"#e67e22",lorena:"#e67e22"};return o[e]||"#95a5a6"}function l(e,t,o=100,a=[]){const r=o/100,n=[{text:"",pageBreak:"before"}];let s=0,l=0;const f=120,v=25,w=[],A=[];Object.entries(e).forEach(([e,t])=>{const o=m(t);if(o>0){const o=c(e,a);["1","2","3","4"].includes(e)||o?w.push([e,t]):A.push([e,t])}});for(let c=0;c<A.length;c+=3){const e=[];for(let t=0;t<3&&c+t<A.length;t++){const[o,n]=A[c+t],w=d(o,a),C=g(n),E=m(n);s+=C,l+=E,e.push({stack:[{columns:[{width:"auto",stack:[{canvas:[{type:"rect",x:0,y:0,w:.8*f,h:v,r:8,color:i(o,a)}]},{text:w,color:"white",fontSize:11*r,relativePosition:{x:10,y:-20}}]},{text:`${C}T|${h(E)}Kg`,style:"total",alignment:"right",color:i(o,a),fontSize:11*r}],margin:[0,3,0,3]},...n.map(e=>({stack:[{text:u(e,o),fontSize:11*r,bold:!0,margin:[0,0,0,1],alignment:"center"},{canvas:[{type:"line",x1:0,y1:1,x2:120,y2:1,lineWidth:.5,lineColor:"#000000"}],margin:[0,0,0,1]},{text:0===y(e)?[{text:""+h(p(e)),color:"red",bold:!0}]:[{text:y(e)+"-",bold:!0},{text:""+h(p(e)),color:"red",bold:!0}],fontSize:11*r,margin:[0,1,0,1],alignment:"center"},{text:b(e),fontSize:10*r,margin:[0,0,0,1],alignment:"center"}],margin:[0,0,0,5]}))],width:"32%"})}n.push({columns:e,columnGap:10,margin:[0,0,0,15]})}return w.forEach(([e,t])=>{const o=d(e,a),c=g(t),w=m(t);s+=c,l+=w;const A=t.length;let C=13,E=15;A>30?(C=9,E=6):A>24?(C=10,E=8):A>18?(C=11,E=10):A>12&&(C=12,E=12),n.push({columns:[{width:"auto",stack:[{canvas:[{type:"rect",x:0,y:0,w:f,h:v,r:8,color:i(e,a)}]},{text:o,color:"white",fontSize:C*r,relativePosition:{x:10,y:-20}}]},{text:`Total: ${c}T | ${h(w)}Kg`,style:"total",alignment:"right",color:i(e,a),fontSize:C*r}],margin:[0,3,0,3]});let x=3;A>30&&(x=4);const I=[];for(let a=0;a<t.length;a+=x)I.push(t.slice(a,a+x));I.forEach(t=>{n.push({columns:t.map(t=>({stack:[{text:u(t,e),fontSize:C*r,bold:!0,margin:[0,0,0,1],alignment:"center"},{canvas:[{type:"line",x1:0,y1:1,x2:150,y2:1,lineWidth:.5,lineColor:"#000000"}],margin:[0,0,0,1]},{text:0===y(t)?[{text:""+h(p(t)),color:"red",bold:!0}]:[{text:y(t)+"-",bold:!0},{text:""+h(p(t)),color:"red",bold:!0}],fontSize:C*r,margin:[0,1,0,1],alignment:"center"},{text:b(t),fontSize:(C-1)*r,margin:[0,0,0,1],alignment:"center"}],width:100/x+"%",alignment:"center"})),columnGap:5,margin:[0,0,0,E]})}),n.push({canvas:[{type:"line",x1:0,y1:2,x2:515,y2:2,lineWidth:.5,lineColor:"#CCCCCC"}],margin:[0,5,0,5]})}),n}function d(e,t=[]){const o=e.toString();if(Array.isArray(t)&&t.length>0){const e=t.find(e=>{var t,a;return(null===(t=e.id)||void 0===t?void 0:t.toString())===o||(null===(a=e.clienteId)||void 0===a?void 0:a.toString())===o});if(e){const t=e.nombre||e.nombreCliente;return"string"===typeof t&&t.toLowerCase().includes("lorena")?"Lorena-D22":t}}const a={1:"Joselito",2:"Catarro",3:"Otilio",4:"Ozuna",5:"Lorena-D22"};return a[o]||"Cliente "+o}function u(e,t=null){let o="";const a=[],r="4"===t&&!e.esVenta;return r&&a.push({text:"maquila\n",background:"#2ecc71",color:"white",bold:!0}),"c/h20"===e.tipo?(a.push({text:`${e.textoAlternativo||e.medida||""} ${e.fecha||""} `,color:"black"},{text:`c/h20 (${e.camaronNeto||.65})`,color:"#3498db"}),e.precio&&a.push({text:" $"+Number(e.precio).toLocaleString("en-US"),color:"red",bold:!0}),a):(o=e.textoAlternativo||e.medida||"",e.fecha&&(o+=" "+e.fecha),"3"===e.clienteId&&e.noSumarKilos&&(o+=" kileado"),"otro"===e.tipo?o+=" "+e.tipoPersonalizado:e.tipo&&(o+=" "+e.tipo),a.push({text:o,color:"black"}),e.precio&&a.push({text:" $"+Number(e.precio).toLocaleString("en-US"),color:"red",bold:!0}),a.length>(r?1:0)?a:o)}function p(e){if("c/h20"===e.tipo){const t=e.camaronNeto||.65,o=f(e);return o*t}const t=Array.isArray(e.kilos)?e.kilos.reduce((e,t)=>e+(parseFloat(t)||0),0):0;if(e.restarTaras){const o=3*(Array.isArray(e.taras)?e.taras.reduce((e,t)=>e+(parseInt(t)||0),0):0);return t-o}return t}function f(e){if(!Array.isArray(e.reporteTaras)||!Array.isArray(e.reporteBolsas))return 0;let t=0;for(let o=0;o<e.reporteTaras.length;o++){const a=parseInt(e.reporteTaras[o])||0,r=parseInt(e.reporteBolsas[o])||0;t+=a*r}return t}function m(e){return e.reduce((e,t)=>{if("c/h20"===t.tipo){const o=f(t);return e+o*(t.camaronNeto||.65)}{const o=t.kilos?t.kilos.reduce((e,t)=>e+(parseFloat(t)||0),0):0,a=t.taras?t.taras.reduce((e,t)=>e+(parseInt(t)||0),0):0;return t.restarTaras?e+(o-3*a):e+o}},0)}function g(e){return e.reduce((e,t)=>{const o=t.taras?t.taras.reduce((e,t)=>e+(parseInt(t)||0),0):0,a=t.tarasExtra?t.tarasExtra.reduce((e,t)=>e+(parseInt(t)||0),0):0;return e+o+a},0)}function h(e){return e.toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1})}function b(e){let t="";if(Array.isArray(e.reporteTaras)&&Array.isArray(e.reporteBolsas)){const o=[];let a=[],r=null;for(let t=0;t<e.reporteTaras.length;t++){const n=parseInt(e.reporteTaras[t]),s=parseInt(e.reporteBolsas[t]);isNaN(n)||isNaN(s)||(s===r?a.push(n):(a.length>0&&o.push(`(${a.join(",")}-${r})`),a=[n],r=s))}a.length>0&&null!==r&&o.push(`(${a.join(",")}-${r})`),t=o.join("")}return t}function y(e){const t=e.taras?e.taras.reduce((e,t)=>e+(parseInt(t)||0),0):0,o=e.tarasExtra?e.tarasExtra.reduce((e,t)=>e+(parseInt(t)||0),0):0;return t+o}"object"===typeof s.a&&s.a.hasOwnProperty("default")?r.a.vfs=s.a.default:"object"===typeof s.a&&s.a.pdfMake&&s.a.pdfMake.vfs&&(r.a.vfs=s.a.pdfMake.vfs),r.a.fonts={Roboto:{normal:"Roboto-Regular.ttf",bold:"Roboto-Medium.ttf",italics:"Roboto-Italic.ttf",bolditalics:"Roboto-MediumItalic.ttf"}};const v={Joselito:"#3498db",Catarro:"#e74c3c",Otilio:"#f1c40f",Ozuna:"#2ecc71",Elizabeth:"#9b59b6"},w=["Med","Med-Esp","Med-Gde","Gde","Extra","Jumbo"],A=e=>e.sort((e,t)=>{const o=e.toUpperCase(),a=t.toUpperCase(),r=w.findIndex(e=>e.toUpperCase()===o),n=w.findIndex(e=>e.toUpperCase()===a);return-1!==r&&-1!==n?r-n:-1!==r?-1:-1!==n?1:e.localeCompare(t)}),C=e=>{if(!Array.isArray(e)||0===e.length)return[];const t=e=>{if("string"===typeof e){const t=e.split("-");return t.length>1?Number(t[1]):0}return 0},o={};e.forEach(e=>{if(!e)return;const a=t(e);o[a]||(o[a]=[]),o[a].push(e)});const a=Object.keys(o).map(Number).sort((e,t)=>19===e?-1:19===t?1:e-t);return a.reduce((e,t)=>e.concat(o[t]),[])},E=(e,t,o,a=[],n=100)=>{let s=[];e.medidasCrudos&&Array.isArray(e.medidasCrudos)&&(s=e.medidasCrudos.map(e=>e.replace("c/c","").trim()),s=A([...new Set(s)])),console.log("Medidas de crudos encontradas:",s);const c=n/100,i={pageSize:"LETTER",pageOrientation:"portrait",content:[{table:{widths:["*","auto","*"],body:[[{text:"Carga: "+e.cargaCon,alignment:"left",fontSize:20*c,border:[!1,!1,!1,!0]},{text:"Embarque",alignment:"center",fontSize:25*c,bold:!0,border:[!1,!1,!1,!0]},{text:""+new Date(new Date(e.fecha).getTime()+864e5).toLocaleDateString("es-MX",{day:"2-digit",month:"short",year:"numeric",timeZone:"America/Mexico_City"}),alignment:"right",fontSize:20*c,border:[!1,!1,!1,!0]}]]},margin:[0,0,0,20*c]}],styles:{header:{fontSize:25*c,bold:!0,alignment:"center",margin:[0,0,0,0]},tableHeader:{bold:!0,fontSize:19*c,fillColor:"#eeeeee",alignment:"center"},clienteHeader:{fontSize:18*c,bold:!0,color:"white"},clienteCell:{bold:!0,fontSize:17*c,alignment:"left",color:"white"},dataCell:{fontSize:19*c,alignment:"center"},total:{fontSize:18*c,bold:!0,color:"white"}}},d=[{text:"Cliente",style:"tableHeader"},...s.map(t=>{const o=e.crudos.find(e=>e.medida.replace("c/c","").trim()===t&&e.textoAlternativo),a=o?o.textoAlternativo:t;return{text:a,style:"tableHeader"}})],u=[],p=new Set(e.crudos.map(e=>e.clienteId));p.forEach(t=>{const a=o(t),r="Joselito"===a?"8A":a,n=v[a]||"#95a5a6",c=[{text:r,style:"clienteCell",fillColor:n}];s.forEach(o=>{const a=e.crudos.filter(e=>e.clienteId===t&&e.medida.replace("c/c","").trim()===o);if(a.length>0){let e=[],t=!1,o=null;a.forEach(a=>{a.taras&&Array.isArray(a.taras)&&(e=e.concat(a.taras.filter(e=>e))),a.precio&&(t=!0,o=a.precio)});const r=C(e),n=[{text:r.join("\n"),style:"dataCell"}];t&&n.push({text:"$"+Number(o).toLocaleString("en-US"),color:"red",bold:!0,fontSize:16}),c.push({stack:n,style:"dataCell"})}else c.push({text:"",style:"dataCell"})}),u.push(c)});const f=[{text:"TOTAL",style:"total",fillColor:"#7f8c8d",alignment:"center"}];let m=0;s.forEach(t=>{let o=[];e.crudos.forEach(e=>{if(e.medida.replace("c/c","").trim()===t&&e.taras&&Array.isArray(e.taras)){const t=e.taras.filter(e=>e);o=o.concat(t)}});const a=C(o);let r=0;a.forEach(e=>{if("string"===typeof e&&e.includes("-")){const t=parseInt(e.split("-")[0]);isNaN(t)||(r+=t)}else"number"===typeof e?r+=e:"string"!==typeof e||isNaN(parseInt(e))||(r+=parseInt(e))}),m+=r,f.push({text:r>0?r.toString():"",style:"total",fillColor:"#7f8c8d",alignment:"center"})}),u.push(f),i.content.push({table:{headerRows:1,widths:[60,...s.map(()=>{const e=Math.min(100,395/s.length);return e})],body:[d,...u]},layout:{hLineWidth:function(e,t){return 1},vLineWidth:function(e,t){return 1},hLineColor:function(e,t){return"#000000"},vLineColor:function(e,t){return"#000000"},paddingLeft:function(e){return 4},paddingRight:function(e){return 4},paddingTop:function(e){return 4},paddingBottom:function(e){return 4}}}),i.content.push({columns:[{width:"*",text:""},{width:"auto",table:{body:[[{text:"GRAN TOTAL:",bold:!0,fontSize:22*c,alignment:"right",margin:[0,0,10,0]},{text:m.toString(),bold:!0,fontSize:22*c,alignment:"center"}]]},layout:"noBorders"},{width:"*",text:""}],margin:[0,15,0,15]}),i.content.push({text:"\n\n"},{text:"Desglose por Medida",style:"header",margin:[0,0,0,10]});const g=[{text:"Medida",style:"tableHeader"},{text:"Cliente",style:"tableHeader"},{text:"Barco",style:"tableHeader"}],h=[];s.forEach(t=>{const a=e.crudos.filter(e=>e.medida.replace("c/c","").trim()===t);if(a.length>0){const e=a[0],r=o(e.clienteId),n="Joselito"===r?"8A":r,s=e.textoAlternativo||t;h.push([{text:s,style:"dataCell",rowSpan:a.length,alignment:"center",verticalAlignment:"middle"},{text:n,style:"clienteCell",fillColor:v[r]||"#95a5a6"},{text:e.barco||"-",style:"dataCell"}]);for(let t=1;t<a.length;t++){const e=a[t],r=o(e.clienteId),n="Joselito"===r?"8A":r;h.push(["",{text:n,style:"clienteCell",fillColor:v[r]||"#95a5a6"},{text:e.barco||"-",style:"dataCell"}])}}}),i.content.push({table:{headerRows:1,widths:["*",100,"*"],body:[g,...h]},layout:{hLineWidth:function(e,t){return 1},vLineWidth:function(e,t){return 1},hLineColor:function(e,t){return"#000000"},vLineColor:function(e,t){return"#000000"},paddingLeft:function(e){return 4},paddingRight:function(e){return 4},paddingTop:function(e){return 4},paddingBottom:function(e){return 4},fillColor:function(e,t){return null},defaultBorder:!0,vLineAlignment:function(e,t){return"center"}}}),h.forEach(e=>{e[0].text&&(e[0]={...e[0],alignment:"center",margin:[0,10,0,10]})}),i.content.push(...l(t,v,n,a)),r.a.createPdf(i).download("resumen-embarque-completo.pdf")}},"80ac":function(e,t,o){"use strict";o.d(t,"a",(function(){return n}));o("13d5");var a=o("8baf");o("0da4");const r={Joselito:"#3498db",Catarro:"#e74c3c",Otilio:"#f39c12",Ozuna:"#27ae60",Lorena:"#e67e22"};function n(e,t){const o=new a["default"];o.setFontSize(24),o.setTextColor(55,96,176),o.text("Resumen de Taras",14,20),o.setFontSize(18),o.setTextColor(0,0,0);const r=new Date(e.fecha);r.setDate(r.getDate()+1);const n=r.toLocaleDateString();o.text("Fecha: "+n,14,30),o.setFontSize(18),o.text("Carga con: "+(e.cargaCon||"No especificado"),14,40);const c=s(e,t);o.autoTable({startY:50,head:[["Cliente","Abiertas","Cerradas","Total"]],body:c.filas,foot:[["Total",c.totales.abiertas,c.totales.cerradas,c.totales.total]],theme:"grid",styles:{fontSize:18,cellPadding:8},headStyles:{fillColor:[255,255,255],textColor:[0,0,0],fontSize:20,fontStyle:"bold",halign:"center",lineWidth:1,lineColor:[0,0,0]},footStyles:{fillColor:[255,255,255],textColor:[0,0,0],fontSize:20,fontStyle:"bold",halign:"center",lineWidth:1,lineColor:[0,0,0]},bodyStyles:{fontSize:18,halign:"center"},alternateRowStyles:{fillColor:[248,249,250]},didDrawPage:function(e){const t=o.internal.pageSize,a=t.height?t.height:t.getHeight();o.setFontSize(8),o.setTextColor(55,96,176),o.text("© 2025 Rey Pez - Tampico, Tamps.",t.width/2,a-10,{align:"center"})}}),o.save("resumen-taras.pdf")}function s(e,t){const o=new Map;let a={abiertas:0,cerradas:0,total:0};const n=[{id:"1",nombre:"Joselito"},{id:"2",nombre:"Catarro"},{id:"3",nombre:"Otilio"},{id:"4",nombre:"Ozuna"},{id:"5",nombre:"Lorena"}];n.forEach(e=>{o.set(e.nombre,{abiertas:0,cerradas:0})}),e.productos.forEach(e=>{const t=e.clienteId.toString(),r=n.find(e=>e.id===t);if(r){const t=r.nombre,n=c(e),s=o.get(t);s.abiertas+=n,a.abiertas+=n}}),e.clienteCrudos&&Object.entries(e.clienteCrudos).forEach(([e,t])=>{const r=n.find(t=>t.id===e);if(r){const e=r.nombre,n=i(t),s=o.get(e);s.cerradas+=n,a.cerradas+=n}});const s=Array.from(o.entries()).filter(([e,t])=>t.abiertas>0||t.cerradas>0).map(([e,t])=>{const o=t.abiertas+t.cerradas;return[{content:e,styles:{textColor:r[e]||"#000000"}},t.abiertas,t.cerradas,o]});return a.total=a.abiertas+a.cerradas,{filas:s,totales:a}}function c(e){const t=(e.taras||[]).reduce((e,t)=>e+("number"===typeof t?t:0),0),o=(e.tarasExtra||[]).reduce((e,t)=>e+("number"===typeof t?t:0),0);return t+o}function i(e){return e.reduce((e,t)=>e+t.items.reduce((e,t)=>{let o=0;if(t.taras){const[e]=t.taras.split("-").map(Number);isNaN(e)||(o+=e)}if(t.sobrante){const[e]=t.sobrante.split("-").map(Number);isNaN(e)||(o+=e)}return e+o},0),0)}},fa40:function(e,t,o){"use strict";o("d9e2"),o("14d9"),o("13d5"),o("88e6"),o("70cc"),o("eb03"),o("22e5c"),o("c01e"),o("fa76"),o("8306");var a=o("1494"),r=o("fa1c");const n=e=>{if(!e)return"";let t=e.toLowerCase().trim();t=t.replace(/\b(ayer|hoy|nuevo|viejo|alt|pdf)\b/g,""),t=t.replace(/\s+/g," ").trim();const o=t.includes("c/c"),a=t.includes("s/c");let r="";return o?(r="c/c",t=t.replace(/c\/c|cc|conc/g,"").trim()):a&&(r="s/c",t=t.replace(/s\/c|sc|sinc/g,"").trim()),t=t.replace(/-/g," "),t.includes("med")&&(t.includes("gde")||t.includes("grande"))&&(t="med gde"),t.includes("med")&&(t.includes("ch")||t.includes("chica"))&&(t="med ch"),t.includes("med")&&(t.includes("esp")||t.includes("especial"))&&(t="med esp"),t.includes("med gde")||t.includes("med ch")||t.includes("med esp")||(t=t.replace(/\s+/g,"")),t=t.replace(/-/g,"/"),r&&(t=`${t} ${r}`),t=t.replace(/c\/c|cc|conc/g,"c/c"),t=t.replace(/s\/c|sc|sinc/g,"s/c"),t.includes("med gde")||t.includes("med ch")||t.includes("med esp")||(t=t.replace(/^medium$|^med$/g,"med")),t=t.replace(/^grande$|^gde$/g,"gde"),t=t.replace(/^especial$|^esp$/g,"esp"),t},s=(e,t,o=!1)=>{if(!e)return t;const a=e.toLowerCase().trim(),r=/^(\d+)-(\d+)$/.exec(a);if(r){const e=parseInt(r[1])||0,t=parseInt(r[2])||0,a=19!==t||o?t:20,n=e*a;return n}const n=a.includes("crudo");if(n&&/^\d+\*\d+(\+\d+)?$/.test(a)){const e=a.split(/[\*\+]/);if(e.length>=2){const t=parseInt(e[0])||0,o=parseInt(e[1])||0,a=19===o?20:o;let r=0;e.length>2&&(r=parseInt(e[2])||0);const n=t*a+r;return n}}return t},c=async(e,t)=>{try{const o=Object(a["h"])(),r=Object(a["c"])(o,e),n=Object(a["o"])(r,Object(a["t"])("fecha","<",t)),s=await Object(a["g"])(n);if(s.empty)return console.log("No se encontraron cuentas anteriores"),0;const c=s.docs.map(e=>{const t=e.data();return{id:e.id,fecha:t.fecha,nuevoSaldoAcumulado:t.nuevoSaldoAcumulado||0}}).sort((e,t)=>new Date(t.fecha)-new Date(e.fecha));return c.length>0?c[0].nuevoSaldoAcumulado:0}catch(o){return console.error("Error al obtener saldo acumulado anterior:",o),0}},i=async(e,t)=>{try{const o=Object(a["h"])(),r=Object(a["c"])(o,e),n=Object(a["o"])(r,Object(a["t"])("fecha","==",t)),s=await Object(a["g"])(n);return!s.empty}catch(o){throw console.error("Error al verificar si existe cuenta para la fecha:",o),o}},l=async(e,t)=>{try{const o=Object(a["h"])(),s=Object(a["c"])(o,"precios"),c=Object(a["o"])(s,Object(a["l"])("fecha","desc"),Object(a["l"])("timestamp","desc")),i=await Object(a["g"])(c),l=t?Object(r["c"])(t):Object(r["d"])(),d=new Map,u=new Map,p=[];i.docs.forEach(t=>{const o=t.data(),a=Object(r["c"])(o.fecha);if(Object(r["a"])(a,l)){const t=o.producto,r=n(o.producto);p.push({original:t,normalizada:r,precio:o.precio,clienteId:o.clienteId||"general",fecha:a}),o.clienteId===e?u.has(r)||u.set(r,o.precio):o.clienteId||d.has(r)||d.set(r,o.precio)}}),console.log(`[EMBARQUE-CUENTAS] === Normalización de medidas para precios (fecha embarque: ${l}) ===`),console.log(`[EMBARQUE-CUENTAS] Medidas específicas para ${e}:`,Array.from(u.entries())),console.log("[EMBARQUE-CUENTAS] Medidas generales:",Array.from(d.entries())),console.log(`[EMBARQUE-CUENTAS] Detalles de normalización (${p.length} registros):`,p);const f=new Map([...d,...u]);return f}catch(o){return console.error("Error al obtener precios de venta:",o),new Map}},d=e=>{if(!e)return 0;if(e.includes("-")){const t=e.split("-");if(2===t.length)return parseInt(t[1])||0}return parseInt(e)||0},u=(e,t={},o=new Map)=>{if(!e||!Array.isArray(e))return[];const a=new Map;e.forEach(e=>{if(!e.medida)return;const t=n(e.medida);let r=0;if("c/h20"===e.tipo){const t=e.reporteTaras||[],o=e.reporteBolsas||[];for(let e=0;e<t.length;e++){const a=parseInt(t[e])||0,n=parseInt(o[e])||0;r+=a*n}r*=e.camaronNeto||.65}else if(r=Array.isArray(e.kilos)?e.kilos.reduce((e,t)=>e+(Number(t)||0),0):Number(e.kilos)||0,e.restarTaras){const t=(e.taras||[]).reduce((e,t)=>e+(Number(t)||0),0);r-=3*t}const c=e.precio||e.costo||0,i=o.get(t)||e.precioVenta||c,l=s(e.medida,r,!0);if(a.has(t)){const e=a.get(t);e.kilos+=l,e.costo=c,e.precioVenta=i,e.total=e.kilos*e.costo}else a.set(t,{kilos:l,medida:e.medida,costo:c,precioVenta:i,total:l*c})}),t&&Object.values(t).forEach(e=>{e.forEach(e=>{e.items&&Array.isArray(e.items)&&e.items.forEach(e=>{if(!e.talla)return;const t=e.talla,r=n(t);let s=0;if(e.taras){const t=/^(\d+)-(\d+(?:\.\d+)?)$/.exec(e.taras);if(t){const e=parseInt(t[1])||0;s=20*e}else s=parseInt(e.taras)||0}let c=0;e.sobrante&&e.mostrarSobrante&&(c=d(e.sobrante));const i=t.toLowerCase().includes("med c/c")&&"10-19"===e.taras&&"1-10"===e.sobrante,l=i?200:s+c,u=e.precio||0,p=o.get(r)||e.precioVenta||u;if(a.has(r)){const t=a.get(r);t.kilos+=l,e.precio&&(t.costo=u,t.precioVenta=p),t.total=t.kilos*t.costo}else a.set(r,{kilos:l,medida:t,costo:u,precioVenta:p,total:l*u})})})});const r=new Map;for(const s of a.values()){const e=n(s.medida);if(r.has(e)){const t=r.get(e);t.kilos+=s.kilos,t.costo=s.costo,t.precioVenta=s.precioVenta,t.total=t.kilos*t.costo}else r.set(e,{...s,medida:e})}return Array.from(r.values())},p=(e,t={},o=new Map)=>{if(!e||!Array.isArray(e))return[];const a=u(e,t,o),r=new Map;e.forEach(e=>{if(!e.medida)return;const t=n(e.medida);let a=0;if("c/h20"===e.tipo){const t=e.reporteTaras||[],o=e.reporteBolsas||[];for(let e=0;e<t.length;e++){const r=parseInt(t[e])||0,n=parseInt(o[e])||0;a+=r*n}a*=e.camaronNeto||.65}else if(a=Array.isArray(e.kilos)?e.kilos.reduce((e,t)=>e+(Number(t)||0),0):Number(e.kilos)||0,e.restarTaras){const t=(e.taras||[]).reduce((e,t)=>e+(Number(t)||0),0);a-=3*t}const c=o.get(t)||e.precioVenta||e.precio||0,i=s(e.medida,a,!1);if(r.has(t)){const e=r.get(t);e.kilosVenta+=i,e.precioVenta=c,e.totalVenta=e.kilosVenta*e.precioVenta}else r.set(t,{kilosVenta:i,medida:e.medida,precioVenta:c,totalVenta:i*c,ganancia:0})}),t&&Object.values(t).forEach(e=>{e.forEach(e=>{e.items&&Array.isArray(e.items)&&e.items.forEach(e=>{if(!e.talla)return;const t=e.talla,a=n(t);let s=0;if(e.taras){const t=/^(\d+)-(\d+(?:\.\d+)?)$/.exec(e.taras);if(t){const e=parseInt(t[1])||0;s=20*e}else s=parseInt(e.taras)||0}let c=0;e.sobrante&&e.mostrarSobrante&&(c=parseInt(e.sobrante.split("-").pop())||0);const i=t.toLowerCase().includes("med c/c")&&"10-19"===e.taras&&"1-10"===e.sobrante,l=i?210:s+c,d=o.get(a)||e.precioVenta||e.precio||0;if(r.has(a)){const t=r.get(a);t.kilosVenta+=l,e.precio&&(t.precioVenta=d),t.totalVenta=t.kilosVenta*t.precioVenta}else r.set(a,{kilosVenta:l,medida:t,precioVenta:d,totalVenta:l*d,ganancia:0,esCrudo:!0})})})});const c=new Map;for(const s of r.values()){const e=n(s.medida);if(c.has(e)){const t=c.get(e);t.kilosVenta+=s.kilosVenta,t.precioVenta=s.precioVenta,t.totalVenta=t.kilosVenta*t.precioVenta}else c.set(e,{...s,medida:e})}const i=Array.from(c.values());return i.forEach(e=>{const t=a.find(t=>n(t.medida)===n(e.medida));t&&(e.ganancia=e.totalVenta-t.total)}),i},f=async e=>{const{fecha:t,productos:o,clienteCrudos:a}=e,r=a&&a["1"]||[],n=await l("joselito",t),s=u(o,{1:r},n),i=p(o,{1:r},n),d=s.reduce((e,t)=>e+(t.total||0),0),f=i.reduce((e,t)=>e+(t.totalVenta||0),0),m=await c("cuentasJoselito",t);return{fecha:t,items:s,itemsVenta:i,saldoAcumuladoAnterior:m,cobros:[],abonos:[],totalGeneral:d,totalGeneralVenta:f,nuevoSaldoAcumulado:m+f,estadoPagado:!1,tieneObservacion:!1,observacion:"",ultimaActualizacion:(new Date).toISOString()}},m=async e=>{const{fecha:t,productos:o,clienteCrudos:a}=e,r=a&&a["2"]||[],i=await l("catarro",t);console.log("[DEBUG] Creando cuenta de Catarro para fecha: "+t),console.log(`[DEBUG] Precios de venta cargados para fecha ${t}:`,Array.from(i.entries()));const u=[],p=[];let f=0,m=0;Array.isArray(o)&&o.forEach(e=>{if(e){let r=0;if("c/h20"===e.tipo){const t=e.reporteTaras||[],o=e.reporteBolsas||[];let a=0;for(let e=0;e<t.length;e++){const r=parseInt(t[e])||0,n=parseInt(o[e])||0;a+=r*n}r=a*(e.camaronNeto||.65),f+=t.reduce((e,t)=>e+(parseInt(t)||0),0)}else{var t,o,a;const n=(null===(t=e.kilos)||void 0===t?void 0:t.reduce((e,t)=>e+(parseFloat(t)||0),0))||0,s=(null===(o=e.taras)||void 0===o?void 0:o.reduce((e,t)=>e+(parseInt(t)||0),0))||0,c=(null===(a=e.tarasExtra)||void 0===a?void 0:a.reduce((e,t)=>e+(parseInt(t)||0),0))||0;f+=s+c;const i=e.restarTaras?3*s:0;r=Number((n-i).toFixed(1))}let c=e.nombreAlternativoPDF||e.medida||"";const l=n(c),d=e.precio||e.costo||0,m=i.get(l)||e.precio||0;i.get(l)?console.log(`[DEBUG] Usando precio histórico para ${c}: $${m}`):e.precio?console.log(`[DEBUG] Usando precio del producto para ${c}: $${m} (no hay precio histórico)`):console.log(`[DEBUG] No hay precio definido para ${c}, usando $0`);const g=s(c,r,!0),h=s(c,r,!1);if(r>0){const e=Math.round(g),t=Math.round(h);u.push({kilos:e,medida:c,costo:d,total:e*d}),p.push({kilosVenta:t,medida:c,precioVenta:m,totalVenta:t*m,ganancia:t*m-e*d})}}}),Array.isArray(r)&&r.forEach(e=>{e&&Array.isArray(e.items)&&e.items.forEach(e=>{if(e){let t=0;if(e.taras){const o=/^(\d+)-(\d+(?:\.\d+)?)$/.exec(e.taras);if(o){const e=parseInt(o[1])||0;t=20*e,m+=e}else t=parseInt(e.taras)||0,m+=1}let o=0;if(e.sobrante&&e.mostrarSobrante){o=d(e.sobrante);const t=/^(\d+)-(\d+(?:\.\d+)?)$/.exec(e.sobrante);if(t){const e=parseInt(t[1])||0;m+=e}}const a=(e.talla||"").toLowerCase().includes("med c/c")&&"10-19"===e.taras&&"1-10"===e.sobrante,r=a?200:t+o,s=e.talla||"Crudo",c=n(s),l=e.precio||0,f=i.get(c)||e.precio||0;let g=0;if(e.taras){const t=/^(\d+)-(\d+(?:\.\d+)?)$/.exec(e.taras);if(t){const e=parseInt(t[1])||0;g=20*e}else g=parseInt(e.taras)||0}let h=0;e.sobrante&&e.mostrarSobrante&&(h=d(e.sobrante));const b=a?210:g+h;if(r>0){const e=Math.round(r),t=Math.round(b);u.push({kilos:e,medida:s,costo:l,total:e*l,esCrudo:!0}),p.push({kilosVenta:t,medida:s,precioVenta:f,totalVenta:t*f,ganancia:t*f-e*l,esCrudo:!0})}}})});const g=u.reduce((e,t)=>e+(t.total||0),0),h=p.reduce((e,t)=>e+(t.totalVenta||0),0),b=await c("cuentasCatarro",t),y=70*f+60*m,v=[];return y>0&&(v.push({descripcion:"Flete",monto:y}),console.log("[DEBUG] Flete calculado automáticamente:"),console.log(`  - Taras de limpio: ${f} × $70 = $${70*f}`),console.log(`  - Taras de crudo: ${m} × $60 = $${60*m}`),console.log("  - Total flete: $"+y)),{fecha:t,items:u,itemsVenta:p,saldoAcumuladoAnterior:b,cobros:v,abonos:[],totalGeneral:g,totalGeneralVenta:h,nuevoSaldoAcumulado:b+h-y,estadoPagado:!1,tieneObservacion:!1,observacion:"",ultimaActualizacion:(new Date).toISOString()}},g=async e=>{const{fecha:t,productos:o,clienteCrudos:a}=e,r=a&&a["4"]||[],s=await l("ozuna",t),i=[];Array.isArray(o)&&o.forEach(e=>{if(e){let a=0;if("c/h20"===e.tipo){const t=e.reporteTaras||[],o=e.reporteBolsas||[];let r=0;for(let e=0;e<t.length;e++){const a=parseInt(t[e])||0,n=parseInt(o[e])||0;r+=a*n}a=r*(e.camaronNeto||.65)}else{var t,o;const r=(null===(t=e.kilos)||void 0===t?void 0:t.reduce((e,t)=>e+(parseFloat(t)||0),0))||0,n=(null===(o=e.taras)||void 0===o?void 0:o.reduce((e,t)=>e+(parseInt(t)||0),0))||0,s=e.restarTaras?3*n:0;a=Number((r-s).toFixed(1))}const r=e.medida||"";let c=0;if(e.esVenta){const t=n(r),o=s.get(t);c=o||parseFloat(e.precio)||0}else c=20;a>0&&i.push({kilos:a,medida:r,costo:c,total:a*c,esVenta:e.esVenta||!1,editando:!1,campoEditando:null})}}),Array.isArray(r)&&r.forEach(e=>{e&&Array.isArray(e.items)&&e.items.forEach(e=>{if(e){let t=0;if(e.taras){const o=/^(\d+)-(\d+)$/.exec(e.taras);if(o){const e=parseInt(o[1])||0;let a=parseInt(o[2])||0;19===a&&(a=20),t+=e*a}else{const o=e.taras.split("-").map(Number);if(o.length>=2){let e=o[1]||0;19===e&&(e=20),t+=(o[0]||0)*e}}}if(e.sobrante){const o=/^(\d+)-(\d+)$/.exec(e.sobrante);if(o){const e=parseInt(o[1])||0;let a=parseInt(o[2])||0;19===a&&(a=20),t+=e*a}else{const o=e.sobrante.split("-").map(Number);if(o.length>=2){let e=o[1]||0;19===e&&(e=20),t+=(o[0]||0)*e}}}const o=t,a=e.medida||e.talla||"Crudo";let r=20;if(e.esVenta){const t=n(a),o=s.get(t);r=o||parseFloat(e.precio)||20}o>0&&i.push({kilos:o,medida:a,costo:r,total:o*r,esVenta:e.esVenta||!1,editando:!1,campoEditando:null})}})});const d=i.reduce((e,t)=>e+(t.total||0),0),u=await c("cuentasOzuna",t);return{fecha:t,items:i,saldoAcumuladoAnterior:u,cobros:[],abonos:[],totalGeneral:d,totalSaldo:u+d,nuevoSaldoAcumulado:u+d,ultimaActualizacion:(new Date).toISOString()}},h=async e=>{const{fecha:t,productos:o,clienteCrudos:a}=e,r=a&&a["3"]||[],i=await l("otilio",t),d=[],u=[];let p=0,f=0;Array.isArray(o)&&o.forEach(e=>{if(e){let r=0;if("c/h20"===e.tipo){const t=e.reporteTaras||[],o=e.reporteBolsas||[];let a=0;for(let e=0;e<t.length;e++){const r=parseInt(t[e])||0,n=parseInt(o[e])||0;a+=r*n}r=a*(e.camaronNeto||.65),p+=t.reduce((e,t)=>e+(parseInt(t)||0),0)}else{var t,o,a;const n=(null===(t=e.kilos)||void 0===t?void 0:t.reduce((e,t)=>e+(parseFloat(t)||0),0))||0,s=(null===(o=e.taras)||void 0===o?void 0:o.reduce((e,t)=>e+(parseInt(t)||0),0))||0,c=(null===(a=e.tarasExtra)||void 0===a?void 0:a.reduce((e,t)=>e+(parseInt(t)||0),0))||0;p+=s+c;const i=e.restarTaras?3*s:0;r=Number((n-i).toFixed(1))}const c=e.medida||"",l=n(c),f=20,m=i.get(l)||parseFloat(e.precio)||0,g=s(c,r,!0),h=s(c,r,!1);r>0&&(d.push({kilos:g,medida:c,costo:f,total:g*f,editando:!1,campoEditando:null}),u.push({kilosVenta:h,medida:c,precioVenta:m,totalVenta:h*m,ganancia:h*m-g*f,editando:!1,campoEditando:null}))}}),Array.isArray(r)&&r.forEach(e=>{e&&Array.isArray(e.items)&&e.items.forEach(e=>{if(e){let t=0;if(e.taras){const o=/^(\d+)-(\d+)$/.exec(e.taras);if(o){const e=parseInt(o[1])||0;let a=parseInt(o[2])||0;19===a&&(a=20),t+=e*a,f+=e}else{const o=e.taras.split("-").map(Number);if(o.length>=2){let e=o[1]||0;19===e&&(e=20),t+=(o[0]||0)*e,f+=o[0]||0}else parseInt(e.taras)&&(f+=1)}}if(e.sobrante){const o=/^(\d+)-(\d+)$/.exec(e.sobrante);if(o){const e=parseInt(o[1])||0;let a=parseInt(o[2])||0;19===a&&(a=20),t+=e*a,f+=e}else{const o=e.sobrante.split("-").map(Number);if(o.length>=2){let e=o[1]||0;19===e&&(e=20),t+=(o[0]||0)*e,f+=o[0]||0}}}const o=t,a=t,r=e.medida||e.talla||"Crudo",s=n(r),c=20,l=i.get(s)||parseFloat(e.precio)||0;o>0&&(d.push({kilos:o,medida:r,costo:c,total:o*c,esCrudo:!0,editando:!1,campoEditando:null}),u.push({kilosVenta:a,medida:r,precioVenta:l,totalVenta:a*l,ganancia:a*l-o*c,esCrudo:!0,editando:!1,campoEditando:null}))}})});const m=d.reduce((e,t)=>e+(t.total||0),0),g=u.reduce((e,t)=>e+(t.totalVenta||0),0),h=await c("cuentasOtilio",t),b=70*p+60*f,y=[];return b>0&&(y.push({descripcion:"Flete",monto:b}),console.log("[DEBUG] Flete (Otilio) calculado automáticamente:"),console.log(`  - Taras de limpio: ${p} × $70 = $${70*p}`),console.log(`  - Taras de crudo: ${f} × $60 = $${60*f}`),console.log("  - Total flete: $"+b)),{fecha:t,items:d,itemsVenta:u,saldoAcumuladoAnterior:h,cobros:y,abonos:[],totalGeneral:m,totalGeneralVenta:g,nuevoSaldoAcumulado:h+g-b,estadoPagado:!1,tieneObservacion:!1,observacion:"",ultimaActualizacion:(new Date).toISOString()}},b=async(e,t)=>{try{console.log("Iniciando creación de cuenta Joselito desde embarque");const o=await i("cuentasJoselito",e.fecha);if(o)throw new Error("Ya existe una cuenta de Joselito registrada para esta fecha.");const r=await f(e),n=Object(a["h"])(),s=await Object(a["b"])(Object(a["c"])(n,"cuentasJoselito"),r);if(console.log("Cuenta de Joselito creada con ID:",s.id),t){const e=`${window.location.origin}/cuentas-joselito/${s.id}?edit=true`;window.open(e,"_blank")}return s.id}catch(o){throw console.error("Error al crear cuenta de Joselito:",o),o}},y=async(e,t)=>{try{console.log("Iniciando creación de cuenta Catarro desde embarque");const o=await i("cuentasCatarro",e.fecha);if(o)throw new Error("Ya existe una cuenta de Catarro registrada para esta fecha.");const r=await m(e),n=Object(a["h"])(),s=await Object(a["b"])(Object(a["c"])(n,"cuentasCatarro"),r);if(console.log("Cuenta de Catarro creada con ID:",s.id),t){const e=`${window.location.origin}/cuentas-catarro/${s.id}?edit=true`;window.open(e,"_blank")}return s.id}catch(o){throw console.error("Error al crear cuenta de Catarro:",o),o}},v=async(e,t)=>{try{console.log("Iniciando creación de cuenta Ozuna desde embarque");const o=await i("cuentasOzuna",e.fecha);if(o)throw new Error("Ya existe una cuenta de Ozuna registrada para esta fecha.");const r=await g(e),n=Object(a["h"])(),s=await Object(a["b"])(Object(a["c"])(n,"cuentasOzuna"),r);if(console.log("Cuenta de Ozuna creada con ID:",s.id),t){const e=`${window.location.origin}/cuentas-ozuna/${s.id}?edit=true`;window.open(e,"_blank")}return s.id}catch(o){throw console.error("Error al crear cuenta de Ozuna:",o),o}},w=async(e,t)=>{try{console.log("Iniciando creación de cuenta Otilio desde embarque");const o=await i("cuentasOtilio",e.fecha);if(o)throw new Error("Ya existe una cuenta de Otilio registrada para esta fecha.");const r=await h(e),n=Object(a["h"])(),s=await Object(a["b"])(Object(a["c"])(n,"cuentasOtilio"),r);if(console.log("Cuenta de Otilio creada con ID:",s.id),t){const e=`${window.location.origin}/cuentas-otilio/${s.id}?edit=true`;window.open(e,"_blank")}return s.id}catch(o){throw console.error("Error al crear cuenta de Otilio:",o),o}},A=async e=>{var t;const{fecha:o,productos:a,clienteCrudos:r}=e;console.log("[DEBUG] Datos de embarque recibidos:",e),console.log("[DEBUG] Productos recibidos:",a),console.log("[DEBUG] ClienteCrudos recibidos:",r);const s=r&&r["5"]||[];console.log("[DEBUG] Crudos de Veronica encontrados:",s);const i=await l("veronica",o);console.log("[DEBUG] Creando cuenta de Veronica para fecha: "+o),console.log(`[DEBUG] Precios de venta cargados para fecha ${o}:`,Array.from(i.entries()));const u=(null===e||void 0===e?void 0:e.costosPorMedida)||{},p=e=>{if(null===e||void 0===e)return null;if("number"===typeof e)return Number.isFinite(e)?Number(e):null;if("string"===typeof e){const t=Number(e);return Number.isNaN(t)?null:t}if("object"===typeof e){if(void 0!==e.costoBase&&null!==e.costoBase&&""!==e.costoBase){const t=Number(e.costoBase);return Number.isNaN(t)?null:t}if(void 0!==e.costo&&null!==e.costo&&""!==e.costo){const t=Number(e.costo);return Number.isNaN(t)?null:t}}return null},f=(...e)=>{for(const t of e){if(null===t||void 0===t||""===t)continue;const e=Number(t);if(!Number.isNaN(e))return e}return 0},m=(e,t)=>{const o=new Set;e&&(o.add(e),o.add(e.replace(/-/g,"/"))),t&&o.add(t);const a=e?n(e):"";return a&&o.add(a),Array.from(o).filter(Boolean)},g=(e,t,o)=>{if(!e)return{valor:null,clave:null};const a=m(t,o);for(const n of a)if(e instanceof Map){if(e.has(n))return{valor:e.get(n),clave:n}}else if(Object.prototype.hasOwnProperty.call(e,n))return{valor:e[n],clave:n};const r=n(t),s=e instanceof Map?Array.from(e.entries()):Object.entries(e||{});for(const[c,i]of s)if(n(c)===r)return{valor:i,clave:c};return{valor:null,clave:null}},h=Array.isArray(null===e||void 0===e?void 0:e.productosTotales)?e.productosTotales:Array.isArray(a)?a:[],b=(null===e||void 0===e?void 0:e.clienteCrudosTotales)||r||{},y=new Map,v=(e,t)=>{if(!e||!t||t<=0)return;const o=n(e);if(!o)return;const a=y.get(o);a?a.kilos+=t:y.set(o,{kilos:t,medidaOriginal:e})};Array.isArray(h)&&h.forEach(e=>{if(!e)return;let t=0;if("c/h20"===e.tipo){const o=e.reporteTaras||[],a=e.reporteBolsas||[];let r=0;for(let e=0;e<o.length;e++){const t=parseInt(o[e])||0,n=parseInt(a[e])||0;r+=t*n}t=r*(e.camaronNeto||.65)}else{var o,a;const r=(null===(o=e.kilos)||void 0===o?void 0:o.reduce((e,t)=>e+(parseFloat(t)||0),0))||0,n=(null===(a=e.taras)||void 0===a?void 0:a.reduce((e,t)=>e+(parseInt(t)||0),0))||0,s=e.restarTaras?3*n:0;t=Number((r-s).toFixed(1))}if(t>0){const o=e.nombreAlternativoPDF||e.medida||"";v(o,t)}}),b&&"object"===typeof b&&Object.values(b).forEach(e=>{Array.isArray(e)&&e.forEach(e=>{e&&Array.isArray(e.items)&&e.items.forEach(e=>{if(!e)return;let t=0;if(e.taras){const o=/^(\d+)-(\d+(?:\.\d+)?)$/.exec(e.taras);if(o){const e=parseInt(o[1])||0,a=parseFloat(o[2])||0;t=e*a}else t=parseFloat(e.taras)||0}let o=0;e.sobrante&&e.mostrarSobrante&&(o=d(e.sobrante));const a=t+o;if(a>0){const t=e.talla||"Crudo";v(t,a)}})})});const w=(t,o)=>{const a=null===e||void 0===e?void 0:e.kilosCrudos;if(!a||"object"!==typeof a)return null;const{valor:r}=g(a,t,o);if(null===r||void 0===r)return null;if("number"===typeof r||"string"===typeof r){const e=Number(r);return Number.isNaN(e)?null:e}if("object"===typeof r){let e=0;return Object.values(r).forEach(t=>{const o=Number(t);Number.isNaN(o)||(e+=o)}),e>0?e:null}return null},A=(null===e||void 0===e?void 0:e.aplicarCostoExtra)||{},C=Number(null!==(t=null===e||void 0===e?void 0:e.costoExtra)&&void 0!==t?t:18),E=(e,t,o=0)=>{const{valor:a}=g(u,e,t),r=p(a);if(null===r)return{costoFinal:null,costoBase:null};const n=y.get(t),s=(null===n||void 0===n?void 0:n.kilos)||0,c=o>0?Math.max(s,o):s,i=w(e,t);if(!i||!c)return{costoFinal:null,costoBase:r};const l=i/c;if(!Number.isFinite(l)||l<=0)return{costoFinal:null,costoBase:r};const d=Math.round(100*l)/100,{valor:f}=g(A,e,t),m=Boolean(f),h=Math.round(r*d+(m?C:0));return console.log(`[DEBUG] Costo calculado para ${e}: base=${r}, totalEmbarcado=${c}, kilosCrudos=${i}, rendimiento=${d}, extra=${m?C:0}, final=${h}`),{costoFinal:h,costoBase:r}},x=y.size>0,I=new Map,$=(e,t,o)=>{if(!x){const e=(I.get(t)||0)+(o||0);return I.set(t,e),e}return 0},S=[],O=[];let V=0,N=0;console.log("[DEBUG] Procesando productos normales. Es array:",Array.isArray(a)),Array.isArray(a)&&(console.log("[DEBUG] Cantidad de productos a procesar:",a.length),a.forEach((e,t)=>{if(console.log(`[DEBUG] Procesando producto ${t}:`,e),e){let t=0;if("c/h20"===e.tipo){const o=e.reporteTaras||[],a=e.reporteBolsas||[];let r=0;for(let e=0;e<o.length;e++){const t=parseInt(o[e])||0,n=parseInt(a[e])||0;r+=t*n}t=r*(e.camaronNeto||.65);const n=o.reduce((e,t)=>e+(parseInt(t)||0),0);V+=n}else{var o,a,r;const n=(null===(o=e.kilos)||void 0===o?void 0:o.reduce((e,t)=>e+(parseFloat(t)||0),0))||0,s=(null===(a=e.taras)||void 0===a?void 0:a.reduce((e,t)=>e+(parseInt(t)||0),0))||0,c=(null===(r=e.tarasExtra)||void 0===r?void 0:r.reduce((e,t)=>e+(parseInt(t)||0),0))||0,i=s+c;V+=i;const l=e.restarTaras?3*s:0;t=Number((n-l).toFixed(1))}let s=e.nombreAlternativoPDF||e.medida||"";const c=n(s),l=$(s,c,t),{costoFinal:d,costoBase:u}=E(s,c,l),p=Number(null!==d?d:null!==u?u:f(e.precio,e.costo))||0,m=i.get(c)||e.precio||0;if(console.log(`[DEBUG] Producto procesado: ${s}, kilos: ${t}, costo: ${p}, precio: ${m}`),t>0){x||v(s,t),S.push({kilos:t,medida:s,costo:p,total:t*p});const e=t*m,o=e-t*p;O.push({kilosVenta:t,medida:s,precioVenta:m,totalVenta:e,ganancia:o})}}})),console.log("[DEBUG] Procesando crudos de Veronica. Es array:",Array.isArray(s)),console.log("[DEBUG] Cantidad de crudos a procesar:",s.length),Array.isArray(s)&&s.forEach((e,t)=>{console.log(`[DEBUG] Procesando crudo ${t}:`,e),e&&Array.isArray(e.items)&&(console.log(`[DEBUG] Crudo ${t} tiene ${e.items.length} items`),e.items.forEach((e,t)=>{if(console.log(`[DEBUG] Procesando item de crudo ${t}:`,e),e){let t=0;if(e.taras){const o=/^(\d+)-(\d+(?:\.\d+)?)$/.exec(e.taras);if(o){const e=parseInt(o[1])||0,a=parseFloat(o[2])||0;t=e*a}else t=parseInt(e.taras)||0}let o=0;e.sobrante&&e.mostrarSobrante&&(o=d(e.sobrante));const a=t+o,r=e.talla||"Crudo",s=n(r),c=$(r,s,a),{costoFinal:l,costoBase:u}=E(r,s,c),p=Number(null!==l?l:null!==u?u:f(e.precio))||0,m=i.get(s)||e.precio||0;let g=0;if(e.taras){const t=/^(\d+)-(\d+(?:\.\d+)?)$/.exec(e.taras);if(t){const e=parseInt(t[1])||0;g=20*e}else g=parseInt(e.taras)||0}let h=0;e.sobrante&&e.mostrarSobrante&&(h=d(e.sobrante));const b=g+h;if(a>0){x||v(r,a),console.log(`[DEBUG] Agregando item de crudo: ${r}, kilosCosto: ${a}, kilosVenta: ${b}, costo: ${p}, precio: ${m}`),S.push({kilos:a,medida:r,costo:p,total:a*p});const t=b*m,o=t-a*p;if(O.push({kilosVenta:b,medida:r,precioVenta:m,totalVenta:t,ganancia:o}),e.taras){const t=/^(\d+)-(\d+(?:\.\d+)?)$/.exec(e.taras);if(t){const e=parseInt(t[1])||0;N+=e}else N+=1}}else console.log(`[DEBUG] Item de crudo omitido (kilos <= 0): ${r}, kilosCosto: ${a}`)}}))});const k=S.reduce((e,t)=>e+t.total,0),D=O.reduce((e,t)=>e+t.totalVenta,0),B=await c("cuentasVeronica",o),j=[];console.log("[DEBUG] Flete para Veronica: No se calcula automáticamente"),console.log("  - Total taras limpios: "+V),console.log("  - Total taras crudos: "+N),console.log("  - El flete se debe agregar manualmente si es necesario"),console.log("[DEBUG] Items finales generados:",S),console.log("[DEBUG] ItemsVenta finales generados:",O),console.log("[DEBUG] Total general: "+k),console.log("[DEBUG] Total general venta: "+D);const T={fecha:o,items:S,itemsVenta:O,saldoAcumuladoAnterior:B,cobros:j,abonos:[],totalGeneral:k,totalGeneralVenta:D,nuevoSaldoAcumulado:B+D,estadoPagado:!1,tieneObservacion:!1,observacion:"",ultimaActualizacion:(new Date).toISOString()};return console.log("[DEBUG] Datos finales de cuenta de Veronica:",T),T},C=async(e,t)=>{try{console.log("Iniciando creación de cuenta Veronica desde embarque"),console.log("Datos de embarque recibidos en crearCuentaVeronica:",e);const o=await i("cuentasVeronica",e.fecha);if(o)throw new Error("Ya existe una cuenta de Veronica registrada para esta fecha.");console.log("Llamando a prepararDatosCuentaVeronica...");const r=await A(e);console.log("Datos de cuenta preparados:",r);const n=Object(a["h"])(),s=await Object(a["b"])(Object(a["c"])(n,"cuentasVeronica"),r);if(console.log("Cuenta de Veronica creada con ID:",s.id),t){const e=`${window.location.origin}/cuentas-veronica/${s.id}?edit=true`;window.open(e,"_blank")}return s.id}catch(o){throw console.error("Error al crear cuenta de Veronica:",o),o}};t["a"]={crearCuentaJoselito:b,crearCuentaCatarro:y,crearCuentaOzuna:v,crearCuentaOtilio:w,crearCuentaVeronica:C}}}]);