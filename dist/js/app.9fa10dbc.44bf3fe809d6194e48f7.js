(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["app.9fa10dbc"],{"0b03":function(e,t,o){"use strict";o("1a1a")},"10f2":function(e,t,o){"use strict";var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"reporte-cuentas-veronica"},[t("div",{staticClass:"inputs-fechas"},[t("label",[e._v(" Desde "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.fechaInicio,expression:"fechaInicio"}],attrs:{type:"date"},domProps:{value:e.fechaInicio},on:{input:function(t){t.target.composing||(e.fechaInicio=t.target.value)}}})]),t("label",[e._v(" Hasta "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.fechaFin,expression:"fechaFin"}],attrs:{type:"date"},domProps:{value:e.fechaFin},on:{input:function(t){t.target.composing||(e.fechaFin=t.target.value)}}})])]),t("button",{staticClass:"btn-generar",attrs:{disabled:!e.fechasValidas||e.isGenerating},on:{click:e.generarReporte}},[e._v(" "+e._s(e.isGenerating?"Generando...":"Generar PDF")+" ")]),e.totalRegistros>0?t("p",{staticClass:"detalle-registros"},[e._v(" Incluye "+e._s(e.totalRegistros)+" registro"+e._s(1===e.totalRegistros?"":"s")+". ")]):e._e(),e.errorMessage?t("p",{staticClass:"mensaje-error"},[e._v(e._s(e.errorMessage))]):e._e()])},r=[],i=o("dc59"),s=o("1494"),n=o("b3e1"),c={name:"ReporteCuentasVeronicaButton",data(){return{fechaInicio:"",fechaFin:"",isGenerating:!1,errorMessage:"",totalRegistros:0}},computed:{fechasValidas(){return this.fechaInicio&&this.fechaFin&&this.fechaInicio<=this.fechaFin}},created(){this.establecerFechasIniciales()},methods:{establecerFechasIniciales(){const e=new Date,t=new Date;t.setDate(e.getDate()-7),this.fechaFin=this.formatearFechaInput(e),this.fechaInicio=this.formatearFechaInput(t)},formatearFechaInput(e){const t=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return`${t}-${o}-${a}`},async generarReporte(){if(this.fechasValidas){this.isGenerating=!0,this.errorMessage="",this.totalRegistros=0;try{const e=Object(s["c"])(i["a"],"cuentasVeronica"),t=Object(s["o"])(e,Object(s["l"])("fecha","asc"),Object(s["t"])("fecha",">=",this.fechaInicio),Object(s["t"])("fecha","<=",this.fechaFin)),o=await Object(s["g"])(t),a=o.docs.map(e=>({id:e.id,...e.data()}));if(!a.length)return void(this.errorMessage="No hay registros de cuentas en el rango seleccionado.");this.totalRegistros=a.length,await Object(n["a"])({fechaInicio:this.fechaInicio,fechaFin:this.fechaFin,registros:a})}catch(e){console.error("Error al generar el reporte de cuentas:",e),this.errorMessage=e.message||"Ocurri√≥ un error al generar el reporte."}finally{this.isGenerating=!1}}else this.errorMessage="Selecciona un rango de fechas v√°lido."}}},l=c,d=(o("24ad"),o("2877")),u=Object(d["a"])(l,a,r,!1,null,"43157b03",null);t["a"]=u.exports},"1a1a":function(e,t,o){},"24ad":function(e,t,o){"use strict";o("9723")},"25e4":function(e,t,o){"use strict";o("56bd")},"260b":function(e,t,o){"use strict";o("9655")},"2ee0":function(e,t,o){"use strict";var a=function(){var e=this,t=e._self._c;return t("button",{staticClass:"btn-reporte-semanal",attrs:{disabled:e.generando},on:{click:e.generarPDF}},[e._v(" "+e._s(e.generando?"Generando PDF...":"üìÑ Descargar PDF")+" ")])},r=[],i=(o("14d9"),o("8baf")),s=(o("0da4"),o("c1df")),n=o.n(s),c={name:"ReporteSemanalPDFButton",props:{reporteData:{type:Object,required:!0,validator:e=>e.hasOwnProperty("totalVenta")&&e.hasOwnProperty("totalAbonado")&&e.hasOwnProperty("faltante")&&e.hasOwnProperty("startDate")&&e.hasOwnProperty("endDate")},detalleVentas:{type:Array,required:!0},detalleAbonos:{type:Array,required:!0}},data(){return{generando:!1}},methods:{formatNumber(e){return e.toLocaleString("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2})},generarPDF(){this.generando=!0;try{const e=new i["default"]("p","mm","letter"),t=e.internal.pageSize.getWidth(),o=e.internal.pageSize.getHeight();let a=20;if(e.setFillColor(255,140,0),e.rect(0,0,t,20,"F"),e.setTextColor(255,255,255),e.setFontSize(16),e.setFont("helvetica","bold"),e.text("REPORTE SEMANAL - Cuentas Veronica",t/2,13,{align:"center"}),a=28,e.setTextColor(100,100,100),e.setFontSize(9),e.text(`Periodo: ${this.reporteData.startDate} - ${this.reporteData.endDate}`,t/2,a,{align:"center"}),a+=6,e.setFillColor(245,245,245),e.roundedRect(15,a,t-30,25,2,2,"F"),a+=7,e.setTextColor(0,0,0),e.setFontSize(10),e.setFont("helvetica","bold"),e.text("Enviado en Venta:",20,a),e.setFont("helvetica","bold"),e.text("$"+this.formatNumber(this.reporteData.totalVenta),t-20,a,{align:"right"}),a+=6,e.setFont("helvetica","bold"),e.setTextColor(76,175,80),e.text("Total Abonado:",20,a),e.setFont("helvetica","bold"),e.text("$"+this.formatNumber(this.reporteData.totalAbonado),t-20,a,{align:"right"}),a+=6,e.setFont("helvetica","bold"),this.reporteData.faltante<0?(e.setTextColor(33,150,243),e.text("Abono a cuenta:",20,a),e.setFont("helvetica","bold"),e.text("$"+this.formatNumber(Math.abs(this.reporteData.faltante)),t-20,a,{align:"right"})):(e.setTextColor(244,67,54),e.text("Faltante (Deuda):",20,a),e.setFont("helvetica","bold"),e.text("$"+this.formatNumber(this.reporteData.faltante),t-20,a,{align:"right"})),a+=8,e.setTextColor(0,0,0),e.setFontSize(10),e.setFont("helvetica","bold"),e.text("DETALLE DE VENTAS",15,a),a+=4,0===this.detalleVentas.length)e.setFontSize(8),e.setFont("helvetica","italic"),e.setTextColor(150,150,150),e.text("No hay ventas registradas en esta semana",20,a),a+=6;else{const t=this.detalleVentas.map(e=>[e.fecha,"$"+this.formatNumber(e.monto)]);t.push(["TOTAL","$"+this.formatNumber(this.reporteData.totalVenta)]),e.autoTable({startY:a,head:[["Fecha","Monto"]],body:t,theme:"grid",headStyles:{fillColor:[255,140,0],textColor:[255,255,255],fontStyle:"bold",fontSize:10,cellPadding:2},bodyStyles:{fontSize:9,fontStyle:"bold",cellPadding:2},columnStyles:{0:{cellWidth:120},1:{cellWidth:"auto",halign:"right"}},margin:{left:15,right:15},didDrawPage:e=>{a=e.cursor.y},didParseCell:e=>{e.row.index===t.length-1&&(e.cell.styles.fillColor=[255,235,205],e.cell.styles.fontStyle="bold",e.cell.styles.fontSize=10,e.cell.styles.textColor=[0,0,0])}}),a=e.lastAutoTable.finalY+6}if(a>o-60&&(e.addPage(),a=15),e.setTextColor(0,0,0),e.setFontSize(10),e.setFont("helvetica","bold"),e.text("DETALLE DE ABONOS",15,a),a+=4,0===this.detalleAbonos.length)e.setFontSize(8),e.setFont("helvetica","italic"),e.setTextColor(150,150,150),e.text("No hay abonos registrados en esta semana",20,a),a+=6;else{const t=this.detalleAbonos.map(e=>[e.fecha,e.descripcion||"Sin descripci√≥n","$"+this.formatNumber(e.monto)]);t.push(["","TOTAL","$"+this.formatNumber(this.reporteData.totalAbonado)]),e.autoTable({startY:a,head:[["Fecha","Descripci√≥n","Monto"]],body:t,theme:"grid",headStyles:{fillColor:[76,175,80],textColor:[255,255,255],fontStyle:"bold",fontSize:10,cellPadding:2},bodyStyles:{fontSize:9,fontStyle:"bold",cellPadding:2},columnStyles:{0:{cellWidth:50},1:{cellWidth:90},2:{cellWidth:"auto",halign:"right"}},margin:{left:15,right:15},didParseCell:e=>{e.row.index===t.length-1&&(e.cell.styles.fillColor=[200,230,201],e.cell.styles.fontStyle="bold",e.cell.styles.fontSize=10,e.cell.styles.textColor=[0,0,0])}})}const r=e.internal.getNumberOfPages();for(let i=1;i<=r;i++)e.setPage(i),e.setFontSize(8),e.setTextColor(150,150,150),e.setFont("helvetica","normal"),e.text("Generado el "+n()().format("DD/MM/YYYY HH:mm"),15,o-10),e.text(`P√°gina ${i} de ${r}`,t-15,o-10,{align:"right"});const s=`Reporte_Semanal_${this.reporteData.startDate.replace(/\//g,"-")}_al_${this.reporteData.endDate.replace(/\//g,"-")}.pdf`;e.save(s)}catch(e){console.error("Error generando PDF:",e),alert("Error al generar el PDF. Por favor, intenta de nuevo.")}finally{this.generando=!1}}}},l=c,d=(o("5df7"),o("2877")),u=Object(d["a"])(l,a,r,!1,null,"0cb1b6e8",null);t["a"]=u.exports},"404e":function(e,t,o){},4918:function(e,t,o){},"4c15":function(e,t,o){"use strict";var a=function(){var e,t=this,o=t._self._c;return t.mostrar?o("div",{staticClass:"modal-overlay",on:{click:t.cerrarModal}},[o("div",{staticClass:"modal-content abono-general-modal",on:{click:function(e){e.stopPropagation()}}},[o("div",{staticClass:"modal-header"},[o("h2",[t._v("Abono General - "+t._s(null===(e=t.proveedor)||void 0===e?void 0:e.nombre))]),o("button",{staticClass:"close-button",on:{click:function(e){return t.$emit("cerrar")}}},[t._v("√ó")])]),o("div",{staticClass:"modal-body"},[t.proveedor?o("div",[o("div",{staticClass:"proveedor-info"},[o("div",{staticClass:"info-card"},[o("h3",[t._v("Resumen de Deudas")]),o("div",{staticClass:"resumen-items"},[o("div",{staticClass:"resumen-item"},[o("span",{staticClass:"label"},[t._v("Total deudas pendientes:")]),o("span",{staticClass:"valor"},[t._v(t._s(t.deudasPendientes.length))])]),o("div",{staticClass:"resumen-item"},[o("span",{staticClass:"label"},[t._v("Saldo total pendiente:")]),o("span",{staticClass:"valor saldo-total"},[t._v("$"+t._s(t.formatNumber(t.saldoTotalPendiente)))])])])])]),o("div",{staticClass:"form-abono"},[o("h3",[t._v("Realizar Abono General")]),o("div",{staticClass:"form-group"},[o("label",{attrs:{for:"fechaAbono"}},[t._v("Fecha del abono:")]),o("input",{directives:[{name:"model",rawName:"v-model",value:t.nuevoAbono.fecha,expression:"nuevoAbono.fecha"}],attrs:{id:"fechaAbono",type:"date",required:""},domProps:{value:t.nuevoAbono.fecha},on:{input:function(e){e.target.composing||t.$set(t.nuevoAbono,"fecha",e.target.value)}}})]),o("div",{staticClass:"form-group"},[o("label",{attrs:{for:"descripcionAbono"}},[t._v("Descripci√≥n:")]),o("input",{directives:[{name:"model",rawName:"v-model",value:t.nuevoAbono.descripcion,expression:"nuevoAbono.descripcion"}],attrs:{id:"descripcionAbono",type:"text",placeholder:"Ej: Pago general, Transferencia, etc.",required:""},domProps:{value:t.nuevoAbono.descripcion},on:{input:function(e){e.target.composing||t.$set(t.nuevoAbono,"descripcion",e.target.value)}}})]),o("div",{staticClass:"form-group"},[o("label",{attrs:{for:"montoAbono"}},[t._v("Monto total a abonar:")]),o("input",{directives:[{name:"model",rawName:"v-model.number",value:t.nuevoAbono.monto,expression:"nuevoAbono.monto",modifiers:{number:!0}}],attrs:{id:"montoAbono",type:"number",max:t.saldoTotalPendiente,min:"1",step:"0.01",placeholder:"0.00",required:""},domProps:{value:t.nuevoAbono.monto},on:{input:function(e){e.target.composing||t.$set(t.nuevoAbono,"monto",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}})]),t.nuevoAbono.monto>0?o("div",{staticClass:"distribucion-preview"},[o("h4",[t._v("Distribuci√≥n del abono:")]),o("div",{staticClass:"deudas-list"},t._l(t.distribucionCalculada,(function(e,a){return o("div",{key:e.deudaId,staticClass:"deuda-distribucion"},[o("div",{staticClass:"deuda-info"},[o("span",{staticClass:"fecha"},[t._v(t._s(t.formatearFecha(e.fecha)))]),o("span",{staticClass:"saldo-actual"},[t._v("$"+t._s(t.formatNumber(e.saldoActual)))])]),o("div",{staticClass:"abono-aplicado"},[o("span",{staticClass:"monto-abono"},[t._v("$"+t._s(t.formatNumber(e.montoAbono)))]),o("span",{staticClass:"saldo-restante"},[t._v("(Restante: $"+t._s(t.formatNumber(e.saldoRestante))+")")])])])})),0),o("div",{staticClass:"resumen-distribucion"},[o("div",{staticClass:"total-distribuido"},[o("span",[t._v("Total distribuido: $"+t._s(t.formatNumber(t.totalDistribuido)))])]),t.montoSobrante>0?o("div",{staticClass:"monto-sobrante"},[o("span",[t._v("‚ö†Ô∏è Sobrante (se aplicar√° a la primera deuda): $"+t._s(t.formatNumber(t.montoSobrante)))])]):t._e()])]):t._e()]),o("div",{staticClass:"modal-actions"},[o("button",{staticClass:"btn-cancelar",on:{click:function(e){return t.$emit("cerrar")}}},[t._v(" Cancelar ")]),o("button",{staticClass:"btn-aplicar",attrs:{disabled:!t.puedeAplicar||t.guardando},on:{click:t.aplicarAbonoGeneral}},[t._v(" "+t._s(t.guardando?"Aplicando...":"Aplicar Abono General")+" ")])])]):o("div",{staticClass:"error-no-proveedor"},[o("div",{staticClass:"error-icon"},[t._v("‚ö†Ô∏è")]),o("h3",[t._v("No hay proveedor seleccionado")]),o("p",[t._v("Para realizar un abono general, primero debe seleccionar un proveedor en el filtro.")])])])])]):t._e()},r=[],i=(o("14d9"),o("13d5"),o("dc59")),s=o("1494"),n={name:"AbonoGeneralModal",props:{mostrar:{type:Boolean,required:!0},proveedor:{type:Object,required:!1,default:null}},emits:["cerrar","abono-aplicado"],data(){return{deudasPendientes:[],guardando:!1,nuevoAbono:{fecha:this.obtenerFechaActual(),descripcion:"",monto:null}}},computed:{saldoTotalPendiente(){return this.deudasPendientes.reduce((e,t)=>e+t.saldoPendiente,0)},puedeAplicar(){return this.nuevoAbono.fecha&&this.nuevoAbono.descripcion&&this.nuevoAbono.monto>0&&this.nuevoAbono.monto<=this.saldoTotalPendiente&&this.deudasPendientes.length>0},distribucionCalculada(){if(!this.nuevoAbono.monto||0===this.deudasPendientes.length)return[];let e=this.nuevoAbono.monto;const t=[],o=[...this.deudasPendientes].sort((e,t)=>new Date(e.fecha)-new Date(t.fecha));for(const a of o){if(e<=0)break;const o=Math.min(e,a.saldoPendiente),r=a.saldoPendiente-o;t.push({deudaId:a.id,fecha:a.fecha,saldoActual:a.saldoPendiente,montoAbono:o,saldoRestante:r}),e-=o}return t},totalDistribuido(){return this.distribucionCalculada.reduce((e,t)=>e+t.montoAbono,0)},montoSobrante(){return this.nuevoAbono.monto-this.totalDistribuido}},methods:{obtenerFechaActual(){const e=new Date,t=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return`${t}-${o}-${a}`},cerrarModal(e){e.target===e.currentTarget&&this.$emit("cerrar")},async cargarDeudasPendientes(){var e;if(null===(e=this.proveedor)||void 0===e||!e.id)return console.warn("No se puede cargar deudas: proveedor no seleccionado"),void(this.deudasPendientes=[]);try{const e=Object(s["o"])(Object(s["c"])(i["a"],"deudas"),Object(s["t"])("proveedorId","==",this.proveedor.id),Object(s["t"])("estado","==","pendiente")),t=await Object(s["g"])(e);let o=t.docs.map(e=>({id:e.id,...e.data()}));o.sort((e,t)=>{const o=new Date(e.fecha),a=new Date(t.fecha);return o-a}),this.deudasPendientes=o}catch(t){console.error("Error al cargar deudas pendientes:",t),this.deudasPendientes=[],"failed-precondition"===t.code?alert("Error de base de datos: Se requiere configurar un √≠ndice. Contacte al administrador."):alert("Error al cargar las deudas pendientes. Por favor, intente de nuevo.")}},async aplicarAbonoGeneral(){if(this.puedeAplicar)try{this.guardando=!0;for(const e of this.distribucionCalculada)if(e.montoAbono>0){await Object(s["b"])(Object(s["c"])(i["a"],"deudas",e.deudaId,"abonos"),{descripcion:this.nuevoAbono.descripcion+" (Abono General)",monto:e.montoAbono,fecha:this.nuevoAbono.fecha,fechaCreacion:new Date,esAbonoGeneral:!0});const t=e.saldoRestante,o=t<=0?"pagado":"pendiente";await Object(s["s"])(Object(s["e"])(i["a"],"deudas",e.deudaId),{saldoPendiente:t,estado:o})}if(this.montoSobrante>0&&this.distribucionCalculada.length>0){const e=this.distribucionCalculada[0];await Object(s["b"])(Object(s["c"])(i["a"],"deudas",e.deudaId,"abonos"),{descripcion:this.nuevoAbono.descripcion+" (Abono General - Sobrante)",monto:this.montoSobrante,fecha:this.nuevoAbono.fecha,fechaCreacion:new Date,esAbonoGeneral:!0});const t=e.saldoRestante-this.montoSobrante;await Object(s["s"])(Object(s["e"])(i["a"],"deudas",e.deudaId),{saldoPendiente:Math.max(0,t),estado:t<=0?"pagado":"pendiente"})}alert(`Abono general de $${this.formatNumber(this.nuevoAbono.monto)} aplicado correctamente`),this.$emit("abono-aplicado"),this.$emit("cerrar")}catch(e){console.error("Error al aplicar abono general:",e),alert("Error al aplicar el abono general: "+e.message)}finally{this.guardando=!1}},formatNumber(e){return e?e.toLocaleString("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00"},formatearFecha(e){if(!e)return"";const t=new Date(e+"T00:00:00"),o={day:"numeric",month:"short",year:"numeric"};return t.toLocaleDateString("es-ES",o)}},watch:{mostrar(e){e&&this.proveedor&&(this.cargarDeudasPendientes(),this.nuevoAbono={fecha:this.obtenerFechaActual(),descripcion:"",monto:null})}}},c=n,l=(o("c97b"),o("2877")),d=Object(l["a"])(c,a,r,!1,null,"2d20fc84",null);t["a"]=d.exports},"56bd":function(e,t,o){},"5df7":function(e,t,o){"use strict";o("e043")},"5e76":function(e,t,o){},"687e":function(e,t,o){"use strict";var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"producto-selector"},[t("div",{staticClass:"input-row"},[t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.kilos,expression:"kilos",modifiers:{number:!0}}],staticClass:"input-kilos",attrs:{type:"number",step:"0.01",placeholder:"Kilos"},domProps:{value:e.kilos},on:{input:[function(t){t.target.composing||(e.kilos=e._n(t.target.value))},function(t){return e.$emit("update:kilos",e.kilos)}],blur:function(t){return e.$forceUpdate()}}}),t("div",{staticClass:"producto-input-container"},[t("select",{directives:[{name:"model",rawName:"v-model",value:e.productoSeleccionado,expression:"productoSeleccionado"}],staticClass:"producto-select",on:{change:[function(t){var o=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.productoSeleccionado=t.target.multiple?o:o[0]},e.onProductoChange]}},[t("option",{attrs:{value:""}},[e._v("Seleccionar producto existente")]),e._l(e.productosDisponibles,(function(o){return t("option",{key:o.nombre,domProps:{value:o.nombre}},[e._v(" "+e._s(o.nombre)+" - $"+e._s(e.formatearPrecio(o.precioActual))+" ")])})),t("option",{attrs:{value:"__nuevo__"}},[e._v("+ Nuevo producto")])],2),"__nuevo__"===e.productoSeleccionado?t("input",{directives:[{name:"model",rawName:"v-model",value:e.productoManual,expression:"productoManual"}],ref:"inputProductoNuevo",staticClass:"input-producto-manual producto-nuevo",attrs:{type:"text",placeholder:"Nombre del nuevo producto"},domProps:{value:e.productoManual},on:{input:[function(t){t.target.composing||(e.productoManual=t.target.value)},e.onProductoManualChange]}}):e._e()]),t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.precio,expression:"precio",modifiers:{number:!0}}],staticClass:"input-precio",attrs:{type:"number",step:"0.01",placeholder:"Precio"},domProps:{value:e.precio},on:{input:[function(t){t.target.composing||(e.precio=e._n(t.target.value))},function(t){return e.$emit("update:precio",e.precio)}],blur:function(t){return e.$forceUpdate()}}}),t("span",{staticClass:"total-calculado"},[e._v(" Total: $"+e._s(e.calcularTotal())+" ")]),t("button",{staticClass:"add-btn",attrs:{disabled:!e.puedeAgregar},on:{click:e.agregarProducto}},[e._v(" "+e._s(e.cargandoProductos?"Cargando...":"Agregar")+" ")])]),e.productoSeleccionado&&"__nuevo__"!==e.productoSeleccionado?t("div",{staticClass:"precio-info"},[t("div",{staticClass:"precio-historico"},[t("span",{staticClass:"label"},[e._v("√öltimo precio:")]),t("span",{staticClass:"precio-valor"},[e._v("$"+e._s(e.formatearPrecio(e.precioUltimoRegistrado)))]),t("span",{staticClass:"fecha-precio"},[e._v("("+e._s(e.formatearFecha(e.fechaUltimoPrecio))+")")]),e.precio!==e.precioUltimoRegistrado?t("button",{staticClass:"btn-usar-precio",on:{click:e.usarPrecioHistorico}},[e._v(" Usar este precio ")]):e._e()]),t("div",{staticClass:"stats-producto"},[t("span",{staticClass:"total-registros"},[e._v(e._s(e.totalRegistros)+" precio(s) registrado(s)")]),t("span",{staticClass:"precio-promedio"},[e._v("Promedio: $"+e._s(e.formatearPrecio(e.precioPromedio)))])])]):e._e()])},r=[],i=(o("14d9"),o("13d5"),o("dc59")),s=o("1494"),n={name:"ProductoSelector",props:{proveedorId:{type:String,required:!0},kilosValue:{type:Number,default:null},productoValue:{type:String,default:""},precioValue:{type:Number,default:null}},emits:["update:kilos","update:producto","update:precio","agregar-producto"],data(){return{productosDisponibles:[],cargandoProductos:!1,productoSeleccionado:"",productoManual:"",kilos:this.kilosValue,precio:this.precioValue,productoHistorial:null}},computed:{puedeAgregar(){return this.kilos&&this.obtenerNombreProducto()&&this.precio&&!this.cargandoProductos},precioUltimoRegistrado(){var e;return(null===(e=this.productoHistorial)||void 0===e?void 0:e.precioActual)||0},fechaUltimoPrecio(){var e;return(null===(e=this.productoHistorial)||void 0===e?void 0:e.fechaUltimoPrecio)||""},totalRegistros(){var e;return(null===(e=this.productoHistorial)||void 0===e?void 0:e.totalRegistros)||0},precioPromedio(){var e;if(null===(e=this.productoHistorial)||void 0===e||null===(e=e.precios)||void 0===e||!e.length)return 0;const t=this.productoHistorial.precios.reduce((e,t)=>e+t.precio,0);return t/this.productoHistorial.precios.length}},methods:{async cargarProductosProveedor(){if(this.proveedorId)try{this.cargandoProductos=!0,console.log("Cargando productos para proveedor:",this.proveedorId);const e=await Object(s["g"])(Object(s["o"])(Object(s["c"])(i["a"],"historialPrecios"),Object(s["t"])("proveedorId","==",this.proveedorId))),t=e.docs.map(e=>e.data());console.log("Precios encontrados:",t.length);const o=new Map;t.forEach(e=>{const t=e.producto;o.has(t)||o.set(t,{nombre:t,precios:[]}),o.get(t).precios.push(e)}),this.productosDisponibles=Array.from(o.values()).map(e=>{const t=e.precios.sort((e,t)=>new Date(t.fecha)-new Date(e.fecha)),o=t[0];return{nombre:e.nombre,precioActual:o.precio,fechaUltimoPrecio:o.fecha,totalRegistros:e.precios.length,precios:t}}),this.productosDisponibles.sort((e,t)=>e.nombre.localeCompare(t.nombre)),console.log("Productos procesados:",this.productosDisponibles.length)}catch(e){console.error("Error al cargar productos: ",e)}finally{this.cargandoProductos=!1}else this.productosDisponibles=[]},onProductoChange(){this.productoSeleccionado&&"__nuevo__"!==this.productoSeleccionado?(this.productoHistorial=this.productosDisponibles.find(e=>e.nombre===this.productoSeleccionado),this.productoHistorial&&(this.precio=this.productoHistorial.precioActual,this.$emit("update:precio",this.precio)),this.productoManual=""):"__nuevo__"===this.productoSeleccionado?(this.productoHistorial=null,this.precio=null,this.$emit("update:precio",null),this.$nextTick(()=>{this.$refs.inputProductoNuevo&&this.$refs.inputProductoNuevo.focus()})):(this.productoHistorial=null,this.productoManual=""),this.$emit("update:producto",this.obtenerNombreProducto())},onProductoManualChange(){this.$emit("update:producto",this.productoManual)},obtenerNombreProducto(){return this.productoSeleccionado&&"__nuevo__"!==this.productoSeleccionado?this.productoSeleccionado:this.productoManual},usarPrecioHistorico(){this.precio=this.precioUltimoRegistrado,this.$emit("update:precio",this.precio)},calcularTotal(){return this.kilos&&this.precio?this.formatearPrecio(this.kilos*this.precio):"0.00"},agregarProducto(){if(!this.puedeAgregar)return;const e={kilos:this.kilos,producto:this.obtenerNombreProducto(),precio:this.precio,total:this.kilos*this.precio};this.$emit("agregar-producto",e),this.limpiarFormulario()},limpiarFormulario(){this.kilos=null,this.productoSeleccionado="",this.productoManual="",this.precio=null,this.productoHistorial=null,this.$emit("update:kilos",null),this.$emit("update:producto",""),this.$emit("update:precio",null)},formatearPrecio(e){return e?e.toLocaleString("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00"},formatearFecha(e){if(!e)return"";const t=new Date(e+"T00:00:00"),o={day:"numeric",month:"short",year:"numeric"};return t.toLocaleDateString("es-ES",o)}},watch:{proveedorId(e){e?this.cargarProductosProveedor():(this.productosDisponibles=[],this.limpiarFormulario())},kilosValue(e){this.kilos=e},productoValue(e){e!==this.obtenerNombreProducto()&&(this.productoManual=e,this.productoSeleccionado="")},precioValue(e){this.precio=e}},mounted(){this.proveedorId&&this.cargarProductosProveedor()}},c=n,l=(o("0b03"),o("2877")),d=Object(l["a"])(c,a,r,!1,null,"4870ae52",null);t["a"]=d.exports},6934:function(e,t,o){"use strict";o("404e")},"7d05":function(e,t,o){"use strict";o("5e76")},9655:function(e,t,o){},9723:function(e,t,o){},a54e:function(e,t,o){"use strict";var a=function(){var e,t=this,o=t._self._c;return t.mostrar?o("div",{staticClass:"modal-overlay",on:{click:t.cerrarModal}},[o("div",{staticClass:"modal-content historial-abonos-modal",on:{click:function(e){e.stopPropagation()}}},[o("div",{staticClass:"modal-header"},[o("h2",[t._v("Historial de Abonos - "+t._s(null===(e=t.proveedor)||void 0===e?void 0:e.nombre))]),o("button",{staticClass:"close-button",on:{click:function(e){return t.$emit("cerrar")}}},[t._v("√ó")])]),o("div",{staticClass:"modal-body"},[o("div",{staticClass:"filtros-container"},[o("div",{staticClass:"filtros-row"},[o("div",{staticClass:"filtro-grupo"},[o("label",{attrs:{for:"filtroFechaDesde"}},[t._v("Desde:")]),o("input",{directives:[{name:"model",rawName:"v-model",value:t.filtros.fechaDesde,expression:"filtros.fechaDesde"}],attrs:{id:"filtroFechaDesde",type:"date"},domProps:{value:t.filtros.fechaDesde},on:{change:t.aplicarFiltros,input:function(e){e.target.composing||t.$set(t.filtros,"fechaDesde",e.target.value)}}})]),o("div",{staticClass:"filtro-grupo"},[o("label",{attrs:{for:"filtroFechaHasta"}},[t._v("Hasta:")]),o("input",{directives:[{name:"model",rawName:"v-model",value:t.filtros.fechaHasta,expression:"filtros.fechaHasta"}],attrs:{id:"filtroFechaHasta",type:"date"},domProps:{value:t.filtros.fechaHasta},on:{change:t.aplicarFiltros,input:function(e){e.target.composing||t.$set(t.filtros,"fechaHasta",e.target.value)}}})]),o("div",{staticClass:"filtro-grupo"},[o("label",{attrs:{for:"filtroTipo"}},[t._v("Tipo:")]),o("select",{directives:[{name:"model",rawName:"v-model",value:t.filtros.tipo,expression:"filtros.tipo"}],attrs:{id:"filtroTipo"},on:{change:[function(e){var o=Array.prototype.filter.call(e.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));t.$set(t.filtros,"tipo",e.target.multiple?o:o[0])},t.aplicarFiltros]}},[o("option",{attrs:{value:""}},[t._v("Todos")]),o("option",{attrs:{value:"individual"}},[t._v("Individual")]),o("option",{attrs:{value:"general"}},[t._v("Abono General")])])]),o("div",{staticClass:"filtro-grupo"},[o("button",{staticClass:"btn-limpiar",on:{click:t.limpiarFiltros}},[t._v(" Limpiar Filtros ")])])])]),o("div",{staticClass:"estadisticas-container"},[o("div",{staticClass:"estadistica-card"},[o("div",{staticClass:"estadistica-valor"},[t._v("$"+t._s(t.formatNumber(t.estadisticas.totalAbonos)))]),o("div",{staticClass:"estadistica-label"},[t._v("Total Abonos")])]),o("div",{staticClass:"estadistica-card"},[o("div",{staticClass:"estadistica-valor"},[t._v(t._s(t.estadisticas.cantidadAbonos))]),o("div",{staticClass:"estadistica-label"},[t._v("Cantidad de Abonos")])]),o("div",{staticClass:"estadistica-card"},[o("div",{staticClass:"estadistica-valor"},[t._v("$"+t._s(t.formatNumber(t.estadisticas.promedioAbono)))]),o("div",{staticClass:"estadistica-label"},[t._v("Promedio por Abono")])])]),t.cargando?o("div",{staticClass:"loading-container"},[o("div",{staticClass:"spinner"}),o("p",[t._v("Cargando historial de abonos...")])]):t.abonosAgrupados.length>0?o("div",{staticClass:"abonos-container"},[o("div",{staticClass:"paginacion-info"},[o("p",[t._v(" Mostrando "),t.rangoPaginacion.inicio>0?o("span",[t._v(" "+t._s(t.rangoPaginacion.inicio)+" - "+t._s(t.rangoPaginacion.fin)+" ")]):o("span",[t._v("0")]),t._v(" de "+t._s(t.abonosAgrupados.length)+" movimientos ")])]),o("div",{staticClass:"abonos-list"},t._l(t.abonosPaginados,(function(e){return o("div",{key:e.id,staticClass:"abono-item",class:{"abono-general":e.esAbonoGeneral,"abono-expandido":t.esDesgloseVisible(e.id)}},[o("div",{staticClass:"abono-header",on:{click:function(o){return t.toggleDesglose(e.id)}}},[o("div",{staticClass:"abono-header-info"},[o("div",{staticClass:"abono-fecha"},[o("i",{staticClass:"fas fa-calendar-alt"}),t._v(" "+t._s(t.formatearFecha(e.fecha))+" ")]),o("div",{staticClass:"abono-descripcion-resumen"},[o("i",{staticClass:"fas fa-comment-alt"}),t._v(" "+t._s(e.descripcion||"Sin descripci√≥n")+" ")])]),o("div",{staticClass:"abono-header-actions"},[o("div",{staticClass:"abono-monto"},[t._v(" $"+t._s(t.formatNumber(e.montoTotal))+" ")]),o("div",{staticClass:"abono-tipo"},[o("span",{class:e.esAbonoGeneral?"tipo-general":"tipo-individual"},[t._v(" "+t._s(e.esAbonoGeneral?"General":"Individual")+" ")])]),o("button",{staticClass:"btn-toggle-desglose",attrs:{type:"button","aria-expanded":t.esDesgloseVisible(e.id)},on:{click:function(o){return o.stopPropagation(),t.toggleDesglose(e.id)}}},[o("i",{class:["fas",t.esDesgloseVisible(e.id)?"fa-chevron-up":"fa-chevron-down"]})])])]),o("transition",{attrs:{name:"fade"}},[t.esDesgloseVisible(e.id)?o("div",{staticClass:"abono-desglose"},[o("div",{staticClass:"abono-desglose-resumen"},[o("span",[t._v(t._s(e.items.length)+" "+t._s(1===e.items.length?"movimiento":"movimientos"))]),o("span",[t._v("Registrado: "+t._s(t.formatearFechaHora(e.ultimaCreacion)))])]),t._l(e.items,(function(e){return o("div",{key:`${e.deudaId}-${e.id}`,staticClass:"abono-detalle-item"},[o("div",{staticClass:"detalle-izquierda"},[o("div",{staticClass:"detalle-descripcion"},[t._v(t._s(e.descripcion||"Sin descripci√≥n"))]),o("div",{staticClass:"detalle-deuda"},[o("span",[t._v("Deuda del "+t._s(t.formatearFecha(e.deudaFecha)))]),o("span",[t._v("Total deuda: $"+t._s(t.formatNumber(e.deudaTotal)))])]),o("div",{staticClass:"detalle-registrado"},[e.editandoFecha?[o("label",{staticClass:"editar-fecha-label"},[t._v(" Nueva fecha de registro: "),o("input",{directives:[{name:"model",rawName:"v-model",value:e.fechaCreacionEditable,expression:"detalle.fechaCreacionEditable"}],staticClass:"input-fecha-registro",attrs:{type:"datetime-local"},domProps:{value:e.fechaCreacionEditable},on:{input:function(o){o.target.composing||t.$set(e,"fechaCreacionEditable",o.target.value)}}})]),o("div",{staticClass:"acciones-edicion-fecha"},[o("button",{staticClass:"btn-guardar-fecha",attrs:{disabled:e.guardandoFecha||!e.fechaCreacionEditable},on:{click:function(o){return o.stopPropagation(),t.guardarFechaRegistro(e)}}},[t._v(" "+t._s(e.guardandoFecha?"Guardando...":"Guardar")+" ")]),o("button",{staticClass:"btn-cancelar-fecha",attrs:{disabled:e.guardandoFecha},on:{click:function(o){return o.stopPropagation(),t.cancelarEdicionFecha(e)}}},[t._v(" Cancelar ")])])]:[o("span",[t._v("Registrado: "+t._s(t.formatearFechaHora(e.fechaCreacion)))]),o("button",{staticClass:"btn-editar-fecha",attrs:{title:"Editar fecha de registro"},on:{click:function(o){return o.stopPropagation(),t.iniciarEdicionFecha(e)}}},[o("i",{staticClass:"fas fa-edit"})])]],2)]),o("div",{staticClass:"detalle-derecha"},[o("span",{staticClass:"detalle-monto"},[t._v("$"+t._s(t.formatNumber(e.monto)))]),o("button",{staticClass:"btn-eliminar-abono",attrs:{title:"Eliminar abono"},on:{click:function(o){return o.stopPropagation(),t.confirmarEliminarAbono(e)}}},[o("i",{staticClass:"fas fa-trash-alt"})])])])}))],2):t._e()])],1)})),0),t.totalPaginas>1?o("div",{staticClass:"paginacion-container"},[o("button",{staticClass:"btn-paginacion",attrs:{disabled:1===t.paginaActual},on:{click:function(e){return t.cambiarPagina(t.paginaActual-1)}}},[o("i",{staticClass:"fas fa-chevron-left"}),t._v(" Anterior ")]),o("div",{staticClass:"paginas-numeros"},t._l(t.paginasVisibles,(function(e){return o("button",{key:e,class:["btn-pagina",{activa:e===t.paginaActual}],on:{click:function(o){return t.cambiarPagina(e)}}},[t._v(" "+t._s(e)+" ")])})),0),o("button",{staticClass:"btn-paginacion",attrs:{disabled:t.paginaActual===t.totalPaginas},on:{click:function(e){return t.cambiarPagina(t.paginaActual+1)}}},[t._v(" Siguiente "),o("i",{staticClass:"fas fa-chevron-right"})])]):t._e()]):o("div",{staticClass:"no-data"},[t._m(0),o("h3",[t._v("No hay abonos registrados")]),Object.values(t.filtros).some(e=>e)?o("p",[t._v(" No se encontraron abonos con los filtros aplicados. ")]):o("p",[t._v(" Este proveedor no tiene abonos registrados a√∫n. ")])])])])]):t._e()},r=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"no-data-icon"},[t("i",{staticClass:"fas fa-money-bill-wave"})])}],i=(o("14d9"),o("13d5"),o("dc59")),s=o("1494"),n={name:"HistorialAbonosModal",props:{mostrar:{type:Boolean,required:!0},proveedor:{type:Object,required:!0}},emits:["cerrar","abono-eliminado"],data(){return{cargando:!1,abonos:[],abonosFiltrados:[],desglosesVisibles:{},paginaActual:1,abonosPorPagina:10,filtros:{fechaDesde:"",fechaHasta:"",tipo:""}}},computed:{abonosAgrupados(){const e=new Map;for(const o of this.abonosFiltrados){const t=Boolean(o.esAbonoGeneral),a=o.fecha||this.obtenerFechaDesdeTimestamp(o.fechaCreacion),r=t?this.normalizarDescripcionGeneral(o.descripcion):o.descripcion||"Abono",i=this.parseTimestamp(o.fechaCreacion),s=i?Math.floor(i.getTime()/6e4):"sin-lote",n=t?`${a||"sin-fecha"}||${r||"general"}||${s}`:`${o.deudaId}-${o.id}`;e.has(n)||e.set(n,{id:n,esAbonoGeneral:t,fecha:a,fechaDate:this.parseFecha(a,o.fechaCreacion),descripcion:r||(t?"Abono general":"Abono"),items:[],montoTotal:0,ultimaCreacion:this.parseTimestamp(o.fechaCreacion)});const c=e.get(n);c.items.push(o),c.montoTotal+=Number(o.monto)||0;const l=this.parseFecha(o.fecha,o.fechaCreacion);l&&(!c.fechaDate||l>c.fechaDate)&&(c.fechaDate=l,c.fecha=o.fecha||c.fecha);const d=this.parseTimestamp(o.fechaCreacion);d&&(!c.ultimaCreacion||d>c.ultimaCreacion)&&(c.ultimaCreacion=d),c.descripcion||(c.descripcion=r||(t?"Abono general":"Abono"))}const t=Array.from(e.values());return t.forEach(e=>{e.items.sort((e,t)=>{const o=this.parseFecha(e.fecha,e.fechaCreacion),a=this.parseFecha(t.fecha,t.fechaCreacion);if(o&&a&&o.getTime()!==a.getTime())return a-o;if(!o&&a)return 1;if(o&&!a)return-1;const r=this.parseTimestamp(e.fechaCreacion),i=this.parseTimestamp(t.fechaCreacion);return r&&i&&r.getTime()!==i.getTime()?i-r:(Number(t.monto)||0)-(Number(e.monto)||0)})}),t.sort((e,t)=>e.fechaDate&&t.fechaDate&&e.fechaDate.getTime()!==t.fechaDate.getTime()?t.fechaDate-e.fechaDate:!e.fechaDate&&t.fechaDate?1:e.fechaDate&&!t.fechaDate?-1:e.ultimaCreacion&&t.ultimaCreacion&&e.ultimaCreacion.getTime()!==t.ultimaCreacion.getTime()?t.ultimaCreacion-e.ultimaCreacion:0),t},totalPaginas(){return Math.ceil(this.abonosAgrupados.length/this.abonosPorPagina)},abonosPaginados(){const e=(this.paginaActual-1)*this.abonosPorPagina,t=e+this.abonosPorPagina;return this.abonosAgrupados.slice(e,t)},rangoPaginacion(){if(!this.abonosAgrupados.length)return{inicio:0,fin:0};const e=(this.paginaActual-1)*this.abonosPorPagina+1,t=Math.min(this.paginaActual*this.abonosPorPagina,this.abonosAgrupados.length);return{inicio:e,fin:t}},paginasVisibles(){const e=[],t=this.totalPaginas,o=this.paginaActual;let a=Math.max(1,o-2),r=Math.min(t,a+4);r-a<4&&(a=Math.max(1,r-4));for(let i=a;i<=r;i++)e.push(i);return e},estadisticas(){const e=this.abonosFiltrados.reduce((e,t)=>e+(Number(t.monto)||0),0),t=this.abonosFiltrados.length,o=t>0?e/t:0;return{totalAbonos:e,cantidadAbonos:t,promedioAbono:o}}},methods:{cerrarModal(e){e.target===e.currentTarget&&this.$emit("cerrar")},toggleDesglose(e){const t=this.desglosesVisibles[e]||!1;this.$set(this.desglosesVisibles,e,!t)},esDesgloseVisible(e){return Boolean(this.desglosesVisibles[e])},cambiarPagina(e){e>=1&&e<=this.totalPaginas&&(this.paginaActual=e)},ordenarAbonosPorFecha(e){return e.slice().sort((e,t)=>{const o=this.parseFecha(e.fecha,e.fechaCreacion),a=this.parseFecha(t.fecha,t.fechaCreacion);if(o&&a&&o.getTime()!==a.getTime())return a-o;if(!o&&a)return 1;if(o&&!a)return-1;const r=this.parseTimestamp(e.fechaCreacion),i=this.parseTimestamp(t.fechaCreacion);return r&&i&&r.getTime()!==i.getTime()?i-r:(Number(t.monto)||0)-(Number(e.monto)||0)})},async cargarHistorialAbonos(){var e;if(null!==(e=this.proveedor)&&void 0!==e&&e.id)try{this.cargando=!0,this.abonos=[];const e=Object(s["o"])(Object(s["c"])(i["a"],"deudas"),Object(s["t"])("proveedorId","==",this.proveedor.id)),t=await Object(s["g"])(e),o=t.docs.map(e=>({id:e.id,...e.data()}));for(const a of o){const e=Object(s["o"])(Object(s["c"])(i["a"],"deudas",a.id,"abonos"),Object(s["l"])("fechaCreacion","desc")),t=await Object(s["g"])(e),o=t.docs.map(e=>({id:e.id,deudaId:a.id,deudaFecha:a.fecha,deudaTotal:a.total,editandoFecha:!1,guardandoFecha:!1,fechaCreacionEditable:"",...e.data()}));this.abonos.push(...o)}this.abonos=this.ordenarAbonosPorFecha(this.abonos),this.aplicarFiltros()}catch(t){console.error("Error al cargar historial de abonos:",t),alert("Error al cargar el historial de abonos")}finally{this.cargando=!1}},aplicarFiltros(){const e=this.abonos.filter(e=>{if(this.filtros.fechaDesde&&e.fecha<this.filtros.fechaDesde)return!1;if(this.filtros.fechaHasta&&e.fecha>this.filtros.fechaHasta)return!1;if(this.filtros.tipo){if("general"===this.filtros.tipo&&!e.esAbonoGeneral)return!1;if("individual"===this.filtros.tipo&&e.esAbonoGeneral)return!1}return!0});this.abonosFiltrados=this.ordenarAbonosPorFecha(e),this.desglosesVisibles={},this.paginaActual=1},limpiarFiltros(){this.filtros={fechaDesde:"",fechaHasta:"",tipo:""},this.aplicarFiltros()},parseFecha(e,t){if(e){const t=new Date(e+"T00:00:00");if(!Number.isNaN(t.getTime()))return t}return this.parseTimestamp(t)},parseTimestamp(e){if(!e)return null;if("function"===typeof e.toDate){const t=e.toDate();return Number.isNaN(null===t||void 0===t?void 0:t.getTime())?null:t}const t=new Date(e);return Number.isNaN(t.getTime())?null:t},obtenerFechaDesdeTimestamp(e){const t=this.parseTimestamp(e);if(!t)return"";const o=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return`${o}-${a}-${r}`},normalizarDescripcionGeneral(e=""){return e?e.replace(/\s*\(Abono General(?:[^)]*)?\)\s*$/i,"").trim():""},formatNumber(e){return e?e.toLocaleString("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00"},formatearFecha(e){if(!e)return"";const t=new Date(e+"T00:00:00"),o={day:"numeric",month:"short",year:"numeric"};return t.toLocaleDateString("es-ES",o)},formatearFechaHora(e){var t;if(!e)return"";const o=(null===e||void 0===e||null===(t=e.toDate)||void 0===t?void 0:t.call(e))||new Date(e),a={day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"};return o.toLocaleDateString("es-ES",a)},formatearFechaHoraEditable(e){const t=this.parseTimestamp(e);if(!t)return"";const o=e=>String(e).padStart(2,"0"),a=t.getFullYear(),r=o(t.getMonth()+1),i=o(t.getDate()),s=o(t.getHours()),n=o(t.getMinutes());return`${a}-${r}-${i}T${s}:${n}`},confirmarEliminarAbono(e){const t=`¬øEst√° seguro de que desea eliminar este abono?\n\nFecha: ${this.formatearFecha(e.fecha)}\nMonto: $${this.formatNumber(e.monto)}\nTipo: ${e.esAbonoGeneral?"Abono General":"Individual"}\nDescripci√≥n: ${e.descripcion}\n\nEsta acci√≥n no se puede deshacer y afectar√° el saldo de la deuda.`;confirm(t)&&this.eliminarAbono(e)},async eliminarAbono(e){try{const t=Object(s["e"])(i["a"],"deudas",e.deudaId),o=await Object(s["f"])(t);if(!o.exists())return void alert("Error: No se encontr√≥ la deuda asociada a este abono.");const a=o.data(),r=a.saldoPendiente||0,n=a.total||0,c=r+e.monto;let l;l=c<=0?"pagado":"pendiente",console.log("=== ELIMINANDO ABONO ==="),console.log("Deuda ID:",e.deudaId),console.log("Monto total de la deuda:",n),console.log("Saldo antes de eliminar:",r),console.log("Monto del abono eliminado:",e.monto),console.log("Nuevo saldo calculado:",c),console.log("Estado actual:",a.estado),console.log("Nuevo estado calculado:",l);const d=Object(s["e"])(i["a"],"deudas",e.deudaId,"abonos",e.id);await Object(s["d"])(d),console.log("Abono eliminado de Firebase");const u={saldoPendiente:Math.max(0,c),estado:l,fechaActualizacion:(new Date).toISOString()};c>n&&(console.warn("Saldo calculado mayor que el total, ajustando..."),u.saldoPendiente=n,u.estado="pendiente"),console.log("Datos que se actualizar√°n en Firebase:",u),await Object(s["s"])(t,u),console.log("Deuda actualizada en Firebase exitosamente");const p=await Object(s["f"])(t);if(p.exists()){const e=p.data();console.log("=== VERIFICACI√ìN POST-ACTUALIZACI√ìN ==="),console.log("Estado en Firebase:",e.estado),console.log("Saldo Pendiente en Firebase:",e.saldoPendiente),console.log("Fecha actualizaci√≥n:",e.fechaActualizacion),e.estado!==l&&(console.error("¬°ALERTA! El estado no se actualiz√≥ correctamente en Firebase"),console.error("Esperado:",l,"Encontrado:",e.estado)),Math.abs(e.saldoPendiente-u.saldoPendiente)>.01&&(console.error("¬°ALERTA! El saldo pendiente no se actualiz√≥ correctamente en Firebase"),console.error("Esperado:",u.saldoPendiente,"Encontrado:",e.saldoPendiente))}alert(`Abono eliminado exitosamente.\n\nDetalles:\n‚Ä¢ Nuevo saldo pendiente: $${this.formatNumber(u.saldoPendiente)}\n‚Ä¢ Estado: ${l.toUpperCase()}\n‚Ä¢ Fecha: ${(new Date).toLocaleString("es-MX")}`),await this.cargarHistorialAbonos(),this.$emit("abono-eliminado",{deudaId:e.deudaId,proveedorId:this.proveedor.id,nuevoSaldo:u.saldoPendiente,nuevoEstado:l})}catch(t){console.error("Error al eliminar el abono:",t),alert("Error al eliminar el abono. Por favor, intente de nuevo.")}},iniciarEdicionFecha(e){this.$set(e,"editandoFecha",!0),this.$set(e,"guardandoFecha",!1),this.$set(e,"fechaCreacionEditable",this.formatearFechaHoraEditable(e.fechaCreacion))},cancelarEdicionFecha(e){this.$set(e,"editandoFecha",!1),this.$set(e,"guardandoFecha",!1),this.$set(e,"fechaCreacionEditable","")},async guardarFechaRegistro(e){if(!e.fechaCreacionEditable)return void alert("Selecciona una fecha y hora v√°lidas.");const t=new Date(e.fechaCreacionEditable);if(Number.isNaN(t.getTime()))alert("La fecha ingresada no es v√°lida.");else{this.$set(e,"guardandoFecha",!0);try{const o=Object(s["e"])(i["a"],"deudas",e.deudaId,"abonos",e.id);await Object(s["s"])(o,{fechaCreacion:t}),this.$set(e,"fechaCreacion",t),this.$set(e,"fechaCreacionEditable",this.formatearFechaHoraEditable(t)),this.$set(e,"editandoFecha",!1),this.abonos=this.ordenarAbonosPorFecha(this.abonos),this.abonosFiltrados=this.ordenarAbonosPorFecha(this.abonosFiltrados),alert("Fecha de registro actualizada.")}catch(o){console.error("Error al actualizar la fecha del abono:",o),alert("No fue posible actualizar la fecha. Intenta de nuevo.")}finally{this.$set(e,"guardandoFecha",!1)}}}},watch:{mostrar(e){e&&this.proveedor&&(this.cargarHistorialAbonos(),this.limpiarFiltros())}}},c=n,l=(o("25e4"),o("2877")),d=Object(l["a"])(c,a,r,!1,null,"209e2616",null);t["a"]=d.exports},a947:function(e,t,o){"use strict";var a=function(){var e=this,t=e._self._c;return e.mostrar?t("div",{staticClass:"modal-overlay",on:{click:e.cerrarModal}},[t("div",{staticClass:"modal-content",on:{click:function(e){e.stopPropagation()}}},[t("div",{staticClass:"modal-header"},[t("h2",[e._v("Precios por Proveedor")]),t("button",{staticClass:"close-button",on:{click:function(t){return e.$emit("cerrar")}}},[e._v("√ó")])]),t("div",{staticClass:"modal-body"},[t("div",{staticClass:"proveedor-selector"},[t("label",{attrs:{for:"proveedorSelect"}},[e._v("Seleccionar Proveedor:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:e.proveedorSeleccionado,expression:"proveedorSeleccionado"}],attrs:{id:"proveedorSelect"},on:{change:[function(t){var o=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.proveedorSeleccionado=t.target.multiple?o:o[0]},e.cargarProductosProveedor]}},[t("option",{attrs:{value:""}},[e._v("Seleccione un proveedor")]),e._l(e.proveedores,(function(o){return t("option",{key:o.id,domProps:{value:o.id}},[e._v(" "+e._s(o.nombre)+" ")])}))],2)]),e.proveedorSeleccionado?t("div",{staticClass:"productos-container"},[t("div",{staticClass:"productos-header"},[t("h3",[e._v("Productos - "+e._s(e.getNombreProveedor()))]),t("button",{staticClass:"btn-agregar-producto",on:{click:function(t){e.mostrarFormularioNuevo=!e.mostrarFormularioNuevo}}},[t("i",{staticClass:"fas fa-plus"}),e._v(" Nuevo Producto ")])]),e.mostrarFormularioNuevo?t("div",{staticClass:"nuevo-producto-form"},[t("div",{staticClass:"form-row"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.nuevoProducto.nombre,expression:"nuevoProducto.nombre"}],staticClass:"form-input",attrs:{placeholder:"Nombre del producto",required:""},domProps:{value:e.nuevoProducto.nombre},on:{input:function(t){t.target.composing||e.$set(e.nuevoProducto,"nombre",t.target.value)}}}),t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.nuevoProducto.precio,expression:"nuevoProducto.precio",modifiers:{number:!0}}],staticClass:"form-input precio-input",attrs:{type:"number",step:"0.01",placeholder:"Precio actual",required:""},domProps:{value:e.nuevoProducto.precio},on:{input:function(t){t.target.composing||e.$set(e.nuevoProducto,"precio",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}}),t("button",{staticClass:"btn-guardar-producto",attrs:{disabled:e.guardando},on:{click:e.agregarNuevoProducto}},[e._v(" "+e._s(e.guardando?"Guardando...":"Guardar")+" ")]),t("button",{staticClass:"btn-cancelar-producto",on:{click:e.cancelarNuevoProducto}},[e._v(" Cancelar ")])])]):e._e(),e.productosConPrecios.length>0?t("div",{staticClass:"productos-grid"},e._l(e.productosConPrecios,(function(o){return t("div",{key:o.nombre,staticClass:"producto-card",on:{click:function(t){return e.abrirHistorialProducto(o)}}},[t("div",{staticClass:"producto-info"},[t("h4",{staticClass:"producto-nombre"},[e._v(e._s(o.nombre))]),t("div",{staticClass:"precio-actual"},[t("span",{staticClass:"precio-valor"},[e._v("$"+e._s(e.formatearPrecio(o.precioActual)))]),t("span",{staticClass:"precio-fecha"},[e._v(e._s(e.formatearFecha(o.fechaUltimoPrecio)))])]),t("div",{staticClass:"precio-estadisticas"},[t("span",{staticClass:"total-registros"},[e._v(e._s(o.totalRegistros)+" precio(s)")]),t("i",{staticClass:"fas fa-chart-line precio-icono"})])])])})),0):e.cargandoProductos?e._e():t("div",{staticClass:"no-productos"},[t("p",[e._v("No hay productos registrados para este proveedor.")]),t("p",{staticClass:"sugerencia"},[e._v('Haz click en "Nuevo Producto" para agregar el primer producto.')])]),e.cargandoProductos?t("div",{staticClass:"loading-productos"},[t("div",{staticClass:"spinner-small"}),t("p",[e._v("Cargando productos...")])]):e._e()]):e._e(),t("HistorialProductoModal",{attrs:{mostrar:e.showHistorialProducto,producto:e.productoSeleccionado,"proveedor-id":e.proveedorSeleccionado,"proveedor-nombre":e.getNombreProveedor()},on:{cerrar:function(t){e.showHistorialProducto=!1},actualizado:e.cargarProductosProveedor}})],1)])]):e._e()},r=[],i=(o("14d9"),o("dc59")),s=o("1494"),n=function(){var e,t,o,a,r,i=this,s=i._self._c;return i.mostrar?s("div",{staticClass:"modal-overlay",on:{click:i.cerrarModal}},[s("div",{staticClass:"modal-content",on:{click:function(e){e.stopPropagation()}}},[s("div",{staticClass:"modal-header"},[s("div",{staticClass:"modal-title-info"},[s("h2",[i._v(i._s((null===(e=i.producto)||void 0===e?void 0:e.nombre)||"Producto"))]),s("span",{staticClass:"proveedor-badge"},[i._v(i._s(i.proveedorNombre))])]),s("button",{staticClass:"close-button",on:{click:function(e){return i.$emit("cerrar")}}},[i._v("√ó")])]),s("div",{staticClass:"modal-body"},[s("div",{staticClass:"producto-resumen"},[s("div",{staticClass:"precio-actual-section"},[s("div",{staticClass:"precio-principal"},[s("span",{staticClass:"label"},[i._v("Precio Actual")]),s("span",{staticClass:"precio-valor"},[i._v("$"+i._s(i.formatearPrecio(null===(t=i.producto)||void 0===t?void 0:t.precioActual)))]),s("span",{staticClass:"fecha-actual"},[i._v(i._s(i.formatearFecha(null===(o=i.producto)||void 0===o?void 0:o.fechaUltimoPrecio)))])]),s("div",{staticClass:"precio-estadisticas"},[s("div",{staticClass:"stat-item"},[s("span",{staticClass:"stat-numero"},[i._v(i._s((null===(a=i.producto)||void 0===a?void 0:a.totalRegistros)||0))]),s("span",{staticClass:"stat-label"},[i._v("Registros")])]),s("div",{staticClass:"stat-item"},[s("span",{staticClass:"stat-numero"},[i._v("$"+i._s(i.formatearPrecio(i.precioPromedio)))]),s("span",{staticClass:"stat-label"},[i._v("Promedio")])])])])]),s("div",{staticClass:"agregar-precio-section"},[s("div",{staticClass:"section-header"},[s("h3",[i._v("Actualizar Precio")]),s("button",{staticClass:"btn-toggle-form",class:{active:i.mostrarFormulario},on:{click:function(e){i.mostrarFormulario=!i.mostrarFormulario}}},[s("i",{staticClass:"fas",class:i.mostrarFormulario?"fa-minus":"fa-plus"})])]),i.mostrarFormulario?s("div",{staticClass:"precio-form"},[s("div",{staticClass:"form-grid"},[s("div",{staticClass:"form-group"},[s("label",{attrs:{for:"nuevoPrecio"}},[i._v("Nuevo Precio:")]),s("input",{directives:[{name:"model",rawName:"v-model.number",value:i.nuevoPrecio.precio,expression:"nuevoPrecio.precio",modifiers:{number:!0}}],ref:"precioInput",staticClass:"form-control precio-input",attrs:{id:"nuevoPrecio",type:"number",step:"0.01",placeholder:"0.00",required:""},domProps:{value:i.nuevoPrecio.precio},on:{keyup:function(e){return!e.type.indexOf("key")&&i._k(e.keyCode,"enter",13,e.key,"Enter")?null:i.agregarPrecio.apply(null,arguments)},input:function(e){e.target.composing||i.$set(i.nuevoPrecio,"precio",i._n(e.target.value))},blur:function(e){return i.$forceUpdate()}}})]),s("div",{staticClass:"form-group"},[s("label",{attrs:{for:"fechaPrecio"}},[i._v("Fecha:")]),s("input",{directives:[{name:"model",rawName:"v-model",value:i.nuevoPrecio.fecha,expression:"nuevoPrecio.fecha"}],staticClass:"form-control",attrs:{id:"fechaPrecio",type:"date",required:""},domProps:{value:i.nuevoPrecio.fecha},on:{input:function(e){e.target.composing||i.$set(i.nuevoPrecio,"fecha",e.target.value)}}})])]),s("div",{staticClass:"form-group"},[s("label",{attrs:{for:"notasPrecio"}},[i._v("Notas (opcional):")]),s("input",{directives:[{name:"model",rawName:"v-model",value:i.nuevoPrecio.notas,expression:"nuevoPrecio.notas"}],staticClass:"form-control",attrs:{id:"notasPrecio",type:"text",placeholder:"Ej: Nuevo proveedor, Oferta especial, etc."},domProps:{value:i.nuevoPrecio.notas},on:{input:function(e){e.target.composing||i.$set(i.nuevoPrecio,"notas",e.target.value)}}})]),s("div",{staticClass:"form-actions"},[s("button",{staticClass:"btn-guardar",attrs:{disabled:i.guardando},on:{click:i.agregarPrecio}},[s("i",{staticClass:"fas fa-save"}),i._v(" "+i._s(i.guardando?"Guardando...":"Guardar Precio")+" ")])])]):i._e()]),s("div",{staticClass:"historial-section"},[s("h3",[i._v("Historial de Precios")]),(null===(r=i.producto)||void 0===r||null===(r=r.precios)||void 0===r?void 0:r.length)>0?s("div",{staticClass:"precios-timeline"},i._l(i.preciosOrdenados,(function(e,t){return s("div",{key:t,staticClass:"precio-item",class:{"precio-actual":0===t}},[s("div",{staticClass:"precio-fecha-badge"},[i._v(" "+i._s(i.formatearFecha(e.fecha))+" ")]),s("div",{staticClass:"precio-info"},[s("div",{staticClass:"precio-monto"},[s("span",{staticClass:"precio-valor"},[i._v("$"+i._s(i.formatearPrecio(e.precio)))]),0===t?s("span",{staticClass:"actual-badge"},[i._v("Actual")]):i._e(),t>0?s("span",{staticClass:"cambio-precio",class:i.getCambioPrecioClass(e,i.preciosOrdenados[t-1])},[i._v(" "+i._s(i.getCambioPrecioTexto(e,i.preciosOrdenados[t-1]))+" ")]):i._e()]),e.notas?s("div",{staticClass:"precio-notas"},[s("i",{staticClass:"fas fa-sticky-note"}),i._v(" "+i._s(e.notas)+" ")]):i._e()]),s("div",{staticClass:"precio-actions"},[s("button",{staticClass:"btn-editar",attrs:{title:"Editar precio"},on:{click:function(o){return i.editarPrecio(e,t)}}},[s("i",{staticClass:"fas fa-edit"})]),t>0?s("button",{staticClass:"btn-eliminar",attrs:{title:"Eliminar precio"},on:{click:function(o){return i.eliminarPrecio(e,t)}}},[s("i",{staticClass:"fas fa-trash"})]):i._e()])])})),0):s("div",{staticClass:"no-historial"},[s("i",{staticClass:"fas fa-chart-line"}),s("p",[i._v("No hay historial de precios disponible")])])])])])]):i._e()},c=[],l=(o("13d5"),{name:"HistorialProductoModal",props:{mostrar:{type:Boolean,required:!0},producto:{type:Object,default:null},proveedorId:{type:String,required:!0},proveedorNombre:{type:String,required:!0}},data(){return{mostrarFormulario:!1,guardando:!1,nuevoPrecio:{precio:null,fecha:this.obtenerFechaActual(),notas:""}}},computed:{preciosOrdenados(){var e;return null!==(e=this.producto)&&void 0!==e&&e.precios?[...this.producto.precios].sort((e,t)=>new Date(t.fecha)-new Date(e.fecha)):[]},precioPromedio(){var e;if(null===(e=this.producto)||void 0===e||null===(e=e.precios)||void 0===e||!e.length)return 0;const t=this.producto.precios.reduce((e,t)=>e+t.precio,0);return t/this.producto.precios.length}},methods:{cerrarModal(e){e.target===e.currentTarget&&this.$emit("cerrar")},obtenerFechaActual(){const e=new Date;return e.toISOString().split("T")[0]},async agregarPrecio(){if(this.nuevoPrecio.precio&&this.nuevoPrecio.fecha)try{this.guardando=!0;const e={proveedorId:this.proveedorId,proveedorNombre:this.proveedorNombre,producto:this.producto.nombre,precio:this.nuevoPrecio.precio,fecha:this.nuevoPrecio.fecha,notas:this.nuevoPrecio.notas||"",fechaCreacion:new Date};console.log("Guardando nuevo precio:",e),await Object(s["b"])(Object(s["c"])(i["a"],"historialPrecios"),e),this.nuevoPrecio={precio:null,fecha:this.obtenerFechaActual(),notas:""},this.mostrarFormulario=!1,this.$emit("actualizado"),alert("Precio agregado correctamente")}catch(e){console.error("Error al agregar precio: ",e),alert("Error al agregar precio: "+e.message)}finally{this.guardando=!1}else alert("Por favor complete el precio y la fecha")},editarPrecio(e,t){const o=prompt("Nuevo precio:",e.precio);o&&!isNaN(parseFloat(o))&&console.log("Editar precio:",e,"Nuevo valor:",o)},eliminarPrecio(e,t){confirm(`¬øEst√° seguro de eliminar el precio del ${this.formatearFecha(e.fecha)}?`)&&console.log("Eliminar precio:",e)},getCambioPrecioClass(e,t){if(!t)return"";const o=e.precio-t.precio;return o>0?"aumento":o<0?"disminucion":"igual"},getCambioPrecioTexto(e,t){if(!t)return"";const o=e.precio-t.precio;if(0===o)return"";const a=(o/t.precio*100).toFixed(1),r=o>0?"+":"";return`${r}${a}%`},formatearFecha(e){if(!e)return"";const t=new Date(e+"T00:00:00"),o={day:"numeric",month:"short",year:"numeric"};return t.toLocaleDateString("es-ES",o)},formatearPrecio(e){return e?e.toLocaleString("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00"}},watch:{mostrar(e){e&&(this.mostrarFormulario=!1,this.nuevoPrecio={precio:null,fecha:this.obtenerFechaActual(),notas:""},this.$nextTick(()=>{this.mostrarFormulario&&this.$refs.precioInput&&this.$refs.precioInput.focus()}))},mostrarFormulario(e){e&&this.$nextTick(()=>{this.$refs.precioInput&&this.$refs.precioInput.focus()})}}}),d=l,u=(o("6934"),o("2877")),p=Object(u["a"])(d,n,c,!1,null,"1be7bc51",null),h=p.exports,m={name:"PreciosProveedorPanel",components:{HistorialProductoModal:h},props:{mostrar:{type:Boolean,required:!0},proveedores:{type:Array,default:()=>[]}},data(){return{proveedorSeleccionado:"",productosConPrecios:[],cargandoProductos:!1,guardando:!1,mostrarFormularioNuevo:!1,showHistorialProducto:!1,productoSeleccionado:null,nuevoProducto:{nombre:"",precio:null}}},methods:{cerrarModal(e){e.target===e.currentTarget&&this.$emit("cerrar")},getNombreProveedor(){const e=this.proveedores.find(e=>e.id===this.proveedorSeleccionado);return e?e.nombre:""},async cargarProductosProveedor(){if(this.proveedorSeleccionado)try{this.cargandoProductos=!0,console.log("Cargando productos para proveedor:",this.proveedorSeleccionado);const e=await Object(s["g"])(Object(s["o"])(Object(s["c"])(i["a"],"historialPrecios"),Object(s["t"])("proveedorId","==",this.proveedorSeleccionado))),t=e.docs.map(e=>e.data());console.log("Precios encontrados:",t.length);const o=new Map;t.forEach(e=>{const t=e.producto;o.has(t)||o.set(t,{nombre:t,precios:[]}),o.get(t).precios.push(e)}),this.productosConPrecios=Array.from(o.values()).map(e=>{const t=e.precios.sort((e,t)=>new Date(t.fecha)-new Date(e.fecha)),o=t[0];return{nombre:e.nombre,precioActual:o.precio,fechaUltimoPrecio:o.fecha,totalRegistros:e.precios.length,precios:t}}),this.productosConPrecios.sort((e,t)=>e.nombre.localeCompare(t.nombre)),console.log("Productos procesados:",this.productosConPrecios.length)}catch(e){console.error("Error al cargar productos: ",e),alert("Error al cargar productos: "+e.message)}finally{this.cargandoProductos=!1}else this.productosConPrecios=[]},async agregarNuevoProducto(){if(this.nuevoProducto.nombre&&this.nuevoProducto.precio)try{this.guardando=!0;const e={proveedorId:this.proveedorSeleccionado,proveedorNombre:this.getNombreProveedor(),producto:this.nuevoProducto.nombre,precio:this.nuevoProducto.precio,fecha:this.obtenerFechaActual(),notas:"Precio inicial del producto",fechaCreacion:new Date};console.log("Guardando nuevo producto:",e),await Object(s["b"])(Object(s["c"])(i["a"],"historialPrecios"),e),this.nuevoProducto={nombre:"",precio:null},this.mostrarFormularioNuevo=!1,await this.cargarProductosProveedor(),alert("Producto agregado correctamente")}catch(e){console.error("Error al agregar producto: ",e),alert("Error al agregar producto: "+e.message)}finally{this.guardando=!1}else alert("Por favor complete el nombre del producto y el precio")},cancelarNuevoProducto(){this.nuevoProducto={nombre:"",precio:null},this.mostrarFormularioNuevo=!1},abrirHistorialProducto(e){this.productoSeleccionado=e,this.showHistorialProducto=!0},obtenerFechaActual(){const e=new Date;return e.toISOString().split("T")[0]},formatearFecha(e){if(!e)return"";const t=new Date(e+"T00:00:00"),o={day:"numeric",month:"short",year:"numeric"};return t.toLocaleDateString("es-ES",o)},formatearPrecio(e){return e?e.toLocaleString("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00"}},watch:{mostrar(e){e&&(this.proveedorSeleccionado="",this.productosConPrecios=[],this.mostrarFormularioNuevo=!1)}}},v=m,f=(o("260b"),Object(u["a"])(v,a,r,!1,null,"6c7af0bb",null));t["a"]=f.exports},c8de:function(e,t,o){"use strict";var a=function(){var e=this,t=e._self._c;return t("div",[t("button",{staticClass:"btn-resumen-ventas",on:{click:e.abrirModal}},[t("i",{staticClass:"fas fa-chart-bar"}),e._v(" Resumen de Ventas ")]),e.showModal?t("div",{staticClass:"modal-overlay",on:{click:function(t){return t.target!==t.currentTarget?null:e.cerrarModal.apply(null,arguments)}}},[t("div",{staticClass:"modal-content"},[t("div",{staticClass:"modal-header"},[t("h2",[e._v("Resumen de Ventas a Veronica")]),t("button",{staticClass:"btn-cerrar-modal",on:{click:e.cerrarModal}},[e._v("√ó")])]),e.isLoading?t("div",{staticClass:"loading"},[e._v(" Cargando datos... ")]):t("div",{staticClass:"resumen-container"},[t("div",{staticClass:"filtro-fechas"},[t("div",{staticClass:"fecha-group"},[t("label",[e._v("Desde:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.fechaDesde,expression:"fechaDesde"}],attrs:{type:"date"},domProps:{value:e.fechaDesde},on:{change:e.cargarDatos,input:function(t){t.target.composing||(e.fechaDesde=t.target.value)}}})]),t("div",{staticClass:"fecha-group"},[t("label",[e._v("Hasta:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.fechaHasta,expression:"fechaHasta"}],attrs:{type:"date"},domProps:{value:e.fechaHasta},on:{change:e.cargarDatos,input:function(t){t.target.composing||(e.fechaHasta=t.target.value)}}})]),t("button",{staticClass:"btn-limpiar",on:{click:e.limpiarFiltros}},[e._v("Limpiar Filtros")])]),t("div",{staticClass:"seccion-resumen"},[t("h3",{staticClass:"titulo-seccion limpio"},[e._v("Camar√≥n Limpio")]),0===Object.keys(e.resumenLimpio).length?t("div",{staticClass:"no-data"},[e._v(" No hay ventas de camar√≥n limpio en este per√≠odo ")]):t("table",{staticClass:"tabla-resumen"},[e._m(0),t("tbody",e._l(e.resumenLimpio,(function(o,a){return t("tr",{key:a},[t("td",{staticClass:"medida-cell"},[e._v(e._s(a))]),t("td",{staticClass:"kilos-cell"},[e._v(e._s(e.formatNumber(o.kilos))+" kg")]),t("td",{staticClass:"monto-cell"},[e._v("$"+e._s(e.formatNumber(o.total)))])])})),0),t("tfoot",[t("tr",{staticClass:"total-row"},[e._m(1),t("td",[t("strong",[e._v(e._s(e.formatNumber(e.totalKilosLimpio))+" kg")])]),t("td",[t("strong",[e._v("$"+e._s(e.formatNumber(e.totalMontoLimpio)))])])])])])]),t("div",{staticClass:"seccion-resumen"},[t("h3",{staticClass:"titulo-seccion crudo"},[e._v("Camar√≥n Crudo")]),0===Object.keys(e.resumenCrudo).length?t("div",{staticClass:"no-data"},[e._v(" No hay ventas de camar√≥n crudo en este per√≠odo ")]):t("table",{staticClass:"tabla-resumen"},[e._m(2),t("tbody",e._l(e.resumenCrudo,(function(o,a){return t("tr",{key:a},[t("td",{staticClass:"medida-cell"},[e._v(e._s(a))]),t("td",{staticClass:"kilos-cell"},[e._v(e._s(e.formatNumber(o.kilos))+" kg")]),t("td",{staticClass:"monto-cell"},[e._v("$"+e._s(e.formatNumber(o.total)))])])})),0),t("tfoot",[t("tr",{staticClass:"total-row"},[e._m(3),t("td",[t("strong",[e._v(e._s(e.formatNumber(e.totalKilosCrudo))+" kg")])]),t("td",[t("strong",[e._v("$"+e._s(e.formatNumber(e.totalMontoCrudo)))])])])])])]),t("div",{staticClass:"total-general"},[t("div",{staticClass:"total-item"},[t("span",{staticClass:"total-label"},[e._v("Total de Kilos:")]),t("span",{staticClass:"total-value"},[e._v(e._s(e.formatNumber(e.totalKilosGeneral))+" kg")])]),t("div",{staticClass:"total-item"},[t("span",{staticClass:"total-label"},[e._v("Total Vendido:")]),t("span",{staticClass:"total-value destacado"},[e._v("$"+e._s(e.formatNumber(e.totalMontoGeneral)))])])])]),t("div",{staticClass:"modal-footer"},[t("button",{staticClass:"btn-imprimir",on:{click:e.imprimirResumen}},[t("i",{staticClass:"fas fa-print"}),e._v(" Imprimir ")]),t("button",{staticClass:"btn-cerrar",on:{click:e.cerrarModal}},[e._v("Cerrar")])])])]):e._e()])},r=[function(){var e=this,t=e._self._c;return t("thead",[t("tr",[t("th",[e._v("Medida")]),t("th",[e._v("Kilos Vendidos")]),t("th",[e._v("Total Vendido")])])])},function(){var e=this,t=e._self._c;return t("td",[t("strong",[e._v("Total Limpio")])])},function(){var e=this,t=e._self._c;return t("thead",[t("tr",[t("th",[e._v("Medida")]),t("th",[e._v("Kilos Vendidos")]),t("th",[e._v("Total Vendido")])])])},function(){var e=this,t=e._self._c;return t("td",[t("strong",[e._v("Total Crudo")])])}],i=(o("13d5"),o("dc59")),s=o("1494"),n={name:"ResumenVentasVeronicaModal",data(){return{showModal:!1,isLoading:!1,resumenLimpio:{},resumenCrudo:{},fechaDesde:"",fechaHasta:""}},computed:{totalKilosLimpio(){return Object.values(this.resumenLimpio).reduce((e,t)=>e+t.kilos,0)},totalMontoLimpio(){return Object.values(this.resumenLimpio).reduce((e,t)=>e+t.total,0)},totalKilosCrudo(){return Object.values(this.resumenCrudo).reduce((e,t)=>e+t.kilos,0)},totalMontoCrudo(){return Object.values(this.resumenCrudo).reduce((e,t)=>e+t.total,0)},totalKilosGeneral(){return this.totalKilosLimpio+this.totalKilosCrudo},totalMontoGeneral(){return this.totalMontoLimpio+this.totalMontoCrudo}},methods:{async abrirModal(){this.showModal=!0,await this.cargarDatos()},cerrarModal(){this.showModal=!1},limpiarFiltros(){this.fechaDesde="",this.fechaHasta="",this.cargarDatos()},async cargarDatos(){this.isLoading=!0,this.resumenLimpio={},this.resumenCrudo={};try{const e=Object(s["c"])(i["a"],"cuentasVeronica");let t=Object(s["o"])(e,Object(s["l"])("fecha","asc"));this.fechaDesde&&this.fechaHasta?t=Object(s["o"])(e,Object(s["t"])("fecha",">=",this.fechaDesde),Object(s["t"])("fecha","<=",this.fechaHasta),Object(s["l"])("fecha","asc")):this.fechaDesde?t=Object(s["o"])(e,Object(s["t"])("fecha",">=",this.fechaDesde),Object(s["l"])("fecha","asc")):this.fechaHasta&&(t=Object(s["o"])(e,Object(s["t"])("fecha","<=",this.fechaHasta),Object(s["l"])("fecha","asc")));const o=await Object(s["g"])(t);o.forEach(e=>{const t=e.data(),o=t.itemsVenta||[];o.forEach(e=>{const t=(e.medida||"").trim(),o=parseFloat(e.kilosVenta)||0,a=parseFloat(e.totalVenta)||0;if(!t||0===o)return;const r=this.normalizarMedida(t),i=this.esCamaronCrudo(r);i?(this.resumenCrudo[r]||(this.resumenCrudo[r]={kilos:0,total:0}),this.resumenCrudo[r].kilos+=o,this.resumenCrudo[r].total+=a):(this.resumenLimpio[r]||(this.resumenLimpio[r]={kilos:0,total:0}),this.resumenLimpio[r].kilos+=o,this.resumenLimpio[r].total+=a)})})}catch(e){console.error("Error al cargar datos de ventas:",e),alert("Error al cargar los datos. Por favor, intente nuevamente.")}finally{this.isLoading=!1}},normalizarMedida(e){let t=e.toLowerCase().trim();const o=["plus","premium","extra","especial","select"];return o.forEach(e=>{const o=new RegExp(`\\s*${e}\\s*`,"gi");t=t.replace(o," ")}),t=t.trim().replace(/\s+/g," "),t.split(" ").map(e=>/^\d+\/\d+$/.test(e)?e:e.charAt(0).toUpperCase()+e.slice(1)).join(" ").trim()},esCamaronCrudo(e){const t=e.toLowerCase(),o=["crudo","c/c","cc","cabeza"];return o.some(e=>t.includes(e))||/^\d+-\d+$/.test(e)},formatNumber(e){return null===e||void 0===e?"0":e.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0})},imprimirResumen(){const e=`\n        <html>\n          <head>\n            <title>Resumen de Ventas a Veronica</title>\n            <style>\n              body {\n                font-family: Arial, sans-serif;\n                font-size: 12pt;\n                max-width: 800px;\n                margin: 0 auto;\n                padding: 20px;\n              }\n              h1 {\n                color: #ff8c00;\n                text-align: center;\n                margin-bottom: 20px;\n              }\n              h2 {\n                color: #ff8c00;\n                margin-top: 25px;\n                margin-bottom: 10px;\n                border-bottom: 2px solid #ff8c00;\n                padding-bottom: 5px;\n              }\n              .periodo {\n                text-align: center;\n                color: #666;\n                margin-bottom: 20px;\n                font-style: italic;\n              }\n              table {\n                width: 100%;\n                border-collapse: collapse;\n                margin-bottom: 20px;\n              }\n              th, td {\n                border: 1px solid #ddd;\n                padding: 10px;\n                text-align: left;\n              }\n              th {\n                background-color: #ff8c00;\n                color: white;\n                font-weight: bold;\n              }\n              .total-row {\n                background-color: #fff8f0;\n                font-weight: bold;\n              }\n              .total-general {\n                background-color: #ff8c00;\n                color: white;\n                padding: 15px;\n                border-radius: 8px;\n                margin-top: 20px;\n                text-align: center;\n              }\n              .total-general div {\n                margin: 10px 0;\n                font-size: 14pt;\n              }\n              @media print {\n                body { padding: 0; }\n              }\n            </style>\n          </head>\n          <body>\n            <h1>Resumen de Ventas a Veronica</h1>\n            ${this.fechaDesde||this.fechaHasta?`\n              <p class="periodo">\n                Per√≠odo: ${this.fechaDesde?this.formatDate(this.fechaDesde):"Inicio"} - ${this.fechaHasta?this.formatDate(this.fechaHasta):"Hoy"}\n              </p>\n            `:""}\n            \n            <h2>Camar√≥n Limpio</h2>\n            ${Object.keys(this.resumenLimpio).length>0?`\n              <table>\n                <thead>\n                  <tr>\n                    <th>Medida</th>\n                    <th>Kilos Vendidos</th>\n                    <th>Total Vendido</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${Object.entries(this.resumenLimpio).map(([e,t])=>`\n                    <tr>\n                      <td>${e}</td>\n                      <td>${this.formatNumber(t.kilos)} kg</td>\n                      <td>$${this.formatNumber(t.total)}</td>\n                    </tr>\n                  `).join("")}\n                  <tr class="total-row">\n                    <td><strong>Total Limpio</strong></td>\n                    <td><strong>${this.formatNumber(this.totalKilosLimpio)} kg</strong></td>\n                    <td><strong>$${this.formatNumber(this.totalMontoLimpio)}</strong></td>\n                  </tr>\n                </tbody>\n              </table>\n            `:"<p>No hay ventas de camar√≥n limpio en este per√≠odo</p>"}\n\n            <h2>Camar√≥n Crudo</h2>\n            ${Object.keys(this.resumenCrudo).length>0?`\n              <table>\n                <thead>\n                  <tr>\n                    <th>Medida</th>\n                    <th>Kilos Vendidos</th>\n                    <th>Total Vendido</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${Object.entries(this.resumenCrudo).map(([e,t])=>`\n                    <tr>\n                      <td>${e}</td>\n                      <td>${this.formatNumber(t.kilos)} kg</td>\n                      <td>$${this.formatNumber(t.total)}</td>\n                    </tr>\n                  `).join("")}\n                  <tr class="total-row">\n                    <td><strong>Total Crudo</strong></td>\n                    <td><strong>${this.formatNumber(this.totalKilosCrudo)} kg</strong></td>\n                    <td><strong>$${this.formatNumber(this.totalMontoCrudo)}</strong></td>\n                  </tr>\n                </tbody>\n              </table>\n            `:"<p>No hay ventas de camar√≥n crudo en este per√≠odo</p>"}\n\n            <div class="total-general">\n              <div><strong>Total de Kilos:</strong> ${this.formatNumber(this.totalKilosGeneral)} kg</div>\n              <div><strong>Total Vendido:</strong> $${this.formatNumber(this.totalMontoGeneral)}</div>\n            </div>\n          </body>\n        </html>\n      `,t=window.open("","_blank");t.document.write(e),t.document.close(),t.print()},formatDate(e){const t=new Date(e+"T00:00:00");return t.toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"})}}},c=n,l=(o("7d05"),o("2877")),d=Object(l["a"])(c,a,r,!1,null,"505e57cc",null);t["a"]=d.exports},c97b:function(e,t,o){"use strict";o("4918")},e043:function(e,t,o){}}]);