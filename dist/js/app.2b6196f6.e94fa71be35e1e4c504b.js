(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["app.2b6196f6"],{"38aa":function(e,o,t){"use strict";var r=function(){var e=this,o=e._self._c;return e.isLoaded?o("div",{staticClass:"registro-crudos-container"},[o("div",{staticClass:"back-button-container"},[o("BackButton",{attrs:{to:"/existencias-crudos"}})],1),o("h2",{staticClass:"date-header"},[e._v(e._s(e.formattedDate))]),o("div",{staticClass:"date-selector"},[o("input",{directives:[{name:"model",rawName:"v-model",value:e.selectedDate,expression:"selectedDate"}],attrs:{type:"date"},domProps:{value:e.selectedDate},on:{change:e.updateCurrentDate,input:function(o){o.target.composing||(e.selectedDate=o.target.value)}}})]),o("div",{staticClass:"registro-content"},[o("div",{staticClass:"entradas-section"},[o("h3",[e._v("Entradas de Crudos")]),o("div",{staticClass:"form-section"},[o("div",{staticClass:"input-group"},[o("select",{directives:[{name:"model",rawName:"v-model",value:e.newEntrada.proveedor,expression:"newEntrada.proveedor"}],attrs:{required:""},on:{change:[function(o){var t=Array.prototype.filter.call(o.target.options,(function(e){return e.selected})).map((function(e){var o="_value"in e?e._value:e.value;return o}));e.$set(e.newEntrada,"proveedor",o.target.multiple?t:t[0])},e.resetProductoEntrada]}},[o("option",{attrs:{value:""}},[e._v("Seleccionar Proveedor")]),e._l(e.proveedoresCrudos,(function(t){return o("option",{key:t.id,domProps:{value:t.nombre}},[e._v(" "+e._s(t.nombre)+" ")])})),o("option",{attrs:{value:"__nuevo__"}},[e._v("+ Nuevo Proveedor")])],2),"__nuevo__"===e.newEntrada.proveedor?o("input",{directives:[{name:"model",rawName:"v-model",value:e.nuevoProveedorEntrada,expression:"nuevoProveedorEntrada"}],staticClass:"input-nuevo-proveedor",attrs:{type:"text",placeholder:"Nombre del nuevo proveedor"},domProps:{value:e.nuevoProveedorEntrada},on:{input:function(o){o.target.composing||(e.nuevoProveedorEntrada=o.target.value)}}}):e._e()]),o("div",{staticClass:"entrada-form"},[o("div",{staticClass:"input-group"},[o("input",{directives:[{name:"model",rawName:"v-model.number",value:e.newEntrada.kilos,expression:"newEntrada.kilos",modifiers:{number:!0}}],attrs:{type:"number",inputmode:"decimal",step:"0.1",placeholder:"Kilos",required:""},domProps:{value:e.newEntrada.kilos},on:{input:function(o){o.target.composing||e.$set(e.newEntrada,"kilos",e._n(o.target.value))},blur:function(o){return e.$forceUpdate()}}}),e.newEntrada.proveedor&&"__nuevo__"!==e.newEntrada.proveedor?o("select",{directives:[{name:"model",rawName:"v-model",value:e.newEntrada.producto,expression:"newEntrada.producto"}],attrs:{required:""},on:{change:function(o){var t=Array.prototype.filter.call(o.target.options,(function(e){return e.selected})).map((function(e){var o="_value"in e?e._value:e.value;return o}));e.$set(e.newEntrada,"producto",o.target.multiple?t:t[0])}}},[o("option",{attrs:{value:""}},[e._v("Seleccionar Medida/Producto")]),e._l(e.medidasDelProveedorEntrada,(function(t){return o("option",{key:t.id,domProps:{value:t.nombre}},[e._v(" "+e._s(t.nombre)+" "),t.precioReferencia?o("span",[e._v(" - Ref: $"+e._s(e.formatearPrecio(t.precioReferencia)))]):e._e()])})),o("option",{attrs:{value:"__custom__"}},[e._v("+ Otro producto/medida")])],2):o("input",{directives:[{name:"model",rawName:"v-model",value:e.newEntrada.producto,expression:"newEntrada.producto"}],attrs:{type:"text",placeholder:"Producto/Medida",required:""},domProps:{value:e.newEntrada.producto},on:{input:function(o){o.target.composing||e.$set(e.newEntrada,"producto",o.target.value)}}}),o("input",{directives:[{name:"model",rawName:"v-model.number",value:e.newEntrada.precio,expression:"newEntrada.precio",modifiers:{number:!0}}],attrs:{type:"number",inputmode:"decimal",step:"0.01",placeholder:"Precio (opcional)"},domProps:{value:e.newEntrada.precio},on:{input:function(o){o.target.composing||e.$set(e.newEntrada,"precio",e._n(o.target.value))},blur:function(o){return e.$forceUpdate()}}}),o("button",{attrs:{disabled:!e.isEntradaValida},on:{click:e.addEntrada}},[e._v("Agregar Entrada")])]),"__custom__"===e.newEntrada.producto?o("div",{staticClass:"input-group"},[o("input",{directives:[{name:"model",rawName:"v-model",value:e.customProducto,expression:"customProducto"}],staticClass:"input-nuevo-proveedor",attrs:{type:"text",placeholder:"Nombre del producto/medida personalizada"},domProps:{value:e.customProducto},on:{input:function(o){o.target.composing||(e.customProducto=o.target.value)}}})]):e._e()])]),o("ul",{staticClass:"list"},e._l(e.entradas,(function(t,r){return o("li",{key:"entrada-"+r},[o("div",{staticClass:"item-info"},[o("strong",[e._v(e._s(t.proveedor))]),e._v(" - "+e._s(t.producto)+" "),t.precio?o("span",{staticClass:"precio-info"},[e._v(" ($"+e._s(e.formatearPrecio(t.precio))+")")]):e._e(),e._v(" : "+e._s(e.formatNumber(t.kilos))+" kg "),t.precio?o("span",{staticClass:"total-info"},[e._v(" - Total: $"+e._s(e.formatearPrecio(t.kilos*t.precio)))]):e._e()]),o("button",{staticClass:"delete-btn",on:{click:function(o){return e.removeEntrada(r)}}},[e._v("×")])])})),0),o("p",{staticClass:"total"},[e._v("Total Entradas: "+e._s(e.formatNumber(e.totalEntradas))+" kg")])]),o("div",{staticClass:"salidas-section"},[o("h3",[e._v("Salidas de Crudos")]),o("div",{staticClass:"form-section"},[o("div",{staticClass:"input-group"},[o("select",{directives:[{name:"model",rawName:"v-model",value:e.newSalida.proveedor,expression:"newSalida.proveedor"}],attrs:{required:""},on:{change:[function(o){var t=Array.prototype.filter.call(o.target.options,(function(e){return e.selected})).map((function(e){var o="_value"in e?e._value:e.value;return o}));e.$set(e.newSalida,"proveedor",o.target.multiple?t:t[0])},e.resetProductoSalida]}},[o("option",{attrs:{value:""}},[e._v("Seleccionar Proveedor")]),e._l(e.proveedoresDisponibles,(function(t){return o("option",{key:t,domProps:{value:t}},[e._v(" "+e._s(t)+" ")])}))],2)]),e.newSalida.proveedor?o("div",{staticClass:"productos-disponibles"},[o("h4",[e._v("Productos Disponibles - "+e._s(e.newSalida.proveedor))]),0===e.productosDelProveedorSeleccionado.length?o("div",{staticClass:"no-productos"},[e._v(" No hay productos disponibles para este proveedor. ")]):o("div",{staticClass:"productos-grid"},e._l(e.productosDelProveedorSeleccionado,(function(t){return o("div",{key:t.nombre,staticClass:"producto-card",class:{selected:e.newSalida.producto===t.nombre},on:{click:function(o){return e.seleccionarProductoSalida(t)}}},[o("div",{staticClass:"producto-info"},[o("h5",[e._v(e._s(t.nombre))]),o("p",{staticClass:"kilos-disponibles"},[e._v(e._s(e.formatNumber(t.kilosDisponibles))+" kg disponibles")]),t.ultimoPrecio?o("p",{staticClass:"ultimo-precio"},[e._v("Último precio: $"+e._s(e.formatearPrecio(t.ultimoPrecio)))]):e._e()])])})),0)]):e._e(),e.newSalida.producto?o("div",{staticClass:"salida-form"},[o("div",{staticClass:"input-group"},[o("input",{directives:[{name:"model",rawName:"v-model.number",value:e.newSalida.kilos,expression:"newSalida.kilos",modifiers:{number:!0}}],attrs:{type:"number",inputmode:"decimal",step:"0.1",max:e.kilosDisponiblesSeleccionados,placeholder:"Kilos",required:""},domProps:{value:e.newSalida.kilos},on:{input:function(o){o.target.composing||e.$set(e.newSalida,"kilos",e._n(o.target.value))},blur:function(o){return e.$forceUpdate()}}}),o("button",{attrs:{disabled:!e.isSalidaValida},on:{click:e.addSalida}},[e._v("Agregar Salida")])]),o("p",{staticClass:"disponibles-info"},[e._v(" Disponibles: "+e._s(e.formatNumber(e.kilosDisponiblesSeleccionados))+" kg ")])]):e._e()]),o("ul",{staticClass:"list"},e._l(e.salidas,(function(t,r){return o("li",{key:"salida-"+r},[o("div",{staticClass:"item-info"},[o("strong",[e._v(e._s(t.proveedor))]),e._v(" - "+e._s(t.producto)+": "+e._s(e.formatNumber(t.kilos))+" kg ")]),o("button",{staticClass:"delete-btn",on:{click:function(o){return e.removeSalida(r)}}},[e._v("×")])])})),0),o("p",{staticClass:"total"},[e._v("Total Salidas: "+e._s(e.formatNumber(e.totalSalidas))+" kg")])])]),o("div",{staticClass:"summary"},[o("h3",[e._v("Resumen del Día")]),o("p",[e._v("Total Entradas: "+e._s(e.formatNumber(e.totalEntradas))+" kg")]),o("p",[e._v("Total Salidas: "+e._s(e.formatNumber(e.totalSalidas))+" kg")]),o("p",[e._v("Diferencia: "+e._s(e.formatNumber(e.totalEntradas-e.totalSalidas))+" kg")])]),o("button",{staticClass:"save-button",on:{click:e.saveReport}},[e._v(e._s(e.isEditing?"Actualizar":"Guardar")+" Registro")])]):e._e()},a=[],s=(t("14d9"),t("13d5"),t("88e6"),t("70cc"),t("eb03"),t("22e5c"),t("c01e"),t("fa76"),t("8306"),t("dc59")),i=t("1494"),d=t("74c9"),n=t("c1df"),c=t.n(n),l={name:"RegistroCrudos",components:{BackButton:d["a"]},data(){return{currentDate:c()(),selectedDate:c()().format("YYYY-MM-DD"),entradas:[],salidas:[],proveedoresCrudos:[],medidasCrudos:[],newEntrada:{proveedor:"",producto:"",kilos:null,precio:null},newSalida:{proveedor:"",producto:"",kilos:null},nuevoProveedorEntrada:"",customProducto:"",isEditing:!1,registroId:null,isLoaded:!1,productosDisponibles:[],kilosDisponiblesSeleccionados:0}},computed:{formattedDate(){return this.currentDate.format("DD/MM/YYYY")},totalEntradas(){return Number(this.entradas.reduce((e,o)=>e+o.kilos,0).toFixed(1))},totalSalidas(){return Number(this.salidas.reduce((e,o)=>e+o.kilos,0).toFixed(1))},isEntradaValida(){const e="__nuevo__"===this.newEntrada.proveedor?this.nuevoProveedorEntrada.trim():this.newEntrada.proveedor,o="__custom__"===this.newEntrada.producto?this.customProducto.trim():this.newEntrada.producto;return e&&o&&this.newEntrada.kilos&&this.newEntrada.kilos>0},isSalidaValida(){return this.newSalida.proveedor&&this.newSalida.producto&&this.newSalida.kilos&&this.newSalida.kilos>0&&this.newSalida.kilos<=this.kilosDisponiblesSeleccionados},proveedoresDisponibles(){const e=new Set;return this.productosDisponibles.forEach(o=>{o.kilosDisponibles>0&&e.add(o.proveedor)}),Array.from(e).sort()},productosDelProveedorSeleccionado(){return this.productosDisponibles.filter(e=>e.proveedor===this.newSalida.proveedor&&e.kilosDisponibles>0)},medidasDelProveedorEntrada(){var e;if(!this.newEntrada.proveedor||"__nuevo__"===this.newEntrada.proveedor)return[];const o=null===(e=this.proveedoresCrudos.find(e=>e.nombre===this.newEntrada.proveedor))||void 0===e?void 0:e.id;return this.medidasCrudos.filter(e=>e.proveedorId===o)}},methods:{async loadProveedoresCrudos(){try{const e=await Object(i["g"])(Object(i["c"])(s["a"],"proveedoresCrudos"));this.proveedoresCrudos=e.docs.map(e=>({id:e.id,...e.data()})),this.proveedoresCrudos.sort((e,o)=>e.nombre.localeCompare(o.nombre))}catch(e){console.error("Error al cargar proveedores de crudos:",e),this.proveedoresCrudos=[]}},async loadMedidasCrudos(){try{const e=await Object(i["g"])(Object(i["c"])(s["a"],"medidasCrudos"));this.medidasCrudos=e.docs.map(e=>({id:e.id,...e.data()}))}catch(e){console.error("Error al cargar medidas de crudos:",e),this.medidasCrudos=[]}},async loadProductosDisponibles(){try{const e=await Object(i["g"])(Object(i["c"])(s["a"],"existenciasCrudos")),o={},t=e.docs.map(e=>({id:e.id,...e.data()})).sort((e,o)=>{const t=e.fecha instanceof Date?e.fecha:e.fecha.toDate(),r=o.fecha instanceof Date?o.fecha:o.fecha.toDate();return t-r}),r=this.isEditing?this.currentDate.clone().subtract(1,"day").endOf("day"):this.currentDate.clone().endOf("day");t.forEach(e=>{const t=e.fecha instanceof Date?e.fecha:e.fecha.toDate();this.isEditing&&e.id===this.registroId||c()(t).isSameOrBefore(r)&&(e.entradas&&e.entradas.forEach(e=>{const t=`${e.proveedor}|${e.producto}`;o[t]||(o[t]={proveedor:e.proveedor,nombre:e.producto,kilosDisponibles:0,ultimoPrecio:0}),o[t].kilosDisponibles+=e.kilos,e.precio&&(o[t].ultimoPrecio=e.precio)}),e.salidas&&e.salidas.forEach(e=>{const t=`${e.proveedor}|${e.producto}`;o[t]||(o[t]={proveedor:e.proveedor,nombre:e.producto,kilosDisponibles:0,ultimoPrecio:0}),o[t].kilosDisponibles-=e.kilos,e.precio&&(o[t].ultimoPrecio=e.precio)}))}),this.entradas.forEach(e=>{const t=`${e.proveedor}|${e.producto}`;o[t]||(o[t]={proveedor:e.proveedor,nombre:e.producto,kilosDisponibles:0,ultimoPrecio:e.precio||0}),o[t].kilosDisponibles+=e.kilos,e.precio&&(o[t].ultimoPrecio=e.precio)}),this.salidas.forEach(e=>{const t=`${e.proveedor}|${e.producto}`;o[t]&&(o[t].kilosDisponibles-=e.kilos)}),this.productosDisponibles=Object.values(o).filter(e=>e.kilosDisponibles>0)}catch(e){console.error("Error al cargar productos disponibles:",e),this.productosDisponibles=[]}},resetProductoEntrada(){this.newEntrada.producto="",this.newEntrada.kilos=null,this.newEntrada.precio=null,this.nuevoProveedorEntrada="",this.customProducto=""},resetProductoSalida(){this.newSalida.producto="",this.newSalida.kilos=null,this.kilosDisponiblesSeleccionados=0},seleccionarProductoSalida(e){this.newSalida.producto=e.nombre,this.kilosDisponiblesSeleccionados=e.kilosDisponibles},async addEntrada(){if(!this.isEntradaValida)return;const e="__nuevo__"===this.newEntrada.proveedor?this.nuevoProveedorEntrada.trim():this.newEntrada.proveedor,o="__custom__"===this.newEntrada.producto?this.customProducto.trim():this.newEntrada.producto;let t=this.newEntrada.precio;if(!t&&"__nuevo__"!==this.newEntrada.proveedor){const e=this.medidasDelProveedorEntrada.find(e=>e.nombre===o);e&&e.precioReferencia&&(t=e.precioReferencia)}if(this.entradas.push({proveedor:e,producto:o,kilos:Number(this.newEntrada.kilos.toFixed(1)),precio:t?Number(t.toFixed(2)):null}),"__nuevo__"===this.newEntrada.proveedor&&!this.proveedoresCrudos.find(o=>o.nombre===e))try{const o={nombre:e,fechaCreacion:new Date,tipo:"crudos"},t=await Object(i["b"])(Object(i["c"])(s["a"],"proveedoresCrudos"),o);this.proveedoresCrudos.push({id:t.id,...o})}catch(a){console.error("Error al agregar proveedor:",a)}if("__custom__"===this.newEntrada.producto&&"__nuevo__"!==this.newEntrada.proveedor){var r;const d=null===(r=this.proveedoresCrudos.find(o=>o.nombre===e))||void 0===r?void 0:r.id;if(d&&!this.medidasCrudos.find(e=>e.nombre===o&&e.proveedorId===d))try{const r={nombre:o,proveedorId:d,proveedorNombre:e,precioReferencia:t||null,fechaCreacion:new Date,tipo:"crudos"},a=await Object(i["b"])(Object(i["c"])(s["a"],"medidasCrudos"),r);this.medidasCrudos.push({id:a.id,...r})}catch(a){console.error("Error al agregar medida:",a)}}this.resetProductoEntrada(),await this.loadProductosDisponibles()},addSalida(){this.isSalidaValida&&(this.salidas.push({proveedor:this.newSalida.proveedor,producto:this.newSalida.producto,kilos:Number(this.newSalida.kilos.toFixed(1))}),this.resetProductoSalida(),this.loadProductosDisponibles())},async removeEntrada(e){this.entradas.splice(e,1),await this.loadProductosDisponibles()},async removeSalida(e){this.salidas.splice(e,1),await this.loadProductosDisponibles()},formatNumber(e){return e.toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1})},formatearPrecio(e){return e?e.toLocaleString("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00"},async loadRegistro(e){console.log("Cargando registro con ID:",e);const o=Object(i["e"])(s["a"],"existenciasCrudos",e),t=await Object(i["f"])(o);if(t.exists()){const o=t.data();this.currentDate=c()(o.fecha.toDate()),this.selectedDate=this.currentDate.format("YYYY-MM-DD"),this.entradas=o.entradas||[],this.salidas=o.salidas||[],this.registroId=e,this.isEditing=!0,await this.loadProductosDisponibles()}else console.log("No se encontró el documento con ID:",e)},async saveReport(){try{if(!this.isEditing){const e=Object(i["o"])(Object(i["c"])(s["a"],"existenciasCrudos"),Object(i["s"])("fecha",">=",this.currentDate.clone().startOf("day").toDate()),Object(i["s"])("fecha","<=",this.currentDate.clone().endOf("day").toDate())),o=await Object(i["g"])(e);if(!o.empty)return void alert("Ya existe un registro para esta fecha. No se puede crear uno nuevo.")}const e={fecha:this.currentDate.toDate(),entradas:this.entradas,salidas:this.salidas,totalEntradas:this.totalEntradas,totalSalidas:this.totalSalidas};this.isEditing?(await Object(i["r"])(Object(i["e"])(s["a"],"existenciasCrudos",this.registroId),e),alert("Registro de crudos actualizado exitosamente")):(await Object(i["b"])(Object(i["c"])(s["a"],"existenciasCrudos"),e),alert("Registro de crudos guardado exitosamente")),this.$router.push("/existencias-crudos")}catch(e){console.error("Error al guardar/actualizar el registro: ",e),alert("Error al guardar/actualizar el registro: "+e.message)}},updateCurrentDate(){this.currentDate=c()(this.selectedDate),this.loadProductosDisponibles()}},async created(){await Promise.all([this.loadProveedoresCrudos(),this.loadMedidasCrudos()]),await this.loadProductosDisponibles(),this.$route.params.id&&await this.loadRegistro(this.$route.params.id),this.isLoaded=!0}},u=l,p=(t("5e5c"),t("2877")),v=Object(p["a"])(u,r,a,!1,null,"432665ce",null);o["a"]=v.exports},"5e5c":function(e,o,t){"use strict";t("84ca")},"84ca":function(e,o,t){}}]);