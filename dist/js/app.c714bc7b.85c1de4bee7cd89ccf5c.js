(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["app.c714bc7b"],{"41cb":function(e,t,n){"use strict";var a=n("2b0e"),s=n("8c4f"),o=(n("f549"),n("bb51")),i=n("f411"),r=n("98cf"),c=n("4e00"),u=n("32e5"),d=n("9302"),p=n("1155"),m=n("2cc6"),h=n("4c52"),l=n("4c57"),f=n("505e"),g=n("f515"),y=n("fcb3"),v=n("24d5"),b=n("4786f"),S=n("28ce"),w=n("74a9"),P=n("320e"),E=n("0ae9"),q=n("c8b7"),k=n("d09c"),M=n("16c4"),T=n("5321"),D=n("b34e"),O=n("f458"),B=n("4dc0"),x=n("9aeb"),R=n("54f9"),C=n("586e"),L=n("a55b"),z=n("9f85"),j=n("85fe"),I=n("9e53"),A=n("a593"),F=n("05af"),N=n("c5f5"),G=n("f125"),$=(n("0042"),n("cc985")),Q=n("3420"),V=n("d918"),J=n("92c9"),_=n("e524"),Y=n("8610"),U=n("3206"),H=n("9b35"),K=n("98d3"),W=n("767f"),X=n("2edd"),Z=n("fc3d"),ee=n("38aa"),te=n("f40d"),ne=n("9c33"),ae=n("6e99"),se=n("3229"),oe=n("f957");a["default"].use(s["a"]);const ie=[{path:"/login",name:"Login",component:L["a"]},{path:"/noteMenu",name:"NoteMenu",component:i["a"]},{path:"/",name:"home",component:o["a"]},{path:"/sale-note/:noteId?",name:"SaleNote",component:()=>Promise.resolve().then(n.bind(null,"98cf"))},{path:"/add-client",name:"AddClient",component:c["a"]},{path:"/editar-nota/:noteId",name:"editar-nota",component:r["default"],props:!0},{path:"/sacadas",name:"SacadasMenu",component:d["a"]},{path:"/sacadas/new",name:"NuevaSacada",component:u["a"]},{path:"/sacadas/:id",name:"DetalleSacada",component:u["a"],props:!0},{path:"/gestionar-productos",name:"GestionarProductos",component:p["a"]},{path:"/gestionar-medidas",name:"GestionarMedidas",component:m["a"]},{path:"/gestionar-proveedores",name:"GestionarProveedores",component:h["a"]},{path:"/existencias",name:"Existencias",component:l["a"]},{path:"/existencias-crudos",name:"ExistenciasCrudos",component:Z["a"]},{path:"/existencias-crudos/new",name:"NuevoRegistroCrudos",component:ee["a"]},{path:"/existencias-crudos/:id",name:"EditarRegistroCrudos",component:ee["a"],props:!0},{path:"/cuentas-mexico",name:"CuentasMexico",component:f["a"]},{path:"/cuentas-ozuna",name:"ozuna-cuentas-menu",component:g["a"]},{path:"/cuentas-ozuna/nueva",name:"nueva-cuenta-ozuna",component:y["a"]},{path:"/cuentas-ozuna/:id",name:"ver-cuenta-ozuna",component:y["a"]},{path:"/cuentas-ozuna/:id?",name:"CuentasOzuna",component:y["a"]},{path:"/cuentas-catarro",name:"catarro-cuentas-menu",component:v["a"]},{path:"/cuentas-catarro/nueva",name:"nueva-cuenta-catarro",component:b["a"]},{path:"/cuentas-catarro/:id",name:"ver-cuenta-catarro",component:b["a"]},{path:"/cuentas-catarro/:id?",name:"CuentasCatarro",component:b["a"]},{path:"/cuentas-joselito",name:"joselito-cuentas-menu",component:S["a"]},{path:"/cuentas-joselito/nueva",name:"nueva-cuenta-joselito",component:w["a"]},{path:"/cuentas-joselito/:id",name:"ver-cuenta-joselito",component:w["a"]},{path:"/cuentas-joselito/:id?",name:"CuentasJoselito",component:w["a"]},{path:"/embarques-menu",name:"EmbarquesMenu",component:P["a"]},{path:"/ventas-ganancias-catarro",name:"VentasYGananciasCatarro",component:E["a"]},{path:"/ventas-ganancias-joselito",name:"VentasYGananciasJoselito",component:q["a"]},{path:"/cuentas-veronica",name:"veronica-cuentas-menu",component:k["a"]},{path:"/cuentas-veronica/nueva",name:"nueva-cuenta-veronica",component:M["a"]},{path:"/cuentas-veronica/:id",name:"ver-cuenta-veronica",component:M["a"]},{path:"/cuentas-veronica/:id?",name:"CuentasVeronica",component:M["a"]},{path:"/ventas-ganancias-veronica",name:"VentasYGananciasVeronica",component:T["a"]},{path:"/embarques",name:"ListaEmbarques",component:D["a"]},{path:"/embarques/recuperacion-emergencia",name:"RecuperacionEmergencia",component:R["a"]},{path:"/embarques/:id",name:"EditarEmbarque",component:O["a"]},{path:"/nuevo-embarque",name:"NuevoEmbarque",component:O["a"]},{path:"/embarques/:id/rendimientos",name:"Rendimientos",component:B["default"],props:!0},{path:"/embarques/:id/costos",name:"GestionCostos",component:C["a"],props:!0},{path:"/cuenta-fletes",name:"CuentaFletes",component:x["a"]},{path:"/cuentas-otilio",name:"otilio-cuentas-menu",component:z["a"]},{path:"/cuentas-otilio/nueva",name:"nueva-cuenta-otilio",component:j["a"]},{path:"/cuentas-otilio/:id",name:"ver-cuenta-otilio",component:j["a"]},{path:"/cuentas-otilio/:id?",name:"CuentasOtilio",component:j["a"]},{path:"/cuentas-otilio-independiente",name:"otilio-independiente-cuentas-menu",component:I["a"]},{path:"/cuentas-otilio-independiente/nueva",name:"nueva-cuenta-otilio-independiente",component:A["a"]},{path:"/cuentas-otilio-independiente/:id",name:"ver-cuenta-otilio-independiente",component:A["a"]},{path:"/cuentas-otilio-independiente/:id?",name:"CuentasOtilioIndependiente",component:A["a"]},{path:"/procesos",name:"ProcesosMenu",component:F["a"]},{path:"/procesos/preparacion",name:"Preparacion",component:N["a"]},{path:"/procesos/pedidos",name:"PedidosMenu",component:G["a"]},{path:"/procesos/pedidos/nuevo",name:"NuevoPedido",component:V["a"]},{path:"/procesos/pedidos/crudo",name:"PedidosCrudo",component:$["a"]},{path:"/procesos/pedidos/limpio",name:"PedidosLimpio",component:V["a"]},{path:"/procesos/pedidos-crudos-impresion",name:"PedidoCrudosImpresion",component:Q["a"],props:!0},{path:"/procesos/pedidos-limpio-impresion",name:"PedidoLimpioImpresion",component:J["a"],props:!0},{path:"/procesos/bitacoras",name:"Bitacoras",component:_["a"]},{path:"/procesos/deudas",name:"DeudasMenu",component:Y["a"]},{path:"/procesos/deudas/lista",name:"ListaDeudas",component:H["a"]},{path:"/procesos/deudas/nueva",name:"NuevaDeuda",component:U["a"]},{path:"/procesos/prestamos",name:"PrestamosMenu",component:K["a"]},{path:"/procesos/prestamos/despicadoras",name:"PrestamosDespicadoras",component:W["a"]},{path:"/procesos/prestamos/trabajadores",name:"PrestamosTrabajadores",component:X["a"]},{path:"/barcos",name:"BarcosMenu",component:te["a"]},{path:"/barcos/deudas/nueva",name:"NuevaDeudaBarco",component:ne["a"]},{path:"/barcos/deudas/lista",name:"ListaDeudasBarcos",component:ae["a"]},{path:"/barcos/resumen-mensual",name:"ResumenMensualBarcos",component:se["a"]},{path:"/barcos/tripulantes",name:"GestionTripulantes",component:oe["a"]}],re=new s["a"]({mode:"history",base:"/",routes:ie});re.beforeEach((e,t,n)=>{try{0;const t=localStorage.getItem("user");let s=!1;if(t)try{const e=JSON.parse(t);s=e&&e.username}catch(a){localStorage.removeItem("user"),s=!1}if("/login"===e.path&&s)return void n("/");if("/login"!==e.path&&!s)return void n("/login");n()}catch(s){console.error("Error en navigation guard:",s),"/login"===e.path?n():n("/login")}}),t["a"]=re},b1ba:function(e,t,n){"use strict";n("d9e2");const a="ReyPezOfflineDB",s=1,o="embarques";class i{constructor(){this.dbPromise=null,this.memoryStore=new Map,this.useMemoryFallback=!1}async init(){if(this.dbPromise)return this.dbPromise;if("undefined"===typeof window||!window.indexedDB)return console.warn("[EmbarquesOfflineService] indexedDB no disponible, usando almacenamiento en memoria."),this.useMemoryFallback=!0,this.dbPromise=Promise.resolve(null),this.dbPromise;this.dbPromise=new Promise((e,t)=>{const n=window.indexedDB.open(a,s);n.onupgradeneeded=e=>{const t=e.target.result;if(!t.objectStoreNames.contains(o)){const e=t.createObjectStore(o,{keyPath:"id"});e.createIndex("fecha","fecha",{unique:!1}),e.createIndex("pendingSync","pendingSync",{unique:!1})}},n.onsuccess=()=>{e(n.result)},n.onerror=()=>{console.error("[EmbarquesOfflineService] Error al abrir IndexedDB:",n.error),this.useMemoryFallback=!0,e(null)}});try{await this.dbPromise}catch(e){console.error("[EmbarquesOfflineService] Error inicializando IndexedDB:",e),this.useMemoryFallback=!0,this.dbPromise=Promise.resolve(null)}return this.dbPromise}async getDb(){return this.useMemoryFallback?null:this.init()}buildRecord(e,t={}){var n;if(!e||!e.id)throw new Error("El embarque debe incluir un id válido para guardarse offline");return{id:e.id,...e,updatedAt:Date.now(),pendingSync:null!==(n=t.pendingSync)&&void 0!==n&&n,syncState:t.syncState||(t.pendingSync?"pending":"synced"),lastSyncError:t.lastSyncError||null,deleted:t.deleted||!1}}async save(e,t={}){const n=this.buildRecord(e,t);if(this.useMemoryFallback)return this.memoryStore.set(n.id,n),n.id;const a=await this.getDb();return a?new Promise((e,t)=>{const s=a.transaction(o,"readwrite"),i=s.objectStore(o);i.put(n),s.oncomplete=()=>e(n.id),s.onerror=()=>t(s.error)}):(this.memoryStore.set(n.id,n),n.id)}async getAll(){if(this.useMemoryFallback)return this.sortRecords(Array.from(this.memoryStore.values()));const e=await this.getDb();return e?new Promise((t,n)=>{const a=e.transaction(o,"readonly"),s=a.objectStore(o),i=s.getAll();i.onsuccess=()=>{t(this.sortRecords(i.result||[]))},i.onerror=()=>n(i.error)}):this.sortRecords(Array.from(this.memoryStore.values()))}sortRecords(e){return(e||[]).filter(e=>!e.deleted).sort((e,t)=>{const n=e.fecha?new Date(e.fecha).getTime():0,a=t.fecha?new Date(t.fecha).getTime():0;return a-n})}async getById(e){if(!e)return null;if(this.useMemoryFallback)return this.memoryStore.get(e)||null;const t=await this.getDb();return t?new Promise((n,a)=>{const s=t.transaction(o,"readonly"),i=s.objectStore(o),r=i.get(e);r.onsuccess=()=>n(r.result||null),r.onerror=()=>a(r.error)}):this.memoryStore.get(e)||null}async markDeleted(e,t={}){var n;const a=await this.getById(e);if(!a)return;const s={...a,deleted:!0,pendingSync:null===(n=t.pendingSync)||void 0===n||n,syncState:t.syncState||"pending-delete",updatedAt:Date.now()};return this.save(s,{pendingSync:s.pendingSync,syncState:s.syncState})}async hardDelete(e){if(this.useMemoryFallback)return void this.memoryStore.delete(e);const t=await this.getDb();if(t)return new Promise((n,a)=>{const s=t.transaction(o,"readwrite"),i=s.objectStore(o),r=i.delete(e);r.onsuccess=()=>n(),r.onerror=()=>a(r.error)});this.memoryStore.delete(e)}async getPendingSync(){const e=await this.getAll();return e.filter(e=>e.pendingSync)}async markSynced(e){const t=await this.getById(e);if(!t)return;const n={...t,pendingSync:!1,syncState:"synced",lastSyncError:null,updatedAt:Date.now()};return this.save(n,{pendingSync:!1,syncState:"synced"})}async markSyncError(e,t){const n=await this.getById(e);if(!n)return;const a={...n,pendingSync:!0,syncState:"error",lastSyncError:t?String(t):"Error desconocido",updatedAt:Date.now()};return this.save(a,{pendingSync:!0,syncState:"error",lastSyncError:a.lastSyncError})}async mergeSave(e,t={},n={}){await this.init();const a=await this.getById(e);let s,o={...n};if("function"===typeof t){const e=t(a?{...a}:null);if(!e)return null;e.record?(s=e.record,o={...o,...e.options||{}}):s=e}else s={...a||{},...t||{}};return s?(s.id||(s.id=e),this.save(s,o)):null}}t["a"]=new i},d954:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));n("d9e2"),n("14d9"),n("88e6"),n("70cc"),n("eb03"),n("22e5c"),n("c01e"),n("fa76"),n("8306");var a=n("2ef0");class s{constructor(){this.config={minDebounceTime:2e3,maxDebounceTime:3e4,baseBackoffTime:3e3,maxBackoffTime:12e4,maxRetries:5,batchSize:5,quotaResetTime:45e3},this.pendingOperations=new Map,this.currentBackoff=this.config.baseBackoffTime,this.retryCount=0,this.lastSaveTime=0,this.isProcessing=!1,this.saveQueue=[],this.listeners=new Map,this.quotaExhausted=!1,this.quotaResetTimer=null,this.stats={totalSaves:0,successfulSaves:0,failedSaves:0,quotaErrors:0,lastError:null,lastSuccessTime:null},this.debouncedProcess=Object(a["debounce"])(()=>this.processPendingOperations(),this.config.minDebounceTime)}scheduleSave(e,t,n={}){const{priority:a="normal",merge:s=!0,immediate:o=!1,force:i=!1}=n;if(this.quotaExhausted&&"high"!==a)return console.warn("[SaveManager] Cuota agotada, operación rechazada:",e),this.notifyListeners("quota-exhausted",{key:e}),Promise.reject(new Error("Cuota de Firestore agotada temporalmente"));const r=Date.now(),c={high:0,normal:1,low:2};if(s&&this.pendingOperations.has(e)){var u,d;const n=this.pendingOperations.get(e);n.operation=t,n.timestamp=r,n.retries=0;const s=null!==(u=c[n.priority])&&void 0!==u?u:c.normal,o=null!==(d=c[a])&&void 0!==d?d:c.normal;o<s&&(n.priority=a)}else this.pendingOperations.set(e,{operation:t,priority:a,timestamp:r,retries:0});return this.notifyListeners("operation-scheduled",{key:e,priority:a}),!i&&!o||this.isProcessing||this.quotaExhausted?(this.debouncedProcess(),Promise.resolve()):i?(this.debouncedProcess.cancel(),this.processPendingOperations()):this.processSingleOperation(e)}async processSingleOperation(e){const t=this.pendingOperations.get(e);if(!t)return;const n=Date.now()-this.lastSaveTime;n<1e3&&await this.delay(1e3-n);try{this.isProcessing=!0,this.notifyListeners("save-start",{key:e}),await t.operation(),this.pendingOperations.delete(e),this.lastSaveTime=Date.now(),this.stats.successfulSaves++,this.stats.lastSuccessTime=new Date,this.currentBackoff=this.config.baseBackoffTime,this.retryCount=0,this.notifyListeners("save-success",{key:e})}catch(a){await this.handleError(a,e,t)}finally{this.isProcessing=!1}}async processPendingOperations(){if(this.isProcessing||0===this.pendingOperations.size)return;this.isProcessing=!0,this.notifyListeners("batch-start",{count:this.pendingOperations.size});const e=Array.from(this.pendingOperations.entries()).sort((e,t)=>{const n={high:0,normal:1,low:2},a=n[e[1].priority]-n[t[1].priority];return 0!==a?a:e[1].timestamp-t[1].timestamp}),t=[];for(let a=0;a<e.length;a+=this.config.batchSize)t.push(e.slice(a,a+this.config.batchSize));for(const a of t){if(this.quotaExhausted){console.log("[SaveManager] Pausando procesamiento por cuota agotada");break}for(const[e,t]of a)try{await this.delay(this.calculateDelay()),this.notifyListeners("save-start",{key:e}),await t.operation(),this.pendingOperations.delete(e),this.lastSaveTime=Date.now(),this.stats.successfulSaves++,this.stats.totalSaves++,this.stats.lastSuccessTime=new Date,this.currentBackoff=this.config.baseBackoffTime,this.retryCount=0,this.notifyListeners("save-success",{key:e})}catch(n){if(await this.handleError(n,e,t),this.isQuotaError(n))break}t.indexOf(a)<t.length-1&&await this.delay(2e3)}this.isProcessing=!1,this.notifyListeners("batch-complete",{remaining:this.pendingOperations.size}),this.pendingOperations.size>0&&setTimeout(()=>{this.debouncedProcess()},this.currentBackoff)}async handleError(e,t,n){if(console.error("[SaveManager] Error al guardar:",e),this.stats.failedSaves++,this.stats.lastError=e,this.isQuotaError(e))return this.stats.quotaErrors++,void await this.handleQuotaError();n.retries++,n.retries<this.config.maxRetries?(console.log(`[SaveManager] Reintentando operación ${t} (intento ${n.retries}/${this.config.maxRetries})`),this.currentBackoff=Math.min(2*this.currentBackoff,this.config.maxBackoffTime),this.notifyListeners("save-retry",{key:t,attempt:n.retries,nextRetryIn:this.currentBackoff})):(console.error(`[SaveManager] Operación ${t} falló después de ${this.config.maxRetries} intentos`),this.pendingOperations.delete(t),this.notifyListeners("save-failed",{key:t,error:e.message}))}async handleQuotaError(){this.quotaExhausted=!0,this.currentBackoff=this.config.maxBackoffTime,console.warn("[SaveManager] Cuota de Firestore agotada. Pausando operaciones por",this.config.quotaResetTime/1e3,"segundos"),this.notifyListeners("quota-error",{resetIn:this.config.quotaResetTime}),this.quotaResetTimer&&clearTimeout(this.quotaResetTimer),this.quotaResetTimer=setTimeout(()=>{this.quotaExhausted=!1,this.currentBackoff=this.config.baseBackoffTime,console.log("[SaveManager] Cuota reseteada, reanudando operaciones"),this.notifyListeners("quota-reset",{}),this.pendingOperations.size>0&&this.debouncedProcess()},this.config.quotaResetTime)}isQuotaError(e){var t,n,a;return"resource-exhausted"===e.code||(null===(t=e.message)||void 0===t?void 0:t.includes("429"))||(null===(n=e.message)||void 0===n?void 0:n.includes("Too Many Requests"))||(null===(a=e.message)||void 0===a?void 0:a.includes("quota"))}calculateDelay(){let e=500;return this.retryCount>0&&(e+=1e3*this.retryCount),this.stats.quotaErrors>0&&(e+=2e3),Math.min(e,5e3)}addListener(e,t){this.listeners.has(e)||this.listeners.set(e,new Set);const n=e=>{try{"function"===typeof t&&t(e)}catch(n){throw n}};return n._original=t,this.listeners.get(e).add(n),()=>{this.removeListener(e,n)}}removeListener(e,t){if(this.listeners.has(e)){const n=this.listeners.get(e);n.forEach(e=>{e!==t&&e._original!==t||n.delete(e)})}}clearListeners(e=null){e?this.listeners.has(e)&&this.listeners.get(e).clear():this.listeners.clear()}notifyListeners(e,t){this.listeners.has(e)&&this.listeners.get(e).forEach(n=>{try{n(t)}catch(a){const t=a.message||a.toString(),n=t.includes("Cannot read properties of null")||t.includes("SaveManager no disponible")||t.includes("_isDestroyed");n?window.DEBUG_SAVE_MANAGER&&console.debug(`[SaveManager] Error esperado en listener de ${e}:`,t):console.error(`[SaveManager] Error en listener de ${e}:`,a)}})}async forceProcessAll(){if(console.log("[SaveManager] Forzando procesamiento de todas las operaciones pendientes"),this.debouncedProcess&&this.debouncedProcess.cancel(),this.pendingOperations.size>0){this.notifyListeners("force-save-start",{count:this.pendingOperations.size});try{await this.processPendingOperations(),console.log("[SaveManager] Todas las operaciones forzadas completadas"),this.notifyListeners("force-save-complete",{})}catch(e){throw console.error("[SaveManager] Error durante guardado forzado:",e),this.notifyListeners("force-save-error",{error:e}),e}}return Promise.resolve()}cancelAll(){this.pendingOperations.clear(),this.debouncedProcess.cancel(),this.isProcessing=!1,this.quotaResetTimer&&(clearTimeout(this.quotaResetTimer),this.quotaResetTimer=null),this.notifyListeners("all-cancelled",{})}getStatus(){return{pendingOperations:this.pendingOperations.size,isProcessing:this.isProcessing,quotaExhausted:this.quotaExhausted,currentBackoff:this.currentBackoff,stats:{...this.stats}}}delay(e){return new Promise(t=>setTimeout(t,e))}destroy(){this.cancelAll(),this.listeners.clear()}}let o=null;function i(){return o||(o=new s),o}}}]);