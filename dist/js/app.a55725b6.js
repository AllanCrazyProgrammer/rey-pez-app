(function(t){function e(e){for(var o,r,n=e[0],c=e[1],l=e[2],d=0,m=[];d<n.length;d++)r=n[d],Object.prototype.hasOwnProperty.call(i,r)&&i[r]&&m.push(i[r][0]),i[r]=0;for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(t[o]=c[o]);u&&u(e);while(m.length)m.shift()();return s.push.apply(s,l||[]),a()}function a(){for(var t,e=0;e<s.length;e++){for(var a=s[e],o=!0,r=1;r<a.length;r++){var c=a[r];0!==i[c]&&(o=!1)}o&&(s.splice(e--,1),t=n(n.s=a[0]))}return t}var o={},i={app:0},s=[];function r(t){return n.p+"js/"+({}[t]||t)+"."+{"chunk-00c0e52c":"1aa0c9ed","chunk-2d0a385c":"60c79ddb","chunk-2d216214":"1cff4ebd"}[t]+".js"}function n(e){if(o[e])return o[e].exports;var a=o[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.e=function(t){var e=[],a=i[t];if(0!==a)if(a)e.push(a[2]);else{var o=new Promise((function(e,o){a=i[t]=[e,o]}));e.push(a[2]=o);var s,c=document.createElement("script");c.charset="utf-8",c.timeout=120,n.nc&&c.setAttribute("nonce",n.nc),c.src=r(t);var l=new Error;s=function(e){c.onerror=c.onload=null,clearTimeout(d);var a=i[t];if(0!==a){if(a){var o=e&&("load"===e.type?"missing":e.type),s=e&&e.target&&e.target.src;l.message="Loading chunk "+t+" failed.\n("+o+": "+s+")",l.name="ChunkLoadError",l.type=o,l.request=s,a[1](l)}i[t]=void 0}};var d=setTimeout((function(){s({type:"timeout",target:c})}),12e4);c.onerror=c.onload=s,document.head.appendChild(c)}return Promise.all(e)},n.m=t,n.c=o,n.d=function(t,e,a){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(a,o,function(e){return t[e]}.bind(null,o));return a},n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/",n.oe=function(t){throw console.error(t),t};var c=window["webpackJsonp"]=window["webpackJsonp"]||[],l=c.push.bind(c);c.push=e,c=c.slice();for(var d=0;d<c.length;d++)e(c[d]);var u=l;s.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("56d7")},"04a5":function(t,e,a){},"051a":function(t,e,a){},"05e4":function(t,e,a){"use strict";a("959e")},"0836":function(t,e,a){},"089a":function(t,e,a){},"0987":function(t,e,a){},"0aa6":function(t,e,a){"use strict";a("21fe")},"0ada":function(t,e,a){"use strict";a("27e0")},"0db6":function(t,e,a){"use strict";a("a622")},"0f9e":function(t,e,a){},1097:function(t,e,a){"use strict";a("c0bd")},1159:function(t,e,a){"use strict";a("72a4")},"1a24":function(t,e,a){"use strict";a("ae5a")},"1b08":function(t,e,a){},"1b56":function(t,e,a){},"1d3e":function(t,e,a){"use strict";a("d9d5")},"21fe":function(t,e,a){},"27e0":function(t,e,a){},"2b68":function(t,e,a){"use strict";a("d5fa")},"2efd":function(t,e,a){},3480:function(t,e,a){"use strict";a("1b08")},"3a82":function(t,e,a){"use strict";a("64a8")},"3bcd":function(t,e,a){},4175:function(t,e,a){"use strict";a("9924")},"426e":function(t,e,a){},4437:function(t,e,a){},"458c":function(t,e,a){"use strict";a("cec2")},4678:function(t,e,a){var o={"./af":"2bfb","./af.js":"2bfb","./ar":"8e73","./ar-dz":"a356","./ar-dz.js":"a356","./ar-kw":"423e","./ar-kw.js":"423e","./ar-ly":"1cfd","./ar-ly.js":"1cfd","./ar-ma":"0a84","./ar-ma.js":"0a84","./ar-ps":"4c98","./ar-ps.js":"4c98","./ar-sa":"8230","./ar-sa.js":"8230","./ar-tn":"6d83","./ar-tn.js":"6d83","./ar.js":"8e73","./az":"485c","./az.js":"485c","./be":"1fc1","./be.js":"1fc1","./bg":"84aa","./bg.js":"84aa","./bm":"a7fa","./bm.js":"a7fa","./bn":"9043","./bn-bd":"9686","./bn-bd.js":"9686","./bn.js":"9043","./bo":"d26a","./bo.js":"d26a","./br":"6887","./br.js":"6887","./bs":"2554","./bs.js":"2554","./ca":"d716","./ca.js":"d716","./cs":"3c0d","./cs.js":"3c0d","./cv":"03ec","./cv.js":"03ec","./cy":"9797","./cy.js":"9797","./da":"0f14","./da.js":"0f14","./de":"b469","./de-at":"b3eb","./de-at.js":"b3eb","./de-ch":"bb71","./de-ch.js":"bb71","./de.js":"b469","./dv":"598a","./dv.js":"598a","./el":"8d47","./el.js":"8d47","./en-au":"0e6b","./en-au.js":"0e6b","./en-ca":"3886","./en-ca.js":"3886","./en-gb":"39a6","./en-gb.js":"39a6","./en-ie":"e1d3","./en-ie.js":"e1d3","./en-il":"7333","./en-il.js":"7333","./en-in":"ec2e","./en-in.js":"ec2e","./en-nz":"6f50","./en-nz.js":"6f50","./en-sg":"b7e9","./en-sg.js":"b7e9","./eo":"65db","./eo.js":"65db","./es":"898b","./es-do":"0a3c","./es-do.js":"0a3c","./es-mx":"b5b7","./es-mx.js":"b5b7","./es-us":"55c9","./es-us.js":"55c9","./es.js":"898b","./et":"ec18","./et.js":"ec18","./eu":"0ff2","./eu.js":"0ff2","./fa":"8df4","./fa.js":"8df4","./fi":"81e9","./fi.js":"81e9","./fil":"d69a","./fil.js":"d69a","./fo":"0721","./fo.js":"0721","./fr":"9f26","./fr-ca":"d9f8","./fr-ca.js":"d9f8","./fr-ch":"0e49","./fr-ch.js":"0e49","./fr.js":"9f26","./fy":"7118","./fy.js":"7118","./ga":"5120","./ga.js":"5120","./gd":"f6b4","./gd.js":"f6b4","./gl":"8840","./gl.js":"8840","./gom-deva":"aaf2","./gom-deva.js":"aaf2","./gom-latn":"0caa","./gom-latn.js":"0caa","./gu":"e0c5","./gu.js":"e0c5","./he":"c7aa","./he.js":"c7aa","./hi":"dc4d","./hi.js":"dc4d","./hr":"4ba9","./hr.js":"4ba9","./hu":"5b14","./hu.js":"5b14","./hy-am":"d6b6","./hy-am.js":"d6b6","./id":"5038","./id.js":"5038","./is":"0558","./is.js":"0558","./it":"6e98","./it-ch":"6f12","./it-ch.js":"6f12","./it.js":"6e98","./ja":"079e","./ja.js":"079e","./jv":"b540","./jv.js":"b540","./ka":"201b","./ka.js":"201b","./kk":"6d79","./kk.js":"6d79","./km":"e81d","./km.js":"e81d","./kn":"3e92","./kn.js":"3e92","./ko":"22f8","./ko.js":"22f8","./ku":"2421","./ku-kmr":"7558","./ku-kmr.js":"7558","./ku.js":"2421","./ky":"9609","./ky.js":"9609","./lb":"440c","./lb.js":"440c","./lo":"b29d","./lo.js":"b29d","./lt":"26f9","./lt.js":"26f9","./lv":"b97c","./lv.js":"b97c","./me":"293c","./me.js":"293c","./mi":"688b","./mi.js":"688b","./mk":"6909","./mk.js":"6909","./ml":"02fb","./ml.js":"02fb","./mn":"958b","./mn.js":"958b","./mr":"39bd","./mr.js":"39bd","./ms":"ebe4","./ms-my":"6403","./ms-my.js":"6403","./ms.js":"ebe4","./mt":"1b45","./mt.js":"1b45","./my":"8689","./my.js":"8689","./nb":"6ce3","./nb.js":"6ce3","./ne":"3a39","./ne.js":"3a39","./nl":"facd","./nl-be":"db29","./nl-be.js":"db29","./nl.js":"facd","./nn":"b84c","./nn.js":"b84c","./oc-lnc":"167b","./oc-lnc.js":"167b","./pa-in":"f3ff","./pa-in.js":"f3ff","./pl":"8d57","./pl.js":"8d57","./pt":"f260","./pt-br":"d2d4","./pt-br.js":"d2d4","./pt.js":"f260","./ro":"972c","./ro.js":"972c","./ru":"957c","./ru.js":"957c","./sd":"6784","./sd.js":"6784","./se":"ffff","./se.js":"ffff","./si":"eda5","./si.js":"eda5","./sk":"7be6","./sk.js":"7be6","./sl":"8155","./sl.js":"8155","./sq":"c8f3","./sq.js":"c8f3","./sr":"cf1e","./sr-cyrl":"13e9","./sr-cyrl.js":"13e9","./sr.js":"cf1e","./ss":"52bd","./ss.js":"52bd","./sv":"5fbd","./sv.js":"5fbd","./sw":"74dc","./sw.js":"74dc","./ta":"3de5","./ta.js":"3de5","./te":"5cbb","./te.js":"5cbb","./tet":"576c","./tet.js":"576c","./tg":"3b1b","./tg.js":"3b1b","./th":"10e8","./th.js":"10e8","./tk":"5aff","./tk.js":"5aff","./tl-ph":"0f38","./tl-ph.js":"0f38","./tlh":"cf755","./tlh.js":"cf755","./tr":"0e81","./tr.js":"0e81","./tzl":"cf51","./tzl.js":"cf51","./tzm":"c109","./tzm-latn":"b53d","./tzm-latn.js":"b53d","./tzm.js":"c109","./ug-cn":"6117","./ug-cn.js":"6117","./uk":"ada2","./uk.js":"ada2","./ur":"5294","./ur.js":"5294","./uz":"2e8c","./uz-latn":"010e","./uz-latn.js":"010e","./uz.js":"2e8c","./vi":"2921","./vi.js":"2921","./x-pseudo":"fd7e","./x-pseudo.js":"fd7e","./yo":"7f33","./yo.js":"7f33","./zh-cn":"5c3a","./zh-cn.js":"5c3a","./zh-hk":"49ab","./zh-hk.js":"49ab","./zh-mo":"3a6c","./zh-mo.js":"3a6c","./zh-tw":"90ea","./zh-tw.js":"90ea"};function i(t){var e=s(t);return a(e)}function s(t){if(!a.o(o,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return o[t]}i.keys=function(){return Object.keys(o)},i.resolve=s,t.exports=i,i.id="4678"},"46cc":function(t,e,a){"use strict";a("473b")},"473b":function(t,e,a){},4786:function(t,e,a){"use strict";a("e1ab")},"4a6a":function(t,e,a){},"4c80":function(t,e,a){},"4dc0":function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"rendimientos-container"},[e("div",{staticClass:"header-container"},[e("button",{staticClass:"btn-volver",on:{click:t.volverAEmbarque}},[e("i",{staticClass:"fas fa-arrow-left"}),t._v(" Volver al Embarque ")]),e("h2",[t._v("Rendimientos por Medida")]),e("button",{staticClass:"btn-nota",on:{click:t.abrirModalNota}},[e("i",{staticClass:"fas fa-sticky-note"}),t._v(" Agregar Nota ")]),e("button",{staticClass:"btn-costos",on:{click:t.abrirModalCostos}},[e("i",{staticClass:"fas fa-dollar-sign"}),t._v(" Costos ")]),e("button",{staticClass:"btn-pdf",on:{click:t.generarPDF}},[e("i",{staticClass:"fas fa-file-pdf"}),t._v(" Generar PDF ")])]),t.embarqueData?e("div",{staticClass:"rendimientos-grid"},t._l(t.medidasUnicas,(function(a,o){return e("div",{key:o,staticClass:"rendimiento-card"},[e("div",{staticClass:"medida-info"},[e("div",{staticClass:"medida-header"},[e("span",{staticClass:"medida-label editable-label",on:{click:function(e){return t.editarNombreMedida(a)}}},[t._v(" "+t._s(t.obtenerNombreMedidaPersonalizado(a))+" ")]),e("div",{staticClass:"ocultar-control"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.medidaOculta[a],expression:"medidaOculta[medida]"}],attrs:{type:"checkbox",id:"ocultar-"+o},domProps:{checked:Array.isArray(t.medidaOculta[a])?t._i(t.medidaOculta[a],null)>-1:t.medidaOculta[a]},on:{change:[function(e){var o=t.medidaOculta[a],i=e.target,s=!!i.checked;if(Array.isArray(o)){var r=null,n=t._i(o,r);i.checked?n<0&&t.$set(t.medidaOculta,a,o.concat([r])):n>-1&&t.$set(t.medidaOculta,a,o.slice(0,n).concat(o.slice(n+1)))}else t.$set(t.medidaOculta,a,s)},t.guardarEstadoOculto]}}),e("label",{attrs:{for:"ocultar-"+o}},[t._v("Ocultar en PDF")])])]),e("div",{staticClass:"costo-input"},[e("div",{staticClass:"costo-container"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.costosPorMedida[a],expression:"costosPorMedida[medida]"}],attrs:{type:"number",placeholder:"Precio",step:"0.01"},domProps:{value:t.costosPorMedida[a]},on:{input:[function(e){e.target.composing||t.$set(t.costosPorMedida,a,e.target.value)},t.guardarCostos]}}),t.costosPorMedida[a]?e("span",{staticClass:"costo-final"},[t._v(" Costo Final: $"+t._s(t.calcularCostoFinal(a))+" ")]):t._e()])]),e("div",{staticClass:"input-group"},[t.esMedidaMix(a)?[e("div",{staticClass:"mix-inputs"},[e("div",{staticClass:"mix-input"},[e("label",{staticClass:"editable-label",on:{click:function(e){return t.editarEtiqueta(a,"medida1")}}},[t._v(" "+t._s(t.obtenerEtiqueta(a,"medida1"))+": ")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.kilosCrudos[a].medida1,expression:"kilosCrudos[medida].medida1"}],attrs:{type:"number",placeholder:"Kilos medida 1"},domProps:{value:t.kilosCrudos[a].medida1},on:{input:[function(e){e.target.composing||t.$set(t.kilosCrudos[a],"medida1",e.target.value)},function(e){return t.calcularRendimiento(a)}]}})]),e("div",{staticClass:"mix-input"},[e("label",{staticClass:"editable-label",on:{click:function(e){return t.editarEtiqueta(a,"medida2")}}},[t._v(" "+t._s(t.obtenerEtiqueta(a,"medida2"))+": ")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.kilosCrudos[a].medida2,expression:"kilosCrudos[medida].medida2"}],attrs:{type:"number",placeholder:"Kilos medida 2"},domProps:{value:t.kilosCrudos[a].medida2},on:{input:[function(e){e.target.composing||t.$set(t.kilosCrudos[a],"medida2",e.target.value)},function(e){return t.calcularRendimiento(a)}]}})])])]:[e("label",[t._v("Kilos en crudo:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.kilosCrudos[a],expression:"kilosCrudos[medida]"}],attrs:{type:"number",placeholder:"Ingrese kilos"},domProps:{value:t.kilosCrudos[a]},on:{input:[function(e){e.target.composing||t.$set(t.kilosCrudos,a,e.target.value)},function(e){return t.calcularRendimiento(a)}]}})]],2),e("div",{staticClass:"resultados"},[e("p",[t._v("Total embarcado: "+t._s(t.obtenerTotalEmbarcado(a).toFixed(1))+" kg")]),e("p",{staticClass:"rendimiento"},[t._v(" Rendimiento: "),e("span",{class:{"rendimiento-alto":t.getRendimiento(a)>1}},[t._v(" "+t._s(t.getRendimiento(a).toFixed(2))+" ")])])])])])})),0):e("div",[e("p",[t._v("Cargando datos del embarque...")])]),t.mostrarModal?e("div",{staticClass:"modal-overlay"},[e("div",{staticClass:"modal-content"},[e("h3",[t._v("Agregar Nota")]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.nota,expression:"nota"}],attrs:{placeholder:"Escriba su nota aquí...",rows:"4"},domProps:{value:t.nota},on:{input:function(e){e.target.composing||(t.nota=e.target.value)}}}),e("div",{staticClass:"modal-buttons"},[e("button",{staticClass:"btn-guardar",on:{click:t.guardarNota}},[t._v("Guardar")]),e("button",{staticClass:"btn-cancelar",on:{click:t.cerrarModal}},[t._v("Cancelar")])])])]):t._e(),e("CostosModal",{attrs:{showModal:t.showCostosModal,costosPorMedida:t.costosPorMedida,rendimientos:t.rendimientosPorMedida},on:{"update:showModal":function(e){t.showCostosModal=e},guardar:t.guardarCostos}})],1)},i=[],s=(a("14d9"),a("13d5"),a("1494")),r=a("2ef0"),n=a("e499"),c=a.n(n),l=a("4ebb"),d=a.n(l);"object"===typeof d.a&&(d.a.pdfMake&&d.a.pdfMake.vfs?c.a.vfs=d.a.pdfMake.vfs:d.a.vfs?c.a.vfs=d.a.vfs:c.a.vfs=d.a),"undefined"===typeof window||window.pdfMake||(window.pdfMake=c.a);const u=async(t,e)=>{try{const a=await v("https://res.cloudinary.com/hwkcovsmr/image/upload/v1620946647/samples/REY_PEZ_LOGO_nsotww.png"),o=(null===e||void 0===e?void 0:e.nombresMedidasPersonalizados)||{},i=t=>{if(!t)return"Sin fecha";let e;if(t&&"function"===typeof t.toDate?e=t.toDate():"string"===typeof t?e=new Date(t):t instanceof Date&&(e=t),isNaN(e.getTime()))return"Fecha inválida";const a=new Date(e.getTime()+6e4*e.getTimezoneOffset());return a.toLocaleDateString("es-MX",{year:"numeric",month:"2-digit",day:"2-digit",timeZone:"America/Mexico_City"})},s={content:[{columns:[{image:a,width:80,alignment:"left",margin:[0,0,0,5]},{text:"Reporte de Rendimientos",style:"header",alignment:"center",margin:[0,10,0,0]},{stack:[{text:"Fecha: "+i(e.fecha),alignment:"right",margin:[0,10,0,0]}]}]},{text:"\n",height:5},m(t,o,e)],styles:{header:{fontSize:24,bold:!0,color:"#3760b0",margin:[0,0,0,5]},tableHeader:{bold:!0,fontSize:20,color:"white",fillColor:"#3760b0"},rendimientoAlto:{color:"#27ae60",bold:!0},rendimientoBajo:{color:"#000000"},costoStyle:{color:"#e74c3c",bold:!0}},defaultStyle:{fontSize:18},footer:function(t,e){return{columns:[{text:"© 2024 Rey Pez - Tampico, Tamps.",alignment:"center",margin:[0,5,0,0],fontSize:8,color:"#3760b0"}]}}};e.notaRendimientos&&(s.content.push({text:"\n",height:5}),s.content.push({text:"Nota:",style:"header",color:"red",alignment:"center",margin:[0,10,0,0]}),s.content.push({text:" "+e.notaRendimientos,style:"header",alignment:"center",color:"black",margin:[0,10,0,0]})),c.a.createPdf(s).open()}catch(a){console.error("Error al generar el PDF de rendimientos:",a)}};function m(t,e,a){const o=t.reduce((t,a)=>{const o=e[a.medida]||a.medida;return o.includes("mixta")||o.includes("Mixta")?(t["Mixta"]||(t["Mixta"]={medida:"Mixta",kilosCrudos:0,totalEmbarcado:0,costoFinal:a.costoFinal}),a.kilosCrudos&&("object"===typeof a.kilosCrudos?t["Mixta"].kilosCrudos+=(parseFloat(a.kilosCrudos.medida1)||0)+(parseFloat(a.kilosCrudos.medida2)||0):t["Mixta"].kilosCrudos+=parseFloat(a.kilosCrudos)||0),t["Mixta"].totalEmbarcado+=parseFloat(a.totalEmbarcado)||0):t[o]={medida:o,kilosCrudos:parseFloat(a.kilosCrudos)||0,totalEmbarcado:parseFloat(a.totalEmbarcado)||0,costoFinal:a.costoFinal},t},{}),i=Object.values(o).some(t=>t.costoFinal&&"0"!==t.costoFinal&&0!==t.costoFinal),s=a.mostrarColumnaCosto&&i,r=[[{text:"Kilos en Crudo",style:"tableHeader"},{text:"Medida",style:"tableHeader"},{text:"Rendimiento",style:"tableHeader"},...s?[{text:"Costo Final",style:"tableHeader"}]:[]],...Object.values(o).map(t=>{const e=t.totalEmbarcado>0?t.kilosCrudos/t.totalEmbarcado:0,a=e>1?"rendimientoAlto":"rendimientoBajo";let o=t.medida;if(t.medidasIncluidas){const e=Array.from(t.medidasIncluidas);o=`Mixta (${e.join(", ")})`}return[p(t.kilosCrudos),o,{text:`(${h(e)})`,style:a},...s?[{text:t.costoFinal?"$"+Number(t.costoFinal).toFixed(1):"",style:"costoStyle"}]:[]]})];return{table:{headerRows:1,widths:s?["*","*","*","*"]:["*","*","*"],body:r},layout:{hLineWidth:function(t,e){return 0===t||t===e.table.body.length?1.5:.5},vLineWidth:function(t,e){return 0===t||t===e.table.widths.length?1.5:.5},hLineColor:function(t,e){return 0===t||t===e.table.body.length?"#3760b0":"#cccccc"},vLineColor:function(t,e){return 0===t||t===e.table.widths.length?"#3760b0":"#cccccc"},fillColor:function(t,e,a){return t%2===0?"#f8f9fa":null},paddingLeft:function(t){return 4},paddingRight:function(t){return 4},paddingTop:function(t){return 2},paddingBottom:function(t){return 2}}}}function p(t){if("number"===typeof t)return(t%1===0?Math.floor(t):t.toFixed(1))+" kg";if("object"===typeof t&&null!==t){const e=(Number(t.medida1)||0)+(Number(t.medida2)||0);return(e%1===0?Math.floor(e):e.toFixed(1))+" kg"}const e=Number(t);return(e%1===0?Math.floor(e):e.toFixed(1))+" kg"}function h(t){return Number(t).toFixed(2)}function v(t){return new Promise((e,a)=>{const o=new Image;o.crossOrigin="Anonymous",o.onload=function(){const t=document.createElement("canvas");t.width=o.width,t.height=o.height;const a=t.getContext("2d");a.drawImage(o,0,0);const i=t.toDataURL("image/png");e(i)},o.onerror=a,o.src=t})}var b=function(){var t,e=this,a=e._self._c;return a("div",[a("button",{staticClass:"costos-btn",on:{click:function(t){return e.$emit("update:showModal",!0)}}},[a("i",{staticClass:"fas fa-dollar-sign"}),e._v(" Precios ")]),e.showModal?a("div",{staticClass:"modal-overlay"},[a("div",{staticClass:"modal-content"},[a("div",{staticClass:"modal-header"},[a("h2",[e._v("Precios por Producto")]),a("button",{staticClass:"close-btn",on:{click:e.cerrarModal}},[e._v("×")])]),a("div",{staticClass:"add-cost-form"},[a("h3",[e._v("Agregar Nuevo Producto/Precio")]),a("div",{staticClass:"form-group"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.newCost.medida,expression:"newCost.medida"}],attrs:{type:"text",placeholder:"Nombre del Producto",list:"medidas"},domProps:{value:e.newCost.medida},on:{input:function(t){t.target.composing||e.$set(e.newCost,"medida",t.target.value)}}}),a("datalist",{attrs:{id:"medidas"}},e._l(Object.keys(e.costosPorMedida),(function(t){return a("option",{key:t,domProps:{value:t}})})),0),a("input",{directives:[{name:"model",rawName:"v-model.number",value:e.newCost.costo,expression:"newCost.costo",modifiers:{number:!0}}],attrs:{type:"number",placeholder:"Precio",step:"0.01"},domProps:{value:e.newCost.costo},on:{input:function(t){t.target.composing||e.$set(e.newCost,"costo",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}}),a("input",{directives:[{name:"model",rawName:"v-model",value:e.newCost.fecha,expression:"newCost.fecha"}],attrs:{type:"date",max:e.currentDate},domProps:{value:e.newCost.fecha},on:{input:function(t){t.target.composing||e.$set(e.newCost,"fecha",t.target.value)}}}),a("button",{staticClass:"add-btn",on:{click:e.agregarCosto}},[e._v("Agregar")])])]),a("div",{staticClass:"current-costs"},[a("h3",[e._v("Precios Actuales")]),a("table",{staticClass:"costs-table"},[e._m(0),a("tbody",e._l(e.costosLocales,(function(t,o){return a("tr",{key:o},[a("td",[e._v(e._s(o))]),a("td",[a("input",{directives:[{name:"model",rawName:"v-model.number",value:e.costosLocales[o].costoBase,expression:"costosLocales[medida].costoBase",modifiers:{number:!0}}],staticClass:"cost-input",attrs:{type:"number",placeholder:"Precio",step:"0.01"},domProps:{value:e.costosLocales[o].costoBase},on:{input:[function(t){t.target.composing||e.$set(e.costosLocales[o],"costoBase",e._n(t.target.value))},function(t){return e.actualizarCostos(o)}],blur:function(t){return e.$forceUpdate()}}})]),a("td",[a("input",{directives:[{name:"model",rawName:"v-model",value:e.costosLocales[o].fecha,expression:"costosLocales[medida].fecha"}],staticClass:"date-input",attrs:{type:"date",max:e.currentDate},domProps:{value:e.costosLocales[o].fecha},on:{change:function(t){return e.actualizarCostos(o)},input:function(t){t.target.composing||e.$set(e.costosLocales[o],"fecha",t.target.value)}}})]),a("td",[a("button",{staticClass:"ver-btn",on:{click:function(t){return e.mostrarHistorial(o)}}},[e._v(" Ver ")])]),a("td",[a("button",{staticClass:"delete-btn",attrs:{title:"Eliminar producto"},on:{click:function(t){return e.eliminarMedida(o)}}},[e._v(" × ")])])])})),0)])]),a("div",{staticClass:"modal-footer"},[a("button",{staticClass:"save-btn",on:{click:e.guardarCostos}},[e._v("Guardar Cambios")]),a("button",{staticClass:"cancel-btn",on:{click:e.cerrarModal}},[e._v("Cancelar")])])])]):e._e(),e.showHistorialModal?a("div",{staticClass:"historial-modal"},[a("div",{staticClass:"historial-content"},[a("div",{staticClass:"historial-header"},[a("h3",[e._v("Historial de Precios - "+e._s(e.medidaSeleccionada))]),a("button",{staticClass:"close-btn",on:{click:function(t){e.showHistorialModal=!1}}},[e._v("×")])]),e.cargandoHistorial?a("div",{staticClass:"estado-carga"},[a("i",{staticClass:"fas fa-spinner fa-spin"}),a("span",[e._v("Cargando historial...")])]):e.errorHistorial?a("div",{staticClass:"estado-error"},[a("i",{staticClass:"fas fa-exclamation-circle"}),a("span",[e._v(e._s(e.errorHistorial))]),a("button",{staticClass:"retry-btn",on:{click:function(t){return e.mostrarHistorial(e.medidaSeleccionada)}}},[a("i",{staticClass:"fas fa-redo"}),e._v(" Reintentar ")])]):[a("div",{staticClass:"precio-evolucion"},[a("div",{staticClass:"precio-actual"},[a("span",{staticClass:"precio-label"},[e._v("Precio Actual:")]),a("span",{staticClass:"precio-valor"},[e._v("$"+e._s(e.formatNumber(null===(t=e.costosLocales[e.medidaSeleccionada])||void 0===t?void 0:t.costoBase)))])])]),a("table",{staticClass:"historial-table"},[e._m(1),a("tbody",e._l(e.historialCostos,(function(t,o){return a("tr",{key:o},[a("td",[e._v(e._s(e.formatDate(t.fecha)))]),a("td",{staticClass:"precio-celda"},[e._v("$"+e._s(e.formatNumber(t.costoBase)))]),t.cambio?a("td",{class:t.cambio.diferencia>0?"precio-subio":"precio-bajo"},[e._v(" "+e._s(t.cambio.diferencia>0?"+":"")+"$"+e._s(e.formatNumber(t.cambio.diferencia))+" ")]):a("td",[e._v("-")]),t.cambio?a("td",{class:t.cambio.diferencia>0?"precio-subio":"precio-bajo"},[e._v(" "+e._s(t.cambio.diferencia>0?"+":"")+e._s(t.cambio.porcentaje.toFixed(2))+"% ")]):a("td",[e._v("-")]),a("td",{staticClass:"actions-cell"},[a("button",{staticClass:"delete-btn",attrs:{title:"Eliminar precio"},on:{click:function(a){return e.eliminarCosto(t.id)}}},[e._v(" × ")])])])})),0)])]],2)]):e._e()])},f=[function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",[t._v("Producto")]),e("th",[t._v("Precio")]),e("th",[t._v("Fecha")]),e("th",[t._v("Historial")]),e("th",[t._v("Acciones")])])])},function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",[t._v("Fecha")]),e("th",[t._v("Precio")]),e("th",[t._v("Cambio")]),e("th",[t._v("Variación %")]),e("th",[t._v("Acciones")])])])}],g=a("dc59"),C={name:"CostosModal",props:{showModal:{type:Boolean,required:!0},costosPorMedida:{type:Object,required:!0}},data(){return{costosLocales:{},newCost:{medida:"",costo:null,fecha:(new Date).toISOString().split("T")[0]},showHistorialModal:!1,medidaSeleccionada:null,historialCostos:[],historialesPorMedida:{},cargandoHistorial:!1,errorHistorial:null,unsubscribeCostos:null}},computed:{currentDate(){return(new Date).toISOString().split("T")[0]}},async created(){await this.iniciarEscuchaCostos()},beforeDestroy(){this.unsubscribeCostos&&this.unsubscribeCostos()},watch:{showModal(t){t&&this.inicializarCostosLocales()}},methods:{formatNumber(t){return null===t||void 0===t?"0.00":Number(t).toLocaleString("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2})},formatDate(t){if(!t)return"";const[e,a,o]=t.split("-"),i=new Date(e,a-1,o),s={year:"numeric",month:"long",day:"numeric"};return i.toLocaleDateString("es-ES",s)},calcularCambio(t,e){const a=t-e,o=a/e*100,i=a>0?"+":"";return`${i}${this.formatNumber(a)} (${i}${o.toFixed(1)}%)`},inicializarCostosLocales(){this.costosLocales=Object.keys(this.costosPorMedida).reduce((t,e)=>(t[e]={costoBase:this.costosPorMedida[e].costoBase||0,fecha:this.costosPorMedida[e].fecha||(new Date).toISOString().split("T")[0]},t),{})},async actualizarCostos(t){try{const e={medida:t,costoBase:this.costosLocales[t].costoBase,fecha:this.costosLocales[t].fecha,timestamp:Object(s["m"])()};await Object(s["b"])(Object(s["c"])(g["a"],"precios_globales"),e);const a={medida:t,costoBase:this.costosLocales[t].costoBase,fecha:this.costosLocales[t].fecha};await Object(s["b"])(Object(s["c"])(g["a"],"costos"),a),await this.actualizarPreciosProductos(t,e.costoBase),await this.cargarHistorial(t)}catch(e){console.error("Error al actualizar precio:",e),alert("Error al actualizar el precio")}},async agregarCosto(){if(this.newCost.medida&&this.newCost.costo&&this.newCost.fecha)try{const t={medida:this.newCost.medida,costoBase:this.newCost.costo,fecha:this.newCost.fecha,timestamp:Object(s["m"])()};await Object(s["b"])(Object(s["c"])(g["a"],"precios_globales"),t);const e={medida:this.newCost.medida,costoBase:this.newCost.costo,fecha:this.newCost.fecha};await Object(s["b"])(Object(s["c"])(g["a"],"costos"),e),this.$set(this.costosLocales,this.newCost.medida,{costoBase:this.newCost.costo,fecha:this.newCost.fecha}),this.actualizarCostos(this.newCost.medida),this.newCost={medida:"",costo:null,fecha:(new Date).toISOString().split("T")[0]}}catch(t){console.error("Error al agregar precio:",t),alert("Error al guardar el precio")}else alert("Por favor complete todos los campos")},async iniciarEscuchaCostos(){try{const t=getFirestore(),e=Object(s["c"])(t,"precios_globales"),a=Object(s["l"])(e,Object(s["k"])("timestamp","desc"));this.unsubscribeCostos=Object(s["j"])(a,t=>{const e={};t.forEach(t=>{const a=t.data();(!e[a.medida]||new Date(a.fecha)>new Date(e[a.medida].fecha))&&(e[a.medida]={costoBase:a.costoBase,fecha:a.fecha})}),this.costosLocales=e,this.$emit("update:costos",e)})}catch(t){console.error("Error al iniciar escucha de costos:",t)}},async mostrarHistorial(t){this.cargandoHistorial=!0,this.errorHistorial=null;try{this.medidaSeleccionada=t;const e=Object(s["c"])(g["a"],"costos"),a=Object(s["l"])(e,Object(s["p"])("medida","==",t)),o=await Object(s["g"])(a);let i=o.docs.map(t=>({id:t.id,...t.data()})).sort((t,e)=>new Date(e.fecha)-new Date(t.fecha));this.historialCostos=i.map((t,e)=>{const a=i[e+1],o=a?{diferencia:t.costoBase-a.costoBase,porcentaje:(t.costoBase-a.costoBase)/a.costoBase*100}:null;return{...t,cambio:o}}),this.showHistorialModal=!0}catch(e){console.error("Error al cargar historial:",e),this.errorHistorial="Error al cargar el historial de precios. Por favor, intenta de nuevo."}finally{this.cargandoHistorial=!1}},async cargarHistorial(t){try{const e=Object(s["c"])(g["a"],"costos"),a=Object(s["l"])(e,Object(s["p"])("medida","==",t)),o=await Object(s["g"])(a),i=o.docs.map(t=>({id:t.id,...t.data()})).sort((t,e)=>new Date(e.fecha)-new Date(t.fecha));this.$set(this.historialesPorMedida,t,i)}catch(e){console.error("Error al cargar historial:",e),alert("Error al cargar el historial de precios")}},async eliminarCosto(t){if(confirm("¿Estás seguro de que deseas eliminar este precio?"))try{await Object(s["d"])(Object(s["e"])(g["a"],"costos",t)),await this.mostrarHistorial(this.medidaSeleccionada),await this.cargarHistorial(this.medidaSeleccionada);const e=this.historialCostos[0];e&&this.$set(this.costosLocales,this.medidaSeleccionada,{costoBase:e.costoBase,fecha:e.fecha})}catch(e){console.error("Error al eliminar precio:",e),alert("Error al eliminar el precio")}},async eliminarMedida(t){if(confirm("¿Estás seguro de que deseas eliminar este producto y todo su historial?"))try{const e=Object(s["c"])(g["a"],"costos"),a=Object(s["l"])(e,Object(s["p"])("medida","==",t)),o=await Object(s["g"])(a);await Promise.all(o.docs.map(t=>Object(s["d"])(t.ref)));const{[t]:i,...r}=this.costosLocales;this.costosLocales=r;const{[t]:n,...c}=this.costosPorMedida;this.$emit("update:costos",c)}catch(e){console.error("Error al eliminar producto:",e),alert("Error al eliminar el producto")}},guardarCostos(){const t=Object.keys(this.costosLocales).reduce((t,e)=>(t[e]={costoBase:this.costosLocales[e].costoBase,fecha:this.costosLocales[e].fecha},t),{});this.$emit("guardar",t),this.cerrarModal()},cerrarModal(){this.$emit("update:showModal",!1)}}},_=C,y=(a("6044"),a("2877")),w=Object(y["a"])(_,b,f,!1,null,"6daea347",null),k=w.exports,A={name:"Rendimientos",components:{CostosModal:k},data(){return{kilosCrudos:{},medidasUnicas:[],embarqueData:null,guardadoAutomaticoActivo:!1,nombresMedidasPersonalizados:{},mostrarModal:!1,nota:"",medidaOculta:{},costosPorMedida:{},showCostosModal:!1,unsubscribePreciosGlobales:null}},async created(){await this.cargarEmbarque(),await this.iniciarEscuchaPreciosGlobales(),this.guardarCambiosEnTiempoReal=Object(r["debounce"])(this.guardarCambiosEnTiempoReal,300)},methods:{obtenerNombreCliente(t){if(!this.embarqueData||!this.embarqueData.clientes)return"";const e=this.embarqueData.clientes.find(e=>e.id.toString()===t.toString());return e?e.nombre:""},async cargarEmbarque(){try{const t=Object(s["h"])(),e=this.$route.params.id,a=Object(s["e"])(t,"embarques",e),o=await Object(s["f"])(a);if(o.exists()){this.embarqueData=o.data(),this.nombresMedidasPersonalizados=this.embarqueData.nombresMedidasPersonalizados||{},this.obtenerMedidasUnicas(),this.medidaOculta=this.embarqueData.medidaOculta||{},this.costosPorMedida=this.embarqueData.costosPorMedida||{};const t=this.embarqueData.kilosCrudos||{};this.kilosCrudos={...t},this.medidasUnicas.forEach(t=>{this.kilosCrudos[t]||(this.esMedidaMix(t)?this.$set(this.kilosCrudos,t,{medida1:0,medida2:0,etiqueta1:"Kilos en crudo (Medida 1)",etiqueta2:"Kilos en crudo (Medida 2)"}):this.$set(this.kilosCrudos,t,0))}),console.log("Datos cargados:",this.kilosCrudos),this.guardadoAutomaticoActivo=!0}else console.error("No se encontró el embarque")}catch(t){console.error("Error al cargar el embarque:",t)}},async guardarCambiosEnTiempoReal(){if(this.guardadoAutomaticoActivo)try{const t=Object(s["h"])(),e=this.$route.params.id,a=Object(s["e"])(t,"embarques",e);await Object(s["o"])(a,{kilosCrudos:this.kilosCrudos}),console.log("Rendimientos guardados:",this.kilosCrudos)}catch(t){console.error("Error al guardar los rendimientos:",t)}},obtenerMedidasUnicas(){if(!this.embarqueData||!this.embarqueData.clientes)return;const t=new Map,e=new Map;this.embarqueData.clientes.forEach(a=>{a.productos.forEach(o=>{if(o.medida){const i=o.medida.toLowerCase().trim();let s=o.medida;if("Ozuna"!==a.nombre||o.esVenta||(s=o.medida+" Maquila Ozuna"),i.endsWith("mix")){const t=i.split(" ")[0];e.set(t,s)}else t.has(i)||t.set(i,s)}})});const a=Array.from(e.keys()).sort();if(a.length>=2)for(let o=0;o<a.length;o+=2)if(o+1<a.length){const e=`${a[o]}-${a[o+1]} mix`;t.set(e,e),this.kilosCrudos[e]||this.$set(this.kilosCrudos,e,{medida1:0,medida2:0,etiqueta1:`Kilos en crudo (${a[o]})`,etiqueta2:`Kilos en crudo (${a[o+1]})`})}this.medidasUnicas=Array.from(t.values())},obtenerTotalEmbarcado(t){if(!this.embarqueData||!this.embarqueData.clientes)return 0;if(t.includes("-")&&t.endsWith("mix")){const[e,a]=t.split("-").map(t=>t.trim()),o=this.calcularTotalParaMedida(e+" mix"),i=this.calcularTotalParaMedida(a.replace(" mix","")+" mix");return o+i}return this.calcularTotalParaMedida(t)},calcularTotalParaMedida(t){const e=t.replace(" Maquila Ozuna","").toLowerCase().trim();return this.embarqueData.clientes.reduce((t,a)=>t+a.productos.filter(t=>t.medida&&t.medida.toLowerCase().trim()===e).reduce((t,e)=>{if("c/h20"===e.tipo){const a=this.calcularTotalBolsas(e),o=parseFloat(e.camaronNeto)||.65;return t+a*o}{const a=e.kilos.reduce((t,e)=>t+(Number(e)||0),0),o=this.calcularTotalTaras(e),i=e.restarTaras?3*o:0;return t+(a-i)}},0),0)},obtenerTotalParaRendimiento(t){if(!this.embarqueData||!this.embarqueData.clientes)return 0;const e=t.toLowerCase(),a=this.embarqueData.clientes.flatMap(t=>t.productos.filter(t=>t.medida&&t.medida.toLowerCase()===e)),o=a.some(t=>"c/h20"===t.tipo);return o?this.obtenerTotalEmbarcado(t):this.obtenerTotalReal(t)},obtenerTotalReal(t){if(!this.embarqueData||!this.embarqueData.clientes)return 0;const e=t.replace(" Maquila","").toLowerCase();return this.embarqueData.clientes.reduce((t,a)=>t+a.productos.filter(t=>t.medida&&t.medida.toLowerCase()===e).reduce((t,e)=>t+this.calcularTotalKilos(e),0),0)},calcularTotalKilos(t){if(!t.kilos)return 0;const e=t.kilos.reduce((t,e)=>t+(Number(e)||0),0),a=(t.taras||[]).reduce((t,e)=>t+(Number(e)||0),0),o=t.restarTaras?3*a:0;return e-o},calcularTotalTaras(t){const e=(t.taras||[]).reduce((t,e)=>t+(Number(e)||0),0),a=(t.tarasExtra||[]).reduce((t,e)=>t+(Number(e)||0),0);return e+a},calcularTotalBolsas(t){const e=t.reporteTaras||[],a=t.reporteBolsas||[];let o=0;for(let i=0;i<e.length;i++){const t=parseInt(e[i])||0,s=parseInt(a[i])||0;o+=t*s}return o},calcularRendimiento(t){const e=this.obtenerTotalEmbarcado(t);if(0===e)return 0;let a;var o,i;this.esMedidaMix(t)?a=Number((null===(o=this.kilosCrudos[t])||void 0===o?void 0:o.medida1)||0)+Number((null===(i=this.kilosCrudos[t])||void 0===i?void 0:i.medida2)||0):a=Number(this.kilosCrudos[t]||0);const s=a/e;return this.guardarCambiosEnTiempoReal(),s},getRendimiento(t){return this.calcularRendimiento(t)||0},volverAEmbarque(){this.$router.push({name:"EditarEmbarque",params:{id:this.$route.params.id}})},esMedidaMix(t){return t.toLowerCase().includes("mix")},obtenerEtiqueta(t,e){return this.kilosCrudos[t]?"medida1"===e?this.kilosCrudos[t].etiqueta1||"Kilos en crudo (Medida 1)":this.kilosCrudos[t].etiqueta2||"Kilos en crudo (Medida 2)":"medida1"===e?"Kilos en crudo (Medida 1)":"Kilos en crudo (Medida 2)"},editarEtiqueta(t,e){this.kilosCrudos[t]||this.$set(this.kilosCrudos,t,{medida1:0,medida2:0,etiqueta1:"Kilos en crudo (Medida 1)",etiqueta2:"Kilos en crudo (Medida 2)"});const a="medida1"===e?this.kilosCrudos[t].etiqueta1:this.kilosCrudos[t].etiqueta2,o=prompt("Ingrese el nuevo nombre para la medida:",a);null!==o&&("medida1"===e?this.$set(this.kilosCrudos[t],"etiqueta1",o):this.$set(this.kilosCrudos[t],"etiqueta2",o),this.guardarCambiosEnTiempoReal())},generarPDF(){var t;const e=Object.values(this.costosPorMedida).some(t=>Number(t)>0),a=this.medidasUnicas.filter(t=>!this.medidaOculta[t]).map(t=>{let e;var a,o;this.esMedidaMix(t)?e={medida1:Number((null===(a=this.kilosCrudos[t])||void 0===a?void 0:a.medida1)||0),medida2:Number((null===(o=this.kilosCrudos[t])||void 0===o?void 0:o.medida2)||0)}:e=Number(this.kilosCrudos[t]||0);const i=Number(this.costosPorMedida[t])||0,s=this.getRendimiento(t),r=i>0?(i*s+20).toFixed(1):null;return{medida:t,kilosCrudos:e,totalEmbarcado:this.obtenerTotalEmbarcado(t),rendimiento:s,costo:i,costoFinal:r}}),o={...this.embarqueData,notaRendimientos:(null===(t=this.embarqueData)||void 0===t?void 0:t.notaRendimientos)||"",mostrarColumnaCosto:e};u(a,o)},obtenerNombreMedidaPersonalizado(t){return this.nombresMedidasPersonalizados[t]||t},async editarNombreMedida(t){const e=this.obtenerNombreMedidaPersonalizado(t),a=prompt("Ingrese el nuevo nombre para la medida:",e);if(null!==a&&""!==a.trim()){this.$set(this.nombresMedidasPersonalizados,t,a.trim());try{const t=Object(s["h"])(),e=this.$route.params.id,a=Object(s["e"])(t,"embarques",e);await Object(s["o"])(a,{nombresMedidasPersonalizados:this.nombresMedidasPersonalizados}),console.log("Nombre de medida actualizado correctamente")}catch(o){console.error("Error al guardar el nuevo nombre:",o)}}},abrirModalNota(){var t;this.nota=(null===(t=this.embarqueData)||void 0===t?void 0:t.notaRendimientos)||"",this.mostrarModal=!0},async guardarNota(){try{const t=Object(s["h"])(),e=this.$route.params.id,a=Object(s["e"])(t,"embarques",e);await Object(s["o"])(a,{notaRendimientos:this.nota}),this.embarqueData.notaRendimientos=this.nota,this.cerrarModal(),console.log("Nota guardada correctamente")}catch(t){console.error("Error al guardar la nota:",t)}},cerrarModal(){this.mostrarModal=!1,this.nota=""},async guardarEstadoOculto(){try{const t=Object(s["h"])(),e=this.$route.params.id,a=Object(s["e"])(t,"embarques",e);await Object(s["o"])(a,{medidaOculta:this.medidaOculta}),console.log("Estado de ocultación guardado correctamente")}catch(t){console.error("Error al guardar estado de ocultación:",t)}},abrirModalCostos(){this.showCostosModal=!0},async guardarCostos(t){try{const e=Object(s["h"])(),a=this.$route.params.id;Object(s["e"])(e,"embarques",a);this.costosPorMedida=t,console.log("Costos actualizados correctamente")}catch(e){console.error("Error al actualizar los costos:",e)}},calcularCostoFinal(t){const e=Number(this.costosPorMedida[t])||0,a=Number(this.getRendimiento(t).toFixed(2)),o=e*a+20;return o.toFixed(1)},rendimientosPorMedida(){return this.medidasUnicas.reduce((t,e)=>(t[e]=this.getRendimiento(e),t),{})},async iniciarEscuchaPreciosGlobales(){try{const t=Object(s["h"])(),e=Object(s["c"])(t,"precios_globales"),a=Object(s["l"])(e,Object(s["k"])("timestamp","desc"));this.unsubscribePreciosGlobales=Object(s["j"])(a,t=>{const e={};t.forEach(t=>{const a=t.data();(!e[a.medida]||new Date(a.fecha)>new Date(e[a.medida].fecha))&&(e[a.medida]=a.costoBase)}),this.costosPorMedida=e})}catch(t){console.error("Error al iniciar escucha de precios globales:",t)}}},watch:{kilosCrudos:{handler(){this.guardarCambiosEnTiempoReal()},deep:!0}},beforeDestroy(){this.unsubscribePreciosGlobales&&this.unsubscribePreciosGlobales(),this.guardarCambiosEnTiempoReal.cancel&&this.guardarCambiosEnTiempoReal.cancel()}},P=A,x=(a("1159"),Object(y["a"])(P,o,i,!1,null,"893f44c2",null));e["default"]=x.exports},"4e00":function(t,e,a){"use strict";var o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"container"},[e("div",{staticClass:"add-client"},[e("div",{staticClass:"back-button-container"},[e("BackButton",{attrs:{to:"/NoteMenu"}})],1),t._m(0),e("form",{on:{submit:function(e){return e.preventDefault(),t.addClient.apply(null,arguments)}}},[e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"name"}},[t._v("Nombre:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.name,expression:"name"}],attrs:{type:"text",required:""},domProps:{value:t.name},on:{input:function(e){e.target.composing||(t.name=e.target.value)}}})]),e("button",{attrs:{type:"submit"}},[t._v("Agregar Cliente")])]),t._m(1),e("ul",t._l(t.clients,(function(a){return e("li",{key:a.id},[t._v(" "+t._s(a.name)+" "),e("button",{on:{click:function(e){return t.deleteClient(a.id)}}},[t._v("Eliminar")])])})),0)])])},i=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"add-client-form"},[e("h2",[t._v("Agregar Cliente")])])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"add-client-form"},[e("h2",[t._v("Lista de Clientes")])])}],s=(a("d9e2"),a("74c9")),r=a("dc59"),n=a("1494"),c={components:{BackButton:s["a"]},data(){return{name:"",clients:[]}},methods:{async addClient(){try{if(console.log("DB instance:",r["a"]),!r["a"])throw new Error("Firestore DB is not initialized");await Object(n["b"])(Object(n["c"])(r["a"],"clients"),{name:this.name}),this.name="",this.fetchClients()}catch(t){console.error("Error adding client: ",t)}},async fetchClients(){try{const t=await Object(n["g"])(Object(n["c"])(r["a"],"clients"));this.clients=t.docs.map(t=>({id:t.id,...t.data()}))}catch(t){console.error("Error fetching clients: ",t)}},deleteClient(t){window.confirm("¿Estás seguro de que deseas eliminar este cliente?")&&Object(n["d"])(Object(n["e"])(r["a"],"clients",t)).then(()=>{console.log("Cliente eliminado con éxito")}).catch(t=>{console.error("Error al eliminar el cliente: ",t)})}},async mounted(){this.fetchClients()}},l=c,d=(a("f90b"),a("2877")),u=Object(d["a"])(l,o,i,!1,null,"024a7518",null);e["a"]=u.exports},5068:function(t,e,a){},5355:function(t,e,a){},"535b":function(t,e,a){"use strict";a("089a")},5617:function(t,e,a){"use strict";a("4c80")},"56d7":function(t,e,a){"use strict";a.r(e);var o=a("2b0e"),i=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"app"}},[e("Navbar"),e("div",{staticClass:"content-wrapper"},[e("router-view")],1),e("Footer")],1)},s=[],r=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"safe-area-top"}),e("b-navbar",{staticClass:"navbar-custom",attrs:{toggleable:"lg"}},[e("b-navbar-brand",{staticClass:"d-flex align-items-center",attrs:{href:"#"}},[e("b-img",{staticClass:"logo-image mr-2",attrs:{src:"https://res.cloudinary.com/hwkcovsmr/image/upload/v1620946647/samples/REY_PEZ_LOGO_nsotww.png",width:"60",fluid:"",alt:"Rey Pez Logo"}}),e("h1",{staticClass:"navbar-title mb-0"},[t._v("Rey Pez")])],1),e("b-navbar-toggle",{attrs:{target:"nav-collapse"}}),e("b-collapse",{attrs:{id:"nav-collapse","is-nav":""}},[e("b-navbar-nav",{staticClass:"ml-auto"},[e("b-nav-item",[e("router-link",{staticClass:"nav-link",attrs:{to:"/"}},[t._v("Home")])],1),e("b-nav-item",[e("router-link",{staticClass:"nav-link",attrs:{to:"/noteMenu"}},[t._v("Notas")])],1),e("b-nav-item",[e("router-link",{staticClass:"nav-link",attrs:{to:"/sacadas"}},[t._v("Entradas/Salidas")])],1),e("b-nav-item",[e("router-link",{staticClass:"nav-link",attrs:{to:"/existencias"}},[t._v("Existencias")])],1),e("b-nav-item",[e("router-link",{staticClass:"nav-link",attrs:{to:"/cuentas-mexico"}},[t._v("Cuentas México")])],1),e("b-nav-item",[e("router-link",{staticClass:"nav-link",attrs:{to:"/embarques-menu"}},[t._v("Embarques")])],1),e("b-nav-item",[e("router-link",{staticClass:"nav-link",attrs:{to:"/procesos"}},[t._v("Procesos")])],1)],1)],1)],1)],1)},n=[],c={name:"Navbar",data(){return{}}},l=c,d=(a("74f1"),a("2877")),u=Object(d["a"])(l,r,n,!1,null,"a6282f60",null),m=u.exports,p=function(){var t=this;t._self._c;return t._m(0)},h=[function(){var t=this,e=t._self._c;return e("footer",{staticClass:"footer"},[e("div",{staticClass:"footer-content"},[e("p",[t._v("© 2025 Rey Pez - Allan Reyes")])])])}],v={name:"Footer"},b=v,f=(a("7fd0"),Object(d["a"])(b,p,h,!1,null,"6331683e",null)),g=f.exports,C={name:"app",components:{Navbar:m,Footer:g}},_=C,y=(a("bc40"),Object(d["a"])(_,i,s,!1,null,null,null)),w=y.exports,k=a("8c4f"),A=a("be92"),P=a("dc59"),x=a("e1bd");const S=[{username:"allan",password:"noseno"},{username:"edgar",password:"noseno"}],T=Object(A["c"])("auth",{state:()=>({user:null,isAuthenticated:!1,userId:null}),actions:{async login(t,e){try{const a=S.find(a=>a.username===t&&a.password===e);if(a){const t=Object(x["a"])();return this.userId=t,this.user={username:a.username},this.isAuthenticated=!0,Object(P["b"])(t,a.username),localStorage.setItem("user",JSON.stringify({...this.user,userId:t})),!0}return!1}catch(a){return console.error("Error en login:",a),!1}},logout(){this.user=null,this.isAuthenticated=!1,this.userId=null,localStorage.removeItem("user")},checkAuth(){try{const t=localStorage.getItem("user");if(t){const e=JSON.parse(t);this.user={username:e.username},this.userId=e.userId,this.isAuthenticated=!0,this.userId&&Object(P["b"])(this.userId,e.username)}}catch(t){console.error("Error al verificar autenticación:",t),this.logout()}}},getters:{isLoggedIn:t=>t.isAuthenticated,currentUser:t=>t.user}});var O=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"home"}},[e("b-container",[e("Datos")],1)],1)},M=[],N=function(){var t=this,e=t._self._c;return e("div",{staticClass:"datos-container mt-5"},[e("div",{staticClass:"fecha-actual"},[t._v(t._s(t.fechaActual))]),e("b-row",[e("b-col",{staticClass:"mb-3",attrs:{cols:"12",md:"5"}},[e("b-button",{staticClass:"mb-3",attrs:{variant:"danger",block:""},on:{click:t.borrarDatos}},[t._v("Borrar datos")]),e("b-form-textarea",{staticClass:"text-center",attrs:{name:"dinero",id:"textarea-auto-height",placeholder:"Ingrese cantidades de dinero (una por línea)",rows:"3","max-rows":"10"},model:{value:t.localDatos,callback:function(e){t.localDatos=e},expression:"localDatos"}}),e("div",{staticClass:"mt-3 total-sum"},[e("strong",[t._v("Total: $"+t._s(t.formatNumber(t.totalSum)))])])],1),e("b-col",{attrs:{cols:"12",md:"7"}},[e("Cuentas",{attrs:{datos:t.localDatos}})],1)],1)],1)},D=[],E=(a("13d5"),function(){var t=this,e=t._self._c;return e("div",{staticClass:"cuentas-container"},[e("b-row",[e("b-col",{staticClass:"mb-3",attrs:{cols:"12",md:"6"}},[e("Calcular",{attrs:{cantidad:"$2",datos:t.datos},on:{dataArray:t.getDatos}})],1),e("b-col",{staticClass:"mb-3",attrs:{cols:"12",md:"6"}},[e("Calcular",{attrs:{cantidad:"$1",datos:t.datos},on:{dataArray:t.getDatos}})],1),e("b-col",{staticClass:"mb-3",attrs:{cols:"12"}},[e("b-button",{attrs:{variant:"primary",block:""},on:{click:t.printCuentas}},[t._v("Imprimir sección")])],1),e("b-col",{staticClass:"mb-3",attrs:{cols:"12"}},[e("div",{ref:"printSection",staticClass:"print-section"},[e("h1",[t._v("Cuentas")]),e("p",{staticClass:"print-date"},[t._v(t._s(t.formattedDate))]),e("div",{staticClass:"cuenta-list"},t._l(t.bills,(function(a,o){return e("div",{key:o,staticClass:"cuenta-item"},[e("h2",[t._v(t._s(o)+": "+t._s(a))])])})),0)])])],1)],1)}),j=[],$=function(){var t=this,e=t._self._c;return e("div",{staticClass:"calcular-container"},[e("b-button",{attrs:{variant:"primary"},on:{click:t.processArray}},[t._v(t._s(t.cantidad))])],1)},I=[],F={name:"Calcular",props:{datos:{type:String,required:!0},cantidad:{type:String,required:!0}},methods:{processArray(){const t=this.datos.split("\n").filter(t=>t.trim()),e="$2"===this.cantidad;this.$emit("dataArray",{data:t,isTwo:e})}}},q=F,z=(a("5aa2"),Object(d["a"])(q,$,I,!1,null,"0f039a34",null)),V=z.exports,L={name:"Cuentas",components:{Calcular:V},props:{datos:{type:String,default:""}},data(){return{bills:{500:0,200:0,100:0,50:0,20:0,10:0,5:0,2:0,1:0}}},computed:{formattedDate(){const t={year:"numeric",month:"long",day:"numeric"};return(new Date).toLocaleDateString("es-ES",t)}},methods:{printCuentas(){const t=this.$refs.printSection;if(!t)return void console.error("Print section not found");const e=t.innerHTML,a="\n        <style>\n          body {\n            font-family: Arial, sans-serif;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            height: 100vh;\n            margin: 0;\n            background-color: #f0f0f0;\n          }\n          .print-container {\n            background-color: white;\n            padding: 40px;\n            border-radius: 10px;\n            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n            max-width: 600px;\n            width: 100%;\n          }\n          h1 {\n            color: #3760b0;\n            text-align: center;\n            margin-bottom: 10px;\n            font-size: 24px;\n          }\n          .print-date {\n            text-align: center;\n            color: #666;\n            font-style: italic;\n            margin-bottom: 20px;\n          }\n          .cuenta-list {\n            display: flex;\n            flex-wrap: wrap;\n            justify-content: space-between;\n          }\n          .cuenta-item {\n            width: 45%;\n            margin-bottom: 15px;\n            background-color: #f8f9fa;\n            padding: 10px;\n            border-radius: 5px;\n            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);\n          }\n          h2 {\n            color: #333;\n            margin: 0;\n            font-size: 18px;\n            text-align: center;\n          }\n        </style>\n      ",o=window.open("","_blank");o?(o.document.write(`\n        <html>\n          <head>\n            <title>Imprimir Cuentas</title>\n            ${a}\n          </head>\n          <body>\n            <div class="print-container">\n              ${e}\n            </div>\n          </body>\n        </html>\n      `),o.document.close(),o.focus(),o.print(),o.onafterprint=()=>{o.close()}):console.error("Unable to open print window")},getDatos({data:t,isTwo:e}){const a=e?[500,200,100,50,20,10,5,2]:[500,200,100,50,20,10,5,1];t.forEach(t=>{let e=parseInt(t);a.forEach(t=>{while(e>=t)e-=t,this.bills[t]++})})}}},B=L,G=(a("bff9"),Object(d["a"])(B,E,j,!1,null,"389f77cf",null)),H=G.exports,R={name:"Datos",components:{Cuentas:H},props:{initialDatos:{type:String,default:""}},data(){return{localDatos:this.initialDatos}},methods:{borrarDatos(){this.localDatos=""},formatNumber(t){return t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}},computed:{fechaActual(){const t=new Date,e={year:"numeric",month:"long",day:"numeric"};return t.toLocaleDateString("es-ES",e)},totalSum(){return this.localDatos.split("\n").filter(t=>t.trim()).reduce((t,e)=>t+parseFloat(e)||0,0)}}},K=R,J=(a("46cc"),Object(d["a"])(K,N,D,!1,null,"247b5804",null)),U=J.exports,Y={name:"home",components:{Datos:U}},W=Y,Q=Object(d["a"])(W,O,M,!1,null,null,null),X=Q.exports,Z=function(){var t=this,e=t._self._c;return e("div",{staticClass:"notes-wrapper"},[e("div",{staticClass:"button-container"},[e("div",{staticClass:"button-wrapper"},[e("button",{on:{click:t.goToSaleNote}},[t._v("Nueva nota")])]),e("div",{staticClass:"button-wrapper"},[e("button",{on:{click:t.goToAddClient}},[t._v("Agregar Cliente")])])]),e("div",{staticClass:"notes-container"},[e("div",{staticClass:"filter-container"},[e("select",{directives:[{name:"model",rawName:"v-model",value:t.paymentFilter,expression:"paymentFilter"}],on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.paymentFilter=e.target.multiple?a:a[0]}}},[e("option",{attrs:{value:"all"}},[t._v("Todas")]),e("option",{attrs:{value:"paid"}},[t._v("Pagadas")]),e("option",{attrs:{value:"unpaid"}},[t._v("No Pagadas")])])]),e("h2",[t._v("Notas por Cliente")]),t._l(t.filteredNotesByClient,(function(a,o){return e("div",{key:o},[e("details",[e("summary",[t._v(" "+t._s(o)+" - Debe: "+t._s(t._f("currency")(t.totalDebtByClient[o]))+" "),e("span",{staticClass:"note-count"},[t._v("("+t._s(a.length)+")")])]),e("ul",t._l(a,(function(a){return e("li",{key:a.id},[e("button",{attrs:{tabindex:"0"},on:{click:function(e){return t.goToEditNote(a.id)}}},[t._v(" Nota "+t._s(a.folio)+" - "+t._s(a.currentDate)+" ")])])})),0),e("div",{staticClass:"client-actions"},[e("button",{staticClass:"abono-button",on:{click:function(e){return t.showAbonoModal(o)}}},[t._v("Realizar Abono")]),e("button",{staticClass:"abonos-history-button",on:{click:function(e){return t.showAbonosHistory(o)}}},[t._v("Ver Abonos")])])])])}))],2),t.showModal?e("div",{staticClass:"modal"},[e("div",{staticClass:"modal-content"},[e("h2",[t._v("Realizar Abono para "+t._s(t.selectedClient))]),e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.abonoAmount,expression:"abonoAmount",modifiers:{number:!0}}],attrs:{type:"number",placeholder:"Cantidad a abonar"},domProps:{value:t.abonoAmount},on:{input:function(e){e.target.composing||(t.abonoAmount=t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),e("button",{on:{click:t.realizarAbono}},[t._v("Confirmar Abono")]),e("button",{on:{click:t.closeModal}},[t._v("Cancelar")])])]):t._e(),t.showAbonosHistoryModal?e("div",{staticClass:"modal"},[e("div",{staticClass:"modal-content"},[e("h2",[t._v("Historial de Abonos para "+t._s(t.selectedClient))]),e("table",{staticClass:"abonos-history-table"},[t._m(0),e("tbody",t._l(t.paginatedAbonos,(function(a,o){return e("tr",{key:o},[e("td",[t._v(t._s(t.formatDate(a.fecha)))]),e("td",[t._v(t._s(t._f("currency")(a.monto)))]),e("td",[e("button",{staticClass:"delete-button",on:{click:function(e){return t.openDeleteAbonoModal(a.globalIndex)}}},[t._v("Borrar")])])])})),0)]),e("div",{staticClass:"pagination"},[e("button",{attrs:{disabled:1===t.currentPage},on:{click:t.prevPage}},[t._v("Anterior")]),e("span",[t._v("Página "+t._s(t.currentPage)+" de "+t._s(t.totalPages))]),e("button",{attrs:{disabled:t.currentPage===t.totalPages},on:{click:t.nextPage}},[t._v("Siguiente")])]),e("button",{on:{click:t.closeAbonosHistoryModal}},[t._v("Cerrar")])])]):t._e(),t.showDeleteAbonoModal?e("div",{staticClass:"modal"},[e("div",{staticClass:"modal-content"},[e("h2",[t._v("Confirmar borrado de abono")]),e("p",[t._v("¿Estás seguro de que quieres borrar este abono?")]),e("button",{on:{click:t.deleteAbono}},[t._v("Confirmar")]),e("button",{on:{click:t.closeDeleteAbonoModal}},[t._v("Cancelar")])])]):t._e()])},tt=[function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",[t._v("Fecha")]),e("th",[t._v("Monto")]),e("th",[t._v("Acciones")])])])}],et=(a("14d9"),a("1494")),at={name:"NoteMenu",data(){return{notesByClient:{},paymentFilter:"unpaid",showModal:!1,selectedClient:"",abonoAmount:0,showAbonosHistoryModal:!1,clientAbonosHistory:[],showDeleteAbonoModal:!1,selectedAbonoIndex:null,selectedAbonoNote:null,currentPage:1,abonosPerPage:7}},methods:{goToSaleNote(){this.$router.push({name:"SaleNote"})},goToAddClient(){this.$router.push({name:"AddClient"})},async fetchNotes(){try{const t=await Object(et["g"])(Object(et["c"])(P["a"],"notes")),e=t.docs.map(t=>({id:t.id,...t.data()}));this.notesByClient=e.reduce((t,e)=>(t[e.client]||(t[e.client]=[]),t[e.client].push(e),t),{});for(let a in this.notesByClient)this.notesByClient[a].sort((t,e)=>new Date(e.currentDate)-new Date(t.currentDate))}catch(t){console.error("Error fetching notes: ",t)}},goToEditNote(t){this.$router.push({name:"editar-nota",params:{noteId:t}})},showAbonoModal(t){this.selectedClient=t,this.abonoAmount="",this.showModal=!0},closeModal(){this.showModal=!1,this.selectedClient="",this.abonoAmount=0},async realizarAbono(){if(this.abonoAmount<=0)return void alert("Por favor ingrese una cantidad válida");let t=this.abonoAmount;const e=[],a=new Date,o=[...this.notesByClient[this.selectedClient]].sort((t,e)=>new Date(t.currentDate)-new Date(e.currentDate)).filter(t=>!t.isPaid);for(let s of o){if(t<=0)break;const o=s.products.reduce((t,e)=>t+e.kilos*e.pricePerKilo,0),i=s.abonos.reduce((t,e)=>t+e.monto,0),r=o-i;if(r>0){const n=Math.min(t,r);s.abonos.push({monto:n,fecha:a.toISOString().split("T")[0]}),s.isPaid=o<=i+n,t-=n,e.push(s)}}try{for(let t of e){const e=Object(et["e"])(P["a"],"notes",t.id);await Object(et["o"])(e,{abonos:t.abonos,isPaid:t.isPaid})}alert("Abono aplicado con éxito"),this.closeModal(),await this.fetchNotes()}catch(i){console.error("Error al actualizar las notas:",i),alert("Hubo un error al aplicar el abono")}},async showAbonosHistory(t){this.selectedClient=t,this.clientAbonosHistory=[],this.currentPage=1;const e=this.notesByClient[t];let a=0;for(let o of e)o.abonos&&o.abonos.length>0&&o.abonos.forEach((t,e)=>{this.clientAbonosHistory.push({...t,noteId:o.id,abonoIndex:e,globalIndex:a++})});this.clientAbonosHistory.sort((t,e)=>new Date(e.fecha)-new Date(t.fecha)),this.showAbonosHistoryModal=!0},closeAbonosHistoryModal(){this.showAbonosHistoryModal=!1,this.clientAbonosHistory=[]},formatDate(t){const e={year:"numeric",month:"long",day:"numeric"};return new Date(t).toLocaleDateString("es-ES",e)},prevPage(){this.currentPage>1&&this.currentPage--},nextPage(){this.currentPage<this.totalPages&&this.currentPage++},openDeleteAbonoModal(t){const e=this.clientAbonosHistory[t];this.selectedAbonoIndex=e.abonoIndex,this.selectedAbonoNote=e.noteId,this.showDeleteAbonoModal=!0},async deleteAbono(){if(this.selectedAbonoNote)try{const t=Object(et["e"])(P["a"],"notes",this.selectedAbonoNote),e=await Object(et["f"])(t);if(e.exists()){const a=e.data(),o=a.abonos.filter((t,e)=>e!==this.selectedAbonoIndex);await Object(et["o"])(t,{abonos:o}),this.clientAbonosHistory=this.clientAbonosHistory.filter(t=>!(t.noteId===this.selectedAbonoNote&&t.abonoIndex===this.selectedAbonoIndex));const i=this.notesByClient[this.selectedClient].findIndex(t=>t.id===this.selectedAbonoNote);-1!==i&&(this.notesByClient[this.selectedClient][i].abonos=o),this.closeDeleteAbonoModal(),this.currentPage=Math.min(this.currentPage,this.totalPages),alert("Abono eliminado con éxito"),await this.fetchNotes()}}catch(t){console.error("Error al eliminar el abono:",t),alert("Hubo un error al eliminar el abono")}},closeDeleteAbonoModal(){this.showDeleteAbonoModal=!1,this.selectedAbonoIndex=null,this.selectedAbonoNote=null}},computed:{filteredNotesByClient(){const t={};for(const[e,a]of Object.entries(this.notesByClient))t[e]=a.filter(t=>"all"===this.paymentFilter||("paid"===this.paymentFilter?t.isPaid:!t.isPaid)),0===t[e].length&&delete t[e];return t},totalDebtByClient(){const t={};for(const[e,a]of Object.entries(this.notesByClient))t[e]=a.reduce((t,e)=>{const a=e.products.reduce((t,e)=>t+e.kilos*e.pricePerKilo,0)-e.abonos.reduce((t,e)=>t+e.monto,0);return t+(e.isPaid?0:a)},0);return t},paginatedAbonos(){const t=(this.currentPage-1)*this.abonosPerPage,e=t+this.abonosPerPage;return this.clientAbonosHistory.slice(t,e)},totalPages(){return Math.ceil(this.clientAbonosHistory.length/this.abonosPerPage)}},filters:{currency(t){return t?new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(t):"$0.00"}},async mounted(){await this.fetchNotes()}},ot=at,it=(a("6ad3"),Object(d["a"])(ot,Z,tt,!1,null,"8753db2c",null)),st=it.exports,rt=a("98cf"),nt=a("4e00"),ct=function(){var t=this,e=t._self._c;return t.isLoaded?e("div",{staticClass:"sacadas-container"},[e("div",{staticClass:"back-button-container"},[e("BackButton",{attrs:{to:"/sacadas"}})],1),e("h2",{staticClass:"date-header"},[t._v(t._s(t.formattedDate))]),e("div",{staticClass:"date-selector"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.selectedDate,expression:"selectedDate"}],attrs:{type:"date"},domProps:{value:t.selectedDate},on:{change:t.updateCurrentDate,input:function(e){e.target.composing||(t.selectedDate=e.target.value)}}})]),e("div",{staticClass:"sacadas-content"},[e("div",{staticClass:"salidas-section"},[e("h3",[t._v("Salidas")]),e("div",{staticClass:"input-group"},[e("select",{directives:[{name:"model",rawName:"v-model",value:t.newSalida.tipo,expression:"newSalida.tipo"}],attrs:{required:""},on:{change:[function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(t.newSalida,"tipo",e.target.multiple?a:a[0])},t.resetSalidaSelections]}},[e("option",{attrs:{value:""}},[t._v("Tipo")]),e("option",{attrs:{value:"proveedor"}},[t._v("Proveedor")]),e("option",{attrs:{value:"maquila"}},[t._v("Maquila")])]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.newSalida.proveedor,expression:"newSalida.proveedor"}],attrs:{required:""},on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(t.newSalida,"proveedor",e.target.multiple?a:a[0])}}},[e("option",{attrs:{value:""}},[t._v(t._s("maquila"===t.newSalida.tipo?"Maquila":"Proveedor"))]),t._l(t.filteredProveedoresSalida,(function(a){return e("option",{key:a.id,domProps:{value:a.nombre}},[t._v(" "+t._s(a.nombre)+" ")])}))],2),e("select",{directives:[{name:"model",rawName:"v-model",value:t.newSalida.medida,expression:"newSalida.medida"}],attrs:{required:""},on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(t.newSalida,"medida",e.target.multiple?a:a[0])}}},[e("option",{attrs:{value:""}},[t._v("Medida")]),t._l(t.filteredMedidasSalida,(function(a){return e("option",{key:a.id,domProps:{value:a.nombre}},[t._v(" "+t._s(a.nombre)+" ")])}))],2),e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.newSalida.kilos,expression:"newSalida.kilos",modifiers:{number:!0}}],attrs:{type:"number",inputmode:"decimal",step:"0.1",pattern:"[0-9]*",placeholder:"Kilos",required:""},domProps:{value:t.newSalida.kilos},on:{input:function(e){e.target.composing||t.$set(t.newSalida,"kilos",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),e("button",{attrs:{disabled:!t.isSalidaValid||t.newSalida.kilos>t.kilosDisponibles},on:{click:t.addSalida}},[t._v("Agregar Salida")])]),null!==t.kilosDisponibles?e("p",{staticClass:"kilos-disponibles"},[t._v(" Kilos disponibles: "),e("span",{class:{"low-stock":t.kilosDisponibles<100}},[t._v(t._s(t.formatNumber(t.kilosDisponibles))+" kg")])]):t._e(),e("ul",{staticClass:"list"},t._l(t.salidas,(function(a,o){return e("li",{key:"salida-"+o},[t._v(" "+t._s("maquila"===a.tipo?"Maquila":"Proveedor")+": "+t._s(a.proveedor)+" - "+t._s(a.medida)+t._s(a.precio?` ($${a.precio})`:"")+": "+t._s(t.formatNumber(a.kilos))+" kg "),e("button",{staticClass:"delete-btn",on:{click:function(e){return t.removeSalida(o)}}},[t._v("×")])])})),0),e("p",{staticClass:"total"},[t._v("Total Salidas: "+t._s(t.formatNumber(t.totalSalidas))+" kg")])]),e("div",{staticClass:"entradas-section"},[e("h3",[t._v("Entradas")]),e("div",{staticClass:"input-group"},[e("select",{directives:[{name:"model",rawName:"v-model",value:t.newEntrada.tipo,expression:"newEntrada.tipo"}],attrs:{required:""},on:{change:[function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(t.newEntrada,"tipo",e.target.multiple?a:a[0])},t.resetEntradaSelections]}},[e("option",{attrs:{value:""}},[t._v("Tipo")]),e("option",{attrs:{value:"proveedor"}},[t._v("Proveedor")]),e("option",{attrs:{value:"maquila"}},[t._v("Maquila")])]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.newEntrada.proveedor,expression:"newEntrada.proveedor"}],attrs:{required:""},on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(t.newEntrada,"proveedor",e.target.multiple?a:a[0])}}},[e("option",{attrs:{value:""}},[t._v(t._s("maquila"===t.newEntrada.tipo?"Maquila":"Proveedor"))]),t._l(t.filteredProveedoresEntrada,(function(a){return e("option",{key:a.id,domProps:{value:a.nombre}},[t._v(" "+t._s(a.nombre)+" ")])}))],2),e("select",{directives:[{name:"model",rawName:"v-model",value:t.newEntrada.medida,expression:"newEntrada.medida"}],attrs:{required:""},on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(t.newEntrada,"medida",e.target.multiple?a:a[0])}}},[e("option",{attrs:{value:""}},[t._v("Medida")]),t._l(t.filteredMedidasEntrada,(function(a){return e("option",{key:a.id,domProps:{value:a.nombre}},[t._v(" "+t._s(a.nombre)+" ")])}))],2),e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.newEntrada.kilos,expression:"newEntrada.kilos",modifiers:{number:!0}}],attrs:{type:"number",inputmode:"decimal",step:"0.1",pattern:"[0-9]*",placeholder:"Kilos",required:""},domProps:{value:t.newEntrada.kilos},on:{input:function(e){e.target.composing||t.$set(t.newEntrada,"kilos",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.newEntrada.precio,expression:"newEntrada.precio",modifiers:{number:!0}}],attrs:{type:"number",inputmode:"decimal",step:"0.01",pattern:"[0-9]*",placeholder:"Precio (opcional)"},domProps:{value:t.newEntrada.precio},on:{input:function(e){e.target.composing||t.$set(t.newEntrada,"precio",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),e("button",{on:{click:t.addEntrada}},[t._v("Agregar Entrada")])]),e("ul",{staticClass:"list"},t._l(t.entradas,(function(a,o){return e("li",{key:"entrada-"+o},[t._v(" "+t._s("maquila"===a.tipo?"Maquila":"Proveedor")+": "+t._s(a.proveedor)+" - "+t._s(a.medida)+t._s(a.precio?` ($${a.precio})`:"")+": "+t._s(t.formatNumber(a.kilos))+" kg "),e("button",{staticClass:"delete-btn",on:{click:function(e){return t.removeEntrada(o)}}},[t._v("×")])])})),0),e("p",{staticClass:"total"},[t._v("Total Entradas: "+t._s(t.formatNumber(t.totalEntradas))+" kg")])])]),e("div",{staticClass:"summary"},[e("h3",[t._v("Resumen del Día")]),e("p",[t._v("Total Entradas: "+t._s(t.formatNumber(t.totalEntradas))+" kg")]),e("p",[t._v("Total Salidas: "+t._s(t.formatNumber(t.totalSalidas))+" kg")]),e("h4",[t._v("Salidas clientes:")]),e("table",{staticClass:"medidas-summary"},[t._m(0),e("tbody",t._l(t.salidasProveedoresPorMedida,(function(a,o){return e("tr",{key:o},[e("td",[t._v(t._s(a.medida)+" ("+t._s(a.proveedor)+")")]),e("td",[t._v(t._s(t.formatNumber(a.total)))])])})),0)]),e("h4",[t._v("Salidas maquilas:")]),e("table",{staticClass:"medidas-summary"},[t._m(1),e("tbody",[t._l(t.salidasMaquilasPorMedida,(function(a,o){return[e("tr",{key:o},[e("td",{attrs:{rowspan:Object.keys(a).length}},[t._v(t._s(o))]),e("td",[t._v(t._s(Object.keys(a)[0]))]),e("td",[t._v(t._s(t.formatNumber(Object.values(a)[0])))])]),t._l(a,(function(a,i,s){return 0!==s?e("tr",{key:`${o}-${i}`},[e("td",[t._v(t._s(i))]),e("td",[t._v(t._s(t.formatNumber(a)))])]):t._e()}))]}))],2)])]),e("button",{staticClass:"save-button",on:{click:t.saveReport}},[t._v(t._s(t.isEditing?"Actualizar":"Guardar")+" Informe del Día")])]):t._e()},lt=[function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",[t._v("Medida")]),e("th",[t._v("Total (kg)")])])])},function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",[t._v("Maquila")]),e("th",[t._v("Medida")]),e("th",[t._v("Total (kg)")])])])}],dt=a("74c9"),ut=a("c1df"),mt=a.n(ut),pt={name:"Sacadas",components:{BackButton:dt["a"]},data(){return{currentDate:mt()(),selectedDate:mt()().format("YYYY-MM-DD"),entradas:[],salidas:[],proveedores:[],medidas:[],medidasConPrecio:[],newEntrada:{tipo:"proveedor",proveedor:"",medida:"",kilos:null,precio:null},newSalida:{tipo:"proveedor",proveedor:"",medida:"",kilos:null},isEditing:!1,sacadaId:null,isLoaded:!1,kilosDisponibles:null}},computed:{formattedDate(){return this.currentDate.format("DD/MM/YYYY")},filteredProveedoresEntrada(){return this.proveedores.filter(t=>t.tipo===this.newEntrada.tipo)},filteredProveedoresSalida(){return this.proveedores.filter(t=>t.tipo===this.newSalida.tipo)},filteredMedidasEntrada(){if("maquila"===this.newEntrada.tipo){const t=this.proveedores.find(t=>t.nombre===this.newEntrada.proveedor);return t?this.medidas.filter(e=>"maquila"===e.tipo&&e.maquilaId===t.id):[]}{const t=this.proveedores.find(t=>t.nombre===this.newEntrada.proveedor);return t?this.medidas.filter(e=>e.proveedorId===t.id||!e.proveedorId&&"general"===e.tipo):this.medidas.filter(t=>"general"===t.tipo)}},filteredMedidasSalida(){if("maquila"===this.newSalida.tipo){const t=this.proveedores.find(t=>t.nombre===this.newSalida.proveedor);return t?this.medidas.filter(e=>"maquila"===e.tipo&&e.maquilaId===t.id).sort((t,e)=>t.nombre.localeCompare(e.nombre)):[]}{const t=this.proveedores.find(t=>t.nombre===this.newSalida.proveedor);return t?this.medidasConPrecio.sort((t,e)=>{const a=t=>t.split(" ")[0];return a(t.nombre).localeCompare(a(e.nombre))}):[]}},totalEntradas(){return Number(this.entradas.reduce((t,e)=>t+e.kilos,0).toFixed(1))},totalSalidas(){return Number(this.salidas.reduce((t,e)=>t+e.kilos,0).toFixed(1))},salidasProveedoresPorMedida(){const t=this.salidas.filter(t=>"proveedor"===t.tipo).reduce((t,e)=>{const a=`${e.medida}-${e.proveedor}`;return t[a]||(t[a]={medida:e.medida,proveedor:e.proveedor,total:0,displayName:e.precio?`${e.medida} ($${e.precio})`:e.medida}),t[a].total+=e.kilos,t},{});return Object.values(t).sort((t,e)=>{const a=t.medida.split(" ($")[0],o=e.medida.split(" ($")[0];return a.localeCompare(o)})},salidasMaquilasPorMedida(){const t=this.salidas.filter(t=>"maquila"===t.tipo).reduce((t,e)=>{t[e.proveedor]||(t[e.proveedor]={});const a=e.precio?`${e.medida} ($${e.precio})`:e.medida;return t[e.proveedor][a]||(t[e.proveedor][a]=0),t[e.proveedor][a]+=e.kilos,t},{});for(const e in t){const a={};Object.keys(t[e]).sort((t,e)=>{const a=t.split(" ($")[0],o=e.split(" ($")[0];return a.localeCompare(o)}).forEach(o=>{a[o]=t[e][o]}),t[e]=a}return t},isSalidaValid(){return this.newSalida.tipo&&this.newSalida.proveedor&&this.newSalida.medida&&this.newSalida.kilos&&this.newSalida.kilos>0&&null!==this.kilosDisponibles&&this.newSalida.kilos<=this.kilosDisponibles}},methods:{async loadProveedores(){const t=await Object(et["g"])(Object(et["c"])(P["a"],"proveedores"));this.proveedores=t.docs.map(t=>({id:t.id,...t.data()}))},async loadMedidas(){const t=await Object(et["g"])(Object(et["c"])(P["a"],"medidas"));this.medidas=t.docs.map(t=>({id:t.id,...t.data()}))},async checkExistingSacada(){const t=Object(et["c"])(P["a"],"sacadas"),e=this.currentDate.clone().startOf("day"),a=this.currentDate.clone().endOf("day"),o=Object(et["l"])(t,Object(et["p"])("fecha",">=",e.toDate()),Object(et["p"])("fecha","<=",a.toDate())),i=await Object(et["g"])(o);return!i.empty},resetEntradaSelections(){this.newEntrada.proveedor="",this.newEntrada.medida=""},resetSalidaSelections(){this.newSalida.proveedor="",this.newSalida.medida="",this.kilosDisponibles=null},async addEntrada(){this.newEntrada.tipo&&this.newEntrada.proveedor&&this.newEntrada.medida&&this.newEntrada.kilos&&(this.entradas.push({tipo:this.newEntrada.tipo,proveedor:this.newEntrada.proveedor,medida:this.newEntrada.medida,kilos:Number(this.newEntrada.kilos.toFixed(1)),precio:this.newEntrada.precio?Number(this.newEntrada.precio.toFixed(2)):null}),this.newEntrada={tipo:"proveedor",proveedor:"",medida:"",kilos:null,precio:null},await this.updateKilosDisponibles())},async addSalida(){if(this.isSalidaValid&&this.newSalida.kilos<=this.kilosDisponibles){const t=this.newSalida.medida.match(/\(\$(\d+(\.\d+)?)\)/),e=t?Number(t[1]):null,a=e?this.newSalida.medida.split(" ($")[0]:this.newSalida.medida;this.salidas.push({tipo:this.newSalida.tipo,proveedor:this.newSalida.proveedor,medida:a,precio:e,kilos:Number(this.newSalida.kilos.toFixed(1))}),this.newSalida={tipo:"proveedor",proveedor:"",medida:"",kilos:null},await this.updateKilosDisponibles()}else this.newSalida.kilos>this.kilosDisponibles&&alert(`No hay suficientes kilos disponibles. Kilos disponibles: ${this.kilosDisponibles.toFixed(1)} kg`)},async updateKilosDisponibles(){this.newSalida.proveedor&&this.newSalida.medida?(console.log(`Actualizando kilos disponibles para ${this.newSalida.proveedor} - ${this.newSalida.medida}`),this.kilosDisponibles=await this.getKilosDisponibles(this.newSalida.proveedor,this.newSalida.medida),console.log("Kilos disponibles actualizados: "+this.kilosDisponibles)):(console.log("No se puede actualizar kilos disponibles: falta proveedor o medida"),this.kilosDisponibles=null)},async getKilosDisponibles(t,e){let a=0,o=0,i=0;const s=e.match(/\(\$(\d+(\.\d+)?)\)/),r=s?Number(s[1]):null,n=r?e.split(" ($")[0]:e,c=Object(et["c"])(P["a"],"sacadas"),l=await Object(et["g"])(c),d=l.docs.map(t=>({id:t.id,...t.data()})).sort((t,e)=>t.fecha.toDate()-e.fecha.toDate());console.log(`Calculando kilos disponibles para ${t} - ${e}`),console.log("Fecha actual: "+this.currentDate.format("YYYY-MM-DD"));const u=this.currentDate.clone().endOf("day");return d.forEach(e=>{const s=e.fecha instanceof Date?e.fecha:e.fecha.toDate();mt()(s).isSameOrBefore(u)&&(console.log("Procesando sacada del "+mt()(s).format("YYYY-MM-DD")),e.entradas.forEach(e=>{e.proveedor!==t||e.medida!==n||r&&e.precio!==r||(a+=e.kilos,o+=e.kilos,console.log(`  Entrada: +${e.kilos} kg`))}),e.salidas.forEach(e=>{e.proveedor!==t||e.medida!==n||r&&e.precio!==r||(a-=e.kilos,i+=e.kilos,console.log(`  Salida: -${e.kilos} kg`))}),console.log(`  Subtotal: ${a} kg`))}),Number(a.toFixed(1))},async removeEntrada(t){this.entradas.splice(t,1),await this.updateKilosDisponibles()},async removeSalida(t){this.salidas.splice(t,1),await this.updateKilosDisponibles()},formatNumber(t){return t.toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1})},async loadSacada(t){console.log("Cargando sacada con ID:",t);const e=Object(et["e"])(P["a"],"sacadas",t),a=await Object(et["f"])(e);if(a.exists()){console.log("Documento encontrado:",a.data());const e=a.data();this.currentDate=mt()(e.fecha.toDate()),console.log("Fecha cargada:",this.currentDate),this.entradas=e.entradas||[],console.log("Entradas cargadas:",this.entradas),this.salidas=e.salidas||[],console.log("Salidas cargadas:",this.salidas),this.sacadaId=t,this.isEditing=!0,await this.updateKilosDisponibles()}else console.log("No se encontró el documento con ID:",t)},async saveReport(){try{if(!this.isEditing){const t=await this.checkExistingSacada();if(t)return void alert("Ya existe un registro de sacada para esta fecha. No se puede crear uno nuevo.")}const t={fecha:this.currentDate.toDate(),entradas:this.entradas,salidas:this.salidas,totalEntradas:this.totalEntradas,totalSalidas:this.totalSalidas};this.isEditing?(await Object(et["o"])(Object(et["e"])(P["a"],"sacadas",this.sacadaId),t),alert("Informe del día actualizado exitosamente")):(await Object(et["b"])(Object(et["c"])(P["a"],"sacadas"),t),alert("Informe del día guardado exitosamente")),this.$router.push("/sacadas")}catch(t){console.error("Error al guardar/actualizar el documento: ",t),alert("Error al guardar/actualizar el informe del día: "+t.message)}},updateCurrentDate(){this.currentDate=mt()(this.selectedDate)},async getMedidasConPrecio(t){const e=new Map;let a=this.currentDate.clone().endOf("day");const o=Object(et["c"])(P["a"],"sacadas"),i=await Object(et["g"])(o),s=i.docs.map(t=>({id:t.id,...t.data()})).sort((t,e)=>t.fecha.toDate()-e.fecha.toDate()),r=(t,a,o,i=!0)=>{const s=a?`${t} ($${a})`:t;e.has(s)||e.set(s,{medida:t,precio:a,kilos:0,nombre:s}),e.get(s).kilos+=i?o:-o};s.forEach(e=>{const o=e.fecha instanceof Date?e.fecha:e.fecha.toDate();mt()(o).isSameOrBefore(a)&&(e.entradas.forEach(e=>{e.proveedor===t&&r(e.medida,e.precio,e.kilos,!0)}),e.salidas.forEach(e=>{e.proveedor===t&&r(e.medida,e.precio,e.kilos,!1)}))}),this.entradas.forEach(e=>{e.proveedor===t&&r(e.medida,e.precio,e.kilos,!0)}),this.salidas.forEach(e=>{e.proveedor===t&&r(e.medida,e.precio,e.kilos,!1)});const n=[];for(const[c,l]of e)l.kilos>0&&n.push({id:l.nombre,nombre:l.nombre,tipo:"general",precio:l.precio,kilos:l.kilos});return n}},async created(){await this.loadProveedores(),await this.loadMedidas(),this.$route.params.id?(console.log("ID de la ruta encontrado:",this.$route.params.id),await this.loadSacada(this.$route.params.id)):console.log("No se encontró ID en la ruta"),this.isLoaded=!0},watch:{"newSalida.proveedor":"updateKilosDisponibles","newSalida.medida":"updateKilosDisponibles","newSalida.kilos":"updateKilosDisponibles",async"newSalida.proveedor"(t){this.updateKilosDisponibles(),t&&"proveedor"===this.newSalida.tipo?this.medidasConPrecio=await this.getMedidasConPrecio(t):this.medidasConPrecio=[]}}},ht=pt,vt=(a("0db6"),Object(d["a"])(ht,ct,lt,!1,null,"7ca5d968",null)),bt=vt.exports,ft=function(){var t=this,e=t._self._c;return e("div",{staticClass:"sacadas-menu-container"},[e("h1",[t._v("Menú de Sacadas")]),e("div",{staticClass:"actions-container"},[e("router-link",{staticClass:"action-button new-sacada-btn",attrs:{to:"/sacadas/new"}},[t._v(" Nueva Sacada ")]),e("router-link",{staticClass:"action-button",attrs:{to:"/gestionar-productos"}},[t._v(" Gestionar Productos ")]),e("button",{staticClass:"action-button",on:{click:t.showHistorialModal}},[t._v(" Ver Historial de Productos ")])],1),e("div",{staticClass:"sacadas-list"},[e("h2",[t._v("Registros de Sacadas")]),t.isLoading?e("div",{staticClass:"loading"},[t._v("Cargando registros...")]):0===t.sacadas.length?e("div",{staticClass:"no-records"},[t._v(" No hay registros de sacadas. ")]):e("ul",t._l(t.paginatedSacadas,(function(a){return e("li",{key:a.id,staticClass:"sacada-item"},[e("div",{staticClass:"sacada-content",on:{click:function(e){return t.editSacada(a.id)}}},[e("span",{staticClass:"sacada-date"},[t._v(t._s(t.formatDate(a.fecha)))]),e("div",{staticClass:"sacada-summary"},[e("div",{staticClass:"sacada-entry"},[e("span",{staticClass:"sacada-label"},[t._v("Entradas:")]),e("span",{staticClass:"sacada-value"},[t._v(t._s(t.formatNumber(a.totalEntradas))+" kg")])]),e("div",{staticClass:"sacada-entry"},[e("span",{staticClass:"sacada-label"},[t._v("Salidas:")]),e("span",{staticClass:"sacada-value"},[t._v(t._s(t.formatNumber(a.totalSalidas))+" kg")])])])]),e("div",{staticClass:"sacada-actions"},[e("button",{staticClass:"delete-btn",on:{click:function(e){return e.stopPropagation(),t.deleteSacada(a.id)}}},[t._v("Borrar")])])])})),0),e("div",{staticClass:"pagination"},[e("button",{attrs:{disabled:1===t.currentPage},on:{click:t.prevPage}},[t._v("Anterior")]),e("span",[t._v("Página "+t._s(t.currentPage)+" de "+t._s(t.totalPages))]),e("button",{attrs:{disabled:t.currentPage===t.totalPages},on:{click:t.nextPage}},[t._v("Siguiente")])])]),e("HistorialProductoModal",{attrs:{"is-open":t.isHistorialModalOpen,proveedores:t.proveedores,medidas:t.medidas},on:{close:t.closeHistorialModal}})],1)},gt=[];a("898b");mt.a.locale("es");var Ct=function(){var t=this,e=t._self._c;return t.isOpen?e("div",{staticClass:"modal-overlay",on:{click:t.closeModal}},[e("div",{staticClass:"modal-content",on:{click:function(t){t.stopPropagation()}}},[e("h2",[t._v("Historial de Producto")]),e("div",{staticClass:"form-group"},[e("select",{directives:[{name:"model",rawName:"v-model",value:t.filtros.tipo,expression:"filtros.tipo"}],on:{change:[function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(t.filtros,"tipo",e.target.multiple?a:a[0])},t.resetSelections]}},[e("option",{attrs:{value:""}},[t._v("Seleccionar Tipo")]),e("option",{attrs:{value:"proveedor"}},[t._v("Proveedor")]),e("option",{attrs:{value:"maquila"}},[t._v("Maquila")])]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.filtros.proveedor,expression:"filtros.proveedor"}],on:{change:[function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(t.filtros,"proveedor",e.target.multiple?a:a[0])},t.onProveedorChange]}},[e("option",{attrs:{value:""}},[t._v("Seleccionar "+t._s("maquila"===t.filtros.tipo?"Maquila":"Proveedor"))]),t._l(t.proveedoresFiltrados,(function(a){return e("option",{key:a.id,domProps:{value:a.nombre}},[t._v(" "+t._s(a.nombre)+" ")])}))],2),e("select",{directives:[{name:"model",rawName:"v-model",value:t.filtros.medida,expression:"filtros.medida"}],on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(t.filtros,"medida",e.target.multiple?a:a[0])}}},[e("option",{attrs:{value:""}},[t._v("Seleccionar Medida")]),t._l(t.medidasFiltradas,(function(a){return e("option",{key:a.id,domProps:{value:a.nombre}},[t._v(" "+t._s(a.nombre)+" ")])}))],2),e("select",{directives:[{name:"model",rawName:"v-model",value:t.filtros.movimiento,expression:"filtros.movimiento"}],on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(t.filtros,"movimiento",e.target.multiple?a:a[0])}}},[e("option",{attrs:{value:""}},[t._v("Tipo de Movimiento")]),e("option",{attrs:{value:"entradas"}},[t._v("Entradas")]),e("option",{attrs:{value:"salidas"}},[t._v("Salidas")])]),e("button",{attrs:{disabled:!t.isFormValid},on:{click:t.buscarHistorial}},[t._v("Buscar")])]),t.historial.length>0?e("div",{staticClass:"results-container"},[e("table",[t._m(0),e("tbody",t._l(t.historial,(function(a,o){return e("tr",{key:o},[e("td",[t._v(t._s(t.formatDate(a.fecha)))]),e("td",[t._v(t._s(t.formatNumber(a.kilos))+" kg")]),e("td",[t._v(t._s(a.precio?"$"+a.precio:"-"))])])})),0),e("tfoot",[e("tr",[t._m(1),e("td",[e("strong",[t._v(t._s(t.formatNumber(t.totalKilos))+" kg")])]),e("td")])])])]):t.busquedaRealizada?e("div",{staticClass:"no-results"},[t._v(" No se encontraron registros para los criterios seleccionados. ")]):t._e(),e("button",{staticClass:"close-button",on:{click:t.closeModal}},[t._v("×")])])]):t._e()},_t=[function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",[t._v("Fecha")]),e("th",[t._v("Kilos")]),e("th",[t._v("Precio")])])])},function(){var t=this,e=t._self._c;return e("td",[e("strong",[t._v("Total")])])}],yt={name:"HistorialProductoModal",props:{isOpen:{type:Boolean,required:!0},proveedores:{type:Array,required:!0},medidas:{type:Array,required:!0}},data(){return{filtros:{tipo:"",proveedor:"",medida:"",movimiento:""},historial:[],busquedaRealizada:!1}},computed:{proveedoresFiltrados(){return this.proveedores.filter(t=>t.tipo===this.filtros.tipo)},medidasFiltradas(){if("maquila"===this.filtros.tipo){const t=this.proveedores.find(t=>t.nombre===this.filtros.proveedor);return t?this.medidas.filter(e=>"maquila"===e.tipo&&e.maquilaId===t.id):[]}{const t=this.proveedores.find(t=>t.nombre===this.filtros.proveedor);return t?this.medidas.filter(e=>e.proveedorId===t.id||!e.proveedorId&&"general"===e.tipo):this.medidas.filter(t=>"general"===t.tipo)}},isFormValid(){return this.filtros.tipo&&this.filtros.proveedor&&this.filtros.medida&&this.filtros.movimiento},totalKilos(){return this.historial.reduce((t,e)=>t+e.kilos,0)}},methods:{resetSelections(){this.filtros.proveedor="",this.filtros.medida="",this.historial=[],this.busquedaRealizada=!1},onProveedorChange(){this.filtros.medida="",this.historial=[],this.busquedaRealizada=!1},async buscarHistorial(){try{const t=Object(et["c"])(P["a"],"sacadas"),e=Object(et["l"])(t,Object(et["k"])("fecha","desc")),a=await Object(et["g"])(e);this.historial=[],a.docs.forEach(t=>{const e=t.data(),a=e[this.filtros.movimiento]||[];a.forEach(t=>{t.tipo===this.filtros.tipo&&t.proveedor===this.filtros.proveedor&&t.medida===this.filtros.medida&&this.historial.push({fecha:e.fecha.toDate(),kilos:t.kilos,precio:t.precio})})}),this.busquedaRealizada=!0}catch(t){console.error("Error al buscar historial:",t),alert("Error al buscar el historial")}},formatDate(t){return mt()(t).format("DD/MM/YYYY")},formatNumber(t){return t.toLocaleString("es-ES",{minimumFractionDigits:1,maximumFractionDigits:1})},closeModal(){this.$emit("close"),this.resetSelections()}}},wt=yt,kt=(a("e45f"),Object(d["a"])(wt,Ct,_t,!1,null,"4cc8972a",null)),At=kt.exports,Pt={name:"SacadasMenu",components:{HistorialProductoModal:At},data(){return{sacadas:[],isLoading:!0,currentPage:1,itemsPerPage:10,isHistorialModalOpen:!1,proveedores:[],medidas:[]}},computed:{paginatedSacadas(){const t=(this.currentPage-1)*this.itemsPerPage,e=t+this.itemsPerPage;return this.sacadas.slice(t,e)},totalPages(){return Math.ceil(this.sacadas.length/this.itemsPerPage)}},methods:{async loadSacadas(){try{this.isLoading=!0;const t=Object(et["c"])(P["a"],"sacadas"),e=Object(et["l"])(t,Object(et["k"])("fecha","desc")),a=await Object(et["g"])(e);this.sacadas=a.docs.map(t=>{const e=t.data();let a;return a=e.fecha instanceof Date?mt()(e.fecha).toDate():e.fecha&&"function"===typeof e.fecha.toDate?mt()(e.fecha.toDate()).toDate():mt()(e.fecha).toDate(),a=mt()(a).toDate(),{id:t.id,...e,fecha:a,totalEntradas:e.totalEntradas||0,totalSalidas:e.totalSalidas||0}})}catch(t){console.error("Error al cargar sacadas: ",t),this.sacadas=[]}finally{this.isLoading=!1}},formatDate(t){return mt()(t).format("DD [de] MMMM [de] YYYY")},formatNumber(t){return(t||0).toLocaleString("es-ES",{minimumFractionDigits:1,maximumFractionDigits:1})},editSacada(t){this.$router.push("/sacadas/"+t)},async deleteSacada(t){if(confirm("¿Estás seguro de que quieres borrar este registro de sacadas?"))try{await Object(et["d"])(Object(et["e"])(P["a"],"sacadas",t)),this.sacadas=this.sacadas.filter(e=>e.id!==t),alert("Registro de sacadas borrado con éxito")}catch(e){console.error("Error al borrar el registro de sacadas: ",e),alert("Error al borrar el registro de sacadas")}},prevPage(){this.currentPage>1&&this.currentPage--},nextPage(){this.currentPage<this.totalPages&&this.currentPage++},async loadProveedores(){try{const t=await Object(et["g"])(Object(et["c"])(P["a"],"proveedores"));this.proveedores=t.docs.map(t=>({id:t.id,...t.data()}))}catch(t){console.error("Error al cargar proveedores:",t)}},async loadMedidas(){try{const t=await Object(et["g"])(Object(et["c"])(P["a"],"medidas"));this.medidas=t.docs.map(t=>({id:t.id,...t.data()}))}catch(t){console.error("Error al cargar medidas:",t)}},showHistorialModal(){this.isHistorialModalOpen=!0},closeHistorialModal(){this.isHistorialModalOpen=!1}},async mounted(){await Promise.all([this.loadSacadas(),this.loadProveedores(),this.loadMedidas()])}},xt=Pt,St=(a("ebeb"),Object(d["a"])(xt,ft,gt,!1,null,"0ec6c134",null)),Tt=St.exports,Ot=function(){var t=this,e=t._self._c;return e("div",{staticClass:"gestionar-productos-container"},[e("div",{staticClass:"back-button-container"},[e("BackButton",{attrs:{to:"/sacadas"}})],1),e("h1",[t._v("Gestión de Productos")]),e("div",{staticClass:"actions-container"},[e("router-link",{staticClass:"action-button",attrs:{to:"/gestionar-medidas"}},[t._v(" Gestionar Medidas ")]),e("router-link",{staticClass:"action-button",attrs:{to:"/gestionar-proveedores"}},[t._v(" Gestionar Proveedores ")])],1),e("div",{staticClass:"modify-product-form"},[e("h2",[t._v("Modificar Existencia de Producto")]),e("form",{on:{submit:function(e){return e.preventDefault(),t.modifyProduct.apply(null,arguments)}}},[e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"tipo"}},[t._v("Tipo:")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.modifyProductData.tipo,expression:"modifyProductData.tipo"}],attrs:{id:"tipo",required:""},on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(t.modifyProductData,"tipo",e.target.multiple?a:a[0])}}},[e("option",{attrs:{value:"proveedor"}},[t._v("Proveedor")]),e("option",{attrs:{value:"maquila"}},[t._v("Maquila")])])]),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"proveedor"}},[t._v("Proveedor/Maquila:")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.modifyProductData.proveedor,expression:"modifyProductData.proveedor"}],attrs:{id:"proveedor",required:""},on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(t.modifyProductData,"proveedor",e.target.multiple?a:a[0])}}},[e("option",{attrs:{value:""}},[t._v("Seleccione un proveedor/maquila")]),t._l(t.proveedoresFiltrados,(function(a){return e("option",{key:a.id,domProps:{value:a.nombre}},[t._v(" "+t._s(a.nombre)+" ")])}))],2)]),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"medida"}},[t._v("Medida:")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.modifyProductData.medida,expression:"modifyProductData.medida"}],attrs:{id:"medida",required:""},on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(t.modifyProductData,"medida",e.target.multiple?a:a[0])}}},[e("option",{attrs:{value:""}},[t._v("Seleccione una medida")]),t._l(t.medidasFiltradas,(function(a){return e("option",{key:a.id,domProps:{value:a.nombre}},[t._v(" "+t._s(a.nombre)+" ")])}))],2)]),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"kilos"}},[t._v("Kilos:")]),e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.modifyProductData.kilos,expression:"modifyProductData.kilos",modifiers:{number:!0}}],attrs:{id:"kilos",type:"number",step:"0.1",required:""},domProps:{value:t.modifyProductData.kilos},on:{input:function(e){e.target.composing||t.$set(t.modifyProductData,"kilos",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}})]),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"operacion"}},[t._v("Operación:")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.modifyProductData.operacion,expression:"modifyProductData.operacion"}],attrs:{id:"operacion",required:""},on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(t.modifyProductData,"operacion",e.target.multiple?a:a[0])}}},[e("option",{attrs:{value:"sumar"}},[t._v("Sumar")]),e("option",{attrs:{value:"restar"}},[t._v("Restar")])])]),e("button",{staticClass:"submit-btn",attrs:{type:"submit"}},[t._v("Modificar Existencia")])])]),e("div",{staticClass:"products-list"},[e("h2",[t._v("Existencias Actuales")]),e("ul",t._l(t.existencias,(function(a,o){return e("li",{key:o},[e("strong",[t._v(t._s(o))]),e("ul",t._l(a,(function(a,o){return e("li",{key:o},[t._v(" "+t._s(o)+" - "+t._s(t.formatNumber(a))+" kg ")])})),0)])})),0)]),e("router-link",{staticClass:"back-btn",attrs:{to:"/sacadas"}},[t._v("Volver al Menú de Sacadas")])],1)},Mt=[],Nt={name:"GestionarProductos",components:{BackButton:dt["a"]},setup(){const t=Object(o["ref"])({}),e=Object(o["ref"])([]),a=Object(o["ref"])([]),i=Object(o["ref"])({tipo:"proveedor",proveedor:"",medida:"",kilos:null,operacion:"sumar"}),s=async()=>{try{const e=await Object(et["g"])(Object(et["c"])(P["a"],"sacadas")),a={};e.forEach(t=>{const e=t.data();e.entradas.forEach(t=>{a[t.proveedor]||(a[t.proveedor]={}),a[t.proveedor][t.medida]||(a[t.proveedor][t.medida]=0),a[t.proveedor][t.medida]+=t.kilos}),e.salidas.forEach(t=>{a[t.proveedor]||(a[t.proveedor]={}),a[t.proveedor][t.medida]||(a[t.proveedor][t.medida]=0),a[t.proveedor][t.medida]-=t.kilos})}),Object.keys(a).forEach(t=>{a[t]=Object.fromEntries(Object.entries(a[t]).filter(([t,e])=>e>0))}),t.value=a}catch(e){console.error("Error al cargar existencias: ",e)}},r=async()=>{try{const t=await Object(et["g"])(Object(et["c"])(P["a"],"medidas"));e.value=t.docs.map(t=>({id:t.id,...t.data()}))}catch(t){console.error("Error al cargar medidas: ",t)}},n=async()=>{try{const t=await Object(et["g"])(Object(et["c"])(P["a"],"proveedores"));a.value=t.docs.map(t=>({id:t.id,...t.data()}))}catch(t){console.error("Error al cargar proveedores: ",t)}},c=async()=>{try{const{proveedor:t,medida:e,kilos:a,operacion:o}=i.value,r={fecha:new Date,entradas:[],salidas:[]};"sumar"===o?r.entradas.push({proveedor:t,medida:e,kilos:a}):r.salidas.push({proveedor:t,medida:e,kilos:a}),await Object(et["b"])(Object(et["c"])(P["a"],"sacadas"),r),alert("Existencia modificada con éxito"),i.value={tipo:"proveedor",proveedor:"",medida:"",kilos:null,operacion:"sumar"},s()}catch(t){console.error("Error al modificar producto: ",t),alert("Error al modificar la existencia del producto")}},l=t=>t.toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1}),d=Object(o["computed"])(()=>a.value.filter(t=>"proveedor"===i.value.tipo?"maquila"!==t.tipo:"maquila"===t.tipo)),u=Object(o["computed"])(()=>e.value.filter(t=>"proveedor"===i.value.tipo?"general"===t.tipo:"maquila"===t.tipo));return Object(o["onMounted"])(()=>{s(),r(),n()}),{existencias:t,medidas:e,proveedores:a,modifyProductData:i,modifyProduct:c,formatNumber:l,proveedoresFiltrados:d,medidasFiltradas:u}}},Dt=Nt,Et=(a("e6b2"),Object(d["a"])(Dt,Ot,Mt,!1,null,"67f08a69",null)),jt=Et.exports,$t=function(){var t=this,e=t._self._c;return e("div",{staticClass:"gestionar-medidas-container"},[e("div",{staticClass:"back-button-container"},[e("BackButton",{attrs:{to:"/gestionar-productos"}})],1),e("h1",[t._v("Gestión de Medidas")]),e("div",{staticClass:"add-medida-form"},[e("h2",[t._v("Agregar Medida")]),e("form",{on:{submit:function(e){return e.preventDefault(),t.addMedida.apply(null,arguments)}}},[e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"medida"}},[t._v("Medida:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.newMedida.nombre,expression:"newMedida.nombre"}],attrs:{id:"medida",required:"",placeholder:"Ej: 16/20, 21/25, 26/30, etc."},domProps:{value:t.newMedida.nombre},on:{input:function(e){e.target.composing||t.$set(t.newMedida,"nombre",e.target.value)}}})]),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"tipo"}},[t._v("Tipo:")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.newMedida.tipo,expression:"newMedida.tipo"}],attrs:{id:"tipo",required:""},on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(t.newMedida,"tipo",e.target.multiple?a:a[0])}}},[e("option",{attrs:{value:"general"}},[t._v("General")]),e("option",{attrs:{value:"maquila"}},[t._v("Maquila")])])]),"maquila"===t.newMedida.tipo?e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"maquila"}},[t._v("Maquila:")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.newMedida.maquilaId,expression:"newMedida.maquilaId"}],attrs:{id:"maquila",required:""},on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(t.newMedida,"maquilaId",e.target.multiple?a:a[0])}}},[e("option",{attrs:{value:""}},[t._v("Seleccione una maquila")]),t._l(t.maquilas,(function(a){return e("option",{key:a.id,domProps:{value:a.id}},[t._v(" "+t._s(a.nombre)+" ")])}))],2)]):t._e(),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"proveedor"}},[t._v("Proveedor:")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.newMedida.proveedorId,expression:"newMedida.proveedorId"}],attrs:{id:"proveedor"},on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(t.newMedida,"proveedorId",e.target.multiple?a:a[0])}}},[e("option",{attrs:{value:""}},[t._v("General")]),t._l(t.proveedores,(function(a){return e("option",{key:a.id,domProps:{value:a.id}},[t._v(" "+t._s(a.nombre)+" ")])}))],2)]),e("button",{staticClass:"submit-btn",attrs:{type:"submit"}},[t._v("Agregar Medida")])])]),e("div",{staticClass:"medidas-list"},[e("h2",[t._v("Lista de Medidas")]),e("h3",[t._v("Medidas Generales")]),e("ul",t._l(t.medidasGenerales,(function(a){return e("li",{key:a.id},[t._v(" "+t._s(a.nombre)+" "),e("button",{staticClass:"delete-btn",on:{click:function(e){return t.deleteMedida(a.id)}}},[t._v("Eliminar")])])})),0),e("h3",[t._v("Medidas de Proveedores")]),t._l(t.proveedores,(function(a){return e("div",{key:a.id},[e("h4",[t._v(t._s(a.nombre))]),e("ul",t._l(t.getMedidasProveedor(a.id),(function(a){return e("li",{key:a.id},[t._v(" "+t._s(a.nombre)+" "),e("button",{staticClass:"delete-btn",on:{click:function(e){return t.deleteMedida(a.id)}}},[t._v("Eliminar")])])})),0)])})),e("h3",[t._v("Medidas de Maquilas")]),t._l(t.maquilas,(function(a){return e("div",{key:a.id},[e("h4",[t._v(t._s(a.nombre))]),e("ul",t._l(t.getMedidasMaquila(a.id),(function(a){return e("li",{key:a.id},[t._v(" "+t._s(a.nombre)+" "),e("button",{staticClass:"delete-btn",on:{click:function(e){return t.deleteMedida(a.id)}}},[t._v("Eliminar")])])})),0)])}))],2)])},It=[],Ft={name:"GestionarMedidas",components:{BackButton:dt["a"]},setup(){const t=Object(o["ref"])([]),e=Object(o["ref"])([]),a=Object(o["ref"])([]),i=Object(o["ref"])({nombre:"",tipo:"general",maquilaId:"",proveedorId:""}),s=async()=>{try{const e=await Object(et["g"])(Object(et["c"])(P["a"],"medidas"));t.value=e.docs.map(t=>({id:t.id,...t.data()}))}catch(e){console.error("Error al cargar medidas: ",e)}},r=async()=>{try{const t=Object(et["l"])(Object(et["c"])(P["a"],"proveedores"),Object(et["p"])("tipo","==","maquila")),e=await Object(et["g"])(t);a.value=e.docs.map(t=>({id:t.id,...t.data()}))}catch(t){console.error("Error al cargar maquilas: ",t)}},n=async()=>{try{const t=await Object(et["g"])(Object(et["c"])(P["a"],"proveedores"));e.value=t.docs.map(t=>({id:t.id,...t.data()}))}catch(t){console.error("Error al cargar proveedores: ",t)}},c=async()=>{try{await Object(et["b"])(Object(et["c"])(P["a"],"medidas"),{nombre:i.value.nombre,tipo:i.value.tipo,maquilaId:"maquila"===i.value.tipo?i.value.maquilaId:null,proveedorId:"general"===i.value.tipo?i.value.proveedorId:null}),i.value={nombre:"",tipo:"general",maquilaId:"",proveedorId:""},s()}catch(t){console.error("Error al añadir medida: ",t)}},l=async t=>{if(confirm("¿Estás seguro de que quieres eliminar esta medida?"))try{await Object(et["d"])(Object(et["e"])(P["a"],"medidas",t)),s()}catch(e){console.error("Error al eliminar medida: ",e)}},d=Object(o["computed"])(()=>t.value.filter(t=>"general"===t.tipo&&!t.proveedorId)),u=e=>t.value.filter(t=>"maquila"===t.tipo&&t.maquilaId===e),m=e=>t.value.filter(t=>t.proveedorId===e);return Object(o["onMounted"])(()=>{s(),r(),n()}),{medidas:t,proveedores:e,maquilas:a,newMedida:i,addMedida:c,deleteMedida:l,medidasGenerales:d,getMedidasMaquila:u,getMedidasProveedor:m}}},qt=Ft,zt=(a("c3cc"),Object(d["a"])(qt,$t,It,!1,null,"48626452",null)),Vt=zt.exports,Lt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"gestionar-proveedores-container"},[e("div",{staticClass:"back-button-container"},[e("BackButton",{attrs:{to:"/gestionar-productos"}})],1),e("h1",[t._v("Gestión de Proveedores y Maquilas")]),e("div",{staticClass:"add-proveedor-form"},[e("h2",[t._v("Agregar Proveedor/Maquila")]),e("form",{on:{submit:function(e){return e.preventDefault(),t.addProveedor.apply(null,arguments)}}},[e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"nombre"}},[t._v("Nombre:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.newProveedor.nombre,expression:"newProveedor.nombre"}],attrs:{id:"nombre",required:"",placeholder:"Nombre del proveedor/maquila"},domProps:{value:t.newProveedor.nombre},on:{input:function(e){e.target.composing||t.$set(t.newProveedor,"nombre",e.target.value)}}})]),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"tipo"}},[t._v("Tipo:")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.newProveedor.tipo,expression:"newProveedor.tipo"}],attrs:{id:"tipo",required:""},on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(t.newProveedor,"tipo",e.target.multiple?a:a[0])}}},[e("option",{attrs:{value:"proveedor"}},[t._v("Proveedor")]),e("option",{attrs:{value:"maquila"}},[t._v("Maquila")])])]),e("button",{staticClass:"submit-btn",attrs:{type:"submit"}},[t._v("Agregar")])])]),e("div",{staticClass:"proveedores-list"},[e("h2",[t._v("Lista de Proveedores y Maquilas")]),e("ul",t._l(t.sortedProveedores,(function(a){return e("li",{key:a.id},[e("div",{staticClass:"proveedor-info"},[e("strong",[t._v(t._s(a.nombre))]),e("span",[t._v("("+t._s("proveedor"===a.tipo?"Proveedor":"Maquila")+")")])]),e("button",{staticClass:"delete-btn",on:{click:function(e){return t.deleteProveedor(a.id)}}},[t._v("Eliminar")])])})),0)])])},Bt=[],Gt={name:"GestionarProveedores",components:{BackButton:dt["a"]},setup(){const t=Object(o["ref"])([]),e=Object(o["ref"])({nombre:"",tipo:"proveedor"}),a=async()=>{try{const e=await Object(et["g"])(Object(et["c"])(P["a"],"proveedores"));t.value=e.docs.map(t=>({id:t.id,...t.data()}))}catch(e){console.error("Error al cargar proveedores: ",e)}},i=async()=>{try{await Object(et["b"])(Object(et["c"])(P["a"],"proveedores"),{nombre:e.value.nombre,tipo:e.value.tipo}),e.value={nombre:"",tipo:"proveedor"},a()}catch(t){console.error("Error al añadir proveedor: ",t)}},s=async t=>{if(confirm("¿Estás seguro de que quieres eliminar este proveedor/maquila?"))try{await Object(et["d"])(Object(et["e"])(P["a"],"proveedores",t)),a()}catch(e){console.error("Error al eliminar proveedor: ",e)}},r=Object(o["computed"])(()=>[...t.value].sort((t,e)=>t.nombre.localeCompare(e.nombre)));return Object(o["onMounted"])(a),{proveedores:t,newProveedor:e,addProveedor:i,deleteProveedor:s,sortedProveedores:r}}},Ht=Gt,Rt=(a("9226"),Object(d["a"])(Ht,Lt,Bt,!1,null,"14c80c33",null)),Kt=Rt.exports,Jt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"existencias-page"},[e("div",{staticClass:"existencias-container"},[e("div",{staticClass:"header"},[e("h1",[t._v("Reporte de Existencias")]),e("button",{staticClass:"print-button",on:{click:t.imprimirReporte}},[t._v(" Imprimir Reporte ")])]),e("div",{staticClass:"filters"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.search,expression:"search"}],staticClass:"search-input",attrs:{placeholder:"Buscar por proveedor o medida"},domProps:{value:t.search},on:{input:function(e){e.target.composing||(t.search=e.target.value)}}})]),e("div",{staticClass:"existencias-grid"},[t._l(t.filteredExistencias,(function(a,o){return[e("div",{key:o,staticClass:"medida-card",class:{"maquila-card":"Ozuna"===o||"Joselito"===o}},[e("h2",[t._v(t._s(o)+t._s("Ozuna"===o||"Joselito"===o?" (Maquila)":""))]),e("table",{staticClass:"medida-table"},[e("thead",[e("tr",[e("th",[t._v("Medida")]),"Ozuna"!==o&&"Joselito"!==o?e("th",[t._v("Proveedor")]):t._e(),e("th",{staticClass:"kilos-cell"},[t._v("Kilos")])])]),e("tbody",["Ozuna"===o||"Joselito"===o?[t._l(a,(function(a,o){return e("tr",{key:o},[e("td",[t._v(t._s(a.medida))]),e("td",{staticClass:"kilos-cell"},[t._v(t._s(t.formatNumber(a.kilos)))])])})),e("tr",{staticClass:"total-row"},[e("td",[e("strong",[t._v("Total "+t._s(o))])]),e("td",{staticClass:"kilos-cell"},[e("strong",[t._v(t._s(t.formatNumber(Object.values(a).reduce((t,e)=>t+e.kilos,0))))])])])]:[t._l(a,(function(a){return e("tr",{key:a.medida},[e("td",[t._v(t._s(a.medida))]),e("td",[t._v(t._s(a.proveedor))]),e("td",{staticClass:"kilos-cell"},[t._v(t._s(t.formatNumber(a.kilos)))])])})),e("tr",{staticClass:"total-row"},[e("td",[e("strong",[t._v("Total "+t._s(o))])]),e("td"),e("td",{staticClass:"kilos-cell"},[e("strong",[t._v(t._s(t.formatNumber(a.reduce((t,e)=>t+e.kilos,0))))])])])]],2)])])]}))],2),e("div",{staticClass:"total-general"},[e("h2",[t._v("Total General: "+t._s(t.formatNumber(t.totalGeneral)))])])])])},Ut=[],Yt={name:"Existencias",setup(){const t=Object(o["ref"])({}),e=Object(o["ref"])(""),a=async()=>{const e=await Object(et["g"])(Object(et["c"])(P["a"],"sacadas")),a={};console.log("=== Rastreando Selecta 51/60 1ra Nacional ===");let o=0;const i=e.docs.map(t=>({id:t.id,...t.data()})).sort((t,e)=>{const a=t.fecha instanceof Date?t.fecha:t.fecha.toDate(),o=e.fecha instanceof Date?e.fecha:e.fecha.toDate();return a-o});i.forEach(t=>{const e=t.fecha instanceof Date?t.fecha:t.fecha.toDate();t.entradas.forEach(t=>{"Selecta"===t.proveedor&&"51/60 1ra Nacional"===t.medida&&(o+=t.kilos,console.log(`Entrada: ${t.kilos} kg - Fecha: ${mt()(e).format("DD/MM/YYYY")} - Total: ${o} kg`)),a[t.proveedor]||(a[t.proveedor]={});const i=t.medida;a[t.proveedor][i]||(a[t.proveedor][i]={kilos:0,medida:t.medida}),a[t.proveedor][i].kilos+=t.kilos}),t.salidas.forEach(t=>{"Selecta"===t.proveedor&&"51/60 1ra Nacional"===t.medida&&(o-=t.kilos,console.log(`Salida: ${t.kilos} kg - Fecha: ${mt()(e).format("DD/MM/YYYY")} - Total: ${o} kg`)),a[t.proveedor]||(a[t.proveedor]={});const i=t.medida;a[t.proveedor][i]||(a[t.proveedor][i]={kilos:0,medida:t.medida}),a[t.proveedor][i].kilos-=t.kilos})}),console.log(`=== Total final Selecta 51/60 1ra Nacional: ${o} kg ===`),Object.keys(a).forEach(t=>{"Selecta"===t&&a[t]["51/60 1ra Nacional"]&&console.log("[DEBUG] Resultado final Selecta 51/60 1ra Nacional:",a[t]["51/60 1ra Nacional"].kilos),a[t]=Object.fromEntries(Object.entries(a[t]).filter(([t,e])=>e.kilos>0)),0===Object.keys(a[t]).length&&delete a[t]}),t.value=a},i=Object(o["computed"])(()=>{const a=e.value.toLowerCase(),o={},i={};Object.entries(t.value).forEach(([t,e])=>{"Ozuna"!==t&&"Joselito"!==t&&(i[t]=e)}),t.value["Ozuna"]&&(o["Ozuna"]=t.value["Ozuna"]),t.value["Joselito"]&&(o["Joselito"]=t.value["Joselito"]);const s={};Object.entries(i).forEach(([t,e])=>{Object.entries(e).forEach(([e,a])=>{const o=a.medida.split(" ")[0];s[o]||(s[o]=[]);const i=s[o].findIndex(e=>e.proveedor===t&&e.medida===a.medida);i>=0?s[o][i].kilos+=a.kilos:s[o].push({proveedor:t,medida:a.medida,kilos:a.kilos})})});const r={};return Object.entries(s).sort(([t],[e])=>{const a=parseInt(t.split("/")[0]),o=parseInt(e.split("/")[0]);return a-o}).forEach(([t,e])=>{(!a||t.toLowerCase().includes(a)||e.some(t=>t.proveedor.toLowerCase().includes(a)||t.medida.toLowerCase().includes(a)))&&(r[t]=e)}),Object.entries(o).forEach(([t,e])=>{a&&!t.toLowerCase().includes(a)||(r[t]=Object.entries(e).sort(([t],[e])=>{const a=parseInt(t.split("/")[0]),o=parseInt(e.split("/")[0]);return a-o}).reduce((t,[e,a])=>(t[e]=a,t),{}))}),r}),s=Object(o["computed"])(()=>{let e=0,a=0;return Object.entries(t.value).forEach(([t,o])=>{Object.values(o).forEach(o=>{"ozuna"===t.toLowerCase()?o.kilos>a&&(a=o.kilos):o.kilos>e&&(e=o.kilos)})}),{normal:e,ozuna:a}}),r=Object(o["computed"])(()=>Object.entries(i.value).reduce((t,[e,a])=>"Ozuna"===e||"Joselito"===e?t+Object.values(a).reduce((t,e)=>t+e.kilos,0):t+a.reduce((t,e)=>t+e.kilos,0),0)),n=t=>Math.round(t).toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),c=()=>{const t=(new Date).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}),e='\n        <style>\n          @page { \n            size: A4 landscape; \n            margin: 0.5cm 0.5cm;\n            @bottom-right {\n              content: "Página " counter(page) " de " counter(pages);\n              font-size: 11pt;\n            }\n          }\n          body {\n            font-family: Arial, sans-serif;\n            font-size: 18pt;\n            line-height: 1.2;\n            color: #333;\n            margin: 0;\n            padding: 0;\n          }\n          .header {\n            margin-bottom: 8px;\n            padding-bottom: 4px;\n          }\n          h1 {\n            font-size: 26pt;\n            margin: 0;\n            padding: 0;\n          }\n          .fecha-reporte {\n            font-size: 18pt;\n          }\n          .existencias-grid {\n            display: grid;\n            grid-template-columns: repeat(4, 1fr);\n            gap: 8px;\n            margin-top: 10px;\n          }\n          .medida-card {\n            padding: 8px;\n          }\n          .medida-card h2 {\n            font-size: 20pt;\n            margin: 0 0 6px 0;\n            padding-bottom: 4px;\n          }\n          th, td {\n            padding: 4px;\n            font-size: 16pt;\n          }\n          @media print {\n            .existencias-grid {\n              display: grid;\n              grid-template-columns: repeat(4, 1fr);\n            }\n            .maquila-card {\n              break-before: page;\n              page-break-before: always;\n            }\n            .medida-card {\n              break-inside: avoid;\n              page-break-inside: avoid;\n            }\n          }\n          .total-general {\n            margin-top: 15px;\n            padding: 8px;\n          }\n          .total-general h2 {\n            font-size: 20pt;\n          }\n          table {\n            width: 100%;\n            border-collapse: collapse;\n            margin-top: 8px;\n            border: 2px solid #2c3e50;\n          }\n          th {\n            background-color: #2c3e50;\n            color: white;\n            text-align: left;\n            padding: 8px;\n            font-size: 16pt;\n            border: 1px solid #2c3e50;\n          }\n          td {\n            padding: 6px 8px;\n            font-size: 16pt;\n            border: 1px solid #bdc3c7;\n          }\n          tr:nth-child(even) {\n            background-color: #f8f9fa;\n          }\n          .kilos-cell {\n            text-align: right;\n            font-weight: bold;\n            color: #2c3e50;\n          }\n          .total-row {\n            background-color: #ecf0f1 !important;\n            border-top: 2px solid #2c3e50;\n          }\n          .total-row td {\n            font-weight: bold;\n            color: #2c3e50;\n          }\n          .medida-card {\n            padding: 12px;\n            border: 1px solid #bdc3c7;\n            background-color: white;\n          }\n          .maquila-card {\n            background-color: white;\n            border: 2px solid #f39c12;\n          }\n          .maquila-card h2 {\n            color: #d35400;\n            border-bottom: 2px solid #f39c12;\n            padding-bottom: 8px;\n          }\n          .maquila-card th {\n            background-color: #f39c12;\n            border-color: #f39c12;\n          }\n          .maquila-card .total-row {\n            background-color: #f8f9fa !important;\n            border-top: 2px solid #f39c12;\n          }\n          .maquila-card .total-row td {\n            color: #d35400;\n            font-weight: bold;\n          }\n          @media print {\n            .medida-card {\n              box-shadow: none;\n              border: 1px solid #bdc3c7;\n            }\n            .maquila-card {\n              background-color: white;\n              border: 2px solid #f39c12;\n            }\n            table {\n              page-break-inside: avoid;\n            }\n          }\n        </style>\n      ',a=document.createElement("div");a.innerHTML=`\n        ${e}\n        <div class="header">\n          <h1>Reporte de Existencias</h1>\n          <div class="fecha-reporte">Fecha: ${t}</div>\n        </div>\n        ${document.querySelector(".existencias-grid").outerHTML}\n        ${document.querySelector(".total-general").outerHTML}\n      `;const o=window.open("","_blank");o.document.write(a.innerHTML),o.document.close(),setTimeout(()=>{o.print(),o.close()},250)};let l;return Object(o["onMounted"])(()=>{a(),l=Object(et["j"])(Object(et["c"])(P["a"],"sacadas"),()=>{a()})}),Object(o["onUnmounted"])(()=>{l&&l()}),Object(o["watchEffect"])(()=>{console.log("Existencias actualizadas:",t.value)}),{existencias:t,filteredExistencias:i,search:e,maxKilos:s,totalGeneral:r,formatNumber:n,imprimirReporte:c}}},Wt=Yt,Qt=(a("458c"),Object(d["a"])(Wt,Jt,Ut,!1,null,"641ed602",null)),Xt=Qt.exports,Zt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"page-container"},[e("div",{staticClass:"content-wrap"},[e("div",{staticClass:"cuentas-mexico-container"},[e("h1",[t._v("Cuentas México")]),e("div",{staticClass:"agenda-container"},[e("div",{staticClass:"card agenda",on:{click:function(e){return t.abrirAgenda()}}},[t._m(0)])]),e("div",{staticClass:"botones-container"},[e("router-link",{staticClass:"boton-cuenta",attrs:{to:"/cuentas-ozuna"}},[e("div",{staticClass:"card ozuna"},[e("h2",[t._v("Ozuna")])])]),e("router-link",{staticClass:"boton-cuenta",attrs:{to:"/cuentas-catarro"}},[e("div",{staticClass:"card catarro"},[e("h2",[t._v("Catarro")])])]),e("router-link",{staticClass:"boton-cuenta",attrs:{to:"/cuentas-joselito"}},[e("div",{staticClass:"card joselito"},[e("h2",[t._v("Joselito")])])]),e("router-link",{staticClass:"boton-cuenta",attrs:{to:"/cuentas-otilio"}},[e("div",{staticClass:"card otilio"},[e("h2",[t._v("Otilio")])])])],1)])]),e("TransaccionesAgendaModal",{attrs:{mostrar:t.mostrarModalAgenda,cliente:t.clienteSeleccionado},on:{cerrar:t.cerrarModalAgenda}})],1)},te=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"card-content"},[e("i",{staticClass:"fas fa-calendar-alt"}),e("h2",[t._v("Agenda de Transacciones")])])}],ee=function(){var t=this,e=t._self._c;return t.mostrar?e("div",{staticClass:"modal-overlay"},[e("div",{staticClass:"modal-agenda"},[e("div",{staticClass:"modal-header"},[e("h3",[t._v("Agenda de Transacciones")]),e("button",{staticClass:"btn-cerrar",on:{click:function(e){return t.$emit("cerrar")}}},[t._v("×")])]),e("div",{staticClass:"calendario-container"},[e("div",{staticClass:"selector-fecha"},[e("button",{staticClass:"btn-nav",on:{click:function(e){return t.cambiarMes(-1)}}},[t._v("<")]),e("span",{staticClass:"mes-anio"},[t._v(t._s(t.nombreMes)+" "+t._s(t.anioActual))]),e("button",{staticClass:"btn-nav",on:{click:function(e){return t.cambiarMes(1)}}},[t._v(">")])]),e("div",{staticClass:"dias-semana"},t._l(t.diasSemana,(function(a){return e("div",{key:a,staticClass:"dia-nombre"},[t._v(t._s(a))])})),0),e("div",{staticClass:"calendario"},t._l(t.diasCalendario,(function(a,o){return e("div",{key:o,staticClass:"dia-celda",class:{"otro-mes":!a.esMesActual,"dia-actual":a.esHoy,"tiene-registros":t.tieneRegistros(a.fecha),seleccionado:t.esDiaSeleccionado(a.fecha)},on:{click:function(e){return t.seleccionarDia(a)}}},[e("span",{staticClass:"numero-dia"},[t._v(t._s(a.numero))]),t.tieneRegistros(a.fecha)?e("div",{staticClass:"indicador-registros"}):t._e()])})),0)]),t.diaSeleccionado?e("div",{staticClass:"transacciones-container"},[e("div",{staticClass:"dia-seleccionado-header"},[e("h4",[t._v(t._s(t.formatoFechaCompleta))]),e("button",{staticClass:"btn-agregar",on:{click:function(e){t.mostrarFormulario=!0}}},[t._v("+ Agregar transacción")])]),t.transaccionesDia.length>0&&!t.mostrarFormulario?e("div",{staticClass:"resumen-dia"},[e("div",{staticClass:"resumen-dia-item"},[e("span",[t._v("Total del día:")]),e("span",[t._v("$"+t._s(t.formatearNumero(t.calcularTotalDia())))])]),e("div",{staticClass:"resumen-dia-item"},[e("span",[t._v("Depósitos:")]),e("span",{staticClass:"color-deposito"},[t._v("$"+t._s(t.formatearNumero(t.calcularTotalDiaPorTipo("deposito"))))])]),e("div",{staticClass:"resumen-dia-item"},[e("span",[t._v("Transferencias:")]),e("span",{staticClass:"color-transferencia"},[t._v("$"+t._s(t.formatearNumero(t.calcularTotalDiaPorTipo("transferencia"))))])]),e("div",{staticClass:"resumen-dia-item"},[e("span",[t._v("Transacciones:")]),e("span",[t._v(t._s(t.transaccionesDia.length))])])]):t._e(),0!==t.transaccionesDia.length||t.mostrarFormulario?t._e():e("div",{staticClass:"sin-transacciones"},[t._v(" No hay transacciones registradas para este día. ")]),t.mostrarFormulario?e("div",{staticClass:"formulario-transaccion"},[e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"cliente"}},[t._v("Cliente:")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.nuevaTransaccion.cliente,expression:"nuevaTransaccion.cliente"}],staticClass:"input-field",attrs:{id:"cliente"},on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(t.nuevaTransaccion,"cliente",e.target.multiple?a:a[0])}}},[e("option",{attrs:{value:"mexico"}},[t._v("México")]),e("option",{attrs:{value:"ozuna"}},[t._v("Ozuna")]),e("option",{attrs:{value:"catarro"}},[t._v("Catarro")]),e("option",{attrs:{value:"joselito"}},[t._v("Joselito")]),e("option",{attrs:{value:"otilio"}},[t._v("Otilio")])])]),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"tipo"}},[t._v("Tipo de transacción:")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.nuevaTransaccion.tipo,expression:"nuevaTransaccion.tipo"}],staticClass:"input-field",attrs:{id:"tipo"},on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(t.nuevaTransaccion,"tipo",e.target.multiple?a:a[0])}}},[e("option",{attrs:{value:"deposito"}},[t._v("Depósito")]),e("option",{attrs:{value:"transferencia"}},[t._v("Transferencia")]),e("option",{attrs:{value:"efectivo"}},[t._v("Efectivo")]),e("option",{attrs:{value:"otro"}},[t._v("Otro")])])]),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"monto"}},[t._v("Monto:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.nuevaTransaccion.monto,expression:"nuevaTransaccion.monto"}],staticClass:"input-field",attrs:{type:"number",id:"monto",placeholder:"Monto en pesos"},domProps:{value:t.nuevaTransaccion.monto},on:{input:function(e){e.target.composing||t.$set(t.nuevaTransaccion,"monto",e.target.value)}}})]),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"descripcion"}},[t._v("Descripción:")]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.nuevaTransaccion.descripcion,expression:"nuevaTransaccion.descripcion"}],staticClass:"input-field textarea",attrs:{id:"descripcion",placeholder:"Detalles de la transacción"},domProps:{value:t.nuevaTransaccion.descripcion},on:{input:function(e){e.target.composing||t.$set(t.nuevaTransaccion,"descripcion",e.target.value)}}})]),e("div",{staticClass:"buttons-container"},[e("button",{staticClass:"btn-guardar",attrs:{disabled:!t.esFormularioValido},on:{click:t.guardarTransaccion}},[t._v(" Guardar ")]),e("button",{staticClass:"btn-cancelar",on:{click:t.cancelarFormulario}},[t._v(" Cancelar ")])])]):t._e(),t.mostrarFormulario||t.mostrarVistaLista?t._e():e("div",{staticClass:"transacciones-agrupadas"},[e("div",{staticClass:"fila-clientes"},[e("div",{staticClass:"cliente-card cliente-card-otilio"},[e("div",{staticClass:"cliente-header cliente-otilio"},[e("h4",[t._v("Otilio")]),t.clientesAgrupados.otilio&&t.clientesAgrupados.otilio.length>0?e("div",{staticClass:"cliente-total"},[t._v(" Total: $"+t._s(t.formatearNumero(t.calcularTotalCliente("otilio")))+" ")]):e("div",{staticClass:"cliente-total sin-datos"},[t._v("Sin transacciones")])]),t.clientesAgrupados.otilio&&t.clientesAgrupados.otilio.length>0?e("div",{staticClass:"cliente-resumen"},[e("div",{staticClass:"resumen-item tipo-deposito"},[e("span",[t._v("Depósitos:")]),e("span",[t._v("$"+t._s(t.formatearNumero(t.calcularTotalPorTipo("otilio","deposito"))))])]),e("div",{staticClass:"resumen-item tipo-transferencia"},[e("span",[t._v("Transferencias:")]),e("span",[t._v("$"+t._s(t.formatearNumero(t.calcularTotalPorTipo("otilio","transferencia"))))])])]):t._e(),t.clientesAgrupados.otilio&&t.clientesAgrupados.otilio.length>0?e("div",{staticClass:"cliente-contador"},[t._v(" "+t._s(t.clientesAgrupados.otilio.length)+" transacción(es) ")]):t._e(),t.clientesAgrupados.otilio&&t.clientesAgrupados.otilio.length>0?e("div",{staticClass:"cliente-transacciones"},t._l(t.clientesAgrupados.otilio,(function(a,o){return e("div",{key:"otilio-"+o,staticClass:"transaccion-mini",class:"tipo-"+a.tipo},[e("div",{staticClass:"transaccion-mini-header"},[e("span",[t._v(t._s(t.obtenerTipoTexto(a.tipo)))]),e("span",[t._v("$"+t._s(t.formatearNumero(a.monto)))])]),e("div",{staticClass:"transaccion-mini-hora"},[t._v(t._s(t.formatearHora(a.timestamp)))]),e("div",{staticClass:"transaccion-mini-acciones"},[e("button",{staticClass:"btn-mini",on:{click:function(e){t.editarTransaccion(t.obtenerIndiceTransaccion(a))}}},[t._v("Editar")]),e("button",{staticClass:"btn-mini btn-mini-eliminar",on:{click:function(e){t.eliminarTransaccion(t.obtenerIndiceTransaccion(a))}}},[t._v("Eliminar")])])])})),0):e("div",{staticClass:"cliente-vacio"},[e("button",{staticClass:"btn-agregar-mini cliente-otilio",on:{click:function(e){t.nuevaTransaccion.cliente="otilio",t.mostrarFormulario=!0}}},[t._v(" + Agregar transacción para Otilio ")])])]),e("div",{staticClass:"cliente-card cliente-card-joselito"},[e("div",{staticClass:"cliente-header cliente-joselito"},[e("h4",[t._v("Joselito")]),t.clientesAgrupados.joselito&&t.clientesAgrupados.joselito.length>0?e("div",{staticClass:"cliente-total"},[t._v(" Total: $"+t._s(t.formatearNumero(t.calcularTotalCliente("joselito")))+" ")]):e("div",{staticClass:"cliente-total sin-datos"},[t._v("Sin transacciones")])]),t.clientesAgrupados.joselito&&t.clientesAgrupados.joselito.length>0?e("div",{staticClass:"cliente-resumen"},[e("div",{staticClass:"resumen-item tipo-deposito"},[e("span",[t._v("Depósitos:")]),e("span",[t._v("$"+t._s(t.formatearNumero(t.calcularTotalPorTipo("joselito","deposito"))))])]),e("div",{staticClass:"resumen-item tipo-transferencia"},[e("span",[t._v("Transferencias:")]),e("span",[t._v("$"+t._s(t.formatearNumero(t.calcularTotalPorTipo("joselito","transferencia"))))])])]):t._e(),t.clientesAgrupados.joselito&&t.clientesAgrupados.joselito.length>0?e("div",{staticClass:"cliente-contador"},[t._v(" "+t._s(t.clientesAgrupados.joselito.length)+" transacción(es) ")]):t._e(),t.clientesAgrupados.joselito&&t.clientesAgrupados.joselito.length>0?e("div",{staticClass:"cliente-transacciones"},t._l(t.clientesAgrupados.joselito,(function(a,o){return e("div",{key:"joselito-"+o,staticClass:"transaccion-mini",class:"tipo-"+a.tipo},[e("div",{staticClass:"transaccion-mini-header"},[e("span",[t._v(t._s(t.obtenerTipoTexto(a.tipo)))]),e("span",[t._v("$"+t._s(t.formatearNumero(a.monto)))])]),e("div",{staticClass:"transaccion-mini-hora"},[t._v(t._s(t.formatearHora(a.timestamp)))]),e("div",{staticClass:"transaccion-mini-acciones"},[e("button",{staticClass:"btn-mini",on:{click:function(e){t.editarTransaccion(t.obtenerIndiceTransaccion(a))}}},[t._v("Editar")]),e("button",{staticClass:"btn-mini btn-mini-eliminar",on:{click:function(e){t.eliminarTransaccion(t.obtenerIndiceTransaccion(a))}}},[t._v("Eliminar")])])])})),0):e("div",{staticClass:"cliente-vacio"},[e("button",{staticClass:"btn-agregar-mini cliente-joselito",on:{click:function(e){t.nuevaTransaccion.cliente="joselito",t.mostrarFormulario=!0}}},[t._v(" + Agregar transacción para Joselito ")])])])]),e("div",{staticClass:"fila-clientes"},[e("div",{staticClass:"cliente-card cliente-card-catarro"},[e("div",{staticClass:"cliente-header cliente-catarro"},[e("h4",[t._v("Catarro")]),t.clientesAgrupados.catarro&&t.clientesAgrupados.catarro.length>0?e("div",{staticClass:"cliente-total"},[t._v(" Total: $"+t._s(t.formatearNumero(t.calcularTotalCliente("catarro")))+" ")]):e("div",{staticClass:"cliente-total sin-datos"},[t._v("Sin transacciones")])]),t.clientesAgrupados.catarro&&t.clientesAgrupados.catarro.length>0?e("div",{staticClass:"cliente-resumen"},[e("div",{staticClass:"resumen-item tipo-deposito"},[e("span",[t._v("Depósitos:")]),e("span",[t._v("$"+t._s(t.formatearNumero(t.calcularTotalPorTipo("catarro","deposito"))))])]),e("div",{staticClass:"resumen-item tipo-transferencia"},[e("span",[t._v("Transferencias:")]),e("span",[t._v("$"+t._s(t.formatearNumero(t.calcularTotalPorTipo("catarro","transferencia"))))])])]):t._e(),t.clientesAgrupados.catarro&&t.clientesAgrupados.catarro.length>0?e("div",{staticClass:"cliente-contador"},[t._v(" "+t._s(t.clientesAgrupados.catarro.length)+" transacción(es) ")]):t._e(),t.clientesAgrupados.catarro&&t.clientesAgrupados.catarro.length>0?e("div",{staticClass:"cliente-transacciones"},t._l(t.clientesAgrupados.catarro,(function(a,o){return e("div",{key:"catarro-"+o,staticClass:"transaccion-mini",class:"tipo-"+a.tipo},[e("div",{staticClass:"transaccion-mini-header"},[e("span",[t._v(t._s(t.obtenerTipoTexto(a.tipo)))]),e("span",[t._v("$"+t._s(t.formatearNumero(a.monto)))])]),e("div",{staticClass:"transaccion-mini-hora"},[t._v(t._s(t.formatearHora(a.timestamp)))]),e("div",{staticClass:"transaccion-mini-acciones"},[e("button",{staticClass:"btn-mini",on:{click:function(e){t.editarTransaccion(t.obtenerIndiceTransaccion(a))}}},[t._v("Editar")]),e("button",{staticClass:"btn-mini btn-mini-eliminar",on:{click:function(e){t.eliminarTransaccion(t.obtenerIndiceTransaccion(a))}}},[t._v("Eliminar")])])])})),0):e("div",{staticClass:"cliente-vacio"},[e("button",{staticClass:"btn-agregar-mini cliente-catarro",on:{click:function(e){t.nuevaTransaccion.cliente="catarro",t.mostrarFormulario=!0}}},[t._v(" + Agregar transacción para Catarro ")])])]),e("div",{staticClass:"cliente-card cliente-card-ozuna"},[e("div",{staticClass:"cliente-header cliente-ozuna"},[e("h4",[t._v("Ozuna")]),t.clientesAgrupados.ozuna&&t.clientesAgrupados.ozuna.length>0?e("div",{staticClass:"cliente-total"},[t._v(" Total: $"+t._s(t.formatearNumero(t.calcularTotalCliente("ozuna")))+" ")]):e("div",{staticClass:"cliente-total sin-datos"},[t._v("Sin transacciones")])]),t.clientesAgrupados.ozuna&&t.clientesAgrupados.ozuna.length>0?e("div",{staticClass:"cliente-resumen"},[e("div",{staticClass:"resumen-item tipo-deposito"},[e("span",[t._v("Depósitos:")]),e("span",[t._v("$"+t._s(t.formatearNumero(t.calcularTotalPorTipo("ozuna","deposito"))))])]),e("div",{staticClass:"resumen-item tipo-transferencia"},[e("span",[t._v("Transferencias:")]),e("span",[t._v("$"+t._s(t.formatearNumero(t.calcularTotalPorTipo("ozuna","transferencia"))))])])]):t._e(),t.clientesAgrupados.ozuna&&t.clientesAgrupados.ozuna.length>0?e("div",{staticClass:"cliente-contador"},[t._v(" "+t._s(t.clientesAgrupados.ozuna.length)+" transacción(es) ")]):t._e(),t.clientesAgrupados.ozuna&&t.clientesAgrupados.ozuna.length>0?e("div",{staticClass:"cliente-transacciones"},t._l(t.clientesAgrupados.ozuna,(function(a,o){return e("div",{key:"ozuna-"+o,staticClass:"transaccion-mini",class:"tipo-"+a.tipo},[e("div",{staticClass:"transaccion-mini-header"},[e("span",[t._v(t._s(t.obtenerTipoTexto(a.tipo)))]),e("span",[t._v("$"+t._s(t.formatearNumero(a.monto)))])]),e("div",{staticClass:"transaccion-mini-hora"},[t._v(t._s(t.formatearHora(a.timestamp)))]),e("div",{staticClass:"transaccion-mini-acciones"},[e("button",{staticClass:"btn-mini",on:{click:function(e){t.editarTransaccion(t.obtenerIndiceTransaccion(a))}}},[t._v("Editar")]),e("button",{staticClass:"btn-mini btn-mini-eliminar",on:{click:function(e){t.eliminarTransaccion(t.obtenerIndiceTransaccion(a))}}},[t._v("Eliminar")])])])})),0):e("div",{staticClass:"cliente-vacio"},[e("button",{staticClass:"btn-agregar-mini cliente-ozuna",on:{click:function(e){t.nuevaTransaccion.cliente="ozuna",t.mostrarFormulario=!0}}},[t._v(" + Agregar transacción para Ozuna ")])])])]),e("div",{staticClass:"cambiar-vista"},[e("button",{staticClass:"btn-cambiar-vista",on:{click:function(e){t.mostrarVistaLista=!t.mostrarVistaLista}}},[t._v(" Ver lista completa ")])])]),t.transaccionesDia.length>0&&t.mostrarVistaLista&&!t.mostrarFormulario?e("div",{staticClass:"lista-transacciones"},[t._l(t.transaccionesDia,(function(a,o){return e("div",{key:o,staticClass:"transaccion-item",class:"tipo-"+a.tipo},[e("div",{staticClass:"transaccion-header"},[e("div",{staticClass:"transaccion-tipo"},[t._v(t._s(t.obtenerTipoTexto(a.tipo)))]),e("div",{staticClass:"transaccion-monto"},[t._v("$"+t._s(t.formatearNumero(a.monto)))])]),e("div",{staticClass:"transaccion-cliente"},[t._v("Cliente: "+t._s(t.obtenerClienteTexto(a.cliente)))]),e("div",{staticClass:"transaccion-descripcion"},[t._v(t._s(a.descripcion))]),e("div",{staticClass:"transaccion-hora"},[t._v(t._s(t.formatearHora(a.timestamp)))]),e("div",{staticClass:"transaccion-acciones"},[e("button",{staticClass:"btn-editar",on:{click:function(e){return t.editarTransaccion(o)}}},[t._v("Editar")]),e("button",{staticClass:"btn-eliminar",on:{click:function(e){return t.eliminarTransaccion(o)}}},[t._v("Eliminar")])])])})),e("div",{staticClass:"cambiar-vista"},[e("button",{staticClass:"btn-cambiar-vista",on:{click:function(e){t.mostrarVistaLista=!t.mostrarVistaLista}}},[t._v(" Ver agrupado por cliente ")])])],2):t._e()]):t._e()])]):t._e()},ae=[],oe={name:"TransaccionesAgendaModal",props:{mostrar:{type:Boolean,required:!0},cliente:{type:String,required:!0}},data(){return{mesActual:(new Date).getMonth(),anioActual:(new Date).getFullYear(),diasSemana:["Dom","Lun","Mar","Mié","Jue","Vie","Sáb"],meses:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],diaSeleccionado:null,mostrarFormulario:!1,mostrarVistaLista:!1,transacciones:[],nuevaTransaccion:{tipo:"deposito",monto:"",descripcion:"",timestamp:null,cliente:""},editandoIndex:-1}},computed:{nombreMes(){return this.meses[this.mesActual]},diasCalendario(){const t=[],e=new Date(this.anioActual,this.mesActual,1),a=new Date(this.anioActual,this.mesActual+1,0),o=new Date,i=e.getDay();if(i>0){const e=new Date(this.anioActual,this.mesActual,0);for(let a=i-1;a>=0;a--){const i=e.getDate()-a,s=new Date(this.anioActual,this.mesActual-1,i);t.push({numero:i,fecha:s,esMesActual:!1,esHoy:this.esMismaFecha(s,o)})}}for(let r=1;r<=a.getDate();r++){const e=new Date(this.anioActual,this.mesActual,r);t.push({numero:r,fecha:e,esMesActual:!0,esHoy:this.esMismaFecha(e,o)})}const s=42-t.length;for(let r=1;r<=s;r++){const e=new Date(this.anioActual,this.mesActual+1,r);t.push({numero:r,fecha:e,esMesActual:!1,esHoy:this.esMismaFecha(e,o)})}return t},transaccionesDia(){return this.diaSeleccionado?this.transacciones.filter(t=>this.esMismaFecha(new Date(t.timestamp),this.diaSeleccionado.fecha)):[]},formatoFechaCompleta(){if(!this.diaSeleccionado)return"";const t={weekday:"long",year:"numeric",month:"long",day:"numeric"};return this.diaSeleccionado.fecha.toLocaleDateString("es-ES",t)},esFormularioValido(){return this.nuevaTransaccion.tipo&&this.nuevaTransaccion.monto>0&&this.nuevaTransaccion.cliente},clientesAgrupados(){if(!this.diaSeleccionado)return{};const t={otilio:[],joselito:[],catarro:[],ozuna:[],mexico:[]};return this.transaccionesDia.forEach(e=>{e.cliente&&t[e.cliente]&&t[e.cliente].push(e)}),t}},methods:{cambiarMes(t){let e=this.mesActual+t;e>11?(this.mesActual=0,this.anioActual++):e<0?(this.mesActual=11,this.anioActual--):this.mesActual=e,this.cargarTransacciones()},seleccionarDia(t){this.diaSeleccionado=t,this.mostrarFormulario=!1},esMismaFecha(t,e){return t.getDate()===e.getDate()&&t.getMonth()===e.getMonth()&&t.getFullYear()===e.getFullYear()},esDiaSeleccionado(t){return!!this.diaSeleccionado&&this.esMismaFecha(t,this.diaSeleccionado.fecha)},tieneRegistros(t){return this.transacciones.some(e=>this.esMismaFecha(new Date(e.timestamp),t))},formatearNumero(t){return t.toLocaleString("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2})},formatearHora(t){const e=new Date(t);return e.toLocaleTimeString("es-MX",{hour:"2-digit",minute:"2-digit"})},obtenerTipoTexto(t){const e={deposito:"Depósito",transferencia:"Transferencia",efectivo:"Efectivo",otro:"Otro"};return e[t]||"Otro"},obtenerClienteTexto(t){const e={mexico:"México",ozuna:"Ozuna",catarro:"Catarro",joselito:"Joselito",otilio:"Otilio"};return e[t]||t},cancelarFormulario(){this.mostrarFormulario=!1,this.nuevaTransaccion={tipo:"deposito",monto:"",descripcion:"",timestamp:null,cliente:""},this.editandoIndex=-1},async guardarTransaccion(){if(this.esFormularioValido)try{const t={...this.nuevaTransaccion,monto:parseFloat(this.nuevaTransaccion.monto),timestamp:this.nuevaTransaccion.timestamp||(new Date).toISOString(),fecha:this.diaSeleccionado.fecha.toISOString().split("T")[0]};if(this.editandoIndex>=0){const e=this.transaccionesDia[this.editandoIndex].id,a=Object(et["e"])(P["a"],"transacciones",e);await Object(et["o"])(a,t),this.transacciones=this.transacciones.map(a=>a.id===e?{...t,id:e}:a)}else{const e=await Object(et["b"])(Object(et["c"])(P["a"],"transacciones"),t);this.transacciones.push({...t,id:e.id})}this.cancelarFormulario()}catch(t){console.error("Error al guardar la transacción:",t),alert("Ocurrió un error al guardar la transacción. Por favor intenta de nuevo.")}},editarTransaccion(t){const e=this.transaccionesDia[t];this.nuevaTransaccion={tipo:e.tipo,monto:e.monto,descripcion:e.descripcion,timestamp:e.timestamp,cliente:e.cliente||this.cliente},this.editandoIndex=t,this.mostrarFormulario=!0},async eliminarTransaccion(t){if(confirm("¿Estás seguro de que deseas eliminar esta transacción?"))try{const e=this.transaccionesDia[t].id;await Object(et["d"])(Object(et["e"])(P["a"],"transacciones",e)),this.transacciones=this.transacciones.filter(t=>t.id!==e)}catch(e){console.error("Error al eliminar la transacción:",e),alert("Ocurrió un error al eliminar la transacción. Por favor intenta de nuevo.")}},async cargarTransacciones(){try{const t=new Date(this.anioActual,this.mesActual,1),e=new Date(this.anioActual,this.mesActual+1,0),a=t.toISOString().split("T")[0],o=e.toISOString().split("T")[0],i=Object(et["l"])(Object(et["c"])(P["a"],"transacciones"),Object(et["p"])("fecha",">=",a),Object(et["p"])("fecha","<=",o)),s=await Object(et["g"])(i);this.transacciones=[],s.forEach(t=>{this.transacciones.push({id:t.id,...t.data()})})}catch(t){console.error("Error al cargar las transacciones:",t)}},calcularTotalCliente(t){return this.clientesAgrupados[t]?this.clientesAgrupados[t].reduce((t,e)=>t+(parseFloat(e.monto)||0),0):0},calcularTotalPorTipo(t,e){return this.clientesAgrupados[t]?this.clientesAgrupados[t].filter(t=>t.tipo===e).reduce((t,e)=>t+(parseFloat(e.monto)||0),0):0},obtenerIndiceTransaccion(t){return this.transaccionesDia.findIndex(e=>e.id===t.id)},calcularTotalDia(){return this.transaccionesDia.reduce((t,e)=>t+(parseFloat(e.monto)||0),0)},calcularTotalDiaPorTipo(t){return this.transaccionesDia.filter(e=>e.tipo===t).reduce((t,e)=>t+(parseFloat(e.monto)||0),0)}},watch:{mostrar(t){t&&(this.mesActual=(new Date).getMonth(),this.anioActual=(new Date).getFullYear(),this.diaSeleccionado={fecha:new Date,numero:(new Date).getDate(),esMesActual:!0,esHoy:!0},this.cargarTransacciones())},cliente(t){this.mostrar&&(this.nuevaTransaccion.cliente=t,this.cargarTransacciones())}},created(){this.nuevaTransaccion.cliente=this.cliente}},ie=oe,se=(a("3480"),Object(d["a"])(ie,ee,ae,!1,null,"6bd728d4",null)),re=se.exports,ne={name:"CuentasMexico",components:{TransaccionesAgendaModal:re},data(){return{mostrarModalAgenda:!1,clienteSeleccionado:"mexico"}},methods:{abrirAgenda(){this.mostrarModalAgenda=!0},cerrarModalAgenda(){this.mostrarModalAgenda=!1}}},ce=ne,le=(a("1a24"),Object(d["a"])(ce,Zt,te,!1,null,"3cf7ac87",null)),de=le.exports,ue=function(){var t=this,e=t._self._c;return e("div",{staticClass:"ozuna-cuentas-menu-container"},[e("h1",[t._v("Menú de Cuentas Ozuna")]),e("div",{staticClass:"actions-container"},[e("router-link",{staticClass:"action-button back-btn",attrs:{to:"/cuentas-mexico"}},[t._v(" Cuentas México ")]),e("router-link",{staticClass:"action-button new-cuenta-btn",attrs:{to:"/cuentas-ozuna/nueva"}},[t._v(" Nueva Cuenta ")])],1),e("div",{staticClass:"cuentas-list"},[e("h2",[t._v("Registros de Cuentas")]),t.isLoading?e("div",{staticClass:"loading"},[t._v("Cargando registros...")]):0===t.cuentas.length?e("div",{staticClass:"no-records"},[t._v(" No hay registros de cuentas. ")]):e("ul",t._l(t.cuentas,(function(a){return e("li",{key:a.id,staticClass:"cuenta-item"},[e("div",{staticClass:"cuenta-content"},[e("span",{staticClass:"cuenta-date"},[t._v(t._s(t.formatDate(a.fecha)))]),e("p",{staticClass:"cuenta-summary"},[e("span",[t._v("Saldo Hoy: $"+t._s(t.formatNumber(a.saldoHoy)))]),e("span",[t._v("Total Acumulado: $"+t._s(t.formatNumber(a.totalNota)))]),a.totalAbonos>0?e("span",{staticClass:"abono-indicator"},[t._v(" Abono: $"+t._s(t.formatNumber(a.totalAbonos))+" ")]):t._e(),a.totalCobros>0?e("span",{staticClass:"cobro-indicator"},[t._v(" Cobro: $"+t._s(t.formatNumber(a.totalCobros))+" ")]):t._e()])]),e("div",{staticClass:"cuenta-actions"},[e("button",{staticClass:"edit-btn",on:{click:function(e){return t.editarCuenta(a.id)}}},[t._v("Editar")]),e("button",{staticClass:"delete-btn",on:{click:function(e){return t.borrarCuenta(a.id)}}},[t._v("Borrar")])])])})),0)])])},me=[],pe={name:"OzunaCuentasMenu",data(){return{cuentas:[],isLoading:!0}},methods:{async loadCuentas(){try{this.isLoading=!0;const t=Object(et["c"])(P["a"],"cuentasOzuna"),e=Object(et["l"])(t,Object(et["k"])("fecha","desc")),a=await Object(et["g"])(e);this.cuentas=a.docs.map(t=>{const e=t.data(),a=(e.abonos||[]).reduce((t,e)=>t+(e.monto||0),0),o=(e.cobros||[]).reduce((t,e)=>t+(e.monto||0),0);return{id:t.id,fecha:e.fecha,saldoHoy:e.totalGeneral||0,totalNota:e.totalSaldo||0,totalAbonos:a,totalCobros:o}}),console.log("Cuentas cargadas:",this.cuentas)}catch(t){console.error("Error al cargar cuentas: ",t),this.cuentas=[]}finally{this.isLoading=!1}},formatDate(t){const e=new Date(t);return e.setMinutes(e.getMinutes()+e.getTimezoneOffset()),e.toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"})},formatNumber(t){return t.toLocaleString("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2})},editarCuenta(t){this.$router.push(`/cuentas-ozuna/${t}?edit=true`)},async borrarCuenta(t){if(confirm("¿Estás seguro de que quieres borrar este registro de cuenta?"))try{await Object(et["d"])(Object(et["e"])(P["a"],"cuentasOzuna",t)),this.cuentas=this.cuentas.filter(e=>e.id!==t),alert("Registro de cuenta borrado con éxito"),this.loadCuentas()}catch(e){console.error("Error al borrar el registro de cuenta: ",e),alert("Error al borrar el registro de cuenta")}}},mounted(){this.loadCuentas()}},he=pe,ve=(a("bee8"),Object(d["a"])(he,ue,me,!1,null,"0777a32c",null)),be=ve.exports,fe=function(){var t=this,e=t._self._c;return e("div",{staticClass:"cuentas-ozuna-container"},[e("div",{staticClass:"back-button-container"},[e("BackButton",{attrs:{to:"/cuentas-ozuna"}})],1),e("h1",[t._v("Cuentas Ozuna")]),e("div",{staticClass:"fecha-actual"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.fechaSeleccionada,expression:"fechaSeleccionada"}],attrs:{type:"date"},domProps:{value:t.fechaSeleccionada},on:{input:function(e){e.target.composing||(t.fechaSeleccionada=e.target.value)}}}),e("span",[t._v(t._s(t.fechaFormateada))])]),e("div",{staticClass:"input-section"},[e("h2",[t._v("Ingresar Datos")]),e("div",{staticClass:"input-row"},[e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.newItem.kilos,expression:"newItem.kilos",modifiers:{number:!0}}],attrs:{type:"number",placeholder:"Kilos"},domProps:{value:t.newItem.kilos},on:{input:function(e){e.target.composing||t.$set(t.newItem,"kilos",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),e("input",{directives:[{name:"model",rawName:"v-model",value:t.newItem.medida,expression:"newItem.medida"}],attrs:{type:"text",placeholder:"Medida"},domProps:{value:t.newItem.medida},on:{input:function(e){e.target.composing||t.$set(t.newItem,"medida",e.target.value)}}}),e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.newItem.costo,expression:"newItem.costo",modifiers:{number:!0}}],attrs:{type:"number",placeholder:"Costo"},domProps:{value:t.newItem.costo},on:{input:function(e){e.target.composing||t.$set(t.newItem,"costo",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),e("button",{on:{click:t.addItem}},[t._v("Agregar")])])]),e("table",{staticClass:"tabla-principal"},[t._m(0),e("tbody",t._l(t.items,(function(a,o){return e("tr",{key:o},[e("td",{on:{click:function(e){return t.editarItem(o,"kilos")}}},[a.editando&&"kilos"===a.campoEditando?e("input",{directives:[{name:"model",rawName:"v-model.number",value:a.kilos,expression:"item.kilos",modifiers:{number:!0}}],attrs:{type:"number"},domProps:{value:a.kilos},on:{blur:[function(e){return t.finalizarEdicion(o)},function(e){return t.$forceUpdate()}],input:function(e){e.target.composing||t.$set(a,"kilos",t._n(e.target.value))}}}):e("span",[t._v(t._s(t.formatNumber(a.kilos)))])]),e("td",{on:{click:function(e){return t.editarItem(o,"medida")}}},[a.editando&&"medida"===a.campoEditando?e("input",{directives:[{name:"model",rawName:"v-model",value:a.medida,expression:"item.medida"}],attrs:{type:"text"},domProps:{value:a.medida},on:{blur:function(e){return t.finalizarEdicion(o)},input:function(e){e.target.composing||t.$set(a,"medida",e.target.value)}}}):e("span",[t._v(t._s(a.medida))])]),e("td",{on:{click:function(e){return t.editarItem(o,"costo")}}},[a.editando&&"costo"===a.campoEditando?e("input",{directives:[{name:"model",rawName:"v-model.number",value:a.costo,expression:"item.costo",modifiers:{number:!0}}],attrs:{type:"number"},domProps:{value:a.costo},on:{blur:[function(e){return t.finalizarEdicion(o)},function(e){return t.$forceUpdate()}],input:function(e){e.target.composing||t.$set(a,"costo",t._n(e.target.value))}}}):e("span",[t._v("$"+t._s(t.formatNumber(a.costo)))])]),e("td",[t._v("$"+t._s(t.formatNumber(a.total)))]),e("td",{staticClass:"action-column"},[e("button",{staticClass:"delete-btn",on:{click:function(e){return t.removeItem(o)}}},[t._v("Eliminar")])])])})),0),e("tfoot",[e("tr",[e("td",{attrs:{colspan:"3"}}),e("td",[t._v("$"+t._s(t.formatNumber(t.totalGeneral)))]),e("td")])])]),e("h2",[t._v("Saldo pendiente")]),e("div",{staticClass:"saldo-pendiente"},[e("div",{staticClass:"input-row"},[e("span",[t._v("Saldo Acumulado Anterior: $"+t._s(t.formatNumber(t.saldoAcumuladoAnterior)))])]),t._l(t.cobros,(function(a,o){return e("div",{key:o,staticClass:"input-row"},[e("input",{directives:[{name:"model",rawName:"v-model",value:a.descripcion,expression:"cobro.descripcion"}],attrs:{type:"text",placeholder:"Descripción"},domProps:{value:a.descripcion},on:{input:function(e){e.target.composing||t.$set(a,"descripcion",e.target.value)}}}),e("input",{directives:[{name:"model",rawName:"v-model.number",value:a.monto,expression:"cobro.monto",modifiers:{number:!0}}],attrs:{type:"number",placeholder:"Monto"},domProps:{value:a.monto},on:{input:function(e){e.target.composing||t.$set(a,"monto",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),e("button",{staticClass:"delete-btn",on:{click:function(e){return t.removeCobro(o)}}},[t._v("Eliminar")])])})),e("button",{staticClass:"add-btn",on:{click:t.addCobro}},[t._v("Agregar Cobro")])],2),e("h2",[t._v("Abonos")]),e("div",{staticClass:"abonos"},[t._l(t.abonos,(function(a,o){return e("div",{key:o,staticClass:"input-row"},[e("input",{directives:[{name:"model",rawName:"v-model",value:a.descripcion,expression:"abono.descripcion"}],attrs:{type:"text",placeholder:"Descripción"},domProps:{value:a.descripcion},on:{input:function(e){e.target.composing||t.$set(a,"descripcion",e.target.value)}}}),e("input",{directives:[{name:"model",rawName:"v-model.number",value:a.monto,expression:"abono.monto",modifiers:{number:!0}}],attrs:{type:"number",placeholder:"Monto"},domProps:{value:a.monto},on:{input:function(e){e.target.composing||t.$set(a,"monto",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),e("button",{staticClass:"delete-btn",on:{click:function(e){return t.removeAbono(o)}}},[t._v("Eliminar")])])})),e("button",{staticClass:"add-btn",on:{click:t.addAbono}},[t._v("Agregar Abono")])],2),e("table",{staticClass:"tabla-saldo"},[e("tr",[e("td",[t._v("Saldo Acumulado Anterior")]),e("td",[t._v("$"+t._s(t.formatNumber(t.saldoAcumuladoAnterior)))])]),e("tr",[e("td",[t._v("Saldo Hoy")]),e("td",[t._v("$"+t._s(t.formatNumber(t.totalGeneral)))])]),t._l(t.cobros,(function(a,o){return e("tr",{key:o},[e("td",[t._v(t._s(a.descripcion))]),e("td",[t._v("$"+t._s(t.formatNumber(a.monto)))])])})),t._l(t.abonos,(function(a,o){return e("tr",{key:"abono-"+o},[e("td",[t._v(t._s(a.descripcion)+" (Abono)")]),e("td",[t._v("-$"+t._s(t.formatNumber(a.monto)))])])})),e("tr",{staticClass:"total"},[e("td",[t._v("Total")]),e("td",[t._v("$"+t._s(t.formatNumber(t.totalSaldo)))])]),e("tr",{staticClass:"total"},[e("td",[t._v("Nuevo Saldo Acumulado")]),e("td",[t._v("$"+t._s(t.formatNumber(t.nuevoSaldoAcumulado)))])])],2),e("div",{staticClass:"button-container"},[e("button",{staticClass:"save-button",on:{click:t.guardarNota}},[t._v("Guardar Nota")]),e("button",{staticClass:"print-button",on:{click:t.imprimirTablas}},[t._v("Imprimir")])]),t.showMobileActions?e("div",{staticClass:"mobile-actions-modal"},[e("button",{on:{click:function(e){return t.editItem(t.selectedItemIndex)}}},[t._v("Editar")]),e("button",{on:{click:function(e){return t.removeItem(t.selectedItemIndex)}}},[t._v("Eliminar")]),e("button",{on:{click:t.cancelMobileActions}},[t._v("Cancelar")])]):t._e()])},ge=[function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",[t._v("Kilos")]),e("th",[t._v("Medida")]),e("th",[t._v("Costo")]),e("th",[t._v("Total")]),e("th",[t._v("Acciones")])])])}],Ce={name:"CuentasOzuna",components:{BackButton:dt["a"]},data(){return{items:[],newItem:{kilos:null,medida:"",costo:null},saldoAcumuladoAnterior:0,cobros:[],abonos:[],fechaSeleccionada:this.obtenerFechaActual(),showMobileActions:!1,selectedItemIndex:null,presionTimer:null}},computed:{fechaFormateada(){const t=new Date(this.fechaSeleccionada+"T00:00:00"),e={year:"numeric",month:"long",day:"numeric"};return t.toLocaleDateString("es-ES",e)},totalGeneral(){return this.items.reduce((t,e)=>t+e.total,0)},totalSaldo(){const t=this.cobros.reduce((t,e)=>t+(e.monto||0),0),e=this.abonos.reduce((t,e)=>t+(e.monto||0),0);return this.saldoAcumuladoAnterior+this.totalGeneral+t-e},nuevoSaldoAcumulado(){return this.totalSaldo}},watch:{fechaSeleccionada:{handler:"loadSaldoAcumuladoAnterior",immediate:!0}},async mounted(){console.log("Mounted ejecutado",this.$route.params,this.$route.query);const t=this.$route.params.id,e="true"===this.$route.query.edit;t&&e?(console.log("Iniciando carga de cuenta existente"),await this.loadExistingCuenta(t)):(console.log("Cargando saldo acumulado anterior para nueva cuenta"),await this.loadSaldoAcumuladoAnterior())},methods:{async loadExistingCuenta(t){try{console.log("Cargando cuenta con ID:",t);const e=Object(et["e"])(P["a"],"cuentasOzuna",t),a=await Object(et["f"])(e);if(a.exists()){const t=a.data();console.log("Datos de la cuenta cargados:",t),this.$nextTick(()=>{this.items=t.items||[],this.saldoAcumuladoAnterior=t.saldoAcumuladoAnterior||0,this.cobros=t.cobros||[],this.abonos=t.abonos||[],this.fechaSeleccionada=t.fecha||this.obtenerFechaActual(),console.log("Estado actualizado con $nextTick:",{items:this.items,saldoAcumuladoAnterior:this.saldoAcumuladoAnterior,cobros:this.cobros,abonos:this.abonos,fechaSeleccionada:this.fechaSeleccionada})})}else console.error("No se encontró la cuenta con el ID proporcionado")}catch(e){console.error("Error al cargar la cuenta existente: ",e)}},async loadSaldoAcumuladoAnterior(){try{const t=Object(et["c"])(P["a"],"cuentasOzuna"),e=Object(et["l"])(t,Object(et["p"])("fecha","<",this.fechaSeleccionada),Object(et["k"])("fecha","asc")),a=await Object(et["g"])(e);let o=0;a.forEach(t=>{const e=t.data(),a=e.totalGeneral||0,i=(e.cobros||[]).reduce((t,e)=>t+(e.monto||0),0),s=(e.abonos||[]).reduce((t,e)=>t+(e.monto||0),0);o+=a+i-s}),this.saldoAcumuladoAnterior=o,console.log("Saldo acumulado anterior calculado:",this.saldoAcumuladoAnterior)}catch(t){console.error("Error al calcular el saldo acumulado anterior:",t),this.saldoAcumuladoAnterior=0}},formatNumber(t){return t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})},addItem(){if(this.newItem.kilos&&this.newItem.medida&&this.newItem.costo){const t=this.newItem.kilos*this.newItem.costo;this.items.push({...this.newItem,total:t}),this.newItem={kilos:null,medida:"",costo:null}}},removeItem(t){this.items.splice(t,1),this.showMobileActions=!1},addCobro(){this.cobros.push({descripcion:"",monto:0})},removeCobro(t){this.cobros.splice(t,1)},addAbono(){this.abonos.push({descripcion:"",monto:0})},removeAbono(t){this.abonos.splice(t,1)},obtenerFechaActual(){const t=new Date;return t.getFullYear()+"-"+String(t.getMonth()+1).padStart(2,"0")+"-"+String(t.getDate()).padStart(2,"0")},async guardarNota(){try{const t={fecha:this.fechaSeleccionada,items:this.items,saldoAcumuladoAnterior:this.saldoAcumuladoAnterior,cobros:this.cobros,abonos:this.abonos,totalGeneral:this.totalGeneral,totalSaldo:this.totalSaldo,nuevoSaldoAcumulado:this.nuevoSaldoAcumulado};console.log("Datos a guardar:",t);const e=Object(et["c"])(P["a"],"cuentasOzuna"),a=Object(et["l"])(e,Object(et["p"])("fecha","==",this.fechaSeleccionada)),o=await Object(et["g"])(a);if(o.empty)await Object(et["b"])(Object(et["c"])(P["a"],"cuentasOzuna"),t),console.log("Nueva cuenta guardada exitosamente");else{const e=o.docs[0].id;await Object(et["o"])(Object(et["e"])(P["a"],"cuentasOzuna",e),t),console.log("Cuenta actualizada exitosamente")}alert("Cuenta guardada exitosamente"),this.$router.push("/cuentas-ozuna")}catch(t){console.error("Error al guardar la cuenta:",t),alert("Error al guardar la cuenta")}},iniciarPresion(t){this.presionTimer=setTimeout(()=>{this.showMobileActionsModal(t)},500)},finalizarPresion(){clearTimeout(this.presionTimer)},showMobileActionsModal(t){this.selectedItemIndex=t,this.showMobileActions=!0},cancelMobileActions(){this.showMobileActions=!1,this.selectedItemIndex=null},editItem(t){console.log("Editar item:",t),this.showMobileActions=!1},imprimirTablas(){const t=`\n        <html>\n          <head>\n            <title>Cuentas Ozuna - ${this.fechaFormateada}</title>\n            <style>\n              body {\n                font-family: Arial, sans-serif;\n                font-size: 20pt;\n                line-height: 1.6;\n                max-width: 800px;\n                margin: 0 auto;\n                padding: 20px;\n                text-align: center;\n              }\n              h1 { font-size: 30pt; margin-bottom: 20px; }\n              h2 { font-size: 27pt; margin-top: 30px; margin-bottom: 15px; }\n              table {\n                width: 100%;\n                border-collapse: collapse;\n                margin-bottom: 30px;\n                font-size: 20pt;\n              }\n              th, td {\n                border: 1px solid #ddd;\n                padding: 10px;\n                text-align: left;\n              }\n              th { background-color: #f2f2f2; font-weight: bold; }\n              .total { font-weight: bold; }\n              .total td:first-child { text-align: right; }\n              @media print {\n                body { font-size: 20pt; }\n                h1 { font-size: 25pt; }\n                h2 { font-size: 25pt; }\n                table { font-size: 20pt; }\n              }\n            </style>\n          </head>\n          <body>\n            <h1>Cuentas Ozuna - ${this.fechaFormateada}</h1>\n            \n            <h2>Detalles de la cuenta</h2>\n            <table>\n              <thead>\n                <tr>\n                  <th>Kilos</th>\n                  <th>Medida</th>\n                  <th>Costo</th>\n                  <th>Total</th>\n                </tr>\n              </thead>\n              <tbody>\n                ${this.items.map(t=>`\n                  <tr>\n                    <td>${this.formatNumber(t.kilos)}</td>\n                    <td>${t.medida}</td>\n                    <td>$${this.formatNumber(t.costo)}</td>\n                    <td>$${this.formatNumber(t.total)}</td>\n                  </tr>\n                `).join("")}\n              </tbody>\n              <tfoot>\n                <tr class="total">\n                  <td colspan="3">Total</td>\n                  <td>$${this.formatNumber(this.totalGeneral)}</td>\n                </tr>\n              </tfoot>\n            </table>\n\n            <h2>Resumen de saldo</h2>\n            <table>\n              <tr>\n                <td>Saldo Anterior</td>\n                <td>$${this.formatNumber(this.saldoAcumuladoAnterior)}</td>\n              </tr>\n              <tr>\n                <td>Saldo Hoy</td>\n                <td>$${this.formatNumber(this.totalGeneral)}</td>\n              </tr>\n              ${this.cobros.map(t=>`\n                <tr>\n                  <td>${t.descripcion}</td>\n                  <td>$${this.formatNumber(t.monto)}</td>\n                </tr>\n              `).join("")}\n              ${this.abonos.map(t=>`\n                <tr>\n                  <td>${t.descripcion} (Abono)</td>\n                  <td>-$${this.formatNumber(t.monto)}</td>\n                </tr>\n              `).join("")}\n              <tr class="total">\n                <td>Total</td>\n                <td>$${this.formatNumber(this.totalSaldo)}</td>\n              </tr>\n            </table>\n          </body>\n        </html>\n      `,e=window.open("","_blank");e.document.write(t),e.document.close(),e.print()},editarItem(t,e){this.$set(this.items[t],"editando",!0),this.$set(this.items[t],"campoEditando",e),this.$nextTick(()=>{const a=this.$el.querySelector(`tr:nth-child(${t+1}) td:nth-child(${this.getCampoIndex(e)}) input`);a&&a.focus()})},finalizarEdicion(t){const e=this.items[t];e.editando=!1,e.campoEditando=null,e.total=e.kilos*e.costo,this.$set(this.items,t,e)},getCampoIndex(t){const e=["kilos","medida","costo"];return e.indexOf(t)+1}}},_e=Ce,ye=(a("ba37"),Object(d["a"])(_e,fe,ge,!1,null,"3ab07185",null)),we=ye.exports,ke=function(){var t=this,e=t._self._c;return e("div",{staticClass:"catarro-cuentas-menu-container"},[e("h1",[t._v("Menú de Cuentas Catarro")]),e("div",{staticClass:"actions-container"},[e("router-link",{staticClass:"action-button back-btn",attrs:{to:"/cuentas-mexico"}},[t._v(" Cuentas México ")]),e("router-link",{staticClass:"action-button new-cuenta-btn",attrs:{to:"/cuentas-catarro/nueva"}},[t._v(" Nueva Cuenta ")]),e("router-link",{staticClass:"action-button ventas-ganancias-btn",attrs:{to:"/ventas-ganancias-catarro"}},[t._v(" Ventas y Ganancias ")]),e("PreciosHistorialModal"),e("StashModal",{attrs:{cliente:"catarro"}})],1),e("div",{staticClass:"filter-container"},[e("label",{attrs:{for:"filter-select"}},[t._v("Filtrar por estado:")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.filtroEstado,expression:"filtroEstado"}],attrs:{id:"filter-select"},on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.filtroEstado=e.target.multiple?a:a[0]}}},[e("option",{attrs:{value:"todas"}},[t._v("Todas")]),e("option",{attrs:{value:"pagadas"}},[t._v("Pagadas")]),e("option",{attrs:{value:"no-pagadas"}},[t._v("No Pagadas")])])]),e("div",{staticClass:"cuentas-list"},[e("h2",[t._v("Registros de Cuentas")]),t.isLoading?e("div",{staticClass:"loading"},[t._v("Cargando registros...")]):0===t.cuentasFiltradas.length?e("div",{staticClass:"no-records"},[t._v(" No hay registros de cuentas que coincidan con el filtro. ")]):e("ul",t._l(t.cuentasFiltradas,(function(a){return e("li",{key:a.id,staticClass:"cuenta-item",class:{"tiene-observacion":a.tieneObservacion}},[e("div",{staticClass:"cuenta-content"},[e("span",{staticClass:"cuenta-date"},[t._v(t._s(t.formatDate(a.fecha)))]),e("p",{staticClass:"cuenta-summary"},[e("span",[t._v("Saldo Hoy: $"+t._s(t.formatNumber(a.saldoHoy)))]),e("span",[t._v("Total Acumulado: $"+t._s(t.formatNumber(a.totalNota)))])]),a.tieneObservacion?e("div",{staticClass:"observacion-container"},[e("p",{staticClass:"observacion-texto"},[t._v(t._s(a.observacion))]),e("button",{staticClass:"delete-observacion-btn",attrs:{title:"Borrar observación"},on:{click:function(e){return t.borrarObservacion(a.id)}}},[t._v("×")])]):t._e(),a.abonos&&a.abonos.length>0?e("div",{staticClass:"abonos-info"},t._l(a.abonos,(function(a,o){return e("p",{key:o,staticClass:"abono-detail"},[e("span",{staticClass:"abono-label"},[t._v("Abono:")]),e("span",{staticClass:"abono-monto"},[t._v("$"+t._s(t.formatNumber(a.monto)))]),e("span",{staticClass:"abono-descripcion"},[t._v(t._s(a.descripcion||"Sin descripción"))])])})),0):t._e(),e("span",{class:["estado-cuenta",a.estadoPagado?"pagado":"no-pagado"]},[t._v(" "+t._s(a.estadoPagado?"Pagado":"No Pagado")+" ")])]),e("div",{staticClass:"cuenta-actions"},[e("button",{staticClass:"edit-btn",on:{click:function(e){return t.editarCuenta(a.id)}}},[t._v("Editar")]),e("button",{staticClass:"delete-btn",on:{click:function(e){return t.borrarCuenta(a.id)}}},[t._v("Borrar")])])])})),0)])])},Ae=[],Pe=function(){var t,e=this,a=e._self._c;return a("div",[a("button",{staticClass:"precio-historial-btn",on:{click:function(t){e.showModal=!0}}},[e._v(" Precios de Venta ")]),e.showModal?a("div",{staticClass:"modal-overlay"},[a("div",{staticClass:"modal-content"},[a("div",{staticClass:"modal-header"},[a("h2",[e._v("Precios de Venta")]),a("button",{staticClass:"close-btn",on:{click:function(t){e.showModal=!1}}},[e._v("×")])]),a("div",{staticClass:"add-price-form"},[a("h3",[e._v("Agregar Nuevo Precio")]),a("div",{staticClass:"form-group"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.newPrice.producto,expression:"newPrice.producto"}],attrs:{type:"text",placeholder:"Producto/Medida",list:"productos"},domProps:{value:e.newPrice.producto},on:{input:function(t){t.target.composing||e.$set(e.newPrice,"producto",t.target.value)}}}),a("datalist",{attrs:{id:"productos"}},e._l(e.preciosActuales,(function(t){return a("option",{key:t.id,domProps:{value:t.producto}})})),0),a("input",{directives:[{name:"model",rawName:"v-model.number",value:e.newPrice.precio,expression:"newPrice.precio",modifiers:{number:!0}}],attrs:{type:"number",placeholder:"Precio"},domProps:{value:e.newPrice.precio},on:{input:function(t){t.target.composing||e.$set(e.newPrice,"precio",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}}),a("input",{directives:[{name:"model",rawName:"v-model",value:e.newPrice.fecha,expression:"newPrice.fecha"}],attrs:{type:"date",max:e.currentDate},domProps:{value:e.newPrice.fecha},on:{input:function(t){t.target.composing||e.$set(e.newPrice,"fecha",t.target.value)}}}),a("button",{staticClass:"add-btn",on:{click:e.agregarPrecio}},[e._v("Agregar")])])]),a("div",{staticClass:"current-prices"},[a("h3",[e._v("Precios Actuales")]),e._l(e.categorias,(function(t){return a("div",{key:t,staticClass:"categoria-section"},[a("h4",{staticClass:"categoria-title"},[e._v(e._s(t))]),a("div",{staticClass:"products-grid"},e._l(e.preciosOrdenados[t],(function(t){return a("div",{key:t.id,staticClass:"product-card"},[a("h4",[e._v(e._s(t.producto))]),a("p",{staticClass:"price"},[e._v("$"+e._s(e.formatNumber(t.precio)))]),a("p",{staticClass:"date"},[e._v("Desde: "+e._s(e.formatDate(t.fecha)))]),a("p",{staticClass:"historial-count"},[e._v(" "+e._s(t.historial.length)+" precio"+e._s(1!==t.historial.length?"s":"")+" registrado"+e._s(1!==t.historial.length?"s":"")+" ")]),a("button",{staticClass:"history-btn",on:{click:function(a){return e.mostrarHistorial(t)}}},[e._v(" Ver Historial ")])])})),0)])}))],2),e.showHistorialModal?a("div",{staticClass:"historial-modal"},[a("div",{staticClass:"historial-content"},[a("div",{staticClass:"historial-header"},[a("h3",[e._v("Historial de Precios - "+e._s(null===(t=e.productoSeleccionado)||void 0===t?void 0:t.producto))]),a("button",{staticClass:"close-btn",on:{click:function(t){e.showHistorialModal=!1}}},[e._v("×")])]),a("table",[e._m(0),a("tbody",e._l(e.historialPrecios,(function(t,o){return a("tr",{key:o},[a("td",[e._v(e._s(e.formatDate(t.fecha)))]),a("td",[e._v("$"+e._s(e.formatNumber(t.precio)))]),a("td",[o<e.historialPrecios.length-1?a("span",{class:{"precio-subio":t.precio<e.historialPrecios[o+1].precio,"precio-bajo":t.precio>e.historialPrecios[o+1].precio}},[e._v(" "+e._s(e.calcularCambio(t.precio,e.historialPrecios[o+1].precio))+" ")]):e._e()]),a("td",{staticClass:"actions-cell"},[a("button",{staticClass:"delete-btn",attrs:{title:"Eliminar precio"},on:{click:function(a){return e.eliminarPrecio(t)}}},[a("span",{staticClass:"delete-icon"},[e._v("×")])])])])})),0)])])]):e._e()])]):e._e()])},xe=[function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",[t._v("Fecha")]),e("th",[t._v("Precio")]),e("th",[t._v("Cambio")]),e("th",[t._v("Acciones")])])])}],Se={name:"PreciosHistorialModal",data(){return{showModal:!1,showHistorialModal:!1,preciosActuales:[],historialPrecios:[],productoSeleccionado:null,categorias:["Camarón S/C","Camarón C/C","Otros"],newPrice:{producto:"",precio:null,fecha:(new Date).toISOString().split("T")[0],categoria:"Otros"}}},computed:{currentDate(){return(new Date).toISOString().split("T")[0]},preciosOrdenados(){const t={};return this.categorias.forEach(e=>{t[e]=[]}),this.preciosActuales.forEach(e=>{const a=e.producto.toLowerCase();a.includes("s/c")||a.match(/\d+\/\d+/)?t["Camarón S/C"].push(e):a.includes("c/c")?t["Camarón C/C"].push(e):t["Otros"].push(e)}),Object.keys(t).forEach(e=>{t[e].sort((t,e)=>{const a=t=>{const e=t.match(/(\d+)\/(\d+)/);return e?[parseInt(e[1]),parseInt(e[2])]:[0,0]},o=a(t.producto),i=a(e.producto);return o[0]&&i[0]?o[0]-i[0]:t.producto.localeCompare(e.producto)})}),t}},methods:{formatNumber(t){return(null===t||void 0===t?void 0:t.toLocaleString("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2}))||"0.00"},formatDate(t){if(!t)return"";const e={year:"numeric",month:"long",day:"numeric"};return new Date(t).toLocaleDateString("es-ES",e)},calcularCambio(t,e){const a=t-e,o=a/e*100,i=a>0?"+":"";return`${i}${this.formatNumber(a)} (${i}${o.toFixed(1)}%)`},async cargarPreciosActuales(){try{const t=Object(et["c"])(P["a"],"precios"),e=Object(et["l"])(t,Object(et["k"])("fecha","desc")),a=await Object(et["g"])(e),o=new Map;a.docs.forEach(t=>{const e={id:t.id,...t.data()};o.has(e.producto)||o.set(e.producto,{producto:e.producto,precioActual:e.precio,fechaActual:e.fecha,historial:[]}),o.get(e.producto).historial.push({id:t.id,fecha:e.fecha,precio:e.precio})}),this.preciosActuales=Array.from(o.values()).map(t=>({id:t.historial[0].id,producto:t.producto,precio:t.precioActual,fecha:t.fechaActual,historial:t.historial}))}catch(t){console.error("Error al cargar precios:",t)}},async agregarPrecio(){if(this.newPrice.producto&&this.newPrice.precio&&this.newPrice.fecha)try{const t=new Date(this.newPrice.fecha);t.setDate(t.getDate()+1);const e=t.toISOString().split("T")[0],a=this.newPrice.producto.toLowerCase();let o="Otros";a.includes("s/c")||a.match(/\d+\/\d+/)?o="Camarón S/C":a.includes("c/c")&&(o="Camarón C/C"),await Object(et["b"])(Object(et["c"])(P["a"],"precios"),{producto:this.newPrice.producto,precio:this.newPrice.precio,fecha:e,categoria:o}),this.newPrice={producto:"",precio:null,fecha:(new Date).toISOString().split("T")[0],categoria:"Otros"},await this.cargarPreciosActuales()}catch(t){console.error("Error al agregar precio:",t),alert("Error al guardar el precio")}else alert("Por favor complete todos los campos")},async eliminarPrecio(t){if(confirm("¿Estás seguro de que deseas eliminar este precio?"))try{if(await Object(et["d"])(Object(et["e"])(P["a"],"precios",t.id)),await this.cargarPreciosActuales(),this.productoSeleccionado){const t=this.preciosActuales.find(t=>t.producto===this.productoSeleccionado.producto);t?this.historialPrecios=t.historial:this.showHistorialModal=!1}}catch(e){console.error("Error al eliminar precio:",e),alert("Error al eliminar el precio")}},async mostrarHistorial(t){try{this.productoSeleccionado=t,this.historialPrecios=t.historial,this.showHistorialModal=!0}catch(e){console.error("Error al cargar historial:",e),alert("Error al cargar el historial de precios")}}},mounted(){this.cargarPreciosActuales()}},Te=Se,Oe=(a("0aa6"),Object(d["a"])(Te,Pe,xe,!1,null,"24d23e4f",null)),Me=Oe.exports,Ne=function(){var t=this,e=t._self._c;return e("div",[e("button",{staticClass:"stash-button",on:{click:function(e){t.showModal=!0}}},[t._v(" Stash ")]),t.showModal?e("div",{staticClass:"modal"},[e("div",{staticClass:"modal-content"},[e("h3",[t._v("Stash de Abonos")]),e("div",{staticClass:"stash-form"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.newStash.fecha,expression:"newStash.fecha"}],staticClass:"stash-input",attrs:{type:"date"},domProps:{value:t.newStash.fecha},on:{input:function(e){e.target.composing||t.$set(t.newStash,"fecha",e.target.value)}}}),e("input",{directives:[{name:"model",rawName:"v-model",value:t.newStash.descripcion,expression:"newStash.descripcion"}],staticClass:"stash-input",attrs:{type:"text",placeholder:"Descripción"},domProps:{value:t.newStash.descripcion},on:{input:function(e){e.target.composing||t.$set(t.newStash,"descripcion",e.target.value)}}}),e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.newStash.cantidad,expression:"newStash.cantidad",modifiers:{number:!0}}],staticClass:"stash-input",attrs:{type:"number",placeholder:"Cantidad"},domProps:{value:t.newStash.cantidad},on:{input:function(e){e.target.composing||t.$set(t.newStash,"cantidad",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),e("button",{staticClass:"add-button",on:{click:t.agregarStash}},[t._v(" Agregar ")])]),e("div",{staticClass:"stash-list"},[t.stashItems.length>0?e("table",[t._m(0),e("tbody",t._l(t.stashItems,(function(a,o){return e("tr",{key:o},[e("td",[t._v(t._s(t.formatearFecha(a.fecha)))]),e("td",[t._v(t._s(a.descripcion))]),e("td",[t._v("$"+t._s(t.formatNumber(a.cantidad)))]),e("td",[e("button",{staticClass:"delete-button",on:{click:function(e){return t.eliminarStash(o)}}},[t._v(" Eliminar ")])])])})),0),e("tfoot",[e("tr",[t._m(1),e("td",{attrs:{colspan:"2"}},[e("strong",[t._v("$"+t._s(t.formatNumber(t.totalStash)))])])])])]):e("p",{staticClass:"no-items"},[t._v("No hay items en el stash")])]),e("div",{staticClass:"modal-footer"},[e("button",{staticClass:"close-button",on:{click:function(e){t.showModal=!1}}},[t._v(" Cerrar ")])])])]):t._e()])},De=[function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",[t._v("Fecha")]),e("th",[t._v("Descripción")]),e("th",[t._v("Cantidad")]),e("th",[t._v("Acciones")])])])},function(){var t=this,e=t._self._c;return e("td",{attrs:{colspan:"2"}},[e("strong",[t._v("Total:")])])}],Ee={name:"StashModal",props:{cliente:{type:String,required:!0}},setup(t){const e=Object(o["ref"])(!1),a=Object(o["ref"])([]),i=Object(o["ref"])({fecha:(new Date).toISOString().split("T")[0],descripcion:"",cantidad:null}),s=Object(o["computed"])(()=>a.value.reduce((t,e)=>t+(Number(e.cantidad)||0),0)),r=async()=>{try{const e=Object(et["l"])(Object(et["c"])(P["a"],"stash_"+t.cliente)),o=await Object(et["g"])(e);a.value=o.docs.map(t=>({id:t.id,...t.data()}))}catch(e){console.error("Error al cargar stash:",e)}},n=async()=>{if(i.value.fecha&&i.value.descripcion&&i.value.cantidad)try{const[e,o,s]=i.value.fecha.split("-").map(Number),r=`${e}-${String(o).padStart(2,"0")}-${String(s).padStart(2,"0")}`,n=await Object(et["b"])(Object(et["c"])(P["a"],"stash_"+t.cliente),{fecha:r,descripcion:i.value.descripcion,cantidad:Number(i.value.cantidad)});a.value.push({id:n.id,fecha:r,descripcion:i.value.descripcion,cantidad:Number(i.value.cantidad)}),i.value={fecha:(new Date).toISOString().split("T")[0],descripcion:"",cantidad:null}}catch(e){console.error("Error al agregar stash:",e),alert("Error al guardar el stash")}else alert("Por favor complete todos los campos")},c=async e=>{try{const o=a.value[e];await Object(et["d"])(Object(et["e"])(P["a"],"stash_"+t.cliente,o.id)),a.value.splice(e,1)}catch(o){console.error("Error al eliminar stash:",o),alert("Error al eliminar el stash")}},l=t=>{const[e,a,o]=t.split("-"),i=new Date(e,a-1,o);return i.toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"})},d=t=>null===t||void 0===t?"0.00":t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2});return r(),{showModal:e,stashItems:a,newStash:i,totalStash:s,agregarStash:n,eliminarStash:c,formatearFecha:l,formatNumber:d}}},je=Ee,$e=(a("abd1"),Object(d["a"])(je,Ne,De,!1,null,"f44e4858",null)),Ie=$e.exports,Fe={name:"CatarroCuentasMenu",components:{BackButton:dt["a"],PreciosHistorialModal:Me,StashModal:Ie},data(){return{cuentas:[],isLoading:!0,filtroEstado:"todas",unsubscribe:null}},computed:{cuentasFiltradas(){switch(this.filtroEstado){case"pagadas":return this.cuentas.filter(t=>t.estadoPagado);case"no-pagadas":return this.cuentas.filter(t=>!t.estadoPagado);default:return this.cuentas}}},methods:{async loadCuentas(){try{this.isLoading=!0;const t=Object(et["c"])(P["a"],"cuentasCatarro"),e=Object(et["l"])(t,Object(et["k"])("fecha","asc"));this.unsubscribe=Object(et["j"])(e,async t=>{const e=t.docs.map(t=>{const e=t.data(),a=(e.cobros||[]).reduce((t,e)=>t+(parseFloat(e.monto)||0),0),o=(e.abonos||[]).reduce((t,e)=>t+(parseFloat(e.monto)||0),0),i=(e.totalGeneralVenta||0)-a-o;return{id:t.id,fecha:e.fecha,saldoHoy:e.totalGeneralVenta||0,totalCobros:a,totalAbonos:o,totalNota:e.nuevoSaldoAcumulado||0,estadoPagado:0===i,nuevoSaldoAcumulado:e.nuevoSaldoAcumulado||0,saldoAcumuladoAnterior:e.saldoAcumuladoAnterior||0,abonos:e.abonos||[],tieneObservacion:e.tieneObservacion||!1,observacion:e.observacion||""}}),a=e.sort((t,e)=>new Date(t.fecha)-new Date(e.fecha));let o=0;const i=[];for(let s=0;s<a.length;s++){const t=a[s],e=t.saldoHoy-t.totalCobros-t.totalAbonos;o+=e;const r=0===s?0:a[s-1].nuevoSaldoAcumulado;t.saldoAcumuladoAnterior===r&&t.nuevoSaldoAcumulado===o||i.push({id:t.id,updates:{saldoAcumuladoAnterior:r,nuevoSaldoAcumulado:o,estadoPagado:0===e}}),t.totalNota=o,t.saldoAcumuladoAnterior=r,t.estadoPagado=0===e,o<=0&&(o=0)}i.length>0&&await Promise.all(i.map(({id:t,updates:e})=>Object(et["o"])(Object(et["e"])(P["a"],"cuentasCatarro",t),e))),this.cuentas=a.reverse(),this.isLoading=!1})}catch(t){console.error("Error al cargar cuentas: ",t),this.error=t.message,this.cuentas=[],this.isLoading=!1}},formatDate(t){const e=new Date(t);return e.setMinutes(e.getMinutes()+e.getTimezoneOffset()),e.toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"})},formatNumber(t){return t.toLocaleString("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2})},editarCuenta(t){this.$router.push(`/cuentas-catarro/${t}?edit=true`)},async borrarCuenta(t){if(confirm("¿Estás seguro de que quieres borrar este registro de cuenta?"))try{await Object(et["d"])(Object(et["e"])(P["a"],"cuentasCatarro",t)),alert("Registro de cuenta borrado con éxito")}catch(e){console.error("Error al borrar el registro de cuenta: ",e),alert("Error al borrar el registro de cuenta")}},async borrarObservacion(t){if(confirm("¿Estás seguro de que quieres borrar esta observación?"))try{await Object(et["o"])(Object(et["e"])(P["a"],"cuentasCatarro",t),{tieneObservacion:!1,observacion:""}),alert("Observación borrada con éxito")}catch(e){console.error("Error al borrar la observación: ",e),alert("Error al borrar la observación")}}},mounted(){this.loadCuentas()},beforeUnmount(){this.unsubscribe&&this.unsubscribe()}},qe=Fe,ze=(a("6a76"),Object(d["a"])(qe,ke,Ae,!1,null,"4da548ba",null)),Ve=ze.exports,Le=function(){var t=this,e=t._self._c;return e("div",{staticClass:"cuentas-catarro-container"},[t.isSaving?e("div",{staticClass:"auto-save-indicator"},[e("span",{staticClass:"save-dot"}),t._v(" Guardando... ")]):t._e(),e("div",{staticClass:"back-button-container"},[e("BackButton",{attrs:{to:"/cuentas-catarro"}}),e("PreciosHistorialModal"),e("StashModal",{attrs:{cliente:"catarro"}})],1),e("h1",[t._v("Cuentas Catarro")]),e("div",{staticClass:"fecha-actual"},[e("div",{staticClass:"fecha-input"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.fechaSeleccionada,expression:"fechaSeleccionada"}],attrs:{type:"date"},domProps:{value:t.fechaSeleccionada},on:{input:function(e){e.target.composing||(t.fechaSeleccionada=e.target.value)}}})]),e("div",{staticClass:"fecha-display"},[t._v(" "+t._s(t.fechaFormateada)+" ")])]),e("div",{staticClass:"input-section"},[e("h2",[t._v("Ingresar Datos")]),e("div",{staticClass:"input-row"},[e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.newItem.kilos,expression:"newItem.kilos",modifiers:{number:!0}}],staticClass:"responsive-input",attrs:{type:"number",placeholder:"Kilos",inputmode:"decimal",pattern:"[0-9]*"},domProps:{value:t.newItem.kilos},on:{input:function(e){e.target.composing||t.$set(t.newItem,"kilos",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),e("input",{directives:[{name:"model",rawName:"v-model",value:t.newItem.medida,expression:"newItem.medida"}],staticClass:"responsive-input",attrs:{type:"text",placeholder:"Medida"},domProps:{value:t.newItem.medida},on:{input:function(e){e.target.composing||t.$set(t.newItem,"medida",e.target.value)}}}),e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.newItem.costo,expression:"newItem.costo",modifiers:{number:!0}}],staticClass:"responsive-input",attrs:{type:"number",placeholder:"Costo",inputmode:"decimal",pattern:"[0-9]*"},domProps:{value:t.newItem.costo},on:{input:function(e){e.target.composing||t.$set(t.newItem,"costo",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.newItem.precioVenta,expression:"newItem.precioVenta",modifiers:{number:!0}}],staticClass:"responsive-input",attrs:{type:"number",placeholder:"Precio Venta",inputmode:"decimal",pattern:"[0-9]*"},domProps:{value:t.newItem.precioVenta},on:{input:function(e){e.target.composing||t.$set(t.newItem,"precioVenta",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),e("button",{on:{click:t.addItem}},[t._v("Agregar")])])]),e("table",{staticClass:"tabla-principal"},[t._m(0),e("tbody",t._l(t.items,(function(a,o){return e("tr",{key:o},[e("td",{on:{click:function(e){return t.editField(o,"kilos")},touchstart:function(e){return t.startLongPress(o,"kilos")},touchend:t.endLongPress}},[t._v(" "+t._s(t.editingField.index===o&&"kilos"===t.editingField.field?"":t.formatNumber(a.kilos))+" "),t.editingField.index===o&&"kilos"===t.editingField.field?e("input",{directives:[{name:"model",rawName:"v-model.number",value:a.kilos,expression:"item.kilos",modifiers:{number:!0}}],ref:"editInput",refInFor:!0,attrs:{type:"number"},domProps:{value:a.kilos},on:{blur:[t.finishEditing,function(e){return t.$forceUpdate()}],keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.finishEditing.apply(null,arguments)},input:function(e){e.target.composing||t.$set(a,"kilos",t._n(e.target.value))}}}):t._e()]),e("td",{on:{click:function(e){return t.editField(o,"medida")},touchstart:function(e){return t.startLongPress(o,"medida")},touchend:t.endLongPress}},[t._v(" "+t._s(t.editingField.index===o&&"medida"===t.editingField.field?"":a.medida)+" "),t.editingField.index===o&&"medida"===t.editingField.field?e("input",{directives:[{name:"model",rawName:"v-model",value:a.medida,expression:"item.medida"}],ref:"editInput",refInFor:!0,attrs:{type:"text"},domProps:{value:a.medida},on:{blur:t.finishEditing,keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.finishEditing.apply(null,arguments)},input:function(e){e.target.composing||t.$set(a,"medida",e.target.value)}}}):t._e()]),e("td",{on:{click:function(e){return t.editField(o,"costo")},touchstart:function(e){return t.startLongPress(o,"costo")},touchend:t.endLongPress}},[t._v(" "+t._s(t.editingField.index===o&&"costo"===t.editingField.field?"":"$"+t.formatNumber(a.costo))+" "),t.editingField.index===o&&"costo"===t.editingField.field?e("input",{directives:[{name:"model",rawName:"v-model.number",value:a.costo,expression:"item.costo",modifiers:{number:!0}}],ref:"editInput",refInFor:!0,attrs:{type:"number"},domProps:{value:a.costo},on:{blur:[t.finishEditing,function(e){return t.$forceUpdate()}],keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.finishEditing.apply(null,arguments)},input:function(e){e.target.composing||t.$set(a,"costo",t._n(e.target.value))}}}):t._e()]),e("td",[t._v("$"+t._s(t.formatNumber(a.total)))]),e("td",{staticClass:"action-column desktop-only"},[e("button",{staticClass:"delete-btn",on:{click:function(e){return t.removeItem(o)}}},[t._v("Eliminar")])])])})),0),e("tfoot",[e("tr",{staticClass:"total"},[t._m(1),e("td",[e("strong",[t._v("$"+t._s(t.formatNumber(t.totalGeneral)))])]),e("td")])])]),e("h2",[t._v("Precios de Venta")]),e("div",{staticClass:"add-product-button"},[e("button",{on:{click:function(e){t.showAddProductModal=!0}}},[t._v("Agregar Producto")])]),e("table",{staticClass:"tabla-venta"},[t._m(2),e("tbody",[t._l(t.itemsVenta,(function(a,o){return e("tr",{key:o,on:{click:function(e){return t.toggleGananciasMobile(o)}}},[e("td",{on:{click:function(e){return t.editKilos(o)},touchstart:function(e){return t.startLongPress(o)},touchend:t.endLongPress}},[t._v(" "+t._s(t.editingKilosIndex===o?"":t.formatNumber(a.kilosVenta))+" "),t.editingKilosIndex===o?e("input",{directives:[{name:"model",rawName:"v-model.number",value:a.kilosVenta,expression:"item.kilosVenta",modifiers:{number:!0}}],ref:"kilosInput",refInFor:!0,attrs:{type:"number"},domProps:{value:a.kilosVenta},on:{blur:[t.finishEditingKilos,function(e){return t.$forceUpdate()}],keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.finishEditingKilos.apply(null,arguments)},input:function(e){e.target.composing||t.$set(a,"kilosVenta",t._n(e.target.value))}}}):t._e()]),e("td",[t._v(t._s(a.medida))]),e("td",[e("input",{directives:[{name:"model",rawName:"v-model.number",value:a.precioVenta,expression:"item.precioVenta",modifiers:{number:!0}}],staticClass:"precio-venta-input",attrs:{type:"number",inputmode:"decimal",pattern:"[0-9]*"},domProps:{value:a.precioVenta},on:{input:[function(e){e.target.composing||t.$set(a,"precioVenta",t._n(e.target.value))},function(e){return t.calcularTotalVenta(o)}],blur:function(e){return t.$forceUpdate()}}})]),e("td",[t._v("$"+t._s(t.formatNumber(a.totalVenta)))]),e("td",{class:{"desktop-only":!0,"ganancia-positiva":a.ganancia>0,"ganancia-negativa":a.ganancia<0}},[t._v(" $"+t._s(t.formatNumber(a.ganancia))+" ")])])})),null!==t.selectedRowIndex?e("tr",{staticClass:"mobile-only ganancia-row"},[e("td",{attrs:{colspan:"4"}},[e("strong",[t._v("Ganancias:")]),e("span",{class:{"ganancia-positiva":t.itemsVenta[t.selectedRowIndex].ganancia>0,"ganancia-negativa":t.itemsVenta[t.selectedRowIndex].ganancia<0}},[t._v(" $"+t._s(t.formatNumber(t.itemsVenta[t.selectedRowIndex].ganancia))+" ")])])]):t._e()],2),e("tfoot",[e("tr",{staticClass:"total"},[t._m(3),e("td",[e("strong",[t._v("$"+t._s(t.formatNumber(t.totalGeneralVenta)))])]),e("td",{staticClass:"desktop-only"},[e("strong",[t._v("$"+t._s(t.formatNumber(t.gananciaTotal)))])])])])]),e("div",{staticClass:"ganancia-del-dia"},[e("h3",[t._v("Ganancia del Día")]),e("p",{class:{"ganancia-positiva":t.gananciaDelDia>0,"ganancia-negativa":t.gananciaDelDia<0}},[t._v(" $"+t._s(t.formatNumber(t.gananciaDelDia))+" ")])]),e("h2",[t._v("Saldo pendiente")]),e("div",{staticClass:"saldo-pendiente"},[e("div",{staticClass:"input-row"},[e("span",[t._v("Saldo Acumulado Anterior: $"+t._s(t.formatNumber(t.saldoAcumuladoAnterior)))])]),t._l(t.cobros,(function(a,o){return e("div",{key:o,staticClass:"input-row"},[e("input",{directives:[{name:"model",rawName:"v-model",value:a.descripcion,expression:"cobro.descripcion"}],staticClass:"responsive-input",attrs:{type:"text",placeholder:"Flete"},domProps:{value:a.descripcion},on:{input:function(e){e.target.composing||t.$set(a,"descripcion",e.target.value)}}}),e("input",{directives:[{name:"model",rawName:"v-model",value:a.monto,expression:"cobro.monto"}],staticClass:"responsive-input",attrs:{type:"number",placeholder:"Monto"},domProps:{value:a.monto},on:{input:function(e){e.target.composing||t.$set(a,"monto",e.target.value)}}}),e("button",{staticClass:"delete-btn",on:{click:function(e){return t.removeCobro(o)}}},[t._v("Eliminar")])])})),e("button",{staticClass:"add-btn",on:{click:t.addCobro}},[t._v("Agregar Flete")])],2),e("h2",[t._v("Abonos")]),e("div",{staticClass:"abonos"},[t._l(t.abonos,(function(a,o){return e("div",{key:o,staticClass:"input-row"},[e("input",{directives:[{name:"model",rawName:"v-model",value:a.descripcion,expression:"abono.descripcion"}],staticClass:"responsive-input",attrs:{type:"text",placeholder:"Descripción"},domProps:{value:a.descripcion},on:{input:function(e){e.target.composing||t.$set(a,"descripcion",e.target.value)}}}),e("input",{directives:[{name:"model",rawName:"v-model.number",value:a.monto,expression:"abono.monto",modifiers:{number:!0}}],staticClass:"responsive-input",attrs:{type:"number",placeholder:"Monto"},domProps:{value:a.monto},on:{input:function(e){e.target.composing||t.$set(a,"monto",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),e("button",{staticClass:"delete-btn",on:{click:function(e){return t.removeAbono(o)}}},[t._v("Eliminar")])])})),e("button",{staticClass:"add-btn",on:{click:t.addAbono}},[t._v("Agregar Abono")])],2),e("table",{staticClass:"tabla-saldo"},[e("tr",[e("td",[t._v("Saldo Acumulado Anterior")]),e("td",[t._v("$"+t._s(t.formatNumber(t.saldoAcumuladoAnterior)))])]),e("tr",[e("td",[t._v("Saldo Hoy")]),e("td",[t._v("$"+t._s(t.formatNumber(t.totalGeneralVenta)))])]),t._l(t.cobros,(function(a,o){return e("tr",{key:o},[e("td",[t._v(t._s(a.descripcion))]),e("td",[t._v("-$"+t._s(t.formatNumber(a.monto)))])])})),t._l(t.abonos,(function(a,o){return e("tr",{key:"abono-"+o},[e("td",[t._v(t._s(a.descripcion)+" (Abono)")]),e("td",[t._v("-$"+t._s(t.formatNumber(a.monto)))])])})),e("tr",{staticClass:"total"},[e("td",[t._v("Total")]),e("td",[t._v("$"+t._s(t.formatNumber(t.totalDiaActual)))])]),e("tr",{staticClass:"total"},[e("td",[t._v("Nuevo Saldo Acumulado")]),e("td",[t._v("$"+t._s(t.formatNumber(t.nuevoSaldoAcumulado)))])])],2),e("div",{staticClass:"button-container"},[e("button",{staticClass:"save-button",attrs:{disabled:t.isGuardando},on:{click:t.guardarNota}},[t._v(" "+t._s(t.isGuardando?"Guardando...":"Guardar Nota")+" ")]),e("button",{staticClass:"print-button",on:{click:t.imprimirTablas}},[t._v("Imprimir")])]),t.showMobileActions?e("div",{staticClass:"mobile-actions-modal"},[e("button",{staticClass:"edit-btn",on:{click:function(e){return t.editItem(t.selectedItemIndex)}}},[t._v("Editar")]),e("button",{staticClass:"delete-btn",on:{click:function(e){return t.removeItem(t.selectedItemIndex)}}},[t._v("Eliminar")]),e("button",{on:{click:t.cancelMobileActions}},[t._v("Cancelar")])]):t._e(),t.showEditModal?e("div",{staticClass:"edit-modal"},[e("h3",[t._v("Editar Item")]),e("div",{staticClass:"input-row"},[e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.editingItem.kilos,expression:"editingItem.kilos",modifiers:{number:!0}}],staticClass:"responsive-input",attrs:{type:"number",placeholder:"Kilos",inputmode:"decimal",pattern:"[0-9]*"},domProps:{value:t.editingItem.kilos},on:{input:function(e){e.target.composing||t.$set(t.editingItem,"kilos",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editingItem.medida,expression:"editingItem.medida"}],staticClass:"responsive-input",attrs:{type:"text",placeholder:"Medida"},domProps:{value:t.editingItem.medida},on:{input:function(e){e.target.composing||t.$set(t.editingItem,"medida",e.target.value)}}}),e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.editingItem.costo,expression:"editingItem.costo",modifiers:{number:!0}}],staticClass:"responsive-input",attrs:{type:"number",placeholder:"Costo",inputmode:"decimal",pattern:"[0-9]*"},domProps:{value:t.editingItem.costo},on:{input:function(e){e.target.composing||t.$set(t.editingItem,"costo",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}})]),e("div",{staticClass:"button-row"},[e("button",{on:{click:t.saveEditedItem}},[t._v("Guardar")]),e("button",{on:{click:t.cancelEdit}},[t._v("Cancelar")])])]):t._e(),t.showAddProductModal?e("div",{staticClass:"modal"},[e("div",{staticClass:"modal-content"},[e("h3",[t._v("Agregar Nuevo Producto")]),e("div",{staticClass:"input-row"},[e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.newProduct.kilosVenta,expression:"newProduct.kilosVenta",modifiers:{number:!0}}],staticClass:"responsive-input",attrs:{type:"number",placeholder:"Kilos",inputmode:"decimal",pattern:"[0-9]*"},domProps:{value:t.newProduct.kilosVenta},on:{input:function(e){e.target.composing||t.$set(t.newProduct,"kilosVenta",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),e("input",{directives:[{name:"model",rawName:"v-model",value:t.newProduct.medida,expression:"newProduct.medida"}],staticClass:"responsive-input",attrs:{type:"text",placeholder:"Medida"},domProps:{value:t.newProduct.medida},on:{input:function(e){e.target.composing||t.$set(t.newProduct,"medida",e.target.value)}}}),e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.newProduct.precioVenta,expression:"newProduct.precioVenta",modifiers:{number:!0}}],staticClass:"responsive-input",attrs:{type:"number",placeholder:"Precio de Venta",inputmode:"decimal",pattern:"[0-9]*"},domProps:{value:t.newProduct.precioVenta},on:{input:function(e){e.target.composing||t.$set(t.newProduct,"precioVenta",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}})]),e("div",{staticClass:"button-row"},[e("button",{on:{click:t.addNewProduct}},[t._v("Agregar")]),e("button",{on:{click:function(e){t.showAddProductModal=!1}}},[t._v("Cancelar")])])])]):t._e(),e("div",{class:["estado-cuenta",t.estadoCuenta.toLowerCase(),{"no-pagado":"No Pagado"===t.estadoCuenta}]},[t._v(" "+t._s(t.estadoCuenta)+" ")]),e("div",{staticClass:"guardar-container"},[e("div",{staticClass:"observacion-container"},[e("button",{staticClass:"btn-agregar-observacion",on:{click:t.agregarObservacion}},[e("i",{staticClass:"fas fa-plus"}),t._v(" Agregar observación ")])]),t.observacion?e("div",{staticClass:"observacion-existente"},[e("div",{staticClass:"observacion-header"},[e("p",{staticClass:"observacion-titulo"},[t._v("Observación actual:")]),e("div",{staticClass:"observacion-buttons"},[e("button",{staticClass:"btn-editar",on:{click:t.editarObservacion}},[t._v("Editar")]),e("button",{staticClass:"btn-eliminar",attrs:{title:"Eliminar observación"},on:{click:t.eliminarObservacion}},[t._v("×")])])]),e("p",{staticClass:"observacion-texto"},[t._v(t._s(t.observacion))])]):t._e()]),t.showObservacionModal?e("div",{staticClass:"modal-overlay"},[e("div",{staticClass:"modal-content"},[e("h3",[t._v(t._s(t.observacion?"Editar":"Agregar")+" Observación")]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.observacion,expression:"observacion"}],attrs:{placeholder:"Escribe tu observación aquí...",rows:"4"},domProps:{value:t.observacion},on:{input:function(e){e.target.composing||(t.observacion=e.target.value)}}}),e("div",{staticClass:"modal-buttons"},[e("button",{staticClass:"btn-guardar",on:{click:t.guardarObservacion}},[t._v("Guardar")]),e("button",{staticClass:"btn-cancelar",on:{click:t.cancelarObservacion}},[t._v("Cancelar")])])])]):t._e(),t.showSaveMessage?e("div",{staticClass:"auto-save-message"},[t._v(" "+t._s(t.lastSaveMessage)+" ")]):t._e()])},Be=[function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",[t._v("Kilos")]),e("th",[t._v("Medida")]),e("th",[t._v("Costo")]),e("th",[t._v("Total")]),e("th",{staticClass:"desktop-only"},[t._v("Acciones")])])])},function(){var t=this,e=t._self._c;return e("td",{staticClass:"text-right",attrs:{colspan:"3"}},[e("strong",[t._v("Total General Costo:")])])},function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",[t._v("Kilos")]),e("th",[t._v("Medida")]),e("th",[t._v("Precio")]),e("th",[t._v("Total")]),e("th",{staticClass:"desktop-only"},[t._v("Ganancias")])])])},function(){var t=this,e=t._self._c;return e("td",{staticClass:"text-right",attrs:{colspan:"3"}},[e("strong",[t._v("Total General Venta:")])])}],Ge=(a("d9e2"),{name:"CuentasCatarro",components:{BackButton:dt["a"],PreciosHistorialModal:Me,StashModal:Ie},data(){return{items:[],newItem:{kilos:null,medida:"",costo:null,precioVenta:null},saldoAcumuladoAnterior:0,cobros:[],abonos:[],fechaSeleccionada:this.obtenerFechaActual(),showMobileActions:!1,selectedItemIndex:null,presionTimer:null,itemsVenta:[],showEditModal:!1,editingItem:null,editingIndex:null,estadoPagado:!1,editingKilosIndex:null,longPressTimer:null,editingField:{index:null,field:null},selectedRowIndex:null,showAddProductModal:!1,newProduct:{kilosVenta:null,medida:"",precioVenta:null},autoSaveTimer:null,lastSavedData:null,saveQueue:[],isSaving:!1,lastSaveTime:null,saveMinInterval:5e3,tieneObservacion:!1,showObservacionModal:!1,observacion:"",isGuardando:!1,lastSaveMessage:"",showSaveMessage:!1,saveMessageTimer:null}},computed:{fechaFormateada(){const t=new Date(this.fechaSeleccionada+"T00:00:00"),e={year:"numeric",month:"long",day:"numeric"};return t.toLocaleDateString("es-ES",e)},totalGeneral(){return this.items.reduce((t,e)=>t+(e.total||0),0)},totalGeneralVenta(){return this.itemsVenta.reduce((t,e)=>t+(e.totalVenta||0),0)},totalSaldo(){const t=this.cobros.reduce((t,e)=>t+(e.monto||0),0),e=this.abonos.reduce((t,e)=>t+(e.monto||0),0);return this.saldoAcumuladoAnterior+this.totalGeneralVenta+t-e},nuevoSaldoAcumulado(){return(this.saldoAcumuladoAnterior||0)+(this.totalDiaActual||0)},gananciaDelDia(){const t=this.items.reduce((t,e)=>t+(e.total||0),0);return(this.totalGeneralVenta||0)-(t||0)},saldoPendiente(){return this.totalGeneralVenta-this.abonos.reduce((t,e)=>t+(e.monto||0),0)},estadoCuenta(){return this.totalSaldo<=0||0===this.totalDiaActual?"Pagado":"No Pagado"},gananciaTotal(){return this.itemsVenta.reduce((t,e)=>t+(e.ganancia||0),0)},totalDiaActual(){const t=this.cobros.reduce((t,e)=>t+(parseFloat(e.monto)||0),0),e=this.abonos.reduce((t,e)=>t+(parseFloat(e.monto)||0),0);return(this.totalGeneralVenta||0)-t-e}},watch:{fechaSeleccionada:{handler:"loadSaldoAcumuladoAnterior",immediate:!0},items:{handler:"handleDataChange",deep:!0},itemsVenta:{handler:"handleDataChange",deep:!0},cobros:{handler:"handleDataChange",deep:!0},abonos:{handler:"handleDataChange",deep:!0},fechaSeleccionada:{handler:"handleDataChange"},saldoAcumuladoAnterior:{handler:"handleDataChange"},"newItem.kilos":"handleDataChange","newItem.medida":"handleDataChange","newItem.costo":"handleDataChange",observacion:"handleDataChange",tieneObservacion(t){}},async mounted(){console.log("Mounted ejecutado",this.$route.params,this.$route.query);const t=this.$route.params.id,e="true"===this.$route.query.edit;t&&e?(console.log("Iniciando carga de cuenta existente"),await this.loadExistingCuenta(t)):(console.log("Cargando saldo acumulado anterior para nueva cuenta"),await this.loadSaldoAcumuladoAnterior())},methods:{async loadExistingCuenta(t){try{console.log("Cargando cuenta con ID:",t);const e=Object(et["e"])(P["a"],"cuentasCatarro",t),a=await Object(et["f"])(e);if(a.exists()){const t=a.data();console.log("Datos de la cuenta cargados:",t),this.$nextTick(()=>{this.items=t.items||[],this.saldoAcumuladoAnterior=t.saldoAcumuladoAnterior||0,this.cobros=t.cobros||[],this.abonos=t.abonos||[],this.fechaSeleccionada=t.fecha||this.obtenerFechaActual(),this.tieneObservacion=t.tieneObservacion||!1,this.observacion=t.observacion||"",this.itemsVenta=t.itemsVenta||this.items.map(t=>({...t,precioVenta:t.precioVenta||0,totalVenta:(t.precioVenta||0)*t.kilos,kilosVenta:t.kilos})),this.actualizarItemsVenta(),console.log("Estado actualizado con $nextTick:",{items:this.items,saldoAcumuladoAnterior:this.saldoAcumuladoAnterior,cobros:this.cobros,abonos:this.abonos,fechaSeleccionada:this.fechaSeleccionada,itemsVenta:this.itemsVenta,tieneObservacion:this.tieneObservacion,observacion:this.observacion})})}else console.error("No se encontró la cuenta con el ID proporcionado")}catch(e){console.error("Error al cargar la cuenta existente: ",e)}},async loadSaldoAcumuladoAnterior(){try{this.saldoAcumuladoAnterior=await this.obtenerSaldoAcumuladoAnterior(),console.log("Saldo acumulado anterior cargado:",this.saldoAcumuladoAnterior)}catch(t){console.error("Error al cargar el saldo acumulado anterior:",t),this.saldoAcumuladoAnterior=0}},async obtenerSaldoAcumuladoAnterior(){try{const t=Object(et["c"])(P["a"],"cuentasCatarro"),e=Object(et["l"])(t,Object(et["p"])("fecha","<",this.fechaSeleccionada),Object(et["k"])("fecha","desc"),Object(et["i"])(1)),a=await Object(et["g"])(e);if(!a.empty){const t=a.docs[0].data();return t.nuevoSaldoAcumulado||0}return 0}catch(t){return console.error("Error al obtener saldo acumulado anterior:",t),0}},async actualizarCuentasPosteriores(t){try{const e=Object(et["c"])(P["a"],"cuentasCatarro"),a=Object(et["l"])(e,Object(et["p"])("fecha",">=",t),Object(et["k"])("fecha","asc"),Object(et["i"])(50)),o=await Object(et["g"])(a),i=o.docs.map(t=>({id:t.id,...t.data()}));let s=this.nuevoSaldoAcumulado;await Promise.all(i.map(async t=>{const e=t.totalGeneralVenta+(t.cobros||[]).reduce((t,e)=>t+(parseFloat(e.monto)||0),0)-(t.abonos||[]).reduce((t,e)=>t+(parseFloat(e.monto)||0),0);return s+=e,Object(et["o"])(Object(et["e"])(P["a"],"cuentasCatarro",t.id),{saldoAcumuladoAnterior:t.id===this.$route.params.id?this.saldoAcumuladoAnterior:s-e,nuevoSaldoAcumulado:s,estadoPagado:s<=0})}))}catch(e){throw console.error("Error al actualizar cuentas posteriores:",e),e}},formatNumber(t){return null===t||void 0===t?"0.00":t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})},async addItem(){if(this.newItem.kilos&&this.newItem.medida&&this.newItem.costo&&this.newItem.precioVenta)try{const t=this.newItem.kilos*this.newItem.costo;this.items.push({kilos:this.newItem.kilos,medida:this.newItem.medida,costo:this.newItem.costo,total:t});const e=this.newItem.kilos*this.newItem.precioVenta,a=e-t;this.itemsVenta.push({kilosVenta:this.newItem.kilos,medida:this.newItem.medida,precioVenta:this.newItem.precioVenta,totalVenta:e,ganancia:a}),this.newItem={kilos:null,medida:"",costo:null,precioVenta:null},await this.queueSave()}catch(t){console.error("Error al guardar el item:",t),alert("Hubo un problema al guardar. Por favor, intente nuevamente."),this.items.pop(),this.itemsVenta.pop()}else alert("Por favor complete todos los campos")},async crearNuevaCuenta(){try{const t=Object(et["c"])(P["a"],"cuentasCatarro"),e=Object(et["l"])(t,Object(et["p"])("fecha","==",this.fechaSeleccionada)),a=await Object(et["g"])(e);if(!a.empty)throw new Error("Ya existe una nota registrada para esta fecha.");const o={fecha:this.fechaSeleccionada,items:this.items,itemsVenta:this.itemsVenta,saldoAcumuladoAnterior:await this.obtenerSaldoAcumuladoAnterior(),cobros:[],abonos:[],totalGeneral:this.totalGeneral,totalGeneralVenta:0,nuevoSaldoAcumulado:this.saldoAcumuladoAnterior,estadoPagado:!1,tieneObservacion:this.tieneObservacion,observacion:this.observacion},i=await Object(et["b"])(Object(et["c"])(P["a"],"cuentasCatarro"),o);return this.$router.replace({name:this.$route.name,params:{id:i.id},query:{edit:"true"}}),i.id}catch(t){throw"Ya existe una nota registrada para esta fecha."===t.message?alert(t.message):(console.error("Error al crear nueva cuenta:",t),alert("Error al crear la cuenta. Por favor, intente nuevamente.")),t}},async removeItem(t){try{this.items.splice(t,1),this.itemsVenta.splice(t,1),this.showMobileActions=!1,await this.queueSave()}catch(e){console.error("Error al eliminar item:",e)}},addCobro(){this.cobros.push({descripcion:"Flete",monto:0})},removeCobro(t){this.cobros.splice(t,1)},addAbono(){this.abonos.push({descripcion:"",monto:0})},removeAbono(t){this.abonos.splice(t,1)},obtenerFechaActual(){const t=new Date;return t.getFullYear()+"-"+String(t.getMonth()+1).padStart(2,"0")+"-"+String(t.getDate()).padStart(2,"0")},async guardarNota(){try{this.isGuardando=!0;const t=this.totalGeneralVenta-this.cobros.reduce((t,e)=>t+(parseFloat(e.monto)||0),0)-this.abonos.reduce((t,e)=>t+(parseFloat(e.monto)||0),0),e=await this.obtenerSaldoAcumuladoAnterior(),a=e+t,o=a<=0,i={fecha:this.fechaSeleccionada,items:this.items,saldoAcumuladoAnterior:e,cobros:this.cobros,abonos:this.abonos,totalGeneral:this.totalGeneral,totalGeneralVenta:this.totalGeneralVenta,nuevoSaldoAcumulado:o?0:a,gananciaDelDia:this.gananciaDelDia,estadoPagado:o,itemsVenta:this.itemsVenta,tieneObservacion:this.tieneObservacion,observacion:this.observacion,ultimaActualizacion:(new Date).toISOString()},s=this.$route.params.id,r="true"===this.$route.query.edit;if(s&&r)await Object(et["o"])(Object(et["e"])(P["a"],"cuentasCatarro",s),i),this.actualizarCuentasPosteriores(this.fechaSeleccionada).catch(console.error),alert("Cuenta guardada exitosamente"),this.$router.push("/cuentas-catarro");else{const t=Object(et["c"])(P["a"],"cuentasCatarro"),e=Object(et["l"])(t,Object(et["p"])("fecha","==",this.fechaSeleccionada)),a=await Object(et["g"])(e);if(!a.empty)return void alert("Ya existe una nota registrada para esta fecha. No se puede crear una nueva.");await Object(et["b"])(Object(et["c"])(P["a"],"cuentasCatarro"),i),this.actualizarCuentasPosteriores(this.fechaSeleccionada).catch(console.error),alert("Cuenta guardada exitosamente"),this.$router.push("/cuentas-catarro")}}catch(t){console.error("Error al guardar la cuenta:",t),alert("Error al guardar la cuenta")}finally{this.isGuardando=!1}},iniciarPresion(t){this.presionTimer=setTimeout(()=>{this.showMobileActionsModal(t)},500)},finalizarPresion(){clearTimeout(this.presionTimer)},showMobileActionsModal(t){this.selectedItemIndex=t,this.showMobileActions=!0},cancelMobileActions(){this.showMobileActions=!1,this.selectedItemIndex=null},editItem(t){this.editingIndex=t,this.editingItem={...this.items[t]},this.showEditModal=!0},saveEditedItem(){this.editingItem.kilos&&this.editingItem.medida&&this.editingItem.costo&&(this.editingItem.total=this.editingItem.kilos*this.editingItem.costo,this.items[this.editingIndex]={...this.editingItem},this.actualizarItemsVenta(),this.showEditModal=!1,this.editingItem=null,this.editingIndex=null)},cancelEdit(){this.showEditModal=!1,this.editingItem=null,this.editingIndex=null},imprimirTablas(){const t=`\n        <html>\n          <head>\n            <title>Cuentas Catarro - ${this.fechaFormateada}</title>\n            <style>\n              body {\n                font-family: Arial, sans-serif;\n                font-size: 20pt;\n                line-height: 1.6;\n                max-width: 800px;\n                margin: 0 auto;\n                padding: 20px;\n                text-align: center;\n              }\n              h1 { font-size: 30pt; margin-bottom: 20px; }\n              h2 { font-size: 27pt; margin-top: 30px; margin-bottom: 15px; }\n              table {\n                width: 100%;\n                border-collapse: collapse;\n                margin-bottom: 30px;\n                font-size: 20pt;\n              }\n              th, td {\n                border: 1px solid #ddd;\n                padding: 10px;\n                text-align: left;\n              }\n              th { background-color: #f2f2f2; font-weight: bold; }\n              .total { font-weight: bold; }\n              .total td:first-child { text-align: right; }\n              @media print {\n                body { font-size: 20pt; }\n                h1 { font-size: 25pt; }\n                h2 { font-size: 25pt; }\n                table { font-size: 20pt; }\n              }\n            </style>\n          </head>\n          <body>\n            <h1>Cuentas Catarro - ${this.fechaFormateada}</h1>\n            \n            <h2>Detalles de la cuenta</h2>\n            <table>\n              <thead>\n                <tr>\n                  <th>Kilos</th>\n                  <th>Medida</th>\n                  <th>Costo</th>\n                  <th>Total</th>\n                </tr>\n              </thead>\n              <tbody>\n                ${this.items.map(t=>`\n                  <tr>\n                    <td>${this.formatNumber(t.kilos)}</td>\n                    <td>${t.medida}</td>\n                    <td>$${this.formatNumber(t.costo)}</td>\n                    <td>$${this.formatNumber(t.total)}</td>\n                  </tr>\n                `).join("")}\n              </tbody>\n              <tfoot>\n                <tr class="total">\n                  <td colspan="3">Total</td>\n                  <td>$${this.formatNumber(this.totalGeneral)}</td>\n                </tr>\n              </tfoot>\n            </table>\n\n            <h2>Precios de Venta</h2>\n            <table>\n              <thead>\n                <tr>\n                  <th>Kilos</th>\n                  <th>Medida</th>\n                  <th>Precio de Venta</th>\n                  <th>Total</th>\n                  <th>Ganancias</th>\n                </tr>\n              </thead>\n              <tbody>\n                ${this.itemsVenta.map(t=>`\n                  <tr>\n                    <td>${this.formatNumber(t.kilosVenta)}</td>\n                    <td>${t.medida}</td>\n                    <td>$${this.formatNumber(t.precioVenta)}</td>\n                    <td>$${this.formatNumber(t.totalVenta)}</td>\n                    <td class="${t.ganancia>0?"ganancia-positiva":"ganancia-negativa"}">$${this.formatNumber(t.ganancia)}</td>\n                  </tr>\n                `).join("")}\n              </tbody>\n              <tfoot>\n                <tr class="total">\n                  <td colspan="3">Total Venta</td>\n                  <td>$${this.formatNumber(this.totalGeneralVenta)}</td>\n                  <td>$${this.formatNumber(this.gananciaTotal)}</td>\n                </tr>\n              </tfoot>\n            </table>\n\n            <h2>Resumen de saldo</h2>\n            <table>\n              <tr>\n                <td>Saldo Anterior</td>\n                <td>$${this.formatNumber(this.saldoAcumuladoAnterior)}</td>\n              </tr>\n              <tr>\n                <td>Saldo Hoy</td>\n                <td>$${this.formatNumber(this.totalGeneralVenta)}</td>\n              </tr>\n              ${this.cobros.map(t=>`\n                <tr>\n                  <td>${t.descripcion}</td>\n                  <td>$${this.formatNumber(t.monto)}</td>\n                </tr>\n              `).join("")}\n              ${this.abonos.map(t=>`\n                <tr>\n                  <td>${t.descripcion} (Abono)</td>\n                  <td>-$${this.formatNumber(t.monto)}</td>\n                </tr>\n              `).join("")}\n              <tr class="total">\n                <td>Total</td>\n                <td>$${this.formatNumber(this.totalSaldo)}</td>\n              </tr>\n            </table>\n          </body>\n        </html>\n      `,e=window.open("","_blank");e.document.write(t),e.document.close(),e.print()},actualizarItemsVenta(){this.itemsVenta=this.itemsVenta.map((t,e)=>{const a=this.items[e],o=(t.precioVenta||0)*(t.kilosVenta||0),i=a?a.total:0,s=o-i;return{...t,totalVenta:o,ganancia:s}})},calcularTotalVenta(t){const e=this.itemsVenta[t];if(e)try{const a=parseFloat(e.kilosVenta)||0,o=parseFloat(e.precioVenta)||0;e.totalVenta=a*o;const i=this.items[t],s=i&&i.total||0;e.ganancia=(e.totalVenta||0)-s,this.actualizarItemsVenta(),this.queueSave()}catch(a){console.error("Error al calcular total de venta:",a)}},removeItemVenta(t){this.itemsVenta.splice(t,1)},editKilos(t){this.editingKilosIndex=t,this.$nextTick(()=>{this.$refs.kilosInput&&this.$refs.kilosInput[0]&&this.$refs.kilosInput[0].focus()})},finishEditingKilos(){const t=this.editingKilosIndex;if(null!==t)try{const e=this.itemsVenta[t];e.kilosVenta=parseFloat(e.kilosVenta)||e.kilos,this.calcularTotalVenta(t),this.queueSave()}catch(e){console.error("Error al finalizar edición de kilos:",e)}this.editingKilosIndex=null},startLongPress(t,e){this.longPressTimer=setTimeout(()=>{this.editField(t,e)},500)},endLongPress(){clearTimeout(this.longPressTimer)},editField(t,e){this.editingField={index:t,field:e},this.$nextTick(()=>{this.$refs.editInput&&this.$refs.editInput[0]&&this.$refs.editInput[0].focus()})},finishEditing(){const{index:t,field:e}=this.editingField;if(null!==t&&null!==e)try{const a=this.items[t];"kilos"!==e&&"costo"!==e||(a[e]=parseFloat(a[e])||0),a.total=a.kilos*a.costo,this.actualizarItemsVenta(),this.queueSave()}catch(a){console.error("Error al finalizar edición:",a)}this.editingField={index:null,field:null}},toggleGananciasMobile(t){window.innerWidth<=600&&(this.selectedRowIndex=this.selectedRowIndex===t?null:t)},addNewProduct(){if(this.newProduct.kilosVenta&&this.newProduct.medida&&this.newProduct.precioVenta){const t=this.newProduct.kilosVenta*this.newProduct.precioVenta;this.itemsVenta.push({...this.newProduct,totalVenta:t,ganancia:t}),this.showAddProductModal=!1,this.newProduct={kilosVenta:null,medida:"",precioVenta:null}}else alert("Por favor, complete todos los campos")},handleDataChange(){this.$route.params.id&&"true"===this.$route.query.edit&&(this.autoSaveTimer&&clearTimeout(this.autoSaveTimer),this.autoSaveTimer=setTimeout(async()=>{await this.queueSave()},2e3))},async queueSave(){this.saveQueue.push({timestamp:Date.now(),operation:async()=>{this.$route.params.id?await this.autoSaveNota():await this.crearNuevaCuenta()}}),this.isSaving||await this.processSaveQueue()},async processSaveQueue(){if(!this.isSaving&&0!==this.saveQueue.length){this.isSaving=!0;try{while(this.saveQueue.length>0){const t=Date.now();this.lastSaveTime&&t-this.lastSaveTime<this.saveMinInterval&&await new Promise(e=>setTimeout(e,this.saveMinInterval-(t-this.lastSaveTime)));const e=this.saveQueue[0];await this.retryOperation(e.operation),this.lastSaveTime=Date.now(),this.saveQueue.shift()}}catch(t){console.error("Error procesando cola de guardado:",t),"resource-exhausted"===t.code&&(await new Promise(t=>setTimeout(t,1e4)),await this.processSaveQueue())}finally{this.isSaving=!1}}},async autoSaveNota(){if(this.$route.params.id)try{const t={items:this.items.map(t=>({kilos:t.kilos,medida:t.medida,costo:t.costo,total:t.total})),itemsVenta:this.itemsVenta.map(t=>({kilosVenta:t.kilosVenta,medida:t.medida,precioVenta:t.precioVenta,totalVenta:t.totalVenta,ganancia:t.ganancia})),totalGeneral:this.totalGeneral,totalGeneralVenta:this.totalGeneralVenta,nuevoSaldoAcumulado:this.nuevoSaldoAcumulado,cobros:this.cobros,abonos:this.abonos,estadoPagado:"Pagado"===this.estadoCuenta,tieneObservacion:this.tieneObservacion,observacion:this.observacion,ultimaActualizacion:(new Date).toISOString()};await Object(et["o"])(Object(et["e"])(P["a"],"cuentasCatarro",this.$route.params.id),t),this.lastSaveMessage="Guardado automático: "+(new Date).toLocaleTimeString(),this.showSaveMessage=!0,this.saveMessageTimer&&clearTimeout(this.saveMessageTimer),this.saveMessageTimer=setTimeout(()=>{this.showSaveMessage=!1},3e3),console.log("Cuenta auto-guardada exitosamente:",(new Date).toLocaleTimeString())}catch(t){if("resource-exhausted"===t.code)throw t;throw console.error("Error en auto-guardado:",t),t}},guardarCuenta(){this.guardarNota()},agregarObservacion(){this.showObservacionModal=!0},guardarObservacion(){this.observacion.trim()&&(this.tieneObservacion=!0),this.showObservacionModal=!1},cancelarObservacion(){this.tieneObservacion||(this.observacion=""),this.showObservacionModal=!1},editarObservacion(){this.showObservacionModal=!0},eliminarObservacion(){confirm("¿Estás seguro de que deseas eliminar esta observación?")&&(this.observacion="",this.tieneObservacion=!1)},async retryOperation(t,e=3){let a=0;while(a<e)try{return await t()}catch(o){if(a++,console.error(`Error en operación (intento ${a}/${e}):`,o),"resource-exhausted"===o.code?await new Promise(t=>setTimeout(t,5e3*Math.pow(2,a))):await new Promise(t=>setTimeout(t,1e3*Math.pow(2,a))),a>=e)throw console.error("Se alcanzó el número máximo de intentos. Operación fallida."),o}}},beforeUnmount(){this.autoSaveTimer&&clearTimeout(this.autoSaveTimer),this.saveQueue.length>0&&this.processSaveQueue()}}),He=Ge,Re=(a("0ada"),Object(d["a"])(He,Le,Be,!1,null,"6980f1e3",null)),Ke=Re.exports,Je=function(){var t=this,e=t._self._c;return e("div",{staticClass:"joselito-cuentas-menu-container"},[e("h1",[t._v("Menú de Cuentas Joselito")]),e("div",{staticClass:"actions-container"},[e("router-link",{staticClass:"action-button back-btn",attrs:{to:"/cuentas-mexico"}},[t._v(" Cuentas México ")]),e("router-link",{staticClass:"action-button new-cuenta-btn",attrs:{to:"/cuentas-joselito/nueva"}},[t._v(" Nueva Cuenta ")]),e("router-link",{staticClass:"action-button ventas-ganancias-btn",attrs:{to:"/ventas-ganancias-joselito"}},[t._v(" Ventas y Ganancias ")]),e("button",{staticClass:"action-button abonos-btn",on:{click:function(e){t.showAbonosModal=!0}}},[t._v(" Abonos ")]),e("PreciosHistorialModal"),e("StashModal",{attrs:{cliente:"joselito"}})],1),t.showAbonosModal?e("div",{staticClass:"modal"},[e("div",{staticClass:"modal-content"},[e("div",{staticClass:"modal-header"},[e("h2",[t._v("Historial de Abonos")]),e("button",{staticClass:"close-modal-btn",on:{click:function(e){t.showAbonosModal=!1}}},[t._v("×")])]),e("div",{staticClass:"fecha-filtros"},[e("div",{staticClass:"fecha-grupo"},[e("label",[t._v("Desde:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.fechaInicio,expression:"fechaInicio"}],staticClass:"fecha-input",attrs:{type:"date"},domProps:{value:t.fechaInicio},on:{change:t.calcularTotalAbonos,input:function(e){e.target.composing||(t.fechaInicio=e.target.value)}}})]),e("div",{staticClass:"fecha-grupo"},[e("label",[t._v("Hasta:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.fechaFin,expression:"fechaFin"}],staticClass:"fecha-input",attrs:{type:"date"},domProps:{value:t.fechaFin},on:{change:t.calcularTotalAbonos,input:function(e){e.target.composing||(t.fechaFin=e.target.value)}}})])]),null!==t.totalAbonosPeriodo?e("div",{staticClass:"total-abonos"},[e("span",{staticClass:"total-label"},[t._v("Total de abonos en el periodo:")]),e("span",{staticClass:"total-monto"},[t._v("$"+t._s(t.formatNumber(t.totalAbonosPeriodo)))])]):t._e(),e("div",{staticClass:"abonos-list"},[0===t.abonosHistorial.length?e("div",{staticClass:"no-records"},[t._v(" No hay abonos registrados. ")]):e("div",t._l(t.abonosHistorial,(function(a,o){return e("div",{key:o,staticClass:"abono-item"},[e("div",{staticClass:"abono-fecha"},[t._v(t._s(t.formatDate(a.fecha)))]),e("div",{staticClass:"abono-details"},[e("span",{staticClass:"abono-monto"},[t._v("$"+t._s(t.formatNumber(a.monto)))]),e("span",{staticClass:"abono-descripcion"},[t._v(t._s(a.descripcion))])])])})),0)]),e("button",{staticClass:"close-btn",on:{click:function(e){t.showAbonosModal=!1}}},[t._v("Cerrar")])])]):t._e(),e("div",{staticClass:"cuentas-list"},[e("h2",[t._v("Registros de Cuentas")]),t.error?e("div",{staticClass:"error-message"},[t._v(" Error al cargar los datos: "+t._s(t.error)+" ")]):t.isLoading?e("div",{staticClass:"loading"},[t._v("Cargando registros...")]):0===t.cuentas.length?e("div",{staticClass:"no-records"},[t._v(" No hay registros de cuentas que coincidan con el filtro. ")]):e("ul",t._l(t.cuentas,(function(a){return e("li",{key:a.id,staticClass:"cuenta-item",class:{"tiene-observacion":a.tieneObservacion}},[e("div",{staticClass:"cuenta-content"},[e("span",{staticClass:"cuenta-date"},[t._v(t._s(t.formatDate(a.fecha)))]),e("p",{staticClass:"cuenta-summary"},[e("span",[t._v("Saldo Hoy: $"+t._s(t.formatNumber(a.saldoHoy)))]),e("span",[t._v("Total Acumulado: $"+t._s(t.formatNumber(a.totalNota)))])]),a.tieneObservacion?e("div",{staticClass:"observacion-badge",on:{click:function(e){return t.mostrarObservacion(a)}}},[t._v(" Ver observación ")]):t._e(),a.abonos&&a.abonos.length>0?e("div",{staticClass:"abonos-info"},t._l(a.abonos,(function(a,o){return e("p",{key:o,staticClass:"abono-detail"},[e("span",{staticClass:"abono-label"},[t._v("Abono:")]),e("span",{staticClass:"abono-monto"},[t._v("$"+t._s(t.formatNumber(a.monto)))]),e("span",{staticClass:"abono-descripcion"},[t._v(t._s(a.descripcion||"Sin descripción"))])])})),0):t._e()]),e("div",{staticClass:"cuenta-actions"},[e("button",{staticClass:"edit-btn",on:{click:function(e){return t.editarCuenta(a.id)}}},[t._v("Editar")]),e("button",{staticClass:"delete-btn",on:{click:function(e){return t.borrarCuenta(a.id)}}},[t._v("Borrar")])])])})),0)]),t.showObservacionModal?e("div",{staticClass:"modal-overlay"},[e("div",{staticClass:"modal-content"},[e("h3",[t._v("Observación")]),e("p",{staticClass:"observacion-text"},[t._v(t._s(t.observacionActual))]),e("div",{staticClass:"modal-buttons"},[e("button",{staticClass:"btn-cerrar",on:{click:function(e){t.showObservacionModal=!1}}},[t._v("Cerrar")])])])]):t._e()])},Ue=[],Ye={name:"JoselitoCuentasMenu",components:{BackButton:dt["a"],PreciosHistorialModal:Me,StashModal:Ie},data(){return{cuentas:[],isLoading:!0,unsubscribe:null,error:null,showAbonosModal:!1,fechaInicio:"",fechaFin:"",totalAbonosPeriodo:null,abonosHistorial:[],showObservacionModal:!1,observacionActual:""}},methods:{async loadCuentas(){try{this.isLoading=!0;const t=Object(et["c"])(P["a"],"cuentasJoselito"),e=Object(et["l"])(t,Object(et["k"])("fecha","asc"));this.unsubscribe=Object(et["j"])(e,async t=>{const e=t.docs.map(t=>{const e=t.data(),a=(e.cobros||[]).reduce((t,e)=>t+(parseFloat(e.monto)||0),0),o=(e.abonos||[]).reduce((t,e)=>t+(parseFloat(e.monto)||0),0);return{id:t.id,fecha:e.fecha,saldoHoy:e.totalGeneralVenta||0,totalCobros:a,totalAbonos:o,totalNota:e.nuevoSaldoAcumulado||0,nuevoSaldoAcumulado:e.nuevoSaldoAcumulado||0,saldoAcumuladoAnterior:e.saldoAcumuladoAnterior||0,abonos:e.abonos||[],tieneObservacion:e.tieneObservacion||!1,observacion:e.observacion||""}}),a=e.sort((t,e)=>new Date(t.fecha)-new Date(e.fecha));let o=0;const i=[];for(let s=0;s<a.length;s++){const t=a[s],e=t.saldoHoy-t.totalCobros-t.totalAbonos;o+=e;const r=0===s?0:a[s-1].nuevoSaldoAcumulado;t.saldoAcumuladoAnterior===r&&t.nuevoSaldoAcumulado===o||i.push({id:t.id,updates:{saldoAcumuladoAnterior:r,nuevoSaldoAcumulado:o}}),t.totalNota=o,t.saldoAcumuladoAnterior=r,o<=0&&(o=0)}i.length>0&&await Promise.all(i.map(({id:t,updates:e})=>Object(et["o"])(Object(et["e"])(P["a"],"cuentasJoselito",t),e))),this.cuentas=a.reverse(),this.isLoading=!1})}catch(t){console.error("Error al cargar cuentas: ",t),this.error=t.message,this.cuentas=[],this.isLoading=!1}},formatDate(t){const e=new Date(t);return e.setMinutes(e.getMinutes()+e.getTimezoneOffset()),e.toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"})},formatNumber(t){return t.toLocaleString("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2})},editarCuenta(t){this.$router.push(`/cuentas-joselito/${t}?edit=true`)},async borrarCuenta(t){if(confirm("¿Estás seguro de que quieres borrar este registro de cuenta?"))try{await Object(et["d"])(Object(et["e"])(P["a"],"cuentasJoselito",t)),alert("Registro de cuenta borrado con éxito")}catch(e){console.error("Error al borrar el registro de cuenta: ",e),alert("Error al borrar el registro de cuenta")}},calcularTotalAbonos(){if(!this.fechaInicio||!this.fechaFin)return void(this.totalAbonosPeriodo=null);const t=new Date(this.fechaInicio),e=new Date(this.fechaFin);e.setHours(23,59,59,999);const a=this.abonosHistorial.filter(a=>{const o=new Date(a.fecha);return o>=t&&o<=e});this.totalAbonosPeriodo=a.reduce((t,e)=>t+(parseFloat(e.monto)||0),0)},async cargarHistorialAbonos(){try{const t=Object(et["c"])(P["a"],"cuentasJoselito"),e=await Object(et["g"])(t);let a=[];e.forEach(t=>{const e=t.data();e.abonos&&e.abonos.length>0&&e.abonos.forEach(t=>{a.push({...t,fecha:e.fecha})})}),this.abonosHistorial=a.sort((t,e)=>new Date(e.fecha)-new Date(t.fecha)),this.fechaInicio&&this.fechaFin&&this.calcularTotalAbonos()}catch(t){console.error("Error al cargar historial de abonos:",t)}},mostrarObservacion(t){this.observacionActual=t.observacion,this.showObservacionModal=!0}},watch:{showAbonosModal(t){t&&this.cargarHistorialAbonos()}},created(){this.loadCuentas()},beforeUnmount(){this.unsubscribe&&this.unsubscribe()}},We=Ye,Qe=(a("4175"),Object(d["a"])(We,Je,Ue,!1,null,"b24f00fc",null)),Xe=Qe.exports,Ze=function(){var t=this,e=t._self._c;return e("div",{staticClass:"cuentas-joselito-container"},[t.isSaving?e("div",{staticClass:"auto-save-indicator"},[e("span",{staticClass:"save-dot"}),t._v(" Guardando... ")]):t._e(),e("div",{staticClass:"back-button-container"},[e("BackButton",{attrs:{to:"/cuentas-joselito"}}),e("PreciosHistorialModal"),e("StashModal",{attrs:{cliente:"joselito"}})],1),e("h1",[t._v("Cuentas Joselito")]),e("div",{staticClass:"fecha-actual"},[e("div",{staticClass:"fecha-input"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.fechaSeleccionada,expression:"fechaSeleccionada"}],attrs:{type:"date"},domProps:{value:t.fechaSeleccionada},on:{input:function(e){e.target.composing||(t.fechaSeleccionada=e.target.value)}}})]),e("div",{staticClass:"fecha-display"},[t._v(" "+t._s(t.fechaFormateada)+" ")])]),e("div",{staticClass:"input-section"},[e("h2",[t._v("Ingresar Datos")]),e("div",{staticClass:"input-row"},[e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.newItem.kilos,expression:"newItem.kilos",modifiers:{number:!0}}],staticClass:"responsive-input",attrs:{type:"number",placeholder:"Kilos",inputmode:"decimal",pattern:"[0-9]*"},domProps:{value:t.newItem.kilos},on:{input:function(e){e.target.composing||t.$set(t.newItem,"kilos",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),e("input",{directives:[{name:"model",rawName:"v-model",value:t.newItem.medida,expression:"newItem.medida"}],staticClass:"responsive-input",attrs:{type:"text",placeholder:"Medida"},domProps:{value:t.newItem.medida},on:{input:function(e){e.target.composing||t.$set(t.newItem,"medida",e.target.value)}}}),e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.newItem.costo,expression:"newItem.costo",modifiers:{number:!0}}],staticClass:"responsive-input",attrs:{type:"number",placeholder:"Costo",inputmode:"decimal",pattern:"[0-9]*"},domProps:{value:t.newItem.costo},on:{input:function(e){e.target.composing||t.$set(t.newItem,"costo",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.newItem.precioVenta,expression:"newItem.precioVenta",modifiers:{number:!0}}],staticClass:"responsive-input",attrs:{type:"number",placeholder:"Precio Venta",inputmode:"decimal",pattern:"[0-9]*"},domProps:{value:t.newItem.precioVenta},on:{input:function(e){e.target.composing||t.$set(t.newItem,"precioVenta",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),e("button",{on:{click:t.addItem}},[t._v("Agregar")])])]),e("table",{staticClass:"tabla-principal"},[t._m(0),e("tbody",t._l(t.items,(function(a,o){return e("tr",{key:o},[e("td",{on:{click:function(e){return t.editField(o,"kilos")},touchstart:function(e){return t.startLongPress(o,"kilos")},touchend:t.endLongPress}},[t._v(" "+t._s(t.editingField.index===o&&"kilos"===t.editingField.field?"":t.formatNumber(a.kilos))+" "),t.editingField.index===o&&"kilos"===t.editingField.field?e("input",{directives:[{name:"model",rawName:"v-model.number",value:a.kilos,expression:"item.kilos",modifiers:{number:!0}}],ref:"editInput",refInFor:!0,attrs:{type:"number"},domProps:{value:a.kilos},on:{blur:[t.finishEditing,function(e){return t.$forceUpdate()}],keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.finishEditing.apply(null,arguments)},input:function(e){e.target.composing||t.$set(a,"kilos",t._n(e.target.value))}}}):t._e()]),e("td",{on:{click:function(e){return t.editField(o,"medida")},touchstart:function(e){return t.startLongPress(o,"medida")},touchend:t.endLongPress}},[t._v(" "+t._s(t.editingField.index===o&&"medida"===t.editingField.field?"":a.medida)+" "),t.editingField.index===o&&"medida"===t.editingField.field?e("input",{directives:[{name:"model",rawName:"v-model",value:a.medida,expression:"item.medida"}],ref:"editInput",refInFor:!0,attrs:{type:"text"},domProps:{value:a.medida},on:{blur:t.finishEditing,keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.finishEditing.apply(null,arguments)},input:function(e){e.target.composing||t.$set(a,"medida",e.target.value)}}}):t._e()]),e("td",{on:{click:function(e){return t.editField(o,"costo")},touchstart:function(e){return t.startLongPress(o,"costo")},touchend:t.endLongPress}},[t._v(" "+t._s(t.editingField.index===o&&"costo"===t.editingField.field?"":"$"+t.formatNumber(a.costo))+" "),t.editingField.index===o&&"costo"===t.editingField.field?e("input",{directives:[{name:"model",rawName:"v-model.number",value:a.costo,expression:"item.costo",modifiers:{number:!0}}],ref:"editInput",refInFor:!0,attrs:{type:"number"},domProps:{value:a.costo},on:{blur:[t.finishEditing,function(e){return t.$forceUpdate()}],keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.finishEditing.apply(null,arguments)},input:function(e){e.target.composing||t.$set(a,"costo",t._n(e.target.value))}}}):t._e()]),e("td",[t._v("$"+t._s(t.formatNumber(a.total)))]),e("td",{staticClass:"action-column desktop-only"},[e("button",{staticClass:"delete-btn",on:{click:function(e){return t.removeItem(o)}}},[t._v("Eliminar")])])])})),0),e("tfoot",[e("tr",{staticClass:"total"},[t._m(1),e("td",[e("strong",[t._v("$"+t._s(t.formatNumber(t.totalGeneral)))])]),e("td")])])]),e("h2",[t._v("Precios de Venta")]),e("div",{staticClass:"add-product-button"},[e("button",{on:{click:function(e){t.showAddProductModal=!0}}},[t._v("Agregar Producto")])]),e("table",{staticClass:"tabla-venta"},[t._m(2),e("tbody",[t._l(t.itemsVenta,(function(a,o){return e("tr",{key:o,on:{click:function(e){return t.toggleGananciasMobile(o)}}},[e("td",{on:{click:function(e){return t.editKilos(o)},touchstart:function(e){return t.startLongPress(o)},touchend:t.endLongPress}},[t._v(" "+t._s(t.editingKilosIndex===o?"":t.formatNumber(a.kilosVenta))+" "),t.editingKilosIndex===o?e("input",{directives:[{name:"model",rawName:"v-model.number",value:a.kilosVenta,expression:"item.kilosVenta",modifiers:{number:!0}}],ref:"kilosInput",refInFor:!0,attrs:{type:"number"},domProps:{value:a.kilosVenta},on:{blur:[t.finishEditingKilos,function(e){return t.$forceUpdate()}],keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.finishEditingKilos.apply(null,arguments)},input:function(e){e.target.composing||t.$set(a,"kilosVenta",t._n(e.target.value))}}}):t._e()]),e("td",[t._v(t._s(a.medida))]),e("td",[e("input",{staticClass:"precio-venta-input",attrs:{type:"number",inputmode:"decimal",pattern:"[0-9]*",step:"0.01"},domProps:{value:a.precioVenta},on:{input:e=>{a.precioVenta=Number(e.target.value),t.calcularTotalVenta(o)}}})]),e("td",[t._v("$"+t._s(t.formatNumber(a.totalVenta)))]),e("td",{class:{"desktop-only":!0,"ganancia-positiva":a.ganancia>0,"ganancia-negativa":a.ganancia<0}},[t._v(" $"+t._s(t.formatNumber(a.ganancia))+" ")])])})),null!==t.selectedRowIndex?e("tr",{staticClass:"mobile-only ganancia-row"},[e("td",{attrs:{colspan:"4"}},[e("strong",[t._v("Ganancias:")]),e("span",{class:{"ganancia-positiva":t.itemsVenta[t.selectedRowIndex].ganancia>0,"ganancia-negativa":t.itemsVenta[t.selectedRowIndex].ganancia<0}},[t._v(" $"+t._s(t.formatNumber(t.itemsVenta[t.selectedRowIndex].ganancia))+" ")])])]):t._e()],2),e("tfoot",[e("tr",{staticClass:"total"},[t._m(3),e("td",[e("strong",[t._v("$"+t._s(t.formatNumber(t.totalGeneralVenta)))])]),e("td",{staticClass:"desktop-only"},[e("strong",[t._v("$"+t._s(t.formatNumber(t.gananciaTotal)))])])])])]),e("div",{staticClass:"ganancia-del-dia"},[e("h3",[t._v("Ganancia del Día")]),e("p",{class:{"ganancia-positiva":t.gananciaDelDia>0,"ganancia-negativa":t.gananciaDelDia<0}},[t._v(" $"+t._s(t.formatNumber(t.gananciaDelDia))+" ")])]),e("h2",[t._v("Saldo pendiente")]),e("div",{staticClass:"saldo-pendiente"},[e("div",{staticClass:"input-row"},[e("span",[t._v("Saldo Acumulado Anterior: $"+t._s(t.formatNumber(t.saldoAcumuladoAnterior)))])]),t._l(t.cobros,(function(a,o){return e("div",{key:o,staticClass:"input-row"},[e("input",{directives:[{name:"model",rawName:"v-model",value:a.descripcion,expression:"cobro.descripcion"}],staticClass:"responsive-input",attrs:{type:"text",placeholder:"Flete"},domProps:{value:a.descripcion},on:{input:function(e){e.target.composing||t.$set(a,"descripcion",e.target.value)}}}),e("input",{directives:[{name:"model",rawName:"v-model",value:a.monto,expression:"cobro.monto"}],staticClass:"responsive-input",attrs:{type:"number",placeholder:"Monto"},domProps:{value:a.monto},on:{input:function(e){e.target.composing||t.$set(a,"monto",e.target.value)}}}),e("button",{staticClass:"delete-btn",on:{click:function(e){return t.removeCobro(o)}}},[t._v("Eliminar")])])})),e("button",{staticClass:"add-btn",on:{click:t.addCobro}},[t._v("Agregar Flete")])],2),e("h2",[t._v("Abonos")]),e("div",{staticClass:"abonos"},[t._l(t.abonos,(function(a,o){return e("div",{key:o,staticClass:"input-row"},[e("input",{directives:[{name:"model",rawName:"v-model",value:a.descripcion,expression:"abono.descripcion"}],staticClass:"responsive-input",attrs:{type:"text",placeholder:"Descripción"},domProps:{value:a.descripcion},on:{input:function(e){e.target.composing||t.$set(a,"descripcion",e.target.value)}}}),e("input",{directives:[{name:"model",rawName:"v-model.number",value:a.monto,expression:"abono.monto",modifiers:{number:!0}}],staticClass:"responsive-input",attrs:{type:"number",placeholder:"Monto"},domProps:{value:a.monto},on:{input:function(e){e.target.composing||t.$set(a,"monto",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),e("button",{staticClass:"delete-btn",on:{click:function(e){return t.removeAbono(o)}}},[t._v("Eliminar")])])})),e("button",{staticClass:"add-btn",on:{click:t.addAbono}},[t._v("Agregar Abono")])],2),e("table",{staticClass:"tabla-saldo"},[e("tr",[e("td",[t._v("Saldo Acumulado Anterior")]),e("td",[t._v("$"+t._s(t.formatNumber(t.saldoAcumuladoAnterior)))])]),e("tr",[e("td",[t._v("Saldo Hoy")]),e("td",[t._v("$"+t._s(t.formatNumber(t.totalGeneralVenta)))])]),t._l(t.cobros,(function(a,o){return e("tr",{key:o},[e("td",[t._v(t._s(a.descripcion))]),e("td",[t._v("-$"+t._s(t.formatNumber(a.monto)))])])})),t._l(t.abonos,(function(a,o){return e("tr",{key:"abono-"+o},[e("td",[t._v(t._s(a.descripcion)+" (Abono)")]),e("td",[t._v("-$"+t._s(t.formatNumber(a.monto)))])])})),e("tr",{staticClass:"total"},[e("td",[t._v("Total")]),e("td",[t._v("$"+t._s(t.formatNumber(t.totalDiaActual)))])]),e("tr",{staticClass:"total"},[e("td",[t._v("Nuevo Saldo Acumulado")]),e("td",[t._v("$"+t._s(t.formatNumber(t.nuevoSaldoAcumulado)))])])],2),e("div",{staticClass:"guardar-container"},[e("div",{staticClass:"observacion-container"},[e("button",{staticClass:"btn-agregar-observacion",on:{click:t.agregarObservacion}},[e("i",{staticClass:"fas fa-plus"}),t._v(" Agregar observación ")])]),t.observacion?e("div",{staticClass:"observacion-existente"},[e("div",{staticClass:"observacion-header"},[e("p",{staticClass:"observacion-titulo"},[t._v("Observación actual:")]),e("div",{staticClass:"observacion-buttons"},[e("button",{staticClass:"btn-editar",on:{click:t.editarObservacion}},[t._v("Editar")]),e("button",{staticClass:"btn-eliminar",attrs:{title:"Eliminar observación"},on:{click:t.eliminarObservacion}},[t._v("×")])])]),e("p",{staticClass:"observacion-texto"},[t._v(t._s(t.observacion))])]):t._e(),e("button",{staticClass:"btn-guardar",on:{click:t.guardarCuenta}},[t._v("Guardar")])]),t.showObservacionModal?e("div",{staticClass:"modal-overlay"},[e("div",{staticClass:"modal-content"},[e("h3",[t._v(t._s(t.observacion?"Editar":"Agregar")+" Observación")]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.observacion,expression:"observacion"}],attrs:{placeholder:"Escribe tu observación aquí...",rows:"4"},domProps:{value:t.observacion},on:{input:function(e){e.target.composing||(t.observacion=e.target.value)}}}),e("div",{staticClass:"modal-buttons"},[e("button",{staticClass:"btn-guardar",on:{click:t.guardarObservacion}},[t._v("Guardar")]),e("button",{staticClass:"btn-cancelar",on:{click:t.cancelarObservacion}},[t._v("Cancelar")])])])]):t._e(),t.showMobileActions?e("div",{staticClass:"mobile-actions-modal"},[e("button",{staticClass:"edit-btn",on:{click:function(e){return t.editItem(t.selectedItemIndex)}}},[t._v("Editar")]),e("button",{staticClass:"delete-btn",on:{click:function(e){return t.removeItem(t.selectedItemIndex)}}},[t._v("Eliminar")]),e("button",{on:{click:t.cancelMobileActions}},[t._v("Cancelar")])]):t._e(),t.showEditModal?e("div",{staticClass:"edit-modal"},[e("h3",[t._v("Editar Item")]),e("div",{staticClass:"input-row"},[e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.editingItem.kilos,expression:"editingItem.kilos",modifiers:{number:!0}}],staticClass:"responsive-input",attrs:{type:"number",placeholder:"Kilos",inputmode:"decimal",pattern:"[0-9]*"},domProps:{value:t.editingItem.kilos},on:{input:function(e){e.target.composing||t.$set(t.editingItem,"kilos",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editingItem.medida,expression:"editingItem.medida"}],staticClass:"responsive-input",attrs:{type:"text",placeholder:"Medida"},domProps:{value:t.editingItem.medida},on:{input:function(e){e.target.composing||t.$set(t.editingItem,"medida",e.target.value)}}}),e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.editingItem.costo,expression:"editingItem.costo",modifiers:{number:!0}}],staticClass:"responsive-input",attrs:{type:"number",placeholder:"Costo",inputmode:"decimal",pattern:"[0-9]*"},domProps:{value:t.editingItem.costo},on:{input:function(e){e.target.composing||t.$set(t.editingItem,"costo",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}})]),e("div",{staticClass:"button-row"},[e("button",{on:{click:t.saveEditedItem}},[t._v("Guardar")]),e("button",{on:{click:t.cancelEdit}},[t._v("Cancelar")])])]):t._e(),t.showAddProductModal?e("div",{staticClass:"modal"},[e("div",{staticClass:"modal-content"},[e("h3",[t._v("Agregar Nuevo Producto")]),e("div",{staticClass:"input-row"},[e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.newProduct.kilosVenta,expression:"newProduct.kilosVenta",modifiers:{number:!0}}],staticClass:"responsive-input",attrs:{type:"number",placeholder:"Kilos",inputmode:"decimal",pattern:"[0-9]*"},domProps:{value:t.newProduct.kilosVenta},on:{input:function(e){e.target.composing||t.$set(t.newProduct,"kilosVenta",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),e("input",{directives:[{name:"model",rawName:"v-model",value:t.newProduct.medida,expression:"newProduct.medida"}],staticClass:"responsive-input",attrs:{type:"text",placeholder:"Medida"},domProps:{value:t.newProduct.medida},on:{input:function(e){e.target.composing||t.$set(t.newProduct,"medida",e.target.value)}}}),e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.newProduct.precioVenta,expression:"newProduct.precioVenta",modifiers:{number:!0}}],staticClass:"responsive-input",attrs:{type:"number",placeholder:"Precio de Venta",inputmode:"decimal",pattern:"[0-9]*"},domProps:{value:t.newProduct.precioVenta},on:{input:function(e){e.target.composing||t.$set(t.newProduct,"precioVenta",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}})]),e("div",{staticClass:"button-row"},[e("button",{on:{click:t.addNewProduct}},[t._v("Agregar")]),e("button",{on:{click:function(e){t.showAddProductModal=!1}}},[t._v("Cancelar")])])])]):t._e(),e("div",{class:["estado-cuenta",t.estadoCuenta.toLowerCase(),{"no-pagado":"No Pagado"===t.estadoCuenta}]},[t._v(" "+t._s(t.estadoCuenta)+" ")]),t.showSaveMessage?e("div",{staticClass:"save-message"},[t._v(" "+t._s(t.lastSaveMessage)+" ")]):t._e()])},ta=[function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",[t._v("Kilos")]),e("th",[t._v("Medida")]),e("th",[t._v("Costo")]),e("th",[t._v("Total")]),e("th",{staticClass:"desktop-only"},[t._v("Acciones")])])])},function(){var t=this,e=t._self._c;return e("td",{staticClass:"text-right",attrs:{colspan:"3"}},[e("strong",[t._v("Total General Costo:")])])},function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",[t._v("Kilos")]),e("th",[t._v("Medida")]),e("th",[t._v("Precio")]),e("th",[t._v("Total")]),e("th",{staticClass:"desktop-only"},[t._v("Ganancias")])])])},function(){var t=this,e=t._self._c;return e("td",{staticClass:"text-right",attrs:{colspan:"3"}},[e("strong",[t._v("Total General Venta:")])])}],ea={name:"CuentasJoselito",components:{BackButton:dt["a"],PreciosHistorialModal:Me,StashModal:Ie},data(){return{items:[],newItem:{kilos:null,medida:"",costo:null,precioVenta:null},saldoAcumuladoAnterior:0,cobros:[],abonos:[],fechaSeleccionada:this.obtenerFechaActual(),showMobileActions:!1,selectedItemIndex:null,presionTimer:null,itemsVenta:[],showEditModal:!1,editingItem:null,editingIndex:null,estadoPagado:!1,editingKilosIndex:null,longPressTimer:null,editingField:{index:null,field:null},selectedRowIndex:null,showAddProductModal:!1,newProduct:{kilosVenta:null,medida:"",precioVenta:null},autoSaveTimer:null,lastSavedData:null,saveQueue:[],isSaving:!1,lastSaveTime:null,saveMinInterval:5e3,selectedField:null,tieneObservacion:!1,showObservacionModal:!1,observacion:"",debounceTimers:{},lastSaveMessage:"",showSaveMessage:!1,saveMessageTimer:null}},computed:{fechaFormateada(){const t=new Date(this.fechaSeleccionada+"T00:00:00"),e={year:"numeric",month:"long",day:"numeric"};return t.toLocaleDateString("es-ES",e)},totalGeneral(){return this.items.reduce((t,e)=>t+(e.total||0),0)},totalGeneralVenta(){return this.itemsVenta.reduce((t,e)=>t+(e.totalVenta||0),0)},totalSaldo(){const t=this.cobros.reduce((t,e)=>t+(e.monto||0),0),e=this.abonos.reduce((t,e)=>t+(e.monto||0),0);return this.saldoAcumuladoAnterior+this.totalGeneralVenta+t-e},nuevoSaldoAcumulado(){return(this.saldoAcumuladoAnterior||0)+(this.totalDiaActual||0)},gananciaDelDia(){const t=this.items.reduce((t,e)=>t+(e.total||0),0);return(this.totalGeneralVenta||0)-(t||0)},saldoPendiente(){return this.totalGeneralVenta-this.abonos.reduce((t,e)=>t+(e.monto||0),0)},estadoCuenta(){return this.totalDiaActual<=0?"Pagado":"No Pagado"},gananciaTotal(){return this.itemsVenta.reduce((t,e)=>t+(e.ganancia||0),0)},totalDiaActual(){const t=this.cobros.reduce((t,e)=>t+(parseFloat(e.monto)||0),0),e=this.abonos.reduce((t,e)=>t+(parseFloat(e.monto)||0),0);return(this.totalGeneralVenta||0)-t-e}},methods:{obtenerFechaActual(){const t=new Date;return t.getFullYear()+"-"+String(t.getMonth()+1).padStart(2,"0")+"-"+String(t.getDate()).padStart(2,"0")},formatNumber(t){return null===t||void 0===t?"0.00":t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})},async loadExistingCuenta(t){try{const e=Object(et["e"])(P["a"],"cuentasJoselito",t),a=await Object(et["f"])(e);if(!a.exists())throw new Error("No se encontró la cuenta especificada");{const t=a.data();this.items=(t.items||[]).map(t=>({kilos:Number(t.kilos)||0,medida:t.medida||"",costo:Number(t.costo)||0,total:Number(t.total)||0})),this.itemsVenta=(t.itemsVenta||[]).map(t=>({kilosVenta:Number(t.kilosVenta)||0,medida:t.medida||"",precioVenta:Number(t.precioVenta)||0,totalVenta:Number(t.totalVenta)||0,ganancia:Number(t.ganancia)||0})),this.saldoAcumuladoAnterior=Number(t.saldoAcumuladoAnterior)||0,this.cobros=(t.cobros||[]).map(t=>({descripcion:t.descripcion||"",monto:Number(t.monto)||0})),this.abonos=(t.abonos||[]).map(t=>({descripcion:t.descripcion||"",monto:Number(t.monto)||0})),this.fechaSeleccionada=t.fecha||this.obtenerFechaActual(),this.tieneObservacion=t.tieneObservacion||!1,this.observacion=t.observacion||""}}catch(e){throw console.error("Error al cargar la cuenta existente:",e),e}},async obtenerSaldoAcumuladoAnterior(){try{const t=Object(et["c"])(P["a"],"cuentasJoselito"),e=Object(et["l"])(t,Object(et["p"])("fecha","<",this.fechaSeleccionada),Object(et["k"])("fecha","desc"),Object(et["i"])(1)),a=await Object(et["g"])(e);if(!a.empty){const t=a.docs[0].data(),e=(t.cobros||[]).reduce((t,e)=>t+(parseFloat(e.monto)||0),0),o=(t.abonos||[]).reduce((t,e)=>t+(parseFloat(e.monto)||0),0),i=(t.totalGeneralVenta||0)-e-o;if(i<=0)return 0;const s=(t.saldoAcumuladoAnterior||0)+i;return s}return 0}catch(t){return console.error("Error al obtener saldo acumulado anterior:",t),0}},async actualizarCuentasPosteriores(t){try{const t=Object(et["c"])(P["a"],"cuentasJoselito"),e=Object(et["l"])(t,Object(et["k"])("fecha","asc")),a=await Object(et["g"])(e),o=a.docs.map(t=>({id:t.id,...t.data()})),i=o.sort((t,e)=>new Date(t.fecha)-new Date(e.fecha));let s=0;const r=Object(et["q"])(P["a"]);for(let n=0;n<i.length;n++){const t=i[n],e=Object(et["e"])(P["a"],"cuentasJoselito",t.id),a=t.totalGeneralVenta+(t.cobros||[]).reduce((t,e)=>t+(parseFloat(e.monto)||0),0)-(t.abonos||[]).reduce((t,e)=>t+(parseFloat(e.monto)||0),0);s+=a,r.update(e,{saldoAcumuladoAnterior:0===n?0:i[n-1].nuevoSaldoAcumulado,nuevoSaldoAcumulado:s,estadoPagado:s<=0}),s<=0&&(s=0)}await r.commit()}catch(e){throw console.error("Error al actualizar cuentas posteriores:",e),e}},async crearNuevaCuenta(){try{console.log("Iniciando creación de nueva cuenta...");const e=Object(et["c"])(P["a"],"cuentasJoselito");console.log("Referencia a la colección creada:",e);const a=Object(et["l"])(e,Object(et["p"])("fecha","==",this.fechaSeleccionada));console.log("Query construida para fecha:",this.fechaSeleccionada);const o=await Object(et["g"])(a);if(console.log("Query snapshot obtenido:",o.size,"documentos encontrados"),!o.empty)throw new Error("Ya existe una nota registrada para esta fecha.");console.log("Obteniendo saldo acumulado anterior...");const i=await this.obtenerSaldoAcumuladoAnterior();console.log("Saldo anterior obtenido:",i);const s={fecha:this.fechaSeleccionada,items:this.items,itemsVenta:this.itemsVenta,saldoAcumuladoAnterior:i,cobros:[],abonos:[],totalGeneral:this.totalGeneral,totalGeneralVenta:this.totalGeneralVenta,nuevoSaldoAcumulado:i+this.totalDiaActual,estadoPagado:!1,tieneObservacion:this.tieneObservacion,observacion:this.observacion,ultimaActualizacion:(new Date).toISOString()};console.log("Datos preparados para crear nueva cuenta:",s);try{console.log("Intentando crear documento en Firestore...");const t=await Object(et["b"])(e,s);console.log("Documento creado exitosamente con ID:",t.id);const a=await Object(et["f"])(t);if(!a.exists())throw new Error("El documento no se creó correctamente");return console.log("Documento verificado y existe en Firestore"),console.log("Actualizando URL..."),await this.$router.push({name:"CuentasJoselito",params:{id:t.id},query:{edit:"true"}}),console.log("Cargando datos de la nueva cuenta..."),await this.loadExistingCuenta(t.id),alert("Cuenta creada exitosamente"),t.id}catch(t){throw console.error("Error específico de Firestore:",t),new Error("Error al crear el documento en Firestore: "+t.message)}}catch(e){throw console.error("Error detallado al crear nueva cuenta:",e),"Ya existe una nota registrada para esta fecha."===e.message?alert(e.message):alert(`Error al crear la cuenta: ${e.message}\nPor favor, revise la consola para más detalles.`),e}},async guardarNota(){try{if(!this.fechaSeleccionada)throw new Error("La fecha es requerida");const t={fecha:this.fechaSeleccionada,items:this.items.map(t=>({kilos:Number(t.kilos)||0,medida:String(t.medida||""),costo:Number(t.costo)||0,total:Number(t.kilos*t.costo)||0})),itemsVenta:this.itemsVenta.map(t=>({kilosVenta:Number(t.kilosVenta)||0,medida:String(t.medida||""),precioVenta:Number(t.precioVenta)||0,totalVenta:Number(t.kilosVenta*t.precioVenta)||0,ganancia:Number(t.ganancia)||0})),saldoAcumuladoAnterior:Number(this.saldoAcumuladoAnterior)||0,cobros:this.cobros.map(t=>({descripcion:String(t.descripcion||""),monto:Number(t.monto)||0})),abonos:this.abonos.map(t=>({descripcion:String(t.descripcion||""),monto:Number(t.monto)||0})),totalGeneral:Number(this.totalGeneral)||0,totalGeneralVenta:Number(this.totalGeneralVenta)||0,totalCobros:Number(this.cobros.reduce((t,e)=>t+(Number(e.monto)||0),0)),totalAbonos:Number(this.abonos.reduce((t,e)=>t+(Number(e.monto)||0),0)),totalDia:Number(this.totalDiaActual)||0,nuevoSaldoAcumulado:Number(this.nuevoSaldoAcumulado)||0,gananciaDelDia:Number(this.gananciaDelDia)||0,estadoPagado:Boolean(this.totalDiaActual<=0),tieneObservacion:this.tieneObservacion,observacion:this.observacion,ultimaActualizacion:(new Date).toISOString()},e=this.$route.params.id,a="true"===this.$route.query.edit;let o;e&&a?(o=Object(et["e"])(P["a"],"cuentasJoselito",e),await Object(et["o"])(o,t),console.log("Documento actualizado exitosamente:",e)):(o=await Object(et["b"])(Object(et["c"])(P["a"],"cuentasJoselito"),t),console.log("Nuevo documento creado:",o.id),await this.$router.push({name:"CuentasJoselito",params:{id:o.id},query:{edit:"true"}}));const i=await Object(et["f"])(o);if(!i.exists())throw new Error("Error al verificar el documento guardado");const s=i.data(),r=this.validateSavedData(t,s);if(!r)throw new Error("Los datos guardados no coinciden con los datos originales");return setTimeout(()=>{this.actualizarCuentasPosteriores(this.fechaSeleccionada).catch(t=>console.error("Error al actualizar cuentas posteriores:",t))},1e3),alert("Datos guardados exitosamente"),o.id}catch(t){throw console.error("Error al guardar nota:",t),alert("Error al guardar: "+t.message),t}},validateSavedData(t,e){const a=["fecha","saldoAcumuladoAnterior","totalGeneral","totalGeneralVenta","totalCobros","totalAbonos","totalDia","nuevoSaldoAcumulado","gananciaDelDia","estadoPagado"];for(const i of a)if(t[i]!==e[i])return console.error(`Discrepancia en campo ${i}:`,{original:t[i],saved:e[i]}),!1;const o=["items","itemsVenta","cobros","abonos"];for(const i of o)if(t[i].length!==e[i].length)return console.error("Discrepancia en longitud de array "+i),!1;return!0},async addItem(){if(this.newItem.kilos&&this.newItem.medida&&this.newItem.costo&&this.newItem.precioVenta)try{if(!this.$route.params.id){const t={...this.newItem},e=await this.crearNuevaCuenta();if(!e)throw new Error("No se pudo crear la cuenta");this.newItem=t}const t=this.newItem.kilos*this.newItem.costo;this.items.push({kilos:this.newItem.kilos,medida:this.newItem.medida,costo:this.newItem.costo,total:t});const e=this.newItem.kilos*this.newItem.precioVenta,a=e-t;this.itemsVenta.push({kilosVenta:this.newItem.kilos,medida:this.newItem.medida,precioVenta:this.newItem.precioVenta,totalVenta:e,ganancia:a}),this.newItem={kilos:null,medida:"",costo:null,precioVenta:null}}catch(t){console.error("Error al guardar el item:",t),alert("Hubo un problema al guardar. Por favor, intente nuevamente."),this.items.pop(),this.itemsVenta.pop()}else alert("Por favor complete todos los campos")},actualizarItemsVenta(){const t=[...this.itemsVenta];this.itemsVenta=this.items.map((e,a)=>{const o=t[a]||{},i=Number(o.precioVenta)||0;return{kilosVenta:Number(e.kilos)||0,medida:e.medida,precioVenta:i,totalVenta:(Number(e.kilos)||0)*i,ganancia:(Number(e.kilos)||0)*i-(Number(e.kilos)||0)*(Number(e.costo)||0)}})},async removeItem(t){try{this.items.splice(t,1),this.itemsVenta.splice(t,1),this.showMobileActions=!1}catch(e){console.error("Error al eliminar item:",e)}},editField(t,e){this.editingField={index:t,field:e},this.$nextTick(()=>{var t;this.$refs.editInput&&(null===(t=this.$refs.editInput[0])||void 0===t||t.focus())})},finishEditing(){const{index:t,field:e}=this.editingField;if(null!==t&&null!==e)try{const a=this.items[t];"kilos"!==e&&"costo"!==e||(a[e]=parseFloat(a[e])||0),a.total=a.kilos*a.costo,this.actualizarItemsVenta()}catch(a){console.error("Error al finalizar edición:",a)}this.editingField={index:null,field:null}},addNewProduct(){var t;if(!this.newProduct.kilosVenta||!this.newProduct.medida||!this.newProduct.precioVenta)return void alert("Por favor complete todos los campos");const e=this.newProduct.kilosVenta*this.newProduct.precioVenta;this.itemsVenta.push({...this.newProduct,totalVenta:e,ganancia:e-this.newProduct.kilosVenta*((null===(t=this.items[this.itemsVenta.length])||void 0===t?void 0:t.costo)||0)}),this.showAddProductModal=!1,this.newProduct={kilosVenta:null,medida:"",precioVenta:null}},calcularTotalVenta(t){const e=this.itemsVenta[t];if(e)try{const a=parseFloat(e.kilosVenta)||0,o=parseFloat(e.precioVenta)||0;e.totalVenta=a*o;const i=this.items[t],s=i&&i.total||0;e.ganancia=(e.totalVenta||0)-s,this.actualizarItemsVenta()}catch(a){console.error("Error al calcular total de venta:",a)}},imprimirTablas(){window.print()},addCobro(){this.cobros.push({descripcion:"Flete",monto:0})},removeCobro(t){this.cobros.splice(t,1)},addAbono(){this.abonos.push({descripcion:"",monto:0})},removeAbono(t){this.abonos.splice(t,1)},startLongPress(t,e){this.longPressTimer=setTimeout(()=>{this.showMobileActions=!0,this.selectedItemIndex=t,this.selectedField=e},500)},endLongPress(){clearTimeout(this.longPressTimer)},cancelMobileActions(){this.showMobileActions=!1,this.selectedItemIndex=null,this.selectedField=null},editItem(t){this.editingItem={...this.items[t]},this.editingIndex=t,this.showEditModal=!0,this.showMobileActions=!1},saveEditedItem(){null!==this.editingIndex&&this.editingItem&&(this.editingItem.total=this.editingItem.kilos*this.editingItem.costo,this.items[this.editingIndex]={...this.editingItem},this.actualizarItemsVenta()),this.showEditModal=!1,this.editingItem=null,this.editingIndex=null},cancelEdit(){this.showEditModal=!1,this.editingItem=null,this.editingIndex=null},editKilos(t){this.editingKilosIndex=t,this.$nextTick(()=>{var t;this.$refs.kilosInput&&(null===(t=this.$refs.kilosInput[0])||void 0===t||t.focus())})},finishEditingKilos(){this.editingKilosIndex=null,this.calcularTotalVenta(this.editingKilosIndex)},toggleGananciasMobile(t){window.innerWidth<=600&&(this.selectedRowIndex=this.selectedRowIndex===t?null:t)},debounceGuardarSilencioso(t){this.debounceTimers[t]&&clearTimeout(this.debounceTimers[t]),this.debounceTimers[t]=setTimeout(()=>{this.guardarSilencioso(),delete this.debounceTimers[t]},1e3)},async guardarSilencioso(){try{const t=this.$route.params.id,e="true"===this.$route.query.edit;if(t&&e){if(this.isSaving)return void this.saveQueue.push(!0);const e=Date.now();if(this.lastSaveTime&&e-this.lastSaveTime<this.saveMinInterval)return void(this.autoSaveTimer||(this.autoSaveTimer=setTimeout(()=>{this.guardarSilencioso()},this.saveMinInterval-(e-this.lastSaveTime))));this.isSaving=!0,this.lastSaveTime=e;const a={items:this.items.map(t=>({kilos:Number(t.kilos)||0,medida:String(t.medida||""),costo:Number(t.costo)||0,total:Number(t.kilos*t.costo)||0})),itemsVenta:this.itemsVenta.map(t=>({kilosVenta:Number(t.kilosVenta)||0,medida:String(t.medida||""),precioVenta:Number(t.precioVenta)||0,totalVenta:Number(t.kilosVenta*t.precioVenta)||0,ganancia:Number(t.ganancia)||0})),totalGeneral:Number(this.totalGeneral)||0,totalGeneralVenta:Number(this.totalGeneralVenta)||0,gananciaDelDia:Number(this.gananciaDelDia)||0,ultimaActualizacion:(new Date).toISOString()},o=Object(et["e"])(P["a"],"cuentasJoselito",t);await Object(et["o"])(o,a),this.isSaving=!1,this.saveQueue.length>0&&(this.saveQueue.shift(),setTimeout(()=>{this.guardarSilencioso()},100))}}catch(t){console.error("Error al guardar silenciosamente:",t),this.isSaving=!1}},async guardarCuenta(){try{const t=this.$route.params.id,e="true"===this.$route.query.edit,a={fecha:this.fechaSeleccionada,items:this.items.map(t=>({kilos:Number(t.kilos)||0,medida:String(t.medida||""),costo:Number(t.costo)||0,total:Number(t.kilos*t.costo)||0})),itemsVenta:this.itemsVenta.map(t=>({kilosVenta:Number(t.kilosVenta)||0,medida:String(t.medida||""),precioVenta:Number(t.precioVenta)||0,totalVenta:Number(t.kilosVenta*t.precioVenta)||0,ganancia:Number(t.ganancia)||0})),saldoAcumuladoAnterior:Number(this.saldoAcumuladoAnterior)||0,cobros:this.cobros,abonos:this.abonos,totalGeneral:Number(this.totalGeneral)||0,totalGeneralVenta:Number(this.totalGeneralVenta)||0,totalDia:Number(this.totalDiaActual)||0,nuevoSaldoAcumulado:Number(this.nuevoSaldoAcumulado)||0,gananciaDelDia:Number(this.gananciaDelDia)||0,estadoPagado:Boolean(this.totalDiaActual<=0),tieneObservacion:this.tieneObservacion,observacion:this.observacion,ultimaActualizacion:(new Date).toISOString()};let o;return t&&e?(o=Object(et["e"])(P["a"],"cuentasJoselito",t),await Object(et["o"])(o,a),console.log("Documento actualizado exitosamente:",t)):(o=await Object(et["b"])(Object(et["c"])(P["a"],"cuentasJoselito"),a),console.log("Nuevo documento creado:",o.id),await this.$router.push({name:"CuentasJoselito",params:{id:o.id},query:{edit:"true"}})),setTimeout(()=>{this.actualizarCuentasPosteriores(this.fechaSeleccionada).catch(t=>console.error("Error al actualizar cuentas posteriores:",t))},100),alert("Cuenta guardada exitosamente"),o.id}catch(t){throw console.error("Error al guardar la cuenta:",t),alert("Error al guardar la cuenta: "+t.message),t}},agregarObservacion(){this.showObservacionModal=!0},guardarObservacion(){this.observacion.trim()&&(this.tieneObservacion=!0),this.showObservacionModal=!1},cancelarObservacion(){this.tieneObservacion||(this.observacion=""),this.showObservacionModal=!1},editarObservacion(){this.showObservacionModal=!0},eliminarObservacion(){confirm("¿Estás seguro de que deseas eliminar esta observación?")&&(this.observacion="",this.tieneObservacion=!1)},handleDataChange(){this.$route.params.id&&"true"===this.$route.query.edit&&(this.autoSaveTimer&&clearTimeout(this.autoSaveTimer),this.autoSaveTimer=setTimeout(async()=>{await this.queueSave()},2e3))},async queueSave(){this.saveQueue.push({timestamp:Date.now(),operation:async()=>{await this.autoSaveNota()}}),this.isSaving||await this.processSaveQueue()},async processSaveQueue(){if(!this.isSaving&&0!==this.saveQueue.length){this.isSaving=!0;try{while(this.saveQueue.length>0){const t=Date.now();this.lastSaveTime&&t-this.lastSaveTime<this.saveMinInterval&&await new Promise(e=>setTimeout(e,this.saveMinInterval-(t-this.lastSaveTime)));const e=this.saveQueue[0];await this.retryOperation(e.operation),this.lastSaveTime=Date.now(),this.saveQueue.shift()}}catch(t){console.error("Error procesando cola de guardado:",t),"resource-exhausted"===t.code&&(await new Promise(t=>setTimeout(t,1e4)),await this.processSaveQueue())}finally{this.isSaving=!1}}},async retryOperation(t,e=3){let a=0;while(a<e)try{return await t()}catch(o){if(a++,console.error(`Error en operación (intento ${a}/${e}):`,o),"resource-exhausted"===o.code?await new Promise(t=>setTimeout(t,5e3*Math.pow(2,a))):await new Promise(t=>setTimeout(t,1e3*Math.pow(2,a))),a>=e)throw console.error("Se alcanzó el número máximo de intentos. Operación fallida."),o}},async autoSaveNota(){if(this.$route.params.id)try{const t={items:this.items.map(t=>({kilos:Number(t.kilos)||0,medida:String(t.medida||""),costo:Number(t.costo)||0,total:Number(t.kilos*t.costo)||0})),itemsVenta:this.itemsVenta.map(t=>({kilosVenta:Number(t.kilosVenta)||0,medida:String(t.medida||""),precioVenta:Number(t.precioVenta)||0,totalVenta:Number(t.totalVenta)||0,ganancia:Number(t.ganancia)||0})),totalGeneral:Number(this.totalGeneral)||0,totalGeneralVenta:Number(this.totalGeneralVenta)||0,nuevoSaldoAcumulado:Number(this.nuevoSaldoAcumulado)||0,cobros:this.cobros,abonos:this.abonos,estadoPagado:"Pagado"===this.estadoCuenta,tieneObservacion:Boolean(this.observacion&&this.observacion.trim()),observacion:String(this.observacion||""),ultimaActualizacion:(new Date).toISOString()};await Object(et["o"])(Object(et["e"])(P["a"],"cuentasJoselito",this.$route.params.id),t),this.lastSaveMessage="Guardado automático: "+(new Date).toLocaleTimeString(),this.showSaveMessage=!0,this.saveMessageTimer&&clearTimeout(this.saveMessageTimer),this.saveMessageTimer=setTimeout(()=>{this.showSaveMessage=!1},3e3),console.log("Cuenta auto-guardada exitosamente:",(new Date).toLocaleTimeString())}catch(t){if("resource-exhausted"===t.code)throw t;throw console.error("Error en auto-guardado:",t),t}}},created(){const t=this.$route.params.id,e="true"===this.$route.query.edit;t&&e&&this.loadExistingCuenta(t)},watch:{$route(t,e){const a=t.params.id,o="true"===t.query.edit;a&&o?this.loadExistingCuenta(a):(this.items=[],this.itemsVenta=[],this.saldoAcumuladoAnterior=0,this.cobros=[],this.abonos=[],this.fechaSeleccionada=this.obtenerFechaActual(),this.estadoPagado=!1)},tieneObservacion(t){t&&(this.showObservacionModal=!0)},items:{handler:"handleDataChange",deep:!0},itemsVenta:{handler:"handleDataChange",deep:!0},cobros:{handler:"handleDataChange",deep:!0},abonos:{handler:"handleDataChange",deep:!0},fechaSeleccionada:{handler:"handleDataChange"},saldoAcumuladoAnterior:{handler:"handleDataChange"},observacion:"handleDataChange"},beforeUnmount(){this.autoSaveTimer&&clearTimeout(this.autoSaveTimer),Object.values(this.debounceTimers).forEach(t=>{clearTimeout(t)}),this.saveQueue.length>0&&this.processSaveQueue()}},aa=ea,oa=(a("bb0d"),Object(d["a"])(aa,Ze,ta,!1,null,"59ae21b8",null)),ia=oa.exports,sa=function(){var t=this,e=t._self._c;return e("div",{staticClass:"embarques-menu"},[e("h1",[t._v("Menú de Embarques")]),e("div",{staticClass:"menu-options"},[e("button",{staticClass:"btn-nuevo-embarque",on:{click:t.nuevoEmbarque}},[t._v("Nuevo Embarque")]),e("button",{staticClass:"btn-fletes",on:{click:t.mostrarFletes}},[t._v("Fletes")]),e("button",{staticClass:"btn-cuenta-fletes",on:{click:t.verCuentaFletes}},[t._v("Cuenta de Fletes")])]),e("ListaEmbarques"),t.modalFletesVisible?e("div",{staticClass:"modal-fletes",on:{click:t.cerrarModalFletes}},[e("div",{staticClass:"modal-contenido",on:{click:function(t){t.stopPropagation()}}},[e("div",{staticClass:"modal-header"},[e("h2",[t._v("Fletes de Joselito")]),e("button",{staticClass:"btn-cerrar",on:{click:t.cerrarModalFletes}},[t._v("×")])]),e("div",{staticClass:"modal-body"},[t.cargandoFletes?e("div",{staticClass:"cargando"},[t._v("Cargando fletes...")]):0===t.fletes.length?e("div",{staticClass:"sin-fletes"},[t._v("No hay fletes registrados.")]):e("div",{staticClass:"tabla-fletes-container"},[e("table",{staticClass:"tabla-fletes"},[t._m(0),e("tbody",t._l(t.fletes,(function(a){return e("tr",{key:a.fecha},[e("td",[t._v(t._s(t.formatearFecha(a.fecha)))]),e("td",[t._v(t._s(a.tarasLimpio))]),e("td",[t._v(t._s(a.tarasCrudo))]),e("td",[t._v(t._s(a.tarasLimpio+a.tarasCrudo))]),e("td",[t._v(t._s(a.cargaCon))])])})),0)])])])])]):t._e()],1)},ra=[function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",[t._v("Fecha")]),e("th",[t._v("Taras Limpio")]),e("th",[t._v("Taras Crudo")]),e("th",[t._v("Total Taras")]),e("th",[t._v("Cargó")])])])}],na=function(){var t=this,e=t._self._c;return e("div",{staticClass:"lista-embarques"},[t.cargando?e("div",{staticClass:"cargando"},[t._v("Cargando embarques...")]):t.error?e("div",{staticClass:"error"},[t._v(t._s(t.error))]):e("div",[t.embarques.length>0?e("table",{staticClass:"tabla-embarques"},[t._m(0),e("tbody",t._l(t.embarques,(function(a){return e("tr",{key:a.id,class:{"fila-bloqueada":a.embarqueBloqueado}},[e("td",[t._v(" "+t._s(t.formatearFecha(a.fecha))+" "),a.embarqueBloqueado?e("span",{staticClass:"indicador-bloqueado",attrs:{title:"Este embarque está bloqueado"}},[t._v("🔒")]):t._e()]),e("td",[t._v(t._s(t.calcularKilosLimpios(a))+" kg")]),e("td",[t._v(t._s(t.calcularKilosCrudos(a))+" kg")]),e("td",[t._v(t._s((Number(t.calcularKilosLimpios(a))+Number(t.calcularKilosCrudos(a))).toFixed(1))+" kg")]),e("td",[t._v(t._s(t.calcularTotalTaras(a)))]),e("td",[e("button",{staticClass:"btn-detalles",on:{click:function(e){return t.editarEmbarque(a.id)}}},[t._v("Editar")]),e("button",{staticClass:"btn-eliminar",class:{"btn-deshabilitado":a.embarqueBloqueado},attrs:{title:a.embarqueBloqueado?"Este embarque está bloqueado y no puede ser eliminado":""},on:{click:function(e){a.embarqueBloqueado?t.mostrarMensajeBloqueado():t.eliminarEmbarque(a.id)}}},[t._v("Eliminar")])])])})),0)]):e("div",{staticClass:"sin-embarques"},[t._v("No hay embarques registrados.")])])])},ca=[function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",[t._v("Fecha")]),e("th",[t._v("Kilos Limpios")]),e("th",[t._v("Kilos Crudos")]),e("th",[t._v("Total Kilos")]),e("th",[t._v("Total Taras")]),e("th",[t._v("Acciones")])])])}],la={name:"ListaEmbarques",data(){return{embarques:[],cargando:!0,error:null}},methods:{async cargarEmbarques(){try{const t=Object(et["h"])(),e=Object(et["c"])(t,"embarques"),a=await Object(et["g"])(e);this.embarques=a.docs.map(t=>{const e=t.data();let a=!1;void 0!==e.embarqueBloqueado&&("boolean"===typeof e.embarqueBloqueado?a=e.embarqueBloqueado:"string"===typeof e.embarqueBloqueado?a=["true","1","si","yes","verdadero"].includes(e.embarqueBloqueado.toLowerCase()):"number"===typeof e.embarqueBloqueado&&(a=0!==e.embarqueBloqueado));const o={id:t.id,...e,embarqueBloqueado:a};return console.log(`Embarque ID: ${o.id}, Bloqueado: ${o.embarqueBloqueado}, Valor original: ${e.embarqueBloqueado}, Tipo original: ${typeof e.embarqueBloqueado}`),o}).sort((t,e)=>{const a=t.fecha.toDate?t.fecha.toDate():new Date(t.fecha),o=e.fecha.toDate?e.fecha.toDate():new Date(e.fecha);return o-a}),this.cargando=!1}catch(t){console.error("Error al cargar los embarques:",t),this.error="Hubo un error al cargar los embarques. Por favor, intente de nuevo más tarde.",this.cargando=!1}},formatearFecha(t){if(!t)return"Fecha no disponible";const e=t.toDate?t.toDate():new Date(t);return e.setDate(e.getDate()+1),e.toLocaleDateString("es-ES")},calcularTotalKilos(t){let e=0;return t.clientes.forEach(t=>{t.productos.forEach(t=>{if("c/h20"===t.tipo){const a=t.reporteTaras||[],o=t.reporteBolsas||[];let i=0;for(let t=0;t<a.length;t++){const e=parseInt(a[t])||0,s=parseInt(o[t])||0;i+=e*s}const s=i*(t.camaronNeto||.65);e+=s}else{const a=(t.kilos||[]).reduce((t,e)=>t+(Number(e)||0),0),o=this.calcularTotalTarasProducto(t),i=t.restarTaras?3*o:0;e+=a-i}})}),e.toFixed(1)},calcularTotalTaras(t){let e=0;const a=["OTILIO","JOSELITO","CATARRO","OZUNA"];return t.clientes.forEach(t=>{a.includes(t.nombre.toUpperCase())&&(t.productos.forEach(t=>{e+=this.calcularTotalTarasProducto(t)}),t.crudos&&t.crudos.forEach(t=>{t.items.forEach(t=>{if(t.taras){const[a]=t.taras.split("-").map(Number);e+=a||0}if(t.sobrante){const[a]=t.sobrante.split("-").map(Number);e+=a||0}})}))}),e},calcularTotalTarasProducto(t){const e=(t.taras||[]).reduce((t,e)=>t+(Number(e)||0),0),a=(t.tarasExtra||[]).reduce((t,e)=>t+(Number(e)||0),0);return e+a},verDetalles(t){console.log("Navegando a detalles del embarque:",t),this.$router.push({name:"DetallesEmbarque",params:{id:t}})},editarEmbarque(t){this.$router.push({name:"NuevoEmbarque",params:{id:t}})},regresarAMenu(){this.$router.push({name:"EmbarquesMenu"})},async eliminarEmbarque(t){const e=this.embarques.find(e=>e.id===t);if(e&&e.embarqueBloqueado)alert("Este embarque está bloqueado y no puede ser eliminado.");else if(confirm("¿Estás seguro de que quieres eliminar este embarque?"))try{const e=Object(et["h"])();await Object(et["d"])(Object(et["e"])(e,"embarques",t)),this.embarques=this.embarques.filter(e=>e.id!==t),alert("Embarque eliminado con éxito")}catch(a){console.error("Error al eliminar el embarque:",a),alert("Hubo un error al eliminar el embarque. Por favor, intente de nuevo.")}},calcularKilosLimpios(t){let e=0;return t.clientes.forEach(t=>{t.productos.forEach(t=>{if("c/h20"===t.tipo){const a=t.reporteTaras||[],o=t.reporteBolsas||[];let i=0;for(let t=0;t<a.length;t++){const e=parseInt(a[t])||0,s=parseInt(o[t])||0;i+=e*s}const s=i*(t.camaronNeto||.65);e+=s}else{const a=(t.kilos||[]).reduce((t,e)=>t+(Number(e)||0),0),o=this.calcularTotalTarasProducto(t),i=t.restarTaras?3*o:0;e+=a-i}})}),e.toFixed(1)},calcularKilosCrudos(t){let e=0;return t.clientes.forEach(t=>{t.crudos&&t.crudos.forEach(t=>{t.items.forEach(t=>{if(t.taras){const[a,o]=t.taras.split("-").map(Number);e+=(a||0)*(o||0)}if(t.sobrante){const[a,o]=t.sobrante.split("-").map(Number);e+=(a||0)*(o||0)}})})}),e.toFixed(1)},mostrarMensajeBloqueado(){alert("Este embarque está bloqueado y no puede ser eliminado.")}},mounted(){this.cargarEmbarques()},created(){this.$nextTick(()=>{setTimeout(()=>{this.embarques.length>0&&(console.log("Verificando estado de bloqueo de embarques:"),this.embarques.forEach(t=>{console.log(`ID: ${t.id}, Bloqueado: ${t.embarqueBloqueado}, Tipo: ${typeof t.embarqueBloqueado}`)}))},1e3)})}},da=la,ua=(a("c98c"),Object(d["a"])(da,na,ca,!1,null,"b6f12a94",null)),ma=ua.exports,pa={name:"EmbarquesMenu",components:{ListaEmbarques:ma},data(){return{modalFletesVisible:!1,fletes:[],cargandoFletes:!1}},methods:{nuevoEmbarque(){this.$router.push({name:"NuevoEmbarque",params:{id:"nuevo"}})},mostrarFletes(){this.modalFletesVisible=!0,this.cargarFletes()},verCuentaFletes(){this.$router.push({name:"CuentaFletes"})},cerrarModalFletes(){this.modalFletesVisible=!1},async cargarFletes(){this.cargandoFletes=!0;try{const t=Object(et["h"])(),e=Object(et["c"])(t,"embarques"),a=await Object(et["g"])(e),o=a.docs.map(t=>{var e;const a=t.data();let o=a.fecha.toDate?a.fecha.toDate():new Date(a.fecha);const i=null===(e=a.clientes)||void 0===e?void 0:e.find(t=>"1"===t.id||1===t.id||"Joselito"===t.nombre);if(i){let t=0,e=0;return i.productos&&Array.isArray(i.productos)&&(t=i.productos.reduce((t,e)=>{let a=0;return Array.isArray(e.taras)&&(a+=e.taras.reduce((t,e)=>t+(parseInt(e)||0),0)),Array.isArray(e.tarasExtra)&&(a+=e.tarasExtra.reduce((t,e)=>t+(parseInt(e)||0),0)),t+a},0)),i.crudos&&Array.isArray(i.crudos)&&(e=i.crudos.reduce((t,e)=>Array.isArray(e.items)?t+e.items.reduce((t,e)=>{let a=0;if(e.taras){const[t]=e.taras.split("-");a+=parseInt(t)||0}if(e.sobrante){const[t]=e.sobrante.split("-");a+=parseInt(t)||0}return t+a},0):t,0)),{fecha:o,tarasLimpio:t,tarasCrudo:e,cargaCon:a.cargaCon||"No especificado"}}return null}).filter(t=>null!==t).sort((t,e)=>e.fecha-t.fecha);console.log("Fletes procesados:",o),this.fletes=o}catch(t){console.error("Error al cargar los fletes:",t)}finally{this.cargandoFletes=!1}},formatearFecha(t){const e=new Date(t);return e.setDate(e.getDate()+1),e.toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"})}}},ha=pa,va=(a("1097"),Object(d["a"])(ha,sa,ra,!1,null,"41198324",null)),ba=va.exports,fa=function(){var t=this,e=t._self._c;return e("div",{staticClass:"ventas-ganancias-catarro"},[e("div",{staticClass:"header"},[e("button",{staticClass:"back-button",on:{click:t.volverAlMenu}},[t._v("Volver")]),e("h2",[t._v("Análisis de Ventas y Ganancias - Catarro")])]),e("div",{staticClass:"filtros"},[e("label",{attrs:{for:"periodo-select"}},[t._v("Seleccionar período:")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.periodoSeleccionado,expression:"periodoSeleccionado"}],attrs:{id:"periodo-select"},on:{change:[function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.periodoSeleccionado=e.target.multiple?a:a[0]},t.cargarDatos]}},[e("option",{attrs:{value:"semanal"}},[t._v("Semanal")]),e("option",{attrs:{value:"mensual"}},[t._v("Mensual")])])]),e("div",{staticClass:"graficas"},[e("div",{staticClass:"grafica"},[e("h3",[t._v("Ventas "+t._s("semanal"===t.periodoSeleccionado?"Semanales":"Mensuales"))]),e("canvas",{ref:"ventasChart"})]),e("div",{staticClass:"grafica"},[e("h3",[t._v("Ganancias "+t._s("semanal"===t.periodoSeleccionado?"Semanales":"Mensuales"))]),e("canvas",{ref:"gananciasChart"})])]),e("div",{staticClass:"resumen"},[e("h3",[t._v("Resumen")]),e("p",[t._v("Total de ventas: $"+t._s(t.formatNumber(t.totalVentas)))]),e("p",[t._v("Total de ganancias: $"+t._s(t.formatNumber(t.totalGanancias)))]),e("p",[t._v("Promedio de ventas por "+t._s("semanal"===t.periodoSeleccionado?"semana":"mes")+": $"+t._s(t.formatNumber(t.promedioVentas)))]),e("p",[t._v("Promedio de ganancias por "+t._s("semanal"===t.periodoSeleccionado?"semana":"mes")+": $"+t._s(t.formatNumber(t.promedioGanancias)))])])])},ga=[],Ca=a("796e"),_a={name:"VentasYGananciasCatarro",data(){return{periodoSeleccionado:"semanal",ventas:[],ganancias:[],totalVentas:0,totalGanancias:0,promedioVentas:0,promedioGanancias:0,ventasChart:null,gananciasChart:null,periodos:[]}},mounted(){this.cargarDatos()},methods:{async cargarDatos(){try{const t=Object(et["c"])(P["a"],"cuentasCatarro"),e=Object(et["l"])(t,Object(et["k"])("fecha","desc")),a=await Object(et["g"])(e),o=a.docs.map(t=>{const e=t.data();return{fecha:new Date(e.fecha),ventas:e.totalGeneralVenta||0,ganancias:this.calcularGanancias(e),estadoPagado:e.estadoPagado||!1}});this.procesarDatos(o),this.crearGraficas()}catch(t){console.error("Error al cargar datos:",t)}},procesarDatos(t){const e="semanal"===this.periodoSeleccionado?this.procesarDatosSemanal(t):this.procesarDatosMensual(t);this.periodos=e.map(t=>t.periodo),this.ventas=e.map(t=>t.ventas),this.ganancias=e.map(t=>t.ganancias),this.totalVentas=this.ventas.reduce((t,e)=>t+e,0),this.totalGanancias=this.ganancias.reduce((t,e)=>t+e,0),this.promedioVentas=this.totalVentas/this.ventas.length,this.promedioGanancias=this.totalGanancias/this.ganancias.length},procesarDatosSemanal(t){const e=t.reduce((t,e)=>{const a=this.obtenerNumeroSemana(e.fecha);return t[a]||(t[a]={ventas:0,ganancias:0}),t[a].ventas+=e.ventas,t[a].ganancias+=e.ganancias,t},{});return Object.entries(e).map(([t,e])=>({periodo:"Semana "+t,...e}))},procesarDatosMensual(t){const e=t.reduce((t,e)=>{const a=e.fecha.toLocaleString("default",{month:"long",year:"numeric"});return t[a]||(t[a]={ventas:0,ganancias:0}),t[a].ventas+=e.ventas,t[a].ganancias+=e.ganancias,t},{}),a=t.map(t=>t.fecha),o=new Date(Math.min.apply(null,a)),i=new Date(Math.max.apply(null,a)),s=this.obtenerMesesEntreFechas(o,i);return s.map(t=>({periodo:t,ventas:e[t]?e[t].ventas:0,ganancias:e[t]?e[t].ganancias:0})).sort((t,e)=>new Date(t.periodo)-new Date(e.periodo))},obtenerMesesEntreFechas(t,e){const a=[],o=new Date(t.getFullYear(),t.getMonth(),1);while(o<=e)a.push(o.toLocaleString("default",{month:"long",year:"numeric"})),o.setMonth(o.getMonth()+1);return a},obtenerNumeroSemana(t){const e=new Date(t.getFullYear(),0,1);return Math.ceil(((t-e)/864e5+e.getDay()+1)/7)},crearGraficas(){this.crearGrafica("ventasChart","Ventas",this.ventas,"#4CAF50"),this.crearGrafica("gananciasChart","Ganancias",this.ganancias,"#2196F3")},crearGrafica(t,e,a,o){const i=this.$refs[t].getContext("2d");this[t]&&this[t].destroy(),this[t]=new Ca["a"](i,{type:"bar",data:{labels:this.periodos,datasets:[{label:e,data:a,backgroundColor:o,borderColor:o,borderWidth:1}]},options:{responsive:!0,scales:{y:{beginAtZero:!0,ticks:{callback:function(t){return"$"+t.toLocaleString()}}}},plugins:{tooltip:{callbacks:{label:function(t){let e=t.dataset.label||"";return e&&(e+=": "),null!==t.parsed.y&&(e+="$"+t.parsed.y.toLocaleString()),e}}}}}})},formatNumber(t){return"number"!==typeof t?"0.00":t.toLocaleString("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2})},volverAlMenu(){this.$router.push("/cuentas-catarro")},calcularGanancias(t){return t.estadoPagado&&t.gananciaDelDia||0}}},ya=_a,wa=(a("535b"),Object(d["a"])(ya,fa,ga,!1,null,"cee72e80",null)),ka=wa.exports,Aa=function(){var t=this,e=t._self._c;return e("div",{staticClass:"ventas-ganancias-container"},[e("div",{staticClass:"back-button-container"},[e("BackButton",{attrs:{to:"/cuentas-joselito"}})],1),e("h1",[t._v("Ventas y Ganancias de Joselito")]),e("div",{staticClass:"date-range-selector"},[e("div",{staticClass:"date-input"},[e("label",[t._v("Fecha Inicial:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.fechaInicial,expression:"fechaInicial"}],attrs:{type:"date"},domProps:{value:t.fechaInicial},on:{input:function(e){e.target.composing||(t.fechaInicial=e.target.value)}}})]),e("div",{staticClass:"date-input"},[e("label",[t._v("Fecha Final:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.fechaFinal,expression:"fechaFinal"}],attrs:{type:"date"},domProps:{value:t.fechaFinal},on:{input:function(e){e.target.composing||(t.fechaFinal=e.target.value)}}})]),e("button",{staticClass:"search-btn",on:{click:t.buscarVentas}},[t._v("Buscar")])]),t.isLoading?e("div",{staticClass:"loading"},[t._v(" Cargando datos... ")]):e("div",[e("div",{staticClass:"summary-cards"},[e("div",{staticClass:"summary-card"},[e("h3",[t._v("Total Ventas")]),e("p",[t._v("$"+t._s(t.formatNumber(t.totalVentas)))])]),e("div",{staticClass:"summary-card"},[e("h3",[t._v("Total Costos")]),e("p",[t._v("$"+t._s(t.formatNumber(t.totalCostos)))])]),e("div",{staticClass:"summary-card"},[e("h3",[t._v("Ganancia Total")]),e("p",{class:{positive:t.gananciaTotal>0,negative:t.gananciaTotal<0}},[t._v(" $"+t._s(t.formatNumber(t.gananciaTotal))+" ")])])]),e("div",{staticClass:"ventas-table"},[e("h2",[t._v("Detalle de Ventas por Fecha")]),e("table",[t._m(0),e("tbody",t._l(t.ventasPorFecha,(function(a){return e("tr",{key:a.fecha},[e("td",[t._v(t._s(t.formatDate(a.fecha)))]),e("td",[t._v("$"+t._s(t.formatNumber(a.ventas)))]),e("td",[t._v("$"+t._s(t.formatNumber(a.costos)))]),e("td",{class:{positive:a.ganancia>0,negative:a.ganancia<0}},[t._v(" $"+t._s(t.formatNumber(a.ganancia))+" ")])])})),0)])]),e("div",{staticClass:"print-section"},[e("button",{staticClass:"print-btn",on:{click:t.imprimirReporte}},[t._v(" Imprimir Reporte ")])])])])},Pa=[function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",[t._v("Fecha")]),e("th",[t._v("Ventas")]),e("th",[t._v("Costos")]),e("th",[t._v("Ganancia")])])])}],xa={name:"VentasYGananciasJoselito",components:{BackButton:dt["a"]},data(){return{fechaInicial:"",fechaFinal:"",ventasPorFecha:[],isLoading:!1}},computed:{totalVentas(){return this.ventasPorFecha.reduce((t,e)=>t+e.ventas,0)},totalCostos(){return this.ventasPorFecha.reduce((t,e)=>t+e.costos,0)},gananciaTotal(){return this.totalVentas-this.totalCostos}},methods:{async buscarVentas(){if(this.fechaInicial&&this.fechaFinal){this.isLoading=!0;try{const t=Object(et["c"])(P["a"],"cuentasJoselito"),e=Object(et["l"])(t,Object(et["p"])("fecha",">=",this.fechaInicial),Object(et["p"])("fecha","<=",this.fechaFinal),Object(et["k"])("fecha","asc")),a=await Object(et["g"])(e);this.ventasPorFecha=a.docs.map(t=>{const e=t.data(),a=e.totalGeneralVenta||0,o=e.totalGeneral||0;return{fecha:e.fecha,ventas:a,costos:o,ganancia:a-o}})}catch(t){console.error("Error al buscar ventas:",t),alert("Error al cargar los datos")}finally{this.isLoading=!1}}else alert("Por favor seleccione ambas fechas")},formatNumber(t){return t.toLocaleString("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2})},formatDate(t){return new Date(t).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"})},imprimirReporte(){const t=`\n        <html>\n          <head>\n            <title>Reporte de Ventas y Ganancias - Joselito</title>\n            <style>\n              body {\n                font-family: Arial, sans-serif;\n                padding: 20px;\n              }\n              h1 { color: #2196F3; }\n              table {\n                width: 100%;\n                border-collapse: collapse;\n                margin: 20px 0;\n              }\n              th, td {\n                border: 1px solid #ddd;\n                padding: 8px;\n                text-align: left;\n              }\n              th { background-color: #f5f5f5; }\n              .total { font-weight: bold; }\n              .positive { color: #4CAF50; }\n              .negative { color: #f44336; }\n            </style>\n          </head>\n          <body>\n            <h1>Reporte de Ventas y Ganancias - Joselito</h1>\n            <p>Período: ${this.formatDate(this.fechaInicial)} - ${this.formatDate(this.fechaFinal)}</p>\n            \n            <h2>Resumen</h2>\n            <table>\n              <tr>\n                <th>Total Ventas</th>\n                <td>$${this.formatNumber(this.totalVentas)}</td>\n              </tr>\n              <tr>\n                <th>Total Costos</th>\n                <td>$${this.formatNumber(this.totalCostos)}</td>\n              </tr>\n              <tr class="total">\n                <th>Ganancia Total</th>\n                <td class="${this.gananciaTotal>0?"positive":"negative"}">\n                  $${this.formatNumber(this.gananciaTotal)}\n                </td>\n              </tr>\n            </table>\n\n            <h2>Detalle por Fecha</h2>\n            <table>\n              <thead>\n                <tr>\n                  <th>Fecha</th>\n                  <th>Ventas</th>\n                  <th>Costos</th>\n                  <th>Ganancia</th>\n                </tr>\n              </thead>\n              <tbody>\n                ${this.ventasPorFecha.map(t=>`\n                  <tr>\n                    <td>${this.formatDate(t.fecha)}</td>\n                    <td>$${this.formatNumber(t.ventas)}</td>\n                    <td>$${this.formatNumber(t.costos)}</td>\n                    <td class="${t.ganancia>0?"positive":"negative"}">\n                      $${this.formatNumber(t.ganancia)}\n                    </td>\n                  </tr>\n                `).join("")}\n              </tbody>\n            </table>\n          </body>\n        </html>\n      `,e=window.open("","_blank");e.document.write(t),e.document.close(),e.print()}},mounted(){const t=new Date;this.fechaFinal=t.toISOString().split("T")[0],t.setMonth(t.getMonth()-1),this.fechaInicial=t.toISOString().split("T")[0],this.buscarVentas()}},Sa=xa,Ta=(a("95c6"),Object(d["a"])(Sa,Aa,Pa,!1,null,"f6742926",null)),Oa=Ta.exports,Ma=function(){var t=this,e=t._self._c;return e("div",{staticClass:"nuevo-embarque-container"},[e("div",{staticClass:"sidebar-clientes",class:{"sidebar-collapsed":t.sidebarCollapsed}},[e("div",{staticClass:"sidebar-header"},[e("h3",[t._v("Clientes")]),e("button",{staticClass:"toggle-sidebar-btn",on:{click:t.toggleSidebar}},[e("i",{staticClass:"fas",class:t.sidebarCollapsed?"fa-chevron-right":"fa-chevron-left"})])]),e("div",{staticClass:"sidebar-clientes-contenido"},[t._l(t.clientesPredefinidos,(function(a){return e("button",{key:a.id,staticClass:"btn-nota-cliente",class:{activo:t.clienteActivo===a.id.toString()},style:{backgroundColor:a.color,color:a.textColor},attrs:{type:"button",title:t.sidebarCollapsed?a.nombre:""},on:{click:function(e){t.seleccionarCliente(a.id.toString())}}},[e("span",[t._v(t._s(a.nombre))])])})),t._l(t.clientesPersonalizadosEmbarque,(function(a){return e("button",{key:a.id,staticClass:"btn-nota-cliente cliente-personalizado",class:{activo:t.clienteActivo===a.id.toString()},style:{backgroundColor:t.obtenerColorCliente(a.nombre),color:t.obtenerColorTextoCliente(a.nombre)},attrs:{type:"button",title:t.sidebarCollapsed?a.nombre:""},on:{click:function(e){t.seleccionarCliente(a.id.toString())}}},[e("span",[t._v(t._s(a.nombre))])])})),e("button",{staticClass:"btn-agregar-cliente",attrs:{type:"button",title:t.sidebarCollapsed?"Agregar Cliente":""},on:{click:function(e){t.mostrarModalNuevoCliente=!0}}},[e("i",{staticClass:"fas fa-plus"}),t.sidebarCollapsed?t._e():e("span",[t._v("Agregar Cliente")])])],2),e("div",{staticClass:"sidebar-toggle-mobile"},[e("button",{staticClass:"toggle-sidebar-mobile-btn",on:{click:t.toggleSidebar}},[e("i",{staticClass:"fas",class:t.sidebarCollapsed?"fa-chevron-right":"fa-chevron-left"})])]),e("div",{staticClass:"sidebar-resumen"},[e("h4",[t._v("Resumen Taras")]),e("div",{staticClass:"sidebar-item"},[e("span",[t._v("Limpio:")]),e("strong",[t._v(t._s(t.calcularTarasLimpio()))])]),e("div",{staticClass:"sidebar-item"},[e("span",[t._v("Crudo:")]),e("strong",[t._v(t._s(t.calcularTarasCrudo()))])]),e("div",{staticClass:"sidebar-item total"},[e("span",[t._v("Total:")]),e("strong",[t._v(t._s(t.calcularTotalTaras())+"-T")])]),e("h4",[t._v("Resumen Kilos")]),e("div",{staticClass:"sidebar-item"},[e("span",[t._v("Limpio:")]),e("strong",[t._v(t._s(Math.floor(t.calcularKilosLimpio())))])]),e("div",{staticClass:"sidebar-item"},[e("span",[t._v("Crudo:")]),e("strong",[t._v(t._s(t.calcularKilosCrudo()))])]),e("div",{staticClass:"sidebar-item total"},[e("span",[t._v("Total:")]),e("strong",[t._v(t._s(Math.floor(t.calcularTotalKilos())))])])])]),e("div",{staticClass:"nuevo-embarque"},[e("h1",[t._v(t._s(t.modoEdicion?"Embarque":"Nuevo Embarque"))]),e("div",{staticClass:"botones"},[e("button",{staticClass:"btn-volver",on:{click:t.volverAEmbarquesMenu}},[e("i",{staticClass:"fas fa-arrow-left"}),t._v(" Volver a Menu ")]),e("button",{class:["btn-bloqueo",{bloqueado:t.embarqueBloqueado}],on:{click:t.toggleBloqueo}},[e("i",{class:["fas",t.embarqueBloqueado?"fa-lock":"fa-lock-open"]}),t._v(" "+t._s(t.embarqueBloqueado?"Desbloquear":"Bloquear")+" Embarque ")])]),e("div",{staticClass:"header"},[e("div",{staticClass:"header-row"},[e("div",{staticClass:"fecha-selector"},[e("label",{attrs:{for:"fecha"}},[t._v("Fecha de Embarque:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.embarque.fecha,expression:"embarque.fecha"}],staticClass:"form-control",attrs:{type:"date",id:"fecha",required:"",disabled:t.embarqueBloqueado},domProps:{value:t.embarque.fecha},on:{input:function(e){e.target.composing||t.$set(t.embarque,"fecha",e.target.value)}}})]),e("div",{staticClass:"carga-selector"},[e("label",{attrs:{for:"cargaCon"}},[t._v("Carga con:")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.embarque.cargaCon,expression:"embarque.cargaCon"}],staticClass:"form-control",attrs:{id:"cargaCon",required:"",disabled:t.embarqueBloqueado},on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(t.embarque,"cargaCon",e.target.multiple?a:a[0])}}},[e("option",{attrs:{value:""}},[t._v("Seleccionar")]),e("option",{attrs:{value:"Porro"}},[t._v("Porro")]),e("option",{attrs:{value:"Caminante"}},[t._v("Caminante")])])])])]),e("div",{staticClass:"botones-accion"},[e("button",{staticClass:"btn btn-info",attrs:{disabled:t.isGeneratingPdf},on:{click:t.generarResumenTarasPDF}},[t.isGeneratingPdf&&"taras"===t.pdfType?e("span",{staticClass:"loader-inline"}):e("i",{staticClass:"fas fa-file-pdf"}),t._v(" PDF Taras ")]),e("button",{staticClass:"btn btn-info",attrs:{disabled:t.isGeneratingPdf},on:{click:t.generarResumenEmbarque2}},[t.isGeneratingPdf&&"resumen"===t.pdfType?e("span",{staticClass:"loader-inline"}):e("i",{staticClass:"fas fa-file-pdf"}),t._v(" Resumen Embarque ")]),e("router-link",{staticClass:"btn btn-warning",class:{disabled:t.isGeneratingPdf},attrs:{to:{name:"Rendimientos",params:{id:t.embarqueId}}}},[e("i",{staticClass:"fas fa-chart-line"}),t._v(" Rendimientos ")])],1),e("div",{staticClass:"botones-undo-redo"},[e("button",{staticClass:"btn btn-secondary btn-sm",attrs:{type:"button",disabled:t.undoStack.length<=1},on:{click:t.undo}},[t._v("Deshacer")]),e("button",{staticClass:"btn btn-secondary btn-sm",attrs:{type:"button",disabled:0===t.redoStack.length},on:{click:t.redo}},[t._v("Rehacer")])]),e("form",{on:{submit:function(e){return e.preventDefault(),t.guardarEmbarque.apply(null,arguments)},keydown:function(e){if(!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;e.preventDefault()}}},t._l(t.productosPorCliente,(function(a,o){return e("div",{directives:[{name:"show",rawName:"v-show",value:t.clienteActivo===o||null===t.clienteActivo,expression:"clienteActivo === clienteId || clienteActivo === null"}],key:o,staticClass:"cliente-grupo"},[e("div",{staticClass:"cliente-header sticky-header",style:{},attrs:{"data-cliente":t.obtenerNombreCliente(o)}},[e("div",{staticClass:"cliente-info"},[e("h3",[t._v(" "+t._s(t.obtenerNombreCliente(o))+" "),e("button",{staticClass:"btn-pdf-mini",attrs:{type:"button",title:"Vista previa PDF"},on:{click:function(e){return e.stopPropagation(),t.generarNotaVenta(o)}}},[e("i",{staticClass:"fas fa-eye"})])]),e("div",{staticClass:"cliente-totales"},[e("span",[t._v("Limpio: "+t._s(t.calcularTotalLimpioCliente(o))+"T / "+t._s(t.formatearKilos(t.calcularKilosLimpioCliente(o)))+"Kg")]),e("span",[t._v("Crudo: "+t._s(t.calcularTotalCrudoCliente(o))+"T / "+t._s(t.formatearKilos(t.calcularKilosCrudoCliente(o)))+"Kg")])])]),e("div",{staticClass:"cliente-header-controls"},[e("div",{staticClass:"juntar-medidas-checkbox"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.clientesJuntarMedidas[o],expression:"clientesJuntarMedidas[clienteId]"}],attrs:{type:"checkbox",id:"juntar-medidas-"+o,disabled:t.embarqueBloqueado},domProps:{checked:Array.isArray(t.clientesJuntarMedidas[o])?t._i(t.clientesJuntarMedidas[o],null)>-1:t.clientesJuntarMedidas[o]},on:{change:[function(e){var a=t.clientesJuntarMedidas[o],i=e.target,s=!!i.checked;if(Array.isArray(a)){var r=null,n=t._i(a,r);i.checked?n<0&&t.$set(t.clientesJuntarMedidas,o,a.concat([r])):n>-1&&t.$set(t.clientesJuntarMedidas,o,a.slice(0,n).concat(a.slice(n+1)))}else t.$set(t.clientesJuntarMedidas,o,s)},function(e){return t.handleJuntarMedidasChange(o,e.target.checked)}],click:function(t){t.stopPropagation()}}}),e("label",{attrs:{for:"juntar-medidas-"+o},on:{click:function(t){t.stopPropagation()}}},[t._v("Juntar medidas")])]),e("button",{staticClass:"btn btn-primary btn-sm generar-pdf-cliente",attrs:{type:"button",title:"Generar Nota de Venta PDF",disabled:t.isGeneratingPdf},on:{click:function(e){return e.stopPropagation(),t.generarNotaVenta(o)}}},[t.isGeneratingPdf&&t.pdfType==="cliente-"+o?e("span",{staticClass:"loader-inline"}):e("i",{staticClass:"fas fa-file-pdf"}),t._v(" Generar Nota PDF ")]),e("button",{staticClass:"btn btn-danger btn-sm eliminar-cliente",attrs:{type:"button",disabled:t.embarqueBloqueado},on:{click:function(e){return e.stopPropagation(),t.eliminarCliente(o)}}},[t._v("Eliminar Cliente")])])]),e("div",{staticClass:"productos-container"},[t._l(a,(function(a,o){return e("div",{key:o,staticClass:"producto",class:{"reporte-completo":t.coincideTarasYBolsas(a),"reporte-incompleto":!t.coincideTarasYBolsas(a)&&t.tieneAlgunReporte(a)},attrs:{"data-es-venta":a.esVenta}},[e("h2",{staticClass:"encabezado-medida"},[e("div",{staticClass:"botones-encabezado"},[e("div",{staticClass:"botones-fila-superior"},[e("button",{staticClass:"btn-precio",class:{"tiene-precio":a.precio},on:{click:function(e){return t.abrirModalPrecio(a)}}},[t._v(" $ ")]),e("button",{staticClass:"btn-hilos",class:{"tiene-hilos":a.hilos},on:{click:function(e){return t.abrirModalHilos(a)}}},[t._v(" H ")])]),e("div",{staticClass:"botones-fila-inferior"},[e("button",{staticClass:"btn-nota",class:{"tiene-nota":a.nota},on:{click:function(e){return t.abrirModalNota(a)}}},[t._v(" N ")]),e("div",{staticClass:"kg-radio"},[e("input",{directives:[{name:"model",rawName:"v-model",value:a.noSumarKilos,expression:"producto.noSumarKilos"}],staticClass:"kg-checkbox",attrs:{type:"checkbox",id:"kg-"+a.id,disabled:t.embarqueBloqueado},domProps:{checked:Array.isArray(a.noSumarKilos)?t._i(a.noSumarKilos,null)>-1:a.noSumarKilos},on:{change:function(e){var o=a.noSumarKilos,i=e.target,s=!!i.checked;if(Array.isArray(o)){var r=null,n=t._i(o,r);i.checked?n<0&&t.$set(a,"noSumarKilos",o.concat([r])):n>-1&&t.$set(a,"noSumarKilos",o.slice(0,n).concat(o.slice(n+1)))}else t.$set(a,"noSumarKilos",s)}}}),e("label",{attrs:{for:"kg-"+a.id}},[t._v("kg")])])])]),e("span",{staticClass:"medida-texto",class:{disabled:t.embarqueBloqueado,"tiene-nombre-alternativo":a.nombreAlternativoPDF},on:{click:function(e){!t.embarqueBloqueado&&t.abrirModalNombreAlternativo(a)}}},["c/h20"===a.tipo?[t._v(" "+t._s(a.nombreAlternativoPDF||a.medida||"Sin Medida")+" "),e("span",{staticClass:"ch20-text"},[t._v("c/h20")]),a.nombreAlternativoPDF?e("span",{staticClass:"pdf-badge",attrs:{title:"Nombre personalizado para PDF"}},[t._v("PDF")]):t._e()]:[t._v(" "+t._s(a.nombreAlternativoPDF||a.medida||"Sin Medida")+" - "+t._s(t.obtenerTipoProducto(a))+" "),a.nombreAlternativoPDF?e("span",{staticClass:"pdf-badge",attrs:{title:"Nombre personalizado para PDF"}},[t._v("PDF")]):t._e()]],2),a.precio?e("span",{staticClass:"precio-tag"},[t._v("$"+t._s(a.precio))]):t._e()]),e("div",{staticClass:"producto-header"},[e("div",{staticClass:"medida-input-container"},[e("input",{directives:[{name:"model",rawName:"v-model",value:a.medida,expression:"producto.medida"}],staticClass:"medida-input",attrs:{type:"text",placeholder:"Medida",disabled:t.embarqueBloqueado},domProps:{value:a.medida},on:{input:[function(e){e.target.composing||t.$set(a,"medida",e.target.value)},function(e){return t.onMedidaInput(a,e)}],blur:function(e){return t.onMedidaBlur(a)}}}),e("button",{staticClass:"btn-alt",class:{"tiene-alt":a.textoAlternativo},attrs:{disabled:t.embarqueBloqueado},on:{click:function(e){return t.abrirModalAlt(a)}}},[t._v(" Alt ")]),t.productoEditandoId===a.id&&t.sugerenciasMedidas.length>0?e("div",{staticClass:"sugerencias-container"},t._l(t.sugerenciasMedidas,(function(o){return e("div",{key:o,staticClass:"sugerencia-item",on:{mousedown:function(e){return t.seleccionarMedida(a,o)}}},[t._v(" "+t._s(o)+" ")])})),0):t._e()]),e("select",{directives:[{name:"model",rawName:"v-model",value:a.tipo,expression:"producto.tipo"}],staticClass:"form-control tipo-select",class:{"tipo-azul":"c/h20"===a.tipo,"tipo-verde":"s/h20"===a.tipo},attrs:{disabled:t.embarqueBloqueado},on:{change:[function(e){var o=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(a,"tipo",e.target.multiple?o:o[0])},function(e){return t.onTipoChange(a)}]}},[e("option",{attrs:{value:""}},[t._v("Seleccionar")]),e("option",{attrs:{value:"s/h20"}},[t._v("S/H20")]),e("option",{attrs:{value:"c/h20"}},[t._v("C/H20")]),e("option",{attrs:{value:"otro"}},[t._v("Otro")])]),"Ozuna"===t.obtenerNombreCliente(a.clienteId)?e("div",{staticClass:"venta-checkbox-container"},[e("input",{directives:[{name:"model",rawName:"v-model",value:a.esVenta,expression:"producto.esVenta"}],staticClass:"form-check-input venta-checkbox",attrs:{type:"checkbox",id:"ventaCheck-"+a.id,disabled:t.embarqueBloqueado},domProps:{checked:Array.isArray(a.esVenta)?t._i(a.esVenta,null)>-1:a.esVenta},on:{change:function(e){var o=a.esVenta,i=e.target,s=!!i.checked;if(Array.isArray(o)){var r=null,n=t._i(o,r);i.checked?n<0&&t.$set(a,"esVenta",o.concat([r])):n>-1&&t.$set(a,"esVenta",o.slice(0,n).concat(o.slice(n+1)))}else t.$set(a,"esVenta",s)}}}),e("label",{attrs:{for:"ventaCheck-"+a.id}},[t._v("Venta")])]):t._e(),"c/h20"===a.tipo?e("div",{staticClass:"valores-container"},[e("div",{staticClass:"valor-neto-container"},[e("label",[t._v("Valor neto:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:a.camaronNeto,expression:"producto.camaronNeto"}],staticClass:"camaron-neto-input ios-numeric",attrs:{type:"number",step:"0.01",min:"0",max:"1",inputmode:"numeric",pattern:"[0-9]*",disabled:t.embarqueBloqueado},domProps:{value:a.camaronNeto},on:{input:function(e){e.target.composing||t.$set(a,"camaronNeto",e.target.value)}}})])]):t._e(),"otro"===a.tipo?e("input",{directives:[{name:"model",rawName:"v-model",value:a.tipoPersonalizado,expression:"producto.tipoPersonalizado"}],staticClass:"form-control tipo-input",attrs:{type:"text",placeholder:"Especificar",disabled:t.embarqueBloqueado},domProps:{value:a.tipoPersonalizado},on:{input:function(e){e.target.composing||t.$set(a,"tipoPersonalizado",e.target.value)}}}):t._e(),e("button",{staticClass:"btn btn-danger btn-sm eliminar-producto",attrs:{type:"button",disabled:t.embarqueBloqueado},on:{click:function(e){return t.eliminarProducto(a)}}},[t._v("X")])]),e("div",{staticClass:"sumas-verticales"},[e("div",{staticClass:"columna"},[e("div",{staticClass:"taras-header"},[e("h5",[t._v("Taras")]),e("div",{staticClass:"checkbox-container"},[e("input",{directives:[{name:"model",rawName:"v-model",value:a.restarTaras,expression:"producto.restarTaras"}],attrs:{type:"checkbox",disabled:t.embarqueBloqueado},domProps:{checked:Array.isArray(a.restarTaras)?t._i(a.restarTaras,null)>-1:a.restarTaras},on:{change:function(e){var o=a.restarTaras,i=e.target,s=!!i.checked;if(Array.isArray(o)){var r=null,n=t._i(o,r);i.checked?n<0&&t.$set(a,"restarTaras",o.concat([r])):n>-1&&t.$set(a,"restarTaras",o.slice(0,n).concat(o.slice(n+1)))}else t.$set(a,"restarTaras",s)}}}),e("label",[t._v("-3")])])]),t._l(a.taras,(function(o,i){return e("div",{key:i,staticClass:"input-group"},[e("input",{directives:[{name:"model",rawName:"v-model.number",value:a.taras[i],expression:"producto.taras[taraIndex]",modifiers:{number:!0}}],staticClass:"form-control tara-input",attrs:{type:"tel",placeholder:"Tara",size:String(a.taras[i]||"").length||1,disabled:t.embarqueBloqueado},domProps:{value:a.taras[i]},on:{focus:function(t){return t.target.select()},input:function(e){e.target.composing||t.$set(a.taras,i,t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),e("button",{staticClass:"btn btn-danger btn-sm",attrs:{type:"button",disabled:t.embarqueBloqueado},on:{click:function(e){return t.eliminarTara(a,i)}}},[t._v("-")])])})),t._l(a.tarasExtra,(function(o,i){return e("div",{key:"extra-"+i,staticClass:"input-group"},[e("input",{directives:[{name:"model",rawName:"v-model.number",value:a.tarasExtra[i],expression:"producto.tarasExtra[taraExtraIndex]",modifiers:{number:!0}}],staticClass:"form-control tara-input",attrs:{type:"tel",placeholder:"Tara Extra",size:String(a.tarasExtra[i]||"").length||1,disabled:t.embarqueBloqueado},domProps:{value:a.tarasExtra[i]},on:{focus:function(t){return t.target.select()},input:function(e){e.target.composing||t.$set(a.tarasExtra,i,t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),e("button",{staticClass:"btn btn-danger btn-sm",attrs:{type:"button",disabled:t.embarqueBloqueado},on:{click:function(e){return t.eliminarTaraExtra(a,i)}}},[t._v("-")])])})),e("div",{staticClass:"botones-tara"},[e("button",{staticClass:"btn btn-success btn-sm agregar-tara",attrs:{type:"button",disabled:t.embarqueBloqueado},on:{click:function(e){return t.agregarTara(a)}}},[t._v("+")]),e("button",{staticClass:"btn btn-warning btn-sm agregar-tara-extra",attrs:{type:"button",disabled:t.embarqueBloqueado},on:{click:function(e){return t.agregarTaraExtra(a)}}},[t._v("+ Extra")])]),e("div",{staticClass:"total"},[t._v("Total: "+t._s(t.totalTaras(a)))])],2),e("div",{staticClass:"columna"},[e("h5",[t._v("Kilos")]),t._l(a.kilos,(function(o,i){return e("div",{key:i,staticClass:"input-group"},[e("input",{directives:[{name:"model",rawName:"v-model.number",value:a.kilos[i],expression:"producto.kilos[kiloIndex]",modifiers:{number:!0}}],staticClass:"form-control kilo-input",attrs:{type:"tel",placeholder:"Kilos",size:String(a.kilos[i]||"").length||1,disabled:t.embarqueBloqueado},domProps:{value:a.kilos[i]},on:{focus:function(t){return t.target.select()},input:function(e){e.target.composing||t.$set(a.kilos,i,t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}})])})),e("div",{staticStyle:{height:"38px"}}),e("div",{staticClass:"total"},[t._v("Total: "+t._s(t.totalKilos(a)))])],2)]),e("div",{staticClass:"reporte-taras-bolsas"},[e("div",{staticClass:"reporte-item"},[e("h5",[t._v("Taras")]),t._l(a.reporteTaras,(function(o,i){return e("div",{key:i,staticClass:"input-group mb-2"},[e("input",{directives:[{name:"model",rawName:"v-model",value:a.reporteTaras[i],expression:"producto.reporteTaras[index]"}],staticClass:"form-control reporte-input",attrs:{type:"tel",disabled:t.embarqueBloqueado},domProps:{value:a.reporteTaras[i]},on:{focus:function(t){return t.target.select()},input:function(e){e.target.composing||t.$set(a.reporteTaras,i,e.target.value)}}}),e("button",{staticClass:"btn btn-danger btn-sm",attrs:{type:"button",disabled:t.embarqueBloqueado},on:{click:function(e){return t.eliminarReporteTara(a,i)}}},[t._v("-")])])})),e("button",{staticClass:"btn btn-success btn-sm",attrs:{type:"button",disabled:t.embarqueBloqueado},on:{click:function(e){return t.agregarReporteTara(a)}}},[t._v("+")]),e("div",{staticClass:"total-taras-reporte",class:{coincide:t.coincideTaras(a),"no-coincide":!t.coincideTaras(a)}},[t._v(" Reportadas: "+t._s(t.totalTarasReportadas(a))+" ")])],2),e("div",{staticClass:"reporte-item"},[e("h5",[t._v("Bolsas")]),t._l(a.reporteBolsas,(function(o,i){return e("div",{key:i,staticClass:"input-group mb-2"},[e("input",{directives:[{name:"model",rawName:"v-model",value:a.reporteBolsas[i],expression:"producto.reporteBolsas[index]"}],staticClass:"form-control reporte-input",attrs:{type:"tel",disabled:t.embarqueBloqueado},domProps:{value:a.reporteBolsas[i]},on:{focus:function(t){return t.target.select()},input:function(e){e.target.composing||t.$set(a.reporteBolsas,i,e.target.value)}}})])})),e("div",{staticStyle:{height:"38px"}}),e("div",{staticClass:"total-bolsas-reporte"},[t._v(" Bolsas: "+t._s(t.totalBolsasReportadas(a))+" ")])],2)]),t.reporteExcedeTresParentesis(a)?e("div",{staticClass:"reporte-extenso"},[t._v(" "+t._s(t.generarReporteExtenso(a))+" ")]):t._e()])})),t._l(t.clienteCrudos[o]||[],(function(a,i){return e("div",{key:"crudo-"+i,staticClass:"producto crudo"},[e("h2",{staticClass:"crudo-header"},[t._v("Crudos")]),e("div",{staticClass:"crudo-items"},t._l(a.items||[],(function(a,s){return e("div",{key:"item-"+s,staticClass:"crudo-item"},[e("div",{staticClass:"crudo-talla-container"},[e("button",{staticClass:"btn-precio",class:{"tiene-precio":a.precio},attrs:{disabled:t.embarqueBloqueado},on:{click:function(e){return t.abrirModalPrecio(a)}}},[t._v(" $ ")]),e("select",{directives:[{name:"model",rawName:"v-model",value:a.talla,expression:"item.talla"}],staticClass:"form-control talla-select",attrs:{disabled:t.embarqueBloqueado},on:{change:[function(e){var o=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(a,"talla",e.target.multiple?o:o[0])},function(e){return t.onTallaCrudoChange(a)}]}},[e("option",{attrs:{value:""}},[t._v("Elige talla")]),e("option",{attrs:{value:"Med c/c"}},[t._v("Med c/c")]),e("option",{attrs:{value:"Med-Esp c/c"}},[t._v("Med-Esp c/c")]),e("option",{attrs:{value:"Med-gde c/c"}},[t._v("Med-gde c/c")]),e("option",{attrs:{value:"Gde c/c"}},[t._v("Gde c/c")]),e("option",{attrs:{value:"Gde c/ Extra"}},[t._v("Gde c/ Extra c/c")]),e("option",{attrs:{value:"Extra c/c"}},[t._v("Extra c/c")]),e("option",{attrs:{value:"Jumbo c/c"}},[t._v("Jumbo c/c")]),e("option",{attrs:{value:"Linea"}},[t._v("Linea")]),e("option",{attrs:{value:"Lag gde c/c"}},[t._v("Lag gde c/c")]),e("option",{attrs:{value:"Rechazo"}},[t._v("Rechazo")])]),a.precio?e("span",{staticClass:"precio-tag"},[t._v("$"+t._s(a.precio))]):t._e(),e("input",{directives:[{name:"model",rawName:"v-model",value:a.barco,expression:"item.barco"}],staticClass:"form-control barco-input",attrs:{type:"text",placeholder:"Barco",disabled:t.embarqueBloqueado},domProps:{value:a.barco},on:{input:function(e){e.target.composing||t.$set(a,"barco",e.target.value)}}})]),e("div",{staticClass:"crudo-taras-container"},[e("div",{staticClass:"taras-wrapper"},[e("input",{directives:[{name:"model",rawName:"v-model",value:a.taras,expression:"item.taras"}],staticClass:"form-control taras-input",attrs:{type:"text",placeholder:"Taras",disabled:t.embarqueBloqueado},domProps:{value:a.taras},on:{input:[function(e){e.target.composing||t.$set(a,"taras",e.target.value)},function(e){return t.actualizarTotalCrudos(o,i)}]}}),a.mostrarSobrante?e("input",{directives:[{name:"model",rawName:"v-model",value:a.sobrante,expression:"item.sobrante"}],staticClass:"form-control taras-input",attrs:{type:"text",placeholder:"Sbrte",disabled:t.embarqueBloqueado},domProps:{value:a.sobrante},on:{input:[function(e){e.target.composing||t.$set(a,"sobrante",e.target.value)},function(e){return t.actualizarTotalCrudos(o,i)}]}}):t._e()]),e("div",{staticClass:"buttons-wrapper"},[e("button",{staticClass:"btn btn-danger btn-sm eliminar-crudo-item",attrs:{type:"button",disabled:t.embarqueBloqueado},on:{click:function(e){return t.eliminarCrudoItem(o,i,s)}}},[t._v("-")]),e("button",{staticClass:"btn btn-success btn-sm agregar-sobrante",attrs:{type:"button",disabled:t.embarqueBloqueado},on:{click:function(e){return t.toggleSobrante(o,i,s)}}},[t._v("+")])])])])})),0),e("div",{staticClass:"crudo-footer"},[e("button",{staticClass:"btn btn-primary btn-sm agregar-crudo-item",attrs:{type:"button",disabled:t.embarqueBloqueado},on:{click:function(e){return t.agregarCrudoItem(o,i)}}},[t._v("+ Agregar Talla/Taras")]),e("button",{staticClass:"btn btn-danger btn-sm eliminar-crudo",attrs:{type:"button",disabled:t.embarqueBloqueado},on:{click:function(e){return t.eliminarCrudo(o,i)}}},[t._v("Eliminar Crudo")]),e("div",{staticClass:"total-crudos"},[t._v("Total de taras: "+t._s(t.calcularTotalCrudos(a)))])])])}))],2),e("div",{staticClass:"botones-agregar"},[e("button",{staticClass:"btn btn-primary btn-sm agregar-producto",attrs:{type:"button",disabled:t.embarqueBloqueado},on:{click:function(e){return t.agregarProducto(o)}}},[t._v("Agregar Producto")]),e("button",{staticClass:"btn btn-info btn-sm agregar-crudo",attrs:{type:"button",disabled:t.embarqueBloqueado},on:{click:function(e){return t.agregarCrudo(o)}}},[t._v("Agregar Crudos")])])])})),0)]),t._v(" "),t.mostrarModalNuevoCliente?e("div",{staticClass:"modal-overlay",on:{click:function(e){return e.target!==e.currentTarget?null:t.cerrarModalNuevoCliente.apply(null,arguments)}}},[e("div",{staticClass:"modal-contenido"},[e("div",{staticClass:"modal-header"},[e("h3",[t._v("Agregar Nuevo Cliente")]),e("button",{staticClass:"btn-cerrar-modal",on:{click:t.cerrarModalNuevoCliente}},[e("i",{staticClass:"fas fa-times"})])]),e("div",{staticClass:"modal-body"},[e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"nombreCliente"}},[t._v("Nombre del Cliente:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.nuevoClienteNombre,expression:"nuevoClienteNombre"}],staticClass:"form-control",attrs:{type:"text",id:"nombreCliente",placeholder:"Ingrese el nombre del cliente"},domProps:{value:t.nuevoClienteNombre},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.agregarNuevoCliente.apply(null,arguments)},input:function(e){e.target.composing||(t.nuevoClienteNombre=e.target.value)}}})])]),e("div",{staticClass:"modal-footer"},[e("button",{staticClass:"btn btn-secondary",on:{click:t.cerrarModalNuevoCliente}},[t._v("Cancelar")]),e("button",{staticClass:"btn btn-primary",on:{click:t.agregarNuevoCliente}},[t._v("Agregar")])])])]):t._e(),t.mostrarModalNombreAlternativo?e("div",{staticClass:"modal-overlay",on:{click:function(e){return e.target!==e.currentTarget?null:t.cerrarModalNombreAlternativo.apply(null,arguments)}}},[e("div",{staticClass:"modal-contenido"},[e("div",{staticClass:"modal-header"},[e("h3",[t._v("Nombre para PDF")]),e("button",{staticClass:"btn-cerrar-modal",on:{click:t.cerrarModalNombreAlternativo}},[e("i",{staticClass:"fas fa-times"})])]),e("div",{staticClass:"modal-body"},[e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"nombreAlternativoPDF"}},[t._v("Nombre que aparecerá en el PDF:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.nombreAlternativoTemp,expression:"nombreAlternativoTemp"}],ref:"nombreAlternativoInput",staticClass:"form-control",attrs:{type:"text",id:"nombreAlternativoPDF",placeholder:"Ingrese el nombre para el PDF"},domProps:{value:t.nombreAlternativoTemp},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.guardarNombreAlternativo.apply(null,arguments)},input:function(e){e.target.composing||(t.nombreAlternativoTemp=e.target.value)}}}),e("small",{staticClass:"form-text text-muted"},[t._v(" Este nombre solo se mostrará en el PDF generado. El nombre original se mantendrá en la aplicación. ")])])]),e("div",{staticClass:"modal-footer"},[e("button",{staticClass:"btn btn-secondary",on:{click:t.cerrarModalNombreAlternativo}},[t._v("Cancelar")]),e("button",{staticClass:"btn btn-primary",on:{click:t.guardarNombreAlternativo}},[t._v("Guardar")])])])]):t._e(),t.mostrarModalPrecio?e("div",{staticClass:"modal-overlay",on:{click:function(e){return e.target!==e.currentTarget?null:t.cerrarModalPrecio.apply(null,arguments)}}},[e("div",{staticClass:"modal-contenido"},[e("div",{staticClass:"modal-header"},[e("h3",[t._v("Establecer Precio")]),e("button",{staticClass:"btn-cerrar-modal",on:{click:t.cerrarModalPrecio}},[e("i",{staticClass:"fas fa-times"})])]),e("div",{staticClass:"modal-body"},[e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"precioInput"}},[t._v("Precio:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.precioTemp,expression:"precioTemp"}],ref:"precioInput",staticClass:"form-control",attrs:{type:"number",id:"precioInput",placeholder:"Ingrese el precio"},domProps:{value:t.precioTemp},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.guardarPrecio.apply(null,arguments)},input:function(e){e.target.composing||(t.precioTemp=e.target.value)}}})])]),e("div",{staticClass:"modal-footer"},[e("button",{staticClass:"btn btn-secondary",on:{click:t.cerrarModalPrecio}},[t._v("Cancelar")]),e("button",{staticClass:"btn btn-primary",on:{click:t.guardarPrecio}},[t._v("Guardar")])])])]):t._e(),t.mostrarModalHilos?e("div",{staticClass:"modal-overlay",on:{click:function(e){return e.target!==e.currentTarget?null:t.cerrarModalHilos.apply(null,arguments)}}},[e("div",{staticClass:"modal-contenido"},[e("div",{staticClass:"modal-header"},[e("h3",[t._v("Establecer Hilos")]),e("button",{staticClass:"btn-cerrar-modal",on:{click:t.cerrarModalHilos}},[e("i",{staticClass:"fas fa-times"})])]),e("div",{staticClass:"modal-body"},[e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"hilosInput"}},[t._v("Hilos:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.hilosTemp,expression:"hilosTemp"}],ref:"hilosInput",staticClass:"form-control",attrs:{type:"text",id:"hilosInput",placeholder:"Ingrese los hilos"},domProps:{value:t.hilosTemp},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.guardarHilos.apply(null,arguments)},input:function(e){e.target.composing||(t.hilosTemp=e.target.value)}}})])]),e("div",{staticClass:"modal-footer"},[e("button",{staticClass:"btn btn-secondary",on:{click:t.cerrarModalHilos}},[t._v("Cancelar")]),e("button",{staticClass:"btn btn-primary",on:{click:t.guardarHilos}},[t._v("Guardar")])])])]):t._e(),t.mostrarModalNota?e("div",{staticClass:"modal-overlay",on:{click:function(e){return e.target!==e.currentTarget?null:t.cerrarModalNota.apply(null,arguments)}}},[e("div",{staticClass:"modal-contenido"},[e("div",{staticClass:"modal-header"},[e("h3",[t._v("Establecer Nota")]),e("button",{staticClass:"btn-cerrar-modal",on:{click:t.cerrarModalNota}},[e("i",{staticClass:"fas fa-times"})])]),e("div",{staticClass:"modal-body"},[e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"notaInput"}},[t._v("Nota:")]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.notaTemp,expression:"notaTemp"}],ref:"notaInput",staticClass:"form-control",attrs:{id:"notaInput",placeholder:"Ingrese la nota"},domProps:{value:t.notaTemp},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.guardarNota.apply(null,arguments)},input:function(e){e.target.composing||(t.notaTemp=e.target.value)}}})])]),e("div",{staticClass:"modal-footer"},[e("button",{staticClass:"btn btn-secondary",on:{click:t.cerrarModalNota}},[t._v("Cancelar")]),e("button",{staticClass:"btn btn-primary",on:{click:t.guardarNota}},[t._v("Guardar")])])])]):t._e(),t.mostrarModalAlt?e("div",{staticClass:"modal-overlay",on:{click:function(e){return e.target!==e.currentTarget?null:t.cerrarModalAlt.apply(null,arguments)}}},[e("div",{staticClass:"modal-contenido"},[e("div",{staticClass:"modal-header"},[e("h3",[t._v("Nombre Alternativo para PDF")]),e("button",{staticClass:"btn-cerrar-modal",on:{click:t.cerrarModalAlt}},[e("i",{staticClass:"fas fa-times"})])]),e("div",{staticClass:"modal-body"},[e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"altInput"}},[t._v("Nombre alternativo:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.altTemp,expression:"altTemp"}],ref:"altInput",staticClass:"form-control",attrs:{type:"text",id:"altInput",placeholder:"Ingrese el nombre alternativo para PDF"},domProps:{value:t.altTemp},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.guardarAlt.apply(null,arguments)},input:function(e){e.target.composing||(t.altTemp=e.target.value)}}}),e("small",{staticClass:"form-text text-muted"},[t._v(" Este nombre solo se mostrará en el PDF de resumen de embarque. ")])])]),e("div",{staticClass:"modal-footer"},[e("button",{staticClass:"btn btn-secondary",on:{click:t.cerrarModalAlt}},[t._v("Cancelar")]),e("button",{staticClass:"btn btn-primary",on:{click:t.guardarAlt}},[t._v("Guardar")])])])]):t._e()])},Na=[],Da=(a("88e6"),a("70cc"),a("eb03"),a("22e5c"),a("c01e"),a("fa76"),a("8306"),a("2ef0")),Ea=a("7c01"),ja=(a("2c66"),a("249d"),a("40e9"),a("907a"),a("986a"),a("1d02"),a("3c5d"),a("6ce5"),a("2834"),a("4ea1"),a("e499")),$a=a.n(ja),Ia=a("4ebb"),Fa=a.n(Ia);async function qa(t,e,a){try{if(console.log("Datos del embarque para PDF:",{productos:t.productos,kilosCrudos:t.kilosCrudos,clienteCrudos:t.clienteCrudos,fecha:t.fecha,cargaCon:t.cargaCon,clientesJuntarMedidas:a}),!t||!t.productos)return void console.warn("El embarque no contiene datos de productos válidos");const o=await eo("https://res.cloudinary.com/hwkcovsmr/image/upload/v1620946647/samples/REY_PEZ_LOGO_nsotww.png"),i={content:[{columns:[{image:o,width:100,alignment:"left",margin:[0,0,0,10]},{text:"Nota de Venta",style:"notaVentaHeader",alignment:"center",margin:[0,20,0,0]},{stack:[{text:"Fecha: "+new Date(t.fecha).toLocaleString("es-MX",{timeZone:"UTC",year:"numeric",month:"2-digit",day:"2-digit"}),alignment:"right",margin:[0,20,0,0]},{text:"Carga con: "+(t.cargaCon||"No especificado"),alignment:"right",margin:[0,5,0,0]}]}]},{text:"\n"},...za(t,e,a),...Va({...t,kilosCrudos:t.kilosCrudos||{}},e)],styles:{notaVentaHeader:{color:"#3760b0",fontSize:30,bold:!0,italics:!0},header:{fontSize:30,bold:!0,color:"#2980b9",margin:[0,0,0,10]},subheader:{fontSize:25,bold:!0,margin:[0,10,0,5]},tableHeader:{bold:!0,fontSize:23,color:"black",fillColor:"#ecf0f1"},clienteJoselito:{color:"#FFFFFF",background:"#0000FF",padding:[2,2,2,2]},clienteCatarro:{color:"#FFFFFF",background:"#FF0000",padding:[2,2,2,2]},clienteOtilio:{color:"#000000",background:"#FFD700",padding:[2,2,2,2]},clienteOzuna:{color:"#FFFFFF",background:"#008000",padding:[2,2,2,2]},clienteOtro:{color:"#000000",background:"#808080",padding:[2,2,2,2]},medidaHeader:{fontSize:24,bold:!0,color:"#2c3e50",margin:[0,10,0,5]},precio:{color:"#FFFFFF",background:"#FF0000",padding:[2,2,2,2]},tipoConAgua:{color:"#2980b9",bold:!0},nota:{fontSize:18,color:"#666666",italics:!0}},defaultStyle:{fontSize:20},footer:function(t,e){return{columns:[{text:" 20 Rey Pez - Tampico, Tamps.",alignment:"center",margin:[0,10,0,0]}],margin:[40,0,40,0],fontSize:15,color:"#3760b0"}}};$a.a.createPdf(i).getBuffer(t=>{new Uint8Array(t);const e=t.toString().match(/\/Page\W/g).length;if(e>1){const t={...i,defaultStyle:{...i.defaultStyle,fontSize:16},styles:{...i.styles,notaVentaHeader:{...i.styles.notaVentaHeader,fontSize:24},header:{...i.styles.header,fontSize:24},subheader:{...i.styles.subheader,fontSize:20},tableHeader:{...i.styles.tableHeader,fontSize:18},medidaHeader:{...i.styles.medidaHeader,fontSize:20}}};$a.a.createPdf(t).download("nota-venta.pdf")}else $a.a.createPdf(i).download("nota-venta.pdf")})}catch(o){console.error("Error al generar el PDF:",o)}}function za(t,e,a){const o=[];let i=0,s=0;const r=t.productos.reduce((t,e)=>(t[e.clienteId]||(t[e.clienteId]=[]),t[e.clienteId].push(e),t),{});return Object.entries(r).forEach(([r,n])=>{const c=Ya(r,e),l=Ka(c),d=a&&a[r];let u=n;if(d){const t={};n.forEach(e=>{const a=e.nombreAlternativoPDF||e.medida,o=e.tipo||"",i=e.camaronNeto||.65,s="c/h20"===o?`${a}-${o}-${i}`:`${a}-${o}`;t[s]?(t[s].kilos.push(...e.kilos),t[s].taras.push(...e.taras),e.tarasExtra&&t[s].tarasExtra.push(...e.tarasExtra),e.reporteTaras&&t[s].reporteTaras.push(...e.reporteTaras),e.reporteBolsas&&t[s].reporteBolsas.push(...e.reporteBolsas),t[s].tarasInfo.push(...e.taras.map(t=>({valor:t,restarTaras:e.restarTaras}))),t[s].taras=t[s].tarasInfo.map(t=>t.valor)):t[s]={...e,medida:a,kilos:[...e.kilos],taras:[...e.taras],tarasExtra:[...e.tarasExtra||[]],reporteTaras:[...e.reporteTaras||[]],reporteBolsas:[...e.reporteBolsas||[]],tarasInfo:e.taras.map(t=>({valor:t,restarTaras:e.restarTaras}))}}),u=Object.values(t)}const m=Ga(u);o.push({text:"Cliente: "+c,style:["subheader",l],margin:[0,5,0,5]},Ha(m,l,c),{text:"\n"});const p=n.reduce((t,e)=>t+Wa(e),0);if(i+=p,o.push({text:"Taras de limpio: "+p,margin:[0,5,0,5]},{text:"\n"}),t.clienteCrudos&&t.clienteCrudos[r]){o.push({text:"Crudos:",style:["subheader",l],margin:[0,5,0,5]},Ra(t.clienteCrudos[r],l),{text:"\n"});const e=t.clienteCrudos[r].reduce((t,e)=>t+e.items.reduce((t,e)=>t+Ua(e),0),0);s+=e,o.push({text:"Taras de crudo: "+e,margin:[0,5,0,5]},{text:"\n"})}}),o.push({text:"Total general de taras: "+(i+s),style:"subheader",margin:[0,5,0,5]}),o}function Va(t,e){const a=[],o=t.productos.filter(t=>"4"===t.clienteId&&!t.esVenta);if(o.length>0){a.push({text:"Rendimientos de Maquila:",style:"subheader",margin:[0,20,0,10]});const e={table:{headerRows:1,widths:["33%","33%","34%"],body:[[{text:"Medida",style:"tableHeader"},{text:"Kilos en Crudo",style:"tableHeader"},{text:"Rendimiento",style:"tableHeader"}]]},layout:{hLineWidth:()=>1,vLineWidth:()=>1,hLineColor:()=>"#008000",vLineColor:()=>"#008000"}};let i=0,s=0;const r=o.reduce((t,e)=>{const a=e.medida;return t[a]||(t[a]=[]),t[a].push(e),t},{});Object.entries(r).forEach(([a,o])=>{const r=o.reduce((t,e)=>t+La(e),0);let n=0;const c=a+" Maquila Ozuna";t.kilosCrudos&&t.kilosCrudos[c]&&(n="object"===typeof t.kilosCrudos[c]?Number(t.kilosCrudos[c].medida1||0)+Number(t.kilosCrudos[c].medida2||0):Number(t.kilosCrudos[c]));const l=r>0?n/r:0;i+=n,s+=r,e.table.body.push([{text:a,alignment:"center"},{text:n.toFixed(2)+" kg",alignment:"center"},{text:l.toFixed(2),alignment:"center",color:l>1?"#27ae60":"#000000",bold:l>1}])});const n=s>0?i/s:0;e.table.body.push([{text:"TOTAL",style:"tableHeader",alignment:"center"},{text:i.toFixed(2)+" kg",style:"tableHeader",alignment:"center"},{text:n.toFixed(2),style:"tableHeader",alignment:"center",color:n>1?"#27ae60":"#000000",bold:n>1}]),a.push(e)}return a}function La(t){if("c/h20"===t.tipo){let e=0;const a=t.reporteTaras||[],o=t.reporteBolsas||[];for(let t=0;t<a.length;t++){const i=parseInt(a[t])||0,s=parseInt(o[t])||0;e+=i*s}return e*(t.camaronNeto||.65)}{const e=t.kilos.reduce((t,e)=>t+(Number(e)||0),0),a=t.taras.reduce((t,e)=>t+(Number(e)||0),0),o=(t.tarasExtra||[]).reduce((t,e)=>t+(Number(e)||0),0),i=a+o,s=t.restarTaras?3*i:0;return e-s}}function Ba(t){return t.split(" ")[0].toLowerCase()}function Ga(t){return t.sort((t,e)=>{const a=Ba(t.nombreAlternativoPDF||t.medida),o=Ba(e.nombreAlternativoPDF||e.medida);if(a!==o)return a.localeCompare(o);if(t.tipo!==e.tipo)return t.tipo.localeCompare(e.tipo);if("c/h20"===t.tipo&&"c/h20"===e.tipo){const a=t.camaronNeto||.65,o=e.camaronNeto||.65;return a-o}return 0})}function Ha(t,e,a){const o=t.some(t=>t.nota&&""!==t.nota.trim()),i=t.some(t=>t.hilos),s=[{text:"Kg",style:"tableHeader"},{text:"Producto",style:"tableHeader"},{text:"Taras",style:"tableHeader"}];i&&s.push({text:"Hilos",style:"tableHeader"}),o&&s.push({text:"Notas",style:"tableHeader"});const r=[s];let n;return t.forEach(t=>{const e=(t.taras||[]).reduce((t,e)=>t+(e||0),0),s=(t.tarasExtra||[]).reduce((t,e)=>t+(e||0),0),n=e+s;let c=`${n} ${Za(t.reporteTaras,t.reporteBolsas)}`;const l=[Qa(t,a)+" kg",Ja(t),c];i&&l.push(t.hilos||""),o&&l.push({text:t.nota||"",style:"nota"}),r.push(l)}),n=i&&o?["15%","25%","25%","15%","20%"]:i||o?["20%","30%","30%","20%"]:["25%","35%","40%"],{table:{headerRows:1,widths:n,body:r},layout:{hLineWidth:function(t,e){return 0===t||t===e.table.body.length?2:1},vLineWidth:function(t,e){return 0===t||t===e.table.widths.length?2:1},hLineColor:function(t,a){return 0===t||t===a.table.body.length?to(e):"black"},vLineColor:function(t,a){return 0===t||t===a.table.widths.length?to(e):"black"}}}}function Ra(t,e){const a=t.some(t=>t.items.some(t=>t.precio&&""!==t.precio.toString().trim())),o=[{text:"Cantidad",style:"tableHeader"},{text:"Talla",style:"tableHeader"},{text:"Taras",style:"tableHeader"}];a&&o.push({text:"Precio",style:"tableHeader"});const i=[o];t.forEach(t=>t.items.forEach(t=>{const e=[Xa(t)+" kg",{text:t.talla.replace(/\s*c\/\s*c$/i," c/c"),style:"default",noWrap:!0},Ua(t)];a&&e.push(t.precio?{text:"$"+Number(t.precio).toLocaleString("en-US"),style:"precio"}:""),i.push(e)}));const s=a?["25%","30%","25%","20%"]:["30%","40%","30%"];return{table:{headerRows:1,widths:s,body:i},layout:{hLineWidth:function(t,e){return 0===t||t===e.table.body.length?2:1},vLineWidth:function(t,e){return 0===t||t===e.table.widths.length?2:1},hLineColor:function(t,a){return 0===t||t===a.table.body.length?to(e):"black"},vLineColor:function(t,a){return 0===t||t===a.table.widths.length?to(e):"black"}}}}function Ka(t){const e=t.toLowerCase();return e.includes("joselito")?"clienteJoselito":e.includes("catarro")?"clienteCatarro":e.includes("otilio")?"clienteOtilio":e.includes("ozuna")?"clienteOzuna":"clienteOtro"}function Ja(t){let e=(t.nombreAlternativoPDF||t.medida||"").trim(),a=t.precio?" $"+Number(t.precio).toLocaleString("en-US"):"";if("c/h20"===t.tipo)return[{text:e+" c/h2o",style:"tipoConAgua"},{text:a,style:"precio"}].filter(t=>t.text);if("s/h20"===t.tipo)return[{text:e+" s/h2o",style:"default"},{text:a,style:"precio"}].filter(t=>t.text);let o="otro"===t.tipo?t.tipoPersonalizado:t.tipo,i=o?`${e} ${o}`:e;return[{text:i,style:"default"},{text:a,style:"precio"}].filter(t=>t.text)}function Ua(t){let e=0;if(t.taras){const[a]=t.taras.split("-").map(Number);e+=a}if(t.sobrante){const[a]=t.sobrante.split("-").map(Number);e+=a}return e}function Ya(t,e){if(!e||!Array.isArray(e))return console.warn("La lista de clientes disponibles no es válida"),"Cliente Desconocido";const a=e.find(e=>e.id.toString()===t.toString());return a?a.nombre:"Cliente Desconocido"}function Wa(t){const e=(t.taras||[]).reduce((t,e)=>t+(e||0),0),a=(t.tarasExtra||[]).reduce((t,e)=>t+(e||0),0);return e+a}function Qa(t,e){const a=(t.kilos||[]).reduce((t,e)=>t+(e||0),0);let o=0;if(t.tarasInfo)o=t.tarasInfo.reduce((t,e)=>t+(e.restarTaras?3*(Number(e.valor)||0):0),0);else{const e=(t.taras||[]).reduce((t,e)=>t+(e||0),0);o=t.restarTaras?3*e:0}let i=a-o;return t.noSumarKilos||!t.tipo.toLowerCase().includes("s/h2o")&&!t.tipo.toLowerCase().includes("s/h20")||e.toLowerCase().includes("catarro")&&(i+=1),Number(i.toFixed(1))}function Xa(t){let e=0;if(t.taras){const[a,o]=t.taras.split("-").map(Number);e+=20.5*a}if(t.sobrante){const[,a]=t.sobrante.split("-").map(Number);e+=a}return e.toFixed(2)}function Za(t,e){const a={};return t.forEach((t,o)=>{const i=e[o]||"";a[i]||(a[i]=0),a[i]+=parseInt(t||1)}),Object.entries(a).map(([t,e])=>`(${e}-${t})`).join(" ")}function to(t){const e={clienteJoselito:"#0000FF",clienteCatarro:"#FF0000",clienteOtilio:"#FFD700",clienteOzuna:"#008000",clienteOtro:"#808080"};return e[t]||"#000000"}function eo(t){return new Promise((e,a)=>{const o=new Image;o.crossOrigin="Anonymous",o.onload=function(){const t=document.createElement("canvas");t.width=o.width,t.height=o.height;const a=t.getContext("2d");a.drawImage(o,0,0);const i=t.toDataURL("image/png");e(i)},o.onerror=a,o.src=t})}$a.a.vfs=Fa.a;var ao=a("8baf");a("0da4");const oo={Joselito:"#3498db",Catarro:"#e74c3c",Otilio:"#f39c12",Ozuna:"#27ae60"};function io(t,e){const a=new ao["default"];a.setFontSize(24),a.setTextColor(55,96,176),a.text("Resumen de Taras",14,20),a.setFontSize(18),a.setTextColor(0,0,0);const o=new Date(t.fecha);o.setDate(o.getDate()+1);const i=o.toLocaleDateString();a.text("Fecha: "+i,14,30),a.setFontSize(18),a.text("Carga con: "+(t.cargaCon||"No especificado"),14,40);const s=so(t,e);a.autoTable({startY:50,head:[["Cliente","Abiertas","Cerradas","Total"]],body:s.filas,foot:[["Total",s.totales.abiertas,s.totales.cerradas,s.totales.total]],theme:"grid",styles:{fontSize:18,cellPadding:8},headStyles:{fillColor:[255,255,255],textColor:[0,0,0],fontSize:20,fontStyle:"bold",halign:"center",lineWidth:1,lineColor:[0,0,0]},footStyles:{fillColor:[255,255,255],textColor:[0,0,0],fontSize:20,fontStyle:"bold",halign:"center",lineWidth:1,lineColor:[0,0,0]},bodyStyles:{fontSize:18,halign:"center"},alternateRowStyles:{fillColor:[248,249,250]},didDrawPage:function(t){const e=a.internal.pageSize,o=e.height?e.height:e.getHeight();a.setFontSize(8),a.setTextColor(55,96,176),a.text("© 2025 Rey Pez - Tampico, Tamps.",e.width/2,o-10,{align:"center"})}}),a.save("resumen-taras.pdf")}function so(t,e){const a=new Map;let o={abiertas:0,cerradas:0,total:0};const i=[{id:"1",nombre:"Joselito"},{id:"2",nombre:"Catarro"},{id:"3",nombre:"Otilio"},{id:"4",nombre:"Ozuna"}];i.forEach(t=>{a.set(t.nombre,{abiertas:0,cerradas:0})}),t.productos.forEach(t=>{const e=t.clienteId.toString(),s=i.find(t=>t.id===e);if(s){const e=s.nombre,i=ro(t),r=a.get(e);r.abiertas+=i,o.abiertas+=i}}),t.clienteCrudos&&Object.entries(t.clienteCrudos).forEach(([t,e])=>{const s=i.find(e=>e.id===t);if(s){const t=s.nombre,i=no(e),r=a.get(t);r.cerradas+=i,o.cerradas+=i}});const s=Array.from(a.entries()).filter(([t,e])=>e.abiertas>0||e.cerradas>0).map(([t,e])=>{const a=e.abiertas+e.cerradas;return[{content:t,styles:{textColor:oo[t]||"#000000"}},e.abiertas,e.cerradas,a]});return o.total=o.abiertas+o.cerradas,{filas:s,totales:o}}function ro(t){const e=(t.taras||[]).reduce((t,e)=>t+("number"===typeof e?e:0),0),a=(t.tarasExtra||[]).reduce((t,e)=>t+("number"===typeof e?e:0),0);return e+a}function no(t){return t.reduce((t,e)=>t+e.items.reduce((t,e)=>{let a=0;if(e.taras){const[t]=e.taras.split("-").map(Number);isNaN(t)||(a+=t)}if(e.sobrante){const[t]=e.sobrante.split("-").map(Number);isNaN(t)||(a+=t)}return t+a},0),0)}function co(t){const e={1:"#3498db",2:"#e74c3c",3:"#f1c40f",4:"#2ecc71"};return e[t]||"#95a5a6"}function lo(t,e,a=100,o=[]){const i=a/100,s=[{text:"",pageBreak:"before"}];let r=0,n=0;const c=120,l=25,d=[],u=[];Object.entries(t).forEach(([t,e])=>{["1","2","3","4"].includes(t)?d.push([t,e]):u.push([t,e])});for(let m=0;m<u.length;m+=3){const t=[];for(let e=0;e<3&&m+e<u.length;e++){const[a,s]=u[m+e],d=uo(a,o),p=bo(s),h=vo(s);r+=p,n+=h,t.push({stack:[{columns:[{width:"auto",stack:[{canvas:[{type:"rect",x:0,y:0,w:.8*c,h:l,r:8,color:co(a)}]},{text:d,color:"white",fontSize:11*i,relativePosition:{x:10,y:-20}}]},{text:`${p}T|${fo(h)}Kg`,style:"total",alignment:"right",color:co(a),fontSize:11*i}],margin:[0,3,0,3]},...s.map(t=>({stack:[{text:mo(t),fontSize:11*i,bold:!0,margin:[0,0,0,1],alignment:"center"},{canvas:[{type:"line",x1:0,y1:1,x2:120,y2:1,lineWidth:.5,lineColor:"#000000"}],margin:[0,0,0,1]},{text:0===Co(t)?[{text:""+fo(po(t)),color:"red",bold:!0}]:[{text:Co(t)+"-",bold:!0},{text:""+fo(po(t)),color:"red",bold:!0}],fontSize:11*i,margin:[0,1,0,1],alignment:"center"},{text:go(t),fontSize:10*i,margin:[0,0,0,1],alignment:"center"}],margin:[0,0,0,5]}))],width:"32%"})}s.push({columns:t,columnGap:10,margin:[0,0,0,15]})}return d.forEach(([t,e])=>{const a=uo(t,o),d=bo(e),u=vo(e);r+=d,n+=u;const m=e.length;let p=13,h=15;m>30?(p=9,h=6):m>24?(p=10,h=8):m>18?(p=11,h=10):m>12&&(p=12,h=12),s.push({columns:[{width:"auto",stack:[{canvas:[{type:"rect",x:0,y:0,w:c,h:l,r:8,color:co(t)}]},{text:a,color:"white",fontSize:p*i,relativePosition:{x:10,y:-20}}]},{text:`Total: ${d}T | ${fo(u)}Kg`,style:"total",alignment:"right",color:co(t),fontSize:p*i}],margin:[0,3,0,3]});let v=3;m>30&&(v=4);const b=[];for(let o=0;o<e.length;o+=v)b.push(e.slice(o,o+v));b.forEach(t=>{s.push({columns:t.map(t=>({stack:[{text:mo(t),fontSize:p*i,bold:!0,margin:[0,0,0,1],alignment:"center"},{canvas:[{type:"line",x1:0,y1:1,x2:150,y2:1,lineWidth:.5,lineColor:"#000000"}],margin:[0,0,0,1]},{text:0===Co(t)?[{text:""+fo(po(t)),color:"red",bold:!0}]:[{text:Co(t)+"-",bold:!0},{text:""+fo(po(t)),color:"red",bold:!0}],fontSize:p*i,margin:[0,1,0,1],alignment:"center"},{text:go(t),fontSize:(p-1)*i,margin:[0,0,0,1],alignment:"center"}],width:100/v+"%",alignment:"center"})),columnGap:5,margin:[0,0,0,h]})}),s.push({canvas:[{type:"line",x1:0,y1:2,x2:515,y2:2,lineWidth:.5,lineColor:"#CCCCCC"}],margin:[0,5,0,5]})}),s}function uo(t,e=[]){const a=t.toString();if(Array.isArray(e)&&e.length>0){const t=e.find(t=>{var e,o;return(null===(e=t.id)||void 0===e?void 0:e.toString())===a||(null===(o=t.clienteId)||void 0===o?void 0:o.toString())===a});if(t)return t.nombre||t.nombreCliente}const o={1:"Joselito",2:"Catarro",3:"Otilio",4:"Ozuna"};return o[a]||"Cliente "+a}function mo(t){let e="";if("c/h20"===t.tipo)return[{text:`${t.textoAlternativo||t.medida||""} ${t.fecha||""} `,color:"black"},{text:`c/h20 (${t.camaronNeto||.65})`,color:"#3498db"}];if(e=t.textoAlternativo||t.medida||"",t.fecha&&(e+=" "+t.fecha),"3"===t.clienteId&&t.noSumarKilos&&(e+=" sellada"),"otro"===t.tipo?e+=" "+t.tipoPersonalizado:t.tipo&&(e+=" "+t.tipo),t.precio){const a=Number(t.precio).toLocaleString("en-US");e+=" $"+a}return e}function po(t){if("c/h20"===t.tipo){const e=t.camaronNeto||.65,a=ho(t);return a*e}const e=Array.isArray(t.kilos)?t.kilos.reduce((t,e)=>t+(parseFloat(e)||0),0):0;if(t.restarTaras){const a=3*(Array.isArray(t.taras)?t.taras.reduce((t,e)=>t+(parseInt(e)||0),0):0);return e-a}return e}function ho(t){if(!Array.isArray(t.reporteTaras)||!Array.isArray(t.reporteBolsas))return 0;let e=0;for(let a=0;a<t.reporteTaras.length;a++){const o=parseInt(t.reporteTaras[a])||0,i=parseInt(t.reporteBolsas[a])||0;e+=o*i}return e}function vo(t){return t.reduce((t,e)=>{if("c/h20"===e.tipo){const a=ho(e);return t+a*(e.camaronNeto||.65)}{const a=e.kilos?e.kilos.reduce((t,e)=>t+(parseFloat(e)||0),0):0,o=e.taras?e.taras.reduce((t,e)=>t+(parseInt(e)||0),0):0;return e.restarTaras?t+(a-3*o):t+a}},0)}function bo(t){return t.reduce((t,e)=>{const a=e.taras?e.taras.reduce((t,e)=>t+(parseInt(e)||0),0):0,o=e.tarasExtra?e.tarasExtra.reduce((t,e)=>t+(parseInt(e)||0),0):0;return t+a+o},0)}function fo(t){return t.toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1})}function go(t){let e="";if(Array.isArray(t.reporteTaras)&&Array.isArray(t.reporteBolsas)){const a=[];let o=[],i=null;for(let e=0;e<t.reporteTaras.length;e++){const s=parseInt(t.reporteTaras[e]),r=parseInt(t.reporteBolsas[e]);isNaN(s)||isNaN(r)||(r===i?o.push(s):(o.length>0&&a.push(`(${o.join(",")}-${i})`),o=[s],i=r))}o.length>0&&null!==i&&a.push(`(${o.join(",")}-${i})`),e=a.join("")}return e}function Co(t){const e=t.taras?t.taras.reduce((t,e)=>t+(parseInt(e)||0),0):0,a=t.tarasExtra?t.tarasExtra.reduce((t,e)=>t+(parseInt(e)||0),0):0;return e+a}"object"===typeof Fa.a&&Fa.a.hasOwnProperty("default")?$a.a.vfs=Fa.a.default:"object"===typeof Fa.a&&Fa.a.pdfMake&&Fa.a.pdfMake.vfs?$a.a.vfs=Fa.a.pdfMake.vfs:console.error("No se pudo inicializar vfs para pdfMake"),$a.a.fonts={Roboto:{normal:"Roboto-Regular.ttf",bold:"Roboto-Medium.ttf",italics:"Roboto-Italic.ttf",bolditalics:"Roboto-MediumItalic.ttf"}};const _o={Joselito:"#3498db",Catarro:"#e74c3c",Otilio:"#f1c40f",Ozuna:"#2ecc71"},yo=["Med","Med-Esp","Med-Gde","Gde","Extra","Jumbo"],wo=t=>t.sort((t,e)=>{const a=t.toUpperCase(),o=e.toUpperCase(),i=yo.findIndex(t=>t.toUpperCase()===a),s=yo.findIndex(t=>t.toUpperCase()===o);return-1!==i&&-1!==s?i-s:-1!==i?-1:-1!==s?1:t.localeCompare(e)}),ko=t=>{if(!Array.isArray(t)||0===t.length)return[];const e=t=>{if("string"===typeof t){const e=t.split("-");return e.length>1?Number(e[1]):0}return 0},a={};t.forEach(t=>{if(!t)return;const o=e(t);a[o]||(a[o]=[]),a[o].push(t)});const o=Object.keys(a).map(Number).sort((t,e)=>19===t?-1:19===e?1:t-e);return o.reduce((t,e)=>t.concat(a[e]),[])},Ao=(t,e,a,o=[])=>{let i=[];t.medidasCrudos&&Array.isArray(t.medidasCrudos)&&(i=t.medidasCrudos.map(t=>t.replace("c/c","").trim()),i=wo([...new Set(i)])),console.log("Medidas de crudos encontradas:",i);const s={pageSize:"LETTER",pageOrientation:"portrait",content:[{table:{widths:["*","auto","*"],body:[[{text:"Carga: "+t.cargaCon,alignment:"left",fontSize:20,border:[!1,!1,!1,!0]},{text:"Embarque",alignment:"center",fontSize:25,bold:!0,border:[!1,!1,!1,!0]},{text:""+new Date(new Date(t.fecha).getTime()+864e5).toLocaleDateString("es-MX",{day:"2-digit",month:"short",year:"numeric",timeZone:"America/Mexico_City"}),alignment:"right",fontSize:20,border:[!1,!1,!1,!0]}]]},margin:[0,0,0,20]}],styles:{header:{fontSize:25,bold:!0,alignment:"center",margin:[0,0,0,0]},tableHeader:{bold:!0,fontSize:19,fillColor:"#eeeeee",alignment:"center"},clienteHeader:{fontSize:18,bold:!0,color:"white"},clienteCell:{bold:!0,fontSize:17,alignment:"left",color:"white"},dataCell:{fontSize:19,alignment:"center"},total:{fontSize:18,bold:!0,color:"white"}}},r=[{text:"Cliente",style:"tableHeader"},...i.map(e=>{const a=t.crudos.find(t=>t.medida.replace("c/c","").trim()===e&&t.textoAlternativo),o=a?a.textoAlternativo:e;return{text:o,style:"tableHeader"}})],n=[],c=new Set(t.crudos.map(t=>t.clienteId));c.forEach(e=>{const o=a(e),s="Joselito"===o?"8A":o,r=_o[o]||"#95a5a6",c=[{text:s,style:"clienteCell",fillColor:r}];i.forEach(a=>{const o=t.crudos.filter(t=>t.clienteId===e&&t.medida.replace("c/c","").trim()===a);if(o.length>0){let t=[];o.forEach(e=>{e.taras&&Array.isArray(e.taras)&&(t=t.concat(e.taras.filter(t=>t)))});const e=ko(t);c.push({text:e.join("\n"),style:"dataCell"})}else c.push({text:"",style:"dataCell"})}),n.push(c)}),s.content.push({table:{headerRows:1,widths:[60,...i.map(()=>{const t=Math.min(100,395/i.length);return t})],body:[r,...n]},layout:{hLineWidth:function(t,e){return 1},vLineWidth:function(t,e){return 1},hLineColor:function(t,e){return"#000000"},vLineColor:function(t,e){return"#000000"},paddingLeft:function(t){return 4},paddingRight:function(t){return 4},paddingTop:function(t){return 4},paddingBottom:function(t){return 4}}}),s.content.push({text:"\n\n"},{text:"Desglose por Medida",style:"header",margin:[0,0,0,10]});const l=[{text:"Medida",style:"tableHeader"},{text:"Cliente",style:"tableHeader"},{text:"Barco",style:"tableHeader"}],d=[];i.forEach(e=>{const o=t.crudos.filter(t=>t.medida.replace("c/c","").trim()===e);if(o.length>0){const t=o[0],i=a(t.clienteId),s="Joselito"===i?"8A":i,r=t.textoAlternativo||e;d.push([{text:r,style:"dataCell",rowSpan:o.length,alignment:"center",verticalAlignment:"middle"},{text:s,style:"clienteCell",fillColor:_o[i]||"#95a5a6"},{text:t.barco||"-",style:"dataCell"}]);for(let e=1;e<o.length;e++){const t=o[e],i=a(t.clienteId),s="Joselito"===i?"8A":i;d.push(["",{text:s,style:"clienteCell",fillColor:_o[i]||"#95a5a6"},{text:t.barco||"-",style:"dataCell"}])}}}),s.content.push({table:{headerRows:1,widths:["*",100,"*"],body:[l,...d]},layout:{hLineWidth:function(t,e){return 1},vLineWidth:function(t,e){return 1},hLineColor:function(t,e){return"#000000"},vLineColor:function(t,e){return"#000000"},paddingLeft:function(t){return 4},paddingRight:function(t){return 4},paddingTop:function(t){return 4},paddingBottom:function(t){return 4},fillColor:function(t,e){return null},defaultBorder:!0,vLineAlignment:function(t,e){return"center"}}}),d.forEach(t=>{t[0].text&&(t[0]={...t[0],alignment:"center",margin:[0,10,0,10]})}),s.content.push(...lo(e,_o,100,o)),$a.a.createPdf(s).download("resumen-embarque-completo.pdf")},Po=Object(o["defineAsyncComponent"])(()=>Promise.resolve().then(a.bind(null,"4dc0")));var xo={name:"NuevoEmbarque",components:{Rendimientos:Po},setup(){const t=T();return{authStore:t}},data(){return{usuariosActivos:[],clientesJuntarMedidas:{},clientesPredefinidos:[{id:1,nombre:"Joselito",color:"#3498db",textColor:"white"},{id:2,nombre:"Catarro",color:"#e74c3c",textColor:"white"},{id:3,nombre:"Otilio",color:"#f1c40f",textColor:"black"},{id:4,nombre:"Ozuna",color:"#2ecc71",textColor:"white"}],clientesPersonalizados:[],ultimoIdPersonalizado:0,embarque:{fecha:null,cargaCon:"",productos:[],crudos:[]},nuevoClienteId:"",undoStack:[],redoStack:[],isUndoRedo:!1,cambios:[],producto:{reporteTaras:[],reporteBolsas:[]},embarqueId:null,modoEdicion:!1,guardadoAutomaticoActivo:!1,clienteCrudos:{},unsubscribe:null,medidasSugeridas:[],medidasUsadas:[],mostrarSugerencias:!1,sugerenciasMedidas:[],mostrarModalPrecio:!1,precioTemp:"",itemSeleccionado:null,mostrarModalHilos:!1,hilosTemp:"",juntarMedidas:!1,mostrarModalNota:!1,notaTemp:"",mostrarModalNombreAlternativo:!1,nombreAlternativoTemp:"",productoSeleccionado:null,productoEditandoId:null,mostrarModalAlt:!1,altTemp:"",clientesOffsets:{},embarqueBloqueado:!1,clienteActivo:null,sidebarCollapsed:!1,mostrarModalNuevoCliente:!1,nuevoClienteNombre:"",nuevoClienteColor:"#007bff",isGeneratingPdf:!1,pdfType:null}},clientesJuntarMedidas:{},computed:{clientesDisponibles(){const t=new Set,e=this.clientesPredefinidos.filter(e=>!t.has(e.nombre)&&(t.add(e.nombre),!0)),a=this.clientesPersonalizados.filter(e=>!t.has(e.nombre)&&(t.add(e.nombre),!0));return[...e,...a,{id:"otro",nombre:"Otro",key:"otro"}]},productosPorCliente(){const t={};return this.embarque.productos.forEach(e=>{const a=e.clienteId;t[a]||(t[a]=[]),t[a].push(e),e.isEditing||t[a].sort((t,e)=>t.medida&&t.tipo&&e.medida&&e.tipo?this.compararMedidas(e.medida,t.medida):t.medida&&t.tipo?e.medida&&e.tipo?0:-1:1)}),t},clientesPersonalizadosEmbarque(){const t=Object.keys(this.productosPorCliente),e=this.clientesPredefinidos.map(t=>t.id.toString());return this.clientesPersonalizados.filter(a=>t.includes(a.id.toString())&&!e.includes(a.id.toString()))}},methods:{agregarProducto(t){const e={id:Date.now(),clienteId:t,medida:"",tipo:"",tipoPersonalizado:"",taras:[],kilos:[],reporteTaras:[],reporteBolsas:[],tarasExtra:[],restarTaras:!0,camaronNeto:.65,multiplicadorBolsas:1,showSuggestions:!1,esVenta:!1,isEditing:!0,isNew:!0,noSumarKilos:!1};this.setTipoDefaultParaCliente(e),this.embarque.productos.push(e),!this.guardadoAutomaticoActivo&&this.embarqueId&&(this.guardadoAutomaticoActivo=!0),this.embarqueId&&this.guardarCambiosEnTiempoReal(),this.actualizarMedidasUsadas(),this.$nextTick(()=>{const t=document.querySelectorAll(".medida-input"),a=Array.from(t).find(t=>{const a=t.closest(".producto").dataset.productoId;return a===String(e.id)});a&&a.focus()})},eliminarProducto(t){const e=this.embarque.productos.indexOf(t);e>-1&&this.embarque.productos.splice(e,1)},async agregarClienteProducto(){if(this.embarque.fecha){if("otro"===this.nuevoClienteId){const t=prompt("Ingrese el nombre del nuevo cliente:");if(t&&""!==t.trim()){this.ultimoIdPersonalizado++;const e="personalizado_"+this.ultimoIdPersonalizado,a={id:e,nombre:t.trim(),editable:!0,personalizado:!0};this.clientesPersonalizados.push(a),await this.guardarEmbarqueInicial(e)}}else this.nuevoClienteId&&await this.guardarEmbarqueInicial(this.nuevoClienteId);this.nuevoClienteId=""}else alert("Por favor, seleccione una fecha para el embarque.")},async guardarEmbarqueInicial(t){if(this.embarqueId)return this.agregarProducto(t),this.embarqueId;{const a=Object(et["h"])();try{const e=this.prepararDatosEmbarque(),o=await Object(et["b"])(Object(et["c"])(a,"embarques"),e);return this.embarqueId=o.id,this.modoEdicion=!0,this.guardadoAutomaticoActivo=!0,this.agregarProducto(t),console.log("Embarque inicial creado con ID:",this.embarqueId),this.embarqueId}catch(e){return console.error("Error al crear el embarque inicial:",e),alert("Hubo un error al crear el embarque. Por favor, intente nuevamente."),null}}},eliminarCliente(t){this.embarque.productos=this.embarque.productos.filter(e=>e.clienteId!==t),this.$forceUpdate(),this.cambios.push(`Cliente ${this.obtenerNombreCliente(t)} eliminado`)},agregarTara(t){t.taras.push(null),t.kilos.push(null)},eliminarTara(t,e){t.taras.splice(e,1),t.kilos.splice(e,1)},totalTaras(t){console.log("Taras normales:",t.taras),console.log("Taras extra:",t.tarasExtra);const e=(t.taras||[]).reduce((t,e)=>t+(e||0),0),a=(t.tarasExtra||[]).reduce((t,e)=>t+(e||0),0);return console.log("Total taras:",e+a),e+a},totalKilos(t){console.log("Kilos:",t.kilos),console.log("Restar taras:",t.restarTaras);const e=(t.kilos||[]).reduce((t,e)=>t+(e||0),0),a=(t.taras||[]).reduce((t,e)=>t+(e||0),0),o=t.restarTaras?3*a:0,i=Number((e-o).toFixed(1));return console.log("Total kilos:",i),i},obtenerNombreCliente(t){const e=this.clientesDisponibles.find(e=>e.id.toString()===t.toString());if(e)return e.nombre;const a=this.embarque.productos.find(e=>e.clienteId.toString()===t.toString());return a?a.nombreCliente:"Cliente Desconocido"},editarNombreCliente(t){const e=this.clientesDisponibles.find(e=>e.id===t);if(e&&e.editable){const a=prompt("Ingrese el nuevo nombre del cliente:",e.nombre);null!==a&&""!==a.trim()&&(e.nombre=a.trim(),this.embarque.productos.forEach(e=>{e.clienteId===t&&(e.nombreCliente=a.trim())}))}},async cargarEmbarque(t){if(console.log("Cargando embarque con ID:",t),"nuevo"===t)return void this.resetearEmbarque();const e=Object(et["h"])(),a=Object(et["e"])(e,"embarques",t);this.unsubscribe=Object(et["j"])(a,e=>{if(e.exists()){const a=e.data();let o;console.log("Datos del embarque cargado:",a),this.embarqueBloqueado=a.embarqueBloqueado||!1,a.clientesJuntarMedidas?this.clientesJuntarMedidas=a.clientesJuntarMedidas:(this.clientesJuntarMedidas={},a.clientes.forEach(t=>{this.$set(this.clientesJuntarMedidas,t.id,!1)})),a.fecha&&"function"===typeof a.fecha.toDate?o=a.fecha.toDate():a.fecha instanceof Date?o=a.fecha:"string"===typeof a.fecha?o=new Date(a.fecha):(console.warn("Formato de fecha no reconocido, usando la fecha actual"),o=new Date);const i=new Map(this.clientesPredefinidos.map(t=>[t.id,t]));this.clientesPersonalizados=a.clientes.filter(t=>!i.has(t.id)).map(t=>({id:t.id,nombre:t.nombre,editable:!0,personalizado:!0,key:"personalizado_"+t.id})),console.log("Clientes personalizados después de filtrar:",this.clientesPersonalizados),this.embarque={fecha:o.toISOString().split("T")[0],cargaCon:a.cargaCon||"",productos:a.clientes.flatMap(t=>{const e=i.get(t.id)||t;return t.productos.map(a=>({...a,clienteId:t.id,nombreCliente:e.nombre,restarTaras:a.restarTaras||!1}))}),kilosCrudos:a.kilosCrudos||{}},this.clienteCrudos={},a.clientes.forEach(t=>{t.crudos&&t.crudos.length>0&&this.$set(this.clienteCrudos,t.id,t.crudos)}),console.log("Embarque procesado:",this.embarque),console.log("Crudos cargados:",this.clienteCrudos),this.embarqueId=t,this.modoEdicion=!0,this.guardadoAutomaticoActivo=!0}else console.error("No se encontró el embarque"),this.resetearEmbarque()},t=>{console.error("Error al escuchar cambios del embarque:",t)})},resetearEmbarque(){this.embarque={fecha:(new Date).toISOString().split("T")[0],cargaCon:"",productos:[]},this.clientesJuntarMedidas={},this.embarqueId=null,this.modoEdicion=!1,this.guardadoAutomaticoActivo=!1,this.embarqueBloqueado=!1,this.clientesPersonalizados=[],this.$nextTick(async()=>{if(this.embarque.fecha)try{await this.guardarEmbarqueInicial(this.clientesPredefinidos[0].id.toString()),await new Promise(t=>setTimeout(t,100));for(let t=1;t<this.clientesPredefinidos.length;t++){const e=this.clientesPredefinidos[t].id.toString(),a=this.embarque.productos.some(t=>t.clienteId.toString()===e);if(!a){const a={id:Date.now()+t,clienteId:e,medida:"",tipo:"",tipoPersonalizado:"",taras:[],kilos:[],reporteTaras:[],reporteBolsas:[],tarasExtra:[],restarTaras:!0,camaronNeto:.65,multiplicadorBolsas:1,showSuggestions:!1,esVenta:!1,isEditing:!0,isNew:!0,noSumarKilos:!1};this.setTipoDefaultParaCliente(a),this.embarque.productos.push(a),await new Promise(t=>setTimeout(t,50))}}this.clienteActivo=this.clientesPredefinidos[0].id.toString(),this.guardarCambiosEnTiempoReal()}catch(t){console.error("Error al crear clientes predeterminados:",t)}})},guardarCambiosEnTiempoReal:Object(Da["debounce"])((function(){if(!this.guardadoAutomaticoActivo||!this.embarqueId||this.mostrarModalPrecio)return;const t={...JSON.parse(JSON.stringify(this.prepararDatosEmbarque())),clientesJuntarMedidas:{...this.clientesJuntarMedidas}},e=Object(et["h"])();Object(et["o"])(Object(et["e"])(e,"embarques",this.embarqueId),t).then(()=>{console.log("Cambios guardados automáticamente:",(new Date).toLocaleString()),this.$emit("guardado-automatico")}).catch(t=>{console.error("Error al guardar automáticamente:",t)})}),2e3),async guardarEmbarque(){if(!this.embarque.fecha)return void alert("Por favor, seleccione una fecha para el embarque.");const t=this.prepararDatosEmbarque(),e=Object(et["h"])();try{if(this.modoEdicion)await Object(et["o"])(Object(et["e"])(e,"embarques",this.embarqueId),t),alert("Embarque actualizado exitosamente.");else{const a=await Object(et["b"])(Object(et["c"])(e,"embarques"),{...t,ultimaEdicion:{userId:this.authStore.userId,username:this.authStore.user.username,timestamp:Object(et["m"])()}}),o=Object(Ea["d"])(P["c"],"cambios/"+a.id);await Object(Ea["e"])(o,{tipo:"guardar",userId:this.authStore.userId,username:this.authStore.user.username,timestamp:Object(et["m"])()}),this.embarqueId=a.id,alert("Embarque creado exitosamente y guardado en la base de datos."),this.modoEdicion=!0}this.guardadoAutomaticoActivo=!0,this.$router.push("/lista-embarques")}catch(a){console.error("Error al guardar el embarque: ",a),alert("Hubo un error al guardar el embarque. Por favor, intente nuevamente.")}},prepararDatosEmbarque(){const t={fecha:new Date(this.embarque.fecha),cargaCon:this.embarque.cargaCon,clientes:[],clientesJuntarMedidas:this.clientesJuntarMedidas,embarqueBloqueado:this.embarqueBloqueado},e=new Map(this.clientesPredefinidos.map(t=>[t.id,t]));return Object.entries(this.productosPorCliente).forEach(([a,o])=>{const i=e.get(parseInt(a)),s={id:a,nombre:i?i.nombre:this.obtenerNombreCliente(a),productos:o.map(t=>({...t,restarTaras:t.restarTaras||!1,noSumarKilos:t.noSumarKilos||!1})),crudos:this.clienteCrudos[a]||[]};t.clientes.push(s)}),t},onTipoChange(t){"otro"!==t.tipo&&(t.tipoPersonalizado=""),"c/h20"!==t.tipo||t.camaronNeto||(t.camaronNeto=.65),t.isEditing=!0,this.$nextTick(()=>{setTimeout(()=>{t.medida&&t.tipo&&(t.isEditing=!1)},100)})},setTipoDefaultParaCliente(t){const e=this.obtenerNombreCliente(t.clienteId);"Catarro"===e&&(t.tipo="s/h20")},undo(){if(this.undoStack.length>1){const t=this.undoStack.pop();this.redoStack.push(t);const e=this.undoStack[this.undoStack.length-1];this.isUndoRedo=!0,this.embarque=JSON.parse(e),console.log("Undo realizado. Estado actual restaurado."),this.guardarCambiosEnTiempoReal()}else console.log("No hay más acciones para deshacer.")},redo(){if(this.redoStack.length>0){const t=this.redoStack.pop();this.undoStack.push(t),this.isUndoRedo=!0,this.embarque=JSON.parse(t),console.log("Redo realizado. Estado actual restaurado."),this.guardarCambiosEnTiempoReal()}else console.log("No hay más acciones para rehacer.")},agregarReporteTara(t){Array.isArray(t.reporteTaras)||this.$set(t,"reporteTaras",[]),Array.isArray(t.reporteBolsas)||this.$set(t,"reporteBolsas",[]),t.reporteTaras.push(null),t.reporteBolsas.push(null)},eliminarReporteTara(t,e){t.reporteTaras.splice(e,1),t.reporteBolsas.splice(e,1)},obtenerTipoProducto(t){return"otro"===t.tipo?t.tipoPersonalizado||"Otro":t.tipo||"Sin Tipo"},async generarResumenEmbarque2(){this.$set(this,"isGeneratingPdf",!0),this.$set(this,"pdfType","resumen");try{const t=new Set;Object.values(this.clienteCrudos).forEach(e=>{e.forEach(e=>{e.items.forEach(e=>{e.talla&&t.add(e.talla)})})});const e={...this.embarque,crudos:Object.entries(this.clienteCrudos).flatMap(([t,e])=>e.flatMap(e=>e.items.map(e=>{const a=[];return e.taras&&a.push(e.taras),e.sobrante&&a.push(e.sobrante),{clienteId:t,medida:e.talla,taras:a,barco:e.barco,textoAlternativo:e.textoAlternativo}}))),medidasCrudos:Array.from(t)};console.log("Generando PDF de resumen de embarque..."),Ao(e,this.productosPorCliente,this.obtenerNombreCliente,this.clientesDisponibles),console.log("PDF generado con éxito")}catch(t){console.error("Error al generar el PDF:",t),alert("Hubo un error al generar el resumen de embarque: "+t.message)}finally{this.$set(this,"isGeneratingPdf",!1),this.$set(this,"pdfType",null)}},calcularAlturaCliente(t,e){try{let a=40;return Array.isArray(t)&&t.length>0&&(a+=30,a+=25*t.length),Array.isArray(e)&&e.length>0&&(a+=30,a+=e.reduce((t,e)=>e&&Array.isArray(e.items)?t+25*e.items.length:t,0)),a+=20,a}catch(a){return console.error("Error en calcularAlturaCliente:",a),60}},generarContenidoCliente(t,e,a,o){const i=this.obtenerNombreCliente(t),s=e.reduce((t,e)=>t+this.totalTaras(e),0),r=e.reduce((t,e)=>t+this.totalKilos(e),0),n=a.reduce((t,e)=>t+e.items.reduce((t,e)=>t+this.calcularKilosCrudos(e),0),0),c=a.reduce((t,e)=>t+e.items.reduce((t,e)=>t+this.calcularTarasCrudos(e),0),0),l=(r+n).toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:1}),d=[{table:{widths:["*",200],body:[[{text:i,style:"clienteHeader",fillColor:o},{text:`Total: ${s+c}T | ${l}Kg`,style:"total",fillColor:o,alignment:"right"}]]},margin:[0,10,0,0]}],u=a&&a.length>0&&a.some(t=>t.items&&t.items.length>0);if(e.length>0){const t={table:{headerRows:1,widths:u?[190,50,85]:[200,80,120],body:[[{text:"Medida",style:"tableHeader",fontSize:20},{text:"Kg",style:"tableHeader",fontSize:20},{text:"Taras",style:"tableHeader",fontSize:20}],...e.map(t=>{const e="c/h20"===t.tipo?this.calcularKilosProductoCH20(t):this.totalKilos(t),a=e.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:1}),o=[{text:t.medida||"",fontSize:18}];return"c/h20"===t.tipo?o.push({text:" c/h20",color:"#3498db",fontSize:18},{text:` (${t.camaronNeto||.65})`,color:"#3498db",fontSize:18}):"otro"===t.tipo?o.push({text:" "+t.tipoPersonalizado,fontSize:18}):t.tipo&&o.push({text:" "+t.tipo,fontSize:18}),t.precio&&o.push({text:" $"+t.precio,color:"#27ae60",fontSize:18}),[{text:o,fontSize:18},{text:a,fontSize:18},{text:`${this.totalTaras(t)}-${this.generarDetallesProductoCompacto(t)}`,fontSize:18}]})]},margin:[0,5,u?5:0,10]};u?d.push({columns:[{width:"*",stack:[t]},{width:"*",stack:[{table:{headerRows:1,widths:[45,55,25,40],body:[[{text:"Talla",style:"crudosHeader",fontSize:20},{text:"Barco",style:"crudosHeader",fontSize:20},{text:"T",style:"crudosHeader",fontSize:20},{text:"Kg",style:"crudosHeader",fontSize:20}],...a.flatMap(t=>t.items.map(t=>[{text:[{text:this.formatearTallaCrudo(t.talla),fontSize:18},t.precio?{text:"\n$"+t.precio,color:"#27ae60",fontSize:18}:""],fontSize:18},{text:t.barco,fontSize:18},{text:this.calcularTarasCrudos(t),fontSize:18},{text:this.calcularKilosCrudos(t).toFixed(0),fontSize:18}]))]},margin:[5,5,0,10]}]}]}):d.push(t)}return d},generarDetallesProductoCompacto(t){let e=[];if(t.reporteTaras&&t.reporteTaras.length>0){const a=this.combinarTarasBolsasCompacto(t.reporteTaras,t.reporteBolsas);a&&e.push(a)}return t.esVenta&&e.push("V"),e.join("|")},combinarTarasBolsasCompacto(t,e){const a={};return t.forEach((t,o)=>{const i=e[o]||"",s=i;a[s]=(a[s]||0)+parseInt(t||1)}),Object.entries(a).map(([t,e])=>`(${e}-${t})`).join(" ")},generarDetallesProducto(t){let e=[];if(t.reporteTaras&&t.reporteTaras.length>0){const a=this.combinarTarasBolsas(t.reporteTaras,t.reporteBolsas);a&&e.push(a)}return"c/h20"===t.tipo&&e.push("Neto: "+(t.camaronNeto||.65)),t.esVenta&&e.push("(Venta)"),e.join(" | ")},hexToRgb(t){const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null},getClienteColor(t){const e=this.clientesDisponibles.find(e=>e.id.toString()===t.toString());if(e&&(e.personalizado||t.toString().startsWith("personalizado_")))return"#95a5a6";const a={1:"#3498db",2:"#e74c3c",3:"#f1c40f",4:"#2ecc71"};return a[t]||"#95a5a6"},volverAEmbarquesMenu(){this.$router.push({name:"EmbarquesMenu"})},combinarTarasBolsas(t,e){const a={};return t.forEach((t,o)=>{const i=e[o]||"",s=i;a[s]=(a[s]||0)+parseInt(t||1)}),Object.entries(a).map(([t,e])=>`(${e}-${t})`).join(" ")},totalTarasReportadas(t){return(t.reporteTaras||[]).reduce((t,e)=>t+(parseInt(e)||0),0)},totalBolsasReportadas(t){return(t.reporteTaras||[]).reduce((e,a,o)=>{const i=parseInt(a)||0,s=parseInt(t.reporteBolsas[o])||0;return e+i*s},0)},coincideTaras(t){const e=this.totalTarasReportadas(t),a=this.totalTaras(t);return e===a},agregarTaraExtra(t){Array.isArray(t.tarasExtra)||this.$set(t,"tarasExtra",[]),t.tarasExtra.push(null)},eliminarTaraExtra(t,e){t.tarasExtra.splice(e,1)},agregarCrudo(t){this.clienteCrudos[t]||this.$set(this.clienteCrudos,t,[]),this.clienteCrudos[t].push({items:[{talla:"",barco:"",taras:null}]}),this.guardarCambiosEnTiempoReal()},agregarCrudoItem(t,e){this.clienteCrudos[t]||this.$set(this.clienteCrudos,t,[]),this.clienteCrudos[t][e]||this.$set(this.clienteCrudos[t],e,{items:[]}),this.clienteCrudos[t][e].items.push({talla:"",barco:"",taras:null,sobrante:null,mostrarSobrante:!1}),this.guardarCambiosEnTiempoReal()},eliminarCrudoItem(t,e,a){this.clienteCrudos[t][e].items.splice(a,1),0===this.clienteCrudos[t][e].items.length&&this.eliminarCrudo(t,e),this.guardarCambiosEnTiempoReal()},eliminarCrudo(t,e){this.clienteCrudos[t].splice(e,1),0===this.clienteCrudos[t].length&&this.$delete(this.clienteCrudos,t),this.guardarCambiosEnTiempoReal()},toggleSobrante(t,e,a){const o=this.clienteCrudos[t][e].items[a];o.hasOwnProperty("mostrarSobrante")?o.mostrarSobrante=!o.mostrarSobrante:this.$set(o,"mostrarSobrante",!0),this.guardarCambiosEnTiempoReal()},calcularTotalCrudos(t){return t.items.reduce((t,e)=>{let a=this.extraerNumero(e.taras),o=this.extraerNumero(e.sobrante);return t+a+o},0)},extraerNumero(t){if(!t)return 0;const e=t.toString().match(/^(\d+)/);return e?parseInt(e[1]):0},actualizarTotalCrudos(t,e){this.$forceUpdate(),this.guardarCambiosEnTiempoReal()},actualizarCrudos(){this.guardarCambiosEnTiempoReal()},calcularKilosCrudos(t){let e=0;if(t.taras){const[a,o]=t.taras.split("-").map(Number);e+=a*o}if(t.sobrante){const[a,o]=t.sobrante.split("-").map(Number);e+=a*o}return e},calcularTarasCrudos(t){let e=0;if(t.taras){const[a]=t.taras.split("-").map(Number);e+=a}if(t.sobrante){const[a]=t.sobrante.split("-").map(Number);e+=a}return e},async generarNotaVenta(t){this.$set(this,"isGeneratingPdf",!0),this.$set(this,"pdfType","cliente-"+t);try{const e=this.productosPorCliente[t],a=this.clienteCrudos[t],o={fecha:this.embarque.fecha,cargaCon:this.embarque.cargaCon,productos:e,clienteCrudos:{[t]:a},kilosCrudos:this.embarque.kilosCrudos||{}};console.log(`Generando nota de venta para cliente ${t}...`),qa(o,this.clientesDisponibles,this.clientesJuntarMedidas),console.log("Nota de venta generada con éxito")}catch(e){console.error("Error al generar la nota de venta:",e),alert("Hubo un error al generar la nota de venta: "+e.message)}finally{this.$set(this,"isGeneratingPdf",!1),this.$set(this,"pdfType",null)}},onRestarTarasChange(t){console.log("Restar taras cambiado:",t.restarTaras),this.$nextTick(()=>{this.actualizarProducto(t)})},actualizarProducto(t){const e=this.embarque.productos.findIndex(e=>e===t);if(-1!==e){const a=JSON.parse(JSON.stringify(t));this.$set(this.embarque.productos,e,a),this.$forceUpdate(),this.guardadoAutomaticoActivo&&this.embarqueId&&this.guardarCambiosEnTiempoReal()}},reporteExcedeTresParentesis(t){const e=this.combinarTarasBolsas(t.reporteTaras,t.reporteBolsas);return(e.match(/\(/g)||[]).length>3},generarReporteExtenso(t){const e=this.combinarTarasBolsas(t.reporteTaras,t.reporteBolsas);return e.replace(/\) /g,")\n")},calcularTarasLimpio(){return this.embarque.productos.reduce((t,e)=>{const a=e.clienteId,o=this.clientesPredefinidos.find(t=>t.id.toString()===a.toString());return o?t+this.totalTaras(e):t},0)},calcularTarasCrudo(){return Object.entries(this.clienteCrudos).reduce((t,[e,a])=>{const o=this.clientesPredefinidos.find(t=>t.id.toString()===e.toString());return o?t+a.reduce((t,e)=>t+this.calcularTotalCrudos(e),0):t},0)},calcularTotalTaras(){return this.calcularTarasLimpio()+this.calcularTarasCrudo()},calcularKilosLimpio(){return this.embarque.productos.reduce((t,e)=>{if("c/h20"===e.tipo){const a=e.reporteTaras||[],o=e.reporteBolsas||[];let i=0;for(let t=0;t<a.length;t++){const e=parseInt(a[t])||0,s=parseInt(o[t])||0;i+=e*s}const s=i*(e.camaronNeto||.65);return t+s}return t+this.totalKilos(e)},0).toFixed(2)},obtenerUltimaBolsa(t){const e=t.reporteBolsas||[];for(let a=e.length-1;a>=0;a--){const t=parseInt(e[a]);if(!isNaN(t))return t}return 0},calcularKilosCrudo(){return Object.values(this.clienteCrudos).reduce((t,e)=>t+e.reduce((t,e)=>t+e.items.reduce((t,e)=>t+parseFloat(this.calcularKilosCrudos(e)),0),0),0)},calcularTotalKilos(){const t=parseFloat(this.calcularKilosLimpio()),e=parseFloat(this.calcularKilosCrudo());return(t+e).toFixed(2)},calcularTotalBolsas:function(t){let e=0;for(let a=0;a<t.reporteTaras.length;a++){const o=parseInt(t.reporteTaras[a])||0,i=parseInt(t.reporteBolsas[a])||0;e+=o*i}return t.totalKilos=e,e},formatearTallaCrudo(t){const e={"Med c/c":"Med","Med-Esp c/c":"Esp","Med-gde c/c":"M-G","Gde c/c":"Gde","Extra c/c":"Ext","Jumbo c/c":"Jbo",Linea:"Lin",Rechazo:"Rch"};return e[t]||t},abrirModalPrecio(t){var e,a;null===(e=event)||void 0===e||e.preventDefault(),null===(a=event)||void 0===a||a.stopPropagation(),this.itemSeleccionado=t,this.precioTemp=t.precio||"",this.mostrarModalPrecio=!0,this.$nextTick(()=>{var t;null===(t=this.$refs.precioInput)||void 0===t||t.focus()})},cerrarModalPrecio(){var t,e;null===(t=event)||void 0===t||t.preventDefault(),null===(e=event)||void 0===e||e.stopPropagation(),this.mostrarModalPrecio=!1,this.itemSeleccionado=null,this.precioTemp=""},guardarPrecio(){var t,e;if(null===(t=event)||void 0===t||t.preventDefault(),null===(e=event)||void 0===e||e.stopPropagation(),this.itemSeleccionado){const t=parseFloat(this.precioTemp);if(!isNaN(t)){this.$set(this.itemSeleccionado,"precio",t);const e=this.guardadoAutomaticoActivo;this.guardadoAutomaticoActivo=!1,this.$nextTick(()=>{this.guardadoAutomaticoActivo=e,this.guardarCambiosEnTiempoReal()})}}this.cerrarModalPrecio()},abrirModalHilos(t){var e,a;null===(e=event)||void 0===e||e.preventDefault(),null===(a=event)||void 0===a||a.stopPropagation(),this.itemSeleccionado=t,this.hilosTemp=t.hilos||"",this.mostrarModalHilos=!0,this.$nextTick(()=>{var t;null===(t=this.$refs.hilosInput)||void 0===t||t.focus()})},cerrarModalHilos(){var t,e;null===(t=event)||void 0===t||t.preventDefault(),null===(e=event)||void 0===e||e.stopPropagation(),this.mostrarModalHilos=!1,this.itemSeleccionado=null,this.hilosTemp=""},guardarHilos(){var t,e;if(null===(t=event)||void 0===t||t.preventDefault(),null===(e=event)||void 0===e||e.stopPropagation(),this.itemSeleccionado){const t=this.hilosTemp.trim();t?this.$set(this.itemSeleccionado,"hilos",t):this.$delete(this.itemSeleccionado,"hilos");const e=this.guardadoAutomaticoActivo;this.guardadoAutomaticoActivo=!1,this.$nextTick(()=>{this.guardadoAutomaticoActivo=e,this.guardarCambiosEnTiempoReal()})}this.cerrarModalHilos()},async generarNotaVentaPDF(){this.$set(this,"isGeneratingPdf",!0),this.$set(this,"pdfType","all");try{const t={fecha:this.embarque.fecha,cargaCon:this.embarque.cargaCon,productos:this.embarque.productos,clienteCrudos:this.clienteCrudos,kilosCrudos:this.embarque.kilosCrudos||{}};console.log("Generando notas de venta para todos los clientes..."),qa(t,this.clientesDisponibles,this.clientesJuntarMedidas),console.log("Notas de venta generadas con éxito")}catch(t){console.error("Error al generar notas de venta:",t),alert("Hubo un error al generar las notas de venta: "+t.message)}finally{this.$set(this,"isGeneratingPdf",!1),this.$set(this,"pdfType",null)}},handleJuntarMedidasChange(t,e){this.$set(this.clientesJuntarMedidas,t,e),this.modoEdicion&&this.embarqueId&&this.guardarCambiosEnTiempoReal()},guardarCambiosEnTiempoReal:Object(Da["debounce"])((function(){if(!this.guardadoAutomaticoActivo||!this.embarqueId||this.mostrarModalPrecio)return;const t={...this.prepararDatosEmbarque(),clientesJuntarMedidas:this.clientesJuntarMedidas},e=Object(et["h"])();Object(et["o"])(Object(et["e"])(e,"embarques",this.embarqueId),t).then(()=>{console.log("Cambios guardados automáticamente:",(new Date).toLocaleString()),this.$emit("guardado-automatico")}).catch(t=>{console.error("Error al guardar automáticamente:",t)})}),1500),abrirModalNota(t){var e,a;null===(e=event)||void 0===e||e.preventDefault(),null===(a=event)||void 0===a||a.stopPropagation(),this.itemSeleccionado=t,this.notaTemp=t.nota||"",this.mostrarModalNota=!0,this.$nextTick(()=>{var t;null===(t=this.$refs.notaInput)||void 0===t||t.focus()})},cerrarModalNota(){var t,e;null===(t=event)||void 0===t||t.preventDefault(),null===(e=event)||void 0===e||e.stopPropagation(),this.mostrarModalNota=!1,this.itemSeleccionado=null,this.notaTemp=""},guardarNota(){var t,e;if(null===(t=event)||void 0===t||t.preventDefault(),null===(e=event)||void 0===e||e.stopPropagation(),this.itemSeleccionado){const t=this.notaTemp.trim();t?this.$set(this.itemSeleccionado,"nota",t):this.$delete(this.itemSeleccionado,"nota");const e=this.guardadoAutomaticoActivo;this.guardadoAutomaticoActivo=!1,this.$nextTick(()=>{this.guardadoAutomaticoActivo=e,this.guardarCambiosEnTiempoReal()})}this.cerrarModalNota()},calcularKilosProductoCH20(t){const e=t.reporteTaras||[],a=t.reporteBolsas||[];let o=0;for(let i=0;i<e.length;i++){const t=parseInt(e[i])||0,s=parseInt(a[i])||0;o+=t*s}return o},compararMedidas(t,e){if(!t)return 1;if(!e)return-1;const a=t=>{const e=t.match(/\d+/g);return e?1===e.length?[parseInt(e[0]),parseInt(e[0])]:[parseInt(e[0]),parseInt(e[1])]:[0,0]},[o,i]=a(t),[s,r]=a(e);return o&&s?o-s:t.localeCompare(e)},async generarResumenTarasPDF(){this.$set(this,"isGeneratingPdf",!0),this.$set(this,"pdfType","taras");try{const t={fecha:this.embarque.fecha,cargaCon:this.embarque.cargaCon,productos:this.embarque.productos,clienteCrudos:this.clienteCrudos};console.log("Generando PDF de taras..."),io(t,this.clientesDisponibles),console.log("PDF de taras generado con éxito")}catch(t){console.error("Error al generar PDF de taras:",t),alert("Hubo un error al generar el PDF de taras: "+t.message)}finally{this.$set(this,"isGeneratingPdf",!1),this.$set(this,"pdfType",null)}},onMedidaInput(t,e){const a=e.target.value.toLowerCase();this.productoEditandoId=t.id,t.medida=e.target.value,this.sugerenciasMedidas=a?this.medidasUsadas.filter(t=>t.toLowerCase().includes(a)&&t.toLowerCase()!==a):[],t.isEditing=!0,this.actualizarProducto(t)},onMedidaBlur(t){setTimeout(()=>{this.productoEditandoId=null},200),t.medida&&t.medida.length>0&&t.tipo&&(t.isEditing=!1,t.isNew=!1)},abrirModalNombreAlternativo(t){this.productoSeleccionado=t,this.nombreAlternativoTemp=t.nombreAlternativoPDF||t.medida,this.mostrarModalNombreAlternativo=!0,this.$nextTick(()=>{var t;null===(t=this.$refs.nombreAlternativoInput)||void 0===t||t.focus()})},cerrarModalNombreAlternativo(){this.mostrarModalNombreAlternativo=!1,this.productoSeleccionado=null,this.nombreAlternativoTemp=""},guardarNombreAlternativo(){if(this.productoSeleccionado){const t=this.guardadoAutomaticoActivo;this.guardadoAutomaticoActivo=!1;const e=this.nombreAlternativoTemp.trim();e?(this.$set(this.productoSeleccionado,"nombreAlternativoPDF",e),this.actualizarProducto(this.productoSeleccionado)):(this.$delete(this.productoSeleccionado,"nombreAlternativoPDF"),this.actualizarProducto(this.productoSeleccionado)),this.$nextTick(()=>{this.guardadoAutomaticoActivo=t,this.guardarCambiosEnTiempoReal(),this.cerrarModalNombreAlternativo()})}else this.cerrarModalNombreAlternativo()},actualizarProducto(t){const e=this.embarque.productos.findIndex(e=>e.id===t.id);if(-1!==e){const a=JSON.parse(JSON.stringify(t));this.$set(this.embarque.productos,e,a),this.$forceUpdate()}},coincideTarasYBolsas(t){const e=this.totalTaras(t),a=this.totalTarasReportadas(t);return(0!==e||0!==a)&&e===a},tieneAlgunReporte(t){return(t.reporteTaras||[]).some(t=>t)||(t.reporteBolsas||[]).some(t=>t)},calcularTotalLimpioCliente(t){const e=this.productosPorCliente[t]||[];return e.reduce((t,e)=>t+this.totalTaras(e),0)},calcularKilosLimpioCliente(t){const e=this.productosPorCliente[t]||[];return e.reduce((t,e)=>{if("c/h20"===e.tipo){const a=e.reporteTaras||[],o=e.reporteBolsas||[];let i=0;for(let t=0;t<a.length;t++){const e=parseInt(a[t])||0,s=parseInt(o[t])||0;i+=e*s}return t+i*(e.camaronNeto||.65)}return t+this.totalKilos(e)},0)},calcularTotalCrudoCliente(t){const e=this.clienteCrudos[t]||[];return e.reduce((t,e)=>t+e.items.reduce((t,e)=>t+this.calcularTarasCrudos(e),0),0)},calcularKilosCrudoCliente(t){const e=this.clienteCrudos[t]||[];return e.reduce((t,e)=>t+e.items.reduce((t,e)=>t+this.calcularKilosCrudos(e),0),0)},formatearKilos(t){return t.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:1})},actualizarMedidasUsadas(){const t=this.embarque.productos.map(t=>t.medida).filter(t=>t&&t.trim()).filter((t,e,a)=>a.indexOf(t)===e);this.medidasUsadas=t},seleccionarMedida(t,e){t.medida=e,this.productoEditandoId=null,this.actualizarProducto(t)},async generarResumenEmbarque2(){try{const t=new Set;Object.values(this.clienteCrudos).forEach(e=>{e.forEach(e=>{e.items.forEach(e=>{e.talla&&t.add(e.talla)})})});const e={...this.embarque,crudos:Object.entries(this.clienteCrudos).flatMap(([t,e])=>e.flatMap(e=>e.items.map(e=>{const a=[];return e.taras&&a.push(e.taras),e.sobrante&&a.push(e.sobrante),{clienteId:t,medida:e.talla,taras:a,barco:e.barco}}))),medidasCrudos:Array.from(t)};console.log("Datos del embarque:",e),Ao(e,this.productosPorCliente,this.obtenerNombreCliente,this.clientesDisponibles)}catch(t){console.error("Error al generar el PDF:",t)}},onTallaCrudoChange(t){t.medida||(t.medida=t.talla),this.guardarCambiosEnTiempoReal()},abrirModalAlt(t){var e,a;null===(e=event)||void 0===e||e.preventDefault(),null===(a=event)||void 0===a||a.stopPropagation(),this.itemSeleccionado=t,this.altTemp=t.textoAlternativo||"",this.mostrarModalAlt=!0,this.$nextTick(()=>{var t;null===(t=this.$refs.altInput)||void 0===t||t.focus()})},cerrarModalAlt(){var t,e;null===(t=event)||void 0===t||t.preventDefault(),null===(e=event)||void 0===e||e.stopPropagation(),this.mostrarModalAlt=!1,this.itemSeleccionado=null,this.altTemp=""},guardarAlt(){var t,e;if(null===(t=event)||void 0===t||t.preventDefault(),null===(e=event)||void 0===e||e.stopPropagation(),this.itemSeleccionado){const t=this.altTemp.trim();t?this.itemSeleccionado.textoAlternativo=t:delete this.itemSeleccionado.textoAlternativo,this.guardarCambiosEnTiempoReal()}this.cerrarModalAlt()},async escucharUsuariosActivos(){try{console.log("Iniciando escucha de usuarios activos");const e=Object(Ea["d"])(P["c"],"status");if(this.authStore.isLoggedIn&&this.authStore.user){console.log("Usuario autenticado:",this.authStore.user.username);const e=Object(Ea["d"])(P["c"],"status/"+this.authStore.userId);try{await Object(Ea["e"])(e,{username:this.authStore.user.username,status:"online",lastSeen:(new Date).toISOString()}),console.log("Estado del usuario actualizado correctamente")}catch(t){console.error("Error al actualizar estado del usuario:",t)}}else console.log("Usuario no autenticado");this.unsubscribeUsuarios=Object(Ea["c"])(e,t=>{const e=[];console.log("Recibiendo actualización de usuarios activos"),t.forEach(t=>{const a=t.val();console.log("Usuario encontrado:",a),a&&a.username&&e.push({userId:t.key,username:a.username,status:a.status||"online",lastSeen:a.lastSeen})}),console.log("Total usuarios activos:",e.length),this.usuariosActivos=e},t=>{console.error("Error al escuchar usuarios activos:",t)})}catch(t){console.error("Error al iniciar escucha de usuarios:",t)}},async iniciarPresenciaUsuario(){try{if(!this.authStore.isLoggedIn||!this.authStore.user)return void console.log("Usuario no autenticado");console.log("Iniciando presencia para usuario:",this.authStore.user.username);const t=Object(Ea["d"])(P["c"],"status/"+this.authStore.userId);await Object(Ea["b"])(t).remove(),await Object(Ea["e"])(t,{username:this.authStore.user.username,status:"online",lastSeen:(new Date).toISOString()}),console.log("Presencia iniciada exitosamente")}catch(t){console.error("Error al iniciar presencia:",t.message,t.stack)}},calcularPosicionSticky(t){const e=Object.keys(this.productosPorCliente),a=e.indexOf(t.toString());if(0===a)return 0;let o=0;for(let s=0;s<a;s++){var i;const t=e[s],a=(null===(i=this.$el.querySelector(`[data-cliente="${this.obtenerNombreCliente(t)}"]`))||void 0===i?void 0:i.offsetHeight)||0;o+=a}return o},calcularAlturaCliente(t=[],e=[]){try{let a=40;return Array.isArray(t)&&t.length>0&&(a+=30,a+=25*t.length),Array.isArray(e)&&e.length>0&&(a+=30,a+=e.reduce((t,e)=>e&&Array.isArray(e.items)?t+25*e.items.length:t,0)),a+=20,a}catch(a){return console.error("Error en calcularAlturaCliente:",a),60}},toggleBloqueo(){if(this.embarqueBloqueado=!this.embarqueBloqueado,this.modoEdicion&&this.embarqueId){const t=Object(et["h"])();Object(et["o"])(Object(et["e"])(t,"embarques",this.embarqueId),{embarqueBloqueado:this.embarqueBloqueado}).catch(t=>{console.error("Error al guardar estado de bloqueo:",t)})}},seleccionarCliente(t){if(!this.embarque.fecha)return void alert("Por favor, seleccione una fecha para el embarque.");const e=this.embarque.productos.some(e=>e.clienteId.toString()===t.toString());e?this.clienteActivo=t:this.guardarEmbarqueInicial(t).then(()=>{this.clienteActivo=t})},scrollToCliente(t){this.$nextTick(()=>{const e=document.querySelector(`.cliente-header[data-cliente="${this.obtenerNombreCliente(t)}"]`);e&&(document.querySelectorAll(".cliente-header").forEach(t=>{t.classList.remove("cliente-seleccionado")}),e.classList.add("cliente-seleccionado"),e.scrollIntoView({behavior:"smooth",block:"start"}),setTimeout(()=>{e.classList.remove("cliente-seleccionado")},2e3))})},toggleSidebar(){this.sidebarCollapsed=!this.sidebarCollapsed},cerrarModalNuevoCliente(){this.mostrarModalNuevoCliente=!1,this.nuevoClienteNombre="",this.nuevoClienteColor="#007bff"},agregarNuevoCliente(){if(""===this.nuevoClienteNombre.trim())return void alert("Por favor, ingrese un nombre para el nuevo cliente.");const t={id:Date.now().toString(),nombre:this.nuevoClienteNombre,color:this.nuevoClienteColor,editable:!0,personalizado:!0,key:"personalizado_"+Date.now()};this.clientesPersonalizados.push(t);const e={id:Date.now(),clienteId:t.id,medida:"",tipo:"",tipoPersonalizado:"",taras:[],kilos:[],reporteTaras:[],reporteBolsas:[],tarasExtra:[],restarTaras:!0,camaronNeto:.65,multiplicadorBolsas:1,showSuggestions:!1,esVenta:!1,isEditing:!0,isNew:!0,noSumarKilos:!1};this.embarque.productos.push(e),this.guardarClientesPersonalizados(),this.guardarCambiosEnTiempoReal(),this.cerrarModalNuevoCliente(),this.seleccionarCliente(t.id)},guardarClientesPersonalizados(){localStorage.setItem("clientesPersonalizados",JSON.stringify(this.clientesPersonalizados))},cargarClientesPersonalizados(){const t=localStorage.getItem("clientesPersonalizados");t&&(this.clientesPersonalizados=JSON.parse(t),console.log("Clientes personalizados disponibles cargados:",this.clientesPersonalizados))},obtenerColorCliente(t){const e=t.toLowerCase();return e.includes("joselito")?"#3498db":e.includes("catarro")?"#e74c3c":e.includes("otilio")?"#f1c40f":e.includes("ozuna")?"#2ecc71":"#95a5a6"},obtenerColorTextoCliente(t){const e=t.toLowerCase();return e.includes("otilio")?"black":"white"}},async created(){const t=this.$route.params.id;await this.cargarEmbarque(t),this.undoStack.push(JSON.stringify(this.embarque)),console.log("Component mounted. Estado inicial cargado."),this.actualizarMedidasUsadas(),this.cargarClientesPersonalizados(),await this.iniciarPresenciaUsuario(),this.escucharUsuariosActivos()},watch:{embarque:{handler(t){this.isUndoRedo?this.isUndoRedo=!1:(localStorage.setItem("embarque",JSON.stringify(t)),this.undoStack.push(JSON.stringify(t)),this.redoStack=[],console.log("Embarque actualizado. Estado agregado al undoStack."),this.guardarCambiosEnTiempoReal())},deep:!0},clienteCrudos:{handler(){this.guardarCambiosEnTiempoReal()},deep:!0},"embarque.productos":{handler(t){t.forEach(t=>{console.log("Producto actualizado:",t.restarTaras)})},deep:!0}},mounted(){this.$nextTick(()=>{const t=document.querySelectorAll(".crudo input, .crudo select");t.forEach(t=>{t.addEventListener("input",this.actualizarCrudos)})})},beforeDestroy(){this.unsubscribe&&this.unsubscribe();const t=document.querySelectorAll(".crudo input, .crudo select");t.forEach(t=>{t.removeEventListener("input",this.actualizarCrudos)}),this.unsubscribeUsuarios&&(console.log("Limpiando escucha de usuarios activos"),this.unsubscribeUsuarios())},updated(){console.log("Componente actualizado"),this.embarque.productos.forEach(t=>{console.log("Estado de restarTaras:",t.restarTaras)})}},So=xo,To=(a("eac9"),Object(d["a"])(So,Ma,Na,!1,null,"c3ea81f0",null)),Oo=To.exports,Mo=a("4dc0"),No=function(){var t=this,e=t._self._c;return e("div",{staticClass:"cuenta-fletes"},[e("div",{staticClass:"header-section"},[e("button",{staticClass:"btn-volver",on:{click:t.volverMenu}},[t._v(" ← Volver al Menú ")]),e("h2",[t._v("Cuenta de Fletes")])]),e("div",{staticClass:"chofer-selector"},[e("button",{class:["btn-chofer",{active:"Caminante"===t.choferSeleccionado}],on:{click:function(e){t.choferSeleccionado="Caminante"}}},[t._v(" Caminante ")]),e("button",{class:["btn-chofer",{active:"Porro"===t.choferSeleccionado}],on:{click:function(e){t.choferSeleccionado="Porro"}}},[t._v(" Porro ")]),e("button",{staticClass:"btn-imprimir",on:{click:t.generarPDF}},[t._v(" Imprimir Cuenta Pendiente ")])]),e("div",{staticClass:"abonos-section"},[e("h3",[t._v("Registrar Abono")]),e("div",{staticClass:"abono-inputs"},[e("div",{staticClass:"input-group"},[e("label",[t._v("Monto del Abono:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.nuevoAbono.monto,expression:"nuevoAbono.monto"}],staticClass:"input-abono",attrs:{type:"number",placeholder:"Cantidad"},domProps:{value:t.nuevoAbono.monto},on:{input:function(e){e.target.composing||t.$set(t.nuevoAbono,"monto",e.target.value)}}})]),e("div",{staticClass:"input-group"},[e("label",[t._v("Fecha del Abono:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.nuevoAbono.fecha,expression:"nuevoAbono.fecha"}],staticClass:"input-fecha",attrs:{type:"date"},domProps:{value:t.nuevoAbono.fecha},on:{input:function(e){e.target.composing||t.$set(t.nuevoAbono,"fecha",e.target.value)}}})]),e("div",{staticClass:"input-group"},[e("label",[t._v("Descripción:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.nuevoAbono.descripcion,expression:"nuevoAbono.descripcion"}],staticClass:"input-descripcion",attrs:{type:"text",placeholder:"Descripción del abono"},domProps:{value:t.nuevoAbono.descripcion},on:{input:function(e){e.target.composing||t.$set(t.nuevoAbono,"descripcion",e.target.value)}}})]),e("button",{staticClass:"btn-agregar-abono",attrs:{disabled:!t.nuevoAbono.monto||!t.nuevoAbono.fecha},on:{click:t.agregarAbono}},[t._v(" Agregar Abono ")])])]),e("div",{staticClass:"tabla-container"},[e("div",{staticClass:"tabla-desktop"},[e("table",{staticClass:"tabla-fletes"},[t._m(0),e("tbody",[t._l(t.itemsOrdenados,(function(a,o){return[e("tr",{key:a.id,class:{"fila-abono":"abono"===a.tipo}},[e("td",[t._v(t._s(t.formatearFecha(a.fecha)))]),e("td",[t._v(t._s("abono"===a.tipo?"Abono":"Flete"))]),e("td",[t._v(t._s("abono"===a.tipo?"-":a.tarasLimpio))]),e("td",[t._v(t._s("abono"===a.tipo?"-":a.tarasCrudo))]),e("td",[t._v(t._s("abono"===a.tipo?"-":a.tarasLimpio+a.tarasCrudo))]),e("td",[t._v(t._s("abono"===a.tipo?t.formatearMonto(-a.monto):t.formatearMonto(t.calcularMontoDia(a))))]),e("td",[t._v(t._s(t.formatearMonto(t.calcularDeudaAcumulada(o))))]),e("td",["flete"===a.tipo?e("span",{class:["estado",a.pagado?"pagado":"pendiente"]},[t._v(" "+t._s(a.pagado?"Pagado":"Pendiente")+" ")]):e("span",{staticClass:"estado abono"},[t._v("Abono")])]),e("td",["flete"===a.tipo?e("button",{class:["btn-pago",a.pagado?"btn-marcar-pendiente":"btn-marcar-pagado"],on:{click:function(e){return t.togglePago(a)}}},[t._v(" "+t._s(a.pagado?"Marcar Pendiente":"Marcar Pagado")+" ")]):e("button",{staticClass:"btn-eliminar-abono",on:{click:function(e){return t.eliminarAbono(a)}}},[t._v(" Eliminar Abono ")])])])]}))],2)])]),e("div",{staticClass:"tabla-mobile"},t._l(t.itemsOrdenados,(function(a,o){return e("div",{key:a.id,staticClass:"flete-card",class:{pagado:a.pagado,abono:"abono"===a.tipo}},[e("div",{staticClass:"flete-header"},[e("span",{staticClass:"fecha"},[t._v(t._s(t.formatearFecha(a.fecha)))]),"flete"===a.tipo?e("span",{class:["estado",a.pagado?"pagado":"pendiente"]},[t._v(" "+t._s(a.pagado?"Pagado":"Pendiente")+" ")]):e("span",{staticClass:"estado abono"},[t._v("Abono")])]),e("div",{staticClass:"flete-body"},[e("div",{staticClass:"flete-row"},[e("span",{staticClass:"label"},[t._v("Tipo:")]),e("span",{staticClass:"value"},[t._v(t._s("abono"===a.tipo?"Abono":"Flete"))])]),"flete"===a.tipo?[e("div",{staticClass:"flete-row"},[e("span",{staticClass:"label"},[t._v("Taras Limpio:")]),e("span",{staticClass:"value"},[t._v(t._s(a.tarasLimpio))])]),e("div",{staticClass:"flete-row"},[e("span",{staticClass:"label"},[t._v("Taras Crudo:")]),e("span",{staticClass:"value"},[t._v(t._s(a.tarasCrudo))])]),e("div",{staticClass:"flete-row"},[e("span",{staticClass:"label"},[t._v("Total Taras:")]),e("span",{staticClass:"value"},[t._v(t._s(a.tarasLimpio+a.tarasCrudo))])])]:t._e(),e("div",{staticClass:"flete-row"},[e("span",{staticClass:"label"},[t._v(t._s("abono"===a.tipo?"Monto Abonado:":"Monto del Día:"))]),e("span",{staticClass:"value"},[t._v(t._s("abono"===a.tipo?t.formatearMonto(-a.monto):t.formatearMonto(t.calcularMontoDia(a))))])]),e("div",{staticClass:"flete-row"},[e("span",{staticClass:"label"},[t._v("Deuda Acumulada:")]),e("span",{staticClass:"value"},[t._v(t._s(t.formatearMonto(t.calcularDeudaAcumulada(o))))])])],2),e("div",{staticClass:"flete-footer"},["flete"===a.tipo?e("button",{class:["btn-pago",a.pagado?"btn-marcar-pendiente":"btn-marcar-pagado"],on:{click:function(e){return t.togglePago(a)}}},[t._v(" "+t._s(a.pagado?"Marcar Pendiente":"Marcar Pagado")+" ")]):e("button",{staticClass:"btn-eliminar-abono",on:{click:function(e){return t.eliminarAbono(a)}}},[t._v(" Eliminar Abono ")])])])})),0)]),e("div",{staticClass:"resumen"},[e("h3",[t._v("Resumen de Cuenta")]),e("div",{staticClass:"resumen-detalles"},[e("div",{staticClass:"resumen-card"},[e("span",{staticClass:"resumen-label"},[t._v("Total Taras Limpio:")]),e("span",{staticClass:"resumen-value"},[t._v(t._s(t.totalTarasLimpio))])]),e("div",{staticClass:"resumen-card"},[e("span",{staticClass:"resumen-label"},[t._v("Total Taras Crudo:")]),e("span",{staticClass:"resumen-value"},[t._v(t._s(t.totalTarasCrudo))])]),e("div",{staticClass:"resumen-card"},[e("span",{staticClass:"resumen-label"},[t._v("Deuda Total:")]),e("span",{staticClass:"resumen-value"},[t._v(t._s(t.formatearMonto(t.deudaTotal)))])]),e("div",{staticClass:"resumen-card"},[e("span",{staticClass:"resumen-label"},[t._v("Monto Pagado:")]),e("span",{staticClass:"resumen-value"},[t._v(t._s(t.formatearMonto(t.montoPagado)))])]),e("div",{staticClass:"resumen-card"},[e("span",{staticClass:"resumen-label"},[t._v("Saldo Pendiente:")]),e("span",{staticClass:"resumen-value"},[t._v(t._s(t.formatearMonto(t.saldoPendiente)))])])])])])},Do=[function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",[t._v("Fecha")]),e("th",[t._v("Tipo")]),e("th",[t._v("Taras Limpio")]),e("th",[t._v("Taras Crudo")]),e("th",[t._v("Total Taras")]),e("th",[t._v("Monto del Día")]),e("th",[t._v("Deuda Acumulada")]),e("th",[t._v("Estado")]),e("th",[t._v("Acciones")])])])}],Eo=a("d67e"),jo=a.n(Eo),$o={name:"CuentaFletes",data(){return{fletes:[],abonos:[],choferSeleccionado:"Caminante",costoTaraLimpio:70,costoTaraCrudo:60,cargando:!1,imprimiendo:!1,nuevoAbono:{monto:null,fecha:(new Date).toISOString().split("T")[0],descripcion:""}}},computed:{fletesFiltrados(){return this.fletes.filter(t=>{var e;return null===(e=t.cargaCon)||void 0===e?void 0:e.toLowerCase().includes(this.choferSeleccionado.toLowerCase())})},abonosFiltrados(){return this.abonos.filter(t=>t.chofer.toLowerCase()===this.choferSeleccionado.toLowerCase())},itemsOrdenados(){const t=[...this.fletesFiltrados.map(t=>({...t,tipo:"flete"})),...this.abonosFiltrados.map(t=>({...t,tipo:"abono"}))];return t.sort((t,e)=>e.fecha-t.fecha)},totalTarasLimpio(){return this.fletesFiltrados.reduce((t,e)=>t+e.tarasLimpio,0)},totalTarasCrudo(){return this.fletesFiltrados.reduce((t,e)=>t+e.tarasCrudo,0)},deudaTotal(){return this.fletesFiltrados.reduce((t,e)=>t+this.calcularMontoDia(e),0)},montoPagado(){return this.fletesFiltrados.reduce((t,e)=>t+(e.pagado?this.calcularMontoDia(e):0),0)},saldoPendiente(){return this.deudaTotal-this.montoPagado},fletesPendientes(){return this.fletesFiltrados.filter(t=>!t.pagado)}},methods:{async cargarFletes(){this.cargando=!0;try{const t=Object(et["h"])(),e=Object(et["c"])(t,"embarques"),a=await Object(et["g"])(e),o=a.docs.map(t=>{var e;const a=t.data();let o=a.fecha.toDate?a.fecha.toDate():new Date(a.fecha);const i=null===(e=a.clientes)||void 0===e?void 0:e.find(t=>"1"===t.id||1===t.id||"Joselito"===t.nombre);if(i){let e=0,s=0;return i.productos&&Array.isArray(i.productos)&&(e=i.productos.reduce((t,e)=>{let a=0;return Array.isArray(e.taras)&&(a+=e.taras.reduce((t,e)=>t+(parseInt(e)||0),0)),Array.isArray(e.tarasExtra)&&(a+=e.tarasExtra.reduce((t,e)=>t+(parseInt(e)||0),0)),t+a},0)),i.crudos&&Array.isArray(i.crudos)&&(s=i.crudos.reduce((t,e)=>Array.isArray(e.items)?t+e.items.reduce((t,e)=>{let a=0;if(e.taras){const[t]=e.taras.split("-");a+=parseInt(t)||0}if(e.sobrante){const[t]=e.sobrante.split("-");a+=parseInt(t)||0}return t+a},0):t,0)),{id:t.id,fecha:o,tarasLimpio:e,tarasCrudo:s,cargaCon:a.cargaCon||"No especificado",pagado:a.fletePagado||!1}}return null}).filter(t=>null!==t).sort((t,e)=>e.fecha-t.fecha);this.fletes=o;const i=Object(et["c"])(t,"abonos"),s=await Object(et["g"])(i);this.abonos=s.docs.map(t=>({id:t.id,...t.data(),fecha:t.data().fecha.toDate()}))}catch(t){console.error("Error al cargar los datos:",t)}finally{this.cargando=!1}},formatearFecha(t){const e=new Date(t);return e.setDate(e.getDate()+1),e.toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"})},formatearMonto(t){return new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(t)},calcularMontoDia(t){return t.tarasLimpio*this.costoTaraLimpio+t.tarasCrudo*this.costoTaraCrudo},calcularDeudaAcumulada(t){const e=[...this.itemsOrdenados].sort((t,e)=>t.fecha-e.fecha),a=this.itemsOrdenados[t];return e.filter(t=>t.fecha<=a.fecha).reduce((t,e)=>{if("abono"===e.tipo)return t-e.monto;{const a=this.calcularMontoDia(e);return t+(e.pagado?0:a)}},0)},async togglePago(t){try{const e=Object(et["h"])(),a=Object(et["e"])(e,"embarques",t.id);await Object(et["o"])(a,{fletePagado:!t.pagado});const o=this.fletes.find(e=>e.id===t.id);o&&(o.pagado=!o.pagado)}catch(e){console.error("Error al actualizar el estado de pago:",e),alert("Error al actualizar el estado de pago. Por favor, intente de nuevo.")}},async agregarAbono(){if(this.nuevoAbono.monto&&this.nuevoAbono.fecha)try{const t=Object(et["h"])(),e=Object(et["c"])(t,"abonos"),a={monto:Number(this.nuevoAbono.monto),fecha:new Date(this.nuevoAbono.fecha),chofer:this.choferSeleccionado,descripcion:this.nuevoAbono.descripcion||"Abono realizado",createdAt:new Date},o=await Object(et["b"])(e,a);this.abonos.push({id:o.id,...a}),this.nuevoAbono={monto:null,fecha:(new Date).toISOString().split("T")[0],descripcion:""},alert("Abono registrado correctamente")}catch(t){console.error("Error al agregar el abono:",t),alert("Error al registrar el abono")}else alert("Por favor complete todos los campos del abono")},async eliminarAbono(t){if(confirm("¿Está seguro de eliminar este abono?"))try{const e=Object(et["h"])();await Object(et["d"])(Object(et["e"])(e,"abonos",t.id)),this.abonos=this.abonos.filter(e=>e.id!==t.id),alert("Abono eliminado correctamente")}catch(e){console.error("Error al eliminar el abono:",e),alert("Error al eliminar el abono")}},async generarPDF(){this.imprimiendo=!0;const t=document.createElement("div");t.innerHTML=`\n        <div class="pdf-container">\n          <h2>Cuenta de Fletes - ${this.choferSeleccionado}</h2>\n          <p class="fecha-impresion">Fecha de impresión: ${(new Date).toLocaleDateString("es-ES")}</p>\n          \n          \x3c!-- Tabla de Fletes Pendientes --\x3e\n          <h3>Fletes Pendientes</h3>\n          <table class="tabla-pdf">\n            <thead>\n              <tr>\n                <th>Fecha</th>\n                <th>Taras Limpio</th>\n                <th>Taras Crudo</th>\n                <th>Total Taras</th>\n                <th>Monto</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${this.fletesPendientes.map(t=>`\n                <tr>\n                  <td>${this.formatearFecha(t.fecha)}</td>\n                  <td>${t.tarasLimpio}</td>\n                  <td>${t.tarasCrudo}</td>\n                  <td>${t.tarasLimpio+t.tarasCrudo}</td>\n                  <td>${this.formatearMonto(this.calcularMontoDia(t))}</td>\n                </tr>\n              `).join("")}\n              <tr class="fila-total">\n                <td colspan="1"><strong>TOTAL FLETES</strong></td>\n                <td><strong>${this.fletesPendientes.reduce((t,e)=>t+e.tarasLimpio,0)}</strong></td>\n                <td><strong>${this.fletesPendientes.reduce((t,e)=>t+e.tarasCrudo,0)}</strong></td>\n                <td><strong>${this.fletesPendientes.reduce((t,e)=>t+e.tarasLimpio+e.tarasCrudo,0)}</strong></td>\n                <td><strong>${this.formatearMonto(this.fletesPendientes.reduce((t,e)=>t+this.calcularMontoDia(e),0))}</strong></td>\n              </tr>\n            </tbody>\n          </table>\n\n          ${this.abonosFiltrados.length>0?`\n            \x3c!-- Tabla de Abonos --\x3e\n            <h3>Abonos Realizados</h3>\n            <table class="tabla-pdf">\n              <thead>\n                <tr>\n                  <th>Fecha</th>\n                  <th colspan="3">Descripción</th>\n                  <th>Monto</th>\n                </tr>\n              </thead>\n              <tbody>\n                ${this.abonosFiltrados.map(t=>`\n                  <tr class="fila-abono">\n                    <td>${this.formatearFecha(t.fecha)}</td>\n                    <td colspan="3">${t.descripcion||"Abono realizado"}</td>\n                    <td>${this.formatearMonto(t.monto)}</td>\n                  </tr>\n                `).join("")}\n                <tr class="fila-total">\n                  <td colspan="4"><strong>TOTAL ABONOS</strong></td>\n                  <td><strong>${this.formatearMonto(this.abonosFiltrados.reduce((t,e)=>t+e.monto,0))}</strong></td>\n                </tr>\n              </tbody>\n            </table>\n          `:""}\n\n          <div class="resumen-pdf">\n            <h3>Resumen de Cuenta</h3>\n            <div class="resumen-grid">\n              <p><strong>Total Taras Limpio:</strong> ${this.fletesPendientes.reduce((t,e)=>t+e.tarasLimpio,0)}</p>\n              <p><strong>Total Taras Crudo:</strong> ${this.fletesPendientes.reduce((t,e)=>t+e.tarasCrudo,0)}</p>\n              <p><strong>Monto Total Fletes:</strong> ${this.formatearMonto(this.fletesPendientes.reduce((t,e)=>t+this.calcularMontoDia(e),0))}</p>\n              ${this.abonosFiltrados.length>0?`\n                <p><strong>Total Abonado:</strong> ${this.formatearMonto(this.abonosFiltrados.reduce((t,e)=>t+e.monto,0))}</p>\n              `:""}\n              <p class="total-final"><strong>Saldo Pendiente:</strong> ${this.formatearMonto(this.fletesPendientes.reduce((t,e)=>t+this.calcularMontoDia(e),0)-this.abonosFiltrados.reduce((t,e)=>t+e.monto,0))}</p>\n            </div>\n          </div>\n\n         \n      `;const e=document.createElement("style");e.textContent="\n        .pdf-container {\n          padding: 20px;\n          font-family: Arial, sans-serif;\n        }\n        .fecha-impresion {\n          color: #666;\n          margin-bottom: 20px;\n        }\n        h3 {\n          color: #333;\n          margin: 20px 0 10px 0;\n        }\n        .tabla-pdf {\n          width: 100%;\n          border-collapse: collapse;\n          margin-bottom: 20px;\n        }\n        .tabla-pdf th, .tabla-pdf td {\n          border: 1px solid #ddd;\n          padding: 8px;\n          text-align: left;\n        }\n        .tabla-pdf th {\n          background-color: #f8f9fa;\n        }\n        .fila-total {\n          background-color: #f8f9fa;\n          border-top: 2px solid #ddd;\n        }\n        .fila-total td {\n          font-size: 1.1em;\n        }\n        .fila-abono {\n          background-color: #e8f5e9;\n        }\n        .resumen-pdf {\n          margin-top: 30px;\n          padding: 15px;\n          background-color: #f8f9fa;\n          border-radius: 5px;\n        }\n        .resumen-grid {\n          display: grid;\n          gap: 10px;\n        }\n        .total-final {\n          margin-top: 10px;\n          padding-top: 10px;\n          border-top: 2px solid #ddd;\n          font-size: 1.2em;\n        }\n        .footer-pdf {\n          margin-top: 30px;\n          padding-top: 15px;\n          border-top: 1px solid #ddd;\n        }\n      ",t.appendChild(e);const a={margin:10,filename:`cuenta_fletes_${this.choferSeleccionado.toLowerCase()}_${(new Date).toISOString().split("T")[0]}.pdf`,image:{type:"jpeg",quality:.98},html2canvas:{scale:2},jsPDF:{unit:"mm",format:"a4",orientation:"portrait"}};try{await jo()().from(t).set(a).save()}catch(o){console.error("Error al generar el PDF:",o),alert("Error al generar el PDF. Por favor, intente de nuevo.")}finally{this.imprimiendo=!1}},volverMenu(){this.$router.push({name:"EmbarquesMenu"})}},mounted(){this.cargarFletes()}},Io=$o,Fo=(a("f980"),Object(d["a"])(Io,No,Do,!1,null,"1ded270a",null)),qo=Fo.exports,zo=function(){var t=this,e=t._self._c;return e("div",{staticClass:"login-container"},[e("div",{staticClass:"login-box"},[e("h2",[t._v("Iniciar Sesión")]),e("form",{on:{submit:function(e){return e.preventDefault(),t.handleLogin.apply(null,arguments)}}},[e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"username"}},[t._v("Usuario:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.username,expression:"username"}],staticClass:"form-input",attrs:{type:"text",id:"username",required:""},domProps:{value:t.username},on:{input:function(e){e.target.composing||(t.username=e.target.value)}}})]),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"password"}},[t._v("Contraseña:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.password,expression:"password"}],staticClass:"form-input",attrs:{type:"password",id:"password",required:""},domProps:{value:t.password},on:{input:function(e){e.target.composing||(t.password=e.target.value)}}})]),t.error?e("div",{staticClass:"error-message"},[t._v(" "+t._s(t.error)+" ")]):t._e(),e("button",{staticClass:"login-button",attrs:{type:"submit"}},[t._v(" Iniciar Sesión ")])])])])},Vo=[],Lo={name:"Login",data(){return{username:"",password:"",error:""}},methods:{async handleLogin(){try{const t=T(),e=await t.login(this.username,this.password);e?this.$router.push("/"):this.error="Usuario o contraseña incorrectos"}catch(t){console.error("Error en login:",t),this.error="Error al iniciar sesión"}}}},Bo=Lo,Go=(a("2b68"),Object(d["a"])(Bo,zo,Vo,!1,null,"6889dfef",null)),Ho=Go.exports,Ro=function(){var t=this,e=t._self._c;return e("div",{staticClass:"otilio-cuentas-menu-container"},[e("h1",[t._v("Menú de Cuentas Otilio")]),e("div",{staticClass:"actions-container"},[e("router-link",{staticClass:"action-button back-btn",attrs:{to:"/cuentas-mexico"}},[t._v(" Cuentas México ")]),e("router-link",{staticClass:"action-button new-cuenta-btn",attrs:{to:"/cuentas-otilio/nueva"}},[t._v(" Nueva Cuenta ")]),e("button",{staticClass:"action-button abonos-btn",on:{click:function(e){t.showAbonosModal=!0}}},[t._v(" Abonos ")]),e("PreciosHistorialModal"),e("StashModal",{attrs:{cliente:"otilio"}})],1),t.showAbonosModal?e("div",{staticClass:"modal"},[e("div",{staticClass:"modal-content"},[e("div",{staticClass:"modal-header"},[e("h2",[t._v("Historial de Abonos")]),e("button",{staticClass:"close-modal-btn",on:{click:function(e){t.showAbonosModal=!1}}},[t._v("×")])]),e("div",{staticClass:"fecha-filtros"},[e("div",{staticClass:"fecha-grupo"},[e("label",[t._v("Desde:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.fechaInicio,expression:"fechaInicio"}],staticClass:"fecha-input",attrs:{type:"date"},domProps:{value:t.fechaInicio},on:{change:t.calcularTotalAbonos,input:function(e){e.target.composing||(t.fechaInicio=e.target.value)}}})]),e("div",{staticClass:"fecha-grupo"},[e("label",[t._v("Hasta:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.fechaFin,expression:"fechaFin"}],staticClass:"fecha-input",attrs:{type:"date"},domProps:{value:t.fechaFin},on:{change:t.calcularTotalAbonos,input:function(e){e.target.composing||(t.fechaFin=e.target.value)}}})])]),null!==t.totalAbonosPeriodo?e("div",{staticClass:"total-abonos"},[e("span",{staticClass:"total-label"},[t._v("Total de abonos en el periodo:")]),e("span",{staticClass:"total-monto"},[t._v("$"+t._s(t.formatNumber(t.totalAbonosPeriodo)))])]):t._e(),e("div",{staticClass:"abonos-list"},[0===t.abonosHistorial.length?e("div",{staticClass:"no-records"},[t._v(" No hay abonos registrados. ")]):e("div",t._l(t.abonosHistorial,(function(a,o){return e("div",{key:o,staticClass:"abono-item"},[e("div",{staticClass:"abono-fecha"},[t._v(t._s(t.formatDate(a.fecha)))]),e("div",{staticClass:"abono-details"},[e("span",{staticClass:"abono-monto"},[t._v("$"+t._s(t.formatNumber(a.monto)))]),e("span",{staticClass:"abono-descripcion"},[t._v(t._s(a.descripcion))])])])})),0)]),e("button",{staticClass:"close-btn",on:{click:function(e){t.showAbonosModal=!1}}},[t._v("Cerrar")])])]):t._e(),e("div",{staticClass:"cuentas-list"},[e("h2",[t._v("Registros de Cuentas")]),t.error?e("div",{staticClass:"error-message"},[t._v(" Error al cargar los datos: "+t._s(t.error)+" ")]):t.isLoading?e("div",{staticClass:"loading"},[t._v("Cargando registros...")]):0===t.cuentas.length?e("div",{staticClass:"no-records"},[t._v(" No hay registros de cuentas que coincidan con el filtro. ")]):e("ul",t._l(t.cuentas,(function(a){return e("li",{key:a.id,staticClass:"cuenta-item",class:{"tiene-observacion":a.tieneObservacion}},[e("div",{staticClass:"cuenta-content"},[e("span",{staticClass:"cuenta-date"},[t._v(t._s(t.formatDate(a.fecha)))]),e("p",{staticClass:"cuenta-summary"},[e("span",[t._v("Saldo Hoy: $"+t._s(t.formatNumber(a.saldoHoy)))]),e("span",[t._v("Total Acumulado: $"+t._s(t.formatNumber(a.totalNota)))])]),a.tieneObservacion?e("div",{staticClass:"observacion-badge",on:{click:function(e){return t.mostrarObservacion(a)}}},[t._v(" Ver observación ")]):t._e(),a.abonos&&a.abonos.length>0?e("div",{staticClass:"abonos-info"},[t._l(a.abonos,(function(a,o){return e("p",{key:o,staticClass:"abono-detail"},[e("span",{staticClass:"abono-label"},[t._v("Abono:")]),e("span",{staticClass:"abono-monto"},[t._v("$"+t._s(t.formatNumber(a.monto)))]),e("span",{staticClass:"abono-descripcion"},[t._v(t._s(a.descripcion||"Sin descripción"))])])})),e("p",{staticClass:"total-abonos-dia"},[e("span",{staticClass:"total-label"},[t._v("Total")]),e("span",{staticClass:"total-monto"},[t._v("$"+t._s(t.formatNumber(a.abonos.reduce((t,e)=>t+(parseFloat(e.monto)||0),0))))])])],2):t._e()]),e("div",{staticClass:"cuenta-actions"},[e("button",{staticClass:"edit-btn",on:{click:function(e){return t.editarCuenta(a.id)}}},[t._v("Editar")]),e("button",{staticClass:"delete-btn",on:{click:function(e){return t.borrarCuenta(a.id)}}},[t._v("Borrar")])])])})),0)]),t.showObservacionModal?e("div",{staticClass:"modal-overlay"},[e("div",{staticClass:"modal-content"},[e("h3",[t._v("Observación")]),e("p",{staticClass:"observacion-text"},[t._v(t._s(t.observacionActual))]),e("div",{staticClass:"modal-buttons"},[e("button",{staticClass:"btn-cerrar",on:{click:function(e){t.showObservacionModal=!1}}},[t._v("Cerrar")])])])]):t._e()])},Ko=[],Jo={name:"OtilioCuentasMenu",components:{BackButton:dt["a"],PreciosHistorialModal:Me,StashModal:Ie},data(){return{cuentas:[],isLoading:!0,unsubscribe:null,error:null,showAbonosModal:!1,abonosHistorial:[],fechaInicio:"",fechaFin:"",totalAbonosPeriodo:null,showObservacionModal:!1,observacionActual:""}},methods:{async loadCuentas(){try{this.isLoading=!0;const t=Object(et["c"])(P["a"],"cuentasOtilio"),e=Object(et["l"])(t,Object(et["k"])("fecha","asc"));this.unsubscribe=Object(et["j"])(e,async t=>{const e=t.docs.map(t=>{const e=t.data(),a=(e.cobros||[]).reduce((t,e)=>t+(parseFloat(e.monto)||0),0),o=(e.abonos||[]).reduce((t,e)=>t+(parseFloat(e.monto)||0),0);return{id:t.id,fecha:e.fecha,saldoHoy:e.totalGeneralVenta||0,totalCobros:a,totalAbonos:o,totalNota:e.nuevoSaldoAcumulado||0,nuevoSaldoAcumulado:e.nuevoSaldoAcumulado||0,saldoAcumuladoAnterior:e.saldoAcumuladoAnterior||0,abonos:e.abonos||[],tieneObservacion:e.tieneObservacion||!1,observacion:e.observacion||""}}),a=e.sort((t,e)=>new Date(t.fecha)-new Date(e.fecha));let o=0;const i=[];for(let s=0;s<a.length;s++){const t=a[s],e=t.saldoHoy-t.totalCobros-t.totalAbonos;o+=e;const r=0===s?0:a[s-1].nuevoSaldoAcumulado;t.saldoAcumuladoAnterior===r&&t.nuevoSaldoAcumulado===o||i.push({id:t.id,updates:{saldoAcumuladoAnterior:r,nuevoSaldoAcumulado:o}}),t.totalNota=o,t.saldoAcumuladoAnterior=r,o<=0&&(o=0)}i.length>0&&await Promise.all(i.map(({id:t,updates:e})=>Object(et["o"])(Object(et["e"])(P["a"],"cuentasOtilio",t),e))),this.cuentas=a.reverse(),this.isLoading=!1})}catch(t){console.error("Error al cargar cuentas: ",t),this.error=t.message,this.cuentas=[],this.isLoading=!1}},formatDate(t){const e=new Date(t);return e.setMinutes(e.getMinutes()+e.getTimezoneOffset()),e.toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"})},formatNumber(t){return t.toLocaleString("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2})},editarCuenta(t){this.$router.push(`/cuentas-otilio/${t}?edit=true`)},async borrarCuenta(t){if(confirm("¿Estás seguro de que quieres borrar este registro de cuenta?"))try{await Object(et["d"])(Object(et["e"])(P["a"],"cuentasOtilio",t)),alert("Registro de cuenta borrado con éxito")}catch(e){console.error("Error al borrar el registro de cuenta: ",e),alert("Error al borrar el registro de cuenta")}},calcularTotalAbonos(){if(!this.fechaInicio||!this.fechaFin)return void(this.totalAbonosPeriodo=null);const t=new Date(this.fechaInicio),e=new Date(this.fechaFin);e.setHours(23,59,59,999);const a=this.abonosHistorial.filter(a=>{const o=new Date(a.fecha);return o>=t&&o<=e});this.totalAbonosPeriodo=a.reduce((t,e)=>t+(parseFloat(e.monto)||0),0)},async cargarHistorialAbonos(){try{const t=Object(et["c"])(P["a"],"cuentasOtilio"),e=await Object(et["g"])(t);let a=[];e.forEach(t=>{const e=t.data();e.abonos&&e.abonos.length>0&&e.abonos.forEach(t=>{a.push({...t,fecha:e.fecha})})}),this.abonosHistorial=a.sort((t,e)=>new Date(e.fecha)-new Date(t.fecha)),this.fechaInicio&&this.fechaFin&&this.calcularTotalAbonos()}catch(t){console.error("Error al cargar historial de abonos:",t)}},mostrarObservacion(t){this.observacionActual=t.observacion,this.showObservacionModal=!0}},watch:{showAbonosModal(t){t&&this.cargarHistorialAbonos()}},created(){this.loadCuentas()},beforeUnmount(){this.unsubscribe&&this.unsubscribe()}},Uo=Jo,Yo=(a("8f2b"),Object(d["a"])(Uo,Ro,Ko,!1,null,"c9814918",null)),Wo=Yo.exports,Qo=function(){var t=this,e=t._self._c;return e("div",{staticClass:"cuentas-otilio-container"},[t.isSaving?e("div",{staticClass:"auto-save-indicator"},[e("span",{staticClass:"save-dot"}),t._v(" Guardando... ")]):t._e(),e("div",{staticClass:"back-button-container"},[e("BackButton",{attrs:{to:"/cuentas-otilio"}}),e("PreciosHistorialModal"),e("StashModal",{attrs:{cliente:"otilio"}})],1),e("h1",[t._v("Cuentas Otilio")]),e("div",{staticClass:"fecha-actual"},[e("div",{staticClass:"fecha-input"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.fechaSeleccionada,expression:"fechaSeleccionada"}],attrs:{type:"date"},domProps:{value:t.fechaSeleccionada},on:{input:function(e){e.target.composing||(t.fechaSeleccionada=e.target.value)}}})]),e("div",{staticClass:"fecha-display"},[t._v(" "+t._s(t.fechaFormateada)+" ")])]),e("div",{staticClass:"input-section"},[e("h2",[t._v("Ingresar Datos")]),e("div",{staticClass:"input-row"},[e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.newItem.kilos,expression:"newItem.kilos",modifiers:{number:!0}}],staticClass:"responsive-input",attrs:{type:"number",placeholder:"Kilos",inputmode:"decimal",pattern:"[0-9]*"},domProps:{value:t.newItem.kilos},on:{input:function(e){e.target.composing||t.$set(t.newItem,"kilos",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),e("input",{directives:[{name:"model",rawName:"v-model",value:t.newItem.medida,expression:"newItem.medida"}],staticClass:"responsive-input",attrs:{type:"text",placeholder:"Medida"},domProps:{value:t.newItem.medida},on:{input:function(e){e.target.composing||t.$set(t.newItem,"medida",e.target.value)}}}),e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.newItem.costo,expression:"newItem.costo",modifiers:{number:!0}}],staticClass:"responsive-input",attrs:{type:"number",placeholder:"Costo",inputmode:"decimal",pattern:"[0-9]*"},domProps:{value:t.newItem.costo},on:{input:function(e){e.target.composing||t.$set(t.newItem,"costo",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.newItem.precioVenta,expression:"newItem.precioVenta",modifiers:{number:!0}}],staticClass:"responsive-input",attrs:{type:"number",placeholder:"Precio Venta",inputmode:"decimal",pattern:"[0-9]*"},domProps:{value:t.newItem.precioVenta},on:{input:function(e){e.target.composing||t.$set(t.newItem,"precioVenta",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),e("button",{on:{click:t.addItem}},[t._v("Agregar")])])]),e("table",{staticClass:"tabla-principal"},[t._m(0),e("tbody",t._l(t.items,(function(a,o){return e("tr",{key:o},[e("td",{on:{click:function(e){return t.editField(o,"kilos")},touchstart:function(e){return t.startLongPress(o,"kilos")},touchend:t.endLongPress}},[t._v(" "+t._s(t.editingField.index===o&&"kilos"===t.editingField.field?"":t.formatNumber(a.kilos))+" "),t.editingField.index===o&&"kilos"===t.editingField.field?e("input",{directives:[{name:"model",rawName:"v-model.number",value:a.kilos,expression:"item.kilos",modifiers:{number:!0}}],ref:"editInput",refInFor:!0,attrs:{type:"number"},domProps:{value:a.kilos},on:{blur:[t.finishEditing,function(e){return t.$forceUpdate()}],keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.finishEditing.apply(null,arguments)},input:function(e){e.target.composing||t.$set(a,"kilos",t._n(e.target.value))}}}):t._e()]),e("td",{on:{click:function(e){return t.editField(o,"medida")},touchstart:function(e){return t.startLongPress(o,"medida")},touchend:t.endLongPress}},[t._v(" "+t._s(t.editingField.index===o&&"medida"===t.editingField.field?"":a.medida)+" "),t.editingField.index===o&&"medida"===t.editingField.field?e("input",{directives:[{name:"model",rawName:"v-model",value:a.medida,expression:"item.medida"}],ref:"editInput",refInFor:!0,attrs:{type:"text"},domProps:{value:a.medida},on:{blur:t.finishEditing,keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.finishEditing.apply(null,arguments)},input:function(e){e.target.composing||t.$set(a,"medida",e.target.value)}}}):t._e()]),e("td",{on:{click:function(e){return t.editField(o,"costo")},touchstart:function(e){return t.startLongPress(o,"costo")},touchend:t.endLongPress}},[t._v(" "+t._s(t.editingField.index===o&&"costo"===t.editingField.field?"":"$"+t.formatNumber(a.costo))+" "),t.editingField.index===o&&"costo"===t.editingField.field?e("input",{directives:[{name:"model",rawName:"v-model.number",value:a.costo,expression:"item.costo",modifiers:{number:!0}}],ref:"editInput",refInFor:!0,attrs:{type:"number"},domProps:{value:a.costo},on:{blur:[t.finishEditing,function(e){return t.$forceUpdate()}],keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.finishEditing.apply(null,arguments)},input:function(e){e.target.composing||t.$set(a,"costo",t._n(e.target.value))}}}):t._e()]),e("td",[t._v("$"+t._s(t.formatNumber(a.total)))]),e("td",{staticClass:"action-column desktop-only"},[e("button",{staticClass:"delete-btn",on:{click:function(e){return t.removeItem(o)}}},[t._v("Eliminar")])])])})),0),e("tfoot",[e("tr",{staticClass:"total"},[t._m(1),e("td",[e("strong",[t._v("$"+t._s(t.formatNumber(t.totalGeneral)))])]),e("td")])])]),e("h2",[t._v("Precios de Venta")]),e("div",{staticClass:"add-product-button"},[e("button",{on:{click:function(e){t.showAddProductModal=!0}}},[t._v("Agregar Producto")])]),e("table",{staticClass:"tabla-venta"},[t._m(2),e("tbody",[t._l(t.itemsVenta,(function(a,o){return e("tr",{key:o,on:{click:function(e){return t.toggleGananciasMobile(o)}}},[e("td",{on:{click:function(e){return t.editKilos(o)},touchstart:function(e){return t.startLongPress(o)},touchend:t.endLongPress}},[t._v(" "+t._s(t.editingKilosIndex===o?"":t.formatNumber(a.kilosVenta))+" "),t.editingKilosIndex===o?e("input",{directives:[{name:"model",rawName:"v-model.number",value:a.kilosVenta,expression:"item.kilosVenta",modifiers:{number:!0}}],ref:"kilosInput",refInFor:!0,attrs:{type:"number"},domProps:{value:a.kilosVenta},on:{blur:[t.finishEditingKilos,function(e){return t.$forceUpdate()}],keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.finishEditingKilos.apply(null,arguments)},input:function(e){e.target.composing||t.$set(a,"kilosVenta",t._n(e.target.value))}}}):t._e()]),e("td",[t._v(t._s(a.medida))]),e("td",[e("input",{staticClass:"precio-venta-input",attrs:{type:"number",inputmode:"decimal",pattern:"[0-9]*",step:"0.01"},domProps:{value:a.precioVenta},on:{input:e=>{a.precioVenta=Number(e.target.value),t.calcularTotalVenta(o)}}})]),e("td",[t._v("$"+t._s(t.formatNumber(a.totalVenta)))]),e("td",{class:{"desktop-only":!0,"ganancia-positiva":a.ganancia>0,"ganancia-negativa":a.ganancia<0}},[t._v(" $"+t._s(t.formatNumber(a.ganancia))+" ")])])})),null!==t.selectedRowIndex?e("tr",{staticClass:"mobile-only ganancia-row"},[e("td",{attrs:{colspan:"4"}},[e("strong",[t._v("Ganancias:")]),e("span",{class:{"ganancia-positiva":t.itemsVenta[t.selectedRowIndex].ganancia>0,"ganancia-negativa":t.itemsVenta[t.selectedRowIndex].ganancia<0}},[t._v(" $"+t._s(t.formatNumber(t.itemsVenta[t.selectedRowIndex].ganancia))+" ")])])]):t._e()],2),e("tfoot",[e("tr",{staticClass:"total"},[t._m(3),e("td",[e("strong",[t._v("$"+t._s(t.formatNumber(t.totalGeneralVenta)))])]),e("td",{staticClass:"desktop-only"},[e("strong",[t._v("$"+t._s(t.formatNumber(t.gananciaTotal)))])])])])]),e("div",{staticClass:"ganancia-del-dia"},[e("h3",[t._v("Ganancia del Día")]),e("p",{class:{"ganancia-positiva":t.gananciaDelDia>0,"ganancia-negativa":t.gananciaDelDia<0}},[t._v(" $"+t._s(t.formatNumber(t.gananciaDelDia))+" ")])]),e("h2",[t._v("Saldo pendiente")]),e("div",{staticClass:"saldo-pendiente"},[e("div",{staticClass:"input-row"},[e("span",[t._v("Saldo Acumulado Anterior: $"+t._s(t.formatNumber(t.saldoAcumuladoAnterior)))])]),t._l(t.cobros,(function(a,o){return e("div",{key:o,staticClass:"input-row"},[e("input",{directives:[{name:"model",rawName:"v-model",value:a.descripcion,expression:"cobro.descripcion"}],staticClass:"responsive-input",attrs:{type:"text",placeholder:"Flete"},domProps:{value:a.descripcion},on:{input:function(e){e.target.composing||t.$set(a,"descripcion",e.target.value)}}}),e("input",{directives:[{name:"model",rawName:"v-model",value:a.monto,expression:"cobro.monto"}],staticClass:"responsive-input",attrs:{type:"number",placeholder:"Monto"},domProps:{value:a.monto},on:{input:function(e){e.target.composing||t.$set(a,"monto",e.target.value)}}}),e("button",{staticClass:"delete-btn",on:{click:function(e){return t.removeCobro(o)}}},[t._v("Eliminar")])])})),e("button",{staticClass:"add-btn",on:{click:t.addCobro}},[t._v("Agregar Flete")])],2),e("h2",[t._v("Abonos")]),e("div",{staticClass:"abonos"},[t._l(t.abonos,(function(a,o){return e("div",{key:o,staticClass:"input-row"},[e("input",{directives:[{name:"model",rawName:"v-model",value:a.descripcion,expression:"abono.descripcion"}],staticClass:"responsive-input",attrs:{type:"text",placeholder:"Descripción"},domProps:{value:a.descripcion},on:{input:function(e){e.target.composing||t.$set(a,"descripcion",e.target.value)}}}),e("input",{directives:[{name:"model",rawName:"v-model.number",value:a.monto,expression:"abono.monto",modifiers:{number:!0}}],staticClass:"responsive-input",attrs:{type:"number",placeholder:"Monto"},domProps:{value:a.monto},on:{input:function(e){e.target.composing||t.$set(a,"monto",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),e("button",{staticClass:"delete-btn",on:{click:function(e){return t.removeAbono(o)}}},[t._v("Eliminar")])])})),e("button",{staticClass:"add-btn",on:{click:t.addAbono}},[t._v("Agregar Abono")])],2),e("table",{staticClass:"tabla-saldo"},[e("tr",[e("td",[t._v("Saldo Acumulado Anterior")]),e("td",[t._v("$"+t._s(t.formatNumber(t.saldoAcumuladoAnterior)))])]),e("tr",[e("td",[t._v("Saldo Hoy")]),e("td",[t._v("$"+t._s(t.formatNumber(t.totalGeneralVenta)))])]),t._l(t.cobros,(function(a,o){return e("tr",{key:o},[e("td",[t._v(t._s(a.descripcion))]),e("td",[t._v("-$"+t._s(t.formatNumber(a.monto)))])])})),t._l(t.abonos,(function(a,o){return e("tr",{key:"abono-"+o},[e("td",[t._v(t._s(a.descripcion)+" (Abono)")]),e("td",[t._v("-$"+t._s(t.formatNumber(a.monto)))])])})),e("tr",{staticClass:"total"},[e("td",[t._v("Total")]),e("td",[t._v("$"+t._s(t.formatNumber(t.totalDiaActual)))])]),e("tr",{staticClass:"total"},[e("td",[t._v("Nuevo Saldo Acumulado")]),e("td",[t._v("$"+t._s(t.formatNumber(t.nuevoSaldoAcumulado)))])])],2),e("div",{staticClass:"button-container"},[e("button",{staticClass:"save-button",attrs:{disabled:t.isGuardando},on:{click:t.guardarNota}},[t._v(" "+t._s(t.isGuardando?"Guardando...":"Guardar Nota")+" ")]),e("button",{staticClass:"print-button",on:{click:t.imprimirTablas}},[t._v("Imprimir")])]),t.showMobileActions?e("div",{staticClass:"mobile-actions-modal"},[e("button",{staticClass:"edit-btn",on:{click:function(e){return t.editItem(t.selectedItemIndex)}}},[t._v("Editar")]),e("button",{staticClass:"delete-btn",on:{click:function(e){return t.removeItem(t.selectedItemIndex)}}},[t._v("Eliminar")]),e("button",{on:{click:t.cancelMobileActions}},[t._v("Cancelar")])]):t._e(),t.showEditModal?e("div",{staticClass:"edit-modal"},[e("h3",[t._v("Editar Item")]),e("div",{staticClass:"input-row"},[e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.editingItem.kilos,expression:"editingItem.kilos",modifiers:{number:!0}}],staticClass:"responsive-input",attrs:{type:"number",placeholder:"Kilos",inputmode:"decimal",pattern:"[0-9]*"},domProps:{value:t.editingItem.kilos},on:{input:function(e){e.target.composing||t.$set(t.editingItem,"kilos",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),e("input",{directives:[{name:"model",rawName:"v-model",value:t.editingItem.medida,expression:"editingItem.medida"}],staticClass:"responsive-input",attrs:{type:"text",placeholder:"Medida"},domProps:{value:t.editingItem.medida},on:{input:function(e){e.target.composing||t.$set(t.editingItem,"medida",e.target.value)}}}),e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.editingItem.costo,expression:"editingItem.costo",modifiers:{number:!0}}],staticClass:"responsive-input",attrs:{type:"number",placeholder:"Costo",inputmode:"decimal",pattern:"[0-9]*"},domProps:{value:t.editingItem.costo},on:{input:function(e){e.target.composing||t.$set(t.editingItem,"costo",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}})]),e("div",{staticClass:"button-row"},[e("button",{on:{click:t.saveEditedItem}},[t._v("Guardar")]),e("button",{on:{click:t.cancelEdit}},[t._v("Cancelar")])])]):t._e(),t.showAddProductModal?e("div",{staticClass:"modal"},[e("div",{staticClass:"modal-content"},[e("h3",[t._v("Agregar Nuevo Producto")]),e("div",{staticClass:"input-row"},[e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.newProduct.kilosVenta,expression:"newProduct.kilosVenta",modifiers:{number:!0}}],staticClass:"responsive-input",attrs:{type:"number",placeholder:"Kilos",inputmode:"decimal",pattern:"[0-9]*"},domProps:{value:t.newProduct.kilosVenta},on:{input:function(e){e.target.composing||t.$set(t.newProduct,"kilosVenta",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),e("input",{directives:[{name:"model",rawName:"v-model",value:t.newProduct.medida,expression:"newProduct.medida"}],staticClass:"responsive-input",attrs:{type:"text",placeholder:"Medida"},domProps:{value:t.newProduct.medida},on:{input:function(e){e.target.composing||t.$set(t.newProduct,"medida",e.target.value)}}}),e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.newProduct.precioVenta,expression:"newProduct.precioVenta",modifiers:{number:!0}}],staticClass:"responsive-input",attrs:{type:"number",placeholder:"Precio de Venta",inputmode:"decimal",pattern:"[0-9]*"},domProps:{value:t.newProduct.precioVenta},on:{input:function(e){e.target.composing||t.$set(t.newProduct,"precioVenta",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}})]),e("div",{staticClass:"button-row"},[e("button",{on:{click:t.addNewProduct}},[t._v("Agregar")]),e("button",{on:{click:function(e){t.showAddProductModal=!1}}},[t._v("Cancelar")])])])]):t._e(),e("div",{class:["estado-cuenta",t.estadoCuenta.toLowerCase(),{"no-pagado":"No Pagado"===t.estadoCuenta}]},[t._v(" "+t._s(t.estadoCuenta)+" ")]),e("div",{staticClass:"guardar-container"},[e("div",{staticClass:"observacion-container"},[e("button",{staticClass:"btn-agregar-observacion",on:{click:t.agregarObservacion}},[e("i",{staticClass:"fas fa-plus"}),t._v(" Agregar observación ")])]),t.observacion?e("div",{staticClass:"observacion-existente"},[e("div",{staticClass:"observacion-header"},[e("p",{staticClass:"observacion-titulo"},[t._v("Observación actual:")]),e("div",{staticClass:"observacion-buttons"},[e("button",{staticClass:"btn-editar",on:{click:t.editarObservacion}},[t._v("Editar")]),e("button",{staticClass:"btn-eliminar",attrs:{title:"Eliminar observación"},on:{click:t.eliminarObservacion}},[t._v("×")])])]),e("p",{staticClass:"observacion-texto"},[t._v(t._s(t.observacion))])]):t._e()]),t.showObservacionModal?e("div",{staticClass:"modal-overlay"},[e("div",{staticClass:"modal-content"},[e("h3",[t._v(t._s(t.observacion?"Editar":"Agregar")+" Observación")]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.observacion,expression:"observacion"}],attrs:{placeholder:"Escribe tu observación aquí...",rows:"4"},domProps:{value:t.observacion},on:{input:function(e){e.target.composing||(t.observacion=e.target.value)}}}),e("div",{staticClass:"modal-buttons"},[e("button",{staticClass:"btn-guardar",on:{click:t.guardarObservacion}},[t._v("Guardar")]),e("button",{staticClass:"btn-cancelar",on:{click:t.cancelarObservacion}},[t._v("Cancelar")])])])]):t._e(),t.showSaveMessage?e("div",{staticClass:"auto-save-message"},[t._v(" "+t._s(t.lastSaveMessage)+" ")]):t._e()])},Xo=[function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",[t._v("Kilos")]),e("th",[t._v("Medida")]),e("th",[t._v("Costo")]),e("th",[t._v("Total")]),e("th",{staticClass:"desktop-only"},[t._v("Acciones")])])])},function(){var t=this,e=t._self._c;return e("td",{staticClass:"text-right",attrs:{colspan:"3"}},[e("strong",[t._v("Total General Costo:")])])},function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",[t._v("Kilos")]),e("th",[t._v("Medida")]),e("th",[t._v("Precio")]),e("th",[t._v("Total")]),e("th",{staticClass:"desktop-only"},[t._v("Ganancias")])])])},function(){var t=this,e=t._self._c;return e("td",{staticClass:"text-right",attrs:{colspan:"3"}},[e("strong",[t._v("Total General Venta:")])])}],Zo={name:"CuentasOtilio",components:{BackButton:dt["a"],PreciosHistorialModal:Me,StashModal:Ie},data(){return{items:[],newItem:{kilos:null,medida:"",costo:null,precioVenta:null},saldoAcumuladoAnterior:0,cobros:[],abonos:[],fechaSeleccionada:this.obtenerFechaActual(),showMobileActions:!1,selectedItemIndex:null,presionTimer:null,itemsVenta:[],showEditModal:!1,editingItem:null,editingIndex:null,estadoPagado:!1,editingKilosIndex:null,longPressTimer:null,editingField:{index:null,field:null},selectedRowIndex:null,showAddProductModal:!1,newProduct:{kilosVenta:null,medida:"",precioVenta:null},autoSaveTimer:null,lastSavedData:null,saveQueue:[],isSaving:!1,lastSaveTime:null,saveMinInterval:5e3,selectedField:null,tieneObservacion:!1,showObservacionModal:!1,observacion:"",isGuardando:!1,lastSaveMessage:"",showSaveMessage:!1,saveMessageTimer:null,saveMessage:""}},computed:{fechaFormateada(){const t=new Date(this.fechaSeleccionada+"T00:00:00"),e={year:"numeric",month:"long",day:"numeric"};return t.toLocaleDateString("es-ES",e)},totalGeneral(){return this.items.reduce((t,e)=>t+(e.total||0),0)},totalGeneralVenta(){return this.itemsVenta.reduce((t,e)=>t+(e.totalVenta||0),0)},totalSaldo(){const t=this.cobros.reduce((t,e)=>t+(e.monto||0),0),e=this.abonos.reduce((t,e)=>t+(e.monto||0),0);return this.saldoAcumuladoAnterior+this.totalGeneralVenta+t-e},nuevoSaldoAcumulado(){return(this.saldoAcumuladoAnterior||0)+(this.totalDiaActual||0)},gananciaDelDia(){const t=this.items.reduce((t,e)=>t+(e.total||0),0);return(this.totalGeneralVenta||0)-(t||0)},saldoPendiente(){return this.totalGeneralVenta-this.abonos.reduce((t,e)=>t+(e.monto||0),0)},estadoCuenta(){return this.totalDiaActual<=0?"Pagado":"No Pagado"},gananciaTotal(){return this.itemsVenta.reduce((t,e)=>t+(e.ganancia||0),0)},totalDiaActual(){const t=this.cobros.reduce((t,e)=>t+(parseFloat(e.monto)||0),0),e=this.abonos.reduce((t,e)=>t+(parseFloat(e.monto)||0),0);return(this.totalGeneralVenta||0)-t-e}},methods:{obtenerFechaActual(){const t=new Date;return t.getFullYear()+"-"+String(t.getMonth()+1).padStart(2,"0")+"-"+String(t.getDate()).padStart(2,"0")},formatNumber(t){return null===t||void 0===t?"0.00":t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})},async loadExistingCuenta(t){try{const e=Object(et["e"])(P["a"],"cuentasOtilio",t),a=await Object(et["f"])(e);if(!a.exists())throw new Error("No se encontró la cuenta especificada");{const t=a.data();this.items=(t.items||[]).map(t=>({kilos:Number(t.kilos)||0,medida:t.medida||"",costo:Number(t.costo)||0,total:Number(t.total)||0})),this.itemsVenta=(t.itemsVenta||[]).map(t=>({kilosVenta:Number(t.kilosVenta)||0,medida:t.medida||"",precioVenta:Number(t.precioVenta)||0,totalVenta:Number(t.totalVenta)||0,ganancia:Number(t.ganancia)||0})),this.saldoAcumuladoAnterior=Number(t.saldoAcumuladoAnterior)||0,this.cobros=(t.cobros||[]).map(t=>({descripcion:t.descripcion||"",monto:Number(t.monto)||0})),this.abonos=(t.abonos||[]).map(t=>({descripcion:t.descripcion||"",monto:Number(t.monto)||0})),this.fechaSeleccionada=t.fecha||this.obtenerFechaActual()}}catch(e){throw console.error("Error al cargar la cuenta existente:",e),e}},async obtenerSaldoAcumuladoAnterior(){try{const t=Object(et["c"])(P["a"],"cuentasOtilio"),e=Object(et["l"])(t,Object(et["p"])("fecha","<",this.fechaSeleccionada),Object(et["k"])("fecha","desc"),Object(et["i"])(1)),a=await Object(et["g"])(e);if(!a.empty){const t=a.docs[0].data(),e=(t.cobros||[]).reduce((t,e)=>t+(parseFloat(e.monto)||0),0),o=(t.abonos||[]).reduce((t,e)=>t+(parseFloat(e.monto)||0),0),i=(t.totalGeneralVenta||0)-e-o;if(i<=0)return 0;const s=(t.saldoAcumuladoAnterior||0)+i;return s}return 0}catch(t){return console.error("Error al obtener saldo acumulado anterior:",t),0}},async actualizarCuentasPosteriores(t){try{const t=Object(et["c"])(P["a"],"cuentasOtilio"),e=Object(et["l"])(t,Object(et["k"])("fecha","asc")),a=await Object(et["g"])(e),o=a.docs.map(t=>({id:t.id,...t.data()})),i=o.sort((t,e)=>new Date(t.fecha)-new Date(e.fecha));let s=0;for(let r=0;r<i.length;r++){const t=i[r],e=Object(et["e"])(P["a"],"cuentasOtilio",t.id),a=t.totalGeneralVenta+(t.cobros||[]).reduce((t,e)=>t+(parseFloat(e.monto)||0),0)-(t.abonos||[]).reduce((t,e)=>t+(parseFloat(e.monto)||0),0);s+=a,await Object(et["o"])(e,{saldoAcumuladoAnterior:0===r?0:i[r-1].nuevoSaldoAcumulado,nuevoSaldoAcumulado:s,estadoPagado:s<=0}),s<=0&&(s=0)}}catch(e){throw console.error("Error al actualizar cuentas posteriores:",e),e}},async crearNuevaCuenta(){try{console.log("Iniciando creación de nueva cuenta...");const e=Object(et["c"])(P["a"],"cuentasOtilio");console.log("Referencia a la colección creada:",e);const a=Object(et["l"])(e,Object(et["p"])("fecha","==",this.fechaSeleccionada));console.log("Query construida para fecha:",this.fechaSeleccionada);const o=await Object(et["g"])(a);if(console.log("Query snapshot obtenido:",o.size,"documentos encontrados"),!o.empty)return alert("Ya existe una nota registrada para esta fecha. No se puede crear una nueva."),null;console.log("Obteniendo saldo acumulado anterior...");const i=await this.obtenerSaldoAcumuladoAnterior();console.log("Saldo anterior obtenido:",i);const s={fecha:this.fechaSeleccionada,items:this.items||[],itemsVenta:this.itemsVenta||[],saldoAcumuladoAnterior:i||0,cobros:this.cobros||[],abonos:this.abonos||[],totalGeneral:this.totalGeneral||0,totalGeneralVenta:this.totalGeneralVenta||0,nuevoSaldoAcumulado:0,estadoPagado:!1,ultimaActualizacion:(new Date).toISOString()};console.log("Datos preparados para crear nueva cuenta:",s);try{console.log("Intentando crear documento en Firestore...");const t=await Object(et["b"])(e,s);console.log("Documento creado exitosamente con ID:",t.id);const a=await Object(et["f"])(t);if(!a.exists())throw new Error("El documento no se creó correctamente");return console.log("Documento verificado y existe en Firestore"),console.log("Actualizando URL..."),await this.$router.push({name:"CuentasOtilio",params:{id:t.id},query:{edit:"true"}}),console.log("Cargando datos de la nueva cuenta..."),await this.loadExistingCuenta(t.id),alert("Cuenta creada exitosamente"),t.id}catch(t){throw console.error("Error específico de Firestore:",t),new Error("Error al crear el documento en Firestore: "+t.message)}}catch(e){throw console.error("Error detallado al crear nueva cuenta:",e),"Ya existe una nota registrada para esta fecha."===e.message?alert(e.message):alert(`Error al crear la cuenta: ${e.message}\nPor favor, revise la consola para más detalles.`),e}},async guardarNota(){try{if(this.isGuardando=!0,!this.fechaSeleccionada)throw new Error("La fecha es requerida");const e=this.$route.params.id,a="true"===this.$route.query.edit;if(!e||!a)try{const t=Object(et["c"])(P["a"],"cuentasOtilio"),e=Object(et["l"])(t,Object(et["p"])("fecha","==",this.fechaSeleccionada)),a=await Object(et["g"])(e);if(!a.empty)return alert("Ya existe una nota registrada para esta fecha. No se puede crear una nueva."),void(this.isGuardando=!1)}catch(t){return console.error("Error de red al verificar notas existentes:",t),alert("Error de conexión al verificar notas existentes. Por favor, verifica tu conexión a internet e intenta nuevamente."),void(this.isGuardando=!1)}const o={fecha:this.fechaSeleccionada,items:this.items.map(t=>({kilos:Number(t.kilos)||0,medida:String(t.medida||""),costo:Number(t.costo)||0,total:Number(t.kilos*t.costo)||0})),itemsVenta:this.itemsVenta.map(t=>({kilosVenta:Number(t.kilosVenta)||0,medida:String(t.medida||""),precioVenta:Number(t.precioVenta)||0,totalVenta:Number(t.kilosVenta*t.precioVenta)||0,ganancia:Number(t.ganancia)||0})),saldoAcumuladoAnterior:Number(this.saldoAcumuladoAnterior)||0,cobros:this.cobros.map(t=>({descripcion:String(t.descripcion||""),monto:Number(t.monto)||0})),abonos:this.abonos.map(t=>({descripcion:String(t.descripcion||""),monto:Number(t.monto)||0})),totalGeneral:Number(this.totalGeneral)||0,totalGeneralVenta:Number(this.totalGeneralVenta)||0,totalCobros:Number(this.cobros.reduce((t,e)=>t+(Number(e.monto)||0),0)),totalAbonos:Number(this.abonos.reduce((t,e)=>t+(Number(e.monto)||0),0)),totalDia:Number(this.totalDiaActual)||0,nuevoSaldoAcumulado:Number(this.nuevoSaldoAcumulado)||0,gananciaDelDia:Number(this.gananciaDelDia)||0,estadoPagado:Boolean(this.totalDiaActual<=0),tieneObservacion:this.tieneObservacion,observacion:this.observacion,ultimaActualizacion:(new Date).toISOString()};let i;if(e&&a)i=Object(et["e"])(P["a"],"cuentasOtilio",e),await Object(et["o"])(i,o),console.log("Documento actualizado exitosamente:",e);else{const t=Object(et["c"])(P["a"],"cuentasOtilio"),e=Object(et["l"])(t,Object(et["p"])("fecha","==",this.fechaSeleccionada)),a=await Object(et["g"])(e);if(!a.empty)return alert("Ya existe una nota registrada para esta fecha. No se puede crear una nueva."),this.isGuardando=!1,null;i=await Object(et["b"])(Object(et["c"])(P["a"],"cuentasOtilio"),o),console.log("Nuevo documento creado:",i.id),await this.$router.push({name:"CuentasOtilio",params:{id:i.id},query:{edit:"true"}})}const s=await Object(et["f"])(i);if(!s.exists())throw new Error("Error al verificar el documento guardado");const r=s.data(),n=this.validateSavedData(o,r);if(!n)throw new Error("Los datos guardados no coinciden con los datos originales");return setTimeout(()=>{this.actualizarCuentasPosteriores(this.fechaSeleccionada).catch(t=>console.error("Error al actualizar cuentas posteriores:",t))},1e3),alert("Datos guardados exitosamente"),i.id}catch(e){console.error("Error al guardar nota:",e);let t="Error al guardar la nota.";"unavailable"===e.code||"network-request-failed"===e.code?t="Error de conexión. Por favor, verifica tu conexión a internet e intenta nuevamente.":"permission-denied"===e.code?t="No tienes permisos para realizar esta operación.":"resource-exhausted"===e.code?t="Se ha excedido el límite de operaciones. Por favor, intenta más tarde.":e.message&&(t="Error al guardar: "+e.message),alert(t)}finally{this.isGuardando=!1}},validateSavedData(t,e){const a=["fecha","saldoAcumuladoAnterior","totalGeneral","totalGeneralVenta","totalCobros","totalAbonos","totalDia","nuevoSaldoAcumulado","gananciaDelDia","estadoPagado"];for(const i of a)if(t[i]!==e[i])return console.error(`Discrepancia en campo ${i}:`,{original:t[i],saved:e[i]}),!1;const o=["items","itemsVenta","cobros","abonos"];for(const i of o)if(t[i].length!==e[i].length)return console.error("Discrepancia en longitud de array "+i),!1;return!0},async addItem(){if(!this.newItem.kilos||!this.newItem.medida||!this.newItem.costo||!this.newItem.precioVenta)return void alert("Por favor complete todos los campos");const t=this.newItem.kilos*this.newItem.costo;this.items.push({kilos:this.newItem.kilos,medida:this.newItem.medida,costo:this.newItem.costo,total:t});const e=this.newItem.kilos*this.newItem.precioVenta,a=e-t;this.itemsVenta.push({kilosVenta:this.newItem.kilos,medida:this.newItem.medida,precioVenta:this.newItem.precioVenta,totalVenta:e,ganancia:a}),this.newItem={kilos:null,medida:"",costo:null,precioVenta:null}},actualizarItemsVenta(){const t=[...this.itemsVenta];this.itemsVenta=this.items.map((e,a)=>{const o=t[a]||{},i=Number(o.precioVenta)||0;return{kilosVenta:Number(e.kilos)||0,medida:e.medida,precioVenta:i,totalVenta:(Number(e.kilos)||0)*i,ganancia:(Number(e.kilos)||0)*i-(Number(e.kilos)||0)*(Number(e.costo)||0)}})},removeItem(t){this.items.splice(t,1),this.itemsVenta.splice(t,1)},editField(t,e){this.editingField={index:t,field:e},this.$nextTick(()=>{var t;this.$refs.editInput&&(null===(t=this.$refs.editInput[0])||void 0===t||t.focus())})},finishEditing(){this.editingField={index:null,field:null},this.items.length>0&&(this.items=this.items.map(t=>({...t,total:t.kilos*t.costo})))},addNewProduct(){var t;if(!this.newProduct.kilosVenta||!this.newProduct.medida||!this.newProduct.precioVenta)return void alert("Por favor complete todos los campos");const e=this.newProduct.kilosVenta*this.newProduct.precioVenta;this.itemsVenta.push({...this.newProduct,totalVenta:e,ganancia:e-this.newProduct.kilosVenta*((null===(t=this.items[this.itemsVenta.length])||void 0===t?void 0:t.costo)||0)}),this.showAddProductModal=!1,this.newProduct={kilosVenta:null,medida:"",precioVenta:null}},calcularTotalVenta(t){const e=this.itemsVenta[t];if(e){var a;const o=Number(e.kilosVenta)||0,i=Number(e.precioVenta)||0,s=Number(null===(a=this.items[t])||void 0===a?void 0:a.costo)||0,r=o*i,n=r-o*s;this.$set(this.itemsVenta,t,{...e,kilosVenta:o,precioVenta:i,totalVenta:r,ganancia:n}),this.autoSaveTimer&&clearTimeout(this.autoSaveTimer),this.autoSaveTimer=setTimeout(()=>{this.guardarSilencioso()},1e3)}},imprimirTablas(){window.print()},addCobro(){this.cobros.push({descripcion:"",monto:0})},removeCobro(t){this.cobros.splice(t,1)},addAbono(){this.abonos.push({descripcion:"",monto:0})},async removeAbono(t){try{const a=this.abonos[t];if(a.abonoGeneralId)try{const t=Object(et["e"])(P["a"],"abonosGeneralesOtilio",a.abonoGeneralId),e=await Object(et["f"])(t);if(e.exists()){await Object(et["d"])(t),console.log("Abono eliminado del historial:",a.abonoGeneralId);const e=Object(et["c"])(P["a"],"cuentasOtilio"),o=await Object(et["g"])(e),i=o.docs.map(async t=>{const e=t.data();if(e.abonos){const o=e.abonos.filter(t=>t.abonoGeneralId!==a.abonoGeneralId);o.length!==e.abonos.length&&await Object(et["o"])(Object(et["e"])(P["a"],"cuentasOtilio",t.id),{abonos:o})}});await Promise.all(i)}}catch(e){throw console.error("Error al eliminar abono general:",e),new Error("Error al eliminar abono del historial")}this.abonos.splice(t,1);const o=this.$route.params.id;if(o){const t=Object(et["e"])(P["a"],"cuentasOtilio",o);await Object(et["o"])(t,{abonos:this.abonos,estadoPagado:this.totalDiaActual<=0})}const i=Object(et["c"])(P["a"],"cuentasOtilio"),s=Object(et["l"])(i,Object(et["k"])("fecha","asc")),r=await Object(et["g"])(s),n=r.docs.map(t=>({id:t.id,...t.data()})).sort((t,e)=>new Date(t.fecha)-new Date(e.fecha));let c=0;const l=[];for(let t=0;t<n.length;t++){const e=n[t],a=(e.cobros||[]).reduce((t,e)=>t+(parseFloat(e.monto)||0),0),o=(e.abonos||[]).reduce((t,e)=>t+(parseFloat(e.monto)||0),0),i=e.totalGeneralVenta-a-o;c+=i,l.push(Object(et["o"])(Object(et["e"])(P["a"],"cuentasOtilio",e.id),{saldoAcumuladoAnterior:0===t?0:n[t-1].nuevoSaldoAcumulado||0,nuevoSaldoAcumulado:c,estadoPagado:i<=0})),c<=0&&(c=0)}await Promise.all(l),console.log("Abono eliminado exitosamente")}catch(e){console.error("Error al eliminar abono:",e),alert("Error al eliminar el abono: "+e.message)}},startLongPress(t,e){this.longPressTimer=setTimeout(()=>{this.showMobileActions=!0,this.selectedItemIndex=t,this.selectedField=e},500)},endLongPress(){clearTimeout(this.longPressTimer)},cancelMobileActions(){this.showMobileActions=!1,this.selectedItemIndex=null,this.selectedField=null},editItem(t){this.editingItem={...this.items[t]},this.editingIndex=t,this.showEditModal=!0,this.showMobileActions=!1},saveEditedItem(){null!==this.editingIndex&&this.editingItem&&(this.editingItem.total=this.editingItem.kilos*this.editingItem.costo,this.items[this.editingIndex]={...this.editingItem},this.actualizarItemsVenta()),this.showEditModal=!1,this.editingItem=null,this.editingIndex=null},cancelEdit(){this.showEditModal=!1,this.editingItem=null,this.editingIndex=null},editKilos(t){this.editingKilosIndex=t,this.$nextTick(()=>{var t;this.$refs.kilosInput&&(null===(t=this.$refs.kilosInput[0])||void 0===t||t.focus())})},finishEditingKilos(){this.editingKilosIndex=null,this.calcularTotalVenta(this.editingKilosIndex)},toggleGananciasMobile(t){window.innerWidth<=600&&(this.selectedRowIndex=this.selectedRowIndex===t?null:t)},async guardarSilencioso(){try{const t=this.$route.params.id,e="true"===this.$route.query.edit;if(t&&e){const e={fecha:this.fechaSeleccionada,items:this.items.map(t=>({kilos:Number(t.kilos)||0,medida:String(t.medida||""),costo:Number(t.costo)||0,total:Number(t.kilos*t.costo)||0})),itemsVenta:this.itemsVenta.map(t=>({kilosVenta:Number(t.kilosVenta)||0,medida:String(t.medida||""),precioVenta:Number(t.precioVenta)||0,totalVenta:Number(t.kilosVenta*t.precioVenta)||0,ganancia:Number(t.ganancia)||0})),saldoAcumuladoAnterior:Number(this.saldoAcumuladoAnterior)||0,cobros:this.cobros,abonos:this.abonos,totalGeneral:Number(this.totalGeneral)||0,totalGeneralVenta:Number(this.totalGeneralVenta)||0,totalDia:Number(this.totalDiaActual)||0,nuevoSaldoAcumulado:Number(this.nuevoSaldoAcumulado)||0,gananciaDelDia:Number(this.gananciaDelDia)||0,estadoPagado:Boolean(this.totalDiaActual<=0),tieneObservacion:this.tieneObservacion,observacion:this.observacion,ultimaActualizacion:(new Date).toISOString()},a=Object(et["e"])(P["a"],"cuentasOtilio",t);await Object(et["o"])(a,e)}}catch(t){console.error("Error al guardar silenciosamente:",t)}},async guardarCuenta(){try{this.tieneObservacion,this.observacion}catch(t){console.error("Error al guardar la cuenta:",t),alert("Error al guardar la cuenta")}},agregarObservacion(){this.showObservacionModal=!0},guardarObservacion(){this.observacion.trim()&&(this.tieneObservacion=!0),this.showObservacionModal=!1},cancelarObservacion(){this.tieneObservacion||(this.observacion=""),this.showObservacionModal=!1},editarObservacion(){this.showObservacionModal=!0},eliminarObservacion(){confirm("¿Estás seguro de que deseas eliminar esta observación?")&&(this.observacion="",this.tieneObservacion=!1)},handleDataChange(){this.$route.params.id&&"true"===this.$route.query.edit&&(this.autoSaveTimer&&clearTimeout(this.autoSaveTimer),this.autoSaveTimer=setTimeout(async()=>{await this.queueSave()},2e3))},async queueSave(){this.saveQueue.push({timestamp:Date.now(),operation:async()=>{this.$route.params.id?await this.autoSaveNota():console.log("No hay ID de cuenta, no se realizará guardado automático")}}),this.isSaving||await this.processSaveQueue()},async processSaveQueue(){if(!this.isSaving&&0!==this.saveQueue.length){this.isSaving=!0;try{while(this.saveQueue.length>0){const t=Date.now();this.lastSaveTime&&t-this.lastSaveTime<this.saveMinInterval&&await new Promise(e=>setTimeout(e,this.saveMinInterval-(t-this.lastSaveTime)));const e=this.saveQueue[0];await this.retryOperation(e.operation),this.lastSaveTime=Date.now(),this.saveQueue.shift()}}catch(t){console.error("Error procesando cola de guardado:",t),"resource-exhausted"===t.code&&(await new Promise(t=>setTimeout(t,1e4)),await this.processSaveQueue())}finally{this.isSaving=!1}}},async autoSaveNota(){if(this.$route.params.id)try{const e=Object(et["e"])(P["a"],"cuentasOtilio",this.$route.params.id);let a;try{a=await Object(et["f"])(e)}catch(t){throw console.error("Error de red al verificar el documento:",t),this.lastSaveMessage="Error de conexión al guardar automáticamente",this.showSaveMessage=!0,this.saveMessageTimer&&clearTimeout(this.saveMessageTimer),this.saveMessageTimer=setTimeout(()=>{this.showSaveMessage=!1},3e3),t}if(!a.exists())return console.error("Error: El documento no existe en la base de datos"),this.lastSaveMessage="Error: El documento no existe",this.showSaveMessage=!0,this.saveMessageTimer&&clearTimeout(this.saveMessageTimer),void(this.saveMessageTimer=setTimeout(()=>{this.showSaveMessage=!1},3e3));const o={items:this.items.map(t=>({kilos:t.kilos,medida:t.medida,costo:t.costo,total:t.total})),itemsVenta:this.itemsVenta.map(t=>({kilosVenta:t.kilosVenta,medida:t.medida,precioVenta:t.precioVenta,totalVenta:t.totalVenta,ganancia:t.ganancia})),totalGeneral:this.totalGeneral,totalGeneralVenta:this.totalGeneralVenta,nuevoSaldoAcumulado:this.nuevoSaldoAcumulado,cobros:this.cobros,abonos:this.abonos,estadoPagado:"Pagado"===this.estadoCuenta,tieneObservacion:this.tieneObservacion,observacion:this.observacion,ultimaActualizacion:(new Date).toISOString()};await Object(et["o"])(e,o),this.lastSaveMessage="Guardado automático: "+(new Date).toLocaleTimeString(),this.showSaveMessage=!0,this.saveMessageTimer&&clearTimeout(this.saveMessageTimer),this.saveMessageTimer=setTimeout(()=>{this.showSaveMessage=!1},3e3),console.log("Cuenta auto-guardada exitosamente:",(new Date).toLocaleTimeString())}catch(e){if(console.error("Error en auto-guardado:",e),"resource-exhausted"===e.code)throw this.lastSaveMessage="Límite de operaciones excedido. Reintentando...",e;throw"unavailable"===e.code||"network-request-failed"===e.code?this.lastSaveMessage="Error de conexión al guardar automáticamente":this.lastSaveMessage="Error al guardar automáticamente",this.showSaveMessage=!0,this.saveMessageTimer&&clearTimeout(this.saveMessageTimer),this.saveMessageTimer=setTimeout(()=>{this.showSaveMessage=!1},3e3),e}},async retryOperation(t,e=3){let a=0;while(a<e)try{return await t()}catch(o){if(a++,console.error(`Error en operación (intento ${a}/${e}):`,o),"resource-exhausted"===o.code?await new Promise(t=>setTimeout(t,5e3*Math.pow(2,a))):await new Promise(t=>setTimeout(t,1e3*Math.pow(2,a))),a>=e)throw console.error("Se alcanzó el número máximo de intentos. Operación fallida."),o}},limpiarDatos(){this.items=[],this.itemsVenta=[],this.saldoAcumuladoAnterior=0,this.cobros=[],this.abonos=[],this.fechaSeleccionada=this.obtenerFechaActual(),this.estadoPagado=!1,this.tieneObservacion=!1,this.observacion="",this.newItem={kilos:null,medida:"",costo:null,precioVenta:null},this.loadSaldoAcumuladoAnterior()},async loadSaldoAcumuladoAnterior(){try{this.isSaving=!0,this.lastSaveMessage="Cargando saldo acumulado anterior...",this.showSaveMessage=!0,this.saldoAcumuladoAnterior=await this.obtenerSaldoAcumuladoAnterior(),console.log("Saldo acumulado anterior cargado:",this.saldoAcumuladoAnterior),this.lastSaveMessage="Saldo acumulado anterior cargado correctamente",this.saveMessageTimer&&clearTimeout(this.saveMessageTimer),this.saveMessageTimer=setTimeout(()=>{this.showSaveMessage=!1,this.isSaving=!1},3e3)}catch(t){console.error("Error al cargar el saldo acumulado anterior:",t),this.saldoAcumuladoAnterior=0,this.lastSaveMessage="Error al cargar el saldo acumulado anterior",this.saveMessageTimer&&clearTimeout(this.saveMessageTimer),this.saveMessageTimer=setTimeout(()=>{this.showSaveMessage=!1,this.isSaving=!1},3e3)}}},created(){const t=this.$route.params.id,e="true"===this.$route.query.edit;t&&e?this.loadExistingCuenta(t):this.limpiarDatos()},watch:{$route(t,e){const a=t.params.id,o="true"===t.query.edit;a&&o?this.loadExistingCuenta(a):this.limpiarDatos()},tieneObservacion(t){t&&(this.showObservacionModal=!0)},items:{handler:"handleDataChange",deep:!0},itemsVenta:{handler:"handleDataChange",deep:!0},cobros:{handler:"handleDataChange",deep:!0},abonos:{handler:"handleDataChange",deep:!0},fechaSeleccionada:{handler:"handleDataChange"},saldoAcumuladoAnterior:{handler:"handleDataChange"},"newItem.kilos":"handleDataChange","newItem.medida":"handleDataChange","newItem.costo":"handleDataChange",observacion:"handleDataChange"},beforeUnmount(){this.autoSaveTimer&&clearTimeout(this.autoSaveTimer),this.saveMessageTimer&&clearTimeout(this.saveMessageTimer),this.saveQueue.length>0&&this.processSaveQueue()}},ti=Zo,ei=(a("1d3e"),Object(d["a"])(ti,Qo,Xo,!1,null,"15087995",null)),ai=ei.exports,oi=function(){var t=this,e=t._self._c;return e("div",{staticClass:"procesos-menu-container"},[e("h1",{staticClass:"menu-title"},[t._v("Menú de Procesos")]),e("div",{staticClass:"actions-container"},[e("router-link",{staticClass:"action-button",attrs:{to:"/procesos/pedidos"}},[e("span",{staticClass:"button-text"},[t._v("Pedidos")]),e("i",{staticClass:"fas fa-arrow-right"})]),e("router-link",{staticClass:"action-button",attrs:{to:"/procesos/preparacion"}},[e("span",{staticClass:"button-text"},[t._v("Preparación")]),e("i",{staticClass:"fas fa-arrow-right"})]),e("router-link",{staticClass:"action-button",attrs:{to:"/procesos/bitacoras"}},[e("span",{staticClass:"button-text"},[t._v("Bitácoras")]),e("i",{staticClass:"fas fa-arrow-right"})])],1)])},ii=[],si={name:"ProcesosMenu"},ri=si,ni=(a("3a82"),Object(d["a"])(ri,oi,ii,!1,null,"33dcd8aa",null)),ci=ni.exports,li=function(){var t=this,e=t._self._c;return e("div",{staticClass:"preparacion-container"},[e("div",{staticClass:"header"},[e("div",{staticClass:"header-left"},[e("h1",[t._v("Preparación")]),e("div",{staticClass:"dias-dropdown"},[e("button",{staticClass:"dropdown-button",on:{click:t.toggleDiasList}},[t._v(" "+t._s(t.diaSeleccionado?t.formatearFecha(t.diaSeleccionado.fecha):"Seleccionar Día")+" "),e("i",{class:["fas",t.diasListOpen?"fa-chevron-up":"fa-chevron-down"]})]),e("transition",{attrs:{name:"slide"}},[t.diasListOpen?e("div",{staticClass:"dias-dropdown-content"},t._l(t.diasOrdenados,(function(a){return e("div",{key:a.id,staticClass:"dia-option",class:{selected:t.diaSeleccionado&&t.diaSeleccionado.id===a.id},on:{click:function(e){return t.seleccionarDia(a)}}},[t._v(" "+t._s(t.formatearFecha(a.fecha))+" ")])})),0):t._e()])],1)]),e("div",{staticClass:"header-actions"},[e("button",{staticClass:"btn-nuevo",on:{click:t.mostrarModalNuevoDia}},[e("i",{staticClass:"fas fa-plus"}),t._v(" Nuevo Día ")]),t.diaSeleccionado?e("button",{staticClass:"btn-eliminar-dia",on:{click:function(e){return t.confirmarBorrarDia(t.diaSeleccionado)}}},[e("i",{staticClass:"fas fa-trash"}),t._v(" Eliminar Día ")]):t._e()])]),t.diaSeleccionado?e("div",{staticClass:"tabla-container"},[e("table",[t._m(0),e("tbody",t._l(t.diaSeleccionado.medidas,(function(a,o){return e("tr",{key:o},[e("td",[e("select",{directives:[{name:"model",rawName:"v-model",value:a.medida,expression:"medida.medida"}],staticClass:"form-control medida-select",on:{change:[function(e){var o=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(a,"medida",e.target.multiple?o:o[0])},function(e){return t.guardarCambios(t.diaSeleccionado)}]}},[e("option",{attrs:{value:""}},[t._v("Seleccionar medida")]),t._l(t.medidasDisponibles,(function(a){return e("option",{key:a,domProps:{value:a}},[t._v(" "+t._s(a)+" ")])}))],2)]),e("td",[e("select",{directives:[{name:"model",rawName:"v-model",value:a.proveedor,expression:"medida.proveedor"}],staticClass:"form-control proveedor-select",on:{change:[function(e){var o=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(a,"proveedor",e.target.multiple?o:o[0])},function(e){return t.guardarCambios(t.diaSeleccionado)}]}},[e("option",{attrs:{value:""}},[t._v("Sin proveedor")]),t._l(t.proveedoresDisponibles,(function(a){return e("option",{key:a,domProps:{value:a}},[t._v(" "+t._s(a)+" ")])}))],2)]),e("td",[e("select",{directives:[{name:"model",rawName:"v-model",value:a.tinas,expression:"medida.tinas"}],staticClass:"form-control",on:{change:[function(e){var o=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(a,"tinas",e.target.multiple?o:o[0])},function(e){return t.guardarCambios(t.diaSeleccionado)}]}},[e("option",{attrs:{value:""}},[t._v("Seleccionar")]),e("option",{attrs:{value:"Tina"}},[t._v("Tina")]),e("option",{attrs:{value:"Baño"}},[t._v("Baño")])])]),e("td",[e("input",{directives:[{name:"model",rawName:"v-model",value:a.cajas,expression:"medida.cajas"}],staticClass:"form-control",attrs:{type:"number",placeholder:""},domProps:{value:a.cajas},on:{change:function(e){return t.guardarCambios(t.diaSeleccionado)},input:function(e){e.target.composing||t.$set(a,"cajas",e.target.value)}}})]),e("td",[e("select",{directives:[{name:"model",rawName:"v-model",value:a.cal,expression:"medida.cal"}],staticClass:"form-control",on:{change:[function(e){var o=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(a,"cal",e.target.multiple?o:o[0])},function(e){return t.guardarCambios(t.diaSeleccionado)}]}},[e("option",{attrs:{value:""}},[t._v("Seleccionar")]),t._l(t.calDisponible,(function(a){return e("option",{key:a,domProps:{value:a}},[t._v(t._s(a))])}))],2)]),e("td",[e("select",{directives:[{name:"model",rawName:"v-model",value:a.sal,expression:"medida.sal"}],staticClass:"form-control",on:{change:[function(e){var o=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(a,"sal",e.target.multiple?o:o[0])},function(e){return t.guardarCambios(t.diaSeleccionado)}]}},[e("option",{attrs:{value:""}},[t._v("Seleccionar")]),t._l(t.salDisponible,(function(a){return e("option",{key:a,domProps:{value:a}},[t._v(t._s(a))])}))],2)]),e("td",[e("input",{directives:[{name:"model",rawName:"v-model",value:a.porcentaje,expression:"medida.porcentaje"}],staticClass:"form-control porcentaje-input",attrs:{type:"text",placeholder:""},domProps:{value:a.porcentaje},on:{change:function(e){return t.guardarCambios(t.diaSeleccionado)},input:function(e){e.target.composing||t.$set(a,"porcentaje",e.target.value)}}})]),e("td",[t.diaSeleccionado.medidas.length>1?e("button",{staticClass:"btn-delete",on:{click:function(e){return t.eliminarMedidaExistente(t.diaSeleccionado,o)}}},[e("i",{staticClass:"fas fa-trash"})]):t._e()])])})),0)]),e("button",{staticClass:"btn-agregar",on:{click:function(e){return t.agregarMedidaExistente(t.diaSeleccionado)}}},[e("i",{staticClass:"fas fa-plus"}),t._v(" Agregar Medida ")])]):e("div",{staticClass:"no-dia-seleccionado"},[e("p",[t._v("Selecciona un día existente o crea uno nuevo para comenzar.")])]),e("b-modal",{attrs:{title:"Nuevo Día de Preparación",size:"lg"},on:{ok:t.crearNuevoDia,show:t.inicializarNuevoDia},model:{value:t.showModal,callback:function(e){t.showModal=e},expression:"showModal"}},[e("div",{staticClass:"modal-content"},[e("b-form-group",{attrs:{label:"Fecha:"}},[e("b-form-input",{attrs:{type:"date",required:""},model:{value:t.nuevoDia.fecha,callback:function(e){t.$set(t.nuevoDia,"fecha",e)},expression:"nuevoDia.fecha"}})],1),e("div",{staticClass:"tabla-medidas-container"},[e("table",{staticClass:"tabla-medidas"},[e("thead",[e("tr",[e("th",[t._v("Medida")]),e("th",[t._v("Proveedor")]),e("th",[t._v("Tinas/Baños")]),e("th",[t._v("Cajas")]),e("th",[t._v("Cal")]),e("th",[t._v("Sal")]),e("th",[t._v("%")]),e("th",[t._v("Acciones")])])]),e("tbody",t._l(t.nuevoDia.medidas,(function(a,o){return e("tr",{key:o},[e("td",[e("select",{directives:[{name:"model",rawName:"v-model",value:a.medida,expression:"medida.medida"}],staticClass:"form-control medida-select",attrs:{required:""},on:{change:function(e){var o=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(a,"medida",e.target.multiple?o:o[0])}}},[e("option",{attrs:{value:""}},[t._v("Seleccionar medida")]),t._l(t.medidasDisponibles,(function(a){return e("option",{key:a,domProps:{value:a}},[t._v(" "+t._s(a)+" ")])}))],2)]),e("td",[e("select",{directives:[{name:"model",rawName:"v-model",value:a.proveedor,expression:"medida.proveedor"}],staticClass:"form-control proveedor-select",on:{change:function(e){var o=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(a,"proveedor",e.target.multiple?o:o[0])}}},[e("option",{attrs:{value:""}},[t._v("Sin proveedor")]),t._l(t.proveedoresDisponibles,(function(a){return e("option",{key:a,domProps:{value:a}},[t._v(" "+t._s(a)+" ")])}))],2)]),e("td",[e("select",{directives:[{name:"model",rawName:"v-model",value:a.tinas,expression:"medida.tinas"}],staticClass:"form-control",on:{change:function(e){var o=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(a,"tinas",e.target.multiple?o:o[0])}}},[e("option",{attrs:{value:""}},[t._v("Seleccionar")]),e("option",{attrs:{value:"Tina"}},[t._v("Tina")]),e("option",{attrs:{value:"Baño"}},[t._v("Baño")])])]),e("td",[e("input",{directives:[{name:"model",rawName:"v-model",value:a.cajas,expression:"medida.cajas"}],staticClass:"form-control",attrs:{type:"number",placeholder:""},domProps:{value:a.cajas},on:{change:function(e){return t.guardarCambios(t.diaSeleccionado)},input:function(e){e.target.composing||t.$set(a,"cajas",e.target.value)}}})]),e("td",[e("select",{directives:[{name:"model",rawName:"v-model",value:a.cal,expression:"medida.cal"}],staticClass:"form-control",on:{change:function(e){var o=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(a,"cal",e.target.multiple?o:o[0])}}},[e("option",{attrs:{value:""}},[t._v("Seleccionar")]),t._l(t.calDisponible,(function(a){return e("option",{key:a,domProps:{value:a}},[t._v(t._s(a))])}))],2)]),e("td",[e("select",{directives:[{name:"model",rawName:"v-model",value:a.sal,expression:"medida.sal"}],staticClass:"form-control",on:{change:function(e){var o=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(a,"sal",e.target.multiple?o:o[0])}}},[e("option",{attrs:{value:""}},[t._v("Seleccionar")]),t._l(t.salDisponible,(function(a){return e("option",{key:a,domProps:{value:a}},[t._v(t._s(a))])}))],2)]),e("td",[e("input",{directives:[{name:"model",rawName:"v-model",value:a.porcentaje,expression:"medida.porcentaje"}],staticClass:"form-control porcentaje-input",attrs:{type:"text",placeholder:""},domProps:{value:a.porcentaje},on:{input:function(e){e.target.composing||t.$set(a,"porcentaje",e.target.value)}}})]),e("td",[t.nuevoDia.medidas.length>1?e("button",{staticClass:"btn-delete",on:{click:function(e){return t.eliminarMedida(o)}}},[e("i",{staticClass:"fas fa-trash"})]):t._e()])])})),0)]),e("button",{staticClass:"btn-agregar",on:{click:t.agregarMedida}},[e("i",{staticClass:"fas fa-plus"}),t._v(" Agregar Medida ")])])],1)])],1)},di=[function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",[t._v("Medida")]),e("th",[t._v("Proveedor")]),e("th",[t._v("Tinas/Baños")]),e("th",[t._v("Cajas/Kg")]),e("th",[t._v("Cal")]),e("th",[t._v("Sal")]),e("th",[t._v("%")]),e("th",[t._v("Acciones")])])])}],ui={name:"Preparacion",data(){return{dias:[],showModal:!1,nuevoDia:{fecha:"",medidas:[]},diasListOpen:!1,diaSeleccionado:null,medidasDisponibles:["Golfo","Piojo","26/30","36/40","41/50","51/60","61/70","71/90","91/110","21/25","Salmureado"],proveedoresDisponibles:["Ahumada","Selecta","Tirado","Ozuna","Mx"],calDisponible:["1/8","1/4","1/2","3/4","1"],salDisponible:["1/4","1/2","3/4","1"]}},computed:{diasOrdenados(){return[...this.dias].sort((t,e)=>e.timestamp-t.timestamp)}},methods:{formatearFecha(t){const[e,a,o]=t.split("-");return new Date(e,a-1,o).toLocaleDateString("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric"})},inicializarNuevoDia(){const t=new Date,e=t.getTimezoneOffset();t.setMinutes(t.getMinutes()-e),this.nuevoDia={fecha:t.toISOString().split("T")[0],medidas:[{medida:"",proveedor:"",tinas:"",cajas:"",cal:"",sal:"",porcentaje:"",editando:!1}]}},mostrarModalNuevoDia(){this.showModal=!0},agregarMedida(){this.nuevoDia.medidas.push({medida:"",proveedor:"",tinas:"",cajas:"",cal:"",sal:"",porcentaje:"",editando:!1})},eliminarMedida(t){this.nuevoDia.medidas.splice(t,1)},async crearNuevoDia(){try{const t=Object(et["h"])(),[e,a,o]=this.nuevoDia.fecha.split("-"),i=new Date(e,a-1,parseInt(o)),s=await Object(et["b"])(Object(et["c"])(t,"preparacion"),{fecha:this.nuevoDia.fecha,medidas:this.nuevoDia.medidas,createdAt:new Date,timestamp:i.getTime()});this.dias.push({id:s.id,fecha:this.nuevoDia.fecha,medidas:this.nuevoDia.medidas,timestamp:i.getTime()}),this.showModal=!1,console.log("Día creado exitosamente")}catch(t){console.error("Error al crear día:",t)}},async guardarCambios(t){try{const e=Object(et["h"])();await Object(et["o"])(Object(et["e"])(e,"preparacion",t.id),{medidas:t.medidas}),console.log("Cambios guardados exitosamente")}catch(e){console.error("Error al guardar cambios:",e)}},async confirmarBorrarDia(t){if(await this.$bvModal.msgBoxConfirm("¿Estás seguro de que deseas borrar este día?"))try{const e=Object(et["h"])();await Object(et["d"])(Object(et["e"])(e,"preparacion",t.id)),this.dias=this.dias.filter(e=>e.id!==t.id),console.log("Día eliminado exitosamente")}catch(e){console.error("Error al borrar día:",e)}},async eliminarMedidaExistente(t,e){try{t.medidas.splice(e,1),await this.guardarCambios(t),console.log("Medida eliminada exitosamente")}catch(a){console.error("Error al eliminar medida:",a)}},async cargarDias(){try{const t=Object(et["h"])(),e=Object(et["l"])(Object(et["c"])(t,"preparacion"),Object(et["k"])("timestamp","desc")),a=await Object(et["g"])(e);this.dias=a.docs.map(t=>{const e=t.data();if(!e.timestamp){const[t,a,o]=e.fecha.split("-"),i=new Date(t,a-1,parseInt(o));e.timestamp=i.getTime()}return{id:t.id,...e,medidas:e.medidas.map(t=>({...t,editando:!1}))}}),console.log("Días cargados exitosamente")}catch(t){console.error("Error al cargar días:",t)}},async agregarMedidaExistente(t){const e={medida:"",proveedor:"",tinas:"",cajas:"",cal:"",sal:"",porcentaje:""};t.medidas.push(e),await this.guardarCambios(t)},toggleDiasList(){this.diasListOpen=!this.diasListOpen},seleccionarDia(t){this.diaSeleccionado=t,this.diasListOpen=!1}},async mounted(){if(await this.cargarDias(),this.$route.query.fecha){const t=this.dias.find(t=>t.fecha===this.$route.query.fecha);t&&(this.diaSeleccionado=t)}else this.dias.length>0&&(this.diaSeleccionado=this.diasOrdenados[0])}},mi=ui,pi=(a("f817"),Object(d["a"])(mi,li,di,!1,null,"30ed9ef6",null)),hi=pi.exports,vi=function(){var t=this,e=t._self._c;return e("div",{staticClass:"pedidos-menu-container"},[e("h1",{staticClass:"menu-title"},[t._v("Menú de Pedidos")]),e("div",{staticClass:"actions-container"},[e("div",{staticClass:"nuevo-pedido-buttons"},[e("router-link",{staticClass:"action-button",attrs:{to:"/procesos/pedidos/crudo"}},[e("button",{staticClass:"btn-nuevo-pedido crudo"},[e("i",{staticClass:"fas fa-plus"}),t._v(" Nuevo Pedido Crudo ")])]),e("router-link",{staticClass:"action-button",attrs:{to:"/procesos/pedidos/limpio"}},[e("button",{staticClass:"btn-nuevo-pedido limpio"},[e("i",{staticClass:"fas fa-plus"}),t._v(" Nuevo Pedido Limpio ")])])],1)]),e("div",{staticClass:"pedidos-list"},[e("div",{staticClass:"filtros"},[e("div",{staticClass:"filtro-tipo"},[e("label",[t._v("Tipo:")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.filtroTipo,expression:"filtroTipo"}],on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.filtroTipo=e.target.multiple?a:a[0]}}},[e("option",{attrs:{value:"todos"}},[t._v("Todos")]),e("option",{attrs:{value:"crudo"}},[t._v("Crudo")]),e("option",{attrs:{value:"limpio"}},[t._v("Limpio")])])]),e("div",{staticClass:"filtro-fecha"},[e("label",[t._v("Fecha:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.filtroFecha,expression:"filtroFecha"}],attrs:{type:"date"},domProps:{value:t.filtroFecha},on:{input:function(e){e.target.composing||(t.filtroFecha=e.target.value)}}})])]),t.pedidosFiltrados.length>0?e("div",{staticClass:"tabla-pedidos"},[e("table",[t._m(0),e("tbody",t._l(t.pedidosFiltrados,(function(a){return e("tr",{key:a.fecha},[e("td",{staticClass:"fecha-celda"},[e("div",{staticClass:"fecha-container"},[e("div",{staticClass:"fecha-dia"},[t._v(t._s(t.obtenerDia(a.fecha)))]),e("div",{staticClass:"fecha-mes-ano"},[e("span",{staticClass:"mes"},[t._v(t._s(t.obtenerMes(a.fecha)))]),e("span",{staticClass:"ano"},[t._v(t._s(t.obtenerAno(a.fecha)))])]),e("div",{staticClass:"totales-dia"},[e("div",[t._v(t._s(t.calcularTotalesDia(a.pedidos).taras)+" T")]),e("div",[t._v(t._s(t.calcularTotalesDia(a.pedidos).kilos)+" Kg")])])])]),e("td",{staticClass:"detalles-celda"},t._l(a.pedidos,(function(a){return e("div",{key:a.id,staticClass:"tipo-acciones"},[e("span",{staticClass:"tipo-badge",class:a.tipo},[t._v(" "+t._s(t.capitalizarPrimeraLetra(a.tipo))+" ")]),e("span",{class:["kilos-badge",a.tipo]},[e("div",{staticClass:"kilos-taras-container"},[e("div",[t._v(t._s("crudo"===a.tipo?t.formatearNumero(Math.round(t.calcularKilos(a))):t.formatearNumero(Math.round(t.calcularKilosLimpio(a))))+" Kg")]),e("div",[t._v(t._s("crudo"===a.tipo?Math.round(t.calcularTaras(a)):Math.round(t.calcularTarasLimpio(a)))+" T")])])]),e("div",{staticClass:"acciones"},[e("button",{staticClass:"btn-editar",attrs:{title:"Ver"},on:{click:function(e){return t.editarPedido(a)}}},[t._v(" Ver ")]),e("button",{staticClass:"btn-imprimir",attrs:{title:"Imprimir"},on:{click:function(e){return t.imprimirPedido(a)}}},[e("i",{staticClass:"fas fa-print"}),t._v(" Imprimir ")]),e("button",{staticClass:"btn-eliminar",attrs:{title:"Eliminar"},on:{click:function(e){return t.eliminarPedido(a)}}},[e("i",{staticClass:"fas fa-trash"})])])])})),0)])})),0)])]):e("div",{staticClass:"no-pedidos"},[t._v(" No hay pedidos que coincidan con los filtros seleccionados ")])])])},bi=[function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",[t._v("Fecha")]),e("th",[t._v("Detalles")])])])}],fi={name:"PedidosMenu",data(){return{pedidos:[],filtroTipo:"todos",filtroFecha:""}},computed:{pedidosFiltrados(){const t=this.pedidos.filter(t=>{const e="todos"===this.filtroTipo||t.tipo===this.filtroTipo,a=!this.filtroFecha||t.fecha===this.filtroFecha;return e&&a}),e=t.reduce((t,e)=>(t[e.fecha]||(t[e.fecha]={fecha:e.fecha,pedidos:[]}),t[e.fecha].pedidos.push(e),t),{});return Object.values(e).sort((t,e)=>new Date(e.fecha)-new Date(t.fecha))}},methods:{formatearNumero(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},obtenerDia(t){const e=new Date(t+"T00:00:00");return e.getDate().toString().padStart(2,"0")},obtenerMes(t){const e=new Date(t+"T00:00:00"),a=["ENE","FEB","MAR","ABR","MAY","JUN","JUL","AGO","SEP","OCT","NOV","DIC"];return a[e.getMonth()]},obtenerAno(t){const e=new Date(t+"T00:00:00");return e.getFullYear()},formatearFecha(t){const e=new Date(t);return e.setMinutes(e.getMinutes()+e.getTimezoneOffset()),e.toLocaleDateString("es-ES")},capitalizarPrimeraLetra(t){return t.charAt(0).toUpperCase()+t.slice(1)},calcularKilos(t){let e=0;if(t.pedidos)for(const a in t.pedidos)for(const o in t.pedidos[a]){const i=t.pedidos[a][o];i&&!isNaN(i)&&(e+=parseFloat(i))}return(19*e).toFixed(2)},calcularTaras(t){const e=parseFloat(this.calcularKilos(t));return(e/19).toFixed(2)},calcularKilosLimpio(t){let e=0;return t.otilio&&(e+=this.calcularKilosCliente(t.otilio)),t.catarro&&(e+=this.calcularKilosCliente(t.catarro)),t.joselito&&(e+=this.calcularKilosCliente(t.joselito)),t.ozuna&&(e+=this.calcularKilosCliente(t.ozuna)),e},calcularTarasLimpio(t){let e=0;return t.otilio&&(e+=this.calcularTarasCliente(t.otilio)),t.catarro&&(e+=this.calcularTarasCliente(t.catarro)),t.joselito&&(e+=this.calcularTarasCliente(t.joselito)),t.ozuna&&(e+=this.calcularTarasCliente(t.ozuna)),e},calcularKilosCliente(t){let e=0,a=0,o=0,i=0,s=0,r=0;return t.forEach(t=>{t.kilos&&(t.esTara?"C/H20"===t.tipo?a+=30*Number(t.kilos)*.65:"1.35 y .15"===t.tipo?s+=30*Number(t.kilos):o+=30*Number(t.kilos):"S/H20"===t.tipo?e+=Number(t.kilos):"C/H20"===t.tipo?a+=Number(t.kilos):"1.35 y .15"===t.tipo?i+=1.35*Number(t.kilos):".7 y .3"===t.tipo&&(r+=.7*Number(t.kilos)))}),e+o+s+a+i+r},calcularTarasCliente(t){let e=0,a=0,o=0;t.forEach(t=>{t.kilos&&(t.esTara?e+=Number(t.kilos):"S/H20"===t.tipo?a+=Number(t.kilos):"1.35 y .15"===t.tipo&&(o+=Number(t.kilos)))});const i=a/25,s=o/33.75;return e+i+s},imprimirPedido(t){"crudo"===t.tipo?this.$router.push({name:"PedidoCrudosImpresion",params:{fecha:t.fecha,pedidos:t.pedidos,columnas:t.columnas}}):this.$router.push({name:"PedidoLimpioImpresion",params:{fecha:t.fecha,pedidoOtilio:t.otilio||[],pedidoCatarro:t.catarro||[],pedidoJoselito:t.joselito||[],pedidoOzuna:t.ozuna||[],clientesTemporales:t.clientesTemporales||{},rendimientosGuardados:t.rendimientos||{},divisoresGuardados:t.divisores||{},completadosGuardados:t.completados||{}}})},editarPedido(t){const e="crudo"===t.tipo?"/procesos/pedidos/crudo":"/procesos/pedidos/limpio";this.$router.push({path:e,query:{edit:"true",id:t.id,fecha:t.fecha}})},async eliminarPedido(t){try{const e=window.confirm("¿Está seguro que desea eliminar este pedido? Esta acción no se puede deshacer.");e&&(await Object(et["d"])(Object(et["e"])(P["a"],"pedidos",t.id)),alert("Pedido eliminado exitosamente"))}catch(e){console.error("Error al eliminar el pedido:",e),alert("Error al eliminar el pedido. Por favor intente nuevamente.")}},calcularTotalesDia(t){let e=0,a=0;return t.forEach(t=>{"crudo"===t.tipo?(e+=Math.round(parseFloat(this.calcularKilos(t))),a+=Math.round(parseFloat(this.calcularTaras(t)))):"limpio"===t.tipo&&(e+=Math.round(this.calcularKilosLimpio(t)),a+=Math.round(this.calcularTarasLimpio(t)))}),{kilos:this.formatearNumero(e),taras:a}}},created(){const t=Object(et["l"])(Object(et["c"])(P["a"],"pedidos"),Object(et["k"])("createdAt","desc"));this.unsubscribe=Object(et["j"])(t,t=>{this.pedidos=t.docs.map(t=>({id:t.id,...t.data()}))})},beforeDestroy(){this.unsubscribe&&this.unsubscribe()}},gi=fi,Ci=(a("7fb0"),Object(d["a"])(gi,vi,bi,!1,null,"1aa61550",null)),_i=Ci.exports,yi=function(){var t=this,e=t._self._c;return e("div",{staticClass:"pedidos-container"},[e("h2",[t._v("Pedidos de Camarón")]),e("div",{staticClass:"tipo-pedido-selector"},[e("button",{class:["btn-tipo",{active:"crudo"===t.tipoPedido}],on:{click:function(e){t.tipoPedido="crudo"}}},[t._v(" Camarón Crudo ")]),e("button",{class:["btn-tipo",{active:"limpio"===t.tipoPedido}],on:{click:function(e){t.tipoPedido="limpio"}}},[t._v(" Camarón Limpio ")])]),"crudo"===t.tipoPedido?e("PedidosCrudo"):e("PedidosLimpio")],1)},wi=[],ki=function(){var t=this,e=t._self._c;return e("div",{staticClass:"pedidos-crudo-container"},[e("h2",[t._v("Pedido de Camarón Crudo")]),e("div",{staticClass:"fecha-container"},[e("label",{attrs:{for:"fecha"}},[t._v("Fecha:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.fecha,expression:"fecha"}],attrs:{type:"date",id:"fecha",required:"",max:t.fechaMaxima},domProps:{value:t.fecha},on:{input:function(e){e.target.composing||(t.fecha=e.target.value)}}})]),e("div",{staticClass:"agregar-columna"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.nuevaColumna,expression:"nuevaColumna"}],staticClass:"input-nueva-columna",attrs:{type:"text",placeholder:"Nombre de nueva columna"},domProps:{value:t.nuevaColumna},on:{input:function(e){e.target.composing||(t.nuevaColumna=e.target.value)}}}),e("button",{staticClass:"btn-agregar-columna",on:{click:t.agregarColumna}},[t._v(" Agregar Columna ")])]),e("div",{staticClass:"tabla-pedidos"},[e("table",[e("thead",[e("tr",[e("th",[t._v("Cliente")]),t._l(t.columnas,(function(a){return e("th",{key:a},[t._v(" "+t._s(a)+" "),t.columnasBase.includes(a)?t._e():e("span",{staticClass:"eliminar-columna",on:{click:function(e){return t.eliminarColumna(a)}}},[t._v(" × ")])])}))],2)]),e("tbody",[t._l(t.clientes,(function(a,o){return e("tr",{key:o},[e("td",{class:"cliente-"+a.toLowerCase()},[t._v(t._s(a))]),t._l(t.columnas,(function(o){return e("td",{key:o},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.pedidos[a][o.toLowerCase()],expression:"pedidos[cliente][columna.toLowerCase()]"}],staticClass:"numero-input",class:"cliente-"+a.toLowerCase(),attrs:{type:"number",placeholder:""},domProps:{value:t.pedidos[a][o.toLowerCase()]},on:{input:function(e){e.target.composing||t.$set(t.pedidos[a],o.toLowerCase(),e.target.value)}}})])}))],2)})),e("tr",{staticClass:"fila-totales"},[t._m(0),t._l(t.columnas,(function(a){return e("td",{key:a+"-total"},[t._v(" "+t._s(t.totalesColumnas[a.toLowerCase()]||0)+" ")])}))],2)],2)])]),e("div",{staticClass:"kilos-info"},[e("h3",[t._v("Total Kilos de Crudo: "),e("span",[t._v(t._s(Math.floor(t.kilosCrudo))+" kg")])]),e("h3",[t._v("Total Taras de Crudo: "),e("span",[t._v(t._s(Math.floor(t.tarasCrudo))+" T")])])]),e("canvas-dibujo",{ref:"canvasDibujo"}),e("div",{staticClass:"buttons-container"},[e("button",{staticClass:"btn-guardar",on:{click:t.guardarPedido}},[t._v("Guardar Pedido")]),e("button",{staticClass:"btn-imprimir",on:{click:t.imprimirPedido}},[t._v("Imprimir")]),e("button",{staticClass:"btn-cancelar",on:{click:function(e){return t.$router.push("/procesos/pedidos")}}},[t._v("Cancelar")])])],1)},Ai=[function(){var t=this,e=t._self._c;return e("td",[e("strong",[t._v("Total")])])}],Pi=function(){var t=this,e=t._self._c;return e("div",{staticClass:"canvas-dibujo-container"},[e("h3",[t._v("Dibujo y Notas")]),e("div",{staticClass:"toolbar"},[e("button",{class:{active:t.isPenMode},attrs:{id:"pen-btn"},on:{click:t.activatePenMode}},[t._v("✏️ Lápiz")]),e("button",{class:{active:!t.isPenMode&&!t.eraserMode},attrs:{id:"select-btn"},on:{click:t.activateSelectMode}},[t._v("👆 Seleccionar")]),e("button",{class:{active:t.eraserMode},attrs:{id:"eraser-btn"},on:{click:t.activateEraserMode}},[t._v("🧹 Borrador")]),e("div",{staticClass:"separator"}),e("button",{attrs:{id:"undo-btn",title:"Retroceder un paso",disabled:t.historyIndex<=0},on:{click:t.undo}},[t._v("↩️ Deshacer")]),e("button",{attrs:{id:"redo-btn",title:"Avanzar un paso",disabled:t.historyIndex>=t.history.length-1},on:{click:t.redo}},[t._v("↪️ Rehacer")]),e("div",{staticClass:"separator"}),e("button",{attrs:{id:"arrow-btn"},on:{click:t.addArrow}},[t._v("↗️ Flecha")]),e("div",{staticClass:"separator"}),e("div",[e("select",{directives:[{name:"model",rawName:"v-model",value:t.currentPenSize,expression:"currentPenSize"}],attrs:{id:"pen-size"},on:{change:[function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.currentPenSize=e.target.multiple?a:a[0]},t.updatePenSize]}},[e("option",{attrs:{value:"1"}},[t._v("Fino")]),e("option",{attrs:{value:"3",selected:""}},[t._v("Medio")]),e("option",{attrs:{value:"5"}},[t._v("Grueso")])])]),e("div",{staticClass:"separator"}),e("div",{staticStyle:{display:"flex",gap:"5px"}},t._l(t.colors,(function(a){return e("div",{key:a,staticClass:"color-btn",style:{backgroundColor:a},attrs:{"data-color":a},on:{click:function(e){return t.changeColor(a)}}})})),0),e("div",{staticClass:"separator"}),e("button",{attrs:{id:"clear-btn"},on:{click:t.clearCanvas}},[t._v("🗑️ Limpiar")])]),e("div",{staticClass:"canvas-container"},[e("div",{staticClass:"canvas-wrapper"},[e("canvas",{ref:"canvas"})])]),e("div",{attrs:{id:"status-bar"}},[t._v(" Presión: "+t._s(t.pressure.toFixed(2))+" | Posición: "+t._s(t.position.x)+", "+t._s(t.position.y)+" ")])])},xi=[];const Si=window.fabric;var Ti={name:"CanvasDibujo",data(){return{canvas:null,canvasWidth:800,canvasHeight:400,colors:["#000000","#e74c3c","#3498db","#2ecc71"],currentColor:"#000000",currentPenSize:3,isPenMode:!0,eraserMode:!1,pressure:0,position:{x:0,y:0},history:[],historyIndex:-1,canvasInitialized:!1}},mounted(){console.log("Fabric disponible:","undefined"!==typeof Si),this.$nextTick(()=>{setTimeout(()=>{this.initCanvas()},100)}),window.addEventListener("resize",this.resizeCanvas)},beforeDestroy(){window.removeEventListener("resize",this.resizeCanvas),this.canvas&&(this.canvas.dispose(),this.canvas=null)},methods:{initCanvas(){try{if(!this.$refs.canvas)return void console.error("Elemento canvas no encontrado en el DOM");if("undefined"===typeof Si)return console.error("Fabric.js no está disponible"),void setTimeout(()=>{console.log("Reintentando inicializar canvas..."),this.initCanvas()},500);if(console.log("Inicializando canvas con fabric:",Si),this.resizeCanvasDimensions(),this.canvas=new Si.Canvas(this.$refs.canvas,{width:this.canvasWidth,height:this.canvasHeight,isDrawingMode:!0,enableRetinaScaling:!0}),!this.canvas)return void console.error("Error al inicializar el canvas de fabric.js");this.canvas.freeDrawingBrush=new Si.PencilBrush(this.canvas),this.canvas.freeDrawingBrush.width=this.currentPenSize,this.canvas.freeDrawingBrush.color=this.currentColor,this.setupCanvasEvents(),this.canvasInitialized=!0,this.saveToHistory(),this.updateHistoryButtons(),console.log("Canvas inicializado correctamente")}catch(t){console.error("Error al inicializar el canvas:",t),setTimeout(()=>{console.log("Reintentando inicializar canvas después de error..."),this.initCanvas()},1e3)}},resizeCanvasDimensions(){try{const t=this.$el?this.$el.clientWidth||document.documentElement.clientWidth:800;this.canvasWidth=Math.min(t-40,800),window.innerWidth<=768?this.canvasHeight=Math.min(window.innerHeight/3,300):this.canvasHeight=Math.min(window.innerHeight/2,400)}catch(t){console.error("Error al dimensionar el canvas:",t)}},resizeCanvas(){try{this.resizeCanvasDimensions(),this.canvas&&(this.canvas.setWidth(this.canvasWidth),this.canvas.setHeight(this.canvasHeight),this.canvas.renderAll())}catch(t){console.error("Error al redimensionar el canvas:",t)}},setupCanvasEvents(){if(this.canvas)try{this.canvas.on("path:created",()=>{this.saveToHistory()}),this.canvas.on("mouse:down",t=>{if(this.canvas){if(this.eraserMode){const e=this.canvas.getPointer(t.e);this.eraseObjectAtPoint(e)}if(this.canvas.isDrawingMode&&t.e.pressure&&(this.pressure=t.e.pressure,this.isPenMode&&this.canvas.freeDrawingBrush)){const t=Math.max(.5,Math.min(2,this.pressure))*this.currentPenSize;this.canvas.freeDrawingBrush.width=t}this.updatePosition(t.e)}}),this.canvas.on("mouse:move",t=>{if(this.canvas){if(this.canvas.isDrawingMode&&t.e.pressure&&this.isPenMode&&this.canvas.freeDrawingBrush){this.pressure=t.e.pressure;const e=Math.max(.5,Math.min(2,this.pressure))*this.currentPenSize;this.canvas.freeDrawingBrush.width=e}this.updatePosition(t.e)}}),this.canvas.on("object:added",()=>{this.canvas&&(this.canvas.isDrawingMode||this.saveToHistory())}),this.canvas.on("object:modified",()=>{this.canvas&&this.saveToHistory()}),this.canvas.on("object:removed",()=>{this.canvas&&(this.eraserMode||this.saveToHistory())})}catch(t){console.error("Error al configurar eventos del canvas:",t)}},saveToHistory(){if(this.canvas)try{this.historyIndex<this.history.length-1&&(this.history=this.history.slice(0,this.historyIndex+1));const t=JSON.stringify(this.canvas.toJSON());this.history.push(t),this.historyIndex=this.history.length-1,this.updateHistoryButtons()}catch(t){console.error("Error al guardar historial:",t)}},undo(){if(this.canvas)try{this.historyIndex>0&&(this.historyIndex--,this.loadFromHistory())}catch(t){console.error("Error en operación deshacer:",t)}},redo(){if(this.canvas)try{this.historyIndex<this.history.length-1&&(this.historyIndex++,this.loadFromHistory())}catch(t){console.error("Error en operación rehacer:",t)}},loadFromHistory(){if(this.canvas)try{this.historyIndex>=0&&this.historyIndex<this.history.length&&this.canvas.loadFromJSON(this.history[this.historyIndex],()=>{this.canvas.renderAll(),this.updateHistoryButtons()})}catch(t){console.error("Error al cargar desde historial:",t)}},updateHistoryButtons(){},activatePenMode(){if(this.canvas)try{this.eraserMode=!1,this.canvas.isDrawingMode=!0,this.canvas.freeDrawingBrush&&(this.canvas.freeDrawingBrush.color=this.currentColor,this.canvas.freeDrawingBrush.width=this.currentPenSize),this.isPenMode=!0,this.canvas.defaultCursor="default"}catch(t){console.error("Error al activar modo lápiz:",t)}},activateSelectMode(){if(this.canvas)try{this.eraserMode=!1,this.canvas.isDrawingMode=!1,this.isPenMode=!1,this.canvas.defaultCursor="default"}catch(t){console.error("Error al activar modo selección:",t)}},activateEraserMode(){if(this.canvas)try{this.eraserMode=!0,this.canvas.isDrawingMode=!1,this.isPenMode=!1,this.canvas.defaultCursor="crosshair"}catch(t){console.error("Error al activar modo borrador:",t)}},eraseObjectAtPoint(t){if(!this.canvas)return!1;try{const e=this.canvas.getObjects();for(let a=e.length-1;a>=0;a--){const o=e[a];if(o.containsPoint(t))return this.canvas.remove(o),this.canvas.renderAll(),this.saveToHistory(),!0}}catch(e){console.error("Error al borrar objeto:",e)}return!1},addArrow(){if(this.canvas)try{this.activateSelectMode();const t=new Si.Path("M 0 0 L 100 0 M 90 -10 L 100 0 L 90 10",{stroke:this.currentColor,strokeWidth:2,left:this.canvas.width/2-50,top:this.canvas.height/2,strokeLineCap:"round",strokeLineJoin:"round"});this.canvas.add(t),this.canvas.setActiveObject(t),this.saveToHistory()}catch(t){console.error("Error al añadir flecha:",t)}},clearCanvas(){if(this.canvas)try{confirm("¿Estás seguro que deseas limpiar todo el lienzo?")&&(this.canvas.clear(),this.saveToHistory())}catch(t){console.error("Error al limpiar canvas:",t)}},updatePosition(t){if(this.canvas&&this.canvas.upperCanvasEl)try{const e=this.canvas.upperCanvasEl.getBoundingClientRect();this.position={x:Math.round(t.clientX-e.left),y:Math.round(t.clientY-e.top)}}catch(e){console.error("Error al actualizar posición:",e)}},updatePenSize(){if(this.canvas&&this.isPenMode&&this.canvas.freeDrawingBrush)try{this.canvas.freeDrawingBrush.width=this.currentPenSize}catch(t){console.error("Error al actualizar tamaño de lápiz:",t)}},changeColor(t){if(this.canvas)try{this.currentColor=t,this.isPenMode&&this.canvas.freeDrawingBrush&&(this.canvas.freeDrawingBrush.color=this.currentColor)}catch(e){console.error("Error al cambiar color:",e)}}}},Oi=Ti,Mi=(a("c990"),Object(d["a"])(Oi,Pi,xi,!1,null,"2a16441d",null)),Ni=Mi.exports,Di={name:"PedidosCrudo",components:{CanvasDibujo:Ni},data(){return{fecha:(new Date).toISOString().split("T")[0],clientes:["8a","Catarro","Otilio","Ozuna"],columnasBase:["Med","Med-Esp","Med-gde","Gde","Extra"],columnasAdicionales:[],nuevaColumna:"",pedidos:{"8a":{med:null,"med-esp":null,"med-gde":null,gde:null,extra:null},Catarro:{med:null,"med-esp":null,"med-gde":null,gde:null,extra:null},Otilio:{med:null,"med-esp":null,"med-gde":null,gde:null,extra:null},Ozuna:{med:null,"med-esp":null,"med-gde":null,gde:null,extra:null}},barcosPorPedido:{"8a":{},Catarro:{},Otilio:{},Ozuna:{}},isEditing:!1,pedidoId:null,dibujoCanvas:null}},computed:{fechaMinima(){const t=new Date;return t.toISOString().split("T")[0]},fechaMaxima(){const t=new Date;return t.setMonth(t.getMonth()+3),t.toISOString().split("T")[0]},columnas(){return[...this.columnasBase,...this.columnasAdicionales]},kilosCrudo(){let t=0;for(const e in this.pedidos)for(const a in this.pedidos[e]){const o=this.pedidos[e][a];o&&!isNaN(o)&&(t+=parseFloat(o))}return 19*t},totalesColumnas(){const t={};return this.columnas.forEach(e=>{const a=e.toLowerCase();t[a]=this.clientes.reduce((t,e)=>{const o=parseFloat(this.pedidos[e][a])||0;return t+o},0)}),t},tarasCrudo(){return this.kilosCrudo/19}},methods:{normalizarNombreColumna(t){return t.toLowerCase()},agregarColumna(){if(!this.nuevaColumna.trim())return;const t=this.nuevaColumna.trim();if(this.columnas.includes(t))return void alert("Esta columna ya existe");this.columnasAdicionales.push(t);const e=this.normalizarNombreColumna(t);this.clientes.forEach(t=>{this.$set(this.pedidos[t],e,null)}),this.nuevaColumna=""},eliminarColumna(t){const e=this.columnasAdicionales.indexOf(t);if(e>-1){this.columnasAdicionales.splice(e,1);const a=this.normalizarNombreColumna(t);this.clientes.forEach(t=>{this.$delete(this.pedidos[t],a)})}},clientesConPedidoPorMedida(t){return this.clientes.filter(e=>{const a=this.pedidos[e][t.toLowerCase()];return a&&a>0})},async guardarPedido(){try{let t=null;if(this.$refs.canvasDibujo&&this.$refs.canvasDibujo.canvas){const e=this.$refs.canvasDibujo.canvas.toJSON();t=JSON.stringify(e),console.log("Canvas guardado como string")}const e={fecha:this.fecha,pedidos:this.pedidos,barcosPorPedido:this.barcosPorPedido,columnas:this.columnas,tipo:"crudo",kilos:this.kilosCrudo,createdAt:et["a"].now(),dibujoCanvas:t};if(this.isEditing&&this.pedidoId){const t=Object(et["e"])(P["a"],"pedidos",this.pedidoId);await Object(et["o"])(t,e),alert("Pedido actualizado exitosamente")}else await Object(et["b"])(Object(et["c"])(P["a"],"pedidos"),e),alert("Pedido guardado exitosamente");this.$router.push("/procesos/pedidos")}catch(t){console.error("Error al guardar el pedido:",t),alert("Error al guardar el pedido. Por favor intente nuevamente.")}},async cargarPedido(t){try{const e=Object(et["e"])(P["a"],"pedidos",t),a=await Object(et["f"])(e);if(a.exists()){const t=a.data();this.fecha=t.fecha,this.pedidos=t.pedidos,this.barcosPorPedido=t.barcosPorPedido||this.initializeBarcosPorPedido(),this.columnasAdicionales=t.columnas.filter(t=>!this.columnasBase.includes(t)),t.dibujoCanvas?(console.log("Dibujo encontrado en el pedido, preparando para cargar"),this.dibujoCanvas=t.dibujoCanvas,this.$nextTick(()=>{console.log("DOM actualizado, intentando cargar el dibujo"),this.cargarDibujoEnCanvas()})):console.log("No hay dibujo guardado en este pedido")}else alert("El pedido no existe"),this.$router.push("/procesos/pedidos")}catch(e){console.error("Error al cargar el pedido:",e),alert("Error al cargar el pedido"),this.$router.push("/procesos/pedidos")}},initializeBarcosPorPedido(){const t={};return this.clientes.forEach(e=>{t[e]={}}),t},imprimirPedido(){this.$router.push({name:"PedidoCrudosImpresion",params:{fecha:this.fecha,pedidos:this.pedidos,columnas:this.columnas}})},cargarDibujoEnCanvas(){try{if(this.$refs.canvasDibujo&&this.$refs.canvasDibujo.canvas&&this.dibujoCanvas){const t=JSON.parse(this.dibujoCanvas);this.$refs.canvasDibujo.canvas.loadFromJSON(t,()=>{this.$refs.canvasDibujo.canvas.renderAll(),console.log("Dibujo cargado correctamente en el canvas")})}else setTimeout(()=>{this.cargarDibujoEnCanvas()},500)}catch(t){console.error("Error al cargar el dibujo en el canvas:",t)}}},async created(){const{edit:t,id:e}=this.$route.query;"true"===t&&e&&(this.isEditing=!0,this.pedidoId=e,await this.cargarPedido(e))}},Ei=Di,ji=(a("78f7"),Object(d["a"])(Ei,ki,Ai,!1,null,"ab289b5e",null)),$i=ji.exports,Ii=function(){var t=this,e=t._self._c;return e("div",[t.mostrarImpresion?e("PedidoLimpioImpresion",{attrs:{fecha:t.fecha,pedidoOtilio:t.pedidoOtilio,pedidoCatarro:t.pedidoCatarro,pedidoJoselito:t.pedidoJoselito,pedidoOzuna:t.pedidoOzuna,clientesTemporales:t.clientesTemporales,rendimientosGuardados:t.rendimientosGuardados,divisoresGuardados:t.divisoresGuardados,completadosGuardados:t.completadosGuardados},on:{"actualizar-rendimientos":t.actualizarRendimientos,"actualizar-divisores":t.actualizarDivisores,"actualizar-completados":t.actualizarCompletados,volver:function(e){t.mostrarImpresion=!1}}}):e("div",{staticClass:"pedidos-limpio-container"},[e("h2",[t._v("Pedido de Camarón Limpio")]),e("div",{staticClass:"header-container"},[e("div",{staticClass:"volver-container"},[e("button",{staticClass:"btn-volver",on:{click:function(e){return t.$router.push("/procesos/pedidos")}}},[e("i",{staticClass:"fas fa-arrow-left"}),t._v(" Volver ")])]),e("div",{staticClass:"fecha-container"},[e("label",{attrs:{for:"fecha"}},[t._v("Fecha:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.fecha,expression:"fecha"}],attrs:{type:"date",id:"fecha",required:"",max:t.fechaMaxima},domProps:{value:t.fecha},on:{input:function(e){e.target.composing||(t.fecha=e.target.value)}}})]),e("div",{staticClass:"totales-generales"},[e("div",{staticClass:"total-item"},[e("span",{staticClass:"total-label"},[t._v("Total Taras:")]),e("span",{staticClass:"total-value"},[t._v(t._s(t.totalesGenerales.tarasTotal)+" T")])]),e("div",{staticClass:"total-item"},[e("span",{staticClass:"total-label"},[t._v("Total Kilos:")]),e("span",{staticClass:"total-value"},[t._v(t._s(t.totalesGenerales.kilosTotal)+" kg")])])]),e("MedidasModal",{on:{"medidas-actualizadas":t.actualizarMedidas}})],1),e("div",{staticClass:"tabs-container"},[t._l(t.clientes,(function(a){return e("div",{key:a.id,staticClass:"tab-wrapper"},[e("button",{class:["tab-button",{active:t.clienteActivo===a.id}],attrs:{"data-cliente":a.id},on:{click:function(e){t.clienteActivo=a.id}}},[t._v(" "+t._s(a.nombre)+" ")]),"otilio"===a.id?e("div",{staticClass:"tab-totales"},[e("div",[t._v("Taras: "+t._s(t.calculosOtilio.tarasTotal)+" T")]),e("div",[t._v("Kilos: "+t._s(t.calculosOtilio.kilosTotal)+" kg")])]):t._e(),"catarro"===a.id?e("div",{staticClass:"tab-totales"},[e("div",[t._v("Taras: "+t._s(t.calculosCatarro.tarasTotal)+" T")]),e("div",[t._v("Kilos: "+t._s(t.calculosCatarro.kilosTotal)+" kg")])]):t._e(),"joselito"===a.id?e("div",{staticClass:"tab-totales"},[e("div",[t._v("Taras: "+t._s(t.calculosJoselito.tarasTotal)+" T")]),e("div",[t._v("Kilos: "+t._s(t.calculosJoselito.kilosTotal)+" kg")])]):t._e(),"ozuna"===a.id?e("div",{staticClass:"tab-totales"},[e("div",[t._v("Taras: "+t._s(t.calculosOzuna.tarasTotal)+" T")]),e("div",[t._v("Kilos: "+t._s(t.calculosOzuna.kilosTotal)+" kg")])]):t._e()])})),t._l(t.clientesTemporales,(function(a,o){return e("div",{key:o,staticClass:"tab-wrapper"},[e("button",{class:["tab-button temporal",{active:t.clienteActivo===a.id}],on:{click:function(e){t.clienteActivo=a.id}}},[t._v(" "+t._s(a.nombre)+" ")]),e("div",{staticClass:"tab-totales"},[e("div",[t._v("Taras: "+t._s(t.calcularTotalesTemporales(a.id).tarasTotal)+" T")]),e("div",[t._v("Kilos: "+t._s(t.calcularTotalesTemporales(a.id).kilosTotal)+" kg")])])])})),e("div",{staticClass:"tab-wrapper"},[e("button",{staticClass:"tab-button nuevo-cliente",on:{click:function(e){t.mostrarModalNuevoCliente=!0}}},[t._v(" + Nuevo Cliente ")])])],2),e("div",{staticClass:"clientes-content"},[e("div",{directives:[{name:"show",rawName:"v-show",value:"otilio"===t.clienteActivo,expression:"clienteActivo === 'otilio'"}],staticClass:"cliente-seccion"},[e("button",{staticClass:"btn-agregar",class:{"bg-otilio":"otilio"===t.clienteActivo,"bg-catarro":"catarro"===t.clienteActivo,"bg-joselito":"joselito"===t.clienteActivo,"bg-ozuna":"ozuna"===t.clienteActivo,"bg-temporal":t.isClienteTemporal(t.clienteActivo)},on:{click:t.agregarFilaOtilio}},[t._v(" + Agregar Fila ")]),e("div",{staticClass:"pedido-grid"},t._l(t.pedidoOtilio,(function(a,o){return e("div",{key:o,staticClass:"pedido-item"},[e("div",{staticClass:"input-row"},[e("div",{staticClass:"input-group-compact kilos"},[e("div",{staticClass:"label-container"},[e("label",[t._v("Kilos:")]),e("div",{staticClass:"tara-checkbox"},[e("input",{directives:[{name:"model",rawName:"v-model",value:a.esTara,expression:"item.esTara"}],attrs:{type:"checkbox",id:"tara"+o},domProps:{checked:Array.isArray(a.esTara)?t._i(a.esTara,null)>-1:a.esTara},on:{change:function(e){var o=a.esTara,i=e.target,s=!!i.checked;if(Array.isArray(o)){var r=null,n=t._i(o,r);i.checked?n<0&&t.$set(a,"esTara",o.concat([r])):n>-1&&t.$set(a,"esTara",o.slice(0,n).concat(o.slice(n+1)))}else t.$set(a,"esTara",s)}}}),e("label",{attrs:{for:"tara"+o}},[t._v("T")])])]),e("input",{directives:[{name:"model",rawName:"v-model",value:a.kilos,expression:"item.kilos"}],staticClass:"input-field",attrs:{type:"number"},domProps:{value:a.kilos},on:{input:function(e){e.target.composing||t.$set(a,"kilos",e.target.value)}}})]),e("div",{staticClass:"input-group-compact medida"},[e("div",{staticClass:"label-container"},[e("label",[t._v("Medida:")]),e("button",{staticClass:"btn-proveedor",class:{active:a.esProveedor},attrs:{title:a.proveedor||"Agregar proveedor"},on:{click:function(e){return t.abrirModalProveedor(a)}}},[t._v(" P ")])]),e("select",{directives:[{name:"model",rawName:"v-model",value:a.medida,expression:"item.medida"}],staticClass:"input-field",on:{change:function(e){var o=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(a,"medida",e.target.multiple?o:o[0])}}},[e("option",{attrs:{value:""}},[t._v("Seleccionar")]),t._l(t.medidasOrdenadas,(function(a){return e("option",{key:a.id,domProps:{value:a.nombre}},[t._v(" "+t._s(a.nombre)+" ")])}))],2)]),e("div",{staticClass:"input-group-compact tipo"},[e("div",{staticClass:"label-container"},[e("label",[t._v("Tipo:")]),e("select",{directives:[{name:"model",rawName:"v-model",value:a.nota,expression:"item.nota"}],staticClass:"input-field-notas",on:{change:function(e){var o=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(a,"nota",e.target.multiple?o:o[0])}}},[e("option",{attrs:{value:""}},[t._v("Notas")]),e("option",{attrs:{value:"Sellado"}},[t._v("Sellado")]),e("option",{attrs:{value:"Kileado"}},[t._v("Kileado")])])]),e("select",{directives:[{name:"model",rawName:"v-model",value:a.tipo,expression:"item.tipo"}],staticClass:"input-field",class:{"text-blue":"C/H20"===a.tipo},on:{change:function(e){var o=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(a,"tipo",e.target.multiple?o:o[0])}}},[e("option",{attrs:{value:""}},[t._v("Seleccionar")]),e("option",{attrs:{value:"S/H20"}},[t._v("S/H20")]),e("option",{staticClass:"text-blue",attrs:{value:"C/H20"}},[t._v("C/H20")])])]),t.pedidoOtilio.length>1?e("button",{staticClass:"btn-eliminar",on:{click:function(e){return t.eliminarPedidoOtilio(o)}}},[e("i",{staticClass:"fas fa-trash"})]):t._e()])])})),0)]),e("div",{directives:[{name:"show",rawName:"v-show",value:"catarro"===t.clienteActivo,expression:"clienteActivo === 'catarro'"}],staticClass:"cliente-seccion"},[e("button",{staticClass:"btn-agregar",class:{"bg-otilio":"otilio"===t.clienteActivo,"bg-catarro":"catarro"===t.clienteActivo,"bg-joselito":"joselito"===t.clienteActivo,"bg-ozuna":"ozuna"===t.clienteActivo,"bg-temporal":t.isClienteTemporal(t.clienteActivo)},on:{click:t.agregarFilaCatarro}},[t._v(" + Agregar Fila ")]),e("div",{staticClass:"pedido-grid"},t._l(t.pedidoCatarro,(function(a,o){return e("div",{key:o,staticClass:"pedido-item"},[e("div",{staticClass:"input-row"},[e("div",{staticClass:"input-group-compact kilos"},[e("div",{staticClass:"label-container"},[e("label",[t._v("Kilos:")]),e("div",{staticClass:"tara-checkbox"},[e("input",{directives:[{name:"model",rawName:"v-model",value:a.esTara,expression:"item.esTara"}],attrs:{type:"checkbox",id:"tara"+o},domProps:{checked:Array.isArray(a.esTara)?t._i(a.esTara,null)>-1:a.esTara},on:{change:function(e){var o=a.esTara,i=e.target,s=!!i.checked;if(Array.isArray(o)){var r=null,n=t._i(o,r);i.checked?n<0&&t.$set(a,"esTara",o.concat([r])):n>-1&&t.$set(a,"esTara",o.slice(0,n).concat(o.slice(n+1)))}else t.$set(a,"esTara",s)}}}),e("label",{attrs:{for:"tara"+o}},[t._v("T")])])]),e("input",{directives:[{name:"model",rawName:"v-model",value:a.kilos,expression:"item.kilos"}],staticClass:"input-field",attrs:{type:"number"},domProps:{value:a.kilos},on:{input:function(e){e.target.composing||t.$set(a,"kilos",e.target.value)}}})]),e("div",{staticClass:"input-group-compact medida"},[e("div",{staticClass:"label-container"},[e("label",[t._v("Medida:")]),e("button",{staticClass:"btn-proveedor",class:{active:a.esProveedor},attrs:{title:a.proveedor||"Agregar proveedor"},on:{click:function(e){return t.abrirModalProveedor(a)}}},[t._v(" P ")])]),e("select",{directives:[{name:"model",rawName:"v-model",value:a.medida,expression:"item.medida"}],staticClass:"input-field",on:{change:function(e){var o=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(a,"medida",e.target.multiple?o:o[0])}}},[e("option",{attrs:{value:""}},[t._v("Seleccionar")]),t._l(t.medidasOrdenadas,(function(a){return e("option",{key:a.id,domProps:{value:a.nombre}},[t._v(" "+t._s(a.nombre)+" ")])}))],2)]),e("div",{staticClass:"input-group-compact tipo"},[e("div",{staticClass:"label-container"},[e("label",[t._v("Tipo:")]),e("select",{directives:[{name:"model",rawName:"v-model",value:a.nota,expression:"item.nota"}],staticClass:"input-field-notas",on:{change:function(e){var o=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(a,"nota",e.target.multiple?o:o[0])}}},[e("option",{attrs:{value:""}},[t._v("Notas")]),e("option",{attrs:{value:"Sellado"}},[t._v("Sellado")]),e("option",{attrs:{value:"Kileado"}},[t._v("Kileado")])])]),e("select",{directives:[{name:"model",rawName:"v-model",value:a.tipo,expression:"item.tipo"}],staticClass:"input-field",class:{"text-blue":"C/H20"===a.tipo},on:{change:function(e){var o=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(a,"tipo",e.target.multiple?o:o[0])}}},[e("option",{attrs:{value:""}},[t._v("Seleccionar")]),e("option",{attrs:{value:"S/H20"}},[t._v("S/H20")]),e("option",{staticClass:"text-blue",attrs:{value:"C/H20"}},[t._v("C/H20")])])]),t.pedidoCatarro.length>1?e("button",{staticClass:"btn-eliminar",on:{click:function(e){return t.eliminarPedidoCatarro(o)}}},[e("i",{staticClass:"fas fa-trash"})]):t._e()])])})),0)]),e("div",{directives:[{name:"show",rawName:"v-show",value:"joselito"===t.clienteActivo,expression:"clienteActivo === 'joselito'"}],staticClass:"cliente-seccion"},[e("button",{staticClass:"btn-agregar",class:{"bg-otilio":"otilio"===t.clienteActivo,"bg-catarro":"catarro"===t.clienteActivo,"bg-joselito":"joselito"===t.clienteActivo,"bg-ozuna":"ozuna"===t.clienteActivo,"bg-temporal":t.isClienteTemporal(t.clienteActivo)},on:{click:t.agregarFilaJoselito}},[t._v(" + Agregar Fila ")]),e("div",{staticClass:"pedido-grid"},t._l(t.pedidoJoselito,(function(a,o){return e("div",{key:o,staticClass:"pedido-item"},[e("div",{staticClass:"input-row"},[e("div",{staticClass:"input-group-compact kilos"},[e("div",{staticClass:"label-container"},[e("label",[t._v("Kilos:")]),e("div",{staticClass:"tara-checkbox"},[e("input",{directives:[{name:"model",rawName:"v-model",value:a.esTara,expression:"item.esTara"}],attrs:{type:"checkbox",id:"tara"+o},domProps:{checked:Array.isArray(a.esTara)?t._i(a.esTara,null)>-1:a.esTara},on:{change:function(e){var o=a.esTara,i=e.target,s=!!i.checked;if(Array.isArray(o)){var r=null,n=t._i(o,r);i.checked?n<0&&t.$set(a,"esTara",o.concat([r])):n>-1&&t.$set(a,"esTara",o.slice(0,n).concat(o.slice(n+1)))}else t.$set(a,"esTara",s)}}}),e("label",{attrs:{for:"tara"+o}},[t._v("T")])])]),e("input",{directives:[{name:"model",rawName:"v-model",value:a.kilos,expression:"item.kilos"}],staticClass:"input-field",attrs:{type:"number"},domProps:{value:a.kilos},on:{input:function(e){e.target.composing||t.$set(a,"kilos",e.target.value)}}})]),e("div",{staticClass:"input-group-compact medida"},[e("div",{staticClass:"label-container"},[e("label",[t._v("Medida:")]),e("button",{staticClass:"btn-proveedor",class:{active:a.esProveedor},attrs:{title:a.proveedor||"Agregar proveedor"},on:{click:function(e){return t.abrirModalProveedor(a)}}},[t._v(" P ")])]),e("select",{directives:[{name:"model",rawName:"v-model",value:a.medida,expression:"item.medida"}],staticClass:"input-field",on:{change:function(e){var o=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(a,"medida",e.target.multiple?o:o[0])}}},[e("option",{attrs:{value:""}},[t._v("Seleccionar")]),t._l(t.medidasOrdenadas,(function(a){return e("option",{key:a.id,domProps:{value:a.nombre}},[t._v(" "+t._s(a.nombre)+" ")])}))],2)]),e("div",{staticClass:"input-group-compact tipo"},[e("div",{staticClass:"label-container"},[e("label",[t._v("Tipo:")]),e("select",{directives:[{name:"model",rawName:"v-model",value:a.nota,expression:"item.nota"}],staticClass:"input-field-notas",on:{change:function(e){var o=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(a,"nota",e.target.multiple?o:o[0])}}},[e("option",{attrs:{value:""}},[t._v("Notas")]),e("option",{attrs:{value:"Sellado"}},[t._v("Sellado")]),e("option",{attrs:{value:"Kileado"}},[t._v("Kileado")])])]),e("select",{directives:[{name:"model",rawName:"v-model",value:a.tipo,expression:"item.tipo"}],staticClass:"input-field",class:{"text-blue":"C/H20"===a.tipo||"1.35 y .15"===a.tipo},on:{change:function(e){var o=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(a,"tipo",e.target.multiple?o:o[0])}}},[e("option",{attrs:{value:""}},[t._v("Seleccionar")]),e("option",{attrs:{value:"S/H20"}},[t._v("S/H20")]),e("option",{staticClass:"text-blue",attrs:{value:"C/H20"}},[t._v("C/H20")]),e("option",{staticClass:"text-blue",attrs:{value:"1.35 y .15"}},[t._v("1.35 y .15")])])]),t.pedidoJoselito.length>1?e("button",{staticClass:"btn-eliminar",on:{click:function(e){return t.eliminarPedidoJoselito(o)}}},[e("i",{staticClass:"fas fa-trash"})]):t._e()])])})),0)]),e("div",{directives:[{name:"show",rawName:"v-show",value:"ozuna"===t.clienteActivo,expression:"clienteActivo === 'ozuna'"}],staticClass:"cliente-seccion"},[e("button",{staticClass:"btn-agregar",class:{"bg-otilio":"otilio"===t.clienteActivo,"bg-catarro":"catarro"===t.clienteActivo,"bg-joselito":"joselito"===t.clienteActivo,"bg-ozuna":"ozuna"===t.clienteActivo,"bg-temporal":t.isClienteTemporal(t.clienteActivo)},on:{click:t.agregarFilaOzuna}},[t._v(" + Agregar Fila ")]),e("div",{staticClass:"pedido-grid"},t._l(t.pedidoOzuna,(function(a,o){return e("div",{key:o,staticClass:"pedido-item"},[e("div",{staticClass:"input-row"},[e("div",{staticClass:"input-group-compact kilos"},[e("div",{staticClass:"label-container"},[e("label",[t._v("Kilos:")]),e("div",{staticClass:"tara-checkbox"},[e("input",{directives:[{name:"model",rawName:"v-model",value:a.esTara,expression:"item.esTara"}],attrs:{type:"checkbox",id:"tara"+o},domProps:{checked:Array.isArray(a.esTara)?t._i(a.esTara,null)>-1:a.esTara},on:{change:function(e){var o=a.esTara,i=e.target,s=!!i.checked;if(Array.isArray(o)){var r=null,n=t._i(o,r);i.checked?n<0&&t.$set(a,"esTara",o.concat([r])):n>-1&&t.$set(a,"esTara",o.slice(0,n).concat(o.slice(n+1)))}else t.$set(a,"esTara",s)}}}),e("label",{attrs:{for:"tara"+o}},[t._v("T")])])]),e("input",{directives:[{name:"model",rawName:"v-model",value:a.kilos,expression:"item.kilos"}],staticClass:"input-field",attrs:{type:"number"},domProps:{value:a.kilos},on:{input:function(e){e.target.composing||t.$set(a,"kilos",e.target.value)}}})]),e("div",{staticClass:"input-group-compact medida"},[e("div",{staticClass:"label-container"},[e("label",[t._v("Medida:")]),e("button",{staticClass:"btn-proveedor",class:{active:a.esProveedor},attrs:{title:a.proveedor||"Agregar proveedor"},on:{click:function(e){return t.abrirModalProveedor(a)}}},[t._v(" P ")])]),e("select",{directives:[{name:"model",rawName:"v-model",value:a.medida,expression:"item.medida"}],staticClass:"input-field",on:{change:function(e){var o=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(a,"medida",e.target.multiple?o:o[0])}}},[e("option",{attrs:{value:""}},[t._v("Seleccionar")]),t._l(t.medidasOrdenadas,(function(a){return e("option",{key:a.id,domProps:{value:a.nombre}},[t._v(" "+t._s(a.nombre)+" ")])}))],2)]),e("div",{staticClass:"input-group-compact tipo"},[e("div",{staticClass:"label-container"},[e("label",[t._v("Tipo:")]),e("select",{directives:[{name:"model",rawName:"v-model",value:a.nota,expression:"item.nota"}],staticClass:"input-field-notas",on:{change:function(e){var o=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(a,"nota",e.target.multiple?o:o[0])}}},[e("option",{attrs:{value:""}},[t._v("Notas")]),e("option",{attrs:{value:"Sellado"}},[t._v("Sellado")]),e("option",{attrs:{value:"Kileado"}},[t._v("Kileado")])])]),e("select",{directives:[{name:"model",rawName:"v-model",value:a.tipo,expression:"item.tipo"}],staticClass:"input-field",class:{"text-blue":"C/H20"===a.tipo},on:{change:function(e){var o=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(a,"tipo",e.target.multiple?o:o[0])}}},[e("option",{attrs:{value:""}},[t._v("Seleccionar")]),e("option",{attrs:{value:"S/H20"}},[t._v("S/H20")]),e("option",{staticClass:"text-blue",attrs:{value:"C/H20"}},[t._v("C/H20")]),e("option",{attrs:{value:".7 y .3"}},[t._v(".7 y .3")])])]),"ozuna"===t.clienteActivo?e("div",{staticClass:"input-group-compact maquila"},[e("div",{staticClass:"label-container"},[e("label",[t._v("Maquila:")]),e("div",{staticClass:"maquila-checkbox"},[e("input",{directives:[{name:"model",rawName:"v-model",value:a.esMaquila,expression:"item.esMaquila"}],attrs:{type:"checkbox",id:"maquila"+o},domProps:{checked:Array.isArray(a.esMaquila)?t._i(a.esMaquila,null)>-1:a.esMaquila},on:{change:function(e){var o=a.esMaquila,i=e.target,s=!!i.checked;if(Array.isArray(o)){var r=null,n=t._i(o,r);i.checked?n<0&&t.$set(a,"esMaquila",o.concat([r])):n>-1&&t.$set(a,"esMaquila",o.slice(0,n).concat(o.slice(n+1)))}else t.$set(a,"esMaquila",s)}}})])])]):t._e(),t.pedidoOzuna.length>1?e("button",{staticClass:"btn-eliminar",on:{click:function(e){return t.eliminarPedidoOzuna(o)}}},[e("i",{staticClass:"fas fa-trash"})]):t._e()])])})),0)]),t._l(t.clientesTemporales,(function(a,o){return e("div",{directives:[{name:"show",rawName:"v-show",value:t.clienteActivo===a.id,expression:"clienteActivo === cliente.id"}],key:o,staticClass:"cliente-seccion"},[e("button",{staticClass:"btn-agregar",class:{"bg-otilio":"otilio"===t.clienteActivo,"bg-catarro":"catarro"===t.clienteActivo,"bg-joselito":"joselito"===t.clienteActivo,"bg-ozuna":"ozuna"===t.clienteActivo,"bg-temporal":t.isClienteTemporal(t.clienteActivo)},on:{click:function(e){return t.agregarFilaTemporal(a.id)}}},[t._v(" + Agregar Fila ")]),e("div",{staticClass:"pedido-grid"},t._l(a.pedidos,(function(o,i){return e("div",{key:i,staticClass:"pedido-item"},[e("div",{staticClass:"input-row"},[e("div",{staticClass:"input-group-compact kilos"},[e("div",{staticClass:"label-container"},[e("label",[t._v("Kilos:")]),e("div",{staticClass:"tara-checkbox"},[e("input",{directives:[{name:"model",rawName:"v-model",value:o.esTara,expression:"item.esTara"}],attrs:{type:"checkbox",id:"tara"+a.id+i},domProps:{checked:Array.isArray(o.esTara)?t._i(o.esTara,null)>-1:o.esTara},on:{change:function(e){var a=o.esTara,i=e.target,s=!!i.checked;if(Array.isArray(a)){var r=null,n=t._i(a,r);i.checked?n<0&&t.$set(o,"esTara",a.concat([r])):n>-1&&t.$set(o,"esTara",a.slice(0,n).concat(a.slice(n+1)))}else t.$set(o,"esTara",s)}}}),e("label",{attrs:{for:"tara"+a.id+i}},[t._v("T")])])]),e("input",{directives:[{name:"model",rawName:"v-model",value:o.kilos,expression:"item.kilos"}],staticClass:"input-field",attrs:{type:"number"},domProps:{value:o.kilos},on:{input:function(e){e.target.composing||t.$set(o,"kilos",e.target.value)}}})]),e("div",{staticClass:"input-group-compact medida"},[e("div",{staticClass:"label-container"},[e("label",[t._v("Medida:")]),e("button",{staticClass:"btn-proveedor",class:{active:o.esProveedor},attrs:{title:o.proveedor||"Agregar proveedor"},on:{click:function(e){return t.abrirModalProveedor(o)}}},[t._v(" P ")])]),e("select",{directives:[{name:"model",rawName:"v-model",value:o.medida,expression:"item.medida"}],staticClass:"input-field",on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(o,"medida",e.target.multiple?a:a[0])}}},[e("option",{attrs:{value:""}},[t._v("Seleccionar")]),t._l(t.medidasOrdenadas,(function(a){return e("option",{key:a.id,domProps:{value:a.nombre}},[t._v(" "+t._s(a.nombre)+" ")])}))],2)]),e("div",{staticClass:"input-group-compact tipo"},[e("div",{staticClass:"label-container"},[e("label",[t._v("Tipo:")]),e("select",{directives:[{name:"model",rawName:"v-model",value:o.nota,expression:"item.nota"}],staticClass:"input-field-notas",on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(o,"nota",e.target.multiple?a:a[0])}}},[e("option",{attrs:{value:""}},[t._v("Notas")]),e("option",{attrs:{value:"Sellado"}},[t._v("Sellado")]),e("option",{attrs:{value:"Kileado"}},[t._v("Kileado")])])]),e("select",{directives:[{name:"model",rawName:"v-model",value:o.tipo,expression:"item.tipo"}],staticClass:"input-field",class:{"text-blue":"C/H20"===o.tipo},on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(o,"tipo",e.target.multiple?a:a[0])}}},[e("option",{attrs:{value:""}},[t._v("Seleccionar")]),e("option",{attrs:{value:"S/H20"}},[t._v("S/H20")]),e("option",{attrs:{value:".9 y .1"}},[t._v(".9 y .1")]),e("option",{attrs:{value:".9"}},[t._v(".9")])])]),e("div",{staticClass:"input-group-compact operacion"},[t._m(0,!0),e("select",{directives:[{name:"model",rawName:"v-model",value:o.tipoOperacion,expression:"item.tipoOperacion"}],staticClass:"input-field",on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(o,"tipoOperacion",e.target.multiple?a:a[0])}}},[e("option",{attrs:{value:""}},[t._v("Seleccionar")]),e("option",{attrs:{value:"Venta"}},[t._v("Venta")]),e("option",{attrs:{value:"Maquila"}},[t._v("Maquila")])])]),a.pedidos.length>1?e("button",{staticClass:"btn-eliminar",on:{click:function(e){return t.eliminarPedidoTemporal(a.id,i)}}},[e("i",{staticClass:"fas fa-trash"})]):t._e()])])})),0)])}))],2),e("div",{staticClass:"buttons-container"},[e("button",{staticClass:"btn-guardar",on:{click:t.guardarPedido}},[t._v("Guardar Pedido")]),e("button",{staticClass:"btn-imprimir",on:{click:t.mostrarVistaImpresion}},[e("i",{staticClass:"fas fa-print"}),t._v(" Vista Previa ")]),e("button",{staticClass:"btn-cancelar",on:{click:function(e){return t.$router.push("/procesos/pedidos")}}},[t._v("Cancelar")])])]),e("ProveedorModal",{attrs:{mostrar:t.mostrarModalProveedor,proveedor:t.itemSeleccionado?t.itemSeleccionado.proveedor:""},on:{cerrar:function(e){t.mostrarModalProveedor=!1},guardar:t.guardarProveedor}}),e("NuevoClienteModal",{attrs:{mostrar:t.mostrarModalNuevoCliente},on:{cerrar:function(e){t.mostrarModalNuevoCliente=!1},guardar:t.agregarClienteTemporal}})],1)},Fi=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"label-container"},[e("label",[t._v("Operación:")])])}],qi=function(){var t=this,e=t._self._c;return e("div",{staticClass:"impresion-container"},[e("h2",[t._v("Vista previa de impresión - Pedido de Camarón Limpio")]),e("div",{staticClass:"scale-control"},[e("label",[t._v("Escala del contenido:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.contentScale,expression:"contentScale"}],staticClass:"scale-slider",attrs:{type:"range",min:"0.5",max:"2",step:"0.1"},domProps:{value:t.contentScale},on:{__r:function(e){t.contentScale=e.target.value}}}),e("span",{staticClass:"scale-value"},[t._v(t._s((100*t.contentScale).toFixed(0))+"%")])]),e("div",{staticClass:"buttons-container"},[e("button",{staticClass:"btn-generar",on:{click:t.generarPDF}},[e("span",{staticClass:"icon"},[t._v("📄")]),t._v(" Generar PDF ")]),e("button",{staticClass:"btn-menu",on:{click:function(e){return t.$router.push("/procesos/pedidos")}}},[t._v(" Menú ")]),e("button",{staticClass:"btn-volver",on:{click:function(e){return t.$emit("volver")}}},[t._v(" Volver al Pedido ")])]),e("div",{staticClass:"pdf-preview",attrs:{id:"pdfPreview"}},[e("div",{staticClass:"preview-page"},[e("h3",{staticClass:"cliente-header otilio-header"},[t._v("Otilio")]),e("table",{staticClass:"preview-table"},[t._m(0),e("tbody",t._l(t.pedidoOtilio,(function(a,o){return e("tr",{key:"otilio-"+o},[e("td",[e("input",{directives:[{name:"model",rawName:"v-model",value:a.completado,expression:"item.completado"}],staticClass:"pedido-checkbox",attrs:{type:"checkbox"},domProps:{checked:Array.isArray(a.completado)?t._i(a.completado,null)>-1:a.completado},on:{change:[function(e){var o=a.completado,i=e.target,s=!!i.checked;if(Array.isArray(o)){var r=null,n=t._i(o,r);i.checked?n<0&&t.$set(a,"completado",o.concat([r])):n>-1&&t.$set(a,"completado",o.slice(0,n).concat(o.slice(n+1)))}else t.$set(a,"completado",s)},function(e){return t.actualizarCompletado("otilio",o,a.completado)}]}})]),e("td",[t._v(t._s(a.kilos)),a.esTara?e("i",[t._v("T")]):t._e()]),e("td",[t._v(" "+t._s(a.medida)+" "),a.proveedor?e("span",{staticClass:"proveedor-tag"},[t._v(t._s(a.proveedor))]):t._e()]),e("td",{class:{"text-blue":"C/H20"===a.tipo,"text-blue compact":"1.35 y .15"===a.tipo}},[t._v(" "+t._s(a.tipo)+" "),a.nota?e("span",{staticClass:"nota-tag"},[t._v(t._s(a.nota))]):t._e()])])})),0)])]),e("div",{staticClass:"preview-page"},[e("div",{staticClass:"cliente-seccion",class:{compacto:t.pedidoJoselito.length>=5}},[e("h4",{staticClass:"cliente-header joselito-header",class:{compacto:t.pedidoJoselito.length>=5}},[t._v("Joselito")]),e("table",{staticClass:"preview-table",class:{compacto:t.pedidoJoselito.length>=5}},[t._m(1),e("tbody",t._l(t.pedidoJoselito,(function(a,o){return e("tr",{key:"joselito-"+o},[e("td",[e("input",{directives:[{name:"model",rawName:"v-model",value:a.completado,expression:"item.completado"}],staticClass:"pedido-checkbox",attrs:{type:"checkbox"},domProps:{checked:Array.isArray(a.completado)?t._i(a.completado,null)>-1:a.completado},on:{change:[function(e){var o=a.completado,i=e.target,s=!!i.checked;if(Array.isArray(o)){var r=null,n=t._i(o,r);i.checked?n<0&&t.$set(a,"completado",o.concat([r])):n>-1&&t.$set(a,"completado",o.slice(0,n).concat(o.slice(n+1)))}else t.$set(a,"completado",s)},function(e){return t.actualizarCompletado("joselito",o,a.completado)}]}})]),e("td",[t._v(t._s(a.kilos)),a.esTara?e("i",[t._v("T")]):t._e()]),e("td",[t._v(" "+t._s(a.medida)+" "),a.proveedor?e("span",{staticClass:"proveedor-tag"},[t._v(t._s(a.proveedor))]):t._e()]),e("td",{class:{"text-blue":"C/H20"===a.tipo,"text-blue compact":"1.35 y .15"===a.tipo}},[t._v(" "+t._s(a.tipo)+" "),a.nota?e("span",{staticClass:"nota-tag"},[t._v(t._s(a.nota))]):t._e()])])})),0)])]),e("div",{staticClass:"bottom-section"},[e("div",{staticClass:"bottom-cliente"},[e("h4",{staticClass:"cliente-header catarro-header"},[t._v("Catarro")]),e("table",{staticClass:"preview-table"},[t._m(2),e("tbody",t._l(t.pedidoCatarro,(function(a,o){return e("tr",{key:"catarro-"+o},[e("td",[e("input",{directives:[{name:"model",rawName:"v-model",value:a.completado,expression:"item.completado"}],staticClass:"pedido-checkbox",attrs:{type:"checkbox"},domProps:{checked:Array.isArray(a.completado)?t._i(a.completado,null)>-1:a.completado},on:{change:[function(e){var o=a.completado,i=e.target,s=!!i.checked;if(Array.isArray(o)){var r=null,n=t._i(o,r);i.checked?n<0&&t.$set(a,"completado",o.concat([r])):n>-1&&t.$set(a,"completado",o.slice(0,n).concat(o.slice(n+1)))}else t.$set(a,"completado",s)},function(e){return t.actualizarCompletado("catarro",o,a.completado)}]}})]),e("td",[t._v(t._s(a.kilos)),a.esTara?e("i",[t._v("T")]):t._e()]),e("td",[t._v(" "+t._s(a.medida)+" "),a.proveedor?e("span",{staticClass:"proveedor-tag"},[t._v(t._s(a.proveedor))]):t._e()])])})),0)])]),e("div",{staticClass:"bottom-cliente"},[e("h4",{staticClass:"cliente-header ozuna-header"},[t._v("Ozuna")]),e("table",{staticClass:"preview-table"},[t._m(3),e("tbody",t._l(t.pedidoOzuna,(function(a,o){return e("tr",{key:"ozuna-"+o},[e("td",[e("input",{directives:[{name:"model",rawName:"v-model",value:a.completado,expression:"item.completado"}],staticClass:"pedido-checkbox",attrs:{type:"checkbox"},domProps:{checked:Array.isArray(a.completado)?t._i(a.completado,null)>-1:a.completado},on:{change:[function(e){var o=a.completado,i=e.target,s=!!i.checked;if(Array.isArray(o)){var r=null,n=t._i(o,r);i.checked?n<0&&t.$set(a,"completado",o.concat([r])):n>-1&&t.$set(a,"completado",o.slice(0,n).concat(o.slice(n+1)))}else t.$set(a,"completado",s)},function(e){return t.actualizarCompletado("ozuna",o,a.completado)}]}})]),e("td",[t._v(t._s(a.kilos)),a.esTara?e("i",[t._v("T")]):t._e()]),e("td",[t._v(" "+t._s(a.medida)+" "),a.proveedor?e("span",{staticClass:"proveedor-tag"},[t._v(t._s(a.proveedor))]):t._e()])])})),0)])])])]),Object.keys(t.clientesTemporales).length>0?e("div",{staticClass:"preview-page"},[t._l(t.clientesTemporales,(function(a,o){return[e("div",{key:o,staticClass:"cliente-seccion temporal"},[e("h3",{staticClass:"cliente-header temporal-header"},[t._v(t._s(a.nombre))]),e("table",{staticClass:"preview-table"},[t._m(4,!0),e("tbody",t._l(a.pedidos,(function(a,i){return e("tr",{key:"temp-"+o+"-"+i},[e("td",[e("input",{directives:[{name:"model",rawName:"v-model",value:a.completado,expression:"item.completado"}],staticClass:"pedido-checkbox",attrs:{type:"checkbox"},domProps:{checked:Array.isArray(a.completado)?t._i(a.completado,null)>-1:a.completado},on:{change:function(e){var o=a.completado,i=e.target,s=!!i.checked;if(Array.isArray(o)){var r=null,n=t._i(o,r);i.checked?n<0&&t.$set(a,"completado",o.concat([r])):n>-1&&t.$set(a,"completado",o.slice(0,n).concat(o.slice(n+1)))}else t.$set(a,"completado",s)}}})]),e("td",[t._v(t._s(a.kilos)),a.esTara?e("i",[t._v("T")]):t._e()]),e("td",[t._v(" "+t._s(a.medida)+" "),a.proveedor?e("span",{staticClass:"proveedor-tag"},[t._v(t._s(a.proveedor))]):t._e()]),e("td",{class:{"text-blue":"C/H20"===a.tipo,"text-blue compact":"1.35 y .15"===a.tipo}},[t._v(" "+t._s(a.tipo)+" "),a.nota?e("span",{staticClass:"nota-tag"},[t._v(t._s(a.nota))]):t._e()])])})),0)])])]}))],2):t._e(),e("div",{staticClass:"resumen-medidas"},[e("h3",{staticClass:"resumen-header"},[t._v("Resumen por Medida")]),e("table",{staticClass:"resumen-table"},[t._m(5),e("tbody",[t._l(t.calcularTotalesPorMedida(),(function(a,o){return e("tr",{key:o},[e("td",{attrs:{"data-label":"Medida"}},[t._v(t._s(a.medida))]),e("td",{attrs:{"data-label":"Total Kilos"}},[t._v(t._s(a.total)+" kg")]),e("td",{attrs:{"data-label":"Rendimientos"}},[e("div",{staticClass:"rendimientos-column"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.rendimientos[a.medida],expression:"rendimientos[medida.medida]"}],staticClass:"rendimiento-box",attrs:{type:"number",step:"0.01",placeholder:"1.00"},domProps:{value:t.rendimientos[a.medida]},on:{input:[function(e){e.target.composing||t.$set(t.rendimientos,a.medida,e.target.value)},function(e){return t.calcularRendimiento(a)}]}}),t.rendimientos[a.medida]?e("div",{staticClass:"rendimiento-total"},[t._v(" "+t._s(Math.round(a.total*t.rendimientos[a.medida]))+" ")]):t._e()])]),e("td",{attrs:{"data-label":"Masters"}},[t.esMedidaGranja(a.medida)?e("div",{staticClass:"checkbox-group"},[e("label",[e("input",{attrs:{type:"radio",name:"master-"+a.medida},domProps:{checked:20===t.divisores[a.medida]},on:{click:function(e){return t.toggleDivisor(a,20)}}}),t._v(" 20 ")]),e("label",[e("input",{attrs:{type:"radio",name:"master-"+a.medida},domProps:{checked:22===t.divisores[a.medida]},on:{click:function(e){return t.toggleDivisor(a,22)}}}),t._v(" 22 ")])]):t._e()]),e("td",{attrs:{"data-label":"Cajas"}},[t.rendimientos[a.medida]?[t.esMedidaGranja(a.medida)&&t.divisores[a.medida]?e("span",{staticClass:"cajas-result"},[t._v(" "+t._s(Math.round(a.total*t.rendimientos[a.medida]/t.divisores[a.medida]))+" ")]):e("span",{staticClass:"cajas-result"},[t._v(" "+t._s(Math.round(a.total*t.rendimientos[a.medida]))+" kg ")])]:t._e()],2)])})),e("tr",{staticClass:"total-row"},[e("td",[t._v("Total:")]),e("td",[t._v(t._s(t.calcularTotalKilos())+" kg")]),e("td"),e("td"),e("td")])],2)])])])])},zi=[function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",[t._v("✓")]),e("th",[t._v("Kilos/Taras")]),e("th",[t._v("Medida")]),e("th",[t._v("Tipo")])])])},function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",[t._v("✓")]),e("th",[t._v("Kilos/Taras")]),e("th",[t._v("Medida")]),e("th",[t._v("Tipo")])])])},function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",[t._v("✓")]),e("th",[t._v("Kilos/Taras")]),e("th",[t._v("Medida")])])])},function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",[t._v("✓")]),e("th",[t._v("Kilos/Taras")]),e("th",[t._v("Medida")])])])},function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",[t._v("✓")]),e("th",[t._v("Kilos/Taras")]),e("th",[t._v("Medida")]),e("th",[t._v("Tipo")])])])},function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",[t._v("Medida")]),e("th",[t._v("Total Kilos")]),e("th",[t._v("Rendimientos")]),e("th",[t._v("Masters")]),e("th",[t._v("Cajas")])])])}];const Vi={Roboto:{normal:"https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.66/fonts/Roboto/Roboto-Regular.ttf",bold:"https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.66/fonts/Roboto/Roboto-Medium.ttf",italics:"https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.66/fonts/Roboto/Roboto-Italic.ttf",bolditalics:"https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.66/fonts/Roboto/Roboto-MediumItalic.ttf"}};$a.a.fonts=Vi;var Li={name:"PedidoLimpioImpresion",props:{fecha:{type:String,required:!0},pedidoOtilio:{type:Array,required:!0},pedidoCatarro:{type:Array,required:!0},pedidoJoselito:{type:Array,required:!0},pedidoOzuna:{type:Array,required:!0},clientesTemporales:{type:Object,default:()=>({})},rendimientosGuardados:{type:Object,default:()=>({})},divisoresGuardados:{type:Object,default:()=>({})},completadosGuardados:{type:Object,default:()=>({})}},data(){return{rendimientos:this.rendimientosGuardados||{},divisores:this.divisoresGuardados||{},contentScale:1,completados:this.completadosGuardados||{}}},created(){this.completados.otilio||(this.completados.otilio={}),this.completados.catarro||(this.completados.catarro={}),this.completados.joselito||(this.completados.joselito={}),this.completados.ozuna||(this.completados.ozuna={}),this.rendimientos={...this.rendimientosGuardados},this.divisores={...this.divisoresGuardados},this.completados={...this.completadosGuardados},this.aplicarEstadosCompletado()},methods:{aplicarEstadosCompletado(){this.pedidoOtilio.forEach((t,e)=>{void 0!==this.completados.otilio[e]&&this.$set(t,"completado",this.completados.otilio[e])}),this.pedidoCatarro.forEach((t,e)=>{void 0!==this.completados.catarro[e]&&this.$set(t,"completado",this.completados.catarro[e])}),this.pedidoJoselito.forEach((t,e)=>{void 0!==this.completados.joselito[e]&&this.$set(t,"completado",this.completados.joselito[e])}),this.pedidoOzuna.forEach((t,e)=>{void 0!==this.completados.ozuna[e]&&this.$set(t,"completado",this.completados.ozuna[e])})},actualizarCompletado(t,e,a){this.completados[t]||this.$set(this.completados,t,{}),this.$set(this.completados[t],e,a),this.$emit("actualizar-completados",this.completados)},obtenerDiaSemana(t){const e=["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"],a=new Date(t);return e[a.getDay()]},generarTablaCliente(t,e=16){if(!t||0===t.length)return null;const a=t.length>7,o=a?2:16,i=t.map(t=>[{text:t.kilos?t.esTara?[{text:t.kilos.toString(),fontSize:2*e},{text:"T",fontSize:1.2*e,italics:!0,alignment:"right",margin:[0,-8,0,0]}]:{text:t.kilos.toString(),fontSize:2*e}:"",alignment:"center",margin:[0,-2,0,-2]},{stack:[{text:t.medida||"",fontSize:2*e},t.proveedor?{text:t.proveedor,fontSize:1.1*e,color:"#FFFFFF",background:"#FF0000",margin:[0,2,0,0],padding:[2,1],alignment:"center"}:""],margin:[0,2,0,2]},{stack:[{text:[{text:t.tipo||"",fontSize:2*e,color:"C/H20"===t.tipo||"1.35 y .15"===t.tipo?"#0000FF":void 0,margin:"1.35 y .15"===t.tipo?[0,0,0,0]:[0,2,0,2]}]},t.nota?{text:t.nota,fontSize:1.1*e,margin:[0,1,0,0],padding:[1,1],bold:!0,background:"#FF0000",color:"#FFFFFF"}:""],margin:[0,2,0,2]}]);return{table:{widths:["30%","35%","35%"],body:i},layout:{hLineWidth:()=>0,vLineWidth:()=>0,paddingLeft:()=>8,paddingRight:()=>8,paddingTop:()=>o,paddingBottom:()=>o}}},generarPDF(){this.obtenerDiaSemana(this.fecha);const t=this.pedidoJoselito.length>=5,e=t?.5:30,a=t?22:26,o=t?24:36,i=this.contentScale,s={otilio:48*i,joselito:(t?24:48)*i,inferior:o*i,tabla:26*i,tablaJoselito:a*i},r={pageSize:"letter",pageOrientation:"portrait",pageMargins:[10,10,10,10],content:[{columns:[{text:"OTILIO",style:"clienteHeader",fontSize:s.otilio,width:"*",alignment:"left",background:"#FFEB3B"},{text:this.fecha,fontSize:.75*s.otilio,italics:!0,width:"auto",alignment:"right"}],margin:[0,0,0,10*i]},this.generarTablaCliente(this.pedidoOtilio,s.tabla),{text:"",pageBreak:"after"},{text:"JOSELITO",style:"clienteHeader",fontSize:s.joselito,margin:[0,0,0,t?.5:0],background:"#2196F3"},this.generarTablaCliente(this.pedidoJoselito,s.tablaJoselito),{text:"",margin:[0,e,0,0]},{canvas:[{type:"line",x1:0,y1:0,x2:592,y2:0,lineWidth:t?.3:2}]},{text:"",margin:[0,e,0,0]},{columns:[{stack:[{text:"CATARRO",style:"clienteHeader",fontSize:s.inferior,margin:[0,0,0,t?1:0],background:"#FF5252"},this.generarTablaClienteReducido(this.pedidoCatarro,s.tablaJoselito)],width:"47%"},{stack:[{canvas:[{type:"line",x1:10,y1:0,x2:10,y2:t?30:150,lineWidth:t?.3:1.5}]}],width:"6%",margin:[0,t?2:20,0,0]},{stack:[{text:"OZUNA",style:"clienteHeader",fontSize:s.inferior,margin:[0,0,0,t?1:0],background:"#4CAF50"},this.generarTablaClienteReducido(this.pedidoOzuna,s.tablaJoselito)],width:"47%"}]},{text:"",pageBreak:"after"},...Object.keys(this.clientesTemporales).length>0?[...Object.entries(this.clientesTemporales).map(([t,e])=>[{text:e.nombre.toUpperCase(),style:"clienteHeader",fontSize:36,margin:[0,0,0,10],background:"#95a5a6"},this.generarTablaCliente(e.pedidos,22),{text:"",margin:[0,20,0,20]}]).flat()]:[]],styles:{header:{alignment:"center",margin:[0,0,0,20],bold:!0},clienteHeader:{bold:!0,alignment:"center"},tableHeader:{bold:!0,fontSize:14,color:"black",alignment:"center"}},defaultStyle:{font:"Roboto"}};$a.a.createPdf(r).download("Ped-limpio-"+this.fecha+".pdf")},generarTablaClienteReducido(t,e=16){if(!t||0===t.length)return null;const a=t.map(t=>[{text:t.kilos?t.esTara?[{text:t.kilos.toString(),fontSize:2*e},{text:"T",fontSize:1.2*e,italics:!0,alignment:"right",margin:[0,-8,0,0]}]:{text:t.kilos.toString(),fontSize:2*e}:"",alignment:"center",margin:[0,-2,0,-2]},{stack:[{text:t.medida||"",fontSize:2*e},t.proveedor?{text:t.proveedor,fontSize:1.1*e,color:"#FFFFFF",background:"#FF0000",padding:[2,1],alignment:"center"}:"",t.nota?{text:t.nota,fontSize:.9*e,padding:[1,0],bold:!0,background:"#FF0000",color:"#FFFFFF"}:""],margin:[0,1,0,1]}]);return{table:{widths:["45%","55%"],body:a},layout:{hLineWidth:()=>0,vLineWidth:()=>0,paddingLeft:()=>1,paddingRight:()=>1,paddingTop:()=>1,paddingBottom:()=>1}}},obtenerNombreCliente(t){return t.split("-").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")},calcularTotalesTemporales(t){if(!this.clientesTemporales[t])return{tarasTotal:"0",kilosTotal:"0"};let e=0,a=0,o=0,i=0,s=0;this.clientesTemporales[t].forEach(t=>{t.kilos&&(t.esTara?(e+=Number(t.kilos),"C/H20"===t.tipo?o+=30*Number(t.kilos)*.65:i+=30*Number(t.kilos)):"S/H20"===t.tipo?a+=Number(t.kilos):"C/H20"===t.tipo?o+=Number(t.kilos):".7 y .3"===t.tipo&&(s+=.7*Number(t.kilos)))});const r=a/27,n=Math.round(e+r),c=a+i,l=Math.round(c+o+s);return{tarasTotal:n.toString(),kilosTotal:l.toString()}},calcularTotalesPorMedida(){const t=new Map,e=(e,a=!1)=>{e.forEach(e=>{if(!e.medida)return;const o=e.medida,i=a&&e.esMaquila?o.toLowerCase().trim()+"-maq":o.toLowerCase().trim();t.has(i)||t.set(i,{medida:a&&e.esMaquila?o+" Maq":o,total:0});const s=t.get(i),r=Number(e.kilos)||0;e.esTara?"C/H20"===e.tipo?s.total+=30*r*.65:s.total+=30*r:"C/H20"===e.tipo?s.total+=.65*r:"1.35 y .15"===e.tipo?s.total+=1.35*r:a&&".7 y .3"===e.tipo?s.total+=.7*r:s.total+=r})};return e(this.pedidoOtilio),e(this.pedidoCatarro),e(this.pedidoJoselito),e(this.pedidoOzuna,!0),Object.values(this.clientesTemporales).forEach(t=>{t.pedidos&&Array.isArray(t.pedidos)&&e(t.pedidos)}),Array.from(t.values()).map(t=>({medida:t.medida,total:Math.round(t.total)})).sort((t,e)=>{const a=t.medida.replace(" Maq",""),o=e.medida.replace(" Maq","");return a===o?t.medida.includes("Maq")?1:-1:a.localeCompare(o)})},calcularRendimiento(t){const e=parseFloat(this.rendimientos[t.medida]);isNaN(e)&&(this.rendimientos[t.medida]=""),this.$emit("actualizar-rendimientos",this.rendimientos)},toggleDivisor(t,e){this.divisores[t.medida]===e?this.$set(this.divisores,t.medida,null):this.$set(this.divisores,t.medida,e),this.$emit("actualizar-divisores",this.divisores)},esMedidaGranja(t){return/^\d/.test(t)},calcularTotalKilos(){const t=this.calcularTotalesPorMedida(),e=t.reduce((t,e)=>t+e.total,0);return e.toLocaleString()}},watch:{rendimientosGuardados:{handler(t){this.rendimientos={...t}},deep:!0},divisoresGuardados:{handler(t){this.divisores={...t}},deep:!0},completadosGuardados:{handler(t){this.completados={...t},this.aplicarEstadosCompletado()},deep:!0},pedidoOtilio:{deep:!0,handler(t){t.forEach((t,e)=>{void 0!==t.completado&&this.actualizarCompletado("otilio",e,t.completado)})}},pedidoJoselito:{deep:!0,handler(t){t.forEach((t,e)=>{void 0!==t.completado&&this.actualizarCompletado("joselito",e,t.completado)})}},pedidoCatarro:{deep:!0,handler(t){t.forEach((t,e)=>{void 0!==t.completado&&this.actualizarCompletado("catarro",e,t.completado)})}},pedidoOzuna:{deep:!0,handler(t){t.forEach((t,e)=>{void 0!==t.completado&&this.actualizarCompletado("ozuna",e,t.completado)})}}}},Bi=Li,Gi=(a("b9f6"),Object(d["a"])(Bi,qi,zi,!1,null,"0a3c4a70",null)),Hi=Gi.exports,Ri=function(){var t=this,e=t._self._c;return e("div",[e("button",{staticClass:"medidas-btn",on:{click:function(e){t.showModal=!0}}},[e("i",{staticClass:"fas fa-ruler"}),t._v(" Medidas ")]),t.showModal?e("div",{staticClass:"modal-overlay"},[e("div",{staticClass:"modal-content"},[e("div",{staticClass:"modal-header"},[e("h2",[t._v("Gestión de Medidas")]),e("button",{staticClass:"close-btn",on:{click:t.cerrarModal}},[t._v("×")])]),e("div",{staticClass:"add-medida-form"},[e("h3",[t._v("Agregar Nueva Medida")]),e("div",{staticClass:"form-group"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.newMedida.nombre,expression:"newMedida.nombre"}],staticClass:"medida-input",attrs:{type:"text",placeholder:"Nombre de la medida"},domProps:{value:t.newMedida.nombre},on:{input:function(e){e.target.composing||t.$set(t.newMedida,"nombre",e.target.value)}}}),e("button",{staticClass:"add-btn",on:{click:t.agregarMedida}},[t._v("Agregar")])])]),e("div",{staticClass:"medidas-list"},[e("div",{staticClass:"medidas-grid"},t._l(t.medidasOrdenadas,(function(a){return e("div",{key:a.id,staticClass:"medida-card"},[e("span",{staticClass:"medida-nombre"},[t._v(t._s(a.nombre))]),e("button",{staticClass:"delete-btn",attrs:{title:"Eliminar medida"},on:{click:function(e){return t.eliminarMedida(a.id)}}},[t._v(" × ")])])})),0)]),e("div",{staticClass:"modal-footer"},[e("button",{staticClass:"cancel-btn",on:{click:t.cerrarModal}},[t._v("Cerrar")])])])]):t._e()])},Ki=[],Ji={name:"MedidasModal",data(){return{showModal:!1,medidas:[],newMedida:{tipo:"granja",nombre:""}}},computed:{medidasOrdenadas(){const t=this.medidas.filter(t=>"especial"===t.tipo),e=this.medidas.filter(t=>"granja"===t.tipo);return t.sort((t,e)=>t.nombre.localeCompare(e.nombre)),e.sort((t,e)=>{const a=parseInt(t.nombre.split("/")[0]),o=parseInt(e.nombre.split("/")[0]);return a-o}),[...t,...e]}},methods:{async cargarMedidas(){try{const t=Object(et["c"])(P["a"],"medidas"),e=Object(et["l"])(t,Object(et["k"])("nombre")),a=await Object(et["g"])(e);this.medidas=a.docs.map(t=>({id:t.id,...t.data()}))}catch(t){console.error("Error al cargar medidas:",t),alert("Error al cargar las medidas")}},async agregarMedida(){if(this.newMedida.nombre)try{const t=await Object(et["b"])(Object(et["c"])(P["a"],"medidas"),{tipo:this.newMedida.tipo,nombre:this.newMedida.nombre});this.medidas.push({id:t.id,tipo:this.newMedida.tipo,nombre:this.newMedida.nombre}),this.newMedida.nombre=""}catch(t){console.error("Error al agregar medida:",t),alert("Error al guardar la medida")}else alert("Por favor ingrese el nombre de la medida")},async eliminarMedida(t){if(confirm("¿Estás seguro de que deseas eliminar esta medida?"))try{await Object(et["d"])(Object(et["e"])(P["a"],"medidas",t)),this.medidas=this.medidas.filter(e=>e.id!==t)}catch(e){console.error("Error al eliminar medida:",e),alert("Error al eliminar la medida")}},cerrarModal(){this.showModal=!1,this.$emit("medidas-actualizadas",this.medidas)}},mounted(){this.cargarMedidas()}},Ui=Ji,Yi=(a("4786"),Object(d["a"])(Ui,Ri,Ki,!1,null,"60908f5b",null)),Wi=Yi.exports,Qi=function(){var t=this,e=t._self._c;return t.mostrar?e("div",{staticClass:"modal-overlay",on:{click:function(e){return e.target!==e.currentTarget?null:t.cerrarModal.apply(null,arguments)}}},[e("div",{staticClass:"modal-content"},[e("h3",[t._v("Proveedor")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.proveedorLocal,expression:"proveedorLocal"}],staticClass:"input-proveedor",attrs:{type:"text",placeholder:"Nombre del proveedor"},domProps:{value:t.proveedorLocal},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.guardarProveedor.apply(null,arguments)},input:function(e){e.target.composing||(t.proveedorLocal=e.target.value)}}}),e("div",{staticClass:"modal-buttons"},[e("button",{staticClass:"btn-guardar",on:{click:t.guardarProveedor}},[t._v("Guardar")]),e("button",{staticClass:"btn-cancelar",on:{click:t.cerrarModal}},[t._v("Cancelar")])])])]):t._e()},Xi=[],Zi={name:"ProveedorModal",props:{mostrar:{type:Boolean,required:!0},proveedor:{type:String,default:""}},data(){return{proveedorLocal:this.proveedor}},watch:{mostrar(t){t&&(this.proveedorLocal=this.proveedor)}},methods:{cerrarModal(){this.$emit("cerrar")},guardarProveedor(){this.$emit("guardar",this.proveedorLocal),this.cerrarModal()}}},ts=Zi,es=(a("fbdc"),Object(d["a"])(ts,Qi,Xi,!1,null,"69665719",null)),as=es.exports,os=function(){var t=this,e=t._self._c;return t.mostrar?e("div",{staticClass:"modal-overlay"},[e("div",{staticClass:"modal-content"},[e("h3",[t._v("Nuevo Cliente Temporal")]),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"nombreCliente"}},[t._v("Nombre del Cliente:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.nombreCliente,expression:"nombreCliente"}],staticClass:"input-field",attrs:{type:"text",id:"nombreCliente",placeholder:"Ingrese el nombre del cliente"},domProps:{value:t.nombreCliente},on:{input:function(e){e.target.composing||(t.nombreCliente=e.target.value)}}})]),e("div",{staticClass:"buttons-container"},[e("button",{staticClass:"btn-guardar",attrs:{disabled:!t.nombreCliente.trim()},on:{click:t.guardarCliente}},[t._v(" Guardar ")]),e("button",{staticClass:"btn-cancelar",on:{click:function(e){return t.$emit("cerrar")}}},[t._v(" Cancelar ")])])])]):t._e()},is=[],ss={name:"NuevoClienteModal",props:{mostrar:{type:Boolean,required:!0}},data(){return{nombreCliente:""}},methods:{guardarCliente(){this.nombreCliente.trim()&&(this.$emit("guardar",{id:this.nombreCliente.toLowerCase().replace(/\s+/g,"-"),nombre:this.nombreCliente.trim()}),this.nombreCliente="")}}},rs=ss,ns=(a("5617"),Object(d["a"])(rs,os,is,!1,null,"ea897a92",null)),cs=ns.exports,ls={name:"PedidosLimpio",components:{PedidoLimpioImpresion:Hi,MedidasModal:Wi,ProveedorModal:as,NuevoClienteModal:cs},data(){return{fecha:(new Date).toISOString().split("T")[0],pedidoOtilio:[{kilos:null,medida:"",tipo:"",esTara:!0,esProveedor:!1,proveedor:""}],pedidoCatarro:[{kilos:null,medida:"",tipo:"S/H20",esTara:!1,esProveedor:!1,proveedor:""}],pedidoJoselito:[{kilos:null,medida:"",tipo:"",esTara:!1,esProveedor:!1,proveedor:""}],pedidoOzuna:[{kilos:null,medida:"",tipo:"S/H20",esTara:!1,esProveedor:!1,proveedor:"",esMaquila:!0}],clientesTemporales:{},mostrarModalNuevoCliente:!1,mostrarImpresion:!1,mostrarModalProveedor:!1,itemSeleccionado:null,medidas:[],editando:!1,pedidoId:null,clienteActivo:"otilio",clientes:[{id:"otilio",nombre:"Otilio"},{id:"catarro",nombre:"Catarro"},{id:"joselito",nombre:"Joselito"},{id:"ozuna",nombre:"Ozuna"}],itemSeleccionadoNotas:null,rendimientosGuardados:{},divisoresGuardados:{},completadosGuardados:{}}},async created(){await this.cargarMedidas();const{edit:t,id:e,fecha:a}=this.$route.query;"true"===t&&e?(this.editando=!0,this.pedidoId=e,await this.cargarPedido(e)):a&&(this.fecha=a)},computed:{fechaMaxima(){const t=new Date;return t.setMonth(t.getMonth()+3),t.toISOString().split("T")[0]},medidasOrdenadas(){const t=this.medidas.filter(t=>"especial"===t.tipo),e=this.medidas.filter(t=>"granja"===t.tipo);return t.sort((t,e)=>{const a=parseFloat(t.nombre),o=parseFloat(e.nombre);return isNaN(a)||isNaN(o)?t.nombre.localeCompare(e.nombre):a-o}),e.sort((t,e)=>{const a=parseFloat(t.nombre.split("/")[0]),o=parseFloat(e.nombre.split("/")[0]);return isNaN(a)||isNaN(o)?t.nombre.localeCompare(e.nombre):a-o}),[...t,...e]},calculosOtilio(){let t=0,e=0,a=0,o=0;this.pedidoOtilio.forEach(i=>{i.kilos&&(i.esTara?(t+=Number(i.kilos),"C/H20"===i.tipo?a+=30*Number(i.kilos)*.65:o+=30*Number(i.kilos)):"S/H20"===i.tipo?e+=Number(i.kilos):"C/H20"===i.tipo&&(a+=Number(i.kilos)))});const i=e/27,s=Math.round(t+i),r=e+o,n=Math.round(r+a);return{tarasDirectas:t.toFixed(2),tarasPorKilos:i.toFixed(2),tarasTotal:s.toString(),kilosSinH2O:Math.round(r).toString(),kilosConH2O:a.toFixed(2),kilosTotal:n.toString()}},calculosCatarro(){let t=0,e=0,a=0,o=0;this.pedidoCatarro.forEach(i=>{i.kilos&&(i.esTara?(t+=Number(i.kilos),"C/H20"===i.tipo?a+=30*Number(i.kilos)*.65:o+=30*Number(i.kilos)):"S/H20"===i.tipo?e+=Number(i.kilos):"C/H20"===i.tipo&&(a+=Number(i.kilos)))});const i=e/27,s=Math.round(t+i),r=e+o,n=Math.round(r+a);return{tarasDirectas:t.toFixed(2),tarasPorKilos:i.toFixed(2),tarasTotal:s.toString(),kilosSinH2O:Math.round(r).toString(),kilosConH2O:a.toFixed(2),kilosTotal:n.toString()}},calculosJoselito(){let t=0,e=0,a=0,o=0,i=0,s=0;this.pedidoJoselito.forEach(r=>{r.kilos&&(r.esTara?(t+=Number(r.kilos),"C/H20"===r.tipo?a+=30*Number(r.kilos)*.65:"1.35 y .15"===r.tipo?s+=30*Number(r.kilos):o+=30*Number(r.kilos)):"S/H20"===r.tipo?e+=Number(r.kilos):"C/H20"===r.tipo?a+=Number(r.kilos):"1.35 y .15"===r.tipo&&(i+=1.35*Number(r.kilos)))});const r=e/25,n=i/33.75,c=Math.round(t+r+n),l=e+o+s,d=Math.round(l+a+i);return{tarasDirectas:t.toFixed(2),tarasPorKilos:r.toFixed(2),tarasTotal:c.toString(),kilosSinH2O:Math.round(l).toString(),kilosConH2O:a.toFixed(2),kilosTotal:d.toString()}},calculosOzuna(){let t=0,e=0,a=0,o=0,i=0;this.pedidoOzuna.forEach(s=>{s.kilos&&(s.esTara?(t+=Number(s.kilos),"C/H20"===s.tipo?a+=30*Number(s.kilos)*.65:o+=30*Number(s.kilos)):"S/H20"===s.tipo?e+=Number(s.kilos):"C/H20"===s.tipo?a+=Number(s.kilos):".7 y .3"===s.tipo&&(i+=.7*Number(s.kilos)))});const s=e/27,r=Math.round(t+s),n=e+o,c=Math.round(n+a+i);return{tarasDirectas:t.toFixed(2),tarasPorKilos:s.toFixed(2),tarasTotal:r.toString(),kilosSinH2O:Math.round(n).toString(),kilosConH2O:a.toFixed(2),kilos7y3:i.toFixed(2),kilosTotal:c.toString()}},totalesGenerales(){const t=Math.round(Number(this.calculosOtilio.tarasTotal)+Number(this.calculosCatarro.tarasTotal)+Number(this.calculosJoselito.tarasTotal)+Number(this.calculosOzuna.tarasTotal)),e=Math.round(Number(this.calculosOtilio.kilosTotal)+Number(this.calculosCatarro.kilosTotal)+Number(this.calculosJoselito.kilosTotal)+Number(this.calculosOzuna.kilosTotal));return{tarasTotal:t.toString(),kilosTotal:e.toString()}}},methods:{async cargarMedidas(){try{const t=await Object(et["g"])(Object(et["c"])(P["a"],"medidas"));this.medidas=t.docs.map(t=>({id:t.id,...t.data()}))}catch(t){console.error("Error al cargar las medidas:",t)}},async cargarPedido(t){try{const e=Object(et["e"])(P["a"],"pedidos",t),a=await Object(et["f"])(e);if(a.exists()){const t=a.data();this.fecha=t.fecha,this.pedidoOtilio=t.otilio||[],this.pedidoCatarro=t.catarro||[],this.pedidoJoselito=t.joselito||[],this.pedidoOzuna=t.ozuna||[],this.clientesTemporales=t.clientesTemporales||{},this.rendimientosGuardados=t.rendimientos||{},this.divisoresGuardados=t.divisores||{},this.completadosGuardados=t.completados||{}}}catch(e){console.error("Error al cargar el pedido:",e),alert("Error al cargar el pedido")}},agregarFilaOtilio(){this.pedidoOtilio.unshift({kilos:null,medida:"",tipo:"",esTara:!0,esProveedor:!1,proveedor:""})},agregarFilaCatarro(){this.pedidoCatarro.unshift({kilos:null,medida:"",tipo:"S/H20",esTara:!1,esProveedor:!1,proveedor:""})},agregarFilaJoselito(){this.pedidoJoselito.unshift({kilos:null,medida:"",tipo:"",esTara:!1,esProveedor:!1,proveedor:""})},agregarFilaOzuna(){this.pedidoOzuna.unshift({kilos:null,medida:"",tipo:"S/H20",esTara:!1,esProveedor:!1,proveedor:"",esMaquila:!0})},async guardarPedido(){try{const t={fecha:this.fecha,tipo:"limpio",otilio:this.pedidoOtilio,catarro:this.pedidoCatarro,joselito:this.pedidoJoselito,ozuna:this.pedidoOzuna,clientesTemporales:this.clientesTemporales,rendimientos:this.rendimientosGuardados,divisores:this.divisoresGuardados,completados:this.completadosGuardados,createdAt:et["a"].now()};this.editando&&this.pedidoId?await Object(et["o"])(Object(et["e"])(P["a"],"pedidos",this.pedidoId),t):await Object(et["b"])(Object(et["c"])(P["a"],"pedidos"),t),this.$router.push("/procesos/pedidos")}catch(t){console.error("Error al guardar el pedido:",t),alert("Error al guardar el pedido")}},async mostrarVistaImpresion(){try{const t={fecha:this.fecha,otilio:this.pedidoOtilio,catarro:this.pedidoCatarro,joselito:this.pedidoJoselito,ozuna:this.pedidoOzuna,clientesTemporales:this.clientesTemporales,rendimientos:this.rendimientosGuardados,divisores:this.divisoresGuardados,tipo:"limpio",createdAt:this.editando?et["a"].fromDate(new Date(this.fecha)):et["a"].now()};this.editando&&this.pedidoId?await Object(et["o"])(Object(et["e"])(P["a"],"pedidos",this.pedidoId),t):await Object(et["b"])(Object(et["c"])(P["a"],"pedidos"),t),this.mostrarImpresion=!0}catch(t){console.error("Error al guardar el pedido:",t)}},actualizarMedidas(t){this.medidas=t},eliminarPedidoOtilio(t){this.pedidoOtilio.splice(t,1),0===this.pedidoOtilio.length&&this.agregarFilaOtilio()},eliminarPedidoCatarro(t){this.pedidoCatarro.splice(t,1),0===this.pedidoCatarro.length&&this.agregarFilaCatarro()},eliminarPedidoJoselito(t){this.pedidoJoselito.splice(t,1),0===this.pedidoJoselito.length&&this.agregarFilaJoselito()},eliminarPedidoOzuna(t){this.pedidoOzuna.splice(t,1),0===this.pedidoOzuna.length&&this.agregarFilaOzuna()},abrirModalProveedor(t){this.itemSeleccionado=t,this.mostrarModalProveedor=!0},guardarProveedor(t){this.itemSeleccionado&&(this.itemSeleccionado.proveedor=t.trim(),this.itemSeleccionado.esProveedor=""!==t.trim()),this.mostrarModalProveedor=!1,this.itemSeleccionado=null},manejarCheckboxProveedor(t){t.esProveedor?this.abrirModalProveedor(t):t.proveedor=""},abrirMenuNotas(t){this.itemSeleccionadoNotas===t?this.itemSeleccionadoNotas=null:this.itemSeleccionadoNotas=t},seleccionarNota(t,e){t.nota=e,this.itemSeleccionadoNotas=null},ordenarPedidosPorMedida(t){const e=[...t],a=e.filter(t=>t.medida&&t.tipo),o=e.filter(t=>!t.medida||!t.tipo);return a.sort((t,e)=>t.medida===e.medida?t.tipo.localeCompare(e.tipo):t.medida.localeCompare(e.medida)),[...o,...a]},isClienteTemporal(t){return!["otilio","catarro","joselito","ozuna"].includes(t)},calcularTotalesTemporales(t){var e;if(null===(e=this.clientesTemporales[t])||void 0===e||!e.pedidos)return{tarasTotal:"0",kilosTotal:"0"};let a=0,o=0,i=0,s=0;this.clientesTemporales[t].pedidos.forEach(t=>{t.kilos&&(t.esTara?(a+=Number(t.kilos),"C/H20"===t.tipo?i+=30*Number(t.kilos)*.65:s+=30*Number(t.kilos)):"S/H20"===t.tipo?o+=Number(t.kilos):"C/H20"===t.tipo&&(i+=Number(t.kilos)))});const r=o/27,n=Math.round(a+r),c=o+s,l=Math.round(c+i);return{tarasTotal:n.toString(),kilosTotal:l.toString()}},agregarClienteTemporal(t){const e={id:t.id,nombre:t.nombre,pedidos:[{kilos:null,medida:"",tipo:"",esTara:!1,esProveedor:!1,proveedor:""}]};this.$set(this.clientesTemporales,t.id,e),this.clienteActivo=t.id,this.mostrarModalNuevoCliente=!1},agregarFilaTemporal(t){this.clientesTemporales[t]&&this.clientesTemporales[t].pedidos.unshift({kilos:null,medida:"",tipo:"",esTara:!1,esProveedor:!1,proveedor:""})},eliminarPedidoTemporal(t,e){this.clientesTemporales[t]&&(this.clientesTemporales[t].pedidos.splice(e,1),0===this.clientesTemporales[t].pedidos.length&&(this.$delete(this.clientesTemporales,t),this.clienteActivo===t&&(this.clienteActivo="otilio")))},actualizarRendimientos(t){this.rendimientosGuardados={...t},this.editando&&this.pedidoId&&Object(et["o"])(Object(et["e"])(P["a"],"pedidos",this.pedidoId),{rendimientos:this.rendimientosGuardados}).catch(t=>{console.error("Error al actualizar rendimientos:",t)})},actualizarDivisores(t){this.divisoresGuardados={...t},this.editando&&this.pedidoId&&Object(et["o"])(Object(et["e"])(P["a"],"pedidos",this.pedidoId),{divisores:this.divisoresGuardados}).catch(t=>{console.error("Error al actualizar divisores:",t)})},actualizarCompletados(t){if(this.completadosGuardados=t,this.editando&&this.pedidoId)Object(et["o"])(Object(et["e"])(P["a"],"pedidos",this.pedidoId),{completados:t}).catch(t=>{console.error("Error al actualizar estados completados:",t)});else{const e={fecha:this.fecha,tipo:"limpio",otilio:this.pedidoOtilio,catarro:this.pedidoCatarro,joselito:this.pedidoJoselito,ozuna:this.pedidoOzuna,clientesTemporales:this.clientesTemporales,rendimientos:this.rendimientosGuardados,divisores:this.divisoresGuardados,completados:t,createdAt:et["a"].now()};Object(et["b"])(Object(et["c"])(P["a"],"pedidos"),e).then(t=>{this.editando=!0,this.pedidoId=t.id}).catch(t=>{console.error("Error al crear nuevo pedido:",t)})}}},watch:{pedidoOtilio:{deep:!0,handler(t){const e=t.some(t=>t.medida&&t.tipo);if(e){const e=this.ordenarPedidosPorMedida(t);JSON.stringify(e)!==JSON.stringify(t)&&this.$nextTick(()=>{this.pedidoOtilio=e})}}},pedidoCatarro:{deep:!0,handler(t){const e=t.some(t=>t.medida&&t.tipo);if(e){const e=this.ordenarPedidosPorMedida(t);JSON.stringify(e)!==JSON.stringify(t)&&this.$nextTick(()=>{this.pedidoCatarro=e})}}},pedidoJoselito:{deep:!0,handler(t){const e=t.some(t=>t.medida&&t.tipo);if(e){const e=this.ordenarPedidosPorMedida(t);JSON.stringify(e)!==JSON.stringify(t)&&this.$nextTick(()=>{this.pedidoJoselito=e})}}},pedidoOzuna:{deep:!0,handler(t){const e=t.some(t=>t.medida&&t.tipo);if(e){const e=this.ordenarPedidosPorMedida(t);JSON.stringify(e)!==JSON.stringify(t)&&this.$nextTick(()=>{this.pedidoOzuna=e})}}}}},ds=ls,us=(a("680c"),Object(d["a"])(ds,Ii,Fi,!1,null,"e5190094",null)),ms=us.exports,ps={name:"Pedidos",components:{PedidosCrudo:$i,PedidosLimpio:ms},data(){return{tipoPedido:"crudo"}}},hs=ps,vs=(a("d248"),Object(d["a"])(hs,yi,wi,!1,null,"6395483f",null)),bs=(vs.exports,function(){var t=this,e=t._self._c;return e("div",{staticClass:"impresion-container"},[e("h2",[t._v("Vista previa de impresión - Pedido de Camarón Crudo")]),e("div",{staticClass:"buttons-container"},[e("button",{staticClass:"btn-generar",on:{click:t.generarPDF}},[e("span",{staticClass:"icon"},[t._v("📄")]),t._v(" Generar PDF ")]),e("button",{staticClass:"btn-volver",on:{click:function(e){return t.$router.push("/procesos/pedidos")}}},[t._v(" Volver ")])]),e("div",{staticClass:"pdf-preview",attrs:{id:"pdfPreview"}},[e("h3",[t._v("Pedido de Crudos - "+t._s(t.fecha))]),e("table",{staticClass:"preview-table"},[e("thead",[e("tr",[e("th",[t._v("Cliente")]),t._l(t.obtenerColumnasConDatos(),(function(a){return e("th",{key:a},[t._v(" "+t._s(a)+" ")])}))],2)]),e("tbody",[t._l(t.obtenerClientesConDatos(),(function(a){return e("tr",{key:a},[e("td",{style:{backgroundColor:t.obtenerColorCliente(a),color:t.obtenerColorTextoCliente(a)}},[t._v(" "+t._s(a)+" ")]),t._l(t.obtenerColumnasConDatos(),(function(o){return e("td",{key:o},[t._v(" "+t._s(t.pedidos[a][o.toLowerCase()]||"")+" ")])}))],2)})),e("tr",{staticClass:"fila-totales"},[t._m(0),t._l(t.obtenerColumnasConDatos(),(function(a){return e("td",{key:a+"-total"},[t._v(" "+t._s(t.calcularTotalColumna(a))+" ")])}))],2)],2)])])])}),fs=[function(){var t=this,e=t._self._c;return e("td",[e("strong",[t._v("Total")])])}];const gs={Roboto:{normal:"https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.66/fonts/Roboto/Roboto-Regular.ttf",bold:"https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.66/fonts/Roboto/Roboto-Medium.ttf",italics:"https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.66/fonts/Roboto/Roboto-Italic.ttf",bolditalics:"https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.66/fonts/Roboto/Roboto-MediumItalic.ttf"}};$a.a.fonts=gs;var Cs={name:"PedidoCrudosImpresion",props:{fecha:{type:String,required:!0},pedidos:{type:Object,required:!0},columnas:{type:Array,required:!0}},methods:{obtenerClientesConDatos(){return Object.keys(this.pedidos).filter(t=>Object.values(this.pedidos[t]).some(t=>null!==t&&""!==t))},obtenerColumnasConDatos(){return this.columnas.filter(t=>{const e=t.toLowerCase();return this.obtenerClientesConDatos().some(t=>null!==this.pedidos[t][e]&&""!==this.pedidos[t][e])})},obtenerColorCliente(t){const e={"8a":"#3498db",catarro:"#e74c3c",otilio:"#f1c40f",ozuna:"#2ecc71"};return e[t.toLowerCase()]||"#000000"},obtenerColorTextoCliente(t){return"otilio"===t.toLowerCase()?"#000000":"#FFFFFF"},obtenerDiaSemana(t){const e=["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"],[a,o,i]=t.split("-").map(Number),s=new Date(a,o-1,i);return e[s.getDay()]},calcularTotalColumna(t){const e=t.toLowerCase();return Object.keys(this.pedidos).reduce((t,a)=>{const o=parseFloat(this.pedidos[a][e])||0;return t+o},0)},generarPDF(){const t=this.obtenerClientesConDatos(),e=this.obtenerColumnasConDatos(),a=this.obtenerDiaSemana(this.fecha),o=t.map(t=>{const a=[t];return e.forEach(e=>{const o=this.pedidos[t][e.toLowerCase()]||"";a.push({text:o.toString(),alignment:"center"})}),a}),i=["Cliente",...e].map(t=>({text:t,alignment:"center"})),s=i.length>5?"100%":"auto",r=i.length>5?28:34,n={};t.forEach((t,e)=>{n[e]={fillColor:this.obtenerColorCliente(t),color:this.obtenerColorTextoCliente(t),bold:!0}});const c=e.map(t=>{const e=this.calcularTotalColumna(t);return{text:e.toString(),alignment:"center",bold:!0,italics:!0,fillColor:"#f8f9fa"}});o.push([{text:"Total",bold:!0,fillColor:"#f8f9fa"},...c]);const l={pageOrientation:"landscape",pageMargins:[40,40,40,40],content:[{text:`Pedido de Crudos - ${a} ${this.fecha}`,style:"header"},{table:{headerRows:1,widths:Array(i.length).fill("*"),body:[i,...o]},layout:{fillColor:function(t,e,a){var o;return 0===t?"#f2f2f2":0===a?null===(o=n[t-1])||void 0===o?void 0:o.fillColor:null},defaultBorder:!0,hLineWidth:function(t,e){return t===e.table.body.length-1||t===e.table.body.length?2:1},vLineWidth:function(t,e){return e.table.body.length-1===e.row?2:1},hLineColor:function(t){return"#000000"},vLineColor:function(t){return"#000000"},paddingLeft:function(t){return 10},paddingRight:function(t){return 10},paddingTop:function(t){return 10},paddingBottom:function(t){return 10}},width:s}],styles:{header:{fontSize:34,bold:!0,margin:[0,0,0,20],alignment:"center"}},defaultStyle:{fontSize:r,bold:!0,font:"Roboto"}};$a.a.createPdf(l).download("Ped-crudos-"+this.fecha+".pdf")}}},_s=Cs,ys=(a("b0a5"),Object(d["a"])(_s,bs,fs,!1,null,"be3b5f26",null)),ws=ys.exports,ks=function(){var t=this,e=t._self._c;return e("div",{staticClass:"bitacoras-container"},[e("h1",{staticClass:"page-title"},[t._v("Bitácoras de Mantenimiento - Cuartos Fríos")]),e("div",{staticClass:"filters-container"},[e("div",{staticClass:"filter-group"},[e("label",{attrs:{for:"cuarto-select"}},[t._v("Cuarto Frío:")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.filtrosCuarto,expression:"filtrosCuarto"}],staticClass:"form-control",attrs:{id:"cuarto-select"},on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.filtrosCuarto=e.target.multiple?a:a[0]}}},[e("option",{attrs:{value:""}},[t._v("Todos los cuartos")]),e("option",{attrs:{value:"1"}},[t._v("Cuarto Frío #1")]),e("option",{attrs:{value:"2"}},[t._v("Cuarto Frío #2")]),e("option",{attrs:{value:"3"}},[t._v("Cuarto Frío #3")]),e("option",{attrs:{value:"4"}},[t._v("Cuarto Frío #4")]),e("option",{attrs:{value:"5"}},[t._v("Cuarto Frío Don Chuy")])])]),e("div",{staticClass:"filter-group"},[e("label",{attrs:{for:"fecha-desde"}},[t._v("Desde:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.filtroFechaDesde,expression:"filtroFechaDesde"}],staticClass:"form-control",attrs:{type:"date",id:"fecha-desde"},domProps:{value:t.filtroFechaDesde},on:{input:function(e){e.target.composing||(t.filtroFechaDesde=e.target.value)}}})]),e("div",{staticClass:"filter-group"},[e("label",{attrs:{for:"fecha-hasta"}},[t._v("Hasta:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.filtroFechaHasta,expression:"filtroFechaHasta"}],staticClass:"form-control",attrs:{type:"date",id:"fecha-hasta"},domProps:{value:t.filtroFechaHasta},on:{input:function(e){e.target.composing||(t.filtroFechaHasta=e.target.value)}}})]),e("button",{staticClass:"btn-filtrar",on:{click:t.aplicarFiltros}},[e("i",{staticClass:"fas fa-filter"}),t._v(" Filtrar ")])]),e("div",{staticClass:"actions-row"},[e("button",{staticClass:"btn-nueva-bitacora",on:{click:function(e){t.mostrarFormulario=!0}}},[e("i",{staticClass:"fas fa-plus"}),t._v(" Nueva Bitácora ")])]),e("div",{staticClass:"table-responsive"},[e("table",{staticClass:"bitacoras-table"},[t._m(0),e("tbody",[t.cargando?e("tr",[e("td",{staticClass:"loading-data",attrs:{colspan:"7"}},[t._v("Cargando bitácoras...")])]):0===t.bitacoras.length?e("tr",[e("td",{staticClass:"no-data",attrs:{colspan:"7"}},[t._v("No hay bitácoras registradas")])]):t._e(),t._l(t.bitacorasFiltradas,(function(a,o){return e("tr",{key:a.id},[e("td",[t._v(t._s(t.formatearFecha(a.fecha)))]),e("td",[t._v(t._s(t.formatearNombreCuarto(a.cuartoId)))]),e("td",[t._v(t._s(a.temperatura)+"°C")]),e("td",[t._v(t._s(a.tecnico))]),e("td",[t._v(t._s(a.tipoMantenimiento))]),e("td",{class:"estado-"+a.estado.toLowerCase()},[t._v(t._s(a.estado))]),e("td",{staticClass:"acciones"},[e("button",{staticClass:"btn-accion editar",on:{click:function(e){return t.editarBitacora(a)}}},[e("i",{staticClass:"fas fa-edit"})]),e("button",{staticClass:"btn-accion ver",on:{click:function(e){return t.verDetalles(a)}}},[e("i",{staticClass:"fas fa-eye"})]),e("button",{staticClass:"btn-accion eliminar",on:{click:function(e){return t.confirmarEliminarBitacora(a)}}},[e("i",{staticClass:"fas fa-trash"})])])])}))],2)])]),t.mostrarFormulario?e("div",{staticClass:"modal-overlay"},[e("div",{staticClass:"modal-content"},[e("div",{staticClass:"modal-header"},[e("h2",[t._v(t._s(t.modoEdicion?"Editar Bitácora":"Nueva Bitácora"))]),e("button",{staticClass:"btn-cerrar",on:{click:t.cerrarFormulario}},[e("i",{staticClass:"fas fa-times"})])]),e("div",{staticClass:"modal-body"},[e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"cuarto"}},[t._v("Cuarto Frío:")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.bitacoraActual.cuartoId,expression:"bitacoraActual.cuartoId"}],staticClass:"form-control",attrs:{id:"cuarto",required:""},on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(t.bitacoraActual,"cuartoId",e.target.multiple?a:a[0])}}},[e("option",{attrs:{value:"",disabled:""}},[t._v("Seleccione un cuarto frío")]),e("option",{attrs:{value:"1"}},[t._v("Cuarto Frío #1")]),e("option",{attrs:{value:"2"}},[t._v("Cuarto Frío #2")]),e("option",{attrs:{value:"3"}},[t._v("Cuarto Frío #3")]),e("option",{attrs:{value:"4"}},[t._v("Cuarto Frío #4")]),e("option",{attrs:{value:"5"}},[t._v("Cuarto Frío Don Chuy")])])]),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"fecha"}},[t._v("Fecha:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.bitacoraActual.fecha,expression:"bitacoraActual.fecha"}],staticClass:"form-control",attrs:{type:"date",id:"fecha",required:""},domProps:{value:t.bitacoraActual.fecha},on:{input:function(e){e.target.composing||t.$set(t.bitacoraActual,"fecha",e.target.value)}}})]),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"temperatura"}},[t._v("Temperatura (°C):")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.bitacoraActual.temperatura,expression:"bitacoraActual.temperatura"}],staticClass:"form-control",attrs:{type:"number",id:"temperatura",step:"0.1",required:""},domProps:{value:t.bitacoraActual.temperatura},on:{input:function(e){e.target.composing||t.$set(t.bitacoraActual,"temperatura",e.target.value)}}})]),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"tecnico"}},[t._v("Técnico:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.bitacoraActual.tecnico,expression:"bitacoraActual.tecnico"}],staticClass:"form-control",attrs:{type:"text",id:"tecnico",required:""},domProps:{value:t.bitacoraActual.tecnico},on:{input:function(e){e.target.composing||t.$set(t.bitacoraActual,"tecnico",e.target.value)}}})]),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"tipo-mantenimiento"}},[t._v("Tipo de Mantenimiento:")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.bitacoraActual.tipoMantenimiento,expression:"bitacoraActual.tipoMantenimiento"}],staticClass:"form-control",attrs:{id:"tipo-mantenimiento",required:""},on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(t.bitacoraActual,"tipoMantenimiento",e.target.multiple?a:a[0])}}},[e("option",{attrs:{value:"",disabled:""}},[t._v("Seleccione tipo")]),e("option",{attrs:{value:"Preventivo"}},[t._v("Preventivo")]),e("option",{attrs:{value:"Correctivo"}},[t._v("Correctivo")]),e("option",{attrs:{value:"Revisión"}},[t._v("Revisión")])])]),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"estado"}},[t._v("Estado:")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.bitacoraActual.estado,expression:"bitacoraActual.estado"}],staticClass:"form-control",attrs:{id:"estado",required:""},on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(t.bitacoraActual,"estado",e.target.multiple?a:a[0])}}},[e("option",{attrs:{value:"",disabled:""}},[t._v("Seleccione estado")]),e("option",{attrs:{value:"Óptimo"}},[t._v("Óptimo")]),e("option",{attrs:{value:"Regular"}},[t._v("Regular")]),e("option",{attrs:{value:"Requiere Atención"}},[t._v("Requiere Atención")]),e("option",{attrs:{value:"Crítico"}},[t._v("Crítico")])])]),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"observaciones"}},[t._v("Observaciones:")]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.bitacoraActual.observaciones,expression:"bitacoraActual.observaciones"}],staticClass:"form-control",attrs:{id:"observaciones",rows:"4"},domProps:{value:t.bitacoraActual.observaciones},on:{input:function(e){e.target.composing||t.$set(t.bitacoraActual,"observaciones",e.target.value)}}})]),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"acciones"}},[t._v("Acciones Realizadas:")]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.bitacoraActual.accionesRealizadas,expression:"bitacoraActual.accionesRealizadas"}],staticClass:"form-control",attrs:{id:"acciones",rows:"4"},domProps:{value:t.bitacoraActual.accionesRealizadas},on:{input:function(e){e.target.composing||t.$set(t.bitacoraActual,"accionesRealizadas",e.target.value)}}})])]),e("div",{staticClass:"modal-footer"},[e("button",{staticClass:"btn-cancelar",on:{click:t.cerrarFormulario}},[t._v("Cancelar")]),e("button",{staticClass:"btn-guardar",attrs:{disabled:t.guardando},on:{click:t.guardarBitacora}},[t._v(" "+t._s(t.guardando?"Guardando...":"Guardar")+" ")])])])]):t._e(),t.mostrarDetalles?e("div",{staticClass:"modal-overlay"},[e("div",{staticClass:"modal-content"},[e("div",{staticClass:"modal-header"},[e("h2",[t._v("Detalles de Bitácora")]),e("button",{staticClass:"btn-cerrar",on:{click:function(e){t.mostrarDetalles=!1}}},[e("i",{staticClass:"fas fa-times"})])]),e("div",{staticClass:"modal-body detalles"},[e("div",{staticClass:"detalle-grupo"},[e("h3",[t._v("Información General")]),e("p",[e("strong",[t._v("Cuarto Frío:")]),t._v(" "+t._s(t.formatearNombreCuarto(t.bitacoraDetalle.cuartoId)))]),e("p",[e("strong",[t._v("Fecha:")]),t._v(" "+t._s(t.formatearFecha(t.bitacoraDetalle.fecha)))]),e("p",[e("strong",[t._v("Temperatura:")]),t._v(" "+t._s(t.bitacoraDetalle.temperatura)+"°C")]),e("p",[e("strong",[t._v("Técnico:")]),t._v(" "+t._s(t.bitacoraDetalle.tecnico))])]),e("div",{staticClass:"detalle-grupo"},[e("h3",[t._v("Mantenimiento")]),e("p",[e("strong",[t._v("Tipo:")]),t._v(" "+t._s(t.bitacoraDetalle.tipoMantenimiento))]),e("p",[e("strong",[t._v("Estado:")]),t._v(" "),e("span",{class:"estado-tag estado-"+t.bitacoraDetalle.estado.toLowerCase()},[t._v(t._s(t.bitacoraDetalle.estado))])])]),e("div",{staticClass:"detalle-grupo"},[e("h3",[t._v("Observaciones")]),e("p",{staticClass:"texto-largo"},[t._v(t._s(t.bitacoraDetalle.observaciones||"Sin observaciones"))])]),e("div",{staticClass:"detalle-grupo"},[e("h3",[t._v("Acciones Realizadas")]),e("p",{staticClass:"texto-largo"},[t._v(t._s(t.bitacoraDetalle.accionesRealizadas||"Sin acciones registradas"))])])]),e("div",{staticClass:"modal-footer"},[e("button",{staticClass:"btn-cerrar-detalles",on:{click:function(e){t.mostrarDetalles=!1}}},[t._v("Cerrar")]),e("button",{staticClass:"btn-editar-detalles",on:{click:t.editarBitacoraDesdeDetalles}},[t._v("Editar")])])])]):t._e(),t.mostrarConfirmacionEliminar?e("div",{staticClass:"modal-overlay"},[e("div",{staticClass:"modal-content modal-confirmacion"},[e("div",{staticClass:"modal-header"},[e("h2",[t._v("Confirmar Eliminación")]),e("button",{staticClass:"btn-cerrar",on:{click:function(e){t.mostrarConfirmacionEliminar=!1}}},[e("i",{staticClass:"fas fa-times"})])]),e("div",{staticClass:"modal-body"},[e("p",{staticClass:"mensaje-confirmacion"},[t._v(" ¿Está seguro que desea eliminar la bitácora del "+t._s(t.formatearFecha(t.bitacoraEliminar.fecha))+" para el "+t._s(t.formatearNombreCuarto(t.bitacoraEliminar.cuartoId))+"? ")]),e("p",{staticClass:"advertencia"},[t._v("Esta acción no se puede deshacer.")])]),e("div",{staticClass:"modal-footer"},[e("button",{staticClass:"btn-cancelar",on:{click:function(e){t.mostrarConfirmacionEliminar=!1}}},[t._v("Cancelar")]),e("button",{staticClass:"btn-eliminar",attrs:{disabled:t.eliminando},on:{click:t.eliminarBitacora}},[t._v(" "+t._s(t.eliminando?"Eliminando...":"Eliminar")+" ")])])])]):t._e()])},As=[function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",[t._v("Fecha")]),e("th",[t._v("Cuarto Frío")]),e("th",[t._v("Temperatura")]),e("th",[t._v("Técnico")]),e("th",[t._v("Tipo de Mantenimiento")]),e("th",[t._v("Estado")]),e("th",[t._v("Acciones")])])])}],Ps={name:"Bitacoras",data(){return{bitacoras:[],mostrarFormulario:!1,mostrarDetalles:!1,mostrarConfirmacionEliminar:!1,modoEdicion:!1,bitacoraActual:this.inicializarBitacora(),bitacoraDetalle:{},bitacoraEliminar:{},filtrosCuarto:"",filtroFechaDesde:"",filtroFechaHasta:"",cargando:!0,guardando:!1,eliminando:!1}},computed:{bitacorasFiltradas(){let t=[...this.bitacoras];return this.filtrosCuarto&&(t=t.filter(t=>t.cuartoId.toString()===this.filtrosCuarto)),this.filtroFechaDesde&&(t=t.filter(t=>new Date(t.fecha)>=new Date(this.filtroFechaDesde))),this.filtroFechaHasta&&(t=t.filter(t=>new Date(t.fecha)<=new Date(this.filtroFechaHasta))),t.sort((t,e)=>new Date(e.fecha)-new Date(t.fecha))}},created(){this.cargarBitacoras()},methods:{inicializarBitacora(){return{id:null,cuartoId:"",fecha:(new Date).toISOString().substr(0,10),temperatura:"",tecnico:"",tipoMantenimiento:"",estado:"",observaciones:"",accionesRealizadas:"",createdAt:null,updatedAt:null}},async cargarBitacoras(){this.cargando=!0;try{const t=Object(et["c"])(P["a"],"bitacoras"),e=Object(et["l"])(t,Object(et["k"])("fecha","desc")),a=await Object(et["g"])(e);this.bitacoras=a.docs.map(t=>{const e=t.data(),a=t.id.toString();return console.log("Cargando bitácora con ID: "+a),{id:a,cuartoId:e.cuartoId||"",fecha:e.fecha||(new Date).toISOString().substr(0,10),temperatura:e.temperatura||0,tecnico:e.tecnico||"",tipoMantenimiento:e.tipoMantenimiento||"",estado:e.estado||"",observaciones:e.observaciones||"",accionesRealizadas:e.accionesRealizadas||"",createdAt:e.createdAt||null,updatedAt:e.updatedAt||null}}),console.log(`Se cargaron ${this.bitacoras.length} bitácoras`)}catch(t){console.error("Error al cargar bitácoras:",t),alert("Error al cargar las bitácoras: "+(t.message||"Error desconocido"))}finally{this.cargando=!1}},formatearFecha(t){if(!t)return"";const e={year:"numeric",month:"long",day:"numeric"};return new Date(t).toLocaleDateString("es-ES",e)},formatearNombreCuarto(t){return t?"5"===t?"Cuarto Frío Don Chuy":"Cuarto Frío #"+t:""},aplicarFiltros(){},editarBitacora(t){this.modoEdicion=!0,this.bitacoraActual={...t},this.mostrarFormulario=!0},verDetalles(t){this.bitacoraDetalle={...t},this.mostrarDetalles=!0},cerrarFormulario(){this.mostrarFormulario=!1,this.modoEdicion=!1,this.bitacoraActual=this.inicializarBitacora(),this.guardando=!1},async guardarBitacora(){if(this.validarFormulario()){this.guardando=!0;try{const t={...this.bitacoraActual,cuartoId:this.bitacoraActual.cuartoId.toString(),temperatura:parseFloat(this.bitacoraActual.temperatura)||0,tecnico:this.bitacoraActual.tecnico.trim(),tipoMantenimiento:this.bitacoraActual.tipoMantenimiento,estado:this.bitacoraActual.estado,observaciones:this.bitacoraActual.observaciones||"",accionesRealizadas:this.bitacoraActual.accionesRealizadas||"",updatedAt:Object(et["m"])()};if(this.modoEdicion){if(!t.id)throw new Error("ID de bitácora no válido para actualización");console.log("Actualizando bitácora con ID:",t.id);const{id:e,...a}=t,o=Object(et["e"])(P["a"],"bitacoras",e.toString());await Object(et["o"])(o,a);const i=this.bitacoras.findIndex(t=>t.id===e);-1!==i&&this.bitacoras.splice(i,1,t),console.log("Bitácora actualizada con éxito")}else{t.createdAt=Object(et["m"])(),console.log("Creando nueva bitácora");const e=await Object(et["b"])(Object(et["c"])(P["a"],"bitacoras"),t),a={...t,id:e.id.toString()};console.log("Nueva bitácora creada con ID:",a.id),this.bitacoras.unshift(a)}this.cerrarFormulario(),alert(this.modoEdicion?"Bitácora actualizada con éxito":"Bitácora creada con éxito")}catch(t){console.error("Error al guardar bitácora:",t),alert("Error al guardar la bitácora: "+(t.message||"Error desconocido"))}finally{this.guardando=!1}}},validarFormulario(){return!!(this.bitacoraActual.cuartoId&&this.bitacoraActual.fecha&&""!==this.bitacoraActual.temperatura&&this.bitacoraActual.tecnico&&this.bitacoraActual.tipoMantenimiento&&this.bitacoraActual.estado)||(alert("Por favor complete todos los campos obligatorios"),!1)},editarBitacoraDesdeDetalles(){this.editarBitacora(this.bitacoraDetalle),this.mostrarDetalles=!1},confirmarEliminarBitacora(t){if(!t||!t.id)return console.error("Intento de eliminar una bitácora sin ID válido:",t),void alert("No se puede eliminar esta bitácora porque no tiene un ID válido");console.log("Preparando eliminación de bitácora con ID:",t.id),this.bitacoraEliminar={...t},this.mostrarConfirmacionEliminar=!0},async eliminarBitacora(){this.eliminando=!0;try{if(!this.bitacoraEliminar||!this.bitacoraEliminar.id)throw new Error("ID de bitácora no válido");const t=this.bitacoraEliminar.id.toString();console.log("Intentando eliminar bitácora con ID:",t);const e=Object(et["e"])(P["a"],"bitacoras",t);await Object(et["d"])(e);const a=this.bitacoras.findIndex(e=>e.id===t);-1!==a&&this.bitacoras.splice(a,1),this.mostrarConfirmacionEliminar=!1,alert("Bitácora eliminada con éxito")}catch(t){console.error("Error al eliminar bitácora:",t),alert("Error al eliminar la bitácora: "+(t.message||"Error desconocido"))}finally{this.eliminando=!1,this.bitacoraEliminar={}}}}},xs=Ps,Ss=(a("05e4"),Object(d["a"])(xs,ks,As,!1,null,"fc24882a",null)),Ts=Ss.exports;o["default"].use(k["a"]);const Os=[{path:"/login",name:"Login",component:Ho},{path:"/noteMenu",name:"NoteMenu",component:st},{path:"/",name:"home",component:X},{path:"/sale-note/:noteId?",name:"SaleNote",component:()=>Promise.resolve().then(a.bind(null,"98cf"))},{path:"/add-client",name:"AddClient",component:nt["a"]},{path:"/editar-nota/:noteId",name:"editar-nota",component:rt["default"],props:!0},{path:"/sacadas",name:"SacadasMenu",component:Tt},{path:"/sacadas/new",name:"NuevaSacada",component:bt},{path:"/sacadas/:id",name:"DetalleSacada",component:bt,props:!0},{path:"/gestionar-productos",name:"GestionarProductos",component:jt},{path:"/gestionar-medidas",name:"GestionarMedidas",component:Vt},{path:"/gestionar-proveedores",name:"GestionarProveedores",component:Kt},{path:"/existencias",name:"Existencias",component:Xt},{path:"/cuentas-mexico",name:"CuentasMexico",component:de},{path:"/cuentas-ozuna",name:"ozuna-cuentas-menu",component:be},{path:"/cuentas-ozuna/nueva",name:"nueva-cuenta-ozuna",component:we},{path:"/cuentas-ozuna/:id",name:"ver-cuenta-ozuna",component:we},{path:"/cuentas-ozuna/:id?",name:"CuentasOzuna",component:we},{path:"/cuentas-catarro",name:"catarro-cuentas-menu",component:Ve},{path:"/cuentas-catarro/nueva",name:"nueva-cuenta-catarro",component:Ke},{path:"/cuentas-catarro/:id",name:"ver-cuenta-catarro",component:Ke},{path:"/cuentas-catarro/:id?",name:"CuentasCatarro",component:Ke},{path:"/cuentas-joselito",name:"joselito-cuentas-menu",component:Xe},{path:"/cuentas-joselito/nueva",name:"nueva-cuenta-joselito",component:ia},{path:"/cuentas-joselito/:id",name:"ver-cuenta-joselito",component:ia},{path:"/cuentas-joselito/:id?",name:"CuentasJoselito",component:ia},{path:"/embarques-menu",name:"EmbarquesMenu",component:ba},{path:"/ventas-ganancias-catarro",name:"VentasYGananciasCatarro",component:ka},{path:"/ventas-ganancias-joselito",name:"VentasYGananciasJoselito",component:Oa},{path:"/embarques",name:"ListaEmbarques",component:ma},{path:"/embarques/:id",name:"EditarEmbarque",component:Oo},{path:"/nuevo-embarque",name:"NuevoEmbarque",component:Oo},{path:"/embarques/:id/rendimientos",name:"Rendimientos",component:Mo["default"],props:!0},{path:"/cuenta-fletes",name:"CuentaFletes",component:qo},{path:"/cuentas-otilio",name:"otilio-cuentas-menu",component:Wo},{path:"/cuentas-otilio/nueva",name:"nueva-cuenta-otilio",component:ai},{path:"/cuentas-otilio/:id",name:"ver-cuenta-otilio",component:ai},{path:"/cuentas-otilio/:id?",name:"CuentasOtilio",component:ai},{path:"/procesos",name:"ProcesosMenu",component:ci},{path:"/procesos/preparacion",name:"Preparacion",component:hi},{path:"/procesos/pedidos",name:"PedidosMenu",component:_i},{path:"/procesos/pedidos/nuevo",name:"NuevoPedido",component:ms},{path:"/procesos/pedidos/crudo",name:"PedidosCrudo",component:$i},{path:"/procesos/pedidos/limpio",name:"PedidosLimpio",component:ms},{path:"/procesos/pedidos-crudos-impresion",name:"PedidoCrudosImpresion",component:ws,props:!0},{path:"/procesos/pedidos-limpio-impresion",name:"PedidoLimpioImpresion",component:Hi,props:!0},{path:"/procesos/bitacoras",name:"Bitacoras",component:Ts}],Ms=new k["a"]({mode:"history",base:"/",routes:Os});Ms.beforeEach((t,e,a)=>{const o=localStorage.getItem("user"),i=!!o;"/login"===t.path&&i?a("/"):"/login"===t.path||i?a():a("/login")});var Ns=Ms,Ds=a("5f5b"),Es=a("b1e0");a("f9e3"),a("2dd8"),a("15f5");o["default"].use(Ds["a"]),o["default"].use(Es["a"]),o["default"].use(A["a"]);const js=Object(A["b"])();o["default"].config.productionTip=!1;new o["default"]({router:Ns,pinia:js,render:t=>t(w),created(){const t=localStorage.getItem("user");if(t){const t=T();t.checkAuth()}}}).$mount("#app");window.fabric||a.e("chunk-2d0a385c").then(a.bind(null,"0314")).then(t=>{window.fabric=t.fabric,console.log("Fabric.js cargado globalmente")}).catch(t=>{console.error("Error al cargar Fabric.js:",t)})},"5aa2":function(t,e,a){"use strict";a("8d5c")},6044:function(t,e,a){"use strict";a("b7d6")},"623b":function(t,e,a){},"639c":function(t,e,a){},"64a8":function(t,e,a){},"64fd":function(t,e,a){},"680c":function(t,e,a){"use strict";a("4437")},"69d6":function(t,e,a){},"6a76":function(t,e,a){"use strict";a("0987")},"6ad3":function(t,e,a){"use strict";a("e3b7")},"72a4":function(t,e,a){},"74c9":function(t,e,a){"use strict";var o=function(){var t=this,e=t._self._c;return e("router-link",{staticClass:"btn-back",attrs:{to:t.to}},[t._v("Atrás")])},i=[],s={props:{to:{type:String,required:!0}}},r=s,n=(a("e0fe"),a("2877")),c=Object(n["a"])(r,o,i,!1,null,null,null);e["a"]=c.exports},"74f1":function(t,e,a){"use strict";a("b4c5")},"78f7":function(t,e,a){"use strict";a("d3a7")},"7b89":function(t,e,a){"use strict";a("8509")},"7dfe":function(t,e,a){},"7fb0":function(t,e,a){"use strict";a("eb61")},"7fd0":function(t,e,a){"use strict";a("04a5")},8509:function(t,e,a){},"8d5c":function(t,e,a){},"8f2b":function(t,e,a){"use strict";a("acf0")},"91a4":function(t,e,a){},9226:function(t,e,a){"use strict";a("928d")},"928d":function(t,e,a){},"959e":function(t,e,a){},"95c6":function(t,e,a){"use strict";a("623b")},"98cf":function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"sale-note"},[e("div",{staticClass:"back-button-container"},[e("BackButton",{attrs:{to:"/NoteMenu"}})],1),e("h2",{staticClass:"sale-note-title"},[t._v("Nota de Venta")]),e("div",{staticClass:"folio-date"},[e("p",[e("strong",[t._v("Folio:")]),t._v(" "+t._s(t.formattedFolio))]),e("p",[e("strong",[t._v("Fecha de Creación:")]),t._v(" "+t._s(t.formattedCreationDate))])]),e("form",{on:{submit:function(e){return e.preventDefault(),t.addProduct.apply(null,arguments)}}},[e("div",{staticClass:"form-row"},[e("div",[e("label",{attrs:{for:"client"}},[t._v("Cliente:")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.client,expression:"client"}],attrs:{required:""},on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.client=e.target.multiple?a:a[0]}}},t._l(t.clients,(function(a){return e("option",{key:a.id,domProps:{value:a.name}},[t._v(" "+t._s(a.name)+" ")])})),0)]),e("div",[e("label",{attrs:{for:"date"}},[t._v("Fecha:")]),e("DatePicker",{attrs:{"value-type":"format",format:"DD MMMM YYYY",placeholder:"Selecciona una fecha"},model:{value:t.currentDate,callback:function(e){t.currentDate=e},expression:"currentDate"}})],1)]),e("div",{staticClass:"form-row"},[e("div",[e("label",{attrs:{for:"kilos"}},[t._v("Kilos:")]),e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.newProduct.kilos,expression:"newProduct.kilos",modifiers:{number:!0}}],attrs:{type:"number",step:"0.01",required:""},domProps:{value:t.newProduct.kilos},on:{input:function(e){e.target.composing||t.$set(t.newProduct,"kilos",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}})]),e("div",[e("label",{attrs:{for:"product"}},[t._v("Producto:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.newProduct.product,expression:"newProduct.product"}],attrs:{type:"text",id:"product",required:""},domProps:{value:t.newProduct.product},on:{input:function(e){e.target.composing||t.$set(t.newProduct,"product",e.target.value)}}})]),e("div",[e("label",{attrs:{for:"pricePerKilo"}},[t._v("Precio por Kilo:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.newProduct.pricePerKilo,expression:"newProduct.pricePerKilo"}],attrs:{type:"number",id:"pricePerKilo",required:""},domProps:{value:t.newProduct.pricePerKilo},on:{input:function(e){e.target.composing||t.$set(t.newProduct,"pricePerKilo",e.target.value)}}})]),e("button",{attrs:{type:"submit"}},[t._v("Agregar Producto")])])]),t.products.length||t.abonos.length?e("div",[e("div",{ref:"printSection",staticClass:"print-section"},[e("div",{staticClass:"folio-date"},[e("p",[e("strong",[t._v("Folio:")]),t._v(" "+t._s(t.formattedFolio))]),e("p",[e("strong",[t._v("Fecha de Creación:")]),t._v(" "+t._s(t.formattedCreationDate))])]),t.products.length?e("div",[e("h3",[t._v("Resumen")]),e("table",[t._m(0),e("tbody",t._l(t.products,(function(a,o){return e("tr",{key:o,on:{touchstart:function(e){return t.startLongPress(o)},touchend:t.endLongPress,touchmove:t.endLongPress}},[t.editIndex===o?[e("td",[e("input",{directives:[{name:"model",rawName:"v-model",value:t.editProduct.product,expression:"editProduct.product"}],attrs:{type:"text"},domProps:{value:t.editProduct.product},on:{input:function(e){e.target.composing||t.$set(t.editProduct,"product",e.target.value)}}})]),e("td",[e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.editProduct.kilos,expression:"editProduct.kilos",modifiers:{number:!0}}],attrs:{type:"number"},domProps:{value:t.editProduct.kilos},on:{input:function(e){e.target.composing||t.$set(t.editProduct,"kilos",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}})]),e("td",[e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.editProduct.pricePerKilo,expression:"editProduct.pricePerKilo",modifiers:{number:!0}}],attrs:{type:"number"},domProps:{value:t.editProduct.pricePerKilo},on:{input:function(e){e.target.composing||t.$set(t.editProduct,"pricePerKilo",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}})]),e("td",[t._v("$"+t._s(t.formatNumber(t.editProduct.kilos*t.editProduct.pricePerKilo)))]),e("td",{staticClass:"action-column"},[e("button",{on:{click:t.confirmEdit}},[e("span",[t._v("✔")])]),e("button",{on:{click:t.cancelEdit}},[e("span",[t._v("❌")])])])]:[e("td",[t._v(t._s(a.product))]),e("td",[t._v(t._s(t.formatNumber(a.kilos)))]),e("td",[t._v("$"+t._s(t.formatNumber(a.pricePerKilo)))]),e("td",[t._v("$"+t._s(t.formatNumber(a.total)))]),e("td",{staticClass:"action-column"},[e("button",{on:{click:function(e){return t.editProductDetails(o)}}},[t._v("Editar")]),e("button",{on:{click:function(e){return t.removeProduct(o)}}},[t._v("Borrar")])])]],2)})),0)]),e("div",{staticClass:"total-general"},[e("h3",[t._v("Total General: $"+t._s(t.formatNumber(t.grandTotal)))])])]):t._e(),e("div",{staticClass:"abonos-container"},[e("div",{staticClass:"abonos-section"},[e("h3",[t._v("Registrar Abonos")]),e("form",{on:{submit:function(e){return e.preventDefault(),t.addAbono.apply(null,arguments)}}},[e("div",{staticClass:"form-row"},[e("div",[e("label",{attrs:{for:"abonoMonto"}},[t._v("Monto del Abono:")]),e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.newAbono.monto,expression:"newAbono.monto",modifiers:{number:!0}}],attrs:{type:"number",id:"abonoMonto",required:""},domProps:{value:t.newAbono.monto},on:{input:function(e){e.target.composing||t.$set(t.newAbono,"monto",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}})]),e("div",[e("label",{attrs:{for:"abonoFecha"}},[t._v("Fecha del Abono:")]),e("DatePicker",{attrs:{"value-type":"format",format:"DD MMMM YYYY",placeholder:"Selecciona una fecha"},model:{value:t.newAbono.fecha,callback:function(e){t.$set(t.newAbono,"fecha",e)},expression:"newAbono.fecha"}})],1)]),e("button",{staticClass:"add-abono-button",attrs:{type:"submit"}},[t._v("Agregar Abono")])]),t.abonos.length?e("div",[e("h3",[t._v("Abonos Realizados")]),e("div",{staticClass:"table-responsive"},[e("table",{staticClass:"abonos-table"},[t._m(1),e("tbody",t._l(t.abonos,(function(a,o){return e("tr",{key:o},[e("td",[t._v("$"+t._s(t.formatNumber(a.monto)))]),e("td",[t._v(t._s(t.formatDate(a.fecha)))])])})),0)])]),e("div",{staticClass:"abonos-summary"},[e("p",[e("strong",[t._v("Total Abonado:")]),t._v(" $"+t._s(t.formatNumber(t.totalAbonado)))]),e("p",[e("strong",[t._v("Saldo Restante:")]),t._v(" $"+t._s(t.formatNumber(t.saldoRestante)))]),e("p",{staticClass:"estado-pago",class:{pagado:t.isPaid,"no-pagado":!t.isPaid}},[e("strong",[t._v("Estado:")]),t._v(" "+t._s(t.isPaid?"Pagada":"No Pagada")+" ")])])]):t._e()])]),e("div",{staticClass:"action-buttons"},[e("div",{staticClass:"button-column"},[e("button",{on:{click:t.exportPDF}},[t._v("Exportar a PDF")]),e("button",{on:{click:t.printSection}},[t._v("Imprimir")])]),e("div",{staticClass:"button-column"},[e("button",{on:{click:t.saveNote}},[t._v("Guardar Nota")]),e("button",{staticClass:"delete-note-button",on:{click:t.deleteNote}},[t._v("Eliminar Nota")])])])]),t.showMobileActions?e("div",{staticClass:"mobile-actions-modal"},[e("button",{on:{click:function(e){return t.editProductDetails(t.selectedProductIndex)}}},[t._v("Editar")]),e("button",{on:{click:function(e){return t.removeProduct(t.selectedProductIndex)}}},[t._v("Borrar")]),-1!==t.editIndex?e("button",{on:{click:t.confirmEdit}},[t._v("Confirmar Edición")]):t._e(),e("button",{on:{click:t.cancelMobileActions}},[t._v("Cancelar")])]):t._e()]):t._e()])},i=[function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",[t._v("Producto")]),e("th",[t._v("Kg")]),e("th",[t._v("Precio")]),e("th",[t._v("Total")]),e("th",{staticClass:"action-column"},[t._v("Accion")])])])},function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",[t._v("Monto")]),e("th",[t._v("Fecha")])])])}],s=(a("14d9"),a("13d5"),a("74c9")),r=a("ec45"),n=(a("411c"),a("d67e")),c=a.n(n),l=a("4e00"),d=a("dc59"),u=a("1494"),m={components:{DatePicker:r["a"],AddClient:l["a"],BackButton:s["a"]},data(){const t=new Date;return{folio:Math.floor(1e4*Math.random()),client:"",currentDate:t.toISOString().substr(0,10),newProduct:{product:"",kilos:null,pricePerKilo:null,total:0},editProduct:{product:"",kilos:0,pricePerKilo:0,total:0},products:[],clients:[],editIndex:-1,newAbono:{monto:null,fecha:t.toISOString().substr(0,10)},abonos:[],isPaid:!1,creationDate:t.toISOString().substr(0,10),noteId:null,longPressTimer:null,showMobileActions:!1,selectedProductIndex:null}},computed:{grandTotal(){return this.products.reduce((t,e)=>t+e.total,0)},totalAbonado(){return this.abonos.reduce((t,e)=>t+Number(e.monto),0)},saldoRestante(){return this.grandTotal-this.totalAbonado},formattedFolio(){return"F-"+this.folio.toString().padStart(4,"0")},formattedCreationDate(){return this.formatDate(this.creationDate)}},watch:{saldoRestante(t){this.isPaid=t<=0}},methods:{async deleteNote(){if(this.noteId){if(confirm("¿Estás seguro de que quieres eliminar esta nota?"))try{await Object(u["d"])(Object(u["e"])(d["a"],"notes",this.noteId)),alert("Nota eliminada con éxito"),this.$router.push({name:"NoteMenu"})}catch(t){console.error("Error al eliminar la nota: ",t),alert("Error al eliminar la nota: "+t.message)}}else alert("El ID de la nota no está definido")},async saveNote(){try{const t={folio:this.folio,client:this.client,currentDate:this.currentDate,products:this.products,abonos:this.abonos,isPaid:this.isPaid,creationDate:this.creationDate};if(this.noteId)await Object(u["n"])(Object(u["e"])(d["a"],"notes",this.noteId),t);else{const e=await Object(u["b"])(Object(u["c"])(d["a"],"notes"),t);this.noteId=e.id}alert("Nota guardada exitosamente."),this.$router.push({name:"NoteMenu"})}catch(t){console.error("Error saving note: ",t),alert("Hubo un error al guardar la nota.")}},async addProduct(){this.newProduct.total=this.newProduct.kilos*this.newProduct.pricePerKilo,this.products.push({...this.newProduct}),this.resetForm()},resetForm(){this.newProduct={product:"",kilos:null,pricePerKilo:null,total:0}},removeProduct(t){this.products.splice(t,1),this.showMobileActions=!1},editProductDetails(t){this.editIndex=t,this.editProduct={...this.products[t]}},confirmEdit(){-1!==this.editIndex&&(this.editProduct.total=this.editProduct.kilos*this.editProduct.pricePerKilo,this.products[this.editIndex]={...this.editProduct},this.editIndex=-1,this.showMobileActions=!1)},cancelEdit(){this.editIndex=-1},async fetchClients(){try{const t=await Object(u["g"])(Object(u["c"])(d["a"],"clients"));this.clients=t.docs.map(t=>({id:t.id,...t.data()}))}catch(t){console.error("Error fetching clients: ",t)}},async fetchNoteData(){try{const t=Object(u["e"])(d["a"],"notes",this.noteId),e=await Object(u["f"])(t);if(e.exists()){const t=e.data();this.folio=t.folio,this.client=t.client,this.currentDate=t.currentDate,this.products=t.products,this.abonos=t.abonos,this.isPaid=t.isPaid,this.creationDate=t.creationDate}else console.log("No such document!")}catch(t){console.error("Error fetching note: ",t)}},addAbono(){this.abonos.push({...this.newAbono}),this.resetAbonoForm()},resetAbonoForm(){this.newAbono={monto:null,fecha:(new Date).toISOString().substr(0,10)}},formatNumber(t){return t.toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1})},formatDate(t){const e={year:"numeric",month:"long",day:"numeric"};return new Date(t).toLocaleDateString("es-ES",e)},exportPDF(){const t=this.$refs.printSection,e={margin:.5,filename:`Nota_de_Venta_${this.formattedFolio}_${(new Date).toLocaleDateString()}.pdf`,image:{type:"jpeg",quality:.98},html2canvas:{scale:2},jsPDF:{unit:"in",format:"letter",orientation:"portrait"}},a=t.cloneNode(!0),o=a.querySelectorAll("button");o.forEach(t=>t.style.display="none");const i=a.querySelectorAll("td:nth-child(5), th:nth-child(5)");i.forEach(t=>t.style.display="none");const s=a.querySelector(".abonos-section form");s&&(s.style.display="none");const r=a.querySelector(".abonos-section h3:first-child");r&&(r.style.display="none"),c()().from(a).set(e).save()},printSection(){const t=this.$refs.printSection.cloneNode(!0),e=t.querySelectorAll("button");e.forEach(t=>t.style.display="none");const a=t.querySelectorAll("td:nth-child(5), th:nth-child(5)");a.forEach(t=>t.style.display="none");const o=t.querySelector(".abonos-section form");o&&(o.style.display="none");const i=t.querySelector(".abonos-section h3:first-child");i&&(i.style.display="none");const s=window.open("","","width=800,height=600");s.document.write("<html><head><title>Nota de Venta</title>"),s.document.write("</head><body >"),s.document.write(t.innerHTML),s.document.write("</body></html>"),s.document.close(),s.print()},startLongPress(t){this.longPressTimer=setTimeout(()=>{this.showMobileActions=!0,this.selectedProductIndex=t},500)},endLongPress(){clearTimeout(this.longPressTimer)},cancelMobileActions(){this.showMobileActions=!1,this.selectedProductIndex=null,this.editIndex=-1}},async mounted(){this.fetchClients(),this.$route.params.noteId&&(this.noteId=this.$route.params.noteId,await this.fetchNoteData())}},p=m,h=(a("7b89"),a("2877")),v=Object(h["a"])(p,o,i,!1,null,"4e6b6cbc",null);e["default"]=v.exports},9924:function(t,e,a){},a26e:function(t,e,a){},a622:function(t,e,a){},a691:function(t,e,a){},a918:function(t,e,a){},abd1:function(t,e,a){"use strict";a("3bcd")},acf0:function(t,e,a){},ae5a:function(t,e,a){},b0a5:function(t,e,a){"use strict";a("5068")},b4c5:function(t,e,a){},b5d2:function(t,e,a){},b7d6:function(t,e,a){},b9f6:function(t,e,a){"use strict";a("0f9e")},ba37:function(t,e,a){"use strict";a("69d6")},bb0d:function(t,e,a){"use strict";a("051a")},bc40:function(t,e,a){"use strict";a("a26e")},be6e:function(t,e,a){},bee8:function(t,e,a){"use strict";a("a918")},bff9:function(t,e,a){"use strict";a("426e")},c0bd:function(t,e,a){},c3cc:function(t,e,a){"use strict";a("4a6a")},c98c:function(t,e,a){"use strict";a("639c")},c990:function(t,e,a){"use strict";a("a691")},cec2:function(t,e,a){},d248:function(t,e,a){"use strict";a("be6e")},d3a7:function(t,e,a){},d5fa:function(t,e,a){},d9d5:function(t,e,a){},dc59:function(t,e,a){"use strict";a.d(e,"a",(function(){return c})),a.d(e,"c",(function(){return l})),a.d(e,"b",(function(){return d}));var o=a("bc7b"),i=a("1494"),s=a("7c01");const r={apiKey:"AIzaSyDEXrriJ15Gg2IyPYh56gNktfGaSsP6KeE",authDomain:"reypezapp-1ced2.firebaseapp.com",projectId:"reypezapp-1ced2",storageBucket:"reypezapp-1ced2.appspot.com",messagingSenderId:"512757841511",appId:"1:512757841511:web:d15e6a6276e84c42959ec2",databaseURL:"https://reypezapp-1ced2-default-rtdb.firebaseio.com/"},n=Object(o["a"])(r),c=Object(i["h"])(n),l=Object(s["a"])(n),d=async(t,e)=>{if(t&&e)try{console.log("Configurando presencia para:",e);const a=Object(s["d"])(l,"status/"+t);await Object(s["b"])(a).remove(),await Object(s["e"])(a,{username:e,status:"online",lastSeen:(new Date).toISOString()}),console.log("Presencia configurada exitosamente")}catch(a){console.error("Error al configurar presencia:",a)}else console.log("Se requiere userId y username para manejar la presencia")}},e0fe:function(t,e,a){"use strict";a("5355")},e1ab:function(t,e,a){},e3b7:function(t,e,a){},e45f:function(t,e,a){"use strict";a("7dfe")},e6b2:function(t,e,a){"use strict";a("1b56")},eac9:function(t,e,a){"use strict";a("ff1a")},eb61:function(t,e,a){},ebeb:function(t,e,a){"use strict";a("64fd")},f817:function(t,e,a){"use strict";a("91a4")},f90b:function(t,e,a){"use strict";a("0836")},f980:function(t,e,a){"use strict";a("b5d2")},fbdc:function(t,e,a){"use strict";a("2efd")},ff1a:function(t,e,a){}});
//# sourceMappingURL=app.a55725b6.js.map