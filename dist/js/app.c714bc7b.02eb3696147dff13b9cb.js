(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["app.c714bc7b"],{"41cb":function(e,a,t){"use strict";var o=t("2b0e"),n=t("8c4f"),r=(t("f549"),t("bb51")),c=t("f411"),s=t("98cf"),i=t("4e00"),d=t("32e5"),l=t("9302"),u=t("1155"),m=t("2cc6"),p=t("4c52"),h=t("4c57"),f=t("505e"),b=t("f515"),g=t("fcb3"),w=t("24d5"),y=t("4786"),v=t("28ce"),C=t("74a9"),I=t("320e"),O=t("0ae9"),k=t("c8b7"),A=t("b34e"),j=t("f458"),E=t("4dc0"),M=t("9aeb"),x=t("a55b"),V=t("9f85"),S=t("85fe"),z=t("05af"),F=t("c5f5"),N=t("f125"),$=(t("0042"),t("cc98")),P=t("3420"),D=t("d918"),L=t("92c9"),J=t("e524");o["default"].use(n["a"]);const G=[{path:"/login",name:"Login",component:x["a"]},{path:"/noteMenu",name:"NoteMenu",component:c["a"]},{path:"/",name:"home",component:r["a"]},{path:"/sale-note/:noteId?",name:"SaleNote",component:()=>Promise.resolve().then(t.bind(null,"98cf"))},{path:"/add-client",name:"AddClient",component:i["a"]},{path:"/editar-nota/:noteId",name:"editar-nota",component:s["default"],props:!0},{path:"/sacadas",name:"SacadasMenu",component:l["a"]},{path:"/sacadas/new",name:"NuevaSacada",component:d["a"]},{path:"/sacadas/:id",name:"DetalleSacada",component:d["a"],props:!0},{path:"/gestionar-productos",name:"GestionarProductos",component:u["a"]},{path:"/gestionar-medidas",name:"GestionarMedidas",component:m["a"]},{path:"/gestionar-proveedores",name:"GestionarProveedores",component:p["a"]},{path:"/existencias",name:"Existencias",component:h["a"]},{path:"/cuentas-mexico",name:"CuentasMexico",component:f["a"]},{path:"/cuentas-ozuna",name:"ozuna-cuentas-menu",component:b["a"]},{path:"/cuentas-ozuna/nueva",name:"nueva-cuenta-ozuna",component:g["a"]},{path:"/cuentas-ozuna/:id",name:"ver-cuenta-ozuna",component:g["a"]},{path:"/cuentas-ozuna/:id?",name:"CuentasOzuna",component:g["a"]},{path:"/cuentas-catarro",name:"catarro-cuentas-menu",component:w["a"]},{path:"/cuentas-catarro/nueva",name:"nueva-cuenta-catarro",component:y["a"]},{path:"/cuentas-catarro/:id",name:"ver-cuenta-catarro",component:y["a"]},{path:"/cuentas-catarro/:id?",name:"CuentasCatarro",component:y["a"]},{path:"/cuentas-joselito",name:"joselito-cuentas-menu",component:v["a"]},{path:"/cuentas-joselito/nueva",name:"nueva-cuenta-joselito",component:C["a"]},{path:"/cuentas-joselito/:id",name:"ver-cuenta-joselito",component:C["a"]},{path:"/cuentas-joselito/:id?",name:"CuentasJoselito",component:C["a"]},{path:"/embarques-menu",name:"EmbarquesMenu",component:I["a"]},{path:"/ventas-ganancias-catarro",name:"VentasYGananciasCatarro",component:O["a"]},{path:"/ventas-ganancias-joselito",name:"VentasYGananciasJoselito",component:k["a"]},{path:"/embarques",name:"ListaEmbarques",component:A["a"]},{path:"/embarques/:id",name:"EditarEmbarque",component:j["a"]},{path:"/nuevo-embarque",name:"NuevoEmbarque",component:j["a"]},{path:"/embarques/:id/rendimientos",name:"Rendimientos",component:E["default"],props:!0},{path:"/cuenta-fletes",name:"CuentaFletes",component:M["a"]},{path:"/cuentas-otilio",name:"otilio-cuentas-menu",component:V["a"]},{path:"/cuentas-otilio/nueva",name:"nueva-cuenta-otilio",component:S["a"]},{path:"/cuentas-otilio/:id",name:"ver-cuenta-otilio",component:S["a"]},{path:"/cuentas-otilio/:id?",name:"CuentasOtilio",component:S["a"]},{path:"/procesos",name:"ProcesosMenu",component:z["a"]},{path:"/procesos/preparacion",name:"Preparacion",component:F["a"]},{path:"/procesos/pedidos",name:"PedidosMenu",component:N["a"]},{path:"/procesos/pedidos/nuevo",name:"NuevoPedido",component:D["a"]},{path:"/procesos/pedidos/crudo",name:"PedidosCrudo",component:$["a"]},{path:"/procesos/pedidos/limpio",name:"PedidosLimpio",component:D["a"]},{path:"/procesos/pedidos-crudos-impresion",name:"PedidoCrudosImpresion",component:P["a"],props:!0},{path:"/procesos/pedidos-limpio-impresion",name:"PedidoLimpioImpresion",component:L["a"],props:!0},{path:"/procesos/bitacoras",name:"Bitacoras",component:J["a"]}],q=new n["a"]({mode:"history",base:"/",routes:G});q.beforeEach((e,a,t)=>{const o=localStorage.getItem("user"),n=!!o;"/login"===e.path&&n?t("/"):"/login"===e.path||n?t():t("/login")}),a["a"]=q},"6d4d":function(e,a,t){"use strict";t.d(a,"a",(function(){return s}));t("14d9"),t("13d5");var o=t("e499"),n=t.n(o),r=t("4ebb"),c=t.n(r);"object"===typeof c.a&&(c.a.pdfMake&&c.a.pdfMake.vfs?n.a.vfs=c.a.pdfMake.vfs:c.a.vfs?n.a.vfs=c.a.vfs:n.a.vfs=c.a),"undefined"===typeof window||window.pdfMake||(window.pdfMake=n.a);const s=async(e,a)=>{try{const t=await u("https://res.cloudinary.com/hwkcovsmr/image/upload/v1620946647/samples/REY_PEZ_LOGO_nsotww.png"),o=(null===a||void 0===a?void 0:a.nombresMedidasPersonalizados)||{},r=e=>{if(!e)return"Sin fecha";let a;if(e&&"function"===typeof e.toDate?a=e.toDate():"string"===typeof e?a=new Date(e):e instanceof Date&&(a=e),isNaN(a.getTime()))return"Fecha inválida";const t=new Date(a.getTime()+6e4*a.getTimezoneOffset());return t.toLocaleDateString("es-MX",{year:"numeric",month:"2-digit",day:"2-digit",timeZone:"America/Mexico_City"})},c={content:[{columns:[{image:t,width:80,alignment:"left",margin:[0,0,0,5]},{text:"Reporte de Rendimientos",style:"header",alignment:"center",margin:[0,10,0,0]},{stack:[{text:"Fecha: "+r(a.fecha),alignment:"right",margin:[0,10,0,0]}]}]},{text:"\n",height:5},i(e,o,a)],styles:{header:{fontSize:24,bold:!0,color:"#3760b0",margin:[0,0,0,5]},tableHeader:{bold:!0,fontSize:20,color:"white",fillColor:"#3760b0"},rendimientoAlto:{color:"#27ae60",bold:!0},rendimientoBajo:{color:"#000000"},costoStyle:{color:"#e74c3c",bold:!0}},defaultStyle:{fontSize:18},footer:function(e,a){return{columns:[{text:"© 2024 Rey Pez - Tampico, Tamps.",alignment:"center",margin:[0,5,0,0],fontSize:8,color:"#3760b0"}]}}};a.notaRendimientos&&(c.content.push({text:"\n",height:5}),c.content.push({text:"Nota:",style:"header",color:"red",alignment:"center",margin:[0,10,0,0]}),c.content.push({text:" "+a.notaRendimientos,style:"header",alignment:"center",color:"black",margin:[0,10,0,0]})),n.a.createPdf(c).open()}catch(t){console.error("Error al generar el PDF de rendimientos:",t)}};function i(e,a,t){const o=e.reduce((e,t)=>{const o=a[t.medida]||t.medida;return o.includes("mixta")||o.includes("Mixta")?(e["Mixta"]||(e["Mixta"]={medida:"Mixta",kilosCrudos:0,totalEmbarcado:0,costoFinal:t.costoFinal}),t.kilosCrudos&&("object"===typeof t.kilosCrudos?e["Mixta"].kilosCrudos+=(parseFloat(t.kilosCrudos.medida1)||0)+(parseFloat(t.kilosCrudos.medida2)||0):e["Mixta"].kilosCrudos+=parseFloat(t.kilosCrudos)||0),e["Mixta"].totalEmbarcado+=parseFloat(t.totalEmbarcado)||0):e[o]={medida:o,kilosCrudos:parseFloat(t.kilosCrudos)||0,totalEmbarcado:parseFloat(t.totalEmbarcado)||0,costoFinal:t.costoFinal},e},{}),n=Object.values(o).some(e=>e.costoFinal&&"0"!==e.costoFinal&&0!==e.costoFinal),r=t.mostrarColumnaCosto&&n,c=[[{text:"Kilos en Crudo",style:"tableHeader"},{text:"Medida",style:"tableHeader"},{text:"Rendimiento",style:"tableHeader"},...r?[{text:"Costo Final",style:"tableHeader"}]:[]],...Object.values(o).map(e=>{const a=e.totalEmbarcado>0?e.kilosCrudos/e.totalEmbarcado:0,t=a>1?"rendimientoAlto":"rendimientoBajo";let o=e.medida;if(e.medidasIncluidas){const a=Array.from(e.medidasIncluidas);o=`Mixta (${a.join(", ")})`}return[d(e.kilosCrudos),o,{text:`(${l(a)})`,style:t},...r?[{text:e.costoFinal?"$"+Number(e.costoFinal).toFixed(1):"",style:"costoStyle"}]:[]]})];return{table:{headerRows:1,widths:r?["*","*","*","*"]:["*","*","*"],body:c},layout:{hLineWidth:function(e,a){return 0===e||e===a.table.body.length?1.5:.5},vLineWidth:function(e,a){return 0===e||e===a.table.widths.length?1.5:.5},hLineColor:function(e,a){return 0===e||e===a.table.body.length?"#3760b0":"#cccccc"},vLineColor:function(e,a){return 0===e||e===a.table.widths.length?"#3760b0":"#cccccc"},fillColor:function(e,a,t){return e%2===0?"#f8f9fa":null},paddingLeft:function(e){return 4},paddingRight:function(e){return 4},paddingTop:function(e){return 2},paddingBottom:function(e){return 2}}}}function d(e){if("number"===typeof e)return(e%1===0?Math.floor(e):e.toFixed(1))+" kg";if("object"===typeof e&&null!==e){const a=(Number(e.medida1)||0)+(Number(e.medida2)||0);return(a%1===0?Math.floor(a):a.toFixed(1))+" kg"}const a=Number(e);return(a%1===0?Math.floor(a):a.toFixed(1))+" kg"}function l(e){return Number(e).toFixed(2)}function u(e){return new Promise((a,t)=>{const o=new Image;o.crossOrigin="Anonymous",o.onload=function(){const e=document.createElement("canvas");e.width=o.width,e.height=o.height;const t=e.getContext("2d");t.drawImage(o,0,0);const n=e.toDataURL("image/png");a(n)},o.onerror=t,o.src=e})}},f549:function(e,a,t){"use strict";t.d(a,"a",(function(){return s}));var o=t("be92"),n=t("dc59"),r=t("e1bd");const c=[{username:"allan",password:"noseno"},{username:"edgar",password:"noseno"}],s=Object(o["c"])("auth",{state:()=>({user:null,isAuthenticated:!1,userId:null}),actions:{async login(e,a){try{const t=c.find(t=>t.username===e&&t.password===a);if(t){const e=Object(r["a"])();return this.userId=e,this.user={username:t.username},this.isAuthenticated=!0,Object(n["b"])(e,t.username),localStorage.setItem("user",JSON.stringify({...this.user,userId:e})),!0}return!1}catch(t){return console.error("Error en login:",t),!1}},logout(){this.user=null,this.isAuthenticated=!1,this.userId=null,localStorage.removeItem("user")},checkAuth(){try{const e=localStorage.getItem("user");if(e){const a=JSON.parse(e);this.user={username:a.username},this.userId=a.userId,this.isAuthenticated=!0,this.userId&&Object(n["b"])(this.userId,a.username)}}catch(e){console.error("Error al verificar autenticación:",e),this.logout()}}},getters:{isLoggedIn:e=>e.isAuthenticated,currentUser:e=>e.user}})},fa1c:function(e,a,t){"use strict";var o=t("c1df"),n=t.n(o);t("898b");n.a.locale("es")},fa40:function(e,a,t){"use strict";t("d9e2"),t("14d9"),t("13d5");var o=t("1494");t("fa1c");const n=e=>{if(!e)return"";let a=e.toLowerCase();a=a.trim();const t=a.includes("c/c"),o=a.includes("s/c");let n="";return t?(n="c/c",a=a.replace(/c\/c|cc|conc/g,"").trim()):o&&(n="s/c",a=a.replace(/s\/c|sc|sinc/g,"").trim()),a=a.replace(/-/g," "),a.includes("med")&&(a.includes("gde")||a.includes("grande"))&&(a="med gde"),a.includes("med")&&(a.includes("ch")||a.includes("chica"))&&(a="med ch"),a.includes("med")&&(a.includes("esp")||a.includes("especial"))&&(a="med esp"),a.includes("med gde")||a.includes("med ch")||a.includes("med esp")||(a=a.replace(/\s+/g,"")),a=a.replace(/-/g,"/"),n&&(a=`${a} ${n}`),a=a.replace(/c\/c|cc|conc/g,"c/c"),a=a.replace(/s\/c|sc|sinc/g,"s/c"),a.includes("med gde")||a.includes("med ch")||a.includes("med esp")||(a=a.replace(/^medium$|^med$/g,"med")),a=a.replace(/^grande$|^gde$/g,"gde"),a=a.replace(/^especial$|^esp$/g,"esp"),a},r=(e,a,t=!1)=>{if(!e)return a;const o=e.toLowerCase().trim(),n=/^(\d+)-(\d+)$/.exec(o);if(n){const e=parseInt(n[1])||0,a=parseInt(n[2])||0,o=19!==a||t?a:20,r=e*o;return r}const r=o.includes("crudo");if(r&&/^\d+\*\d+(\+\d+)?$/.test(o)){const e=o.split(/[\*\+]/);if(e.length>=2){const a=parseInt(e[0])||0,t=parseInt(e[1])||0,o=19===t?20:t;let n=0;e.length>2&&(n=parseInt(e[2])||0);const r=a*o+n;return r}}return a},c=async(e,a)=>{try{const t=Object(o["h"])(),n=Object(o["c"])(t,e),r=Object(o["o"])(n,Object(o["s"])("fecha","<",a)),c=await Object(o["g"])(r);if(c.empty)return console.log("No se encontraron cuentas anteriores"),0;const s=c.docs.map(e=>{const a=e.data();return{id:e.id,fecha:a.fecha,nuevoSaldoAcumulado:a.nuevoSaldoAcumulado||0}}).sort((e,a)=>new Date(a.fecha)-new Date(e.fecha));return s.length>0?s[0].nuevoSaldoAcumulado:0}catch(t){return console.error("Error al obtener saldo acumulado anterior:",t),0}},s=async(e,a)=>{try{const t=Object(o["h"])(),n=Object(o["c"])(t,e),r=Object(o["o"])(n,Object(o["s"])("fecha","==",a)),c=await Object(o["g"])(r);return!c.empty}catch(t){throw console.error("Error al verificar si existe cuenta para la fecha:",t),t}},i=async e=>{try{const a=Object(o["h"])(),t=Object(o["c"])(a,"precios"),r=Object(o["o"])(t,Object(o["l"])("fecha","desc")),c=await Object(o["g"])(r),s=new Map,i=new Map,d=[];c.docs.forEach(a=>{const t=a.data(),o=t.producto,r=n(t.producto);d.push({original:o,normalizada:r,precio:t.precio,clienteId:t.clienteId||"general"}),t.clienteId===e?i.has(r)||i.set(r,t.precio):t.clienteId||s.has(r)||s.set(r,t.precio)}),console.log("=== Normalización de medidas para precios ==="),console.log("Medidas específicas para",e,":",Array.from(i.entries())),console.log("Medidas generales:",Array.from(s.entries())),console.log("Detalles de normalización:",d);const l=["Med c/c","Med-gde c/c","Med Gde c/c","MedGde c/c","Med-Esp c/c","Med Esp c/c"];console.log("=== Casos de prueba de normalización ==="),l.forEach(e=>{const a=n(e),t=i.get(a)||s.get(a)||0;console.log(`${e} -> ${a} -> Precio: ${t}`)});const u=new Map([...s,...i]);return u}catch(a){return console.error("Error al obtener precios de venta:",a),new Map}},d=e=>{if(!e)return 0;if(e.includes("-")){const a=e.split("-");if(2===a.length)return parseInt(a[1])||0}return parseInt(e)||0},l=(e,a={},t=new Map)=>{if(!e||!Array.isArray(e))return[];const o=new Map;return e.forEach(e=>{if(!e.medida)return;const a=n(e.medida);let c=0;if("c/h20"===e.tipo){const a=e.reporteTaras||[],t=e.reporteBolsas||[];for(let e=0;e<a.length;e++){const o=parseInt(a[e])||0,n=parseInt(t[e])||0;c+=o*n}c*=e.camaronNeto||.65}else if(c=Array.isArray(e.kilos)?e.kilos.reduce((e,a)=>e+(Number(a)||0),0):Number(e.kilos)||0,e.restarTaras){const a=(e.taras||[]).reduce((e,a)=>e+(Number(a)||0),0);c-=3*a}const s=e.precio||e.costo||0,i=t.get(a)||e.precioVenta||s,d=r(e.medida,c,!0);if(o.has(a)){const e=o.get(a);e.kilos+=d,e.costo=s,e.precioVenta=i,e.total=e.kilos*e.costo}else o.set(a,{kilos:d,medida:e.medida,costo:s,precioVenta:i,total:d*s})}),a&&Object.values(a).forEach(e=>{e.forEach(e=>{e.items&&Array.isArray(e.items)&&e.items.forEach(e=>{if(!e.talla)return;const a=e.talla,r=n(a);let c=0;if(e.taras){const a=e.taras.split("-");if(2===a.length){const e=parseInt(a[0])||0,t=parseInt(a[1])||0;c=e*t}else c=parseInt(e.taras)||0}let s=0;e.sobrante&&e.mostrarSobrante&&(s=d(e.sobrante));const i=a.toLowerCase().includes("med c/c")&&"10-19"===e.taras&&"1-10"===e.sobrante,l=i?200:c+s,u=e.precio||0,m=t.get(r)||e.precioVenta||u;if(o.has(r)){const a=o.get(r);a.kilos+=l,e.precio&&(a.costo=u,a.precioVenta=m),a.total=a.kilos*a.costo}else o.set(r,{kilos:l,medida:a,costo:u,precioVenta:m,total:l*u,esCrudo:!0})})})}),Array.from(o.values())},u=(e,a={},t=new Map)=>{if(!e||!Array.isArray(e))return[];const o=l(e,a,t),c=new Map;e.forEach(e=>{if(!e.medida)return;const a=n(e.medida);let o=0;if("c/h20"===e.tipo){const a=e.reporteTaras||[],t=e.reporteBolsas||[];for(let e=0;e<a.length;e++){const n=parseInt(a[e])||0,r=parseInt(t[e])||0;o+=n*r}o*=e.camaronNeto||.65}else if(o=Array.isArray(e.kilos)?e.kilos.reduce((e,a)=>e+(Number(a)||0),0):Number(e.kilos)||0,e.restarTaras){const a=(e.taras||[]).reduce((e,a)=>e+(Number(a)||0),0);o-=3*a}const s=t.get(a)||e.precioVenta||e.precio||0,i=r(e.medida,o,!1);if(c.has(a)){const e=c.get(a);e.kilosVenta+=i,e.precioVenta=s,e.totalVenta=e.kilosVenta*e.precioVenta}else c.set(a,{kilosVenta:i,medida:e.medida,precioVenta:s,totalVenta:i*s,ganancia:0})}),a&&Object.values(a).forEach(e=>{e.forEach(e=>{e.items&&Array.isArray(e.items)&&e.items.forEach(e=>{if(!e.talla)return;const a=e.talla,o=n(a);let r=0;if(e.taras){const a=e.taras.split("-");if(2===a.length){const e=parseInt(a[0])||0;let t=parseInt(a[1])||0;19===t&&(t=20),r=e*t}else r=parseInt(e.taras)||0}let s=0;e.sobrante&&e.mostrarSobrante&&(s=d(e.sobrante));const i=a.toLowerCase().includes("med c/c")&&"10-19"===e.taras&&"1-10"===e.sobrante,l=i?210:r+s,u=t.get(o)||e.precioVenta||e.precio||0;if(c.has(o)){const a=c.get(o);a.kilosVenta+=l,e.precio&&(a.precioVenta=u),a.totalVenta=a.kilosVenta*a.precioVenta}else c.set(o,{kilosVenta:l,medida:a,precioVenta:u,totalVenta:l*u,ganancia:0,esCrudo:!0})})})});const s=Array.from(c.values());return s.forEach(e=>{const a=o.find(a=>n(a.medida)===n(e.medida));a&&(e.ganancia=e.totalVenta-a.total)}),s},m=async e=>{const{fecha:a,productos:t,clienteCrudos:o}=e,n=o&&o["1"]||[],r=await i("joselito"),s=l(t,{1:n},r),d=u(t,{1:n},r),m=s.reduce((e,a)=>e+(a.total||0),0),p=d.reduce((e,a)=>e+(a.totalVenta||0),0),h=await c("cuentasJoselito",a);return{fecha:a,items:s,itemsVenta:d,saldoAcumuladoAnterior:h,cobros:[],abonos:[],totalGeneral:m,totalGeneralVenta:p,nuevoSaldoAcumulado:h+p,estadoPagado:!1,tieneObservacion:!1,observacion:"",ultimaActualizacion:(new Date).toISOString()}},p=async e=>{const{fecha:a,productos:t,clienteCrudos:o}=e,n=o&&o["2"]||[],r=await i("catarro"),s=l(t,{2:n},r),d=u(t,{2:n},r),m=s.reduce((e,a)=>e+(a.total||0),0),p=d.reduce((e,a)=>e+(a.totalVenta||0),0),h=await c("cuentasCatarro",a);return{fecha:a,items:s,itemsVenta:d,saldoAcumuladoAnterior:h,cobros:[],abonos:[],totalGeneral:m,totalGeneralVenta:p,nuevoSaldoAcumulado:h+p,estadoPagado:!1,tieneObservacion:!1,observacion:"",ultimaActualizacion:(new Date).toISOString()}},h=async(e,a)=>{try{console.log("Iniciando creación de cuenta Joselito desde embarque");const t=await s("cuentasJoselito",e.fecha);if(t)throw new Error("Ya existe una cuenta de Joselito registrada para esta fecha.");const n=await m(e),r=Object(o["h"])(),c=await Object(o["b"])(Object(o["c"])(r,"cuentasJoselito"),n);if(console.log("Cuenta de Joselito creada con ID:",c.id),a){const e=`${window.location.origin}/cuentas-joselito/${c.id}?edit=true`;window.open(e,"_blank")}return c.id}catch(t){throw console.error("Error al crear cuenta de Joselito:",t),t}},f=async(e,a)=>{try{console.log("Iniciando creación de cuenta Catarro desde embarque");const t=await s("cuentasCatarro",e.fecha);if(t)throw new Error("Ya existe una cuenta de Catarro registrada para esta fecha.");const n=await p(e),r=Object(o["h"])(),c=await Object(o["b"])(Object(o["c"])(r,"cuentasCatarro"),n);if(console.log("Cuenta de Catarro creada con ID:",c.id),a){const e=`${window.location.origin}/cuentas-catarro/${c.id}?edit=true`;window.open(e,"_blank")}return c.id}catch(t){throw console.error("Error al crear cuenta de Catarro:",t),t}},b=async e=>{const{fecha:a,productos:t,clienteCrudos:o}=e,r=o&&o["4"]||[],s=await i("ozuna"),d=[];Array.isArray(t)&&t.forEach(e=>{if(e){let o=0;if("c/h20"===e.tipo){const a=e.reporteTaras||[],t=e.reporteBolsas||[];let n=0;for(let e=0;e<a.length;e++){const o=parseInt(a[e])||0,r=parseInt(t[e])||0;n+=o*r}o=n*(e.camaronNeto||.65)}else{var a,t;const n=(null===(a=e.kilos)||void 0===a?void 0:a.reduce((e,a)=>e+(parseFloat(a)||0),0))||0,r=(null===(t=e.taras)||void 0===t?void 0:t.reduce((e,a)=>e+(parseInt(a)||0),0))||0,c=e.restarTaras?3*r:0;o=Number((n-c).toFixed(1))}const r=e.medida||"";let c=0;if(e.esVenta){const a=n(r),t=s.get(a);c=parseFloat(e.precio)||t||0}else c=20;o>0&&d.push({kilos:o,medida:r,costo:c,total:o*c,esVenta:e.esVenta||!1,editando:!1,campoEditando:null})}}),Array.isArray(r)&&r.forEach(e=>{e&&Array.isArray(e.items)&&e.items.forEach(e=>{if(e){let a=0;if(e.taras){const t=/^(\d+)-(\d+)$/.exec(e.taras);if(t){const e=parseInt(t[1])||0;let o=parseInt(t[2])||0;19===o&&(o=20),a+=e*o}else{const t=e.taras.split("-").map(Number);if(t.length>=2){let e=t[1]||0;19===e&&(e=20),a+=(t[0]||0)*e}}}if(e.sobrante){const t=/^(\d+)-(\d+)$/.exec(e.sobrante);if(t){const e=parseInt(t[1])||0;let o=parseInt(t[2])||0;19===o&&(o=20),a+=e*o}else{const t=e.sobrante.split("-").map(Number);if(t.length>=2){let e=t[1]||0;19===e&&(e=20),a+=(t[0]||0)*e}}}const t=a,o=e.medida||e.talla||"Crudo",r=n(o),c=s.get(r),i=parseFloat(e.precio)||c||0;t>0&&d.push({kilos:t,medida:o,costo:i,total:t*i,esVenta:!0,editando:!1,campoEditando:null})}})});const l=d.reduce((e,a)=>e+(a.total||0),0),u=await c("cuentasOzuna",a);return{fecha:a,items:d,saldoAcumuladoAnterior:u,cobros:[],abonos:[],totalGeneral:l,totalSaldo:u+l,nuevoSaldoAcumulado:u+l,ultimaActualizacion:(new Date).toISOString()}},g=async(e,a)=>{try{console.log("Iniciando creación de cuenta Ozuna desde embarque");const t=await s("cuentasOzuna",e.fecha);if(t)throw new Error("Ya existe una cuenta de Ozuna registrada para esta fecha.");const n=await b(e),r=Object(o["h"])(),c=await Object(o["b"])(Object(o["c"])(r,"cuentasOzuna"),n);if(console.log("Cuenta de Ozuna creada con ID:",c.id),a){const e=`${window.location.origin}/cuentas-ozuna/${c.id}?edit=true`;window.open(e,"_blank")}return c.id}catch(t){throw console.error("Error al crear cuenta de Ozuna:",t),t}};a["a"]={crearCuentaJoselito:h,crearCuentaCatarro:f,crearCuentaOzuna:g}}}]);