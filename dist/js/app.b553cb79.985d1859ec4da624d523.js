(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["app.b553cb79"],{1155:function(e,a,o){"use strict";var t=function(){var e=this,a=e._self._c;return a("div",{staticClass:"gestionar-productos-container"},[a("div",{staticClass:"back-button-container"},[a("BackButton",{attrs:{to:"/sacadas"}})],1),a("h1",[e._v("Gestión de Productos")]),a("div",{staticClass:"actions-container"},[a("router-link",{staticClass:"action-button",attrs:{to:"/gestionar-medidas"}},[e._v(" Gestionar Medidas ")]),a("router-link",{staticClass:"action-button",attrs:{to:"/gestionar-proveedores"}},[e._v(" Gestionar Proveedores ")])],1),a("div",{staticClass:"modify-product-form"},[a("h2",[e._v("Modificar Existencia de Producto")]),a("form",{on:{submit:function(a){return a.preventDefault(),e.modifyProduct.apply(null,arguments)}}},[a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"tipo"}},[e._v("Tipo:")]),a("select",{directives:[{name:"model",rawName:"v-model",value:e.modifyProductData.tipo,expression:"modifyProductData.tipo"}],attrs:{id:"tipo",required:""},on:{change:function(a){var o=Array.prototype.filter.call(a.target.options,(function(e){return e.selected})).map((function(e){var a="_value"in e?e._value:e.value;return a}));e.$set(e.modifyProductData,"tipo",a.target.multiple?o:o[0])}}},[a("option",{attrs:{value:"proveedor"}},[e._v("Proveedor")]),a("option",{attrs:{value:"maquila"}},[e._v("Maquila")])])]),a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"proveedor"}},[e._v("Proveedor/Maquila:")]),a("select",{directives:[{name:"model",rawName:"v-model",value:e.modifyProductData.proveedor,expression:"modifyProductData.proveedor"}],attrs:{id:"proveedor",required:""},on:{change:function(a){var o=Array.prototype.filter.call(a.target.options,(function(e){return e.selected})).map((function(e){var a="_value"in e?e._value:e.value;return a}));e.$set(e.modifyProductData,"proveedor",a.target.multiple?o:o[0])}}},[a("option",{attrs:{value:""}},[e._v("Seleccione un proveedor/maquila")]),e._l(e.proveedoresFiltrados,(function(o){return a("option",{key:o.id,domProps:{value:o.nombre}},[e._v(" "+e._s(o.nombre)+" ")])}))],2)]),a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"medida"}},[e._v("Medida:")]),a("select",{directives:[{name:"model",rawName:"v-model",value:e.modifyProductData.medida,expression:"modifyProductData.medida"}],attrs:{id:"medida",required:""},on:{change:function(a){var o=Array.prototype.filter.call(a.target.options,(function(e){return e.selected})).map((function(e){var a="_value"in e?e._value:e.value;return a}));e.$set(e.modifyProductData,"medida",a.target.multiple?o:o[0])}}},[a("option",{attrs:{value:""}},[e._v("Seleccione una medida")]),e._l(e.medidasFiltradas,(function(o){return a("option",{key:o.id,domProps:{value:o.nombre}},[e._v(" "+e._s(o.nombre)+" ")])}))],2)]),a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"kilos"}},[e._v("Kilos:")]),a("input",{directives:[{name:"model",rawName:"v-model.number",value:e.modifyProductData.kilos,expression:"modifyProductData.kilos",modifiers:{number:!0}}],attrs:{id:"kilos",type:"number",step:"0.1",required:""},domProps:{value:e.modifyProductData.kilos},on:{input:function(a){a.target.composing||e.$set(e.modifyProductData,"kilos",e._n(a.target.value))},blur:function(a){return e.$forceUpdate()}}})]),a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"operacion"}},[e._v("Operación:")]),a("select",{directives:[{name:"model",rawName:"v-model",value:e.modifyProductData.operacion,expression:"modifyProductData.operacion"}],attrs:{id:"operacion",required:""},on:{change:function(a){var o=Array.prototype.filter.call(a.target.options,(function(e){return e.selected})).map((function(e){var a="_value"in e?e._value:e.value;return a}));e.$set(e.modifyProductData,"operacion",a.target.multiple?o:o[0])}}},[a("option",{attrs:{value:"sumar"}},[e._v("Sumar")]),a("option",{attrs:{value:"restar"}},[e._v("Restar")])])]),a("button",{staticClass:"submit-btn",attrs:{type:"submit"}},[e._v("Modificar Existencia")])])]),a("div",{staticClass:"products-list"},[a("h2",[e._v("Existencias Actuales")]),a("ul",e._l(e.existencias,(function(o,t){return a("li",{key:t},[a("strong",[e._v(e._s(t))]),a("ul",e._l(o,(function(o,t){return a("li",{key:t},[e._v(" "+e._s(t)+" - "+e._s(e.formatNumber(o))+" kg ")])})),0)])})),0)]),a("router-link",{staticClass:"back-btn",attrs:{to:"/sacadas"}},[e._v("Volver al Menú de Sacadas")])],1)},r=[],i=(o("14d9"),o("2b0e")),s=o("dc59"),d=o("1494"),c=o("74c9"),n={name:"GestionarProductos",components:{BackButton:c["a"]},setup(){const e=Object(i["ref"])({}),a=Object(i["ref"])([]),o=Object(i["ref"])([]),t=Object(i["ref"])({tipo:"proveedor",proveedor:"",medida:"",kilos:null,operacion:"sumar"}),r=async()=>{try{const a=await Object(d["g"])(Object(d["c"])(s["a"],"sacadas")),o={};a.forEach(e=>{const a=e.data();a.entradas.forEach(e=>{o[e.proveedor]||(o[e.proveedor]={}),o[e.proveedor][e.medida]||(o[e.proveedor][e.medida]=0),o[e.proveedor][e.medida]+=e.kilos}),a.salidas.forEach(e=>{o[e.proveedor]||(o[e.proveedor]={}),o[e.proveedor][e.medida]||(o[e.proveedor][e.medida]=0),o[e.proveedor][e.medida]-=e.kilos})}),Object.keys(o).forEach(e=>{o[e]=Object.fromEntries(Object.entries(o[e]).filter(([e,a])=>a>0))}),e.value=o}catch(a){console.error("Error al cargar existencias: ",a)}},c=async()=>{try{const e=await Object(d["g"])(Object(d["c"])(s["a"],"medidas"));a.value=e.docs.map(e=>({id:e.id,...e.data()}))}catch(e){console.error("Error al cargar medidas: ",e)}},n=async()=>{try{const e=await Object(d["g"])(Object(d["c"])(s["a"],"proveedores"));o.value=e.docs.map(e=>({id:e.id,...e.data()}))}catch(e){console.error("Error al cargar proveedores: ",e)}},l=async()=>{try{const{proveedor:e,medida:a,kilos:o,operacion:i}=t.value,c={fecha:new Date,entradas:[],salidas:[]};"sumar"===i?c.entradas.push({proveedor:e,medida:a,kilos:o}):c.salidas.push({proveedor:e,medida:a,kilos:o}),await Object(d["b"])(Object(d["c"])(s["a"],"sacadas"),c),alert("Existencia modificada con éxito"),t.value={tipo:"proveedor",proveedor:"",medida:"",kilos:null,operacion:"sumar"},r()}catch(e){console.error("Error al modificar producto: ",e),alert("Error al modificar la existencia del producto")}},u=e=>e.toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1}),m=Object(i["computed"])(()=>o.value.filter(e=>"proveedor"===t.value.tipo?"maquila"!==e.tipo:"maquila"===e.tipo)),v=Object(i["computed"])(()=>a.value.filter(e=>"proveedor"===t.value.tipo?"general"===e.tipo:"maquila"===e.tipo));return Object(i["onMounted"])(()=>{r(),c(),n()}),{existencias:e,medidas:a,proveedores:o,modifyProductData:t,modifyProduct:l,formatNumber:u,proveedoresFiltrados:m,medidasFiltradas:v}}},l=n,u=(o("e6b2"),o("2877")),m=Object(u["a"])(l,t,r,!1,null,"67f08a69",null);a["a"]=m.exports},"1b56":function(e,a,o){},"2cc6":function(e,a,o){"use strict";var t=function(){var e=this,a=e._self._c;return a("div",{staticClass:"gestionar-medidas-container"},[a("div",{staticClass:"back-button-container"},[a("BackButton",{attrs:{to:"/gestionar-productos"}})],1),a("h1",[e._v("Gestión de Medidas")]),a("div",{staticClass:"add-medida-form"},[a("h2",[e._v("Agregar Medida")]),a("form",{on:{submit:function(a){return a.preventDefault(),e.addMedida.apply(null,arguments)}}},[a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"medida"}},[e._v("Medida:")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.newMedida.nombre,expression:"newMedida.nombre"}],attrs:{id:"medida",required:"",placeholder:"Ej: 16/20, 21/25, 26/30, etc."},domProps:{value:e.newMedida.nombre},on:{input:function(a){a.target.composing||e.$set(e.newMedida,"nombre",a.target.value)}}})]),a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"tipo"}},[e._v("Tipo:")]),a("select",{directives:[{name:"model",rawName:"v-model",value:e.newMedida.tipo,expression:"newMedida.tipo"}],attrs:{id:"tipo",required:""},on:{change:function(a){var o=Array.prototype.filter.call(a.target.options,(function(e){return e.selected})).map((function(e){var a="_value"in e?e._value:e.value;return a}));e.$set(e.newMedida,"tipo",a.target.multiple?o:o[0])}}},[a("option",{attrs:{value:"general"}},[e._v("General")]),a("option",{attrs:{value:"maquila"}},[e._v("Maquila")])])]),"maquila"===e.newMedida.tipo?a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"maquila"}},[e._v("Maquila:")]),a("select",{directives:[{name:"model",rawName:"v-model",value:e.newMedida.maquilaId,expression:"newMedida.maquilaId"}],attrs:{id:"maquila",required:""},on:{change:function(a){var o=Array.prototype.filter.call(a.target.options,(function(e){return e.selected})).map((function(e){var a="_value"in e?e._value:e.value;return a}));e.$set(e.newMedida,"maquilaId",a.target.multiple?o:o[0])}}},[a("option",{attrs:{value:""}},[e._v("Seleccione una maquila")]),e._l(e.maquilas,(function(o){return a("option",{key:o.id,domProps:{value:o.id}},[e._v(" "+e._s(o.nombre)+" ")])}))],2)]):e._e(),a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"proveedor"}},[e._v("Proveedor:")]),a("select",{directives:[{name:"model",rawName:"v-model",value:e.newMedida.proveedorId,expression:"newMedida.proveedorId"}],attrs:{id:"proveedor"},on:{change:function(a){var o=Array.prototype.filter.call(a.target.options,(function(e){return e.selected})).map((function(e){var a="_value"in e?e._value:e.value;return a}));e.$set(e.newMedida,"proveedorId",a.target.multiple?o:o[0])}}},[a("option",{attrs:{value:""}},[e._v("General")]),e._l(e.proveedores,(function(o){return a("option",{key:o.id,domProps:{value:o.id}},[e._v(" "+e._s(o.nombre)+" ")])}))],2)]),a("button",{staticClass:"submit-btn",attrs:{type:"submit"}},[e._v("Agregar Medida")])])]),a("div",{staticClass:"medidas-list"},[a("h2",[e._v("Lista de Medidas")]),a("h3",[e._v("Medidas Generales")]),a("ul",e._l(e.medidasGenerales,(function(o){return a("li",{key:o.id},[e._v(" "+e._s(o.nombre)+" "),a("button",{staticClass:"delete-btn",on:{click:function(a){return e.deleteMedida(o.id)}}},[e._v("Eliminar")])])})),0),a("h3",[e._v("Medidas de Proveedores")]),e._l(e.proveedores,(function(o){return a("div",{key:o.id},[a("h4",[e._v(e._s(o.nombre))]),a("ul",e._l(e.getMedidasProveedor(o.id),(function(o){return a("li",{key:o.id},[e._v(" "+e._s(o.nombre)+" "),a("button",{staticClass:"delete-btn",on:{click:function(a){return e.deleteMedida(o.id)}}},[e._v("Eliminar")])])})),0)])})),a("h3",[e._v("Medidas de Maquilas")]),e._l(e.maquilas,(function(o){return a("div",{key:o.id},[a("h4",[e._v(e._s(o.nombre))]),a("ul",e._l(e.getMedidasMaquila(o.id),(function(o){return a("li",{key:o.id},[e._v(" "+e._s(o.nombre)+" "),a("button",{staticClass:"delete-btn",on:{click:function(a){return e.deleteMedida(o.id)}}},[e._v("Eliminar")])])})),0)])}))],2)])},r=[],i=o("2b0e"),s=o("dc59"),d=o("1494"),c=o("74c9"),n={name:"GestionarMedidas",components:{BackButton:c["a"]},setup(){const e=Object(i["ref"])([]),a=Object(i["ref"])([]),o=Object(i["ref"])([]),t=Object(i["ref"])({nombre:"",tipo:"general",maquilaId:"",proveedorId:""}),r=async()=>{try{const a=await Object(d["g"])(Object(d["c"])(s["a"],"medidas"));e.value=a.docs.map(e=>({id:e.id,...e.data()}))}catch(a){console.error("Error al cargar medidas: ",a)}},c=async()=>{try{const e=Object(d["o"])(Object(d["c"])(s["a"],"proveedores"),Object(d["s"])("tipo","==","maquila")),a=await Object(d["g"])(e);o.value=a.docs.map(e=>({id:e.id,...e.data()}))}catch(e){console.error("Error al cargar maquilas: ",e)}},n=async()=>{try{const e=await Object(d["g"])(Object(d["c"])(s["a"],"proveedores"));a.value=e.docs.map(e=>({id:e.id,...e.data()}))}catch(e){console.error("Error al cargar proveedores: ",e)}},l=async()=>{try{await Object(d["b"])(Object(d["c"])(s["a"],"medidas"),{nombre:t.value.nombre,tipo:t.value.tipo,maquilaId:"maquila"===t.value.tipo?t.value.maquilaId:null,proveedorId:"general"===t.value.tipo?t.value.proveedorId:null}),t.value={nombre:"",tipo:"general",maquilaId:"",proveedorId:""},r()}catch(e){console.error("Error al añadir medida: ",e)}},u=async e=>{if(confirm("¿Estás seguro de que quieres eliminar esta medida?"))try{await Object(d["d"])(Object(d["e"])(s["a"],"medidas",e)),r()}catch(a){console.error("Error al eliminar medida: ",a)}},m=Object(i["computed"])(()=>e.value.filter(e=>"general"===e.tipo&&!e.proveedorId)),v=a=>e.value.filter(e=>"maquila"===e.tipo&&e.maquilaId===a),p=a=>e.value.filter(e=>e.proveedorId===a);return Object(i["onMounted"])(()=>{r(),c(),n()}),{medidas:e,proveedores:a,maquilas:o,newMedida:t,addMedida:l,deleteMedida:u,medidasGenerales:m,getMedidasMaquila:v,getMedidasProveedor:p}}},l=n,u=(o("c3cc"),o("2877")),m=Object(u["a"])(l,t,r,!1,null,"48626452",null);a["a"]=m.exports},3462:function(e,a,o){},"4a6a":function(e,a,o){},"4c52":function(e,a,o){"use strict";var t=function(){var e=this,a=e._self._c;return a("div",{staticClass:"gestionar-proveedores-container"},[a("div",{staticClass:"back-button-container"},[a("BackButton",{attrs:{to:"/gestionar-productos"}})],1),a("h1",[e._v("Gestión de Proveedores y Maquilas")]),a("div",{staticClass:"add-proveedor-form"},[a("h2",[e._v("Agregar Proveedor/Maquila")]),a("form",{on:{submit:function(a){return a.preventDefault(),e.addProveedor.apply(null,arguments)}}},[a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"nombre"}},[e._v("Nombre:")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.newProveedor.nombre,expression:"newProveedor.nombre"}],attrs:{id:"nombre",required:"",placeholder:"Nombre del proveedor/maquila"},domProps:{value:e.newProveedor.nombre},on:{input:function(a){a.target.composing||e.$set(e.newProveedor,"nombre",a.target.value)}}})]),a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"tipo"}},[e._v("Tipo:")]),a("select",{directives:[{name:"model",rawName:"v-model",value:e.newProveedor.tipo,expression:"newProveedor.tipo"}],attrs:{id:"tipo",required:""},on:{change:function(a){var o=Array.prototype.filter.call(a.target.options,(function(e){return e.selected})).map((function(e){var a="_value"in e?e._value:e.value;return a}));e.$set(e.newProveedor,"tipo",a.target.multiple?o:o[0])}}},[a("option",{attrs:{value:"proveedor"}},[e._v("Proveedor")]),a("option",{attrs:{value:"maquila"}},[e._v("Maquila")])])]),a("button",{staticClass:"submit-btn",attrs:{type:"submit"}},[e._v("Agregar")])])]),a("div",{staticClass:"proveedores-list"},[a("h2",[e._v("Lista de Proveedores y Maquilas")]),a("ul",e._l(e.sortedProveedores,(function(o){return a("li",{key:o.id},[a("div",{staticClass:"proveedor-info"},[a("strong",[e._v(e._s(o.nombre))]),a("span",[e._v("("+e._s("proveedor"===o.tipo?"Proveedor":"Maquila")+")")])]),a("button",{staticClass:"delete-btn",on:{click:function(a){return e.deleteProveedor(o.id)}}},[e._v("Eliminar")])])})),0)])])},r=[],i=o("2b0e"),s=o("dc59"),d=o("1494"),c=o("74c9"),n={name:"GestionarProveedores",components:{BackButton:c["a"]},setup(){const e=Object(i["ref"])([]),a=Object(i["ref"])({nombre:"",tipo:"proveedor"}),o=async()=>{try{const a=await Object(d["g"])(Object(d["c"])(s["a"],"proveedores"));e.value=a.docs.map(e=>({id:e.id,...e.data()}))}catch(a){console.error("Error al cargar proveedores: ",a)}},t=async()=>{try{await Object(d["b"])(Object(d["c"])(s["a"],"proveedores"),{nombre:a.value.nombre,tipo:a.value.tipo}),a.value={nombre:"",tipo:"proveedor"},o()}catch(e){console.error("Error al añadir proveedor: ",e)}},r=async e=>{if(confirm("¿Estás seguro de que quieres eliminar este proveedor/maquila?"))try{await Object(d["d"])(Object(d["e"])(s["a"],"proveedores",e)),o()}catch(a){console.error("Error al eliminar proveedor: ",a)}},c=Object(i["computed"])(()=>[...e.value].sort((e,a)=>e.nombre.localeCompare(a.nombre)));return Object(i["onMounted"])(o),{proveedores:e,newProveedor:a,addProveedor:t,deleteProveedor:r,sortedProveedores:c}}},l=n,u=(o("9226"),o("2877")),m=Object(u["a"])(l,t,r,!1,null,"14c80c33",null);a["a"]=m.exports},"4c57":function(e,a,o){"use strict";o("13d5");var t=function(){var e=this,a=e._self._c;return a("div",{staticClass:"existencias-page"},[a("div",{staticClass:"existencias-container"},[a("div",{staticClass:"header"},[a("h1",[e._v("Reporte de Existencias")]),a("button",{staticClass:"print-button",on:{click:e.imprimirReporte}},[e._v(" Imprimir Reporte ")])]),a("div",{staticClass:"filters"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.search,expression:"search"}],staticClass:"search-input",attrs:{placeholder:"Buscar por proveedor o medida"},domProps:{value:e.search},on:{input:function(a){a.target.composing||(e.search=a.target.value)}}})]),a("div",{staticClass:"existencias-grid"},e._l(e.filteredExistencias,(function(o,t){return a("div",{key:t,staticClass:"medida-card",class:{"maquila-card":"Ozuna"===t||"Joselito"===t}},[a("h2",[e._v(e._s(t)+e._s("Ozuna"===t||"Joselito"===t?" (Maquila)":""))]),a("table",{staticClass:"medida-table"},[a("thead",[a("tr",[a("th",[e._v("Medida")]),"Ozuna"!==t&&"Joselito"!==t?a("th",[e._v("Proveedor")]):e._e(),e.tienePrecio?a("th",[e._v("Precio")]):e._e(),a("th",{staticClass:"kilos-cell"},[e._v("Kilos")])])]),a("tbody",["Ozuna"===t||"Joselito"===t?[e._l(o,(function(o,t){return o.kilos>0?a("tr",{key:t},[a("td",[e._v(e._s(o.medida))]),e.tienePrecio?a("td",{staticClass:"precio-cell"},[e._v(e._s(o.precio?"$"+o.precio:"-"))]):e._e(),a("td",{staticClass:"kilos-cell"},[e._v(e._s(e.formatNumber(o.kilos)))])]):e._e()})),a("tr",{staticClass:"total-row"},[a("td",[a("strong",[e._v("Total "+e._s(t))])]),e.tienePrecio?a("td"):e._e(),a("td",{staticClass:"kilos-cell"},[a("strong",[e._v(e._s(e.formatNumber(Object.values(o).reduce((e,a)=>e+a.kilos,0))))])])])]:[e._l(o,(function(o){return o.kilos>0?a("tr",{key:`${o.medida}-${o.proveedor}-${o.precio||"sin-precio"}`},[a("td",[e._v(e._s(o.medida))]),a("td",[e._v(e._s(o.proveedor))]),e.tienePrecio?a("td",{staticClass:"precio-cell"},[e._v(e._s(o.precio?"$"+o.precio:"-"))]):e._e(),a("td",{staticClass:"kilos-cell"},[e._v(e._s(e.formatNumber(o.kilos)))])]):e._e()})),a("tr",{staticClass:"total-row"},[a("td",[a("strong",[e._v("Total "+e._s(t))])]),a("td"),e.tienePrecio?a("td"):e._e(),a("td",{staticClass:"kilos-cell"},[a("strong",[e._v(e._s(e.formatNumber(o.reduce((e,a)=>e+a.kilos,0))))])])])]],2)])])})),0),e.tienePrecio?a("div",{staticClass:"valor-total"},[a("h2",[e._v("Valor Total: $"+e._s(e.formatNumber(e.valorTotal)))])]):e._e(),a("div",{staticClass:"total-general"},[a("h2",[e._v("Kilos Totales: "+e._s(e.formatNumber(e.totalGeneral)))])])])])},r=[],i=(o("14d9"),o("2b0e")),s=o("dc59"),d=o("1494"),c=o("c1df"),n=o.n(c),l={name:"Existencias",setup(){const e=Object(i["ref"])({}),a=Object(i["ref"])(""),o=Object(i["ref"])(!1),t=async()=>{const a=await Object(d["g"])(Object(d["c"])(s["a"],"sacadas")),t={};let r=!1;console.log("=== Rastreando Selecta 51/60 1ra Nacional ===");let i=0;const c=a.docs.map(e=>({id:e.id,...e.data()})).sort((e,a)=>{const o=e.fecha instanceof Date?e.fecha:e.fecha.toDate(),t=a.fecha instanceof Date?a.fecha:a.fecha.toDate();return o-t});c.forEach(e=>{const a=e.fecha instanceof Date?e.fecha:e.fecha.toDate(),o=n()(a);e.entradas.forEach(e=>{const a=null!==e.precio&&void 0!==e.precio;a&&(r=!0),"Selecta"===e.proveedor&&"51/60 1ra Nacional"===e.medida&&(i+=e.kilos,console.log(`Entrada: ${e.kilos} kg - Fecha: ${o.format("DD/MM/YYYY")} - Precio: ${e.precio||"N/A"}`)),t[e.proveedor]||(t[e.proveedor]={});const s=a?e.precio:null,d=null!==s?`${e.medida}_$${s}`:e.medida;t[e.proveedor][d]||(t[e.proveedor][d]={kilos:0,medida:e.medida,precio:s}),t[e.proveedor][d].kilos+=e.kilos}),e.salidas.forEach(e=>{const a=null!==e.precio&&void 0!==e.precio;"Selecta"===e.proveedor&&"51/60 1ra Nacional"===e.medida&&(i-=e.kilos,console.log(`Salida: ${e.kilos} kg - Fecha: ${o.format("DD/MM/YYYY")} - Precio: ${e.precio||"N/A"}`)),t[e.proveedor]||(t[e.proveedor]={});const r=a?e.precio:null,s=null!==r?`${e.medida}_$${r}`:e.medida;t[e.proveedor][s]||(t[e.proveedor][s]={kilos:0,medida:e.medida,precio:r}),t[e.proveedor][s].kilos-=e.kilos})}),console.log(`=== Total final Selecta 51/60 1ra Nacional: ${i} kg ===`),Object.keys(t).forEach(e=>{"Selecta"===e&&t[e]["51/60 1ra Nacional"]&&console.log("[DEBUG] Resultado final Selecta 51/60 1ra Nacional:",t[e]["51/60 1ra Nacional"].kilos),t[e]=Object.fromEntries(Object.entries(t[e]).filter(([e,a])=>a.kilos>0)),0===Object.keys(t[e]).length&&delete t[e]}),e.value=t,o.value=r},r=Object(i["computed"])(()=>{const o=a.value.toLowerCase(),t={},r={};if(Object.entries(e.value).forEach(([e,a])=>{"Ozuna"!==e&&"Joselito"!==e&&(r[e]=a)}),e.value["Ozuna"]){const a=Object.fromEntries(Object.entries(e.value["Ozuna"]).filter(([e,a])=>a.kilos>1));Object.keys(a).length>0&&(t["Ozuna"]=a)}if(e.value["Joselito"]){const a=Object.fromEntries(Object.entries(e.value["Joselito"]).filter(([e,a])=>a.kilos>1));Object.keys(a).length>0&&(t["Joselito"]=a)}const i={};Object.entries(r).forEach(([e,a])=>{Object.entries(a).forEach(([a,o])=>{if(o.kilos<=1)return;const t=o.medida.split(" ")[0];i[t]||(i[t]=[]);const r=i[t].findIndex(a=>a.proveedor===e&&a.medida===o.medida&&a.precio===o.precio);r>=0?i[t][r].kilos+=o.kilos:i[t].push({proveedor:e,medida:o.medida,precio:o.precio,kilos:o.kilos})})});const s={};return Object.entries(i).sort(([e],[a])=>{const o=parseInt(e.split("/")[0]),t=parseInt(a.split("/")[0]);return o-t}).forEach(([e,a])=>{const t=a.filter(e=>e.kilos>1);t.length>0&&(!o||e.toLowerCase().includes(o)||t.some(e=>e.proveedor.toLowerCase().includes(o)||e.medida.toLowerCase().includes(o)))&&(s[e]=t.sort((e,a)=>e.proveedor!==a.proveedor?e.proveedor.localeCompare(a.proveedor):null===e.precio&&null===a.precio?0:null===e.precio?1:null===a.precio?-1:e.precio-a.precio))}),Object.entries(t).forEach(([e,a])=>{if(!o||e.toLowerCase().includes(o)){const o=Object.entries(a).filter(([e,a])=>a.kilos>1).sort(([e],[a])=>{const o=parseInt(e.split("/")[0]),t=parseInt(a.split("/")[0]);return o-t}).reduce((e,[a,o])=>(e[a]=o,e),{});Object.keys(o).length>0&&(s[e]=o)}}),s}),c=Object(i["computed"])(()=>{let a=0,o=0;return Object.entries(e.value).forEach(([e,t])=>{Object.values(t).forEach(t=>{"ozuna"===e.toLowerCase()?t.kilos>o&&(o=t.kilos):t.kilos>a&&(a=t.kilos)})}),{normal:a,ozuna:o}}),l=Object(i["computed"])(()=>Object.entries(r.value).reduce((e,[a,o])=>"Ozuna"===a||"Joselito"===a?e+Object.values(o).reduce((e,a)=>e+a.kilos,0):e+o.reduce((e,a)=>e+a.kilos,0),0)),u=Object(i["computed"])(()=>Object.entries(r.value).reduce((e,[a,o])=>"Ozuna"===a||"Joselito"===a?e+Object.values(o).reduce((e,a)=>a.precio&&a.precio>0?e+a.kilos*a.precio:e,0):e+o.reduce((e,a)=>a.precio&&a.precio>0?e+a.kilos*a.precio:e,0),0)),m=e=>Math.round(e).toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),v=()=>{const e=(new Date).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}),a=(o.value,o.value,u.value),t="\n        <style>\n          @page { \n            size: A4 landscape; \n            margin: 0.3cm 0.3cm;\n          }\n          body {\n            font-family: Arial, sans-serif;\n            font-size: 16pt;\n            line-height: 1.0;\n            color: #333;\n            margin: 0;\n            padding: 0;\n          }\n          .header {\n            margin-bottom: 4px;\n            padding-bottom: 1px;\n          }\n          h1 {\n            font-size: 20pt;\n            margin: 0;\n            padding: 0;\n          }\n          .fecha-reporte {\n            font-size: 14pt;\n          }\n          .existencias-grid {\n            display: grid;\n            grid-template-columns: repeat(3, 1fr);\n            gap: 3px;\n            margin-top: 4px;\n          }\n          .medida-card {\n            padding: 4px;\n          }\n          .medida-card h2 {\n            font-size: 16pt;\n            margin: 0 0 3px 0;\n            padding-bottom: 2px;\n          }\n          th, td {\n            padding: 2px 4px;\n            font-size: 14pt;\n          }\n          .precio-cell {\n            text-align: center;\n            color: #27ae60;\n            font-weight: bold;\n          }\n          @media print {\n            .existencias-grid {\n              display: grid;\n              grid-template-columns: repeat(3, 1fr);\n            }\n            .medida-card {\n              break-inside: avoid;\n              page-break-inside: avoid;\n            }\n          }\n          .valor-total {\n            margin-top: 4px;\n            padding: 2px;\n            text-align: right;\n          }\n          .valor-total h2 {\n            font-size: 20pt;\n            color: #27ae60;\n            margin: 0;\n          }\n          .total-general {\n            margin-top: 2px;\n            padding: 2px;\n          }\n          .total-general h2 {\n            font-size: 20pt;\n          }\n          table {\n            width: 100%;\n            border-collapse: collapse;\n            margin-top: 3px;\n            border: 1px solid #2c3e50;\n          }\n          th {\n            background-color: #2c3e50;\n            color: white;\n            text-align: left;\n            padding: 2px 4px;\n            font-size: 14pt;\n            border: 1px solid #2c3e50;\n          }\n          td {\n            padding: 2px 4px;\n            font-size: 14pt;\n            border: 1px solid #bdc3c7;\n          }\n          tr:nth-child(even) {\n            background-color: #f8f9fa;\n          }\n          .kilos-cell {\n            text-align: right;\n            font-weight: bold;\n            color: #2c3e50;\n          }\n          .total-row {\n            background-color: #ecf0f1 !important;\n            border-top: 1px solid #2c3e50;\n          }\n          .total-row td {\n            font-weight: bold;\n            color: #2c3e50;\n          }\n          .medida-card {\n            padding: 4px;\n            border: 1px solid #bdc3c7;\n            background-color: white;\n          }\n          .maquila-card {\n            background-color: white;\n            border: 1px solid #f39c12;\n          }\n          .maquila-card h2 {\n            color: #d35400;\n            border-bottom: 1px solid #f39c12;\n            padding-bottom: 1px;\n          }\n          .maquila-card th {\n            background-color: #f39c12;\n            border-color: #f39c12;\n          }\n          .maquila-card .total-row {\n            background-color: #f8f9fa !important;\n            border-top: 1px solid #f39c12;\n          }\n          .maquila-card .total-row td {\n            color: #d35400;\n            font-weight: bold;\n          }\n          @media print {\n            .medida-card {\n              box-shadow: none;\n              border: 1px solid #bdc3c7;\n              break-inside: avoid;\n              page-break-inside: avoid;\n            }\n            .maquila-card {\n              background-color: white;\n              border: 1px solid #f39c12;\n            }\n            table {\n              page-break-inside: avoid;\n            }\n            .valor-total, .total-general {\n              page-break-before: avoid;\n              break-before: avoid;\n            }\n          }\n        </style>\n      ",r=o.value?`\n        <div class="valor-total">\n          <h2>Valor Total: $${m(a)}</h2>\n        </div>\n      `:"",i=`\n        <div class="total-general">\n          <h2>Kilos Totales: ${m(l.value)}</h2>\n        </div>\n      `,s=`\n        <!DOCTYPE html>\n        <html>\n        <head>\n          <meta charset="utf-8">\n          <title>Reporte de Existencias</title>\n          ${t}\n        </head>\n        <body>\n          <div class="header">\n            <h1>Reporte de Existencias</h1>\n            <div class="fecha-reporte">Fecha: ${e}</div>\n          </div>\n          ${document.querySelector(".existencias-grid").outerHTML}\n          ${r}\n          ${i}\n        </body>\n        </html>\n      `,d=window.open("","_blank");d.document.write(s),d.document.close(),setTimeout(()=>{d.print(),d.close()},250)};let p;return Object(i["onMounted"])(()=>{t(),p=Object(d["k"])(Object(d["c"])(s["a"],"sacadas"),()=>{t()})}),Object(i["onUnmounted"])(()=>{p&&p()}),Object(i["watchEffect"])(()=>{console.log("Existencias actualizadas:",e.value)}),{existencias:e,filteredExistencias:r,search:a,maxKilos:c,totalGeneral:l,valorTotal:u,tienePrecio:o,formatNumber:m,imprimirReporte:v}}},u=l,m=(o("51af"),o("2877")),v=Object(m["a"])(u,t,r,!1,null,"30bd7ec8",null);a["a"]=v.exports},"51af":function(e,a,o){"use strict";o("3462")},"586e":function(e,a,o){"use strict";var t=function(){var e=this,a=e._self._c;return a("div",{staticClass:"gestion-costos-container"},[a("div",{staticClass:"header-container"},[a("button",{staticClass:"btn-volver",on:{click:e.volverAEmbarque}},[a("i",{staticClass:"fas fa-arrow-left"}),e._v(" Volver al Embarque ")]),a("button",{staticClass:"btn-rendimientos",on:{click:e.volverARendimientos}},[a("i",{staticClass:"fas fa-chart-line"}),e._v(" Volver a Rendimientos ")]),a("h2",[e._v("Gestión de Costos")]),a("button",{staticClass:"btn-nuevo-costo",on:{click:e.abrirModalNuevoCosto}},[a("i",{staticClass:"fas fa-plus"}),e._v(" Nueva Medida ")])]),a("div",{staticClass:"costos-section"},[a("h3",[e._v("Medidas Registradas")]),a("div",{staticClass:"costos-grid"},e._l(e.costosRegistrados,(function(o,t){return a("div",{key:t,staticClass:"costo-card"},[a("div",{staticClass:"costo-header"},[a("h4",[e._v(e._s(t))]),a("div",{staticClass:"costo-actions"},[a("button",{staticClass:"btn-historial",on:{click:function(a){return e.verHistorial(t)}}},[a("i",{staticClass:"fas fa-history"})]),a("button",{staticClass:"btn-eliminar",attrs:{title:`Eliminar medida ${t} completamente`},on:{click:function(a){return e.eliminarMedida(t)}}},[a("i",{staticClass:"fas fa-trash"})])])]),a("div",{staticClass:"costo-info"},[a("p",[a("strong",[e._v("Costo Actual:")]),e._v(" $"+e._s(o.costoBase.toFixed(2)))]),a("p",[a("strong",[e._v("Última Actualización:")]),e._v(" "+e._s(e.formatearFecha(o.fecha)))]),a("button",{staticClass:"btn-editar-costo",on:{click:function(a){return e.editarCosto(t)}}},[a("i",{staticClass:"fas fa-edit"}),e._v(" Editar Costo ")])])])})),0)]),e.embarqueData?a("div",{staticClass:"medidas-embarque-section"},[a("div",{staticClass:"seccion-header"},[a("h3",[e._v("Medidas del Embarque Actual")]),a("button",{staticClass:"btn-sincronizar",attrs:{title:"Sincronizar costos con los valores más recientes"},on:{click:e.sincronizarCostos}},[a("i",{staticClass:"fas fa-sync-alt"}),e._v(" Sincronizar Costos ")]),a("button",{staticClass:"btn-crear-medidas",attrs:{title:"Crear medidas faltantes"},on:{click:e.sugerirCrearMedidasFaltantes}},[a("i",{staticClass:"fas fa-plus-circle"}),e._v(" Crear Medidas Faltantes ")])]),a("div",{staticClass:"costo-extra-section"},[a("label",{attrs:{for:"costoExtra"}},[e._v("Costo Extra:")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.costoExtra,expression:"costoExtra"}],staticClass:"input-costo-extra",attrs:{type:"number",id:"costoExtra",min:"0",step:"0.01",placeholder:"18"},domProps:{value:e.costoExtra},on:{input:[function(a){a.target.composing||(e.costoExtra=a.target.value)},e.guardarCostoExtraDebounced]}}),a("span",{staticClass:"input-help"},[e._v("Se suma al cálculo del costo final")])]),a("div",{staticClass:"medidas-grid"},e._l(e.medidasVisibles,(function(o){return a("div",{key:`${o}-${e.costosEmbarque[o]||"global"}`,staticClass:"medida-card"},[a("div",{staticClass:"medida-header"},[a("h4",[e._v(e._s(o))]),a("div",{staticClass:"medida-actions"},[a("label",{staticClass:"checkbox-container"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.medidaSeleccionada[o],expression:"medidaSeleccionada[medida]"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.medidaSeleccionada[o])?e._i(e.medidaSeleccionada[o],null)>-1:e.medidaSeleccionada[o]},on:{change:[function(a){var t=e.medidaSeleccionada[o],r=a.target,i=!!r.checked;if(Array.isArray(t)){var s=null,d=e._i(t,s);r.checked?d<0&&e.$set(e.medidaSeleccionada,o,t.concat([s])):d>-1&&e.$set(e.medidaSeleccionada,o,t.slice(0,d).concat(t.slice(d+1)))}else e.$set(e.medidaSeleccionada,o,i)},e.guardarSeleccionMedidas]}}),a("span",{staticClass:"checkmark"}),e._v(" Mostrar en PDF ")]),a("label",{staticClass:"checkbox-container"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.aplicarCostoExtra[o],expression:"aplicarCostoExtra[medida]"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.aplicarCostoExtra[o])?e._i(e.aplicarCostoExtra[o],null)>-1:e.aplicarCostoExtra[o]},on:{change:[function(a){var t=e.aplicarCostoExtra[o],r=a.target,i=!!r.checked;if(Array.isArray(t)){var s=null,d=e._i(t,s);r.checked?d<0&&e.$set(e.aplicarCostoExtra,o,t.concat([s])):d>-1&&e.$set(e.aplicarCostoExtra,o,t.slice(0,d).concat(t.slice(d+1)))}else e.$set(e.aplicarCostoExtra,o,i)},e.guardarConfiguracionCostoExtra]}}),a("span",{staticClass:"checkmark"}),e._v(" Aplicar costo extra ")])])]),a("div",{staticClass:"medida-info"},[a("div",{staticClass:"costo-container"},[a("div",{staticClass:"costo-valor"},[a("div",{staticClass:"costo-display",class:{clickeable:!0,"costo-especifico":e.costosEmbarque[o]},on:{click:function(a){return e.editarCostoEmbarque(o)}}},[a("strong",[e._v("Costo:")]),a("span",{staticClass:"costo-amount"},[e._v("$"+e._s(e.costosActuales[o]||"0.00"))]),e.costosEmbarque[o]?a("span",{staticClass:"badge-especifico"},[e._v("Específico")]):e._e(),a("i",{staticClass:"fas fa-edit costo-edit-icon"})]),a("div",{staticClass:"costo-origen"},[e.costosEmbarque[o]?a("span",{staticClass:"costo-especifico"},[a("i",{staticClass:"fas fa-ship"}),e._v(" Costo específico del embarque "),a("button",{staticClass:"btn-limpiar-costo",attrs:{title:"Volver al costo global"},on:{click:function(a){return a.stopPropagation(),e.limpiarCostoEspecifico(o)}}},[a("i",{staticClass:"fas fa-times"})])]):e.encontrarCostoParaMedida(o)?a("span",{staticClass:"costo-global"},[a("i",{staticClass:"fas fa-globe"}),e._v(" Costo global ("+e._s(e.encontrarCostoParaMedida(o).medidaEncontrada)+") ")]):a("span",{staticClass:"sin-costo"},[a("i",{staticClass:"fas fa-exclamation-triangle"}),e._v(" Sin costo asignado ")])])]),(e.costosEmbarque[o]||e.encontrarCostoParaMedida(o))&&e.rendimientos[o]?a("div",{staticClass:"costo-calculado"},[a("strong",[e._v("Costo Final: $"+e._s(e.calcularCostoFinal(o)))]),e.aplicarCostoExtra[o]?a("span",{staticClass:"costo-extra-indicator"},[e._v(" (+ $"+e._s(e.costoExtra)+" extra) ")]):e._e()]):e._e()]),e.rendimientos[o]?a("p",[a("strong",[e._v("Rendimiento:")]),e._v(" "+e._s(e.rendimientos[o].toFixed(2))+" ")]):e._e()])])})),0)]):e._e(),a("MedidaModal",{attrs:{mostrar:e.mostrarModalNuevaMedida,medida:e.nuevaMedida.nombre},on:{cerrar:e.cerrarModalNuevaMedida,guardar:e.siguienteNuevaMedida}}),a("CostoModal",{attrs:{mostrar:e.mostrarModalNuevoCosto,costo:e.nuevaMedida.costo,medida:e.nuevaMedida.nombre,esNuevo:!0},on:{cerrar:e.cerrarModalNuevoCosto,guardar:e.guardarNuevoCosto}}),a("CostoModal",{attrs:{mostrar:e.mostrarModalEditarCosto,costo:e.costoEditando.costo,medida:e.costoEditando.medida,esNuevo:!1,costoAnterior:e.costoEditando.costoAnterior,fechaUltimaActualizacion:e.costoEditando.fechaUltimaActualizacion},on:{cerrar:e.cerrarModalEditarCosto,guardar:e.guardarCostoEditado}}),a("CostoModal",{attrs:{mostrar:e.mostrarModalCostoEmbarque,costo:e.costoEmbarqueEditando.costo,medida:e.costoEmbarqueEditando.medida,esNuevo:!1,esCostoEmbarque:!0},on:{cerrar:e.cerrarModalCostoEmbarque,guardar:e.guardarCostoEmbarque}}),e.mostrarModalHistorial?a("div",{staticClass:"modal-overlay"},[a("div",{staticClass:"modal-content modal-historial"},[a("h3",[e._v("Historial de Costos - "+e._s(e.medidaSeleccionadaHistorial))]),a("div",{staticClass:"historial-container"},[e.cargandoHistorial?a("div",{staticClass:"loading-historial"},[e._m(0)]):0===e.historialCostos.length?a("div",{staticClass:"no-historial"},[a("p",[e._v("No hay historial de costos para esta medida.")])]):a("div",{staticClass:"historial-list"},e._l(e.historialCostos,(function(o){return a("div",{key:o.id,staticClass:"historial-item",class:{eliminado:o.eliminado,restaurado:o.restaurado,medidaEliminada:o.medidaEliminada,nuevo:o.nuevo}},[a("div",{staticClass:"historial-info"},[a("div",{staticClass:"historial-costo"},[a("strong",[e._v("$"+e._s(o.costoBase.toFixed(2)))]),o.eliminado?a("span",{staticClass:"estado-badge eliminado"},[e._v("Eliminado")]):e._e(),o.restaurado?a("span",{staticClass:"estado-badge restaurado"},[e._v("Restaurado")]):e._e(),o.medidaEliminada?a("span",{staticClass:"estado-badge medida-eliminada"},[e._v("Medida Eliminada")]):e._e(),o.nuevo?a("span",{staticClass:"estado-badge nuevo"},[e._v("Nueva Medida")]):e._e()]),a("div",{staticClass:"historial-fecha"},[e._v(" "+e._s(e.formatearFechaCompleta(o.fecha))+" ")]),o.observacion?a("div",{staticClass:"historial-observacion"},[a("em",[e._v(e._s(o.observacion))])]):e._e()]),a("div",{staticClass:"historial-actions"},[a("button",{staticClass:"btn-eliminar-entrada",attrs:{title:"Eliminar esta entrada del historial"},on:{click:function(a){return e.eliminarEntradaHistorial(o)}}},[a("i",{staticClass:"fas fa-times"})])])])})),0)]),a("div",{staticClass:"modal-buttons"},[a("button",{staticClass:"btn-cancelar",on:{click:e.cerrarModalHistorial}},[e._v("Cerrar")])])])]):e._e()],1)},r=[function(){var e=this,a=e._self._c;return a("p",[a("i",{staticClass:"fas fa-spinner fa-spin"}),e._v(" Cargando historial...")])}],i=(o("14d9"),o("13d5"),o("88e6"),o("70cc"),o("eb03"),o("22e5c"),o("c01e"),o("fa76"),o("8306"),o("1494")),s=o("2ef0"),d=o("7b75"),c=o("0d65"),n={name:"GestionCostos",components:{CostoModal:d["a"],MedidaModal:c["a"]},data(){return{embarqueData:null,medidasEmbarque:[],costosRegistrados:{},costosEmbarque:{},medidaSeleccionada:{},medidaOculta:{},aplicarCostoExtra:{},rendimientos:{},costoExtra:18,mostrarModalNuevaMedida:!1,mostrarModalNuevoCosto:!1,mostrarModalEditarCosto:!1,mostrarModalCostoEmbarque:!1,mostrarModalHistorial:!1,medidaSeleccionadaHistorial:"",historialCostos:[],cargandoHistorial:!1,nuevaMedida:{nombre:"",costo:0},costoEditando:{medida:"",costo:0,costoAnterior:null,fechaUltimaActualizacion:""},costoEmbarqueEditando:{medida:"",costo:0},unsubscribePreciosGlobales:null,guardarCostoExtraDebounced:null}},async created(){await this.cargarEmbarque(),await this.iniciarEscuchaPreciosGlobales(),this.guardarCostoExtraDebounced=Object(s["debounce"])(this.guardarCostoExtra,500)},methods:{async cargarEmbarque(){try{const e=Object(i["h"])(),a=this.$route.params.id,o=Object(i["e"])(e,"embarques",a),t=await Object(i["f"])(o);t.exists()&&(this.embarqueData=t.data(),this.embarqueData.fecha||(this.embarqueData.fecha=(new Date).toISOString().split("T")[0],await Object(i["r"])(o,{fecha:this.embarqueData.fecha})),this.obtenerMedidasEmbarque(),this.medidaSeleccionada=this.embarqueData.medidaSeleccionada||{},this.medidaOculta=this.embarqueData.medidaOculta||{},this.aplicarCostoExtra=this.embarqueData.aplicarCostoExtra||{},this.costosEmbarque=this.embarqueData.costosPorMedida||{},this.costoExtra=this.embarqueData.costoExtra||18,this.calcularRendimientos(),await this.inicializarConfiguracionCostoExtra(),await this.aplicarCostosRegistrados())}catch(e){console.error("Error al cargar el embarque:",e)}},obtenerMedidasEmbarque(){if(!this.embarqueData||!this.embarqueData.clientes)return;const e=new Set;this.embarqueData.clientes.forEach(a=>{a.productos.forEach(o=>{if(o.medida){let t=o.medida;"Ozuna"!==a.nombre||o.esVenta||(t=o.medida+" Maquila Ozuna"),e.add(t)}}),a.crudos&&Array.isArray(a.crudos)&&a.crudos.forEach(a=>{a&&a.items&&Array.isArray(a.items)&&a.items.forEach(a=>{a.talla&&e.add(a.talla)})})}),this.medidasEmbarque=Array.from(e)},calcularRendimientos(){this.embarqueData&&this.embarqueData.kilosCrudos&&this.medidasEmbarque.forEach(e=>{const a=this.obtenerTotalEmbarcado(e);if(a>0){let o;const t=this.embarqueData.kilosCrudos[e];o=this.esMedidaMix(e)&&t?Number(t.medida1||0)+Number(t.medida2||0):Number(t||0),this.$set(this.rendimientos,e,o/a)}})},obtenerTotalEmbarcado(e){if(!this.embarqueData||!this.embarqueData.clientes)return 0;const a=e.includes("Maquila Ozuna"),o=e.replace(" Maquila Ozuna","").toLowerCase().trim();return this.embarqueData.clientes.reduce((e,t)=>e+t.productos.filter(e=>!!e.medida&&(a?e.medida.toLowerCase().trim()===o&&"Ozuna"===t.nombre&&!e.esVenta:e.medida.toLowerCase().trim()===o&&("Ozuna"!==t.nombre||e.esVenta))).reduce((e,a)=>{if("c/h20"===a.tipo){const o=this.calcularTotalBolsas(a),t=parseFloat(a.camaronNeto)||.65;return e+o*t}{const o=a.kilos.reduce((e,a)=>e+(Number(a)||0),0),t=this.calcularTotalTaras(a),r=a.restarTaras?3*t:0;return e+(o-r)}},0),0)},calcularTotalTaras(e){const a=(e.taras||[]).reduce((e,a)=>e+(Number(a)||0),0),o=(e.tarasExtra||[]).reduce((e,a)=>e+(Number(a)||0),0);return a+o},calcularTotalBolsas(e){const a=e.reporteTaras||[],o=e.reporteBolsas||[];let t=0;for(let r=0;r<a.length;r++){const e=parseInt(a[r])||0,i=parseInt(o[r])||0;t+=e*i}return t},esMedidaMix(e){return e.toLowerCase().includes("mix")},calcularCostoFinal(e){let a=0;if(this.costosEmbarque[e])a=Number(this.costosEmbarque[e]);else{const o=this.encontrarCostoParaMedida(e);o&&(a=Number(o.costo))}const o=Number(this.rendimientos[e])||0,t=Math.round(100*o)/100,r=Number(this.costoExtra)||18,i=this.aplicarCostoExtra[e]||!1;let s;return s=i?Math.round(a*t+r):Math.round(a*t),s.toFixed(1)},async iniciarEscuchaPreciosGlobales(){try{const e=Object(i["h"])(),a=Object(i["c"])(e,"historial_costos");this.unsubscribePreciosGlobales=Object(i["k"])(a,e=>{var a;const o=[];e.forEach(e=>{const a=e.data();o.push({...a,id:e.id})}),o.sort((e,a)=>{const o=new Date(e.fecha),t=new Date(a.fecha);return t-o});const t=(null===(a=this.embarqueData)||void 0===a?void 0:a.fecha)||(new Date).toISOString().split("T")[0],r={},i=new Set;o.forEach(e=>{if(!i.has(e.medida)){const a=new Date(e.fecha),o=new Date(t);a<=o&&!e.eliminado&&!e.medidaEliminada&&(r[e.medida]={costoBase:e.costoBase,fecha:e.fecha,timestamp:e.timestamp,id:e.id},i.add(e.medida))}}),this.costosRegistrados={...r},this.embarqueData&&this.aplicarCostosRegistrados().catch(e=>{console.error("Error al aplicar costos registrados:",e)})})}catch(e){console.error("Error al iniciar escucha de historial:",e)}},abrirModalNuevoCosto(){this.mostrarModalNuevaMedida=!0,this.nuevaMedida={nombre:"",costo:0}},cerrarModalNuevaMedida(){this.mostrarModalNuevaMedida=!1,this.nuevaMedida={nombre:"",costo:0}},siguienteNuevaMedida(e){this.nuevaMedida.nombre=e,this.mostrarModalNuevaMedida=!1,this.mostrarModalNuevoCosto=!0},cerrarModalNuevoCosto(){this.mostrarModalNuevoCosto=!1,this.nuevaMedida={nombre:"",costo:0}},async guardarNuevoCosto(e){if(this.nuevaMedida.nombre.trim())try{const a=Object(i["h"])(),o=new Date(e.fecha);o.setHours(12,0,0,0),await Object(i["b"])(Object(i["c"])(a,"historial_costos"),{medida:this.nuevaMedida.nombre,costoBase:Number(e.costo||0),timestamp:o,fecha:e.fecha,nuevo:!0}),this.cerrarModalNuevoCosto(),console.log("Nuevo costo guardado correctamente")}catch(a){console.error("Error al guardar el nuevo costo:",a),alert("Error al guardar el costo")}else alert("Por favor ingrese el nombre de la medida")},editarCosto(e){const a=this.costosRegistrados[e];this.costoEditando={medida:e,costo:a.costoBase,costoAnterior:a.costoBase,fechaUltimaActualizacion:this.formatearFecha(a.fecha)},this.mostrarModalEditarCosto=!0},cerrarModalEditarCosto(){this.mostrarModalEditarCosto=!1,this.costoEditando={medida:"",costo:0,costoAnterior:null,fechaUltimaActualizacion:""}},async guardarCostoEditado(e){try{const a=Object(i["h"])(),o=this.costoEditando.medida,t=new Date(e.fecha);t.setHours(12,0,0,0),await Object(i["b"])(Object(i["c"])(a,"historial_costos"),{medida:o,costoBase:Number(e.costo),fecha:e.fecha,timestamp:t}),this.cerrarModalEditarCosto(),console.log("Costo actualizado correctamente")}catch(a){console.error("Error al actualizar el costo:",a),alert("Error al actualizar el costo")}},async eliminarMedida(e){if(confirm(`¿Está seguro de eliminar completamente la medida "${e}" y todo su historial?`))try{const a=Object(i["h"])();this.$delete(this.costosRegistrados,e);const o=Object(i["c"])(a,"historial_costos"),t=Object(i["o"])(o,Object(i["s"])("medida","==",e)),r=await Object(i["g"])(t),s=r.docs.map(e=>Object(i["d"])(e.ref));await Promise.all(s),console.log(`Medida "${e}" y todo su historial eliminados correctamente`)}catch(a){console.error("Error al eliminar la medida:",a),alert("Error al eliminar la medida")}},async eliminarEntradaHistorial(e){if(confirm(`¿Está seguro de eliminar esta entrada del historial ($${e.costoBase.toFixed(2)} - ${this.formatearFecha(e.fecha)})?`))try{const a=Object(i["h"])();await Object(i["d"])(Object(i["e"])(a,"historial_costos",e.id)),this.historialCostos=this.historialCostos.filter(a=>a.id!==e.id),console.log("Entrada del historial eliminada correctamente")}catch(a){console.error("Error al eliminar entrada del historial:",a),alert("Error al eliminar la entrada del historial")}},editarCostoEmbarque(e){let a=0;if(this.costosEmbarque[e])a=this.costosEmbarque[e];else{const o=this.encontrarCostoParaMedida(e);o&&(a=o.costo)}this.costoEmbarqueEditando={medida:e,costo:a},this.mostrarModalCostoEmbarque=!0},cerrarModalCostoEmbarque(){this.mostrarModalCostoEmbarque=!1,this.costoEmbarqueEditando={medida:"",costo:0}},async guardarCostoEmbarque(e){try{const a=Object(i["h"])(),o=this.$route.params.id,t=Object(i["e"])(a,"embarques",o),r=this.costoEmbarqueEditando.medida;null!==e?(this.$set(this.costosEmbarque,r,Number(e)),console.log(`Costo específico establecido para ${r}: ${this.costosEmbarque[r]}`)):(this.$delete(this.costosEmbarque,r),console.log("Costo específico eliminado para "+r)),await Object(i["r"])(t,{costosPorMedida:this.costosEmbarque}),this.cerrarModalCostoEmbarque(),console.log("Costo del embarque actualizado correctamente")}catch(a){console.error("Error al actualizar el costo del embarque:",a),alert("Error al actualizar el costo del embarque")}},async limpiarCostoEspecifico(e){if(confirm(`¿Volver al costo global para "${e}"?`))try{const a=Object(i["h"])(),o=this.$route.params.id,t=Object(i["e"])(a,"embarques",o);this.$delete(this.costosEmbarque,e),await Object(i["r"])(t,{costosPorMedida:this.costosEmbarque}),console.log(`Costo específico eliminado para ${e}, volviendo al costo global`)}catch(a){console.error("Error al eliminar el costo específico:",a),alert("Error al eliminar el costo específico")}},async guardarSeleccionMedidas(){try{const e=Object(i["h"])(),a=this.$route.params.id,o=Object(i["e"])(e,"embarques",a);await Object(i["r"])(o,{medidaSeleccionada:this.medidaSeleccionada}),console.log("Selección de medidas guardada correctamente")}catch(e){console.error("Error al guardar la selección de medidas:",e)}},async guardarConfiguracionCostoExtra(){try{const e=Object(i["h"])(),a=this.$route.params.id,o=Object(i["e"])(e,"embarques",a);await Object(i["r"])(o,{aplicarCostoExtra:this.aplicarCostoExtra}),console.log("Configuración de costo extra guardada correctamente")}catch(e){console.error("Error al guardar la configuración de costo extra:",e)}},async guardarCostoExtra(){try{const e=Object(i["h"])(),a=this.$route.params.id,o=Object(i["e"])(e,"embarques",a);await Object(i["r"])(o,{costoExtra:Number(this.costoExtra)||18}),console.log("Costo extra guardado correctamente")}catch(e){console.error("Error al guardar el costo extra:",e)}},volverAEmbarque(){this.$router.push({name:"EditarEmbarque",params:{id:this.$route.params.id}})},volverARendimientos(){this.$router.push({name:"Rendimientos",params:{id:this.$route.params.id}})},async inicializarConfiguracionCostoExtra(){if(Object.keys(this.aplicarCostoExtra).length>0)return;let e=!1;this.medidasEmbarque.forEach(a=>{const o=a.includes("Maquila Ozuna"),t=/^\d+\/\d+/.test(a.trim())||/^\d+\s/.test(a.trim())||/^\d+$/.test(a.trim());!o&&t?(this.$set(this.aplicarCostoExtra,a,!0),e=!0):this.$set(this.aplicarCostoExtra,a,!1)}),e&&await this.guardarConfiguracionCostoExtra()},normalizarMedida(e){return e?e.toLowerCase().trim().replace(/\s+/g," ").replace(/\s*\/\s*/g,"/").replace(/\s*-\s*/g,"-"):""},encontrarCostoParaMedida(e){if(!e)return null;if(console.log(`🔍 Buscando costo para: "${e}"`),this.costosRegistrados[e])return console.log(`✓ Coincidencia exacta encontrada: "${e}"`),{medidaEncontrada:e,costo:this.costosRegistrados[e].costoBase};if(e.includes("Maquila Ozuna")){const a=e.replace(" Maquila Ozuna","").trim();if(console.log(`🔍 Buscando medida base sin "Maquila Ozuna": "${a}"`),this.costosRegistrados[a])return console.log(`✓ Encontrado costo para medida base: "${a}"`),{medidaEncontrada:a,costo:this.costosRegistrados[a].costoBase}}const a=this.normalizarMedida(e);console.log(`🔍 Medida normalizada: "${a}"`);for(const[t,r]of Object.entries(this.costosRegistrados)){const e=this.normalizarMedida(t);if(a===e)return console.log(`✓ Coincidencia normalizada encontrada: "${t}"`),{medidaEncontrada:t,costo:r.costoBase}}const o=a.replace(/\s+maquila\s+ozuna/g,"").replace(/\s+c\/c/g,"").trim();console.log(`🔍 Buscando coincidencias parciales para: "${o}"`);for(const[t,r]of Object.entries(this.costosRegistrados)){const e=this.normalizarMedida(t);if(o.includes(e)&&e.length>2)return console.log(`✓ Coincidencia parcial encontrada (registrada contenida en embarque): "${t}"`),{medidaEncontrada:t,costo:r.costoBase};if(e.includes(o)&&o.length>2)return console.log(`✓ Coincidencia parcial encontrada (embarque contenido en registrada): "${t}"`),{medidaEncontrada:t,costo:r.costoBase}}return console.log(`✗ No se encontró coincidencia para: "${e}"`),null},async sugerirCrearMedidasFaltantes(){const e=[],a=new Set;if(this.medidasEmbarque.forEach(o=>{if(!this.costosEmbarque[o]&&!this.encontrarCostoParaMedida(o))if(e.push(o),o.includes("Maquila Ozuna")){const e=o.replace(" Maquila Ozuna","").trim();a.add(e)}else a.add(o)}),e.length>0){console.log("📝 Medidas sin costo encontradas: "+e.join(", "));const o=Array.from(a),t=`Se encontraron ${e.length} medidas sin costo asignado:\n\n${e.map(e=>"• "+e).join("\n")}\n\nSe crearán ${o.length} medidas base:\n\n${o.map(e=>"• "+e).join("\n")}\n\n¿Desea crear estas medidas con un costo base de $130?\n\n(Podrá editarlas después individualmente si es necesario)`;confirm(t)&&await this.crearMedidasFaltantes(o)}else alert("Todas las medidas ya tienen costos asignados.")},async crearMedidasFaltantes(e){try{const a=Object(i["h"])(),o=new Date;o.setHours(12,0,0,0);const t=o.toISOString().split("T")[0],r=e.map(e=>Object(i["b"])(Object(i["c"])(a,"historial_costos"),{medida:e,costoBase:130,timestamp:o,fecha:t,nuevo:!0}));await Promise.all(r),console.log(`✓ Se crearon ${e.length} medidas faltantes`),alert(`Se crearon ${e.length} medidas con costo base de $130`)}catch(a){console.error("Error al crear medidas faltantes:",a),alert("Error al crear las medidas faltantes")}},async aplicarCostosRegistrados(){let e=!1;if(console.log("Medidas del embarque:",this.medidasEmbarque),console.log("Costos registrados disponibles:",Object.keys(this.costosRegistrados)),this.medidasEmbarque.forEach(a=>{const o=this.encontrarCostoParaMedida(a);if(o){const t=o.costo,r=this.costosEmbarque[a];r?console.log(`→ Manteniendo costo específico de ${a}: ${r} (no se sobrescribe con costo global: ${t})`):(this.$set(this.costosEmbarque,a,t),e=!0,console.log(`✓ Aplicando costo global de ${a}: ${t} (encontrado como: ${o.medidaEncontrada})`))}else console.log("✗ No se encontró costo para la medida: "+a)}),e)try{const e=Object(i["h"])(),a=this.$route.params.id,o=Object(i["e"])(e,"embarques",a);await Object(i["r"])(o,{costosPorMedida:this.costosEmbarque}),console.log("Costos sincronizados correctamente")}catch(a){console.error("Error al guardar costos aplicados:",a)}},async verHistorial(e){this.medidaSeleccionadaHistorial=e,this.mostrarModalHistorial=!0,this.cargandoHistorial=!0;try{const a=Object(i["h"])(),o=Object(i["c"])(a,"historial_costos"),t=Object(i["o"])(o,Object(i["s"])("medida","==",e)),r=await Object(i["g"])(t),s=r.docs.map(e=>({id:e.id,...e.data()}));this.historialCostos=s.sort((e,a)=>{var o,t,r,i;const s=(null===(o=e.timestamp)||void 0===o||null===(t=o.toDate)||void 0===t?void 0:t.call(o))||new Date(e.timestamp),d=(null===(r=a.timestamp)||void 0===r||null===(i=r.toDate)||void 0===i?void 0:i.call(r))||new Date(a.timestamp);return d-s})}catch(a){console.error("Error al cargar historial:",a),this.historialCostos=[]}finally{this.cargandoHistorial=!1}},cerrarModalHistorial(){this.mostrarModalHistorial=!1,this.medidaSeleccionadaHistorial="",this.historialCostos=[],this.cargandoHistorial=!1},async sincronizarCostos(){try{await this.sincronizarCostosForzado(),alert("Costos sincronizados con los valores más recientes.")}catch(e){console.error("Error al sincronizar costos:",e),alert("Error al sincronizar costos.")}},async sincronizarCostosForzado(){let e=!1;if(this.medidasEmbarque.forEach(a=>{const o=this.encontrarCostoParaMedida(a);if(o){const t=o.costo,r=this.costosEmbarque[a];r&&r===t||(this.$set(this.costosEmbarque,a,t),e=!0,console.log(`✓ Sincronización forzada - Actualizando costo de ${a}: ${r} -> ${t} (encontrado como: ${o.medidaEncontrada})`))}else console.log("✗ No se encontró costo para sincronizar: "+a)}),e)try{const e=Object(i["h"])(),a=this.$route.params.id,o=Object(i["e"])(e,"embarques",a);await Object(i["r"])(o,{costosPorMedida:this.costosEmbarque}),console.log("Costos sincronizados forzadamente")}catch(a){console.error("Error al guardar costos sincronizados:",a)}},formatearFecha(e){if(!e)return"N/A";try{if("string"===typeof e){const[a,o,t]=e.split("-");return`${t}/${o}/${a}`}if(e.toDate&&"function"===typeof e.toDate?e=e.toDate():e.seconds&&(e=new Date(1e3*e.seconds)),e instanceof Date){const a=e.getDate().toString().padStart(2,"0"),o=(e.getMonth()+1).toString().padStart(2,"0"),t=e.getFullYear();return`${a}/${o}/${t}`}return"Fecha inválida"}catch(a){return console.error("Error al formatear fecha:",a),"Error en fecha"}},formatearFechaCompleta(e){if(!e)return"N/A";try{if("string"===typeof e){const[a,o,t]=e.split("-");return new Date(a,o-1,t).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}return e.toDate&&"function"===typeof e.toDate?e=e.toDate():e.seconds&&(e=new Date(1e3*e.seconds)),e instanceof Date?e.toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Fecha inválida"}catch(a){return console.error("Error al formatear fecha completa:",a),"Error en fecha"}}},computed:{medidasVisibles(){return this.medidasEmbarque.filter(e=>!this.medidaOculta[e])},costosActuales(){const e={};return this.medidasEmbarque.forEach(a=>{if(this.costosEmbarque[a])e[a]=Number(this.costosEmbarque[a]).toFixed(2);else{const o=this.encontrarCostoParaMedida(a);e[a]=o?Number(o.costo).toFixed(2):"0.00"}}),e}},beforeDestroy(){this.unsubscribePreciosGlobales&&this.unsubscribePreciosGlobales(),this.guardarCostoExtraDebounced&&this.guardarCostoExtraDebounced.cancel&&this.guardarCostoExtraDebounced.cancel()}},l=n,u=(o("8556"),o("2877")),m=Object(u["a"])(l,t,r,!1,null,"5e5b32e8",null);a["a"]=m.exports},"6a68":function(e,a,o){},"7dfe":function(e,a,o){},8556:function(e,a,o){"use strict";o("6a68")},"8cca":function(e,a,o){"use strict";var t=function(){var e,a,o=this,t=o._self._c;return o.mostrar?t("div",{staticClass:"modal-overlay",on:{click:o.cerrarModal}},[t("div",{staticClass:"modal-content",on:{click:function(e){e.stopPropagation()}}},[t("div",{staticClass:"modal-header"},[t("h2",[o._v("Gestionar Proveedores y Medidas de Crudos")]),t("button",{staticClass:"close-button",on:{click:function(e){return o.$emit("cerrar")}}},[o._v("×")])]),t("div",{staticClass:"modal-body"},[t("div",{staticClass:"seccion-proveedores"},[t("div",{staticClass:"seccion-header"},[t("h3",[o._v("Proveedores de Crudos")]),t("button",{staticClass:"btn-agregar",on:{click:function(e){o.mostrarFormularioProveedor=!o.mostrarFormularioProveedor}}},[o._v(" + Nuevo Proveedor ")])]),o.mostrarFormularioProveedor?t("div",{staticClass:"formulario-proveedor"},[t("div",{staticClass:"form-row"},[t("input",{directives:[{name:"model",rawName:"v-model",value:o.nuevoProveedor.nombre,expression:"nuevoProveedor.nombre"}],staticClass:"form-input",attrs:{placeholder:"Nombre del proveedor",required:""},domProps:{value:o.nuevoProveedor.nombre},on:{keyup:function(e){return!e.type.indexOf("key")&&o._k(e.keyCode,"enter",13,e.key,"Enter")?null:o.agregarProveedor.apply(null,arguments)},input:function(e){e.target.composing||o.$set(o.nuevoProveedor,"nombre",e.target.value)}}}),t("input",{directives:[{name:"model",rawName:"v-model",value:o.nuevoProveedor.contacto,expression:"nuevoProveedor.contacto"}],staticClass:"form-input",attrs:{placeholder:"Contacto (opcional)"},domProps:{value:o.nuevoProveedor.contacto},on:{input:function(e){e.target.composing||o.$set(o.nuevoProveedor,"contacto",e.target.value)}}}),t("button",{staticClass:"btn-guardar",attrs:{disabled:o.guardandoProveedor},on:{click:o.agregarProveedor}},[o._v(" "+o._s(o.guardandoProveedor?"Guardando...":"Guardar")+" ")]),t("button",{staticClass:"btn-cancelar",on:{click:o.cancelarProveedor}},[o._v(" Cancelar ")])])]):o._e(),t("div",{staticClass:"lista-proveedores"},[o.cargandoProveedores?t("div",{staticClass:"loading"},[o._v("Cargando proveedores...")]):0===o.proveedores.length?t("div",{staticClass:"no-datos"},[o._v(" No hay proveedores registrados. Agrega el primer proveedor. ")]):t("div",o._l(o.proveedores,(function(e){var a;return t("div",{key:e.id,staticClass:"proveedor-card",class:{selected:(null===(a=o.proveedorSeleccionado)||void 0===a?void 0:a.id)===e.id},on:{click:function(a){return o.seleccionarProveedor(e)}}},[t("div",{staticClass:"proveedor-info"},[t("h4",[o._v(o._s(e.nombre))]),e.contacto?t("p",{staticClass:"contacto"},[o._v(o._s(e.contacto))]):o._e(),t("p",{staticClass:"medidas-count"},[o._v(" "+o._s(o.contarMedidasProveedor(e.id))+" medida(s) registrada(s) ")])]),t("div",{staticClass:"proveedor-acciones"},[t("button",{staticClass:"btn-editar",attrs:{title:"Editar"},on:{click:function(a){return a.stopPropagation(),o.editarProveedor(e)}}},[o._v(" ✏️ ")]),t("button",{staticClass:"btn-eliminar",attrs:{title:"Eliminar"},on:{click:function(a){return a.stopPropagation(),o.eliminarProveedor(e)}}},[o._v(" 🗑️ ")])])])})),0)])]),o.proveedorSeleccionado?t("div",{staticClass:"seccion-medidas"},[t("div",{staticClass:"seccion-header"},[t("h3",[o._v("Medidas/Productos - "+o._s(o.proveedorSeleccionado.nombre))]),t("button",{staticClass:"btn-agregar",on:{click:function(e){o.mostrarFormularioMedida=!o.mostrarFormularioMedida}}},[o._v(" + Nueva Medida ")])]),o.mostrarFormularioMedida?t("div",{staticClass:"formulario-medida"},[t("div",{staticClass:"form-row"},[t("input",{directives:[{name:"model",rawName:"v-model",value:o.nuevaMedida.nombre,expression:"nuevaMedida.nombre"}],staticClass:"form-input",attrs:{placeholder:"Nombre de la medida/producto",required:""},domProps:{value:o.nuevaMedida.nombre},on:{keyup:function(e){return!e.type.indexOf("key")&&o._k(e.keyCode,"enter",13,e.key,"Enter")?null:o.agregarMedida.apply(null,arguments)},input:function(e){e.target.composing||o.$set(o.nuevaMedida,"nombre",e.target.value)}}}),t("input",{directives:[{name:"model",rawName:"v-model",value:o.nuevaMedida.descripcion,expression:"nuevaMedida.descripcion"}],staticClass:"form-input",attrs:{placeholder:"Descripción (opcional)"},domProps:{value:o.nuevaMedida.descripcion},on:{input:function(e){e.target.composing||o.$set(o.nuevaMedida,"descripcion",e.target.value)}}}),t("button",{staticClass:"btn-guardar",attrs:{disabled:o.guardandoMedida},on:{click:o.agregarMedida}},[o._v(" "+o._s(o.guardandoMedida?"Guardando...":"Guardar")+" ")]),t("button",{staticClass:"btn-cancelar",on:{click:o.cancelarMedida}},[o._v(" Cancelar ")])])]):o._e(),t("div",{staticClass:"lista-medidas"},[o.cargandoMedidas?t("div",{staticClass:"loading"},[o._v("Cargando medidas...")]):0===o.medidasProveedor.length?t("div",{staticClass:"no-datos"},[o._v(" No hay medidas registradas para este proveedor. Agrega la primera medida. ")]):t("div",{staticClass:"medidas-grid"},o._l(o.medidasProveedor,(function(e){return t("div",{key:e.id,staticClass:"medida-card"},[t("div",{staticClass:"medida-info"},[t("h5",[o._v(o._s(e.nombre))]),e.descripcion?t("p",{staticClass:"descripcion"},[o._v(o._s(e.descripcion))]):o._e(),e.precioActual?t("p",{staticClass:"precio-actual"},[o._v(" Precio actual: $"+o._s(o.formatearPrecio(e.precioActual))+" ")]):o._e(),t("p",{staticClass:"fecha-creacion"},[o._v(" Creado: "+o._s(o.formatearFecha(e.fechaCreacion))+" ")])]),t("div",{staticClass:"medida-acciones"},[t("button",{staticClass:"btn-historial",attrs:{title:"Ver historial de precios"},on:{click:function(a){return o.verHistorialPrecios(e)}}},[o._v(" 📊 ")]),t("button",{staticClass:"btn-editar",attrs:{title:"Editar"},on:{click:function(a){return o.editarMedida(e)}}},[o._v(" ✏️ ")]),t("button",{staticClass:"btn-eliminar",attrs:{title:"Eliminar"},on:{click:function(a){return o.eliminarMedida(e)}}},[o._v(" 🗑️ ")])])])})),0)])]):t("div",{staticClass:"mensaje-seleccionar"},[t("p",[o._v("Selecciona un proveedor para gestionar sus medidas/productos")])])]),o.editandoProveedor?t("div",{staticClass:"modal-overlay-edit",on:{click:o.cancelarEdicionProveedor}},[t("div",{staticClass:"modal-edit",on:{click:function(e){e.stopPropagation()}}},[t("div",{staticClass:"modal-header"},[t("h3",[o._v("Editar Proveedor")]),t("button",{staticClass:"close-button",on:{click:o.cancelarEdicionProveedor}},[o._v("×")])]),t("div",{staticClass:"modal-body-edit"},[t("div",{staticClass:"form-group"},[t("label",[o._v("Nombre:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:o.proveedorEditando.nombre,expression:"proveedorEditando.nombre"}],staticClass:"form-input",attrs:{required:""},domProps:{value:o.proveedorEditando.nombre},on:{input:function(e){e.target.composing||o.$set(o.proveedorEditando,"nombre",e.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",[o._v("Contacto:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:o.proveedorEditando.contacto,expression:"proveedorEditando.contacto"}],staticClass:"form-input",domProps:{value:o.proveedorEditando.contacto},on:{input:function(e){e.target.composing||o.$set(o.proveedorEditando,"contacto",e.target.value)}}})]),t("div",{staticClass:"form-actions"},[t("button",{staticClass:"btn-guardar",attrs:{disabled:o.guardandoProveedor},on:{click:o.guardarEdicionProveedor}},[o._v(" "+o._s(o.guardandoProveedor?"Guardando...":"Actualizar")+" ")]),t("button",{staticClass:"btn-cancelar",on:{click:o.cancelarEdicionProveedor}},[o._v(" Cancelar ")])])])])]):o._e(),o.editandoMedida?t("div",{staticClass:"modal-overlay-edit",on:{click:o.cancelarEdicionMedida}},[t("div",{staticClass:"modal-edit",on:{click:function(e){e.stopPropagation()}}},[t("div",{staticClass:"modal-header"},[t("h3",[o._v("Editar Medida")]),t("button",{staticClass:"close-button",on:{click:o.cancelarEdicionMedida}},[o._v("×")])]),t("div",{staticClass:"modal-body-edit"},[t("div",{staticClass:"form-group"},[t("label",[o._v("Nombre:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:o.medidaEditando.nombre,expression:"medidaEditando.nombre"}],staticClass:"form-input",attrs:{required:""},domProps:{value:o.medidaEditando.nombre},on:{input:function(e){e.target.composing||o.$set(o.medidaEditando,"nombre",e.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",[o._v("Descripción:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:o.medidaEditando.descripcion,expression:"medidaEditando.descripcion"}],staticClass:"form-input",domProps:{value:o.medidaEditando.descripcion},on:{input:function(e){e.target.composing||o.$set(o.medidaEditando,"descripcion",e.target.value)}}})]),t("div",{staticClass:"form-actions"},[t("button",{staticClass:"btn-guardar",attrs:{disabled:o.guardandoMedida},on:{click:o.guardarEdicionMedida}},[o._v(" "+o._s(o.guardandoMedida?"Guardando...":"Actualizar")+" ")]),t("button",{staticClass:"btn-cancelar",on:{click:o.cancelarEdicionMedida}},[o._v(" Cancelar ")])])])])]):o._e()]),t("HistorialPreciosCrudos",{attrs:{mostrar:o.mostrarHistorialPrecios,medida:o.medidaSeleccionada,"proveedor-id":null===(e=o.proveedorSeleccionado)||void 0===e?void 0:e.id,"proveedor-nombre":null===(a=o.proveedorSeleccionado)||void 0===a?void 0:a.nombre},on:{cerrar:o.cerrarHistorialPrecios,actualizado:o.onHistorialActualizado}})],1):o._e()},r=[],i=(o("14d9"),o("dc59")),s=o("1494"),d=function(){var e,a=this,o=a._self._c;return a.mostrar?o("div",{staticClass:"modal-overlay",on:{click:a.cerrarModal}},[o("div",{staticClass:"modal-content",on:{click:function(e){e.stopPropagation()}}},[o("div",{staticClass:"modal-header"},[o("div",{staticClass:"modal-title-info"},[o("h2",[a._v(a._s((null===(e=a.medida)||void 0===e?void 0:e.nombre)||"Producto"))]),o("span",{staticClass:"proveedor-badge"},[a._v(a._s(a.proveedorNombre))])]),o("button",{staticClass:"close-button",on:{click:function(e){return a.$emit("cerrar")}}},[a._v("×")])]),o("div",{staticClass:"modal-body"},[o("div",{staticClass:"producto-resumen"},[o("div",{staticClass:"precio-actual-section"},[o("div",{staticClass:"precio-principal"},[o("span",{staticClass:"label"},[a._v("Precio Actual")]),o("span",{staticClass:"precio-valor"},[a._v("$"+a._s(a.formatearPrecio(a.precioActual)))]),o("span",{staticClass:"fecha-actual"},[a._v(a._s(a.formatearFecha(a.fechaUltimoPrecio)))])]),o("div",{staticClass:"precio-estadisticas"},[o("div",{staticClass:"stat-item"},[o("span",{staticClass:"stat-numero"},[a._v(a._s(a.totalRegistros))]),o("span",{staticClass:"stat-label"},[a._v("Registros")])]),o("div",{staticClass:"stat-item"},[o("span",{staticClass:"stat-numero"},[a._v("$"+a._s(a.formatearPrecio(a.precioPromedio)))]),o("span",{staticClass:"stat-label"},[a._v("Promedio")])])])])]),o("div",{staticClass:"agregar-precio-section"},[o("div",{staticClass:"section-header"},[o("h3",[a._v("Actualizar Precio")]),o("button",{staticClass:"btn-toggle-form",class:{active:a.mostrarFormulario},on:{click:function(e){a.mostrarFormulario=!a.mostrarFormulario}}},[a._v(" "+a._s(a.mostrarFormulario?"×":"+")+" ")])]),a.mostrarFormulario?o("div",{staticClass:"precio-form"},[o("div",{staticClass:"form-grid"},[o("div",{staticClass:"form-group"},[o("label",[a._v("Nuevo Precio:")]),o("input",{directives:[{name:"model",rawName:"v-model.number",value:a.nuevoPrecio.precio,expression:"nuevoPrecio.precio",modifiers:{number:!0}}],ref:"precioInput",staticClass:"form-control precio-input",attrs:{type:"number",step:"0.01",placeholder:"0.00"},domProps:{value:a.nuevoPrecio.precio},on:{keyup:function(e){return!e.type.indexOf("key")&&a._k(e.keyCode,"enter",13,e.key,"Enter")?null:a.agregarPrecio.apply(null,arguments)},input:function(e){e.target.composing||a.$set(a.nuevoPrecio,"precio",a._n(e.target.value))},blur:function(e){return a.$forceUpdate()}}})]),o("div",{staticClass:"form-group"},[o("label",[a._v("Fecha:")]),o("input",{directives:[{name:"model",rawName:"v-model",value:a.nuevoPrecio.fecha,expression:"nuevoPrecio.fecha"}],staticClass:"form-control",attrs:{type:"date"},domProps:{value:a.nuevoPrecio.fecha},on:{input:function(e){e.target.composing||a.$set(a.nuevoPrecio,"fecha",e.target.value)}}})])]),o("div",{staticClass:"form-group"},[o("label",[a._v("Notas (opcional):")]),o("input",{directives:[{name:"model",rawName:"v-model",value:a.nuevoPrecio.notas,expression:"nuevoPrecio.notas"}],staticClass:"form-control",attrs:{type:"text",placeholder:"Ej: Precio especial, cambio de temporada, etc."},domProps:{value:a.nuevoPrecio.notas},on:{input:function(e){e.target.composing||a.$set(a.nuevoPrecio,"notas",e.target.value)}}})]),o("div",{staticClass:"form-actions"},[o("button",{staticClass:"btn-cancelar",on:{click:a.limpiarFormulario}},[a._v(" Cancelar ")]),o("button",{staticClass:"btn-guardar",attrs:{disabled:a.guardando||!a.esFormularioValido},on:{click:a.agregarPrecio}},[a._v(" "+a._s(a.guardando?"Guardando...":"Guardar Precio")+" ")])])]):a._e()]),o("div",{staticClass:"historial-section"},[o("h3",[a._v("Historial de Precios")]),a.historialPrecios.length>0?o("div",{staticClass:"precios-timeline"},a._l(a.preciosOrdenados,(function(e,t){return o("div",{key:e.id||t,staticClass:"precio-item",class:{"precio-actual":0===t}},[o("div",{staticClass:"precio-fecha-badge"},[a._v(" "+a._s(a.formatearFecha(e.fecha))+" ")]),o("div",{staticClass:"precio-info"},[o("div",{staticClass:"precio-monto"},[o("span",{staticClass:"precio-valor"},[a._v("$"+a._s(a.formatearPrecio(e.precio)))]),0===t?o("span",{staticClass:"actual-badge"},[a._v("Actual")]):a._e()]),e.notas?o("div",{staticClass:"precio-notas"},[a._v(" 📝 "+a._s(e.notas)+" ")]):a._e()]),o("div",{staticClass:"precio-actions"},[o("button",{staticClass:"btn-editar",attrs:{title:"Editar precio"},on:{click:function(o){return a.editarPrecio(e)}}},[a._v(" ✏️ ")]),a.historialPrecios.length>1?o("button",{staticClass:"btn-eliminar",attrs:{title:"Eliminar precio"},on:{click:function(o){return a.eliminarPrecio(e)}}},[a._v(" 🗑️ ")]):a._e()])])})),0):o("div",{staticClass:"no-historial"},[o("div",{staticClass:"no-historial-icon"},[a._v("📊")]),o("p",[a._v("No hay historial de precios disponible")])])])])])]):a._e()},c=[],n=(o("13d5"),{name:"HistorialPreciosCrudos",props:{mostrar:{type:Boolean,required:!0},medida:{type:Object,default:null},proveedorId:{type:String,required:!0},proveedorNombre:{type:String,required:!0}},emits:["cerrar","actualizado"],data(){return{mostrarFormulario:!1,guardando:!1,nuevoPrecio:{precio:null,fecha:this.obtenerFechaActual(),notas:""},historialPrecios:[]}},computed:{esFormularioValido(){return this.nuevoPrecio.precio&&this.nuevoPrecio.precio>0&&this.nuevoPrecio.fecha},preciosOrdenados(){return this.historialPrecios.length?[...this.historialPrecios].sort((e,a)=>new Date(a.fecha)-new Date(e.fecha)):[]},precioActual(){return this.historialPrecios.length?this.preciosOrdenados[0].precio:0},fechaUltimoPrecio(){var e;return this.historialPrecios.length?this.preciosOrdenados[0].fecha:null===(e=this.medida)||void 0===e?void 0:e.fechaCreacion},totalRegistros(){return this.historialPrecios.length},precioPromedio(){if(!this.historialPrecios.length)return 0;const e=this.historialPrecios.reduce((e,a)=>e+a.precio,0);return e/this.historialPrecios.length}},methods:{cerrarModal(e){e.target===e.currentTarget&&this.$emit("cerrar")},obtenerFechaActual(){const e=new Date;return e.toISOString().split("T")[0]},async cargarHistorialPrecios(){var e;if(null!==(e=this.medida)&&void 0!==e&&e.id)try{const e=Object(s["o"])(Object(s["c"])(i["a"],"historialPreciosCrudos"),Object(s["s"])("medidaId","==",this.medida.id),Object(s["s"])("proveedorId","==",this.proveedorId)),a=await Object(s["g"])(e);this.historialPrecios=a.docs.map(e=>({id:e.id,...e.data()}))}catch(a){console.error("Error al cargar historial de precios:",a),this.historialPrecios=[]}},async agregarPrecio(){if(this.esFormularioValido)try{this.guardando=!0;const e={proveedorId:this.proveedorId,proveedorNombre:this.proveedorNombre,medidaId:this.medida.id,medidaNombre:this.medida.nombre,precio:this.nuevoPrecio.precio,fecha:this.nuevoPrecio.fecha,notas:this.nuevoPrecio.notas||"",fechaCreacion:(new Date).toISOString().split("T")[0]},a=await Object(s["b"])(Object(s["c"])(i["a"],"historialPreciosCrudos"),e);this.historialPrecios.push({id:a.id,...e}),this.limpiarFormulario(),this.$emit("actualizado")}catch(e){console.error("Error al agregar precio: ",e),alert("Error al agregar precio: "+e.message)}finally{this.guardando=!1}else alert("Por favor complete el precio y la fecha")},limpiarFormulario(){this.nuevoPrecio={precio:null,fecha:this.obtenerFechaActual(),notas:""},this.mostrarFormulario=!1},editarPrecio(e){const a=prompt("Nuevo precio:",e.precio);a&&!isNaN(parseFloat(a))&&this.actualizarPrecio(e.id,parseFloat(a))},async actualizarPrecio(e,a){try{await Object(s["r"])(Object(s["e"])(i["a"],"historialPreciosCrudos",e),{precio:a});const o=this.historialPrecios.findIndex(a=>a.id===e);-1!==o&&(this.historialPrecios[o].precio=a),this.$emit("actualizado")}catch(o){console.error("Error al actualizar precio:",o),alert("Error al actualizar precio")}},async eliminarPrecio(e){if(confirm(`¿Está seguro de eliminar el precio del ${this.formatearFecha(e.fecha)}?`))try{await Object(s["d"])(Object(s["e"])(i["a"],"historialPreciosCrudos",e.id)),this.historialPrecios=this.historialPrecios.filter(a=>a.id!==e.id),this.$emit("actualizado")}catch(a){console.error("Error al eliminar precio:",a),alert("Error al eliminar precio")}},formatearFecha(e){if(!e)return"";const a=new Date(e+"T00:00:00"),o={day:"numeric",month:"short",year:"numeric"};return a.toLocaleDateString("es-ES",o)},formatearPrecio(e){return e?e.toLocaleString("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00"}},watch:{mostrar(e){e&&(this.cargarHistorialPrecios(),this.limpiarFormulario())},mostrarFormulario(e){e&&this.$nextTick(()=>{this.$refs.precioInput&&this.$refs.precioInput.focus()})}}}),l=n,u=(o("ab3e"),o("2877")),m=Object(u["a"])(l,d,c,!1,null,"3cdcea5e",null),v=m.exports,p={name:"GestionProveedoresCrudos",components:{HistorialPreciosCrudos:v},props:{mostrar:{type:Boolean,required:!0}},emits:["cerrar","actualizado"],data(){return{cargandoProveedores:!1,cargandoMedidas:!1,guardandoProveedor:!1,guardandoMedida:!1,proveedores:[],medidas:[],proveedorSeleccionado:null,mostrarFormularioProveedor:!1,mostrarFormularioMedida:!1,nuevoProveedor:{nombre:"",contacto:""},nuevaMedida:{nombre:"",descripcion:""},editandoProveedor:!1,editandoMedida:!1,proveedorEditando:{},medidaEditando:{},mostrarHistorialPrecios:!1,medidaSeleccionada:null}},computed:{medidasProveedor(){return this.proveedorSeleccionado?this.medidas.filter(e=>e.proveedorId===this.proveedorSeleccionado.id):[]}},methods:{cerrarModal(e){e.target===e.currentTarget&&this.$emit("cerrar")},async cargarProveedores(){try{this.cargandoProveedores=!0;const e=await Object(s["g"])(Object(s["c"])(i["a"],"proveedoresCrudos"));this.proveedores=e.docs.map(e=>({id:e.id,...e.data()})),this.proveedores.sort((e,a)=>e.nombre.localeCompare(a.nombre))}catch(e){console.error("Error al cargar proveedores:",e),alert("Error al cargar proveedores")}finally{this.cargandoProveedores=!1}},async agregarProveedor(){if(this.nuevoProveedor.nombre.trim())if(this.proveedores.some(e=>e.nombre.toLowerCase()===this.nuevoProveedor.nombre.toLowerCase()))alert("Ya existe un proveedor con ese nombre");else try{this.guardandoProveedor=!0;const e={nombre:this.nuevoProveedor.nombre.trim(),contacto:this.nuevoProveedor.contacto.trim()||null,fechaCreacion:new Date,tipo:"crudos"},a=await Object(s["b"])(Object(s["c"])(i["a"],"proveedoresCrudos"),e);this.proveedores.push({id:a.id,...e}),this.proveedores.sort((e,a)=>e.nombre.localeCompare(a.nombre)),this.cancelarProveedor(),this.$emit("actualizado")}catch(e){console.error("Error al agregar proveedor:",e),alert("Error al agregar proveedor")}finally{this.guardandoProveedor=!1}else alert("El nombre del proveedor es requerido")},editarProveedor(e){this.proveedorEditando={...e},this.editandoProveedor=!0},async guardarEdicionProveedor(){if(this.proveedorEditando.nombre.trim())try{var e,a;this.guardandoProveedor=!0;const o=Object(s["e"])(i["a"],"proveedoresCrudos",this.proveedorEditando.id),t={nombre:this.proveedorEditando.nombre.trim(),contacto:(null===(e=this.proveedorEditando.contacto)||void 0===e?void 0:e.trim())||null};await Object(s["r"])(o,t);const r=this.proveedores.findIndex(e=>e.id===this.proveedorEditando.id);-1!==r&&(this.proveedores[r]={...this.proveedores[r],...t}),(null===(a=this.proveedorSeleccionado)||void 0===a?void 0:a.id)===this.proveedorEditando.id&&(this.proveedorSeleccionado={...this.proveedorSeleccionado,...t}),this.cancelarEdicionProveedor(),this.$emit("actualizado")}catch(o){console.error("Error al actualizar proveedor:",o),alert("Error al actualizar proveedor")}finally{this.guardandoProveedor=!1}else alert("El nombre del proveedor es requerido")},async eliminarProveedor(e){const a=this.medidas.filter(a=>a.proveedorId===e.id);let o=`¿Estás seguro de que quieres eliminar el proveedor "${e.nombre}"?`;if(a.length>0&&(o+=`\n\nEsto también eliminará ${a.length} medida(s) asociada(s).`),confirm(o))try{var t;for(const e of a)await Object(s["d"])(Object(s["e"])(i["a"],"medidasCrudos",e.id));await Object(s["d"])(Object(s["e"])(i["a"],"proveedoresCrudos",e.id)),this.proveedores=this.proveedores.filter(a=>a.id!==e.id),this.medidas=this.medidas.filter(a=>a.proveedorId!==e.id),(null===(t=this.proveedorSeleccionado)||void 0===t?void 0:t.id)===e.id&&(this.proveedorSeleccionado=null),this.$emit("actualizado")}catch(r){console.error("Error al eliminar proveedor:",r),alert("Error al eliminar proveedor")}},cancelarProveedor(){this.nuevoProveedor={nombre:"",contacto:""},this.mostrarFormularioProveedor=!1},cancelarEdicionProveedor(){this.editandoProveedor=!1,this.proveedorEditando={}},seleccionarProveedor(e){this.proveedorSeleccionado=e,this.cargarMedidas(),this.mostrarFormularioMedida=!1},async cargarMedidas(){try{this.cargandoMedidas=!0;const e=await Object(s["g"])(Object(s["c"])(i["a"],"medidasCrudos"));this.medidas=e.docs.map(e=>({id:e.id,...e.data()})),await this.cargarPreciosActuales()}catch(e){console.error("Error al cargar medidas:",e),alert("Error al cargar medidas")}finally{this.cargandoMedidas=!1}},async cargarPreciosActuales(){try{const e=await Object(s["g"])(Object(s["c"])(i["a"],"historialPreciosCrudos")),a=e.docs.map(e=>e.data()),o={};a.forEach(e=>{o[e.medidaId]||(o[e.medidaId]=[]),o[e.medidaId].push(e)}),Object.keys(o).forEach(e=>{const a=o[e],t=a.sort((e,a)=>new Date(a.fecha)-new Date(e.fecha))[0],r=this.medidas.findIndex(a=>a.id===e);-1!==r&&(this.medidas[r].precioActual=t.precio)})}catch(e){console.error("Error al cargar precios actuales:",e)}},async agregarMedida(){if(!this.nuevaMedida.nombre.trim())return void alert("El nombre de la medida es requerido");if(!this.proveedorSeleccionado)return void alert("Debe seleccionar un proveedor");const e=this.medidas.some(e=>e.proveedorId===this.proveedorSeleccionado.id&&e.nombre.toLowerCase()===this.nuevaMedida.nombre.toLowerCase());if(e)alert("Ya existe una medida con ese nombre para este proveedor");else try{this.guardandoMedida=!0;const e={nombre:this.nuevaMedida.nombre.trim(),descripcion:this.nuevaMedida.descripcion.trim()||null,proveedorId:this.proveedorSeleccionado.id,proveedorNombre:this.proveedorSeleccionado.nombre,fechaCreacion:new Date,tipo:"crudos"},a=await Object(s["b"])(Object(s["c"])(i["a"],"medidasCrudos"),e);this.medidas.push({id:a.id,...e}),this.cancelarMedida(),this.$emit("actualizado")}catch(a){console.error("Error al agregar medida:",a),alert("Error al agregar medida")}finally{this.guardandoMedida=!1}},editarMedida(e){this.medidaEditando={...e},this.editandoMedida=!0},async guardarEdicionMedida(){if(this.medidaEditando.nombre.trim())try{var e;this.guardandoMedida=!0;const a=Object(s["e"])(i["a"],"medidasCrudos",this.medidaEditando.id),o={nombre:this.medidaEditando.nombre.trim(),descripcion:(null===(e=this.medidaEditando.descripcion)||void 0===e?void 0:e.trim())||null};await Object(s["r"])(a,o);const t=this.medidas.findIndex(e=>e.id===this.medidaEditando.id);-1!==t&&(this.medidas[t]={...this.medidas[t],...o}),this.cancelarEdicionMedida(),this.$emit("actualizado")}catch(a){console.error("Error al actualizar medida:",a),alert("Error al actualizar medida")}finally{this.guardandoMedida=!1}else alert("El nombre de la medida es requerido")},async eliminarMedida(e){if(confirm(`¿Estás seguro de que quieres eliminar la medida "${e.nombre}"?`))try{await Object(s["d"])(Object(s["e"])(i["a"],"medidasCrudos",e.id)),this.medidas=this.medidas.filter(a=>a.id!==e.id),this.$emit("actualizado")}catch(a){console.error("Error al eliminar medida:",a),alert("Error al eliminar medida")}},cancelarMedida(){this.nuevaMedida={nombre:"",descripcion:""},this.mostrarFormularioMedida=!1},cancelarEdicionMedida(){this.editandoMedida=!1,this.medidaEditando={}},contarMedidasProveedor(e){return this.medidas.filter(a=>a.proveedorId===e).length},formatearPrecio(e){return e?e.toLocaleString("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00"},formatearFecha(e){if(!e)return"";const a=e instanceof Date?e:e.toDate();return a.toLocaleDateString("es-ES",{day:"numeric",month:"short",year:"numeric"})},verHistorialPrecios(e){this.medidaSeleccionada=e,this.mostrarHistorialPrecios=!0},cerrarHistorialPrecios(){this.mostrarHistorialPrecios=!1,this.medidaSeleccionada=null},onHistorialActualizado(){this.cargarPreciosActuales(),this.$emit("actualizado")}},async mounted(){await Promise.all([this.cargarProveedores(),this.cargarMedidas()])}},h=p,b=(o("d36d"),Object(u["a"])(h,t,r,!1,null,"a0077b3c",null));a["a"]=b.exports},9226:function(e,a,o){"use strict";o("928d")},"928d":function(e,a,o){},"9d22":function(e,a,o){},"9df4":function(e,a,o){"use strict";var t=function(){var e=this,a=e._self._c;return e.isOpen?a("div",{staticClass:"modal-overlay",on:{click:e.closeModal}},[a("div",{staticClass:"modal-content",on:{click:function(e){e.stopPropagation()}}},[a("h2",[e._v("Historial de Producto")]),a("div",{staticClass:"form-group"},[a("select",{directives:[{name:"model",rawName:"v-model",value:e.filtros.tipo,expression:"filtros.tipo"}],on:{change:[function(a){var o=Array.prototype.filter.call(a.target.options,(function(e){return e.selected})).map((function(e){var a="_value"in e?e._value:e.value;return a}));e.$set(e.filtros,"tipo",a.target.multiple?o:o[0])},e.resetSelections]}},[a("option",{attrs:{value:""}},[e._v("Seleccionar Tipo")]),a("option",{attrs:{value:"proveedor"}},[e._v("Proveedor")]),a("option",{attrs:{value:"maquila"}},[e._v("Maquila")])]),a("select",{directives:[{name:"model",rawName:"v-model",value:e.filtros.proveedor,expression:"filtros.proveedor"}],on:{change:[function(a){var o=Array.prototype.filter.call(a.target.options,(function(e){return e.selected})).map((function(e){var a="_value"in e?e._value:e.value;return a}));e.$set(e.filtros,"proveedor",a.target.multiple?o:o[0])},e.onProveedorChange]}},[a("option",{attrs:{value:""}},[e._v("Seleccionar "+e._s("maquila"===e.filtros.tipo?"Maquila":"Proveedor"))]),e._l(e.proveedoresFiltrados,(function(o){return a("option",{key:o.id,domProps:{value:o.nombre}},[e._v(" "+e._s(o.nombre)+" ")])}))],2),a("select",{directives:[{name:"model",rawName:"v-model",value:e.filtros.medida,expression:"filtros.medida"}],on:{change:function(a){var o=Array.prototype.filter.call(a.target.options,(function(e){return e.selected})).map((function(e){var a="_value"in e?e._value:e.value;return a}));e.$set(e.filtros,"medida",a.target.multiple?o:o[0])}}},[a("option",{attrs:{value:""}},[e._v("Seleccionar Medida")]),e._l(e.medidasFiltradas,(function(o){return a("option",{key:o.id,domProps:{value:o.nombre}},[e._v(" "+e._s(o.nombre)+" ")])}))],2),a("select",{directives:[{name:"model",rawName:"v-model",value:e.filtros.movimiento,expression:"filtros.movimiento"}],on:{change:function(a){var o=Array.prototype.filter.call(a.target.options,(function(e){return e.selected})).map((function(e){var a="_value"in e?e._value:e.value;return a}));e.$set(e.filtros,"movimiento",a.target.multiple?o:o[0])}}},[a("option",{attrs:{value:""}},[e._v("Tipo de Movimiento")]),a("option",{attrs:{value:"entradas"}},[e._v("Entradas")]),a("option",{attrs:{value:"salidas"}},[e._v("Salidas")])]),a("button",{attrs:{disabled:!e.isFormValid},on:{click:e.buscarHistorial}},[e._v("Buscar")])]),e.historial.length>0?a("div",{staticClass:"results-container"},[a("table",[e._m(0),a("tbody",e._l(e.historial,(function(o,t){return a("tr",{key:t},[a("td",[e._v(e._s(e.formatDate(o.fecha)))]),a("td",[e._v(e._s(e.formatNumber(o.kilos))+" kg")]),a("td",[e._v(e._s(o.precio?"$"+o.precio:"-"))])])})),0),a("tfoot",[a("tr",[e._m(1),a("td",[a("strong",[e._v(e._s(e.formatNumber(e.totalKilos))+" kg")])]),a("td")])])])]):e.busquedaRealizada?a("div",{staticClass:"no-results"},[e._v(" No se encontraron registros para los criterios seleccionados. ")]):e._e(),a("button",{staticClass:"close-button",on:{click:e.closeModal}},[e._v("×")])])]):e._e()},r=[function(){var e=this,a=e._self._c;return a("thead",[a("tr",[a("th",[e._v("Fecha")]),a("th",[e._v("Kilos")]),a("th",[e._v("Precio")])])])},function(){var e=this,a=e._self._c;return a("td",[a("strong",[e._v("Total")])])}],i=(o("14d9"),o("13d5"),o("dc59")),s=o("1494"),d=o("c1df"),c=o.n(d),n={name:"HistorialProductoModal",props:{isOpen:{type:Boolean,required:!0},proveedores:{type:Array,required:!0},medidas:{type:Array,required:!0}},data(){return{filtros:{tipo:"",proveedor:"",medida:"",movimiento:""},historial:[],busquedaRealizada:!1}},computed:{proveedoresFiltrados(){return this.proveedores.filter(e=>e.tipo===this.filtros.tipo)},medidasFiltradas(){if("maquila"===this.filtros.tipo){const e=this.proveedores.find(e=>e.nombre===this.filtros.proveedor);return e?this.medidas.filter(a=>"maquila"===a.tipo&&a.maquilaId===e.id):[]}{const e=this.proveedores.find(e=>e.nombre===this.filtros.proveedor);return e?this.medidas.filter(a=>a.proveedorId===e.id||!a.proveedorId&&"general"===a.tipo):this.medidas.filter(e=>"general"===e.tipo)}},isFormValid(){return this.filtros.tipo&&this.filtros.proveedor&&this.filtros.medida&&this.filtros.movimiento},totalKilos(){return this.historial.reduce((e,a)=>e+a.kilos,0)}},methods:{resetSelections(){this.filtros.proveedor="",this.filtros.medida="",this.historial=[],this.busquedaRealizada=!1},onProveedorChange(){this.filtros.medida="",this.historial=[],this.busquedaRealizada=!1},async buscarHistorial(){try{const e=Object(s["c"])(i["a"],"sacadas"),a=Object(s["o"])(e,Object(s["l"])("fecha","desc")),o=await Object(s["g"])(a);this.historial=[],o.docs.forEach(e=>{const a=e.data(),o=a[this.filtros.movimiento]||[];o.forEach(e=>{e.tipo===this.filtros.tipo&&e.proveedor===this.filtros.proveedor&&e.medida===this.filtros.medida&&this.historial.push({fecha:a.fecha.toDate(),kilos:e.kilos,precio:e.precio})})}),this.busquedaRealizada=!0}catch(e){console.error("Error al buscar historial:",e),alert("Error al buscar el historial")}},formatDate(e){return c()(e).format("DD/MM/YYYY")},formatNumber(e){return e.toLocaleString("es-ES",{minimumFractionDigits:1,maximumFractionDigits:1})},closeModal(){this.$emit("close"),this.resetSelections()}}},l=n,u=(o("e45f"),o("2877")),m=Object(u["a"])(l,t,r,!1,null,"4cc8972a",null);a["a"]=m.exports},ab3e:function(e,a,o){"use strict";o("9d22")},c3cc:function(e,a,o){"use strict";o("4a6a")},d36d:function(e,a,o){"use strict";o("de31")},de31:function(e,a,o){},e45f:function(e,a,o){"use strict";o("7dfe")},e6b2:function(e,a,o){"use strict";o("1b56")}}]);