(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["app.76e92ee3"],{"0407":function(e,t,a){},"24d5":function(e,t,a){"use strict";var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"catarro-cuentas-menu-container"},[t("h1",[e._v("Menú de Cuentas Catarro")]),t("div",{staticClass:"actions-container actions-sticky"},[t("router-link",{staticClass:"action-button back-btn",attrs:{to:"/cuentas-mexico"}},[e._v(" Cuentas México ")]),t("router-link",{staticClass:"action-button new-cuenta-btn",attrs:{to:"/cuentas-catarro/nueva"}},[e._v(" Nueva Cuenta ")]),t("router-link",{staticClass:"action-button ventas-ganancias-btn",attrs:{to:"/ventas-ganancias-catarro"}},[e._v(" Ventas y Ganancias ")]),t("PreciosHistorialModal"),t("StashModalV2",{attrs:{cliente:"catarro"}})],1),t("div",{staticClass:"filter-container"},[t("label",{attrs:{for:"filter-select"}},[e._v("Filtrar por estado:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:e.filtroEstado,expression:"filtroEstado"}],attrs:{id:"filter-select"},on:{change:function(t){var a=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.filtroEstado=t.target.multiple?a:a[0]}}},[t("option",{attrs:{value:"todas"}},[e._v("Todas")]),t("option",{attrs:{value:"pagadas"}},[e._v("Pagadas")]),t("option",{attrs:{value:"no-pagadas"}},[e._v("No Pagadas")])])]),t("div",{staticClass:"cuentas-list card"},[t("h2",[e._v("Registros de Cuentas")]),e.isLoading?t("div",{staticClass:"loading"},[e._v("Cargando registros...")]):0===e.cuentasFiltradas.length?t("div",{staticClass:"no-records"},[e._v(" No hay registros de cuentas que coincidan con el filtro. ")]):t("ul",e._l(e.cuentasFiltradas,(function(a){return t("li",{key:a.id,staticClass:"cuenta-item",class:{"tiene-observacion":a.tieneObservacion||a.observacion&&a.observacion.trim().length}},[t("div",{staticClass:"cuenta-content"},[t("span",{staticClass:"cuenta-date"},[e._v(e._s(e.formatDate(a.fecha)))]),t("p",{staticClass:"cuenta-summary"},[t("span",[e._v("Saldo Hoy: $"+e._s(e.formatNumber(a.saldoHoy)))]),t("span",[e._v("Total Acumulado: $"+e._s(e.formatNumber(a.totalNota)))])]),a.tieneObservacion||a.observacion&&a.observacion.trim().length?t("div",{staticClass:"observacion-container"},[t("p",{staticClass:"observacion-texto"},[e._v(e._s(a.observacion))]),t("button",{staticClass:"delete-observacion-btn",attrs:{title:"Borrar observación"},on:{click:function(t){return e.borrarObservacion(a.id)}}},[e._v("×")])]):e._e(),a.abonos&&a.abonos.length>0?t("div",{staticClass:"abonos-info"},e._l(a.abonos,(function(a,s){return t("p",{key:s,staticClass:"abono-detail"},[t("span",{staticClass:"abono-label"},[e._v("Abono:")]),t("span",{staticClass:"abono-monto"},[e._v("$"+e._s(e.formatNumber(a.monto)))]),t("span",{staticClass:"abono-descripcion"},[e._v(e._s(a.descripcion||"Sin descripción"))])])})),0):e._e(),t("span",{class:["estado-cuenta",a.estadoPagado?"pagado":"no-pagado"]},[e._v(" "+e._s(a.estadoPagado?"Pagado":"No Pagado")+" ")])]),t("div",{staticClass:"cuenta-actions"},[t("button",{staticClass:"edit-btn",on:{click:function(t){return e.editarCuenta(a.id)}}},[e._v("Editar")]),t("button",{staticClass:"delete-btn",on:{click:function(t){return e.borrarCuenta(a.id)}}},[e._v("Borrar")])])])})),0)]),e.showSaveMessage&&e.lastSaveMessage?[t("div",{staticClass:"save-message"},[e._v(" "+e._s(e.lastSaveMessage)+" ")])]:e._e()],2)},o=[],i=(a("14d9"),a("13d5"),a("dc59")),n=a("1494"),r=a("74c9"),c=a("666c"),l=a("3f5a"),d={name:"CatarroCuentasMenu",components:{BackButton:r["a"],PreciosHistorialModal:c["a"],StashModalV2:l["a"]},data(){return{cuentas:[],isLoading:!0,filtroEstado:"todas",unsubscribe:null,lastSaveMessage:"",showSaveMessage:!1,saveMessageTimer:null}},computed:{cuentasFiltradas(){switch(this.filtroEstado){case"pagadas":return this.cuentas.filter(e=>e.estadoPagado);case"no-pagadas":return this.cuentas.filter(e=>!e.estadoPagado);default:return this.cuentas}}},methods:{async loadCuentas(){try{this.isLoading=!0;const e=Object(n["c"])(i["a"],"cuentasCatarro"),t=Object(n["o"])(e,Object(n["l"])("fecha","asc"));this.unsubscribe=Object(n["k"])(t,async e=>{const t=e.docs.map(e=>{const t=e.data(),a=(t.cobros||[]).reduce((e,t)=>e+(parseFloat(t.monto)||0),0),s=(t.abonos||[]).reduce((e,t)=>e+(parseFloat(t.monto)||0),0),o=(t.totalGeneralVenta||0)-a-s;return{id:e.id,fecha:t.fecha,saldoHoy:t.totalGeneralVenta||0,totalCobros:a,totalAbonos:s,totalNota:t.nuevoSaldoAcumulado||0,estadoPagado:0===o,nuevoSaldoAcumulado:t.nuevoSaldoAcumulado||0,saldoAcumuladoAnterior:t.saldoAcumuladoAnterior||0,abonos:t.abonos||[],tieneObservacion:t.tieneObservacion||!1,observacion:t.observacion||""}}),a=t.sort((e,t)=>new Date(e.fecha)-new Date(t.fecha));let s=0;const o=[];for(let i=0;i<a.length;i++){const e=a[i],t=e.saldoHoy-e.totalCobros-e.totalAbonos;s+=t;const n=0===i?0:a[i-1].nuevoSaldoAcumulado;e.saldoAcumuladoAnterior===n&&e.nuevoSaldoAcumulado===s||o.push({id:e.id,updates:{saldoAcumuladoAnterior:n,nuevoSaldoAcumulado:s,estadoPagado:0===t}}),e.totalNota=s,e.saldoAcumuladoAnterior=n,e.estadoPagado=0===t,s<=0&&(s=0)}o.length>0&&await Promise.all(o.map(({id:e,updates:t})=>Object(n["s"])(Object(n["e"])(i["a"],"cuentasCatarro",e),t))),this.cuentas=a.reverse(),this.isLoading=!1})}catch(e){console.error("Error al cargar cuentas: ",e),this.error=e.message,this.cuentas=[],this.isLoading=!1}},formatDate(e){const t=new Date(e);return t.setMinutes(t.getMinutes()+t.getTimezoneOffset()),t.toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"})},formatNumber(e){return e.toLocaleString("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2})},editarCuenta(e){this.$router.push(`/cuentas-catarro/${e}?edit=true`)},async borrarCuenta(e){if(confirm("¿Estás seguro de que quieres borrar este registro de cuenta?"))try{await Object(n["d"])(Object(n["e"])(i["a"],"cuentasCatarro",e)),"Registro de cuenta borrado con éxito"===this.lastSaveMessage&&this.showSaveMessage||(this.lastSaveMessage="Registro de cuenta borrado con éxito",this.showSaveMessage=!0,this.saveMessageTimer&&clearTimeout(this.saveMessageTimer),this.saveMessageTimer=setTimeout(()=>{this.showSaveMessage=!1},3e3))}catch(t){console.error("Error al borrar el registro de cuenta: ",t),"Error al borrar el registro de cuenta"===this.lastSaveMessage&&this.showSaveMessage||(this.lastSaveMessage="Error al borrar el registro de cuenta",this.showSaveMessage=!0,this.saveMessageTimer&&clearTimeout(this.saveMessageTimer),this.saveMessageTimer=setTimeout(()=>{this.showSaveMessage=!1},3e3))}},async borrarObservacion(e){if(confirm("¿Estás seguro de que quieres borrar esta observación?"))try{await Object(n["s"])(Object(n["e"])(i["a"],"cuentasCatarro",e),{tieneObservacion:!1,observacion:""}),"Observación borrada con éxito"===this.lastSaveMessage&&this.showSaveMessage||(this.lastSaveMessage="Observación borrada con éxito",this.showSaveMessage=!0,this.saveMessageTimer&&clearTimeout(this.saveMessageTimer),this.saveMessageTimer=setTimeout(()=>{this.showSaveMessage=!1},3e3))}catch(t){console.error("Error al borrar la observación: ",t),"Error al borrar la observación"===this.lastSaveMessage&&this.showSaveMessage||(this.lastSaveMessage="Error al borrar la observación",this.showSaveMessage=!0,this.saveMessageTimer&&clearTimeout(this.saveMessageTimer),this.saveMessageTimer=setTimeout(()=>{this.showSaveMessage=!1},3e3))}}},mounted(){this.loadCuentas()},beforeUnmount(){this.unsubscribe&&this.unsubscribe()}},u=d,m=(a("d44e"),a("2877")),h=Object(m["a"])(u,s,o,!1,null,"70af683d",null);t["a"]=h.exports},"4786f":function(e,t,a){"use strict";var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"cuentas-catarro-container"},[e.isSaving&&!e.showSaveMessage?t("div",{staticClass:"auto-save-indicator"},[t("span",{staticClass:"save-dot"}),e._v(" Guardando... ")]):e._e(),t("div",{staticClass:"back-button-container"},[t("BackButton",{attrs:{to:"/cuentas-catarro"}}),t("PreciosHistorialModal",{attrs:{clienteActual:"catarro"}}),t("StashModalV2",{attrs:{cliente:"catarro"}})],1),t("h1",[e._v("Cuentas Catarro")]),t("div",{staticClass:"precios-button-container"},[t("PreciosClienteButton",{attrs:{clienteId:"catarro"}})],1),t("div",{staticClass:"fecha-actual"},[t("div",{staticClass:"fecha-input"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.fechaSeleccionada,expression:"fechaSeleccionada"}],attrs:{type:"date"},domProps:{value:e.fechaSeleccionada},on:{input:function(t){t.target.composing||(e.fechaSeleccionada=t.target.value)}}})]),t("div",{staticClass:"fecha-display"},[e._v(" "+e._s(e.fechaFormateada)+" ")])]),t("div",{staticClass:"input-section card"},[t("h2",[e._v("Ingresar Datos")]),t("div",{staticClass:"input-row"},[t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.newItem.kilos,expression:"newItem.kilos",modifiers:{number:!0}}],staticClass:"responsive-input",attrs:{type:"number",placeholder:"Kilos",inputmode:"decimal",pattern:"[0-9]*"},domProps:{value:e.newItem.kilos},on:{input:function(t){t.target.composing||e.$set(e.newItem,"kilos",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}}),t("input",{directives:[{name:"model",rawName:"v-model",value:e.newItem.medida,expression:"newItem.medida"}],staticClass:"responsive-input",attrs:{type:"text",placeholder:"Medida"},domProps:{value:e.newItem.medida},on:{input:function(t){t.target.composing||e.$set(e.newItem,"medida",t.target.value)}}}),t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.newItem.costo,expression:"newItem.costo",modifiers:{number:!0}}],staticClass:"responsive-input",attrs:{type:"number",placeholder:"Costo",inputmode:"decimal",pattern:"[0-9]*"},domProps:{value:e.newItem.costo},on:{input:function(t){t.target.composing||e.$set(e.newItem,"costo",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}}),t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.newItem.precioVenta,expression:"newItem.precioVenta",modifiers:{number:!0}}],staticClass:"responsive-input",attrs:{type:"number",placeholder:"Precio Venta",inputmode:"decimal",pattern:"[0-9]*"},domProps:{value:e.newItem.precioVenta},on:{input:function(t){t.target.composing||e.$set(e.newItem,"precioVenta",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}}),t("button",{on:{click:e.addItem}},[e._v("Agregar")])])]),t("div",{staticClass:"table-card table-responsive"},[t("table",{staticClass:"tabla-principal"},[e._m(0),t("tbody",e._l(e.items,(function(a,s){return t("tr",{key:s},[t("td",{on:{click:function(t){return e.editField(s,"kilos")},touchstart:function(t){return e.startLongPress(s,"kilos")},touchend:e.endLongPress}},[e._v(" "+e._s(e.editingField.index===s&&"kilos"===e.editingField.field?"":e.formatNumber(a.kilos))+" "),e.editingField.index===s&&"kilos"===e.editingField.field?t("input",{directives:[{name:"model",rawName:"v-model.number",value:a.kilos,expression:"item.kilos",modifiers:{number:!0}}],ref:"editInput",refInFor:!0,attrs:{type:"number"},domProps:{value:a.kilos},on:{blur:[e.finishEditing,function(t){return e.$forceUpdate()}],keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.finishEditing.apply(null,arguments)},input:function(t){t.target.composing||e.$set(a,"kilos",e._n(t.target.value))}}}):e._e()]),t("td",{on:{click:function(t){return e.editField(s,"medida")},touchstart:function(t){return e.startLongPress(s,"medida")},touchend:e.endLongPress}},[e._v(" "+e._s(e.editingField.index===s&&"medida"===e.editingField.field?"":a.medida)+" "),e.editingField.index===s&&"medida"===e.editingField.field?t("input",{directives:[{name:"model",rawName:"v-model",value:a.medida,expression:"item.medida"}],ref:"editInput",refInFor:!0,attrs:{type:"text"},domProps:{value:a.medida},on:{blur:e.finishEditing,keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.finishEditing.apply(null,arguments)},input:function(t){t.target.composing||e.$set(a,"medida",t.target.value)}}}):e._e()]),t("td",{on:{click:function(t){return e.editField(s,"costo")},touchstart:function(t){return e.startLongPress(s,"costo")},touchend:e.endLongPress}},[e._v(" "+e._s(e.editingField.index===s&&"costo"===e.editingField.field?"":"$"+e.formatNumber(a.costo))+" "),e.editingField.index===s&&"costo"===e.editingField.field?t("input",{directives:[{name:"model",rawName:"v-model.number",value:a.costo,expression:"item.costo",modifiers:{number:!0}}],ref:"editInput",refInFor:!0,attrs:{type:"number"},domProps:{value:a.costo},on:{blur:[e.finishEditing,function(t){return e.$forceUpdate()}],keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.finishEditing.apply(null,arguments)},input:function(t){t.target.composing||e.$set(a,"costo",e._n(t.target.value))}}}):e._e()]),t("td",[e._v("$"+e._s(e.formatNumber(a.total)))]),t("td",{staticClass:"action-column desktop-only"},[t("button",{staticClass:"delete-btn",on:{click:function(t){return e.removeItem(s)}}},[e._v("Eliminar")])])])})),0),t("tfoot",[t("tr",{staticClass:"total"},[e._m(1),t("td",[t("strong",[e._v("$"+e._s(e.formatNumber(e.totalGeneral)))])]),t("td")])])])]),t("h2",[e._v("Precios de Venta")]),t("div",{staticClass:"add-product-button"},[t("button",{on:{click:function(t){e.showAddProductModal=!0}}},[e._v("Agregar Producto")])]),t("div",{staticClass:"table-card table-responsive"},[t("table",{staticClass:"tabla-venta"},[e._m(2),t("tbody",[e._l(e.itemsVenta,(function(a,s){return t("tr",{key:s,on:{click:function(t){return e.toggleGananciasMobile(s)}}},[t("td",{on:{click:function(t){return e.editKilos(s)},touchstart:function(t){return e.startLongPress(s)},touchend:e.endLongPress}},[e._v(" "+e._s(e.editingKilosIndex===s?"":e.formatNumber(a.kilosVenta))+" "),e.editingKilosIndex===s?t("input",{directives:[{name:"model",rawName:"v-model.number",value:a.kilosVenta,expression:"item.kilosVenta",modifiers:{number:!0}}],ref:"kilosInput",refInFor:!0,attrs:{type:"number"},domProps:{value:a.kilosVenta},on:{blur:[e.finishEditingKilos,function(t){return e.$forceUpdate()}],keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.finishEditingKilos.apply(null,arguments)},input:function(t){t.target.composing||e.$set(a,"kilosVenta",e._n(t.target.value))}}}):e._e()]),t("td",[e._v(e._s(a.medida))]),t("td",[t("input",{directives:[{name:"model",rawName:"v-model.number",value:a.precioVenta,expression:"item.precioVenta",modifiers:{number:!0}}],staticClass:"precio-venta-input",attrs:{type:"number",inputmode:"decimal",pattern:"[0-9]*"},domProps:{value:a.precioVenta},on:{input:[function(t){t.target.composing||e.$set(a,"precioVenta",e._n(t.target.value))},function(t){return e.calcularTotalVenta(s)}],blur:function(t){return e.$forceUpdate()}}})]),t("td",[e._v("$"+e._s(e.formatNumber(a.totalVenta)))]),t("td",{class:{"desktop-only":!0,"ganancia-positiva":a.ganancia>0,"ganancia-negativa":a.ganancia<0}},[e._v(" $"+e._s(e.formatNumber(a.ganancia))+" ")])])})),null!==e.selectedRowIndex?t("tr",{staticClass:"mobile-only ganancia-row"},[t("td",{attrs:{colspan:"4"}},[t("strong",[e._v("Ganancias:")]),t("span",{class:{"ganancia-positiva":e.itemsVenta[e.selectedRowIndex].ganancia>0,"ganancia-negativa":e.itemsVenta[e.selectedRowIndex].ganancia<0}},[e._v(" $"+e._s(e.formatNumber(e.itemsVenta[e.selectedRowIndex].ganancia))+" ")])])]):e._e()],2),t("tfoot",[t("tr",{staticClass:"total"},[e._m(3),t("td",[t("strong",[e._v("$"+e._s(e.formatNumber(e.totalGeneralVenta)))])]),t("td",{staticClass:"desktop-only"},[t("strong",[e._v("$"+e._s(e.formatNumber(e.gananciaTotal)))])])])])])]),t("div",{staticClass:"ganancia-del-dia"},[t("h3",[e._v("Ganancia del Día")]),t("p",{class:{"ganancia-positiva":e.gananciaDelDia>0,"ganancia-negativa":e.gananciaDelDia<0}},[e._v(" $"+e._s(e.formatNumber(e.gananciaDelDia))+" ")])]),t("h2",[e._v("Saldo pendiente")]),t("div",{staticClass:"saldo-pendiente card"},[t("div",{staticClass:"input-row"},[t("span",[e._v("Saldo Acumulado Anterior: $"+e._s(e.formatNumber(e.saldoAcumuladoAnterior)))])]),e._l(e.cobros,(function(a,s){return t("div",{key:s,staticClass:"input-row"},[t("input",{directives:[{name:"model",rawName:"v-model",value:a.descripcion,expression:"cobro.descripcion"}],staticClass:"responsive-input",attrs:{type:"text",placeholder:"Flete"},domProps:{value:a.descripcion},on:{input:function(t){t.target.composing||e.$set(a,"descripcion",t.target.value)}}}),t("input",{directives:[{name:"model",rawName:"v-model",value:a.monto,expression:"cobro.monto"}],staticClass:"responsive-input",attrs:{type:"number",placeholder:"Monto"},domProps:{value:a.monto},on:{input:function(t){t.target.composing||e.$set(a,"monto",t.target.value)}}}),t("button",{staticClass:"delete-btn",on:{click:function(t){return e.removeCobro(s)}}},[e._v("Eliminar")])])})),t("button",{staticClass:"add-btn",on:{click:e.addCobro}},[e._v("Agregar Flete")])],2),t("h2",[e._v("Abonos")]),t("div",{staticClass:"abonos card"},[e._l(e.abonos,(function(a,s){return t("div",{key:s,staticClass:"input-row"},[t("input",{directives:[{name:"model",rawName:"v-model",value:a.descripcion,expression:"abono.descripcion"}],staticClass:"responsive-input",attrs:{type:"text",placeholder:"Descripción"},domProps:{value:a.descripcion},on:{input:function(t){t.target.composing||e.$set(a,"descripcion",t.target.value)}}}),t("input",{directives:[{name:"model",rawName:"v-model.number",value:a.monto,expression:"abono.monto",modifiers:{number:!0}}],staticClass:"responsive-input",attrs:{type:"number",placeholder:"Monto"},domProps:{value:a.monto},on:{input:function(t){t.target.composing||e.$set(a,"monto",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}}),t("button",{staticClass:"delete-btn",on:{click:function(t){return e.removeAbono(s)}}},[e._v("Eliminar")])])})),t("button",{staticClass:"add-btn",on:{click:e.addAbono}},[e._v("Agregar Abono")])],2),t("table",{staticClass:"tabla-saldo"},[t("tr",[t("td",[e._v("Saldo Acumulado Anterior")]),t("td",[e._v("$"+e._s(e.formatNumber(e.saldoAcumuladoAnterior)))])]),t("tr",[t("td",[e._v("Saldo Hoy")]),t("td",[e._v("$"+e._s(e.formatNumber(e.totalGeneralVenta)))])]),e._l(e.cobros,(function(a,s){return t("tr",{key:s},[t("td",[e._v(e._s(a.descripcion))]),t("td",[e._v("-$"+e._s(e.formatNumber(a.monto)))])])})),e._l(e.abonos,(function(a,s){return t("tr",{key:"abono-"+s},[t("td",[e._v(e._s(a.descripcion)+" (Abono)")]),t("td",[e._v("-$"+e._s(e.formatNumber(a.monto)))])])})),t("tr",{staticClass:"total"},[t("td",[e._v("Total")]),t("td",[e._v("$"+e._s(e.formatNumber(e.totalDiaActual)))])]),t("tr",{staticClass:"total"},[t("td",[e._v("Nuevo Saldo Acumulado")]),t("td",[e._v("$"+e._s(e.formatNumber(e.nuevoSaldoAcumulado)))])])],2),t("div",{staticClass:"button-container"},[t("button",{staticClass:"save-button",attrs:{disabled:e.isGuardando},on:{click:e.guardarNota}},[e._v(" "+e._s(e.isGuardando?"Guardando...":"Guardar Nota")+" ")]),t("button",{staticClass:"print-button",on:{click:e.imprimirTablas}},[e._v("Imprimir")])]),e.showMobileActions?t("div",{staticClass:"mobile-actions-modal"},[t("button",{staticClass:"edit-btn",on:{click:function(t){return e.editItem(e.selectedItemIndex)}}},[e._v("Editar")]),t("button",{staticClass:"delete-btn",on:{click:function(t){return e.removeItem(e.selectedItemIndex)}}},[e._v("Eliminar")]),t("button",{on:{click:e.cancelMobileActions}},[e._v("Cancelar")])]):e._e(),e.showEditModal?t("div",{staticClass:"edit-modal"},[t("h3",[e._v("Editar Item")]),t("div",{staticClass:"input-row"},[t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.editingItem.kilos,expression:"editingItem.kilos",modifiers:{number:!0}}],staticClass:"responsive-input",attrs:{type:"number",placeholder:"Kilos",inputmode:"decimal",pattern:"[0-9]*"},domProps:{value:e.editingItem.kilos},on:{input:function(t){t.target.composing||e.$set(e.editingItem,"kilos",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}}),t("input",{directives:[{name:"model",rawName:"v-model",value:e.editingItem.medida,expression:"editingItem.medida"}],staticClass:"responsive-input",attrs:{type:"text",placeholder:"Medida"},domProps:{value:e.editingItem.medida},on:{input:function(t){t.target.composing||e.$set(e.editingItem,"medida",t.target.value)}}}),t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.editingItem.costo,expression:"editingItem.costo",modifiers:{number:!0}}],staticClass:"responsive-input",attrs:{type:"number",placeholder:"Costo",inputmode:"decimal",pattern:"[0-9]*"},domProps:{value:e.editingItem.costo},on:{input:function(t){t.target.composing||e.$set(e.editingItem,"costo",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})]),t("div",{staticClass:"button-row"},[t("button",{on:{click:e.saveEditedItem}},[e._v("Guardar")]),t("button",{on:{click:e.cancelEdit}},[e._v("Cancelar")])])]):e._e(),e.showAddProductModal?t("div",{staticClass:"modal"},[t("div",{staticClass:"modal-content"},[t("h3",[e._v("Agregar Nuevo Producto")]),t("div",{staticClass:"input-row"},[t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.newProduct.kilosVenta,expression:"newProduct.kilosVenta",modifiers:{number:!0}}],staticClass:"responsive-input",attrs:{type:"number",placeholder:"Kilos",inputmode:"decimal",pattern:"[0-9]*"},domProps:{value:e.newProduct.kilosVenta},on:{input:function(t){t.target.composing||e.$set(e.newProduct,"kilosVenta",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}}),t("input",{directives:[{name:"model",rawName:"v-model",value:e.newProduct.medida,expression:"newProduct.medida"}],staticClass:"responsive-input",attrs:{type:"text",placeholder:"Medida"},domProps:{value:e.newProduct.medida},on:{input:function(t){t.target.composing||e.$set(e.newProduct,"medida",t.target.value)}}}),t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.newProduct.precioVenta,expression:"newProduct.precioVenta",modifiers:{number:!0}}],staticClass:"responsive-input",attrs:{type:"number",placeholder:"Precio de Venta",inputmode:"decimal",pattern:"[0-9]*"},domProps:{value:e.newProduct.precioVenta},on:{input:function(t){t.target.composing||e.$set(e.newProduct,"precioVenta",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})]),t("div",{staticClass:"button-row"},[t("button",{on:{click:e.addNewProduct}},[e._v("Agregar")]),t("button",{on:{click:function(t){e.showAddProductModal=!1}}},[e._v("Cancelar")])])])]):e._e(),t("div",{class:["estado-cuenta",e.estadoCuenta.toLowerCase(),{"no-pagado":"No Pagado"===e.estadoCuenta}]},[e._v(" "+e._s(e.estadoCuenta)+" ")]),t("div",{staticClass:"guardar-container"},[t("div",{staticClass:"observacion-container"},[t("button",{staticClass:"btn-agregar-observacion",on:{click:e.agregarObservacion}},[t("i",{staticClass:"fas fa-plus"}),e._v(" Agregar observación ")])]),e.observacion?t("div",{staticClass:"observacion-existente"},[t("div",{staticClass:"observacion-header"},[t("p",{staticClass:"observacion-titulo"},[e._v("Observación actual:")]),t("div",{staticClass:"observacion-buttons"},[t("button",{staticClass:"btn-editar",on:{click:e.editarObservacion}},[e._v("Editar")]),t("button",{staticClass:"btn-eliminar",attrs:{title:"Eliminar observación"},on:{click:e.eliminarObservacion}},[e._v("×")])])]),t("p",{staticClass:"observacion-texto"},[e._v(e._s(e.observacion))])]):e._e()]),e.showObservacionModal?t("div",{staticClass:"modal-overlay"},[t("div",{staticClass:"modal-content"},[t("h3",[e._v(e._s(e.observacion?"Editar":"Agregar")+" Observación")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.observacion,expression:"observacion"}],attrs:{placeholder:"Escribe tu observación aquí...",rows:"4"},domProps:{value:e.observacion},on:{input:function(t){t.target.composing||(e.observacion=t.target.value)}}}),t("div",{staticClass:"modal-buttons"},[t("button",{staticClass:"btn-guardar",on:{click:e.guardarObservacion}},[e._v("Guardar")]),t("button",{staticClass:"btn-cancelar",on:{click:e.cancelarObservacion}},[e._v("Cancelar")])])])]):e._e(),e.showSaveMessage&&e.lastSaveMessage&&"Guardado automáticamente"!==e.lastSaveMessage?t("div",{staticClass:"auto-save-message"},[e._v(" "+e._s(e.lastSaveMessage)+" ")]):e._e()])},o=[function(){var e=this,t=e._self._c;return t("thead",[t("tr",[t("th",[e._v("Kilos")]),t("th",[e._v("Medida")]),t("th",[e._v("Costo")]),t("th",[e._v("Total")]),t("th",{staticClass:"desktop-only"},[e._v("Acciones")])])])},function(){var e=this,t=e._self._c;return t("td",{staticClass:"text-right",attrs:{colspan:"3"}},[t("strong",[e._v("Total General Costo:")])])},function(){var e=this,t=e._self._c;return t("thead",[t("tr",[t("th",[e._v("Kilos")]),t("th",[e._v("Medida")]),t("th",[e._v("Precio")]),t("th",[e._v("Total")]),t("th",{staticClass:"desktop-only"},[e._v("Ganancias")])])])},function(){var e=this,t=e._self._c;return t("td",{staticClass:"text-right",attrs:{colspan:"3"}},[t("strong",[e._v("Total General Venta:")])])}],i=(a("d9e2"),a("14d9"),a("13d5"),a("dc59")),n=a("1494"),r=a("74c9"),c=a("666c"),l=a("3f5a"),d=a("03c4"),u=(a("fa40"),{name:"CuentasCatarro",components:{BackButton:r["a"],PreciosHistorialModal:c["a"],StashModalV2:l["a"],PreciosClienteButton:d["a"]},data(){return{items:[],newItem:{kilos:null,medida:"",costo:null,precioVenta:null},saldoAcumuladoAnterior:0,cobros:[],abonos:[],fechaSeleccionada:this.obtenerFechaActual(),showMobileActions:!1,selectedItemIndex:null,presionTimer:null,itemsVenta:[],showEditModal:!1,editingItem:null,editingIndex:null,estadoPagado:!1,editingKilosIndex:null,longPressTimer:null,editingField:{index:null,field:null},selectedRowIndex:null,showAddProductModal:!1,newProduct:{kilosVenta:null,medida:"",precioVenta:null},autoSaveTimer:null,lastSavedData:null,saveQueue:[],isSaving:!1,lastSaveTime:null,saveMinInterval:5e3,tieneObservacion:!1,showObservacionModal:!1,observacion:"",isGuardando:!1,lastSaveMessage:"",showSaveMessage:!1,saveMessageTimer:null}},computed:{fechaFormateada(){const e=new Date(this.fechaSeleccionada+"T00:00:00"),t={year:"numeric",month:"long",day:"numeric"};return e.toLocaleDateString("es-ES",t)},totalGeneral(){return this.items.reduce((e,t)=>e+(t.total||0),0)},totalGeneralVenta(){return this.itemsVenta.reduce((e,t)=>e+(t.totalVenta||0),0)},totalSaldo(){const e=this.cobros.reduce((e,t)=>e+(t.monto||0),0),t=this.abonos.reduce((e,t)=>e+(t.monto||0),0);return this.saldoAcumuladoAnterior+this.totalGeneralVenta+e-t},nuevoSaldoAcumulado(){return(this.saldoAcumuladoAnterior||0)+(this.totalDiaActual||0)},gananciaDelDia(){const e=this.items.reduce((e,t)=>e+(t.total||0),0);return(this.totalGeneralVenta||0)-(e||0)},saldoPendiente(){return this.totalGeneralVenta-this.abonos.reduce((e,t)=>e+(t.monto||0),0)},estadoCuenta(){return this.totalSaldo<=0||0===this.totalDiaActual?"Pagado":"No Pagado"},gananciaTotal(){return this.itemsVenta.reduce((e,t)=>e+(t.ganancia||0),0)},totalDiaActual(){const e=this.cobros.reduce((e,t)=>e+(parseFloat(t.monto)||0),0),t=this.abonos.reduce((e,t)=>e+(parseFloat(t.monto)||0),0);return(this.totalGeneralVenta||0)-e-t}},watch:{fechaSeleccionada:{handler:"loadSaldoAcumuladoAnterior",immediate:!0},items:{handler:"handleDataChange",deep:!0},itemsVenta:{handler:"handleDataChange",deep:!0},cobros:{handler:"handleDataChange",deep:!0},abonos:{handler:"handleDataChange",deep:!0},fechaSeleccionada:{handler:"handleDataChange"},saldoAcumuladoAnterior:{handler:"handleDataChange"},"newItem.kilos":"handleDataChange","newItem.medida":"handleDataChange","newItem.costo":"handleDataChange",observacion:"handleDataChange"},async mounted(){console.log("Mounted ejecutado",this.$route.params,this.$route.query);const e=this.$route.params.id,t="true"===this.$route.query.edit;e&&t?(console.log("Iniciando carga de cuenta existente"),await this.loadExistingCuenta(e)):(console.log("Cargando saldo acumulado anterior para nueva cuenta"),await this.loadSaldoAcumuladoAnterior())},methods:{async loadExistingCuenta(e){try{console.log("Cargando cuenta con ID:",e);const t=Object(n["e"])(i["a"],"cuentasCatarro",e),a=await Object(n["f"])(t);if(a.exists()){const e=a.data();console.log("Datos de la cuenta cargados:",e),this.$nextTick(()=>{this.items=(e.items||[]).map(e=>{const t=parseFloat(e.kilos)||0;return{...e,kilos:t,total:t*(e.costo||0)}}),this.saldoAcumuladoAnterior=e.saldoAcumuladoAnterior||0,this.cobros=e.cobros||[],this.abonos=e.abonos||[],this.fechaSeleccionada=e.fecha||this.obtenerFechaActual(),this.showObservacionModal=!1,this.tieneObservacion=e.tieneObservacion||!1,this.observacion=e.observacion||"",this.itemsVenta=(e.itemsVenta||this.items.map(e=>({...e,precioVenta:e.precioVenta||0,totalVenta:(e.precioVenta||0)*e.kilos,kilosVenta:e.kilos}))).map((e,t)=>{const a=parseFloat(e.kilosVenta)||0,s=a*(e.precioVenta||0),o=this.items[t],i=o?o.total:0;return{...e,kilosVenta:a,totalVenta:s,ganancia:s-i}}),this.actualizarItemsVenta(),this.$forceUpdate(),console.log("Estado actualizado con $nextTick:",{items:this.items,saldoAcumuladoAnterior:this.saldoAcumuladoAnterior,cobros:this.cobros,abonos:this.abonos,fechaSeleccionada:this.fechaSeleccionada,itemsVenta:this.itemsVenta,tieneObservacion:this.tieneObservacion,observacion:this.observacion})})}else console.error("No se encontró la cuenta con el ID proporcionado")}catch(t){console.error("Error al cargar la cuenta existente: ",t)}},async loadSaldoAcumuladoAnterior(){try{this.saldoAcumuladoAnterior=await this.obtenerSaldoAcumuladoAnterior(),console.log("Saldo acumulado anterior cargado:",this.saldoAcumuladoAnterior)}catch(e){console.error("Error al cargar el saldo acumulado anterior:",e),this.saldoAcumuladoAnterior=0}},async obtenerSaldoAcumuladoAnterior(){try{const e=Object(n["c"])(i["a"],"cuentasCatarro"),t=Object(n["o"])(e,Object(n["t"])("fecha","<",this.fechaSeleccionada),Object(n["l"])("fecha","desc"),Object(n["j"])(1)),a=await Object(n["g"])(t);if(!a.empty){const e=a.docs[0].data();return e.nuevoSaldoAcumulado||0}return 0}catch(e){return console.error("Error al obtener saldo acumulado anterior:",e),0}},async actualizarCuentasPosteriores(e){try{const t=Object(n["c"])(i["a"],"cuentasCatarro"),a=Object(n["o"])(t,Object(n["t"])("fecha",">=",e),Object(n["l"])("fecha","asc"),Object(n["j"])(50)),s=await Object(n["g"])(a),o=s.docs.map(e=>({id:e.id,...e.data()}));let r=this.nuevoSaldoAcumulado;await Promise.all(o.map(async e=>{const t=e.totalGeneralVenta-(e.cobros||[]).reduce((e,t)=>e+(parseFloat(t.monto)||0),0)-(e.abonos||[]).reduce((e,t)=>e+(parseFloat(t.monto)||0),0);return r+=t,Object(n["s"])(Object(n["e"])(i["a"],"cuentasCatarro",e.id),{saldoAcumuladoAnterior:e.id===this.$route.params.id?this.saldoAcumuladoAnterior:r-t,nuevoSaldoAcumulado:r,estadoPagado:r<=0})}))}catch(t){throw console.error("Error al actualizar cuentas posteriores:",t),t}},formatNumber(e){return null===e||void 0===e?"0.00":e.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})},async addItem(){if(this.newItem.kilos&&this.newItem.medida&&this.newItem.costo&&this.newItem.precioVenta)try{const e=this.newItem.medida.includes("-")&&!this.newItem.medida.toLowerCase().includes("crudo")?this.newItem.medida.replace(/-/g,"/"):this.newItem.medida,t=parseFloat(this.newItem.kilos),a=t*this.newItem.costo;this.items.push({kilos:t,medida:e,costo:this.newItem.costo,total:a});let s=t;const o=this.calcularKilosCrudos(e,t,!1);o!==t&&(s=o);const i=s*this.newItem.precioVenta,n=i-a;this.itemsVenta.push({kilosVenta:s,medida:e,precioVenta:this.newItem.precioVenta,totalVenta:i,ganancia:n}),this.newItem={kilos:null,medida:"",costo:null,precioVenta:null},await this.queueSave()}catch(e){console.error("Error al guardar el item:",e),"Hubo un problema al guardar. Por favor, intente nuevamente."===this.lastSaveMessage&&this.showSaveMessage||(this.lastSaveMessage="Hubo un problema al guardar. Por favor, intente nuevamente.",this.showSaveMessage=!0,this.saveMessageTimer&&clearTimeout(this.saveMessageTimer),this.saveMessageTimer=setTimeout(()=>{this.showSaveMessage=!1},3e3)),this.items.pop(),this.itemsVenta.pop()}else"Por favor complete todos los campos"===this.lastSaveMessage&&this.showSaveMessage||(this.lastSaveMessage="Por favor complete todos los campos",this.showSaveMessage=!0,this.saveMessageTimer&&clearTimeout(this.saveMessageTimer),this.saveMessageTimer=setTimeout(()=>{this.showSaveMessage=!1},3e3))},async crearNuevaCuenta(){try{const e=this.$route.params.id,t="true"===this.$route.query.edit;if(!e||!t){const e=Object(n["c"])(i["a"],"cuentasCatarro"),t=Object(n["o"])(e,Object(n["t"])("fecha","==",this.fechaSeleccionada)),a=await Object(n["g"])(t);if(!a.empty)throw new Error("Ya existe una nota registrada para esta fecha.")}const a={fecha:this.fechaSeleccionada,items:this.items.map(e=>{const t=parseFloat(e.kilos)||0;return{...e,kilos:t,total:t*(e.costo||0)}}),itemsVenta:this.itemsVenta.map(e=>{const t=parseFloat(e.kilosVenta)||0,a=t*(e.precioVenta||0);return{...e,kilosVenta:t,totalVenta:a}}),saldoAcumuladoAnterior:await this.obtenerSaldoAcumuladoAnterior(),cobros:[],abonos:[],totalGeneral:this.totalGeneral,totalGeneralVenta:0,nuevoSaldoAcumulado:this.saldoAcumuladoAnterior,estadoPagado:!1,tieneObservacion:this.tieneObservacion,observacion:this.observacion},s=await Object(n["b"])(Object(n["c"])(i["a"],"cuentasCatarro"),a);return this.$router.replace({name:this.$route.name,params:{id:s.id},query:{edit:"true"}}),s.id}catch(e){const t=this.$route.params.id,a="true"===this.$route.query.edit;throw"Ya existe una nota registrada para esta fecha."!==e.message||t&&a?a||(console.error("Error al crear nueva cuenta:",e),"Error al crear la cuenta"===this.lastSaveMessage&&this.showSaveMessage||(this.lastSaveMessage="Error al crear la cuenta. Por favor, intente nuevamente.",this.showSaveMessage=!0,this.saveMessageTimer&&clearTimeout(this.saveMessageTimer),this.saveMessageTimer=setTimeout(()=>{this.showSaveMessage=!1},3e3))):this.lastSaveMessage===e.message&&this.showSaveMessage||(this.lastSaveMessage=e.message,this.showSaveMessage=!0,this.saveMessageTimer&&clearTimeout(this.saveMessageTimer),this.saveMessageTimer=setTimeout(()=>{this.showSaveMessage=!1},3e3)),e}},async removeItem(e){try{this.items.splice(e,1),this.itemsVenta.splice(e,1),this.showMobileActions=!1,await this.queueSave()}catch(t){console.error("Error al eliminar item:",t)}},addCobro(){this.cobros.push({descripcion:"Flete",monto:0})},removeCobro(e){this.cobros.splice(e,1)},addAbono(){this.abonos.push({descripcion:"",monto:0})},removeAbono(e){this.abonos.splice(e,1)},obtenerFechaActual(){const e=new Date;return e.getFullYear()+"-"+String(e.getMonth()+1).padStart(2,"0")+"-"+String(e.getDate()).padStart(2,"0")},async guardarNota(){try{this.isGuardando=!0;const e=this.totalGeneralVenta-this.cobros.reduce((e,t)=>e+(parseFloat(t.monto)||0),0)-this.abonos.reduce((e,t)=>e+(parseFloat(t.monto)||0),0),t=await this.obtenerSaldoAcumuladoAnterior(),a=t+e,s=a<=0,o={fecha:this.fechaSeleccionada,items:this.items.map(e=>{const t=parseFloat(e.kilos)||0;return{...e,kilos:t,total:t*(e.costo||0)}}),saldoAcumuladoAnterior:t,cobros:this.cobros,abonos:this.abonos,totalGeneral:this.totalGeneral,totalGeneralVenta:this.totalGeneralVenta,nuevoSaldoAcumulado:s?0:a,gananciaDelDia:this.gananciaDelDia,estadoPagado:s,itemsVenta:this.itemsVenta.map(e=>{const t=parseFloat(e.kilosVenta)||0,a=t*(e.precioVenta||0);return{...e,kilosVenta:t,totalVenta:a}}),tieneObservacion:this.tieneObservacion,observacion:this.observacion,ultimaActualizacion:(new Date).toISOString()},r=this.$route.params.id,c="true"===this.$route.query.edit;if(r&&c)await Object(n["s"])(Object(n["e"])(i["a"],"cuentasCatarro",r),o),this.actualizarCuentasPosteriores(this.fechaSeleccionada).catch(console.error),"Cuenta guardada exitosamente"===this.lastSaveMessage&&this.showSaveMessage||(this.lastSaveMessage="Cuenta guardada exitosamente",this.showSaveMessage=!0,this.saveMessageTimer&&clearTimeout(this.saveMessageTimer),this.saveMessageTimer=setTimeout(()=>{this.showSaveMessage=!1},3e3)),setTimeout(()=>{this.$router.push("/cuentas-catarro")},500);else{const e=Object(n["c"])(i["a"],"cuentasCatarro"),t=Object(n["o"])(e,Object(n["t"])("fecha","==",this.fechaSeleccionada)),a=await Object(n["g"])(t);if(!a.empty)return void("Ya existe una nota registrada para esta fecha"===this.lastSaveMessage&&this.showSaveMessage||(this.lastSaveMessage="Ya existe una nota registrada para esta fecha. No se puede crear una nueva.",this.showSaveMessage=!0,this.saveMessageTimer&&clearTimeout(this.saveMessageTimer),this.saveMessageTimer=setTimeout(()=>{this.showSaveMessage=!1},3e3)));await Object(n["b"])(Object(n["c"])(i["a"],"cuentasCatarro"),o),this.actualizarCuentasPosteriores(this.fechaSeleccionada).catch(console.error),"Cuenta guardada exitosamente"===this.lastSaveMessage&&this.showSaveMessage||(this.lastSaveMessage="Cuenta guardada exitosamente",this.showSaveMessage=!0,this.saveMessageTimer&&clearTimeout(this.saveMessageTimer),this.saveMessageTimer=setTimeout(()=>{this.showSaveMessage=!1},3e3)),setTimeout(()=>{this.$router.push("/cuentas-catarro")},500)}}catch(e){console.error("Error al guardar la cuenta:",e),"Error al guardar la cuenta"===this.lastSaveMessage&&this.showSaveMessage||(this.lastSaveMessage="Error al guardar la cuenta",this.showSaveMessage=!0,this.saveMessageTimer&&clearTimeout(this.saveMessageTimer),this.saveMessageTimer=setTimeout(()=>{this.showSaveMessage=!1},3e3))}finally{this.isGuardando=!1}},iniciarPresion(e){this.presionTimer=setTimeout(()=>{this.showMobileActionsModal(e)},500)},finalizarPresion(){clearTimeout(this.presionTimer)},showMobileActionsModal(e){this.selectedItemIndex=e,this.showMobileActions=!0},cancelMobileActions(){this.showMobileActions=!1,this.selectedItemIndex=null},editItem(e){this.editingIndex=e,this.editingItem={...this.items[e]},this.showEditModal=!0},saveEditedItem(){if(this.editingItem.kilos&&this.editingItem.medida&&this.editingItem.costo){const e=this.editingItem.medida.includes("-")&&!this.editingItem.medida.toLowerCase().includes("crudo")?this.editingItem.medida.replace(/-/g,"/"):this.editingItem.medida;this.editingItem.kilos=parseFloat(this.editingItem.kilos),this.editingItem.medida=e,this.editingItem.total=this.editingItem.kilos*this.editingItem.costo,this.items[this.editingIndex]={...this.editingItem},this.actualizarItemsVenta(),this.showEditModal=!1,this.editingItem=null,this.editingIndex=null}},cancelEdit(){this.showEditModal=!1,this.editingItem=null,this.editingIndex=null},imprimirTablas(){const e=`\n        <html>\n          <head>\n            <title>Cuentas Catarro - ${this.fechaFormateada}</title>\n            <style>\n              body {\n                font-family: Arial, sans-serif;\n                font-size: 14pt;\n                line-height: 1.4;\n                max-width: 800px;\n                margin: 0 auto;\n                padding: 15px;\n                text-align: center;\n              }\n              h1 { \n                font-size: 22pt; \n                margin-bottom: 15px; \n              }\n              h2 { \n                font-size: 18pt; \n                margin-top: 20px; \n                margin-bottom: 10px; \n              }\n              table {\n                width: 100%;\n                border-collapse: collapse;\n                margin-bottom: 20px;\n                font-size: 13pt;\n              }\n              th, td {\n                border: 1px solid #ddd;\n                padding: 8px 10px;\n                text-align: left;\n              }\n              th { \n                background-color: #f2f2f2; \n                font-weight: bold;\n                font-size: 13pt;\n              }\n              .total { \n                font-weight: bold; \n                font-size: 13pt;\n              }\n              .total td:first-child { \n                text-align: right; \n              }\n              .highlight {\n                background-color: #e8f5e9;\n                font-weight: bold;\n              }\n              @media print {\n                body { \n                  font-size: 14pt; \n                }\n                h1 { \n                  font-size: 22pt; \n                }\n                h2 { \n                  font-size: 18pt; \n                }\n                table { \n                  font-size: 13pt; \n                }\n                th, td {\n                  padding: 8px 10px;\n                }\n              }\n            </style>\n          </head>\n          <body>\n            <h1>Cuentas Catarro - ${this.fechaFormateada}</h1>\n            \n            <h2>Precios de Venta</h2>\n            <table>\n              <thead>\n                <tr>\n                  <th>Kilos</th>\n                  <th>Medida</th>\n                  <th>Precio de Venta</th>\n                  <th>Total</th>\n                </tr>\n              </thead>\n              <tbody>\n                ${this.itemsVenta.map(e=>`\n                  <tr>\n                    <td>${this.formatNumber(e.kilosVenta)}</td>\n                    <td>${e.medida}</td>\n                    <td>$${this.formatNumber(e.precioVenta)}</td>\n                    <td>$${this.formatNumber(e.totalVenta)}</td>\n                  </tr>\n                `).join("")}\n              </tbody>\n              <tfoot>\n                <tr class="total">\n                  <td colspan="3">Total Venta</td>\n                  <td>$${this.formatNumber(this.totalGeneralVenta)}</td>\n                </tr>\n              </tfoot>\n            </table>\n\n            <h2>Resumen de saldo</h2>\n            <table>\n              <tr>\n                <td>Saldo Acumulado Anterior</td>\n                <td>$${this.formatNumber(this.saldoAcumuladoAnterior)}</td>\n              </tr>\n              <tr>\n                <td>Saldo Hoy</td>\n                <td>$${this.formatNumber(this.totalGeneralVenta)}</td>\n              </tr>\n              ${this.cobros.map(e=>`\n                <tr>\n                  <td>${e.descripcion}</td>\n                  <td>-$${this.formatNumber(e.monto)}</td>\n                </tr>\n              `).join("")}\n              ${this.abonos.map(e=>`\n                <tr>\n                  <td>${e.descripcion} (Abono)</td>\n                  <td>-$${this.formatNumber(e.monto)}</td>\n                </tr>\n              `).join("")}\n              <tr class="total">\n                <td>Total</td>\n                <td>$${this.formatNumber(this.totalDiaActual)}</td>\n              </tr>\n              <tr class="highlight">\n                <td>Nuevo Saldo Acumulado</td>\n                <td>$${this.formatNumber(this.nuevoSaldoAcumulado)}</td>\n              </tr>\n            </table>\n          </body>\n        </html>\n      `,t=window.open("","_blank");t.document.write(e),t.document.close(),t.print()},actualizarItemsVenta(){this.itemsVenta=this.itemsVenta.map((e,t)=>{const a=this.items[t],s=(e.precioVenta||0)*(e.kilosVenta||0),o=a?a.total:0,i=s-o,n=e.medida.includes("-")&&!e.medida.toLowerCase().includes("crudo")?e.medida.replace(/-/g,"/"):e.medida;return{...e,medida:n,totalVenta:s,ganancia:i}})},calcularTotalVenta(e){const t=this.itemsVenta[e];if(t)try{const a=parseFloat(t.kilosVenta)||0,s=parseFloat(t.precioVenta)||0;t.totalVenta=a*s;const o=this.items[e],i=o&&o.total||0;t.ganancia=(t.totalVenta||0)-i,this.actualizarItemsVenta(),this.queueSave()}catch(a){console.error("Error al calcular total de venta:",a)}},removeItemVenta(e){this.itemsVenta.splice(e,1)},editKilos(e){this.editingKilosIndex=e,this.$nextTick(()=>{this.$refs.kilosInput&&this.$refs.kilosInput[0]&&this.$refs.kilosInput[0].focus()})},finishEditingKilos(){const e=this.editingKilosIndex;if(null!==e)try{const t=this.itemsVenta[e],a=this.items[e],s=parseFloat(t.kilosVenta)||0;if(a){const e=this.calcularKilosCrudos(t.medida,s,!1);t.kilosVenta=e}else t.kilosVenta=s;this.calcularTotalVenta(e),this.queueSave()}catch(t){console.error("Error al finalizar edición de kilos:",t)}this.editingKilosIndex=null},startLongPress(e,t){this.longPressTimer=setTimeout(()=>{this.editField(e,t)},500)},endLongPress(){clearTimeout(this.longPressTimer)},editField(e,t){this.editingField={index:e,field:t},this.$nextTick(()=>{this.$refs.editInput&&this.$refs.editInput[0]&&this.$refs.editInput[0].focus()})},finishEditing(){const{index:e,field:t}=this.editingField;if(null!==e&&null!==t)try{const a=this.items[e];if("kilos"===t)a.kilos=parseFloat(a.kilos)||0;else if("costo"===t)a.costo=parseFloat(a.costo)||0;else if("medida"===t){const e=a.medida.includes("-")&&!a.medida.toLowerCase().includes("crudo")?a.medida.replace(/-/g,"/"):a.medida;a.medida=e}if(a.total=a.kilos*a.costo,this.itemsVenta[e]){const t=parseFloat(this.itemsVenta[e].kilosVenta)||0;this.itemsVenta[e].kilosVenta=t,this.itemsVenta[e].totalVenta=t*(this.itemsVenta[e].precioVenta||0)}this.actualizarItemsVenta(),this.queueSave()}catch(a){console.error("Error al finalizar edición:",a)}this.editingField={index:null,field:null}},toggleGananciasMobile(e){window.innerWidth<=600&&(this.selectedRowIndex=this.selectedRowIndex===e?null:e)},addNewProduct(){if(this.newProduct.kilosVenta&&this.newProduct.medida&&this.newProduct.precioVenta)if(this.newProduct.kilosVenta&&this.newProduct.medida&&this.newProduct.precioVenta){const e=this.newProduct.medida.includes("-")&&!this.newProduct.medida.toLowerCase().includes("crudo")?this.newProduct.medida.replace(/-/g,"/"):this.newProduct.medida,t=parseFloat(this.newProduct.kilosVenta),a=this.calcularKilosCrudos(e,t,!1),s=a*this.newProduct.precioVenta;this.itemsVenta.push({kilosVenta:a,medida:e,precioVenta:this.newProduct.precioVenta,totalVenta:s,ganancia:s}),this.showAddProductModal=!1,this.newProduct={kilosVenta:null,medida:"",precioVenta:null},this.queueSave()}else alert("Por favor, complete todos los campos");else"Por favor complete todos los campos"===this.lastSaveMessage&&this.showSaveMessage||(this.lastSaveMessage="Por favor complete todos los campos",this.showSaveMessage=!0,this.saveMessageTimer&&clearTimeout(this.saveMessageTimer),this.saveMessageTimer=setTimeout(()=>{this.showSaveMessage=!1},3e3))},handleDataChange(){this.$route.params.id&&"true"===this.$route.query.edit&&(this.autoSaveTimer&&clearTimeout(this.autoSaveTimer),this.autoSaveTimer=setTimeout(async()=>{await this.queueSave()},2e3))},async queueSave(){const e=this.$route.params.id,t="true"===this.$route.query.edit;this.saveQueue.push({timestamp:Date.now(),operation:async()=>{e&&t?await this.autoSaveNota():await this.crearNuevaCuenta()}}),this.isSaving||await this.processSaveQueue()},async processSaveQueue(){if(!this.isSaving&&0!==this.saveQueue.length){this.isSaving=!0;try{while(this.saveQueue.length>0){const e=Date.now();this.lastSaveTime&&e-this.lastSaveTime<this.saveMinInterval&&await new Promise(t=>setTimeout(t,this.saveMinInterval-(e-this.lastSaveTime)));const t=this.saveQueue[0];await this.retryOperation(t.operation),this.lastSaveTime=Date.now(),this.saveQueue.shift()}}catch(e){console.error("Error procesando cola de guardado:",e),"resource-exhausted"===e.code&&(await new Promise(e=>setTimeout(e,1e4)),await this.processSaveQueue())}finally{this.isSaving=!1}}},async autoSaveNota(){if(this.$route.params.id)try{const e={items:this.items.map(e=>{const t=parseFloat(e.kilos)||0;return{kilos:t,medida:e.medida,costo:e.costo,total:t*(e.costo||0)}}),itemsVenta:this.itemsVenta.map(e=>{const t=parseFloat(e.kilosVenta)||0,a=t*(e.precioVenta||0);return{kilosVenta:t,medida:e.medida,precioVenta:e.precioVenta,totalVenta:a,ganancia:e.ganancia}}),totalGeneral:this.totalGeneral,totalGeneralVenta:this.totalGeneralVenta,nuevoSaldoAcumulado:this.nuevoSaldoAcumulado,cobros:this.cobros,abonos:this.abonos,estadoPagado:"Pagado"===this.estadoCuenta,tieneObservacion:this.tieneObservacion,observacion:this.observacion,ultimaActualizacion:(new Date).toISOString()},t=Object(n["e"])(i["a"],"cuentasCatarro",this.$route.params.id);await Object(n["s"])(t,e),this.lastSaveMessage="",this.showSaveMessage=!1}catch(e){if("resource-exhausted"===e.code)throw e;throw this.lastSaveMessage="Error en auto-guardado",this.showSaveMessage=!0,this.saveMessageTimer&&clearTimeout(this.saveMessageTimer),this.saveMessageTimer=setTimeout(()=>{this.showSaveMessage=!1},3e3),e}},guardarCuenta(){this.guardarNota()},agregarObservacion(){this.showObservacionModal=!0},guardarObservacion(){this.observacion.trim()&&(this.tieneObservacion=!0),this.showObservacionModal=!1},cancelarObservacion(){this.tieneObservacion||(this.observacion=""),this.showObservacionModal=!1},editarObservacion(){this.showObservacionModal=!0},eliminarObservacion(){confirm("¿Estás seguro de que deseas eliminar esta observación?")&&(this.observacion="",this.tieneObservacion=!1)},async retryOperation(e,t=3){let a=0;while(a<t)try{return await e()}catch(s){if(a++,console.error(`Error en operación (intento ${a}/${t}):`,s),"resource-exhausted"===s.code?await new Promise(e=>setTimeout(e,5e3*Math.pow(2,a))):await new Promise(e=>setTimeout(e,1e3*Math.pow(2,a))),a>=t)throw console.error("Se alcanzó el número máximo de intentos. Operación fallida."),s}},normalizarMedida(e){return e?e.toString().toLowerCase().replace(/\s+/g,"").replace(/[\[\]()]/g,"").replace(/-/g,"/").trim():""},redondearKilos(e){return null===e||void 0===e?0:Math.round(e)},calcularKilosCrudos(e,t,a=!1){const s=e.toLowerCase().trim(),o=s.includes("crudo");if(o){const e=/^(\d+)-(\d+)$/.exec(s);if(e){const o=parseInt(e[1])||0,i=parseInt(e[2])||0,n=19!==i||a?i:20,r=o*n;return 19!==i||a||r===t?19===i&&a&&console.log(`Cálculo de crudos para tabla de costos: ${o} cajas * 19kg = ${r}kg (formato ${s})`):(this.lastSaveMessage=`Cálculo de crudos: ${o} cajas * 20kg = ${r}kg (formato ${s})`,this.showSaveMessage=!0,this.saveMessageTimer&&clearTimeout(this.saveMessageTimer),this.saveMessageTimer=setTimeout(()=>{this.showSaveMessage=!1},3e3)),r}if(/^\d+\*\d+(\+\d+)?$/.test(s)){const e=s.split(/[\*\+]/);if(e.length>=2){const t=parseInt(e[0])||0,s=parseInt(e[1])||0,o=19!==s||a?s:20;let i=t*o;return e.length>2&&(i+=parseInt(e[2])||0),i}}}return t}},beforeUnmount(){this.autoSaveTimer&&clearTimeout(this.autoSaveTimer),this.saveQueue.length>0&&this.processSaveQueue()}}),m=u,h=(a("736d"),a("2877")),v=Object(h["a"])(m,s,o,!1,null,"749dcc2a",null);t["a"]=v.exports},"736d":function(e,t,a){"use strict";a("c083")},c083:function(e,t,a){},d44e:function(e,t,a){"use strict";a("0407")}}]);