(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["app.21833f8f"],{"19aa":function(a,t,e){"use strict";var i=function(){var a=this,t=a._self._c;return t("div",[t("button",{staticClass:"stash-button",on:{click:function(t){a.showModal=!0}}},[a._v(" Stash ")]),a.showModal?t("div",{staticClass:"modal"},[t("div",{staticClass:"modal-content"},[t("h3",[a._v("Stash de Abonos")]),t("div",{staticClass:"stash-form"},[t("input",{directives:[{name:"model",rawName:"v-model",value:a.newStash.fecha,expression:"newStash.fecha"}],staticClass:"stash-input",attrs:{type:"date"},domProps:{value:a.newStash.fecha},on:{input:function(t){t.target.composing||a.$set(a.newStash,"fecha",t.target.value)}}}),t("input",{directives:[{name:"model",rawName:"v-model",value:a.newStash.descripcion,expression:"newStash.descripcion"}],staticClass:"stash-input",attrs:{type:"text",placeholder:"Descripción"},domProps:{value:a.newStash.descripcion},on:{input:function(t){t.target.composing||a.$set(a.newStash,"descripcion",t.target.value)}}}),t("input",{directives:[{name:"model",rawName:"v-model.number",value:a.newStash.cantidad,expression:"newStash.cantidad",modifiers:{number:!0}}],staticClass:"stash-input",attrs:{type:"number",placeholder:"Cantidad"},domProps:{value:a.newStash.cantidad},on:{input:function(t){t.target.composing||a.$set(a.newStash,"cantidad",a._n(t.target.value))},blur:function(t){return a.$forceUpdate()}}}),t("button",{staticClass:"add-button",on:{click:a.agregarStash}},[a._v(" Agregar ")])]),t("div",{staticClass:"stash-list"},[a.stashItems.length>0?t("table",[a._m(0),t("tbody",a._l(a.stashItems,(function(e,i){return t("tr",{key:i},[t("td",[a._v(a._s(a.formatearFecha(e.fecha)))]),t("td",[a._v(a._s(e.descripcion))]),t("td",[a._v("$"+a._s(a.formatNumber(e.cantidad)))]),t("td",[t("button",{staticClass:"delete-button",on:{click:function(t){return a.eliminarStash(i)}}},[a._v(" Eliminar ")])])])})),0),t("tfoot",[t("tr",[a._m(1),t("td",{attrs:{colspan:"2"}},[t("strong",[a._v("$"+a._s(a.formatNumber(a.totalStash)))])])])])]):t("p",{staticClass:"no-items"},[a._v("No hay items en el stash")])]),t("div",{staticClass:"modal-footer"},[t("button",{staticClass:"close-button",on:{click:function(t){a.showModal=!1}}},[a._v(" Cerrar ")])])])]):a._e()])},s=[function(){var a=this,t=a._self._c;return t("thead",[t("tr",[t("th",[a._v("Fecha")]),t("th",[a._v("Descripción")]),t("th",[a._v("Cantidad")]),t("th",[a._v("Acciones")])])])},function(){var a=this,t=a._self._c;return t("td",{attrs:{colspan:"2"}},[t("strong",[a._v("Total:")])])}],n=(e("14d9"),e("13d5"),e("2b0e")),o=e("1494"),r=e("dc59"),c={name:"StashModal",props:{cliente:{type:String,required:!0}},setup(a){const t=Object(n["ref"])(!1),e=Object(n["ref"])([]),i=Object(n["ref"])({fecha:(new Date).toISOString().split("T")[0],descripcion:"",cantidad:null}),s=Object(n["computed"])(()=>e.value.reduce((a,t)=>a+(Number(t.cantidad)||0),0)),c=async()=>{try{const t=Object(o["o"])(Object(o["c"])(r["a"],"stash_"+a.cliente)),i=await Object(o["g"])(t);e.value=i.docs.map(a=>({id:a.id,...a.data()}))}catch(t){console.error("Error al cargar stash:",t)}},l=async()=>{if(i.value.fecha&&i.value.descripcion&&i.value.cantidad)try{const[t,s,n]=i.value.fecha.split("-").map(Number),c=`${t}-${String(s).padStart(2,"0")}-${String(n).padStart(2,"0")}`,l=await Object(o["b"])(Object(o["c"])(r["a"],"stash_"+a.cliente),{fecha:c,descripcion:i.value.descripcion,cantidad:Number(i.value.cantidad)});e.value.push({id:l.id,fecha:c,descripcion:i.value.descripcion,cantidad:Number(i.value.cantidad)}),i.value={fecha:(new Date).toISOString().split("T")[0],descripcion:"",cantidad:null}}catch(t){console.error("Error al agregar stash:",t),alert("Error al guardar el stash")}else alert("Por favor complete todos los campos")},u=async t=>{try{const i=e.value[t];await Object(o["d"])(Object(o["e"])(r["a"],"stash_"+a.cliente,i.id)),e.value.splice(t,1)}catch(i){console.error("Error al eliminar stash:",i),alert("Error al eliminar el stash")}},d=a=>{const[t,e,i]=a.split("-"),s=new Date(t,e-1,i);return s.toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"})},m=a=>null===a||void 0===a?"0.00":a.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2});return c(),{showModal:t,stashItems:e,newStash:i,totalStash:s,agregarStash:l,eliminarStash:u,formatearFecha:d,formatNumber:m}}},l=c,u=(e("abd1"),e("2877")),d=Object(u["a"])(l,i,s,!1,null,"f44e4858",null);t["a"]=d.exports},"1b08":function(a,t,e){},"2ce3":function(a,t,e){},3480:function(a,t,e){"use strict";e("1b08")},"3bcd":function(a,t,e){},"46cc":function(a,t,e){"use strict";e("473b")},"473b":function(a,t,e){},"511d":function(a,t,e){"use strict";e("2ce3")},"56d7":function(a,t,e){"use strict";e.r(t);var i=e("2b0e"),s=e("3dfd"),n=e("41cb"),o=e("be92"),r=e("f549"),c=e("5f5b"),l=e("b1e0");e("f9e3"),e("2dd8"),e("15f5");i["default"].use(c["a"]),i["default"].use(l["a"]),i["default"].use(o["a"]);const u=Object(o["b"])();i["default"].config.productionTip=!1;new i["default"]({router:n["a"],pinia:u,render:a=>a(s["a"]),created(){const a=localStorage.getItem("user");if(a){const a=Object(r["a"])();a.checkAuth()}}}).$mount("#app");window.fabric||e.e("chunk-2d0a385c").then(e.bind(null,"0314")).then(a=>{window.fabric=a.fabric,console.log("Fabric.js cargado globalmente")}).catch(a=>{console.error("Error al cargar Fabric.js:",a)})},"5ea5":function(a,t,e){"use strict";var i=function(){var a=this,t=a._self._c;return t("div",{staticClass:"sidebar-clientes",class:{"sidebar-collapsed":a.sidebarCollapsed}},[t("div",{staticClass:"sidebar-header"},[a._m(0),t("button",{staticClass:"toggle-sidebar-btn",attrs:{title:a.sidebarCollapsed?"Expandir":"Colapsar"},on:{click:a.toggleSidebar}},[t("i",{staticClass:"fas",class:a.sidebarCollapsed?"fa-chevron-right":"fa-chevron-left"})])]),t("div",{staticClass:"sidebar-clientes-contenido"},[a._l(a.clientesPredefinidos,(function(e){return t("button",{key:e.id,staticClass:"btn-nota-cliente",class:{activo:a.clienteActivoLocal===e.id.toString()},style:{backgroundColor:e.color,color:e.textColor},attrs:{type:"button",title:a.sidebarCollapsed?e.nombre:""},on:{click:function(t){a.seleccionarCliente(e.id.toString())}}},[a.sidebarCollapsed?t("i",{staticClass:"fas fa-user-circle"}):t("span",[a._v(a._s(e.nombre))])])})),a._l(a.clientesPersonalizadosEmbarque,(function(e){return t("button",{key:e.id,staticClass:"btn-nota-cliente cliente-personalizado",class:{activo:a.clienteActivoLocal===e.id.toString()},style:{backgroundColor:a.obtenerColorCliente(e.nombre),color:a.obtenerColorTextoCliente(e.nombre)},attrs:{type:"button",title:a.sidebarCollapsed?e.nombre:""},on:{click:function(t){a.seleccionarCliente(e.id.toString())}}},[a.sidebarCollapsed?t("i",{staticClass:"fas fa-user-circle"}):t("span",[a._v(a._s(e.nombre))])])})),t("button",{staticClass:"btn-agregar-cliente",attrs:{type:"button",title:a.sidebarCollapsed?"Agregar Cliente":""},on:{click:a.mostrarModalNuevoCliente}},[t("i",{staticClass:"fas fa-plus"}),a.sidebarCollapsed?a._e():t("span",[a._v("Agregar Cliente")])])],2),t("div",{staticClass:"sidebar-toggle-mobile"},[t("button",{staticClass:"toggle-sidebar-mobile-btn",on:{click:a.toggleSidebar}},[t("i",{staticClass:"fas",class:a.sidebarCollapsed?"fa-chevron-right":"fa-chevron-left"})])]),t("div",{staticClass:"sidebar-resumen",class:{"resumen-collapsed":a.sidebarCollapsed}},[t("div",{staticClass:"resumen-seccion"},[a._m(1),t("div",{staticClass:"sidebar-item"},[t("span",[a._v("Limpio:")]),t("strong",[a._v(a._s(a.calcularTarasLimpio()))])]),t("div",{staticClass:"sidebar-item"},[t("span",[a._v("Crudo:")]),t("strong",[a._v(a._s(a.calcularTarasCrudo()))])]),t("div",{staticClass:"sidebar-item total"},[t("span",[a._v("Total:")]),t("strong",[a._v(a._s(a.calcularTotalTaras())+"-T")])])]),t("div",{staticClass:"resumen-seccion"},[a._m(2),t("div",{staticClass:"sidebar-item"},[t("span",[a._v("Limpio:")]),t("strong",[a._v(a._s(Math.floor(a.calcularKilosLimpio())))])]),t("div",{staticClass:"sidebar-item"},[t("span",[a._v("Crudo:")]),t("strong",[a._v(a._s(a.calcularKilosCrudo()))])]),t("div",{staticClass:"sidebar-item total"},[t("span",[a._v("Total:")]),t("strong",[a._v(a._s(Math.floor(a.calcularTotalKilos())))])])])])])},s=[function(){var a=this,t=a._self._c;return t("h3",[t("i",{staticClass:"fas fa-users"}),a._v(" Clientes")])},function(){var a=this,t=a._self._c;return t("h4",[t("i",{staticClass:"fas fa-balance-scale"}),a._v(" Resumen Taras")])},function(){var a=this,t=a._self._c;return t("h4",[t("i",{staticClass:"fas fa-weight"}),a._v(" Resumen Kilos")])}],n=(e("13d5"),{name:"Sidebar",props:{embarque:{type:Object,required:!0},clientesPredefinidos:{type:Array,required:!0},clientesPersonalizadosEmbarque:{type:Array,required:!0},clienteCrudos:{type:Object,required:!0},clienteActivo:{type:String,default:null}},data(){return{sidebarCollapsed:!1,clienteActivoLocal:null}},created(){this.clienteActivoLocal=this.clienteActivo},watch:{clienteActivo(a){this.clienteActivoLocal=a}},methods:{toggleSidebar(){this.sidebarCollapsed=!this.sidebarCollapsed,this.$emit("toggle-sidebar",this.sidebarCollapsed)},seleccionarCliente(a){this.clienteActivoLocal=a,this.$emit("seleccionar-cliente",a)},mostrarModalNuevoCliente(){this.$emit("mostrar-modal-nuevo-cliente")},obtenerColorCliente(a){const t={Joselito:"#3498db",Catarro:"#e74c3c",Otilio:"#f1c40f",Ozuna:"#2ecc71",Canelo:"#9b59b6"};return t[a]||"#95a5a6"},obtenerColorTextoCliente(a){const t={Otilio:"black"};return t[a]||"white"},calcularTarasLimpio(){return this.embarque.productos.reduce((a,t)=>{const e=t.clienteId,i=this.clientesPredefinidos.find(a=>a.id.toString()===e.toString());return i?a+this.totalTaras(t):a},0)},calcularTarasCrudo(){return Object.entries(this.clienteCrudos).reduce((a,[t,e])=>{const i=this.clientesPredefinidos.find(a=>a.id.toString()===t.toString());return i?a+e.reduce((a,t)=>a+this.calcularTotalCrudos(t),0):a},0)},calcularTotalTaras(){return this.calcularTarasLimpio()+this.calcularTarasCrudo()},calcularKilosLimpio(){return this.embarque.productos.reduce((a,t)=>{const e=t.clienteId,i=this.clientesPredefinidos.find(a=>a.id.toString()===e.toString());if(!i)return a;if("c/h20"===t.tipo){const e=t.reporteTaras||[],i=t.reporteBolsas||[];let s=0;for(let a=0;a<e.length;a++){const t=parseInt(e[a])||0,n=parseInt(i[a])||0;s+=t*n}const n=s*(t.camaronNeto||.65);return a+n}return a+this.totalKilos(t)},0)},calcularKilosCrudo(){return Object.entries(this.clienteCrudos).reduce((a,[t,e])=>{const i=this.clientesPredefinidos.find(a=>a.id.toString()===t.toString());return i?a+e.reduce((a,t)=>t&&t.items&&Array.isArray(t.items)?a+t.items.reduce((a,t)=>a+this.calcularKilosCrudos(t),0):a,0):a},0)},calcularTotalKilos(){const a=parseFloat(this.calcularKilosLimpio()),t=parseFloat(this.calcularKilosCrudo());return a+t},totalTaras(a){const t=(a.taras||[]).reduce((a,t)=>a+(t||0),0),e=(a.tarasExtra||[]).reduce((a,t)=>a+(t||0),0);return t+e},totalKilos(a){const t=(a.kilos||[]).reduce((a,t)=>a+(t||0),0),e=(a.taras||[]).reduce((a,t)=>a+(t||0),0),i=a.restarTaras?3*e:0;return Number((t-i).toFixed(1))},calcularTotalCrudos(a){return a&&a.items&&Array.isArray(a.items)?a.items.reduce((a,t)=>{let e=this.extraerNumero(t.taras),i=this.extraerNumero(t.sobrante);return a+e+i},0):0},calcularKilosCrudos(a){let t=0;if(a.taras){const e=/^(\d+)-(\d+)$/.exec(a.taras);if(e){const a=parseInt(e[1])||0;let i=parseInt(e[2])||0;19===i&&(i=20),t+=a*i}else{const[e,i]=a.taras.split("-").map(Number);t+=e*i}}if(a.sobrante){const e=/^(\d+)-(\d+)$/.exec(a.sobrante);if(e){const a=parseInt(e[1])||0;let i=parseInt(e[2])||0;19===i&&(i=20),t+=a*i}else{const[e,i]=a.sobrante.split("-").map(Number);t+=e*i}}return t},extraerNumero(a){if(!a)return 0;const t=a.toString().match(/^(\d+)/);return t?parseInt(t[1]):0}}}),o=n,r=(e("511d"),e("2877")),c=Object(r["a"])(o,i,s,!1,null,"7829349c",null);t["a"]=c.exports},abd1:function(a,t,e){"use strict";e("3bcd")},caa9:function(a,t,e){"use strict";var i=function(){var a=this,t=a._self._c;return t("div",{staticClass:"datos-container mt-5"},[t("div",{staticClass:"fecha-actual"},[a._v(a._s(a.fechaActual))]),t("b-row",[t("b-col",{staticClass:"mb-3",attrs:{cols:"12",md:"5"}},[t("b-button",{staticClass:"mb-3",attrs:{variant:"danger",block:""},on:{click:a.borrarDatos}},[a._v("Borrar datos")]),t("b-form-textarea",{staticClass:"text-center",attrs:{name:"dinero",id:"textarea-auto-height",placeholder:"Ingrese cantidades de dinero (una por línea)",rows:"3","max-rows":"10"},model:{value:a.localDatos,callback:function(t){a.localDatos=t},expression:"localDatos"}}),t("div",{staticClass:"mt-3 total-sum"},[t("strong",[a._v("Total: $"+a._s(a.formatNumber(a.totalSum)))])])],1),t("b-col",{attrs:{cols:"12",md:"7"}},[t("Cuentas",{attrs:{datos:a.localDatos}})],1)],1)],1)},s=[],n=(e("13d5"),e("93ae")),o={name:"Datos",components:{Cuentas:n["a"]},props:{initialDatos:{type:String,default:""}},data(){return{localDatos:this.initialDatos}},methods:{borrarDatos(){this.localDatos=""},formatNumber(a){return a.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}},computed:{fechaActual(){const a=new Date,t={year:"numeric",month:"long",day:"numeric"};return a.toLocaleDateString("es-ES",t)},totalSum(){return this.localDatos.split("\n").filter(a=>a.trim()).reduce((a,t)=>a+parseFloat(t)||0,0)}}},r=o,c=(e("46cc"),e("2877")),l=Object(c["a"])(r,i,s,!1,null,"247b5804",null);t["a"]=l.exports},dc59:function(a,t,e){"use strict";e.d(t,"a",(function(){return c})),e.d(t,"c",(function(){return l})),e.d(t,"b",(function(){return u}));var i=e("bc7b"),s=e("1494"),n=e("7c01");const o={apiKey:"AIzaSyDEXrriJ15Gg2IyPYh56gNktfGaSsP6KeE",authDomain:"reypezapp-1ced2.firebaseapp.com",projectId:"reypezapp-1ced2",storageBucket:"reypezapp-1ced2.appspot.com",messagingSenderId:"512757841511",appId:"1:512757841511:web:d15e6a6276e84c42959ec2",databaseURL:"https://reypezapp-1ced2-default-rtdb.firebaseio.com/"},r=Object(i["a"])(o),c=Object(s["i"])(r,{localCache:Object(s["m"])({tabManager:Object(s["n"])()})}),l=Object(n["a"])(r),u=async(a,t)=>{if(a&&t)try{console.log("Configurando presencia para:",t);const e=Object(n["d"])(l,"status/"+a);await Object(n["b"])(e).remove(),await Object(n["e"])(e,{username:t,status:"online",lastSeen:(new Date).toISOString()}),console.log("Presencia configurada exitosamente")}catch(e){console.error("Error al configurar presencia:",e)}else console.log("Se requiere userId y username para manejar la presencia")}},e7e0:function(a,t,e){"use strict";e.d(t,"a",(function(){return s})),e.d(t,"c",(function(){return n})),e.d(t,"b",(function(){return o}));const i={JOSELITO:"#3498db",CATARRO:"#e74c3c",OTILIO:"#f1c40f",OZUNA:"#2ecc71",CANELO:"#9b59b6",DEFAULT:"#95a5a6"},s=[{id:1,nombre:"Joselito",color:i.JOSELITO,textColor:"white"},{id:2,nombre:"Catarro",color:i.CATARRO,textColor:"white"},{id:3,nombre:"Otilio",color:i.OTILIO,textColor:"black"},{id:4,nombre:"Ozuna",color:i.OZUNA,textColor:"white"},{id:5,nombre:"Canelo",color:i.CANELO,textColor:"white"}];function n(a){return{id:Date.now(),clienteId:a,medida:"",tipo:"",tipoPersonalizado:"",taras:[],kilos:[],reporteTaras:[],reporteBolsas:[],tarasExtra:[],restarTaras:!0,camaronNeto:.65,multiplicadorBolsas:1,showSuggestions:!1,esVenta:!1,isEditing:!0,isNew:!0,noSumarKilos:!1}}function o(){return{talla:"",barco:"",taras:null,sobrante:null,mostrarSobrante:!1}}},fe3d:function(a,t,e){"use strict";var i=function(){var a=this,t=a._self._c;return a.mostrar?t("div",{staticClass:"modal-overlay"},[t("div",{staticClass:"modal-agenda"},[t("div",{staticClass:"modal-header"},[t("h3",[a._v("Agenda de Transacciones")]),t("button",{staticClass:"btn-cerrar",on:{click:function(t){return a.$emit("cerrar")}}},[a._v("×")])]),t("div",{staticClass:"calendario-container"},[t("div",{staticClass:"selector-fecha"},[t("button",{staticClass:"btn-nav",on:{click:function(t){return a.cambiarMes(-1)}}},[a._v("<")]),t("span",{staticClass:"mes-anio"},[a._v(a._s(a.nombreMes)+" "+a._s(a.anioActual))]),t("button",{staticClass:"btn-nav",on:{click:function(t){return a.cambiarMes(1)}}},[a._v(">")])]),t("div",{staticClass:"dias-semana"},a._l(a.diasSemana,(function(e){return t("div",{key:e,staticClass:"dia-nombre"},[a._v(a._s(e))])})),0),t("div",{staticClass:"calendario"},a._l(a.diasCalendario,(function(e,i){return t("div",{key:i,staticClass:"dia-celda",class:{"otro-mes":!e.esMesActual,"dia-actual":e.esHoy,"tiene-registros":a.tieneRegistros(e.fecha),seleccionado:a.esDiaSeleccionado(e.fecha)},on:{click:function(t){return a.seleccionarDia(e)}}},[t("span",{staticClass:"numero-dia"},[a._v(a._s(e.numero))]),a.tieneRegistros(e.fecha)?t("div",{staticClass:"indicador-registros"}):a._e()])})),0)]),a.diaSeleccionado?t("div",{staticClass:"transacciones-container"},[t("div",{staticClass:"dia-seleccionado-header"},[t("h4",[a._v(a._s(a.formatoFechaCompleta))]),t("button",{staticClass:"btn-agregar",on:{click:function(t){a.mostrarFormulario=!0}}},[a._v("+ Agregar transacción")])]),a.transaccionesDia.length>0&&!a.mostrarFormulario?t("div",{staticClass:"resumen-dia"},[t("div",{staticClass:"resumen-dia-item"},[t("span",[a._v("Total del día:")]),t("span",[a._v("$"+a._s(a.formatearNumero(a.calcularTotalDia())))])]),t("div",{staticClass:"resumen-dia-item"},[t("span",[a._v("Depósitos:")]),t("span",{staticClass:"color-deposito"},[a._v("$"+a._s(a.formatearNumero(a.calcularTotalDiaPorTipo("deposito"))))])]),t("div",{staticClass:"resumen-dia-item"},[t("span",[a._v("Transferencias:")]),t("span",{staticClass:"color-transferencia"},[a._v("$"+a._s(a.formatearNumero(a.calcularTotalDiaPorTipo("transferencia"))))])]),t("div",{staticClass:"resumen-dia-item"},[t("span",[a._v("Transacciones:")]),t("span",[a._v(a._s(a.transaccionesDia.length))])])]):a._e(),0!==a.transaccionesDia.length||a.mostrarFormulario?a._e():t("div",{staticClass:"sin-transacciones"},[a._v(" No hay transacciones registradas para este día. ")]),a.mostrarFormulario?t("div",{staticClass:"formulario-transaccion"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"cliente"}},[a._v("Cliente:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.nuevaTransaccion.cliente,expression:"nuevaTransaccion.cliente"}],staticClass:"input-field",attrs:{id:"cliente"},on:{change:function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(a.nuevaTransaccion,"cliente",t.target.multiple?e:e[0])}}},[t("option",{attrs:{value:"mexico"}},[a._v("México")]),t("option",{attrs:{value:"ozuna"}},[a._v("Ozuna")]),t("option",{attrs:{value:"catarro"}},[a._v("Catarro")]),t("option",{attrs:{value:"joselito"}},[a._v("Joselito")]),t("option",{attrs:{value:"otilio"}},[a._v("Otilio")])])]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"tipo"}},[a._v("Tipo de transacción:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.nuevaTransaccion.tipo,expression:"nuevaTransaccion.tipo"}],staticClass:"input-field",attrs:{id:"tipo"},on:{change:function(t){var e=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.$set(a.nuevaTransaccion,"tipo",t.target.multiple?e:e[0])}}},[t("option",{attrs:{value:"deposito"}},[a._v("Depósito")]),t("option",{attrs:{value:"transferencia"}},[a._v("Transferencia")]),t("option",{attrs:{value:"efectivo"}},[a._v("Efectivo")]),t("option",{attrs:{value:"otro"}},[a._v("Otro")])])]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"monto"}},[a._v("Monto:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.nuevaTransaccion.monto,expression:"nuevaTransaccion.monto"}],staticClass:"input-field",attrs:{type:"number",id:"monto",placeholder:"Monto en pesos"},domProps:{value:a.nuevaTransaccion.monto},on:{input:function(t){t.target.composing||a.$set(a.nuevaTransaccion,"monto",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"descripcion"}},[a._v("Descripción:")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:a.nuevaTransaccion.descripcion,expression:"nuevaTransaccion.descripcion"}],staticClass:"input-field textarea",attrs:{id:"descripcion",placeholder:"Detalles de la transacción"},domProps:{value:a.nuevaTransaccion.descripcion},on:{input:function(t){t.target.composing||a.$set(a.nuevaTransaccion,"descripcion",t.target.value)}}})]),t("div",{staticClass:"buttons-container"},[t("button",{staticClass:"btn-guardar",attrs:{disabled:!a.esFormularioValido},on:{click:a.guardarTransaccion}},[a._v(" Guardar ")]),t("button",{staticClass:"btn-cancelar",on:{click:a.cancelarFormulario}},[a._v(" Cancelar ")])])]):a._e(),a.mostrarFormulario||a.mostrarVistaLista?a._e():t("div",{staticClass:"transacciones-agrupadas"},[t("div",{staticClass:"fila-clientes"},[t("div",{staticClass:"cliente-card cliente-card-otilio"},[t("div",{staticClass:"cliente-header cliente-otilio"},[t("h4",[a._v("Otilio")]),a.clientesAgrupados.otilio&&a.clientesAgrupados.otilio.length>0?t("div",{staticClass:"cliente-total"},[a._v(" Total: $"+a._s(a.formatearNumero(a.calcularTotalCliente("otilio")))+" ")]):t("div",{staticClass:"cliente-total sin-datos"},[a._v("Sin transacciones")])]),a.clientesAgrupados.otilio&&a.clientesAgrupados.otilio.length>0?t("div",{staticClass:"cliente-resumen"},[t("div",{staticClass:"resumen-item tipo-deposito"},[t("span",[a._v("Depósitos:")]),t("span",[a._v("$"+a._s(a.formatearNumero(a.calcularTotalPorTipo("otilio","deposito"))))])]),t("div",{staticClass:"resumen-item tipo-transferencia"},[t("span",[a._v("Transferencias:")]),t("span",[a._v("$"+a._s(a.formatearNumero(a.calcularTotalPorTipo("otilio","transferencia"))))])])]):a._e(),a.clientesAgrupados.otilio&&a.clientesAgrupados.otilio.length>0?t("div",{staticClass:"cliente-contador"},[a._v(" "+a._s(a.clientesAgrupados.otilio.length)+" transacción(es) ")]):a._e(),a.clientesAgrupados.otilio&&a.clientesAgrupados.otilio.length>0?t("div",{staticClass:"cliente-transacciones"},a._l(a.clientesAgrupados.otilio,(function(e,i){return t("div",{key:"otilio-"+i,staticClass:"transaccion-mini",class:"tipo-"+e.tipo},[t("div",{staticClass:"transaccion-mini-header"},[t("span",[a._v(a._s(a.obtenerTipoTexto(e.tipo)))]),t("span",[a._v("$"+a._s(a.formatearNumero(e.monto)))])]),t("div",{staticClass:"transaccion-mini-hora"},[a._v(a._s(a.formatearHora(e.timestamp)))]),t("div",{staticClass:"transaccion-mini-acciones"},[t("button",{staticClass:"btn-mini",on:{click:function(t){a.editarTransaccion(a.obtenerIndiceTransaccion(e))}}},[a._v("Editar")]),t("button",{staticClass:"btn-mini btn-mini-eliminar",on:{click:function(t){a.eliminarTransaccion(a.obtenerIndiceTransaccion(e))}}},[a._v("Eliminar")])])])})),0):t("div",{staticClass:"cliente-vacio"},[t("button",{staticClass:"btn-agregar-mini cliente-otilio",on:{click:function(t){a.nuevaTransaccion.cliente="otilio",a.mostrarFormulario=!0}}},[a._v(" + Agregar transacción para Otilio ")])])]),t("div",{staticClass:"cliente-card cliente-card-joselito"},[t("div",{staticClass:"cliente-header cliente-joselito"},[t("h4",[a._v("Joselito")]),a.clientesAgrupados.joselito&&a.clientesAgrupados.joselito.length>0?t("div",{staticClass:"cliente-total"},[a._v(" Total: $"+a._s(a.formatearNumero(a.calcularTotalCliente("joselito")))+" ")]):t("div",{staticClass:"cliente-total sin-datos"},[a._v("Sin transacciones")])]),a.clientesAgrupados.joselito&&a.clientesAgrupados.joselito.length>0?t("div",{staticClass:"cliente-resumen"},[t("div",{staticClass:"resumen-item tipo-deposito"},[t("span",[a._v("Depósitos:")]),t("span",[a._v("$"+a._s(a.formatearNumero(a.calcularTotalPorTipo("joselito","deposito"))))])]),t("div",{staticClass:"resumen-item tipo-transferencia"},[t("span",[a._v("Transferencias:")]),t("span",[a._v("$"+a._s(a.formatearNumero(a.calcularTotalPorTipo("joselito","transferencia"))))])])]):a._e(),a.clientesAgrupados.joselito&&a.clientesAgrupados.joselito.length>0?t("div",{staticClass:"cliente-contador"},[a._v(" "+a._s(a.clientesAgrupados.joselito.length)+" transacción(es) ")]):a._e(),a.clientesAgrupados.joselito&&a.clientesAgrupados.joselito.length>0?t("div",{staticClass:"cliente-transacciones"},a._l(a.clientesAgrupados.joselito,(function(e,i){return t("div",{key:"joselito-"+i,staticClass:"transaccion-mini",class:"tipo-"+e.tipo},[t("div",{staticClass:"transaccion-mini-header"},[t("span",[a._v(a._s(a.obtenerTipoTexto(e.tipo)))]),t("span",[a._v("$"+a._s(a.formatearNumero(e.monto)))])]),t("div",{staticClass:"transaccion-mini-hora"},[a._v(a._s(a.formatearHora(e.timestamp)))]),t("div",{staticClass:"transaccion-mini-acciones"},[t("button",{staticClass:"btn-mini",on:{click:function(t){a.editarTransaccion(a.obtenerIndiceTransaccion(e))}}},[a._v("Editar")]),t("button",{staticClass:"btn-mini btn-mini-eliminar",on:{click:function(t){a.eliminarTransaccion(a.obtenerIndiceTransaccion(e))}}},[a._v("Eliminar")])])])})),0):t("div",{staticClass:"cliente-vacio"},[t("button",{staticClass:"btn-agregar-mini cliente-joselito",on:{click:function(t){a.nuevaTransaccion.cliente="joselito",a.mostrarFormulario=!0}}},[a._v(" + Agregar transacción para Joselito ")])])])]),t("div",{staticClass:"fila-clientes"},[t("div",{staticClass:"cliente-card cliente-card-catarro"},[t("div",{staticClass:"cliente-header cliente-catarro"},[t("h4",[a._v("Catarro")]),a.clientesAgrupados.catarro&&a.clientesAgrupados.catarro.length>0?t("div",{staticClass:"cliente-total"},[a._v(" Total: $"+a._s(a.formatearNumero(a.calcularTotalCliente("catarro")))+" ")]):t("div",{staticClass:"cliente-total sin-datos"},[a._v("Sin transacciones")])]),a.clientesAgrupados.catarro&&a.clientesAgrupados.catarro.length>0?t("div",{staticClass:"cliente-resumen"},[t("div",{staticClass:"resumen-item tipo-deposito"},[t("span",[a._v("Depósitos:")]),t("span",[a._v("$"+a._s(a.formatearNumero(a.calcularTotalPorTipo("catarro","deposito"))))])]),t("div",{staticClass:"resumen-item tipo-transferencia"},[t("span",[a._v("Transferencias:")]),t("span",[a._v("$"+a._s(a.formatearNumero(a.calcularTotalPorTipo("catarro","transferencia"))))])])]):a._e(),a.clientesAgrupados.catarro&&a.clientesAgrupados.catarro.length>0?t("div",{staticClass:"cliente-contador"},[a._v(" "+a._s(a.clientesAgrupados.catarro.length)+" transacción(es) ")]):a._e(),a.clientesAgrupados.catarro&&a.clientesAgrupados.catarro.length>0?t("div",{staticClass:"cliente-transacciones"},a._l(a.clientesAgrupados.catarro,(function(e,i){return t("div",{key:"catarro-"+i,staticClass:"transaccion-mini",class:"tipo-"+e.tipo},[t("div",{staticClass:"transaccion-mini-header"},[t("span",[a._v(a._s(a.obtenerTipoTexto(e.tipo)))]),t("span",[a._v("$"+a._s(a.formatearNumero(e.monto)))])]),t("div",{staticClass:"transaccion-mini-hora"},[a._v(a._s(a.formatearHora(e.timestamp)))]),t("div",{staticClass:"transaccion-mini-acciones"},[t("button",{staticClass:"btn-mini",on:{click:function(t){a.editarTransaccion(a.obtenerIndiceTransaccion(e))}}},[a._v("Editar")]),t("button",{staticClass:"btn-mini btn-mini-eliminar",on:{click:function(t){a.eliminarTransaccion(a.obtenerIndiceTransaccion(e))}}},[a._v("Eliminar")])])])})),0):t("div",{staticClass:"cliente-vacio"},[t("button",{staticClass:"btn-agregar-mini cliente-catarro",on:{click:function(t){a.nuevaTransaccion.cliente="catarro",a.mostrarFormulario=!0}}},[a._v(" + Agregar transacción para Catarro ")])])]),t("div",{staticClass:"cliente-card cliente-card-ozuna"},[t("div",{staticClass:"cliente-header cliente-ozuna"},[t("h4",[a._v("Ozuna")]),a.clientesAgrupados.ozuna&&a.clientesAgrupados.ozuna.length>0?t("div",{staticClass:"cliente-total"},[a._v(" Total: $"+a._s(a.formatearNumero(a.calcularTotalCliente("ozuna")))+" ")]):t("div",{staticClass:"cliente-total sin-datos"},[a._v("Sin transacciones")])]),a.clientesAgrupados.ozuna&&a.clientesAgrupados.ozuna.length>0?t("div",{staticClass:"cliente-resumen"},[t("div",{staticClass:"resumen-item tipo-deposito"},[t("span",[a._v("Depósitos:")]),t("span",[a._v("$"+a._s(a.formatearNumero(a.calcularTotalPorTipo("ozuna","deposito"))))])]),t("div",{staticClass:"resumen-item tipo-transferencia"},[t("span",[a._v("Transferencias:")]),t("span",[a._v("$"+a._s(a.formatearNumero(a.calcularTotalPorTipo("ozuna","transferencia"))))])])]):a._e(),a.clientesAgrupados.ozuna&&a.clientesAgrupados.ozuna.length>0?t("div",{staticClass:"cliente-contador"},[a._v(" "+a._s(a.clientesAgrupados.ozuna.length)+" transacción(es) ")]):a._e(),a.clientesAgrupados.ozuna&&a.clientesAgrupados.ozuna.length>0?t("div",{staticClass:"cliente-transacciones"},a._l(a.clientesAgrupados.ozuna,(function(e,i){return t("div",{key:"ozuna-"+i,staticClass:"transaccion-mini",class:"tipo-"+e.tipo},[t("div",{staticClass:"transaccion-mini-header"},[t("span",[a._v(a._s(a.obtenerTipoTexto(e.tipo)))]),t("span",[a._v("$"+a._s(a.formatearNumero(e.monto)))])]),t("div",{staticClass:"transaccion-mini-hora"},[a._v(a._s(a.formatearHora(e.timestamp)))]),t("div",{staticClass:"transaccion-mini-acciones"},[t("button",{staticClass:"btn-mini",on:{click:function(t){a.editarTransaccion(a.obtenerIndiceTransaccion(e))}}},[a._v("Editar")]),t("button",{staticClass:"btn-mini btn-mini-eliminar",on:{click:function(t){a.eliminarTransaccion(a.obtenerIndiceTransaccion(e))}}},[a._v("Eliminar")])])])})),0):t("div",{staticClass:"cliente-vacio"},[t("button",{staticClass:"btn-agregar-mini cliente-ozuna",on:{click:function(t){a.nuevaTransaccion.cliente="ozuna",a.mostrarFormulario=!0}}},[a._v(" + Agregar transacción para Ozuna ")])])])]),t("div",{staticClass:"cambiar-vista"},[t("button",{staticClass:"btn-cambiar-vista",on:{click:function(t){a.mostrarVistaLista=!a.mostrarVistaLista}}},[a._v(" Ver lista completa ")])])]),a.transaccionesDia.length>0&&a.mostrarVistaLista&&!a.mostrarFormulario?t("div",{staticClass:"lista-transacciones"},[a._l(a.transaccionesDia,(function(e,i){return t("div",{key:i,staticClass:"transaccion-item",class:"tipo-"+e.tipo},[t("div",{staticClass:"transaccion-header"},[t("div",{staticClass:"transaccion-tipo"},[a._v(a._s(a.obtenerTipoTexto(e.tipo)))]),t("div",{staticClass:"transaccion-monto"},[a._v("$"+a._s(a.formatearNumero(e.monto)))])]),t("div",{staticClass:"transaccion-cliente"},[a._v("Cliente: "+a._s(a.obtenerClienteTexto(e.cliente)))]),t("div",{staticClass:"transaccion-descripcion"},[a._v(a._s(e.descripcion))]),t("div",{staticClass:"transaccion-hora"},[a._v(a._s(a.formatearHora(e.timestamp)))]),t("div",{staticClass:"transaccion-acciones"},[t("button",{staticClass:"btn-editar",on:{click:function(t){return a.editarTransaccion(i)}}},[a._v("Editar")]),t("button",{staticClass:"btn-eliminar",on:{click:function(t){return a.eliminarTransaccion(i)}}},[a._v("Eliminar")])])])})),t("div",{staticClass:"cambiar-vista"},[t("button",{staticClass:"btn-cambiar-vista",on:{click:function(t){a.mostrarVistaLista=!a.mostrarVistaLista}}},[a._v(" Ver agrupado por cliente ")])])],2):a._e()]):a._e()])]):a._e()},s=[],n=(e("14d9"),e("13d5"),e("dc59")),o=e("1494"),r={name:"TransaccionesAgendaModal",props:{mostrar:{type:Boolean,required:!0},cliente:{type:String,required:!0}},data(){return{mesActual:(new Date).getMonth(),anioActual:(new Date).getFullYear(),diasSemana:["Dom","Lun","Mar","Mié","Jue","Vie","Sáb"],meses:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],diaSeleccionado:null,mostrarFormulario:!1,mostrarVistaLista:!1,transacciones:[],nuevaTransaccion:{tipo:"deposito",monto:"",descripcion:"",timestamp:null,cliente:""},editandoIndex:-1}},computed:{nombreMes(){return this.meses[this.mesActual]},diasCalendario(){const a=[],t=new Date(this.anioActual,this.mesActual,1),e=new Date(this.anioActual,this.mesActual+1,0),i=new Date,s=t.getDay();if(s>0){const t=new Date(this.anioActual,this.mesActual,0);for(let e=s-1;e>=0;e--){const s=t.getDate()-e,n=new Date(this.anioActual,this.mesActual-1,s);a.push({numero:s,fecha:n,esMesActual:!1,esHoy:this.esMismaFecha(n,i)})}}for(let o=1;o<=e.getDate();o++){const t=new Date(this.anioActual,this.mesActual,o);a.push({numero:o,fecha:t,esMesActual:!0,esHoy:this.esMismaFecha(t,i)})}const n=42-a.length;for(let o=1;o<=n;o++){const t=new Date(this.anioActual,this.mesActual+1,o);a.push({numero:o,fecha:t,esMesActual:!1,esHoy:this.esMismaFecha(t,i)})}return a},transaccionesDia(){return this.diaSeleccionado?this.transacciones.filter(a=>this.esMismaFecha(new Date(a.timestamp),this.diaSeleccionado.fecha)):[]},formatoFechaCompleta(){if(!this.diaSeleccionado)return"";const a={weekday:"long",year:"numeric",month:"long",day:"numeric"};return this.diaSeleccionado.fecha.toLocaleDateString("es-ES",a)},esFormularioValido(){return this.nuevaTransaccion.tipo&&this.nuevaTransaccion.monto>0&&this.nuevaTransaccion.cliente},clientesAgrupados(){if(!this.diaSeleccionado)return{};const a={otilio:[],joselito:[],catarro:[],ozuna:[],mexico:[]};return this.transaccionesDia.forEach(t=>{t.cliente&&a[t.cliente]&&a[t.cliente].push(t)}),a}},methods:{cambiarMes(a){let t=this.mesActual+a;t>11?(this.mesActual=0,this.anioActual++):t<0?(this.mesActual=11,this.anioActual--):this.mesActual=t,this.cargarTransacciones()},seleccionarDia(a){this.diaSeleccionado=a,this.mostrarFormulario=!1},esMismaFecha(a,t){return a.getDate()===t.getDate()&&a.getMonth()===t.getMonth()&&a.getFullYear()===t.getFullYear()},esDiaSeleccionado(a){return!!this.diaSeleccionado&&this.esMismaFecha(a,this.diaSeleccionado.fecha)},tieneRegistros(a){return this.transacciones.some(t=>this.esMismaFecha(new Date(t.timestamp),a))},formatearNumero(a){return a.toLocaleString("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2})},formatearHora(a){const t=new Date(a);return t.toLocaleTimeString("es-MX",{hour:"2-digit",minute:"2-digit"})},obtenerTipoTexto(a){const t={deposito:"Depósito",transferencia:"Transferencia",efectivo:"Efectivo",otro:"Otro"};return t[a]||"Otro"},obtenerClienteTexto(a){const t={mexico:"México",ozuna:"Ozuna",catarro:"Catarro",joselito:"Joselito",otilio:"Otilio"};return t[a]||a},cancelarFormulario(){this.mostrarFormulario=!1,this.nuevaTransaccion={tipo:"deposito",monto:"",descripcion:"",timestamp:null,cliente:""},this.editandoIndex=-1},async guardarTransaccion(){if(this.esFormularioValido)try{const a={...this.nuevaTransaccion,monto:parseFloat(this.nuevaTransaccion.monto),timestamp:this.nuevaTransaccion.timestamp||(new Date).toISOString(),fecha:this.diaSeleccionado.fecha.toISOString().split("T")[0]};if(this.editandoIndex>=0){const t=this.transaccionesDia[this.editandoIndex].id,e=Object(o["e"])(n["a"],"transacciones",t);await Object(o["r"])(e,a),this.transacciones=this.transacciones.map(e=>e.id===t?{...a,id:t}:e)}else{const t=await Object(o["b"])(Object(o["c"])(n["a"],"transacciones"),a);this.transacciones.push({...a,id:t.id})}this.cancelarFormulario()}catch(a){console.error("Error al guardar la transacción:",a),alert("Ocurrió un error al guardar la transacción. Por favor intenta de nuevo.")}},editarTransaccion(a){const t=this.transaccionesDia[a];this.nuevaTransaccion={tipo:t.tipo,monto:t.monto,descripcion:t.descripcion,timestamp:t.timestamp,cliente:t.cliente||this.cliente},this.editandoIndex=a,this.mostrarFormulario=!0},async eliminarTransaccion(a){if(confirm("¿Estás seguro de que deseas eliminar esta transacción?"))try{const t=this.transaccionesDia[a].id;await Object(o["d"])(Object(o["e"])(n["a"],"transacciones",t)),this.transacciones=this.transacciones.filter(a=>a.id!==t)}catch(t){console.error("Error al eliminar la transacción:",t),alert("Ocurrió un error al eliminar la transacción. Por favor intenta de nuevo.")}},async cargarTransacciones(){try{const a=new Date(this.anioActual,this.mesActual,1),t=new Date(this.anioActual,this.mesActual+1,0),e=a.toISOString().split("T")[0],i=t.toISOString().split("T")[0],s=Object(o["o"])(Object(o["c"])(n["a"],"transacciones"),Object(o["s"])("fecha",">=",e),Object(o["s"])("fecha","<=",i)),r=await Object(o["g"])(s);this.transacciones=[],r.forEach(a=>{this.transacciones.push({id:a.id,...a.data()})})}catch(a){console.error("Error al cargar las transacciones:",a)}},calcularTotalCliente(a){return this.clientesAgrupados[a]?this.clientesAgrupados[a].reduce((a,t)=>a+(parseFloat(t.monto)||0),0):0},calcularTotalPorTipo(a,t){return this.clientesAgrupados[a]?this.clientesAgrupados[a].filter(a=>a.tipo===t).reduce((a,t)=>a+(parseFloat(t.monto)||0),0):0},obtenerIndiceTransaccion(a){return this.transaccionesDia.findIndex(t=>t.id===a.id)},calcularTotalDia(){return this.transaccionesDia.reduce((a,t)=>a+(parseFloat(t.monto)||0),0)},calcularTotalDiaPorTipo(a){return this.transaccionesDia.filter(t=>t.tipo===a).reduce((a,t)=>a+(parseFloat(t.monto)||0),0)}},watch:{mostrar(a){a&&(this.mesActual=(new Date).getMonth(),this.anioActual=(new Date).getFullYear(),this.diaSeleccionado={fecha:new Date,numero:(new Date).getDate(),esMesActual:!0,esHoy:!0},this.cargarTransacciones())},cliente(a){this.mostrar&&(this.nuevaTransaccion.cliente=a,this.cargarTransacciones())}},created(){this.nuevaTransaccion.cliente=this.cliente}},c=r,l=(e("3480"),e("2877")),u=Object(l["a"])(c,i,s,!1,null,"6bd728d4",null);t["a"]=u.exports}}]);