(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["app.c714bc7b"],{"2fe3":function(e,t,o){"use strict";o.d(t,"a",(function(){return s}));o("14d9"),o("13d5"),o("2c66"),o("249d"),o("40e9"),o("907a"),o("986a"),o("1d02"),o("3c5d"),o("6ce5"),o("2834"),o("4ea1");var n=o("e499"),a=o.n(n),r=o("4ebb"),i=o.n(r);try{i.a?a.a.vfs=i.a:"object"===typeof r&&(a.a.vfs=r)}catch(P){console.warn("Error al inicializar pdfMake local:",P)}async function s(e,t,o){try{if(console.log("Generando nota para PDF:",{productos:e.productos,kilosCrudos:e.kilosCrudos,clienteCrudos:e.clienteCrudos,fecha:e.fecha,cargaCon:e.cargaCon}),!e||!e.productos)return void console.warn("El embarque no contiene datos de productos válidos");const n=await L("https://res.cloudinary.com/hwkcovsmr/image/upload/v1620946647/samples/REY_PEZ_LOGO_nsotww.png"),r=[{columns:[{image:n,width:100,alignment:"left",margin:[0,0,0,10]},{text:"Nota de Venta",style:"notaVentaHeader",alignment:"center",margin:[0,20,0,0]},{stack:[{text:"Fecha: "+new Date(e.fecha).toLocaleString("es-MX",{timeZone:"UTC",year:"numeric",month:"2-digit",day:"2-digit"}),alignment:"right",margin:[0,20,0,0]},{text:"Carga con: "+(e.cargaCon||"No especificado"),alignment:"right",margin:[0,5,0,0]}]}]},{text:"\n"},...c(e,t,o),...d({...e,kilosCrudos:e.kilosCrudos||{}},t)],i=[{columns:[{image:n,width:100,alignment:"left",margin:[0,0,0,10]},{text:"Nota de Embarque",style:"notaVentaHeader",alignment:"center",margin:[0,20,0,0]},{stack:[{text:"Fecha: "+new Date(e.fecha).toLocaleString("es-MX",{timeZone:"UTC",year:"numeric",month:"2-digit",day:"2-digit"}),alignment:"right",margin:[0,20,0,0]},{text:"Carga con: "+(e.cargaCon||"No especificado"),alignment:"right",margin:[0,5,0,0]}]}]},{text:"\n"},...T(e,t,o),...d({...e,kilosCrudos:e.kilosCrudos||{}},t)],s={content:[...r,{text:"",pageBreak:"before"},...i],styles:{notaVentaHeader:{color:"#3760b0",fontSize:30,bold:!0,italics:!0},header:{fontSize:30,bold:!0,color:"#2980b9",margin:[0,0,0,10]},subheader:{fontSize:25,bold:!0,margin:[0,10,0,5]},tableHeader:{bold:!0,fontSize:23,color:"black",fillColor:"#ecf0f1"},clienteJoselito:{color:"#FFFFFF",background:"#0000FF",padding:[2,2,2,2]},clienteCatarro:{color:"#FFFFFF",background:"#FF0000",padding:[2,2,2,2]},clienteOtilio:{color:"#000000",background:"#FFD700",padding:[2,2,2,2]},clienteOzuna:{color:"#FFFFFF",background:"#008000",padding:[2,2,2,2]},clienteCanelo:{color:"#FFFFFF",background:"#9b59b6",padding:[2,2,2,2]},clienteOtro:{color:"#000000",background:"#808080",padding:[2,2,2,2]},medidaHeader:{fontSize:24,bold:!0,color:"#2c3e50",margin:[0,10,0,5]},precio:{color:"#FFFFFF",background:"#FF0000",padding:[2,2,2,2]},totalPrecio:{color:"#FFFFFF",background:"#9b59b6",padding:[2,2,2,2],bold:!0,fontSize:21},granTotal:{color:"#FFFFFF",background:"#8e44ad",padding:[4,4,4,4],bold:!0,fontSize:24},tipoConAgua:{color:"#2980b9",bold:!0},nota:{fontSize:18,color:"#666666",italics:!0}},defaultStyle:{fontSize:20},footer:function(e,t){return{columns:[{text:" 2025 Rey Pez - Tampico, Tamps.",alignment:"center",margin:[0,10,0,0]}],margin:[40,0,40,0],fontSize:20,color:"#3760b0"}}};a.a.createPdf(s).getBuffer(t=>{new Uint8Array(t);const o=t.toString().match(/\/Page\W/g).length,n=l(e);console.log(`Total de productos: ${n}, Páginas generadas: ${o}`);let r="ninguno";if(n>=8&&n<12?r="moderado":(n>=12||o>2)&&(r="agresivo"),"ninguno"!==r){const e={...s,defaultStyle:{...s.defaultStyle,fontSize:"moderado"===r?16:14},styles:{...s.styles,notaVentaHeader:{...s.styles.notaVentaHeader,fontSize:"moderado"===r?24:20},header:{...s.styles.header,fontSize:"moderado"===r?24:20},subheader:{...s.styles.subheader,fontSize:"moderado"===r?20:17},tableHeader:{...s.styles.tableHeader,fontSize:"moderado"===r?18:15},medidaHeader:{...s.styles.medidaHeader,fontSize:"moderado"===r?20:16},nota:{...s.styles.nota,fontSize:"moderado"===r?15:12},totalPrecio:{...s.styles.totalPrecio,fontSize:"moderado"===r?18:15},granTotal:{...s.styles.granTotal,fontSize:"moderado"===r?20:17}},footer:function(e,t){return{columns:[{text:" 2025 Rey Pez - Tampico, Tamps.",alignment:"center",margin:[0,10,0,0]}],margin:[40,0,40,0],fontSize:"moderado"===r?16:14,color:"#3760b0"}}};a.a.createPdf(e).download("nota-venta.pdf"),console.log("PDF generado con nivel de reducción: "+r)}else a.a.createPdf(s).download("nota-venta.pdf"),console.log("PDF generado sin reducción de escala")})}catch(P){console.error("Error al generar el PDF:",P)}}function l(e){let t=0;return e.productos&&Array.isArray(e.productos)&&(t+=e.productos.filter(e=>{const t=(e.kilos||[]).reduce((e,t)=>e+(Number(t)||0),0);return t>0}).length),e.clienteCrudos&&Object.values(e.clienteCrudos).forEach(e=>{Array.isArray(e)&&e.forEach(e=>{e&&Array.isArray(e.items)&&(t+=e.items.filter(e=>e&&(e.taras||e.sobrante)).length)})}),t}function c(e,t,o){const n=[];let a=0,r=0;const i=e.productos.reduce((e,t)=>(e[t.clienteId]||(e[t.clienteId]=[]),e[t.clienteId].push(t),e),{});return Object.entries(i).forEach(([i,s])=>{const l=x(i,t),c=f(l),d=o&&o[i],u=s.filter(e=>{const t=w(e,l);return t>0});if(n.push({text:"Cliente: "+l,style:["subheader",c],margin:[0,5,0,5]}),u.length>0){let e=u;if(d){const t={};u.forEach(e=>{const o=e.nombreAlternativoPDF||e.medida,n=e.tipo||"",a=e.camaronNeto||.65,r="c/h20"===n?`${o}-${n}-${a}`:`${o}-${n}`;t[r]?(t[r].kilos.push(...e.kilos),t[r].taras.push(...e.taras),e.tarasExtra&&t[r].tarasExtra.push(...e.tarasExtra),e.reporteTaras&&t[r].reporteTaras.push(...e.reporteTaras),e.reporteBolsas&&t[r].reporteBolsas.push(...e.reporteBolsas),t[r].tarasInfo.push(...e.taras.map(t=>({valor:t,restarTaras:e.restarTaras}))),t[r].taras=t[r].tarasInfo.map(e=>e.valor)):t[r]={...e,medida:o,kilos:[...e.kilos],taras:[...e.taras],tarasExtra:[...e.tarasExtra||[]],reporteTaras:[...e.reporteTaras||[]],reporteBolsas:[...e.reporteBolsas||[]],tarasInfo:e.taras.map(t=>({valor:t,restarTaras:e.restarTaras}))}}),e=Object.values(t)}const t=m(e),o=t.some(e=>{const t=w(e,l);return t>0});if(o){n.push({text:"Limpio:",style:["subheader",c],margin:[0,5,0,5]},p(t,c,l),{text:"\n"});const e=s.reduce((e,t)=>e+C(t),0);e>0&&(a+=e,n.push({text:"Taras de limpio: "+e,margin:[0,5,0,5]},{text:"\n"}))}}if(e.clienteCrudos&&e.clienteCrudos[i]){const t=e.clienteCrudos[i].some(e=>e.items.some(e=>{const t=F(e,l),o=parseFloat(t);return o>0}));if(t){n.push({text:"Crudos:",style:["subheader",c],margin:[0,5,0,5]},b(e.clienteCrudos[i],c),{text:"\n"});const t=e.clienteCrudos[i].reduce((e,t)=>e+t.items.reduce((e,t)=>e+y(t),0),0);t>0&&(r+=t,n.push({text:"Taras de crudo: "+t,margin:[0,5,0,5]},{text:"\n"}))}}const h=u.length>0,g=e.clienteCrudos&&e.clienteCrudos[i]&&e.clienteCrudos[i].some(e=>e.items.some(e=>{const t=F(e,l),o=parseFloat(t);return o>0}));h||g||n.push({text:"No hay medidas registradas para este cliente",italics:!0,margin:[0,5,0,10]},{text:"\n"})}),a+r>0&&n.push({text:"Total general de taras: "+(a+r),style:"subheader",margin:[0,5,0,5]}),n}function d(e,t){const o=[],n=e.productos.filter(e=>"4"===e.clienteId&&!e.esVenta);if(n.length>0){o.push({text:"Rendimientos de Maquila:",style:"subheader",margin:[0,20,0,10]});const t={table:{headerRows:1,widths:["33%","33%","34%"],body:[[{text:"Medida",style:"tableHeader"},{text:"Kilos en Crudo",style:"tableHeader"},{text:"Rendimiento",style:"tableHeader"}]]},layout:{hLineWidth:()=>1,vLineWidth:()=>1,hLineColor:()=>"#008000",vLineColor:()=>"#008000"}};let a=0,r=0;const i=n.reduce((e,t)=>{const o=t.medida;return e[o]||(e[o]=[]),e[o].push(t),e},{});Object.entries(i).forEach(([o,n])=>{const i=n.reduce((e,t)=>e+u(t),0);let s=0;const l=o+" Maquila Ozuna";e.kilosCrudos&&e.kilosCrudos[l]&&(s="object"===typeof e.kilosCrudos[l]?Number(e.kilosCrudos[l].medida1||0)+Number(e.kilosCrudos[l].medida2||0):Number(e.kilosCrudos[l]));const c=i>0?s/i:0;a+=s,r+=i,t.table.body.push([{text:o,alignment:"center"},{text:s.toFixed(2)+" kg",alignment:"center"},{text:c.toFixed(2),alignment:"center",color:c>1?"#27ae60":"#000000",bold:c>1}])});const s=r>0?a/r:0;t.table.body.push([{text:"TOTAL",style:"tableHeader",alignment:"center"},{text:a.toFixed(2)+" kg",style:"tableHeader",alignment:"center"},{text:s.toFixed(2),style:"tableHeader",alignment:"center",color:s>1?"#27ae60":"#000000",bold:s>1}]),o.push(t)}return o}function u(e){if("c/h20"===e.tipo){let t=0;const o=e.reporteTaras||[],n=e.reporteBolsas||[];for(let e=0;e<o.length;e++){const a=parseInt(o[e])||0,r=parseInt(n[e])||0;t+=a*r}return t*(e.camaronNeto||.65)}{const t=e.kilos.reduce((e,t)=>e+(Number(t)||0),0),o=e.taras.reduce((e,t)=>e+(Number(t)||0),0),n=(e.tarasExtra||[]).reduce((e,t)=>e+(Number(t)||0),0),a=o+n,r=e.restarTaras?3*a:0;return t-r}}function h(e){return e.split(" ")[0].toLowerCase()}function m(e){return e.sort((e,t)=>{const o=h(e.nombreAlternativoPDF||e.medida),n=h(t.nombreAlternativoPDF||t.medida);if(o!==n)return o.localeCompare(n);if(e.tipo!==t.tipo)return e.tipo.localeCompare(t.tipo);if("c/h20"===e.tipo&&"c/h20"===t.tipo){const o=e.camaronNeto||.65,n=t.camaronNeto||.65;return o-n}return 0})}function p(e,t,o){const n=e.filter(e=>{const t=w(e,o);return t>0});if(0===n.length)return{table:{headerRows:1,widths:["100%"],body:[[{text:"No hay productos con kilos registrados",italics:!0,alignment:"center"}]]},layout:{hLineWidth:function(e,t){return 0===e||e===t.table.body.length?2:1},vLineWidth:function(e,t){return 0===e||e===t.table.widths.length?2:1},hLineColor:function(e,o){return 0===e||e===o.table.body.length?v(t):"black"},vLineColor:function(e,o){return 0===e||e===o.table.widths.length?v(t):"black"}}};const a=n.some(e=>e.nota&&""!==e.nota.trim()),r=n.some(e=>e.hilos),i=o.toLowerCase().includes("canelo"),s=i&&n.some(e=>e.precio&&""!==e.precio.toString().trim()),l=[{text:"Kg",style:"tableHeader"},{text:"Producto",style:"tableHeader"},{text:"Taras",style:"tableHeader"}];i&&s&&(l.push({text:"Precio",style:"tableHeader"}),l.push({text:"Total",style:"tableHeader"})),r&&l.push({text:"Hilos",style:"tableHeader"}),a&&l.push({text:"Notas",style:"tableHeader"});const c=[l];let d,u=0;if(n.forEach(e=>{const t=(e.taras||[]).reduce((e,t)=>e+(t||0),0),n=(e.tarasExtra||[]).reduce((e,t)=>e+(t||0),0),l=t+n;let d=`${l} ${k(e.reporteTaras,e.reporteBolsas)}`;const h=w(e,o);if(h>0){const t=[o.toLowerCase().includes("ozuna")?h.toFixed(1)+" kg":Math.round(h)+" kg",i&&s?(e.nombreAlternativoPDF||e.medida||"")+("c/h20"===e.tipo?" c/h2o":"s/h20"===e.tipo?" s/h2o":"otro"===e.tipo?" "+(e.tipoPersonalizado||""):" "+(e.tipo||"")):g(e),d];if(i&&s){t.push(e.precio?{text:"$"+Number(e.precio).toLocaleString("en-US"),style:"precio"}:"");const o=e.precio?h*Number(e.precio):0;u+=o,t.push(e.precio?{text:"$"+Math.round(o).toLocaleString("en-US"),style:"totalPrecio"}:"")}r&&t.push(e.hilos||""),a&&t.push({text:e.nota||"",style:"nota"}),c.push(t)}}),i&&s&&u>0){const e=l.length,t=[{text:"GRAN TOTAL:",bold:!0,alignment:"right",color:"#9b59b6",border:[!0,!0,!0,!0],colSpan:e-1}];for(let o=1;o<e-1;o++)t.push({});t.push({text:"$"+Math.round(u).toLocaleString("en-US"),bold:!0,fontSize:24,color:"#9b59b6",border:[!0,!0,!0,!0],alignment:"center"}),c.push(t)}if(1===c.length)return{table:{headerRows:1,widths:["100%"],body:[[{text:"No hay productos con kilos registrados",italics:!0,alignment:"center"}]]},layout:{hLineWidth:function(e,t){return 0===e||e===t.table.body.length?2:1},vLineWidth:function(e,t){return 0===e||e===t.table.widths.length?2:1},hLineColor:function(e,o){return 0===e||e===o.table.body.length?v(t):"black"},vLineColor:function(e,o){return 0===e||e===o.table.widths.length?v(t):"black"}}};if(i&&s){d=r&&a?["10%","20%","20%","15%","15%","10%","10%"]:r||a?["15%","20%","20%","15%","15%","15%"]:["15%","25%","20%","20%","20%"]}else d=r&&a?["15%","25%","25%","15%","20%"]:r||a?["20%","30%","30%","20%"]:["25%","35%","40%"];return{table:{headerRows:1,widths:d,body:c},layout:{hLineWidth:function(e,t){return 0===e||e===t.table.body.length?2:1},vLineWidth:function(e,t){return 0===e||e===t.table.widths.length?2:1},hLineColor:function(e,o){return 0===e||e===o.table.body.length?v(t):"black"},vLineColor:function(e,o){return 0===e||e===o.table.widths.length?v(t):"black"}}}}function b(e,t){const o=S(t),n=o.toLowerCase().includes("canelo"),a=e.map(e=>{const t=e.items.filter(e=>{const t=F(e,o),n=parseFloat(t);return n>0});return{...e,items:t}}).filter(e=>e.items.length>0);if(0===a.length||a.every(e=>0===e.items.length))return{table:{headerRows:1,widths:["100%"],body:[[{text:"No hay crudos con kilos registrados",italics:!0,alignment:"center"}]]},layout:{hLineWidth:function(e,t){return 0===e||e===t.table.body.length?2:1},vLineWidth:function(e,t){return 0===e||e===t.table.widths.length?2:1},hLineColor:function(e,o){return 0===e||e===o.table.body.length?v(t):"black"},vLineColor:function(e,o){return 0===e||e===o.table.widths.length?v(t):"black"}}};console.log("Generando tabla de crudos:",{estiloCliente:t,nombreCliente:o,esClienteCanelo:n,hayPreciosEnCrudos:a.some(e=>e.items.some(e=>!!e.precio))});const r=a.some(e=>e.items.some(e=>e.precio&&""!==e.precio.toString().trim())),i=[{text:"Cantidad",style:"tableHeader"},{text:"Talla",style:"tableHeader"},{text:"Taras",style:"tableHeader"}];r&&(i.push({text:"Precio",style:"tableHeader"}),n&&i.push({text:"Total",style:"tableHeader"}));const s=[i];let l,c=0;if(a.forEach(e=>e.items.forEach(e=>{const t=F(e,o),a=parseFloat(t);if(a>0){n&&e.precio&&console.log("Item con precio para Canelo:",{talla:e.talla,kilos:a,precio:e.precio,total:a*Number(e.precio)});const t=[Math.round(a)+" kg",{text:e.talla.replace(/\s*c\/\s*c$/i," c/c"),style:"default",noWrap:!0},y(e)];if(r&&(t.push(e.precio?{text:"$"+Number(e.precio).toLocaleString("en-US"),style:"precio"}:""),n||"canelo"===o)){const o=e.precio?a*Number(e.precio):0;c+=o,t.push(e.precio?{text:"$"+Math.round(o).toLocaleString("en-US"),style:"totalPrecio"}:"")}s.push(t)}})),(n||"canelo"===o)&&r&&c>0){const e=i.length,t=[{text:"GRAN TOTAL:",bold:!0,alignment:"right",color:"#9b59b6",border:[!0,!0,!0,!0],colSpan:e-1}];for(let o=1;o<e-1;o++)t.push({});t.push({text:"$"+Math.round(c).toLocaleString("en-US"),bold:!0,fontSize:24,color:"#9b59b6",border:[!0,!0,!0,!0],alignment:"center"}),s.push(t)}return 1===s.length?{table:{headerRows:1,widths:["100%"],body:[[{text:"No hay crudos con kilos registrados",italics:!0,alignment:"center"}]]},layout:{hLineWidth:function(e,t){return 0===e||e===t.table.body.length?2:1},vLineWidth:function(e,t){return 0===e||e===t.table.widths.length?2:1},hLineColor:function(e,o){return 0===e||e===o.table.body.length?v(t):"black"},vLineColor:function(e,o){return 0===e||e===o.table.widths.length?v(t):"black"}}}:(l=r?n?["20%","25%","20%","15%","20%"]:["25%","30%","25%","20%"]:["30%","40%","30%"],{table:{headerRows:1,widths:l,body:s},layout:{hLineWidth:function(e,t){return 0===e||e===t.table.body.length?2:1},vLineWidth:function(e,t){return 0===e||e===t.table.widths.length?2:1},hLineColor:function(e,o){return 0===e||e===o.table.body.length?v(t):"black"},vLineColor:function(e,o){return 0===e||e===o.table.widths.length?v(t):"black"}}})}function f(e){const t=e.toLowerCase();return t.includes("joselito")?"clienteJoselito":t.includes("catarro")?"clienteCatarro":t.includes("otilio")?"clienteOtilio":t.includes("ozuna")?"clienteOzuna":t.includes("canelo")?"clienteCanelo":"clienteOtro"}function g(e){let t=(e.nombreAlternativoPDF||e.medida||"").trim(),o=e.precio?" $"+Number(e.precio).toLocaleString("en-US"):"";if("c/h20"===e.tipo)return[{text:t+" c/h2o",style:"tipoConAgua"},{text:o,style:"precio"}].filter(e=>e.text);if("s/h20"===e.tipo)return[{text:t+" s/h2o",style:"default"},{text:o,style:"precio"}].filter(e=>e.text);let n="otro"===e.tipo?e.tipoPersonalizado:e.tipo,a=n?`${t} ${n}`:t;return[{text:a,style:"default"},{text:o,style:"precio"}].filter(e=>e.text)}function y(e){let t=0;if(e.taras){const[o]=e.taras.split("-").map(Number);t+=o}if(e.sobrante){const[o]=e.sobrante.split("-").map(Number);t+=o}return t}function x(e,t){if(!t||!Array.isArray(t))return console.warn("La lista de clientes disponibles no es válida"),"Cliente Desconocido";const o=t.find(t=>t.id.toString()===e.toString());return o?o.nombre:"Cliente Desconocido"}function C(e){const t=(e.taras||[]).reduce((e,t)=>e+(t||0),0),o=(e.tarasExtra||[]).reduce((e,t)=>e+(t||0),0);return t+o}function w(e,t){const o=(e.kilos||[]).reduce((e,t)=>e+(t||0),0);let n=0;if(e.tarasInfo)n=e.tarasInfo.reduce((e,t)=>e+(t.restarTaras?3*(Number(t.valor)||0):0),0);else{const t=(e.taras||[]).reduce((e,t)=>e+(t||0),0);n=e.restarTaras?3*t:0}let a=o-n;return e.noSumarKilos||!e.tipo.toLowerCase().includes("s/h2o")&&!e.tipo.toLowerCase().includes("s/h20")||t.toLowerCase().includes("catarro")&&(a+=1),t.toLowerCase().includes("canelo")?Math.round(a):(t.toLowerCase().includes("ozuna"),Number(a.toFixed(1)))}function F(e,t){let o=0;if(e.taras){const[n,a]=e.taras.split("-").map(Number),r=t&&t.toLowerCase().includes("canelo")?20:20.5;o+=n*r}if(e.sobrante){const[,t]=e.sobrante.split("-").map(Number);o+=t}return t&&t.toLowerCase().includes("canelo")?Math.round(o).toString():o.toFixed(1)}function k(e,t){const o={};return e.forEach((e,n)=>{const a=t[n]||"";o[a]||(o[a]=0),o[a]+=parseInt(e||1)}),Object.entries(o).map(([e,t])=>`(${t}-${e})`).join(" ")}function v(e){const t={clienteJoselito:"#0000FF",clienteCatarro:"#FF0000",clienteOtilio:"#FFD700",clienteOzuna:"#008000",clienteCanelo:"#9b59b6",clienteOtro:"#808080"};return t[e]||"#000000"}function L(e){return new Promise((t,o)=>{const n=new Image;n.crossOrigin="Anonymous",n.onload=function(){const e=document.createElement("canvas");e.width=n.width,e.height=n.height;const o=e.getContext("2d");o.drawImage(n,0,0);const a=e.toDataURL("image/png");t(a)},n.onerror=o,n.src=e})}function S(e){switch(e){case"clienteJoselito":return"joselito";case"clienteCatarro":return"catarro";case"clienteOtilio":return"otilio";case"clienteOzuna":return"ozuna";case"clienteCanelo":return"canelo";default:return"otro"}}function T(e,t,o){const n=[];let a=0,r=0;const i=e.productos.reduce((e,t)=>(e[t.clienteId]||(e[t.clienteId]=[]),e[t.clienteId].push(t),e),{});return Object.entries(i).forEach(([i,s])=>{const l=x(i,t),c=f(l),d=o&&o[i],u=s.filter(e=>{const t=w(e,l);return t>0});if(n.push({text:"Cliente: "+l,style:["subheader",c],margin:[0,5,0,5]}),u.length>0){let e=u;if(d){const t={};u.forEach(e=>{const o=e.nombreAlternativoPDF||e.medida,n=e.tipo||"",a=e.camaronNeto||.65,r="c/h20"===n?`${o}-${n}-${a}`:`${o}-${n}`;t[r]?(t[r].kilos.push(...e.kilos),t[r].taras.push(...e.taras),e.tarasExtra&&t[r].tarasExtra.push(...e.tarasExtra),e.reporteTaras&&t[r].reporteTaras.push(...e.reporteTaras),e.reporteBolsas&&t[r].reporteBolsas.push(...e.reporteBolsas),t[r].tarasInfo.push(...e.taras.map(t=>({valor:t,restarTaras:e.restarTaras}))),t[r].taras=t[r].tarasInfo.map(e=>e.valor)):t[r]={...e,medida:o,kilos:[...e.kilos],taras:[...e.taras],tarasExtra:[...e.tarasExtra||[]],reporteTaras:[...e.reporteTaras||[]],reporteBolsas:[...e.reporteBolsas||[]],tarasInfo:e.taras.map(t=>({valor:t,restarTaras:e.restarTaras}))}}),e=Object.values(t)}const t=m(e),o=t.some(e=>{const t=w(e,l);return t>0});if(o){n.push({text:"Limpio:",style:["subheader",c],margin:[0,5,0,5]},N(t,c,l),{text:"\n"});const e=s.reduce((e,t)=>e+C(t),0);e>0&&(a+=e,n.push({text:"Taras de limpio: "+e,margin:[0,5,0,5]},{text:"\n"}))}}if(e.clienteCrudos&&e.clienteCrudos[i]){const t=e.clienteCrudos[i].some(e=>e.items.some(e=>{const t=F(e,l),o=parseFloat(t);return o>0}));if(t){n.push({text:"Crudos:",style:["subheader",c],margin:[0,5,0,5]},E(e.clienteCrudos[i],c),{text:"\n"});const t=e.clienteCrudos[i].reduce((e,t)=>e+t.items.reduce((e,t)=>e+y(t),0),0);t>0&&(r+=t,n.push({text:"Taras de crudo: "+t,margin:[0,5,0,5]},{text:"\n"}))}}const h=u.length>0,p=e.clienteCrudos&&e.clienteCrudos[i]&&e.clienteCrudos[i].some(e=>e.items.some(e=>{const t=F(e,l),o=parseFloat(t);return o>0}));h||p||n.push({text:"No hay medidas registradas para este cliente",italics:!0,margin:[0,5,0,10]},{text:"\n"})}),a+r>0&&n.push({text:"Total general de taras: "+(a+r),style:"subheader",margin:[0,5,0,5]}),n}function N(e,t,o){const n=e.filter(e=>{const t=w(e,o);return t>0});if(0===n.length)return{table:{headerRows:1,widths:["100%"],body:[[{text:"No hay productos con kilos registrados",italics:!0,alignment:"center"}]]},layout:{hLineWidth:function(e,t){return 0===e||e===t.table.body.length?2:1},vLineWidth:function(e,t){return 0===e||e===t.table.widths.length?2:1},hLineColor:function(e,o){return 0===e||e===o.table.body.length?v(t):"black"},vLineColor:function(e,o){return 0===e||e===o.table.widths.length?v(t):"black"}}};const a=n.some(e=>e.nota&&""!==e.nota.trim()),r=n.some(e=>e.hilos),i=[{text:"Kg",style:"tableHeader"},{text:"Producto",style:"tableHeader"},{text:"Taras",style:"tableHeader"}];r&&i.push({text:"Hilos",style:"tableHeader"}),a&&i.push({text:"Notas",style:"tableHeader"});const s=[i];if(n.forEach(e=>{const t=(e.taras||[]).reduce((e,t)=>e+(t||0),0),n=(e.tarasExtra||[]).reduce((e,t)=>e+(t||0),0),i=t+n;let l=`${i} ${k(e.reporteTaras,e.reporteBolsas)}`;const c=w(e,o);if(c>0){const t=[Math.round(c)+" kg",z(e),l];r&&t.push(e.hilos||""),a&&t.push({text:e.nota||"",style:"nota"}),s.push(t)}}),1===s.length)return{table:{headerRows:1,widths:["100%"],body:[[{text:"No hay productos con kilos registrados",italics:!0,alignment:"center"}]]},layout:{hLineWidth:function(e,t){return 0===e||e===t.table.body.length?2:1},vLineWidth:function(e,t){return 0===e||e===t.table.widths.length?2:1},hLineColor:function(e,o){return 0===e||e===o.table.body.length?v(t):"black"},vLineColor:function(e,o){return 0===e||e===o.table.widths.length?v(t):"black"}}};let l;return l=r&&a?["20%","30%","25%","10%","15%"]:r||a?["25%","35%","25%","15%"]:["25%","45%","30%"],{table:{headerRows:1,widths:l,body:s},layout:{hLineWidth:function(e,t){return 0===e||e===t.table.body.length?2:1},vLineWidth:function(e,t){return 0===e||e===t.table.widths.length?2:1},hLineColor:function(e,o){return 0===e||e===o.table.body.length?v(t):"black"},vLineColor:function(e,o){return 0===e||e===o.table.widths.length?v(t):"black"}}}}function E(e,t){const o=S(t),n=e.map(e=>{const t=e.items.filter(e=>{const t=F(e,o),n=parseFloat(t);return n>0});return{...e,items:t}}).filter(e=>e.items.length>0);if(0===n.length||n.every(e=>0===e.items.length))return{table:{headerRows:1,widths:["100%"],body:[[{text:"No hay crudos con kilos registrados",italics:!0,alignment:"center"}]]},layout:{hLineWidth:function(e,t){return 0===e||e===t.table.body.length?2:1},vLineWidth:function(e,t){return 0===e||e===t.table.widths.length?2:1},hLineColor:function(e,o){return 0===e||e===o.table.body.length?v(t):"black"},vLineColor:function(e,o){return 0===e||e===o.table.widths.length?v(t):"black"}}};const a=[{text:"Cantidad",style:"tableHeader"},{text:"Talla",style:"tableHeader"},{text:"Taras",style:"tableHeader"}],r=[a];if(n.forEach(e=>e.items.forEach(e=>{const t=F(e,o),n=parseFloat(t);if(n>0){const t=[Math.round(n)+" kg",{text:e.talla.replace(/\s*c\/\s*c$/i," c/c"),style:"default",noWrap:!0},y(e)];r.push(t)}})),1===r.length)return{table:{headerRows:1,widths:["100%"],body:[[{text:"No hay crudos con kilos registrados",italics:!0,alignment:"center"}]]},layout:{hLineWidth:function(e,t){return 0===e||e===t.table.body.length?2:1},vLineWidth:function(e,t){return 0===e||e===t.table.widths.length?2:1},hLineColor:function(e,o){return 0===e||e===o.table.body.length?v(t):"black"},vLineColor:function(e,o){return 0===e||e===o.table.widths.length?v(t):"black"}}};const i=["30%","40%","30%"];return{table:{headerRows:1,widths:i,body:r},layout:{hLineWidth:function(e,t){return 0===e||e===t.table.body.length?2:1},vLineWidth:function(e,t){return 0===e||e===t.table.widths.length?2:1},hLineColor:function(e,o){return 0===e||e===o.table.body.length?v(t):"black"},vLineColor:function(e,o){return 0===e||e===o.table.widths.length?v(t):"black"}}}}function z(e){let t=(e.nombreAlternativoPDF||e.medida||"").trim();if("c/h20"===e.tipo)return{text:t+" c/h2o",style:"tipoConAgua"};if("s/h20"===e.tipo)return{text:t+" s/h2o",style:"default"};let o="otro"===e.tipo?e.tipoPersonalizado:e.tipo,n=o?`${t} ${o}`:t;return{text:n,style:"default"}}"undefined"!==typeof window&&window.pdfMake&&(console.log("Usando pdfMake global (CDN)"),pdfMake=window.pdfMake)},"41cb":function(e,t,o){"use strict";var n=o("2b0e"),a=o("8c4f"),r=(o("f549"),o("bb51")),i=o("f411"),s=o("98cf"),l=o("4e00"),c=o("32e5"),d=o("9302"),u=o("1155"),h=o("2cc6"),m=o("4c52"),p=o("4c57"),b=o("505e"),f=o("f515"),g=o("fcb3"),y=o("24d5"),x=o("4786f"),C=o("28ce"),w=o("74a9"),F=o("320e"),k=o("0ae9"),v=o("c8b7"),L=o("b34e"),S=o("f458"),T=o("4dc0"),N=o("9aeb"),E=o("a55b"),z=o("9f85"),P=o("85fe"),M=o("05af"),H=o("c5f5"),I=o("f125"),O=(o("0042"),o("cc985")),A=o("3420"),$=o("d918"),j=o("92c9"),R=o("e524");n["default"].use(a["a"]);const W=[{path:"/login",name:"Login",component:E["a"]},{path:"/noteMenu",name:"NoteMenu",component:i["a"]},{path:"/",name:"home",component:r["a"]},{path:"/sale-note/:noteId?",name:"SaleNote",component:()=>Promise.resolve().then(o.bind(null,"98cf"))},{path:"/add-client",name:"AddClient",component:l["a"]},{path:"/editar-nota/:noteId",name:"editar-nota",component:s["default"],props:!0},{path:"/sacadas",name:"SacadasMenu",component:d["a"]},{path:"/sacadas/new",name:"NuevaSacada",component:c["a"]},{path:"/sacadas/:id",name:"DetalleSacada",component:c["a"],props:!0},{path:"/gestionar-productos",name:"GestionarProductos",component:u["a"]},{path:"/gestionar-medidas",name:"GestionarMedidas",component:h["a"]},{path:"/gestionar-proveedores",name:"GestionarProveedores",component:m["a"]},{path:"/existencias",name:"Existencias",component:p["a"]},{path:"/cuentas-mexico",name:"CuentasMexico",component:b["a"]},{path:"/cuentas-ozuna",name:"ozuna-cuentas-menu",component:f["a"]},{path:"/cuentas-ozuna/nueva",name:"nueva-cuenta-ozuna",component:g["a"]},{path:"/cuentas-ozuna/:id",name:"ver-cuenta-ozuna",component:g["a"]},{path:"/cuentas-ozuna/:id?",name:"CuentasOzuna",component:g["a"]},{path:"/cuentas-catarro",name:"catarro-cuentas-menu",component:y["a"]},{path:"/cuentas-catarro/nueva",name:"nueva-cuenta-catarro",component:x["a"]},{path:"/cuentas-catarro/:id",name:"ver-cuenta-catarro",component:x["a"]},{path:"/cuentas-catarro/:id?",name:"CuentasCatarro",component:x["a"]},{path:"/cuentas-joselito",name:"joselito-cuentas-menu",component:C["a"]},{path:"/cuentas-joselito/nueva",name:"nueva-cuenta-joselito",component:w["a"]},{path:"/cuentas-joselito/:id",name:"ver-cuenta-joselito",component:w["a"]},{path:"/cuentas-joselito/:id?",name:"CuentasJoselito",component:w["a"]},{path:"/embarques-menu",name:"EmbarquesMenu",component:F["a"]},{path:"/ventas-ganancias-catarro",name:"VentasYGananciasCatarro",component:k["a"]},{path:"/ventas-ganancias-joselito",name:"VentasYGananciasJoselito",component:v["a"]},{path:"/embarques",name:"ListaEmbarques",component:L["a"]},{path:"/embarques/:id",name:"EditarEmbarque",component:S["a"]},{path:"/nuevo-embarque",name:"NuevoEmbarque",component:S["a"]},{path:"/embarques/:id/rendimientos",name:"Rendimientos",component:T["default"],props:!0},{path:"/cuenta-fletes",name:"CuentaFletes",component:N["a"]},{path:"/cuentas-otilio",name:"otilio-cuentas-menu",component:z["a"]},{path:"/cuentas-otilio/nueva",name:"nueva-cuenta-otilio",component:P["a"]},{path:"/cuentas-otilio/:id",name:"ver-cuenta-otilio",component:P["a"]},{path:"/cuentas-otilio/:id?",name:"CuentasOtilio",component:P["a"]},{path:"/procesos",name:"ProcesosMenu",component:M["a"]},{path:"/procesos/preparacion",name:"Preparacion",component:H["a"]},{path:"/procesos/pedidos",name:"PedidosMenu",component:I["a"]},{path:"/procesos/pedidos/nuevo",name:"NuevoPedido",component:$["a"]},{path:"/procesos/pedidos/crudo",name:"PedidosCrudo",component:O["a"]},{path:"/procesos/pedidos/limpio",name:"PedidosLimpio",component:$["a"]},{path:"/procesos/pedidos-crudos-impresion",name:"PedidoCrudosImpresion",component:A["a"],props:!0},{path:"/procesos/pedidos-limpio-impresion",name:"PedidoLimpioImpresion",component:j["a"],props:!0},{path:"/procesos/bitacoras",name:"Bitacoras",component:R["a"]}],D=new a["a"]({mode:"history",base:"/",routes:W});D.beforeEach((e,t,o)=>{const n=localStorage.getItem("user"),a=!!n;"/login"===e.path&&a?o("/"):"/login"===e.path||a?o():o("/login")}),t["a"]=D},"6d4d":function(e,t,o){"use strict";o.d(t,"a",(function(){return s}));o("14d9"),o("13d5");var n=o("e499"),a=o.n(n),r=o("4ebb"),i=o.n(r);"object"===typeof i.a&&(i.a.pdfMake&&i.a.pdfMake.vfs?a.a.vfs=i.a.pdfMake.vfs:i.a.vfs?a.a.vfs=i.a.vfs:a.a.vfs=i.a),"undefined"===typeof window||window.pdfMake||(window.pdfMake=a.a);const s=async(e,t)=>{try{const o=await u("https://res.cloudinary.com/hwkcovsmr/image/upload/v1620946647/samples/REY_PEZ_LOGO_nsotww.png"),n=(null===t||void 0===t?void 0:t.nombresMedidasPersonalizados)||{},r=e=>{if(!e)return"Sin fecha";let t;if(e&&"function"===typeof e.toDate?t=e.toDate():"string"===typeof e?t=new Date(e):e instanceof Date&&(t=e),isNaN(t.getTime()))return"Fecha inválida";const o=new Date(t.getTime()+6e4*t.getTimezoneOffset());return o.toLocaleDateString("es-MX",{year:"numeric",month:"2-digit",day:"2-digit",timeZone:"America/Mexico_City"})},i={content:[{columns:[{image:o,width:80,alignment:"left",margin:[0,0,0,5]},{text:"Reporte de Rendimientos",style:"header",alignment:"center",margin:[0,10,0,0]},{stack:[{text:"Fecha: "+r(t.fecha),alignment:"right",margin:[0,10,0,0]}]}]},{text:"\n",height:5},l(e,n,t)],styles:{header:{fontSize:24,bold:!0,color:"#3760b0",margin:[0,0,0,5]},tableHeader:{bold:!0,fontSize:20,color:"white",fillColor:"#3760b0"},rendimientoAlto:{color:"#27ae60",bold:!0},rendimientoBajo:{color:"#000000"},costoStyle:{color:"#e74c3c",bold:!0}},defaultStyle:{fontSize:18},footer:function(e,t){return{columns:[{text:"© 2024 Rey Pez - Tampico, Tamps.",alignment:"center",margin:[0,5,0,0],fontSize:8,color:"#3760b0"}]}}};t.notaRendimientos&&(i.content.push({text:"\n",height:5}),i.content.push({text:"Nota:",style:"header",color:"red",alignment:"center",margin:[0,10,0,0]}),i.content.push({text:" "+t.notaRendimientos,style:"header",alignment:"center",color:"black",margin:[0,10,0,0]})),a.a.createPdf(i).open()}catch(o){console.error("Error al generar el PDF de rendimientos:",o)}};function l(e,t,o){const n=e.reduce((e,o)=>{const n=t[o.medida]||o.medida;return n.includes("mixta")||n.includes("Mixta")?(e["Mixta"]||(e["Mixta"]={medida:"Mixta",kilosCrudos:0,totalEmbarcado:0,costoFinal:o.costoFinal}),o.kilosCrudos&&("object"===typeof o.kilosCrudos?e["Mixta"].kilosCrudos+=(parseFloat(o.kilosCrudos.medida1)||0)+(parseFloat(o.kilosCrudos.medida2)||0):e["Mixta"].kilosCrudos+=parseFloat(o.kilosCrudos)||0),e["Mixta"].totalEmbarcado+=parseFloat(o.totalEmbarcado)||0):e[n]={medida:n,kilosCrudos:parseFloat(o.kilosCrudos)||0,totalEmbarcado:parseFloat(o.totalEmbarcado)||0,costoFinal:o.costoFinal},e},{}),a=Object.values(n).some(e=>e.costoFinal&&"0"!==e.costoFinal&&0!==e.costoFinal),r=o.mostrarColumnaCosto&&a,i=[[{text:"Kilos en Crudo",style:"tableHeader"},{text:"Medida",style:"tableHeader"},{text:"Rendimiento",style:"tableHeader"},...r?[{text:"Costo Final",style:"tableHeader"}]:[]],...Object.values(n).map(e=>{const t=e.totalEmbarcado>0?e.kilosCrudos/e.totalEmbarcado:0,o=t>1?"rendimientoAlto":"rendimientoBajo";let n=e.medida;if(e.medidasIncluidas){const t=Array.from(e.medidasIncluidas);n=`Mixta (${t.join(", ")})`}return[c(e.kilosCrudos),n,{text:`(${d(t)})`,style:o},...r?[{text:e.costoFinal?"$"+Number(e.costoFinal).toFixed(1):"",style:"costoStyle"}]:[]]})];return{table:{headerRows:1,widths:r?["*","*","*","*"]:["*","*","*"],body:i},layout:{hLineWidth:function(e,t){return 0===e||e===t.table.body.length?1.5:.5},vLineWidth:function(e,t){return 0===e||e===t.table.widths.length?1.5:.5},hLineColor:function(e,t){return 0===e||e===t.table.body.length?"#3760b0":"#cccccc"},vLineColor:function(e,t){return 0===e||e===t.table.widths.length?"#3760b0":"#cccccc"},fillColor:function(e,t,o){return e%2===0?"#f8f9fa":null},paddingLeft:function(e){return 4},paddingRight:function(e){return 4},paddingTop:function(e){return 2},paddingBottom:function(e){return 2}}}}function c(e){if("number"===typeof e)return(e%1===0?Math.floor(e):e.toFixed(1))+" kg";if("object"===typeof e&&null!==e){const t=(Number(e.medida1)||0)+(Number(e.medida2)||0);return(t%1===0?Math.floor(t):t.toFixed(1))+" kg"}const t=Number(e);return(t%1===0?Math.floor(t):t.toFixed(1))+" kg"}function d(e){return Number(e).toFixed(2)}function u(e){return new Promise((t,o)=>{const n=new Image;n.crossOrigin="Anonymous",n.onload=function(){const e=document.createElement("canvas");e.width=n.width,e.height=n.height;const o=e.getContext("2d");o.drawImage(n,0,0);const a=e.toDataURL("image/png");t(a)},n.onerror=o,n.src=e})}},f549:function(e,t,o){"use strict";o.d(t,"a",(function(){return s}));var n=o("be92"),a=o("dc59"),r=o("e1bd");const i=[{username:"allan",password:"noseno"},{username:"edgar",password:"noseno"}],s=Object(n["c"])("auth",{state:()=>({user:null,isAuthenticated:!1,userId:null}),actions:{async login(e,t){try{const o=i.find(o=>o.username===e&&o.password===t);if(o){const e=Object(r["a"])();return this.userId=e,this.user={username:o.username},this.isAuthenticated=!0,Object(a["b"])(e,o.username),localStorage.setItem("user",JSON.stringify({...this.user,userId:e})),!0}return!1}catch(o){return console.error("Error en login:",o),!1}},logout(){this.user=null,this.isAuthenticated=!1,this.userId=null,localStorage.removeItem("user")},checkAuth(){try{const e=localStorage.getItem("user");if(e){const t=JSON.parse(e);this.user={username:t.username},this.userId=t.userId,this.isAuthenticated=!0,this.userId&&Object(a["b"])(this.userId,t.username)}}catch(e){console.error("Error al verificar autenticación:",e),this.logout()}}},getters:{isLoggedIn:e=>e.isAuthenticated,currentUser:e=>e.user}})},fa1c:function(e,t,o){"use strict";var n=o("c1df"),a=o.n(n);o("898b");a.a.locale("es")}}]);