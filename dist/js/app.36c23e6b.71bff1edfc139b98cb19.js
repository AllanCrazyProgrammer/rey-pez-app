(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["app.36c23e6b"],{"03df":function(e,a,t){},"05e4":function(e,a,t){"use strict";t("959e")},2155:function(e,a,t){},3206:function(e,a,t){"use strict";var o=function(){var e=this,a=e._self._c;return a("div",{staticClass:"nueva-deuda"},[a("div",{staticClass:"back-button-container"},[a("BackButton",{attrs:{to:"/procesos/deudas"}})],1),e._m(0),a("div",{staticClass:"fecha-card"},[e._m(1),a("div",{staticClass:"fecha-container"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.fechaSeleccionada,expression:"fechaSeleccionada"}],staticClass:"modern-input",attrs:{type:"date"},domProps:{value:e.fechaSeleccionada},on:{input:function(a){a.target.composing||(e.fechaSeleccionada=a.target.value)}}}),a("span",{staticClass:"fecha-display"},[e._v(e._s(e.fechaFormateada))])])]),a("div",{staticClass:"proveedor-card"},[e._m(2),a("select",{directives:[{name:"model",rawName:"v-model",value:e.proveedorSeleccionado,expression:"proveedorSeleccionado"}],staticClass:"modern-select",attrs:{required:""},on:{change:function(a){var t=Array.prototype.filter.call(a.target.options,(function(e){return e.selected})).map((function(e){var a="_value"in e?e._value:e.value;return a}));e.proveedorSeleccionado=a.target.multiple?t:t[0]}}},[a("option",{attrs:{value:"",disabled:""}},[e._v("Seleccione un proveedor")]),e._l(e.proveedores,(function(t){return a("option",{key:t.id,domProps:{value:t.id}},[e._v(" "+e._s(t.nombre)+" ")])}))],2),e.proveedorSeleccionado&&e.getNombreProveedor()?a("div",{staticClass:"proveedor-selected-info"},[a("div",{staticClass:"proveedor-color-display"},[a("div",{staticClass:"color-indicator-large",style:{backgroundColor:e.getProveedorColor(e.proveedorSeleccionado)}}),a("div",{staticClass:"proveedor-details"},[a("span",{staticClass:"proveedor-nombre"},[e._v(e._s(e.getNombreProveedor()))]),a("span",{staticClass:"proveedor-label"},[e._v("Proveedor seleccionado")])])])]):e._e()]),e.proveedorSeleccionado?a("div",{staticClass:"productos-card"},[e._m(3),a("ProductoSelector",{attrs:{"proveedor-id":e.proveedorSeleccionado},on:{"agregar-producto":e.addItem}})],1):e._e(),e.items.length>0?a("div",{staticClass:"tabla-container"},[e._m(4),a("div",{staticClass:"tabla-wrapper"},[a("table",{staticClass:"tabla-productos"},[e._m(5),a("tbody",e._l(e.items,(function(t,o){return a("tr",{key:o},[a("td",{staticClass:"editable",on:{click:function(a){return e.editarItem(o,"kilos")}}},[t.editando&&"kilos"===t.campoEditando?a("input",{directives:[{name:"model",rawName:"v-model.number",value:t.kilos,expression:"item.kilos",modifiers:{number:!0}}],staticClass:"table-input",attrs:{type:"number"},domProps:{value:t.kilos},on:{blur:[function(a){return e.finalizarEdicion(o)},function(a){return e.$forceUpdate()}],keyup:function(a){return!a.type.indexOf("key")&&e._k(a.keyCode,"enter",13,a.key,"Enter")?null:e.finalizarEdicion(o)},input:function(a){a.target.composing||e.$set(t,"kilos",e._n(a.target.value))}}}):a("span",[e._v(e._s(e.formatNumber(t.kilos)))])]),a("td",{staticClass:"editable",on:{click:function(a){return e.editarItem(o,"producto")}}},[t.editando&&"producto"===t.campoEditando?a("input",{directives:[{name:"model",rawName:"v-model",value:t.producto,expression:"item.producto"}],staticClass:"table-input",attrs:{type:"text"},domProps:{value:t.producto},on:{blur:function(a){return e.finalizarEdicion(o)},keyup:function(a){return!a.type.indexOf("key")&&e._k(a.keyCode,"enter",13,a.key,"Enter")?null:e.finalizarEdicion(o)},input:function(a){a.target.composing||e.$set(t,"producto",a.target.value)}}}):a("span",[e._v(e._s(t.producto))])]),a("td",{staticClass:"editable",on:{click:function(a){return e.editarItem(o,"precio")}}},[t.editando&&"precio"===t.campoEditando?a("input",{directives:[{name:"model",rawName:"v-model.number",value:t.precio,expression:"item.precio",modifiers:{number:!0}}],staticClass:"table-input",attrs:{type:"number"},domProps:{value:t.precio},on:{blur:[function(a){return e.finalizarEdicion(o)},function(a){return e.$forceUpdate()}],keyup:function(a){return!a.type.indexOf("key")&&e._k(a.keyCode,"enter",13,a.key,"Enter")?null:e.finalizarEdicion(o)},input:function(a){a.target.composing||e.$set(t,"precio",e._n(a.target.value))}}}):a("span",[e._v("$"+e._s(e.formatNumber(t.precio)))])]),a("td",{staticClass:"total-cell"},[e._v("$"+e._s(e.formatNumber(t.total)))]),a("td",{staticClass:"action-column"},[a("button",{staticClass:"btn-delete",on:{click:function(a){return e.removeItem(o)}}},[a("i",{staticClass:"icon-trash"},[e._v("ðŸ—‘ï¸")])])])])})),0),a("tfoot",[a("tr",{staticClass:"total-row"},[a("td",{staticClass:"total-label",attrs:{colspan:"3"}},[e._v("Total General")]),a("td",{staticClass:"total-amount"},[e._v("$"+e._s(e.formatNumber(e.totalGeneral)))]),a("td")])])])])]):e._e(),e.items.length>0?a("div",{staticClass:"abonos-section"},[a("h2",[e._v("Abonos Iniciales")]),a("div",{staticClass:"abonos"},[e._l(e.abonos,(function(t,o){return a("div",{key:o,staticClass:"input-row"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.descripcion,expression:"abono.descripcion"}],attrs:{type:"text",placeholder:"DescripciÃ³n"},domProps:{value:t.descripcion},on:{input:function(a){a.target.composing||e.$set(t,"descripcion",a.target.value)}}}),a("input",{directives:[{name:"model",rawName:"v-model.number",value:t.monto,expression:"abono.monto",modifiers:{number:!0}}],attrs:{type:"number",placeholder:"Monto"},domProps:{value:t.monto},on:{input:function(a){a.target.composing||e.$set(t,"monto",e._n(a.target.value))},blur:function(a){return e.$forceUpdate()}}}),a("button",{staticClass:"delete-btn",on:{click:function(a){return e.removeAbono(o)}}},[e._v("Eliminar")])])})),a("button",{staticClass:"add-btn",on:{click:e.addAbono}},[e._v("Agregar Abono")])],2),a("div",{staticClass:"resumen"},[a("h3",[e._v("Resumen")]),a("div",{staticClass:"resumen-item"},[a("span",[e._v("Total deuda:")]),a("span",[e._v("$"+e._s(e.formatNumber(e.totalGeneral)))])]),a("div",{staticClass:"resumen-item"},[a("span",[e._v("Total abonos:")]),a("span",[e._v("$"+e._s(e.formatNumber(e.totalAbonos)))])]),a("div",{staticClass:"resumen-item total"},[a("span",[e._v("Saldo pendiente:")]),a("span",[e._v("$"+e._s(e.formatNumber(e.saldoPendiente)))])])])]):e._e(),e.proveedorSeleccionado&&e.items.length>0?a("div",{staticClass:"button-container"},[a("button",{staticClass:"save-button",attrs:{disabled:e.guardando},on:{click:e.guardarDeuda}},[e._v(" "+e._s(e.guardando?"Guardando...":"Guardar Deuda")+" ")])]):e._e()])},r=[function(){var e=this,a=e._self._c;return a("div",{staticClass:"header-section"},[a("div",{staticClass:"header-content"},[a("h1",{staticClass:"main-title"},[a("i",{staticClass:"icon-new"},[e._v("âž•")]),e._v(" Nueva Deuda a Proveedor ")]),a("p",{staticClass:"subtitle"},[e._v("Registra una nueva deuda con productos y abonos iniciales")])])])},function(){var e=this,a=e._self._c;return a("h3",{staticClass:"section-title"},[a("i",{staticClass:"icon-calendar"},[e._v("ðŸ“…")]),e._v(" Fecha de la Deuda ")])},function(){var e=this,a=e._self._c;return a("h3",{staticClass:"section-title"},[a("i",{staticClass:"icon-supplier"},[e._v("ðŸ­")]),e._v(" Seleccionar Proveedor ")])},function(){var e=this,a=e._self._c;return a("h3",{staticClass:"section-title"},[a("i",{staticClass:"icon-products"},[e._v("ðŸ“¦")]),e._v(" Ingresar Productos ")])},function(){var e=this,a=e._self._c;return a("h3",{staticClass:"section-title"},[a("i",{staticClass:"icon-list"},[e._v("ðŸ“‹")]),e._v(" Productos Agregados ")])},function(){var e=this,a=e._self._c;return a("thead",[a("tr",[a("th",[e._v("Kilos")]),a("th",[e._v("Producto")]),a("th",[e._v("Precio")]),a("th",[e._v("Total")]),a("th",[e._v("Acciones")])])])}],i=(t("14d9"),t("13d5"),t("dc59")),s=t("1494"),n=t("74c9"),d=t("687e"),c={name:"NuevaDeuda",components:{BackButton:n["a"],ProductoSelector:d["a"]},data(){return{proveedores:[],proveedorSeleccionado:"",fechaSeleccionada:this.obtenerFechaActual(),items:[],abonos:[],guardando:!1}},computed:{fechaFormateada(){const e=new Date(this.fechaSeleccionada+"T00:00:00"),a={year:"numeric",month:"long",day:"numeric"};return e.toLocaleDateString("es-ES",a)},totalGeneral(){return this.items.reduce((e,a)=>e+a.total,0)},totalAbonos(){return this.abonos.reduce((e,a)=>e+(a.monto||0),0)},saldoPendiente(){return this.totalGeneral-this.totalAbonos}},methods:{obtenerFechaActual(){const e=new Date,a=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${a}-${t}-${o}`},async loadProveedores(){try{const e=await Object(s["g"])(Object(s["c"])(i["a"],"proveedoresDeuda"));this.proveedores=e.docs.map(e=>({id:e.id,...e.data()}))}catch(e){console.error("Error al cargar proveedores: ",e)}},getNombreProveedor(){const e=this.proveedores.find(e=>e.id===this.proveedorSeleccionado);return e?e.nombre:""},getProveedorColor(e){const a=this.proveedores.find(a=>a.id===e);return a&&a.color?a.color:"#cccccc"},formatNumber(e){return e?e.toLocaleString("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00"},addItem(e){this.items.push({kilos:e.kilos,producto:e.producto,precio:e.precio,total:e.total,editando:!1,campoEditando:null})},removeItem(e){this.items.splice(e,1)},editarItem(e,a){this.items=this.items.map((t,o)=>o===e?{...t,editando:!0,campoEditando:a}:{...t,editando:!1,campoEditando:null})},finalizarEdicion(e){const a=this.items[e];a.total=a.kilos*a.precio,a.editando=!1,a.campoEditando=null},addAbono(){this.abonos.push({descripcion:"",monto:null,fecha:this.fechaSeleccionada})},removeAbono(e){this.abonos.splice(e,1)},async guardarDeuda(){if(this.proveedorSeleccionado)if(0!==this.items.length)try{this.guardando=!0;const e=await Object(s["b"])(Object(s["c"])(i["a"],"deudas"),{proveedorId:this.proveedorSeleccionado,proveedorNombre:this.getNombreProveedor(),fecha:this.fechaSeleccionada,fechaCreacion:new Date,total:this.totalGeneral,saldoPendiente:this.saldoPendiente,estado:this.saldoPendiente>0?"pendiente":"pagado"}),a=Object(s["c"])(i["a"],"deudas",e.id,"productos");for(const t of this.items)await Object(s["b"])(a,{kilos:t.kilos,producto:t.producto,precio:t.precio,total:t.total});if(this.abonos.length>0){const a=Object(s["c"])(i["a"],"deudas",e.id,"abonos");for(const e of this.abonos)e.descripcion&&e.monto&&await Object(s["b"])(a,{descripcion:e.descripcion,monto:e.monto,fecha:this.fechaSeleccionada,fechaCreacion:new Date})}alert("Deuda guardada correctamente"),this.$router.push("/procesos/deudas/lista")}catch(e){console.error("Error al guardar la deuda: ",e),alert("Error al guardar la deuda: "+e.message)}finally{this.guardando=!1}else alert("Por favor agregue al menos un producto");else alert("Por favor seleccione un proveedor")}},mounted(){this.loadProveedores()}},l=c,u=(t("f740"),t("2877")),v=Object(u["a"])(l,o,r,!1,null,"8a78827c",null);a["a"]=v.exports},"6f4f":function(e,a,t){},8610:function(e,a,t){"use strict";var o=function(){var e=this,a=e._self._c;return a("div",{staticClass:"deudas-menu"},[a("div",{staticClass:"back-button-container"},[a("BackButton",{attrs:{to:"/procesos"}})],1),e._m(0),a("div",{staticClass:"menu-options"},[a("router-link",{staticClass:"btn-action btn-lista",attrs:{to:"/procesos/deudas/lista","aria-label":"Ver lista de deudas"}},[a("i",{staticClass:"icon"},[e._v("ðŸ“‹")]),a("span",[e._v("Lista de Deudas")])]),a("router-link",{staticClass:"btn-action btn-nueva",attrs:{to:"/procesos/deudas/nueva","aria-label":"Crear nueva deuda"}},[a("i",{staticClass:"icon"},[e._v("âž•")]),a("span",[e._v("Nueva Deuda")])]),a("button",{staticClass:"btn-action btn-config",attrs:{"aria-label":"Configurar proveedores"},on:{click:e.openProveedoresModal}},[a("i",{staticClass:"icon"},[e._v("âš™ï¸")]),a("span",[e._v("Configurar Proveedores")])])],1),e.showModal?a("div",{staticClass:"modal-overlay",on:{click:e.closeModalOnOverlay}},[a("div",{staticClass:"modal-content modern-modal",on:{click:function(e){e.stopPropagation()}}},[a("div",{staticClass:"modal-header modern-header"},[e._m(1),e._m(2),a("button",{staticClass:"close-button modern-close",on:{click:function(a){e.showModal=!1}}},[a("i",{staticClass:"fas fa-times"},[e._v("âœ•")])])]),a("div",{staticClass:"modal-body modern-body"},[a("div",{staticClass:"add-proveedor-section"},[e._m(3),a("form",{staticClass:"modern-form",on:{submit:function(a){return a.preventDefault(),e.addProveedor.apply(null,arguments)}}},[a("div",{staticClass:"form-grid"},[a("div",{staticClass:"form-group modern-group"},[e._m(4),a("input",{directives:[{name:"model",rawName:"v-model",value:e.newProveedor.nombre,expression:"newProveedor.nombre"}],staticClass:"modern-input",attrs:{id:"nombre",required:"",placeholder:"Ingrese el nombre del proveedor"},domProps:{value:e.newProveedor.nombre},on:{input:function(a){a.target.composing||e.$set(e.newProveedor,"nombre",a.target.value)}}})]),a("div",{staticClass:"form-group modern-group"},[e._m(5),a("input",{directives:[{name:"model",rawName:"v-model",value:e.newProveedor.telefono,expression:"newProveedor.telefono"}],staticClass:"modern-input",attrs:{id:"telefono",placeholder:"Ingrese el telÃ©fono"},domProps:{value:e.newProveedor.telefono},on:{input:function(a){a.target.composing||e.$set(e.newProveedor,"telefono",a.target.value)}}})])]),a("div",{staticClass:"color-selection"},[e._m(6),a("div",{staticClass:"color-options"},e._l(e.coloresDisponibles,(function(t){return a("div",{key:t.value,staticClass:"color-option",class:{selected:e.newProveedor.color===t.value},on:{click:function(a){e.newProveedor.color=t.value}}},[a("div",{staticClass:"color-circle",style:{backgroundColor:t.value}}),a("span",{staticClass:"color-name"},[e._v(e._s(t.name))])])})),0),a("p",{staticClass:"color-help"},[e._v("Selecciona un color para identificar fÃ¡cilmente este proveedor en las listas")])]),a("button",{staticClass:"submit-btn modern-submit",attrs:{type:"submit",disabled:!e.newProveedor.nombre||!e.newProveedor.color}},[a("i",{staticClass:"btn-icon"},[e._v("ðŸ’¾")]),a("span",[e._v("Agregar Proveedor")])])])]),a("div",{staticClass:"separator"}),a("div",{staticClass:"proveedores-list-section"},[a("div",{staticClass:"section-header"},[a("i",{staticClass:"section-icon"},[e._v("ðŸ“‹")]),a("h3",[e._v("Proveedores Registrados")]),a("span",{staticClass:"count-badge"},[e._v(e._s(e.proveedores.length))])]),0===e.proveedores.length?a("div",{staticClass:"empty-state"},[a("i",{staticClass:"empty-icon"},[e._v("ðŸ“­")]),a("p",[e._v("No hay proveedores registrados")]),a("span",[e._v("Agrega tu primer proveedor usando el formulario de arriba")])]):a("div",{staticClass:"proveedores-grid"},e._l(e.sortedProveedores,(function(t){return a("div",{key:t.id,staticClass:"proveedor-card"},[a("div",{staticClass:"proveedor-header"},[a("div",{staticClass:"proveedor-color"},[a("div",{staticClass:"color-indicator",style:{backgroundColor:t.color||"#cccccc"}})]),a("div",{staticClass:"proveedor-actions"},[a("button",{staticClass:"edit-btn",attrs:{title:"Editar proveedor"},on:{click:function(a){return e.editarProveedor(t)}}},[a("i",{staticClass:"fas fa-edit"},[e._v("âœï¸")])]),a("button",{staticClass:"delete-btn modern-delete",attrs:{title:"Eliminar proveedor"},on:{click:function(a){return e.deleteProveedor(t.id)}}},[a("i",{staticClass:"fas fa-trash"},[e._v("ðŸ—‘ï¸")])])])]),a("div",{staticClass:"proveedor-content"},[a("h4",{staticClass:"proveedor-nombre"},[e._v(e._s(t.nombre))]),t.telefono?a("p",{staticClass:"proveedor-telefono"},[a("i",{staticClass:"phone-icon"},[e._v("ðŸ“ž")]),e._v(" "+e._s(t.telefono)+" ")]):e._e(),a("span",{staticClass:"proveedor-fecha"},[e._v(" Creado: "+e._s(e.formatearFechaCreacion(t.fechaCreacion))+" ")])])])})),0)])])])]):e._e(),e.showEditModal?a("div",{staticClass:"modal-overlay",on:{click:e.closeEditModalOnOverlay}},[a("div",{staticClass:"modal-content modern-modal small-modal",on:{click:function(e){e.stopPropagation()}}},[a("div",{staticClass:"modal-header modern-header"},[e._m(7),e._m(8),a("button",{staticClass:"close-button modern-close",on:{click:function(a){e.showEditModal=!1}}},[a("i",{staticClass:"fas fa-times"},[e._v("âœ•")])])]),a("div",{staticClass:"modal-body modern-body"},[a("form",{staticClass:"modern-form",on:{submit:function(a){return a.preventDefault(),e.updateProveedor.apply(null,arguments)}}},[a("div",{staticClass:"form-group modern-group"},[e._m(9),a("input",{directives:[{name:"model",rawName:"v-model",value:e.editingProveedor.nombre,expression:"editingProveedor.nombre"}],staticClass:"modern-input",attrs:{id:"editNombre",required:"",placeholder:"Ingrese el nombre del proveedor"},domProps:{value:e.editingProveedor.nombre},on:{input:function(a){a.target.composing||e.$set(e.editingProveedor,"nombre",a.target.value)}}})]),a("div",{staticClass:"form-group modern-group"},[e._m(10),a("input",{directives:[{name:"model",rawName:"v-model",value:e.editingProveedor.telefono,expression:"editingProveedor.telefono"}],staticClass:"modern-input",attrs:{id:"editTelefono",placeholder:"Ingrese el telÃ©fono"},domProps:{value:e.editingProveedor.telefono},on:{input:function(a){a.target.composing||e.$set(e.editingProveedor,"telefono",a.target.value)}}})]),a("div",{staticClass:"color-selection"},[e._m(11),a("div",{staticClass:"color-options"},e._l(e.coloresDisponibles,(function(t){return a("div",{key:t.value,staticClass:"color-option",class:{selected:e.editingProveedor.color===t.value},on:{click:function(a){e.editingProveedor.color=t.value}}},[a("div",{staticClass:"color-circle",style:{backgroundColor:t.value}}),a("span",{staticClass:"color-name"},[e._v(e._s(t.name))])])})),0)]),a("div",{staticClass:"form-actions"},[a("button",{staticClass:"cancel-btn",attrs:{type:"button"},on:{click:function(a){e.showEditModal=!1}}},[a("i",{staticClass:"btn-icon"},[e._v("âŒ")]),a("span",[e._v("Cancelar")])]),a("button",{staticClass:"submit-btn modern-submit",attrs:{type:"submit",disabled:!e.editingProveedor.nombre||!e.editingProveedor.color}},[a("i",{staticClass:"btn-icon"},[e._v("ðŸ’¾")]),a("span",[e._v("Guardar Cambios")])])])])])])]):e._e()])},r=[function(){var e=this,a=e._self._c;return a("div",{staticClass:"header-section"},[a("div",{staticClass:"header-content"},[a("h1",{staticClass:"main-title"},[a("i",{staticClass:"icon-debt"},[e._v("ðŸ’°")]),e._v(" GestiÃ³n de Deudas a Proveedores ")]),a("p",{staticClass:"subtitle"},[e._v("Administra las deudas pendientes y proveedores de manera eficiente")])])])},function(){var e=this,a=e._self._c;return a("div",{staticClass:"header-icon"},[a("i",{staticClass:"icon-config"},[e._v("âš™ï¸")])])},function(){var e=this,a=e._self._c;return a("div",{staticClass:"header-text"},[a("h2",[e._v("Gestionar Proveedores")]),a("p",[e._v("Administra los proveedores y asigna colores de identificaciÃ³n")])])},function(){var e=this,a=e._self._c;return a("div",{staticClass:"section-header"},[a("i",{staticClass:"section-icon"},[e._v("âž•")]),a("h3",[e._v("Agregar Nuevo Proveedor")])])},function(){var e=this,a=e._self._c;return a("label",{staticClass:"modern-label",attrs:{for:"nombre"}},[a("i",{staticClass:"label-icon"},[e._v("ðŸ‘¤")]),e._v(" Nombre del Proveedor ")])},function(){var e=this,a=e._self._c;return a("label",{staticClass:"modern-label",attrs:{for:"telefono"}},[a("i",{staticClass:"label-icon"},[e._v("ðŸ“ž")]),e._v(" TelÃ©fono (opcional) ")])},function(){var e=this,a=e._self._c;return a("label",{staticClass:"modern-label"},[a("i",{staticClass:"label-icon"},[e._v("ðŸŽ¨")]),e._v(" Color de IdentificaciÃ³n ")])},function(){var e=this,a=e._self._c;return a("div",{staticClass:"header-icon"},[a("i",{staticClass:"icon-edit"},[e._v("âœï¸")])])},function(){var e=this,a=e._self._c;return a("div",{staticClass:"header-text"},[a("h2",[e._v("Editar Proveedor")]),a("p",[e._v("Modifica la informaciÃ³n del proveedor")])])},function(){var e=this,a=e._self._c;return a("label",{staticClass:"modern-label",attrs:{for:"editNombre"}},[a("i",{staticClass:"label-icon"},[e._v("ðŸ‘¤")]),e._v(" Nombre del Proveedor ")])},function(){var e=this,a=e._self._c;return a("label",{staticClass:"modern-label",attrs:{for:"editTelefono"}},[a("i",{staticClass:"label-icon"},[e._v("ðŸ“ž")]),e._v(" TelÃ©fono (opcional) ")])},function(){var e=this,a=e._self._c;return a("label",{staticClass:"modern-label"},[a("i",{staticClass:"label-icon"},[e._v("ðŸŽ¨")]),e._v(" Color de IdentificaciÃ³n ")])}],i=t("dc59"),s=t("1494"),n=t("74c9"),d={name:"DeudasMenu",components:{BackButton:n["a"]},data(){return{showModal:!1,showEditModal:!1,proveedores:[],newProveedor:{nombre:"",telefono:"",color:""},editingProveedor:{id:"",nombre:"",telefono:"",color:""},coloresDisponibles:[{name:"Azul",value:"#3498DB"},{name:"Verde",value:"#2ECC71"},{name:"Rojo",value:"#E74C3C"},{name:"Naranja",value:"#F39C12"},{name:"PÃºrpura",value:"#9B59B6"},{name:"Turquesa",value:"#1ABC9C"},{name:"Rosa",value:"#E91E63"},{name:"Ãndigo",value:"#673AB7"},{name:"Amarillo",value:"#F1C40F"},{name:"Coral",value:"#FF7675"},{name:"Aguamarina",value:"#00CEC9"},{name:"Lima",value:"#6C5CE7"}]}},computed:{sortedProveedores(){return[...this.proveedores].sort((e,a)=>e.nombre.localeCompare(a.nombre))}},methods:{openProveedoresModal(){this.showModal=!0,this.loadProveedores()},closeModalOnOverlay(e){e.target===e.currentTarget&&(this.showModal=!1)},closeEditModalOnOverlay(e){e.target===e.currentTarget&&(this.showEditModal=!1)},async loadProveedores(){try{const e=await Object(s["g"])(Object(s["c"])(i["a"],"proveedoresDeuda"));this.proveedores=e.docs.map(e=>({id:e.id,...e.data()}))}catch(e){console.error("Error al cargar proveedores: ",e)}},async addProveedor(){try{if(!this.newProveedor.nombre||!this.newProveedor.color)return void alert("Por favor, ingrese el nombre del proveedor y seleccione un color.");await Object(s["b"])(Object(s["c"])(i["a"],"proveedoresDeuda"),{nombre:this.newProveedor.nombre,telefono:this.newProveedor.telefono||"",color:this.newProveedor.color,fechaCreacion:new Date}),this.newProveedor={nombre:"",telefono:"",color:""},this.loadProveedores(),alert("Proveedor agregado exitosamente")}catch(e){console.error("Error al aÃ±adir proveedor: ",e),alert("Error al agregar proveedor: "+e.message)}},editarProveedor(e){this.editingProveedor={id:e.id,nombre:e.nombre,telefono:e.telefono||"",color:e.color||"#3498DB"},this.showEditModal=!0},async updateProveedor(){try{if(!this.editingProveedor.nombre||!this.editingProveedor.color)return void alert("Por favor, ingrese el nombre del proveedor y seleccione un color.");await Object(s["s"])(Object(s["e"])(i["a"],"proveedoresDeuda",this.editingProveedor.id),{nombre:this.editingProveedor.nombre,telefono:this.editingProveedor.telefono||"",color:this.editingProveedor.color,fechaModificacion:new Date}),this.showEditModal=!1,this.loadProveedores(),alert("Proveedor actualizado exitosamente")}catch(e){console.error("Error al actualizar proveedor: ",e),alert("Error al actualizar proveedor: "+e.message)}},async deleteProveedor(e){if(confirm("Â¿EstÃ¡s seguro de que quieres eliminar este proveedor? Esta acciÃ³n no se puede deshacer."))try{await Object(s["d"])(Object(s["e"])(i["a"],"proveedoresDeuda",e)),this.loadProveedores(),alert("Proveedor eliminado exitosamente")}catch(a){console.error("Error al eliminar proveedor: ",a),alert("Error al eliminar proveedor: "+a.message)}},formatearFechaCreacion(e){if(!e)return"Fecha no disponible";try{let a;a=e.toDate?e.toDate():e instanceof Date?e:new Date(e);const t={year:"numeric",month:"short",day:"numeric"};return a.toLocaleDateString("es-ES",t)}catch(a){return console.error("Error al formatear fecha:",a),"Fecha invÃ¡lida"}}},mounted(){this.loadProveedores()}},c=d,l=(t("ad3c"),t("2877")),u=Object(l["a"])(c,o,r,!1,null,"f29747ea",null);a["a"]=u.exports},"959e":function(e,a,t){},"9b35":function(e,a,t){"use strict";var o=function(){var e,a,t,o,r,i,s,n,d,c,l=this,u=l._self._c;return u("div",{staticClass:"lista-deudas"},[u("div",{staticClass:"back-button-container"},[u("BackButton",{attrs:{to:"/procesos/deudas"}})],1),l._m(0),u("div",{staticClass:"filtros-container"},[u("div",{staticClass:"filtros-card"},[l._m(1),u("div",{staticClass:"filtros-grid"},[u("div",{staticClass:"filtro-group"},[u("label",{attrs:{for:"filtroProveedor"}},[l._v("Proveedor:")]),u("select",{directives:[{name:"model",rawName:"v-model",value:l.filtroProveedor,expression:"filtroProveedor"}],staticClass:"modern-select",attrs:{id:"filtroProveedor"},on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(e){return e.selected})).map((function(e){var a="_value"in e?e._value:e.value;return a}));l.filtroProveedor=e.target.multiple?a:a[0]}}},[u("option",{attrs:{value:""}},[l._v("Todos los proveedores")]),l._l(l.proveedores,(function(e){return u("option",{key:e.id,domProps:{value:e.id}},[l._v(" "+l._s(e.nombre)+" ")])}))],2),l.filtroProveedor?u("div",{staticClass:"proveedor-color-indicator"},[u("div",{staticClass:"color-dot",style:{backgroundColor:l.getProveedorColor(l.filtroProveedor)}}),u("span",[l._v(l._s(l.getNombreProveedorSeleccionado()))])]):l._e()]),u("div",{staticClass:"filtro-group"},[u("label",{attrs:{for:"filtroEstado"}},[l._v("Estado:")]),u("select",{directives:[{name:"model",rawName:"v-model",value:l.filtroEstado,expression:"filtroEstado"}],staticClass:"modern-select",attrs:{id:"filtroEstado"},on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(e){return e.selected})).map((function(e){var a="_value"in e?e._value:e.value;return a}));l.filtroEstado=e.target.multiple?a:a[0]}}},[u("option",{attrs:{value:""}},[l._v("Todos los estados")]),u("option",{attrs:{value:"pendiente"}},[l._v("No Pagados (Pendientes)")]),u("option",{attrs:{value:"pagado"}},[l._v("Pagados")])])]),u("div",{staticClass:"filtro-group fecha-group"},[u("label",[l._v("Rango de fechas:")]),u("div",{staticClass:"fecha-inputs"},[u("input",{directives:[{name:"model",rawName:"v-model",value:l.filtroFechaDesde,expression:"filtroFechaDesde"}],staticClass:"modern-input",attrs:{type:"date",placeholder:"Desde"},domProps:{value:l.filtroFechaDesde},on:{input:function(e){e.target.composing||(l.filtroFechaDesde=e.target.value)}}}),u("span",{staticClass:"fecha-separator"},[l._v("a")]),u("input",{directives:[{name:"model",rawName:"v-model",value:l.filtroFechaHasta,expression:"filtroFechaHasta"}],staticClass:"modern-input",attrs:{type:"date",placeholder:"Hasta"},domProps:{value:l.filtroFechaHasta},on:{input:function(e){e.target.composing||(l.filtroFechaHasta=e.target.value)}}})])])])])]),u("div",{staticClass:"resumen-container"},[u("div",{staticClass:"resumen-card saldo-pendiente"},[u("div",{staticClass:"card-icon"},[l._v("ðŸ’°")]),u("div",{staticClass:"card-content"},[u("h3",[l._v("Saldo Pendiente")]),u("p",{staticClass:"amount"},[l._v("$"+l._s(l.formatNumber(l.totalPendiente)))])])])]),u("div",{staticClass:"acciones-container"},[u("router-link",{staticClass:"btn-action btn-nueva-deuda",attrs:{to:"/procesos/deudas/nueva"}},[u("i",{staticClass:"icon"},[l._v("âž•")]),u("span",[l._v("Nueva Deuda")])]),u("button",{staticClass:"btn-action btn-historial-precios",on:{click:l.openHistorialPreciosModal}},[u("i",{staticClass:"icon"},[l._v("ðŸ“ˆ")]),u("span",[l._v("Historial de Precios")])])],1),l.filtroProveedor?u("div",{staticClass:"abonos-proveedor-section"},[u("div",{staticClass:"proveedor-selected-info"},[u("h3",[l._v("GestiÃ³n de Abonos - "+l._s(l.getNombreProveedorSeleccionado()))]),u("div",{staticClass:"abonos-actions"},[u("button",{staticClass:"btn-abono-general",attrs:{disabled:!l.tieneDeudasPendientes},on:{click:l.abrirAbonoGeneral}},[u("i",{staticClass:"fas fa-money-check-alt"}),l._v(" Abono General ")]),u("button",{staticClass:"btn-historial-abonos",on:{click:l.abrirHistorialAbonos}},[u("i",{staticClass:"fas fa-history"}),l._v(" Historial de Abonos ")])])])]):l._e(),l.cargando?u("div",{staticClass:"loading-state"},[u("div",{staticClass:"loading-spinner"}),u("p",[l._v("Cargando deudas...")])]):0===l.deudas.length?u("div",{staticClass:"empty-state"},[u("div",{staticClass:"empty-icon"},[l._v("ðŸ“„")]),u("h3",[l._v("No hay deudas registradas")]),u("p",[l._v("Comienza creando tu primera deuda a proveedores")]),u("router-link",{staticClass:"btn-action btn-nueva-deuda",attrs:{to:"/procesos/deudas/nueva"}},[u("i",{staticClass:"icon"},[l._v("âž•")]),u("span",[l._v("Crear Nueva Deuda")])])],1):u("div",{staticClass:"deudas-container"},[u("div",{staticClass:"paginacion-info"},[u("p",[l._v("Mostrando "+l._s(l.totalDeudas)+" deudas agrupadas por proveedor")])]),l._l(l.deudasAgrupadasPorProveedor,(function(e){return u("div",{key:e.proveedor.id,staticClass:"proveedor-grupo"},[u("div",{staticClass:"proveedor-header"},[u("div",{staticClass:"proveedor-title"},[u("div",{staticClass:"proveedor-color-circle",style:{backgroundColor:e.proveedor.color}}),u("h2",{class:["proveedor-nombre","clickeable",{filtrado:l.filtroProveedor===e.proveedor.id}],attrs:{title:l.filtroProveedor===e.proveedor.id?"Haz clic para quitar el filtro":"Haz clic para filtrar por este proveedor"},on:{click:function(a){return l.filtrarPorProveedor(e.proveedor.id)}}},[l._v(" "+l._s(e.proveedor.nombre)+" "),u("i",{class:["fas",l.filtroProveedor===e.proveedor.id?"fa-check-circle":"fa-filter","filter-icon"]})])]),u("div",{staticClass:"proveedor-resumen"},[u("div",{staticClass:"resumen-item"},[u("span",{staticClass:"label"},[l._v("Total Deuda:")]),u("span",{staticClass:"value"},[l._v("$"+l._s(l.formatNumber(e.totalDeuda)))])]),u("div",{staticClass:"resumen-item"},[u("span",{staticClass:"label"},[l._v("Saldo Pendiente:")]),u("span",{staticClass:"value pendiente"},[l._v("$"+l._s(l.formatNumber(e.totalPendiente)))])]),u("div",{staticClass:"resumen-item"},[u("span",{staticClass:"label"},[l._v("Deudas:")]),u("span",{staticClass:"value"},[l._v(l._s(e.deudas.length))])])])]),u("div",{staticClass:"tabla-container-proveedor"},[u("table",{staticClass:"tabla-deudas-proveedor"},[l._m(2,!0),u("tbody",l._l(e.deudas,(function(e){return u("tr",{key:e.id,class:{"deuda-pagada":"pagado"===e.estado}},[u("td",[l._v(l._s(l.formatearFecha(e.fecha)))]),u("td",[l._v("$"+l._s(l.formatNumber(e.total)))]),u("td",[l._v("$"+l._s(l.formatNumber(e.saldoPendiente)))]),u("td",[u("span",{class:"estado-badge "+e.estado},[l._v(" "+l._s("pendiente"===e.estado?"Pendiente":"Pagado")+" ")])]),u("td",{staticClass:"acciones"},[u("button",{staticClass:"btn-detalle",attrs:{title:"Ver detalles"},on:{click:function(a){return l.verDetalle(e)}}},[u("i",{staticClass:"fas fa-eye"})]),u("button",{staticClass:"btn-abono",attrs:{disabled:"pagado"===e.estado,title:"Agregar abono"},on:{click:function(a){return l.agregarAbono(e)}}},[u("i",{staticClass:"fas fa-money-bill"})]),u("button",{staticClass:"btn-eliminar",attrs:{title:"Eliminar deuda"},on:{click:function(a){return l.eliminarDeuda(e)}}},[u("i",{staticClass:"fas fa-trash-alt"})])])])})),0)])])])}))],2),l.showDetalleModal?u("div",{staticClass:"modal-overlay",on:{click:l.closeModalOnOverlay}},[u("div",{staticClass:"modal-content",on:{click:function(e){e.stopPropagation()}}},[u("div",{staticClass:"modal-header"},[u("h2",[l._v("Detalle de Deuda")]),u("button",{staticClass:"close-button",on:{click:function(e){l.showDetalleModal=!1}}},[l._v("Ã—")])]),u("div",{staticClass:"modal-body"},[u("div",{staticClass:"deuda-info editable-container"},[u("p",[u("strong",[l._v("Proveedor:")]),u("span",{staticClass:"editable-field",on:{click:function(e){return l.habilitarEdicionDeuda("proveedorNombre")}}},[l.campoEditandoDeuda&&"proveedorNombre"===l.campoEditandoDeuda?u("input",{directives:[{name:"model",rawName:"v-model",value:l.deudaEditada.proveedorNombre,expression:"deudaEditada.proveedorNombre"}],ref:"inputProveedorNombre",attrs:{type:"text"},domProps:{value:l.deudaEditada.proveedorNombre},on:{blur:l.guardarCambiosDeuda,keyup:function(e){return!e.type.indexOf("key")&&l._k(e.keyCode,"enter",13,e.key,"Enter")?null:l.guardarCambiosDeuda.apply(null,arguments)},input:function(e){e.target.composing||l.$set(l.deudaEditada,"proveedorNombre",e.target.value)}}}):u("span",[l._v(" "+l._s(null===(e=l.deudaSeleccionada)||void 0===e?void 0:e.proveedorNombre)+" ")])])]),u("p",[u("strong",[l._v("Fecha:")]),u("span",{staticClass:"editable-field",on:{click:function(e){return l.habilitarEdicionDeuda("fecha")}}},[l.campoEditandoDeuda&&"fecha"===l.campoEditandoDeuda?u("input",{directives:[{name:"model",rawName:"v-model",value:l.deudaEditada.fecha,expression:"deudaEditada.fecha"}],ref:"inputFecha",attrs:{type:"date"},domProps:{value:l.deudaEditada.fecha},on:{blur:l.guardarCambiosDeuda,keyup:function(e){return!e.type.indexOf("key")&&l._k(e.keyCode,"enter",13,e.key,"Enter")?null:l.guardarCambiosDeuda.apply(null,arguments)},input:function(e){e.target.composing||l.$set(l.deudaEditada,"fecha",e.target.value)}}}):u("span",[l._v(" "+l._s(l.formatearFecha(null===(a=l.deudaSeleccionada)||void 0===a?void 0:a.fecha))+" ")])])]),u("p",[u("strong",[l._v("Estado:")]),u("span",{class:"estado-badge "+(null===(t=l.deudaSeleccionada)||void 0===t?void 0:t.estado)},[l._v(" "+l._s("pendiente"===(null===(o=l.deudaSeleccionada)||void 0===o?void 0:o.estado)?"Pendiente":"Pagado")+" ")])])]),l._m(3),u("table",{staticClass:"tabla-productos"},[l._m(4),u("tbody",l._l(l.productos,(function(e,a){return u("tr",{key:a},[u("td",{staticClass:"editable-cell",on:{click:function(e){return l.habilitarEdicionProducto(a,"kilos")}}},[e.editando&&"kilos"===e.campoEditando?u("input",{directives:[{name:"model",rawName:"v-model.number",value:e.kilos,expression:"producto.kilos",modifiers:{number:!0}}],ref:"inputKilos",refInFor:!0,attrs:{type:"number",step:"0.01"},domProps:{value:e.kilos},on:{blur:[function(e){return l.guardarCambiosProducto(a)},function(e){return l.$forceUpdate()}],keyup:function(e){return!e.type.indexOf("key")&&l._k(e.keyCode,"enter",13,e.key,"Enter")?null:l.guardarCambiosProducto(a)},input:function(a){a.target.composing||l.$set(e,"kilos",l._n(a.target.value))}}}):u("span",[l._v(" "+l._s(l.formatNumber(e.kilos))+" ")])]),u("td",{staticClass:"editable-cell",on:{click:function(e){return l.habilitarEdicionProducto(a,"producto")}}},[e.editando&&"producto"===e.campoEditando?u("input",{directives:[{name:"model",rawName:"v-model",value:e.producto,expression:"producto.producto"}],ref:"inputProducto",refInFor:!0,attrs:{type:"text"},domProps:{value:e.producto},on:{blur:function(e){return l.guardarCambiosProducto(a)},keyup:function(e){return!e.type.indexOf("key")&&l._k(e.keyCode,"enter",13,e.key,"Enter")?null:l.guardarCambiosProducto(a)},input:function(a){a.target.composing||l.$set(e,"producto",a.target.value)}}}):u("span",[l._v(" "+l._s(e.producto)+" ")])]),u("td",{staticClass:"editable-cell",on:{click:function(e){return l.habilitarEdicionProducto(a,"precio")}}},[e.editando&&"precio"===e.campoEditando?u("input",{directives:[{name:"model",rawName:"v-model.number",value:e.precio,expression:"producto.precio",modifiers:{number:!0}}],ref:"inputPrecio",refInFor:!0,attrs:{type:"number",step:"0.01"},domProps:{value:e.precio},on:{blur:[function(e){return l.guardarCambiosProducto(a)},function(e){return l.$forceUpdate()}],keyup:function(e){return!e.type.indexOf("key")&&l._k(e.keyCode,"enter",13,e.key,"Enter")?null:l.guardarCambiosProducto(a)},input:function(a){a.target.composing||l.$set(e,"precio",l._n(a.target.value))}}}):u("span",[l._v(" $"+l._s(l.formatNumber(e.precio))+" ")])]),u("td",[l._v("$"+l._s(l.formatNumber(e.total)))]),u("td",[u("button",{staticClass:"btn-eliminar-sm",on:{click:function(e){return l.eliminarProducto(a)}}},[u("i",{staticClass:"fas fa-trash-alt"})])])])})),0),u("tfoot",[u("tr",[u("td",{staticClass:"total-label",attrs:{colspan:"3"}},[l._v("Total")]),u("td",[l._v("$"+l._s(l.formatNumber(l.totalProductos)))]),u("td")])])]),u("div",{staticClass:"add-product-section"},[u("h4",[l._v("Agregar Producto")]),u("ProductoSelector",{attrs:{"proveedor-id":null===(r=l.deudaSeleccionada)||void 0===r?void 0:r.proveedorId},on:{"agregar-producto":l.agregarProductoDesdeSelector}})],1),u("h3",[l._v("Abonos")]),0===l.abonos.length?u("div",{staticClass:"no-abonos"},[u("p",[l._v("No hay abonos registrados para esta deuda.")])]):u("table",{staticClass:"tabla-abonos"},[l._m(5),u("tbody",l._l(l.abonos,(function(e,a){return u("tr",{key:a},[u("td",{staticClass:"editable-cell",on:{click:function(e){return l.habilitarEdicionAbono(a,"fecha")}}},[e.editando&&"fecha"===e.campoEditando?u("input",{directives:[{name:"model",rawName:"v-model",value:e.fecha,expression:"abono.fecha"}],ref:"inputFechaAbono",refInFor:!0,attrs:{type:"date"},domProps:{value:e.fecha},on:{blur:function(e){return l.guardarCambiosAbono(a)},keyup:function(e){return!e.type.indexOf("key")&&l._k(e.keyCode,"enter",13,e.key,"Enter")?null:l.guardarCambiosAbono(a)},input:function(a){a.target.composing||l.$set(e,"fecha",a.target.value)}}}):u("span",[l._v(" "+l._s(l.formatearFecha(e.fecha))+" ")])]),u("td",{staticClass:"editable-cell",on:{click:function(e){return l.habilitarEdicionAbono(a,"descripcion")}}},[e.editando&&"descripcion"===e.campoEditando?u("input",{directives:[{name:"model",rawName:"v-model",value:e.descripcion,expression:"abono.descripcion"}],ref:"inputDescripcionAbono",refInFor:!0,attrs:{type:"text"},domProps:{value:e.descripcion},on:{blur:function(e){return l.guardarCambiosAbono(a)},keyup:function(e){return!e.type.indexOf("key")&&l._k(e.keyCode,"enter",13,e.key,"Enter")?null:l.guardarCambiosAbono(a)},input:function(a){a.target.composing||l.$set(e,"descripcion",a.target.value)}}}):u("span",[l._v(" "+l._s(e.descripcion)+" ")])]),u("td",{staticClass:"editable-cell",on:{click:function(e){return l.habilitarEdicionAbono(a,"monto")}}},[e.editando&&"monto"===e.campoEditando?u("input",{directives:[{name:"model",rawName:"v-model.number",value:e.monto,expression:"abono.monto",modifiers:{number:!0}}],ref:"inputMontoAbono",refInFor:!0,attrs:{type:"number",step:"0.01"},domProps:{value:e.monto},on:{blur:[function(e){return l.guardarCambiosAbono(a)},function(e){return l.$forceUpdate()}],keyup:function(e){return!e.type.indexOf("key")&&l._k(e.keyCode,"enter",13,e.key,"Enter")?null:l.guardarCambiosAbono(a)},input:function(a){a.target.composing||l.$set(e,"monto",l._n(a.target.value))}}}):u("span",[l._v(" $"+l._s(l.formatNumber(e.monto))+" ")])]),u("td",[u("button",{staticClass:"btn-eliminar-sm",on:{click:function(e){return l.eliminarAbono(a)}}},[u("i",{staticClass:"fas fa-trash-alt"})])])])})),0),u("tfoot",[u("tr",[u("td",{staticClass:"total-label",attrs:{colspan:"2"}},[l._v("Total Abonos")]),u("td",[l._v("$"+l._s(l.formatNumber(l.totalAbonos)))]),u("td")])])]),u("div",{staticClass:"resumen-deuda"},[u("div",{staticClass:"resumen-item"},[u("span",[l._v("Total deuda:")]),u("span",[l._v("$"+l._s(l.formatNumber(null===(i=l.deudaSeleccionada)||void 0===i?void 0:i.total)))])]),u("div",{staticClass:"resumen-item"},[u("span",[l._v("Total abonos:")]),u("span",[l._v("$"+l._s(l.formatNumber(l.totalAbonos)))])]),u("div",{staticClass:"resumen-item total"},[u("span",[l._v("Saldo pendiente:")]),u("span",[l._v("$"+l._s(l.formatNumber(l.calcularSaldoPendiente())))])])]),u("div",{staticClass:"modal-actions"},[u("button",{staticClass:"btn-actualizar",attrs:{disabled:l.guardando},on:{click:l.actualizarDeuda}},[l._v(" "+l._s(l.guardando?"Guardando...":"Actualizar Deuda")+" ")])])])])]):l._e(),l.showAbonoModal?u("div",{staticClass:"modal-overlay",on:{click:l.closeModalOnOverlay}},[u("div",{staticClass:"modal-content",on:{click:function(e){e.stopPropagation()}}},[u("div",{staticClass:"modal-header"},[u("h2",[l._v("Agregar Abono")]),u("button",{staticClass:"close-button",on:{click:function(e){l.showAbonoModal=!1}}},[l._v("Ã—")])]),u("div",{staticClass:"modal-body"},[u("div",{staticClass:"deuda-info"},[u("p",[u("strong",[l._v("Proveedor:")]),l._v(" "+l._s(null===(s=l.deudaSeleccionada)||void 0===s?void 0:s.proveedorNombre))]),u("p",[u("strong",[l._v("Fecha Deuda:")]),l._v(" "+l._s(l.formatearFecha(null===(n=l.deudaSeleccionada)||void 0===n?void 0:n.fecha)))]),u("p",[u("strong",[l._v("Saldo Pendiente:")]),l._v(" $"+l._s(l.formatNumber(null===(d=l.deudaSeleccionada)||void 0===d?void 0:d.saldoPendiente)))])]),u("form",{staticClass:"form-abono",on:{submit:function(e){return e.preventDefault(),l.guardarAbono.apply(null,arguments)}}},[u("div",{staticClass:"form-group"},[u("label",{attrs:{for:"fechaAbono"}},[l._v("Fecha:")]),u("input",{directives:[{name:"model",rawName:"v-model",value:l.nuevoAbono.fecha,expression:"nuevoAbono.fecha"}],attrs:{id:"fechaAbono",type:"date",required:""},domProps:{value:l.nuevoAbono.fecha},on:{input:function(e){e.target.composing||l.$set(l.nuevoAbono,"fecha",e.target.value)}}})]),u("div",{staticClass:"form-group"},[u("label",{attrs:{for:"descripcionAbono"}},[l._v("DescripciÃ³n:")]),u("input",{directives:[{name:"model",rawName:"v-model",value:l.nuevoAbono.descripcion,expression:"nuevoAbono.descripcion"}],attrs:{id:"descripcionAbono",type:"text",required:"",placeholder:"Ej: Pago parcial, Transferencia, etc."},domProps:{value:l.nuevoAbono.descripcion},on:{input:function(e){e.target.composing||l.$set(l.nuevoAbono,"descripcion",e.target.value)}}})]),u("div",{staticClass:"form-group"},[u("label",{attrs:{for:"montoAbono"}},[l._v("Monto:")]),u("input",{directives:[{name:"model",rawName:"v-model.number",value:l.nuevoAbono.monto,expression:"nuevoAbono.monto",modifiers:{number:!0}}],attrs:{id:"montoAbono",type:"number",required:"",min:"1",max:null===(c=l.deudaSeleccionada)||void 0===c?void 0:c.saldoPendiente},domProps:{value:l.nuevoAbono.monto},on:{input:function(e){e.target.composing||l.$set(l.nuevoAbono,"monto",l._n(e.target.value))},blur:function(e){return l.$forceUpdate()}}})]),u("div",{staticClass:"form-actions"},[u("button",{staticClass:"btn-cancelar",attrs:{type:"button"},on:{click:function(e){l.showAbonoModal=!1}}},[l._v("Cancelar")]),u("button",{staticClass:"btn-guardar",attrs:{type:"submit",disabled:l.guardando}},[l._v(" "+l._s(l.guardando?"Guardando...":"Guardar Abono")+" ")])])])])])]):l._e(),u("PreciosProveedorPanel",{attrs:{mostrar:l.showHistorialPreciosModal,proveedores:l.proveedores},on:{cerrar:function(e){l.showHistorialPreciosModal=!1}}}),u("AbonoGeneralModal",{attrs:{mostrar:l.showAbonoGeneralModal,proveedor:l.proveedorSeleccionadoParaAbono},on:{cerrar:function(e){l.showAbonoGeneralModal=!1},"abono-aplicado":l.onAbonoAplicado}}),u("HistorialAbonosModal",{attrs:{mostrar:l.showHistorialAbonosModal,proveedor:l.proveedorSeleccionadoParaAbono},on:{cerrar:function(e){l.showHistorialAbonosModal=!1},"abono-eliminado":l.onAbonoEliminado}})],1)},r=[function(){var e=this,a=e._self._c;return a("div",{staticClass:"header-section"},[a("div",{staticClass:"header-content"},[a("h1",{staticClass:"main-title"},[a("i",{staticClass:"icon-list"},[e._v("ðŸ“‹")]),e._v(" Lista de Deudas a Proveedores ")]),a("p",{staticClass:"subtitle"},[e._v("Administra y monitorea todas las deudas pendientes")])])])},function(){var e=this,a=e._self._c;return a("h3",{staticClass:"filtros-title"},[a("i",{staticClass:"icon-filter"},[e._v("ðŸ”")]),e._v(" Filtros de BÃºsqueda ")])},function(){var e=this,a=e._self._c;return a("thead",[a("tr",[a("th",[e._v("Fecha")]),a("th",[e._v("Monto Total")]),a("th",[e._v("Saldo Pendiente")]),a("th",[e._v("Estado")]),a("th",[e._v("Acciones")])])])},function(){var e=this,a=e._self._c;return a("h3",[e._v("Productos "),a("span",{staticClass:"small-text"},[e._v("(haga clic en un campo para editarlo)")])])},function(){var e=this,a=e._self._c;return a("thead",[a("tr",[a("th",[e._v("Kilos")]),a("th",[e._v("Producto")]),a("th",[e._v("Precio")]),a("th",[e._v("Total")]),a("th",[e._v("Acciones")])])])},function(){var e=this,a=e._self._c;return a("thead",[a("tr",[a("th",[e._v("Fecha")]),a("th",[e._v("DescripciÃ³n")]),a("th",[e._v("Monto")]),a("th",[e._v("Acciones")])])])}],i=(t("14d9"),t("13d5"),t("dc59")),s=t("1494"),n=t("74c9"),d=t("a947"),c=t("687e"),l=t("4c15"),u=t("a54e"),v={name:"ListaDeudas",components:{BackButton:n["a"],PreciosProveedorPanel:d["a"],ProductoSelector:c["a"],AbonoGeneralModal:l["a"],HistorialAbonosModal:u["a"]},data(){return{deudas:[],proveedores:[],cargando:!0,guardando:!1,paginaActual:1,deudasPorPagina:15,filtroProveedor:"",filtroEstado:"pendiente",filtroFechaDesde:"",filtroFechaHasta:"",showDetalleModal:!1,showAbonoModal:!1,showHistorialPreciosModal:!1,showAbonoGeneralModal:!1,showHistorialAbonosModal:!1,deudaSeleccionada:null,productos:[],abonos:[],proveedorSeleccionadoParaAbono:null,nuevoAbono:{fecha:this.obtenerFechaActual(),descripcion:"",monto:null},campoEditandoDeuda:null,deudaEditada:{proveedorNombre:"",fecha:""}}},computed:{deudasFiltradas(){return this.deudas.filter(e=>(!this.filtroProveedor||e.proveedorId===this.filtroProveedor)&&((!this.filtroEstado||e.estado===this.filtroEstado)&&(!(this.filtroFechaDesde&&e.fecha<this.filtroFechaDesde)&&!(this.filtroFechaHasta&&e.fecha>this.filtroFechaHasta))))},totalDeudas(){return this.deudasFiltradas.length},totalPaginas(){return Math.ceil(this.totalDeudas/this.deudasPorPagina)},deudasPaginadas(){const e=(this.paginaActual-1)*this.deudasPorPagina,a=e+this.deudasPorPagina;return this.deudasFiltradas.slice(e,a)},deudasAgrupadasPorProveedor(){const e={};return this.deudasFiltradas.forEach(a=>{const t=a.proveedorId,o=a.proveedorNombre;e[t]||(e[t]={proveedor:{id:t,nombre:o,color:this.getProveedorColor(t)},deudas:[],totalDeuda:0,totalPendiente:0}),e[t].deudas.push(a),e[t].totalDeuda+=a.total,e[t].totalPendiente+=a.saldoPendiente}),Object.values(e).sort((e,a)=>e.proveedor.nombre.localeCompare(a.proveedor.nombre))},paginasVisibles(){const e=[],a=this.totalPaginas,t=this.paginaActual;let o=Math.max(1,t-2),r=Math.min(a,o+4);r-o<4&&(o=Math.max(1,r-4));for(let i=o;i<=r;i++)e.push(i);return e},totalMontoDeudas(){return this.deudasFiltradas.reduce((e,a)=>e+a.total,0)},totalPendiente(){return this.deudasFiltradas.reduce((e,a)=>e+a.saldoPendiente,0)},totalPagado(){return this.deudasFiltradas.reduce((e,a)=>e+(a.total-a.saldoPendiente),0)},totalProductos(){return this.productos.reduce((e,a)=>e+a.total,0)},totalAbonos(){return this.abonos.reduce((e,a)=>e+a.monto,0)},tieneDeudasPendientes(){return this.deudasFiltradas.some(e=>"pendiente"===e.estado)}},methods:{obtenerFechaActual(){const e=new Date,a=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${a}-${t}-${o}`},cambiarPagina(e){e>=1&&e<=this.totalPaginas&&(this.paginaActual=e,window.scrollTo({top:0,behavior:"smooth"}))},async loadDeudas(){try{this.cargando=!0;const e=await Object(s["g"])(Object(s["o"])(Object(s["c"])(i["a"],"deudas"),Object(s["l"])("fecha","desc")));this.deudas=e.docs.map(e=>({id:e.id,...e.data()}))}catch(e){console.error("Error al cargar deudas: ",e)}finally{this.cargando=!1}},async loadProveedores(){try{const e=await Object(s["g"])(Object(s["c"])(i["a"],"proveedoresDeuda"));this.proveedores=e.docs.map(e=>({id:e.id,...e.data()}))}catch(e){console.error("Error al cargar proveedores: ",e)}},formatNumber(e){return e?e.toLocaleString("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00"},formatearFecha(e){if(!e)return"";const a=new Date(e+"T00:00:00"),t={year:"numeric",month:"long",day:"numeric"};return a.toLocaleDateString("es-ES",t)},closeModalOnOverlay(e){e.target===e.currentTarget&&(this.showDetalleModal=!1,this.showAbonoModal=!1,this.showHistorialPreciosModal=!1)},async verDetalle(e){this.deudaSeleccionada=e,this.productos=[],this.abonos=[];try{const a=await Object(s["g"])(Object(s["c"])(i["a"],"deudas",e.id,"productos"));this.productos=a.docs.map(e=>({id:e.id,...e.data()}));const t=await Object(s["g"])(Object(s["o"])(Object(s["c"])(i["a"],"deudas",e.id,"abonos"),Object(s["l"])("fechaCreacion","desc")));this.abonos=t.docs.map(e=>({id:e.id,...e.data()})),this.showDetalleModal=!0}catch(a){console.error("Error al cargar detalle de deuda: ",a)}},agregarAbono(e){this.deudaSeleccionada=e,this.nuevoAbono={fecha:this.obtenerFechaActual(),descripcion:"",monto:null},this.showAbonoModal=!0},async guardarAbono(){if(this.nuevoAbono.descripcion&&this.nuevoAbono.monto)if(this.nuevoAbono.monto<=0)alert("El monto del abono debe ser mayor a cero");else if(this.nuevoAbono.monto>this.deudaSeleccionada.saldoPendiente)alert("El monto del abono no puede ser mayor al saldo pendiente");else try{this.guardando=!0,await Object(s["b"])(Object(s["c"])(i["a"],"deudas",this.deudaSeleccionada.id,"abonos"),{descripcion:this.nuevoAbono.descripcion,monto:this.nuevoAbono.monto,fecha:this.nuevoAbono.fecha,fechaCreacion:new Date});const e=this.deudaSeleccionada.saldoPendiente-this.nuevoAbono.monto,a=e<=0?"pagado":"pendiente";await Object(s["s"])(Object(s["e"])(i["a"],"deudas",this.deudaSeleccionada.id),{saldoPendiente:e,estado:a}),this.deudas=this.deudas.map(t=>t.id===this.deudaSeleccionada.id?{...t,saldoPendiente:e,estado:a}:t),this.deudaSeleccionada.saldoPendiente=e,this.deudaSeleccionada.estado=a,this.showAbonoModal=!1,alert("Abono registrado correctamente")}catch(e){console.error("Error al guardar abono: ",e),alert("Error al guardar abono: "+e.message)}finally{this.guardando=!1}else alert("Por favor complete todos los campos del abono")},async eliminarDeuda(e){if(confirm(`Â¿EstÃ¡ seguro que desea eliminar la deuda de ${e.proveedorNombre}? Esta acciÃ³n no se puede deshacer.`))try{this.cargando=!0;const a=await Object(s["g"])(Object(s["c"])(i["a"],"deudas",e.id,"productos")),t=Object(s["u"])(i["a"]);a.forEach(a=>{t.delete(Object(s["e"])(i["a"],"deudas",e.id,"productos",a.id))});const o=await Object(s["g"])(Object(s["c"])(i["a"],"deudas",e.id,"abonos"));o.forEach(a=>{t.delete(Object(s["e"])(i["a"],"deudas",e.id,"abonos",a.id))}),await t.commit(),await Object(s["d"])(Object(s["e"])(i["a"],"deudas",e.id)),this.deudas=this.deudas.filter(a=>a.id!==e.id),alert("Deuda eliminada correctamente")}catch(a){console.error("Error al eliminar la deuda: ",a),alert("Error al eliminar la deuda: "+a.message)}finally{this.cargando=!1}},habilitarEdicionDeuda(e){this.campoEditandoDeuda=e,"proveedorNombre"===e?(this.deudaEditada.proveedorNombre=this.deudaSeleccionada.proveedorNombre,this.$nextTick(()=>{this.$refs.inputProveedorNombre.focus()})):"fecha"===e&&(this.deudaEditada.fecha=this.deudaSeleccionada.fecha,this.$nextTick(()=>{this.$refs.inputFecha.focus()}))},async guardarCambiosDeuda(){if(!this.campoEditandoDeuda)return;const e=this.campoEditandoDeuda;if(this.campoEditandoDeuda=null,("proveedorNombre"!==e||this.deudaEditada.proveedorNombre!==this.deudaSeleccionada.proveedorNombre)&&("fecha"!==e||this.deudaEditada.fecha!==this.deudaSeleccionada.fecha))try{await Object(s["s"])(Object(s["e"])(i["a"],"deudas",this.deudaSeleccionada.id),{[e]:this.deudaEditada[e]}),this.deudaSeleccionada[e]=this.deudaEditada[e],this.deudas=this.deudas.map(a=>a.id===this.deudaSeleccionada.id?{...a,[e]:this.deudaEditada[e]}:a)}catch(a){console.error("Error al actualizar deuda: ",a),alert("Error al guardar cambios: "+a.message)}},habilitarEdicionProducto(e,a){this.productos=this.productos.map((t,o)=>o===e?{...t,editando:!0,campoEditando:a}:{...t,editando:!1,campoEditando:null}),this.$nextTick(()=>{const e="input"+(a.charAt(0).toUpperCase()+a.slice(1));this.$refs[e]&&this.$refs[e][0]&&this.$refs[e][0].focus()})},async guardarCambiosProducto(e){const a=this.productos[e];if(a.editando){"kilos"!==a.campoEditando&&"precio"!==a.campoEditando||(a.total=a.kilos*a.precio);try{await Object(s["s"])(Object(s["e"])(i["a"],"deudas",this.deudaSeleccionada.id,"productos",a.id),{kilos:a.kilos,producto:a.producto,precio:a.precio,total:a.total});const e=this.productos.reduce((e,a)=>e+a.total,0),t=e-this.totalAbonos;await Object(s["s"])(Object(s["e"])(i["a"],"deudas",this.deudaSeleccionada.id),{total:e,saldoPendiente:t,estado:t<=0?"pagado":"pendiente"}),this.deudaSeleccionada.total=e,this.deudaSeleccionada.saldoPendiente=t,this.deudaSeleccionada.estado=t<=0?"pagado":"pendiente",this.deudas=this.deudas.map(a=>a.id===this.deudaSeleccionada.id?{...a,total:e,saldoPendiente:t,estado:t<=0?"pagado":"pendiente"}:a),a.editando=!1,a.campoEditando=null}catch(t){console.error("Error al actualizar producto: ",t),alert("Error al guardar cambios del producto: "+t.message)}}},async agregarProducto(){if(this.nuevoProducto.kilos&&this.nuevoProducto.producto&&this.nuevoProducto.precio)try{this.guardando=!0;const e=this.nuevoProducto.kilos*this.nuevoProducto.precio,a=await Object(s["b"])(Object(s["c"])(i["a"],"deudas",this.deudaSeleccionada.id,"productos"),{kilos:this.nuevoProducto.kilos,producto:this.nuevoProducto.producto,precio:this.nuevoProducto.precio,total:e});this.productos.push({id:a.id,kilos:this.nuevoProducto.kilos,producto:this.nuevoProducto.producto,precio:this.nuevoProducto.precio,total:e,editando:!1,campoEditando:null});const t=this.productos.reduce((e,a)=>e+a.total,0),o=t-this.totalAbonos;await Object(s["s"])(Object(s["e"])(i["a"],"deudas",this.deudaSeleccionada.id),{total:t,saldoPendiente:o,estado:o<=0?"pagado":"pendiente"}),this.deudaSeleccionada.total=t,this.deudaSeleccionada.saldoPendiente=o,this.deudaSeleccionada.estado=o<=0?"pagado":"pendiente",this.deudas=this.deudas.map(e=>e.id===this.deudaSeleccionada.id?{...e,total:t,saldoPendiente:o,estado:o<=0?"pagado":"pendiente"}:e),this.nuevoProducto={kilos:null,producto:"",precio:null}}catch(e){console.error("Error al agregar producto: ",e),alert("Error al agregar producto: "+e.message)}finally{this.guardando=!1}else alert("Por favor complete todos los campos del producto")},async eliminarProducto(e){if(!confirm("Â¿EstÃ¡ seguro de eliminar este producto?"))return;const a=this.productos[e];try{this.guardando=!0,await Object(s["d"])(Object(s["e"])(i["a"],"deudas",this.deudaSeleccionada.id,"productos",a.id)),this.productos.splice(e,1);const t=this.productos.reduce((e,a)=>e+a.total,0),o=t-this.totalAbonos;await Object(s["s"])(Object(s["e"])(i["a"],"deudas",this.deudaSeleccionada.id),{total:t,saldoPendiente:o,estado:o<=0?"pagado":"pendiente"}),this.deudaSeleccionada.total=t,this.deudaSeleccionada.saldoPendiente=o,this.deudaSeleccionada.estado=o<=0?"pagado":"pendiente",this.deudas=this.deudas.map(e=>e.id===this.deudaSeleccionada.id?{...e,total:t,saldoPendiente:o,estado:o<=0?"pagado":"pendiente"}:e)}catch(t){console.error("Error al eliminar producto: ",t),alert("Error al eliminar producto: "+t.message)}finally{this.guardando=!1}},habilitarEdicionAbono(e,a){this.abonos=this.abonos.map((t,o)=>o===e?{...t,editando:!0,campoEditando:a}:{...t,editando:!1,campoEditando:null}),this.$nextTick(()=>{const e=`input${a.charAt(0).toUpperCase()+a.slice(1)}Abono`;this.$refs[e]&&this.$refs[e][0]&&this.$refs[e][0].focus()})},async guardarCambiosAbono(e){var a;const t=this.abonos[e];if(!t.editando)return;const o=(null===(a=this.abonos.find(e=>e.id===t.id))||void 0===a?void 0:a.monto)||0;try{if(await Object(s["s"])(Object(s["e"])(i["a"],"deudas",this.deudaSeleccionada.id,"abonos",t.id),{fecha:t.fecha,descripcion:t.descripcion,monto:t.monto}),t.monto!==o){const e=this.calcularSaldoPendiente();await Object(s["s"])(Object(s["e"])(i["a"],"deudas",this.deudaSeleccionada.id),{saldoPendiente:e,estado:e<=0?"pagado":"pendiente"}),this.deudaSeleccionada.saldoPendiente=e,this.deudaSeleccionada.estado=e<=0?"pagado":"pendiente",this.deudas=this.deudas.map(a=>a.id===this.deudaSeleccionada.id?{...a,saldoPendiente:e,estado:e<=0?"pagado":"pendiente"}:a)}t.editando=!1,t.campoEditando=null}catch(r){console.error("Error al actualizar abono: ",r),alert("Error al guardar cambios del abono: "+r.message)}},async eliminarAbono(e){if(!confirm("Â¿EstÃ¡ seguro de eliminar este abono?"))return;const a=this.abonos[e];try{this.guardando=!0,await Object(s["d"])(Object(s["e"])(i["a"],"deudas",this.deudaSeleccionada.id,"abonos",a.id)),this.abonos.splice(e,1);const t=this.calcularSaldoPendiente();await Object(s["s"])(Object(s["e"])(i["a"],"deudas",this.deudaSeleccionada.id),{saldoPendiente:t,estado:t<=0?"pagado":"pendiente"}),this.deudaSeleccionada.saldoPendiente=t,this.deudaSeleccionada.estado=t<=0?"pagado":"pendiente",this.deudas=this.deudas.map(e=>e.id===this.deudaSeleccionada.id?{...e,saldoPendiente:t,estado:t<=0?"pagado":"pendiente"}:e)}catch(t){console.error("Error al eliminar abono: ",t),alert("Error al eliminar abono: "+t.message)}finally{this.guardando=!1}},calcularSaldoPendiente(){var e;return(null===(e=this.deudaSeleccionada)||void 0===e?void 0:e.total)-this.totalAbonos},async actualizarDeuda(){try{this.guardando=!0;const e=this.calcularSaldoPendiente(),a=e<=0?"pagado":"pendiente";await Object(s["s"])(Object(s["e"])(i["a"],"deudas",this.deudaSeleccionada.id),{saldoPendiente:e,estado:a}),this.deudaSeleccionada.saldoPendiente=e,this.deudaSeleccionada.estado=a,this.deudas=this.deudas.map(t=>t.id===this.deudaSeleccionada.id?{...t,saldoPendiente:e,estado:a}:t),alert("Deuda actualizada correctamente"),this.showDetalleModal=!1}catch(e){console.error("Error al actualizar deuda: ",e),alert("Error al actualizar deuda: "+e.message)}finally{this.guardando=!1}},openHistorialPreciosModal(){this.showHistorialPreciosModal=!0,0===this.proveedores.length&&this.loadProveedores()},getNombreProveedorSeleccionado(){const e=this.proveedores.find(e=>e.id===this.filtroProveedor);return e?e.nombre:""},getProveedorColor(e){const a=this.proveedores.find(a=>a.id===e);return a&&a.color?a.color:"#cccccc"},abrirAbonoGeneral(){if(!this.filtroProveedor)return void alert("Por favor, seleccione un proveedor primero.");const e=this.proveedores.find(e=>e.id===this.filtroProveedor);e?(this.proveedorSeleccionadoParaAbono=e,this.showAbonoGeneralModal=!0):(alert("No se encontrÃ³ el proveedor seleccionado. Por favor, actualice la pÃ¡gina e intente de nuevo."),console.error("Proveedor no encontrado:",this.filtroProveedor,"en lista:",this.proveedores))},abrirHistorialAbonos(){if(!this.filtroProveedor)return void alert("Por favor, seleccione un proveedor primero.");const e=this.proveedores.find(e=>e.id===this.filtroProveedor);e?(this.proveedorSeleccionadoParaAbono=e,this.showHistorialAbonosModal=!0):(alert("No se encontrÃ³ el proveedor seleccionado. Por favor, actualice la pÃ¡gina e intente de nuevo."),console.error("Proveedor no encontrado:",this.filtroProveedor,"en lista:",this.proveedores))},async onAbonoAplicado(){try{await this.loadDeudas(),console.log("Deudas recargadas despuÃ©s de aplicar abono")}catch(e){console.error("Error al recargar deudas despuÃ©s de aplicar abono:",e)}},async onAbonoEliminado(e){try{if(console.log("Abono eliminado - Info recibida:",e),e&&e.deudaId){const a=this.deudas.findIndex(a=>a.id===e.deudaId);-1!==a&&(this.$set(this.deudas,a,{...this.deudas[a],saldoPendiente:e.nuevoSaldo,estado:e.nuevoEstado}),console.log("Deuda actualizada localmente inmediatamente:",{id:e.deudaId,saldoPendiente:e.nuevoSaldo,estado:e.nuevoEstado})),setTimeout(async()=>{try{await this.actualizarDeudaEspecifica(e.proveedorId),console.log("VerificaciÃ³n desde Firebase completada")}catch(a){console.error("Error en verificaciÃ³n desde Firebase:",a)}},1e3)}else console.log("No hay informaciÃ³n especÃ­fica, recargando todas las deudas..."),await new Promise(e=>setTimeout(e,500)),await this.loadDeudas()}catch(a){console.error("Error al actualizar despuÃ©s de eliminar abono:",a),await this.loadDeudas()}},async actualizarDeudaEspecifica(e){try{const a=Object(s["o"])(Object(s["c"])(i["a"],"deudas"),Object(s["t"])("proveedorId","==",e)),t=await Object(s["g"])(a),o=t.docs.map(e=>({id:e.id,...e.data()}));o.forEach(e=>{const a=this.deudas.findIndex(a=>a.id===e.id);-1!==a&&(this.$set(this.deudas,a,e),console.log("Deuda actualizada localmente:",e.id,"Estado:",e.estado,"Saldo Pendiente:",e.saldoPendiente))})}catch(a){console.error("Error al actualizar deuda especÃ­fica:",a)}},agregarProductoDesdeSelector(e){this.agregarProductoDirecto(e)},filtrarPorProveedor(e){this.filtroProveedor===e?this.filtroProveedor="":this.filtroProveedor=e,this.paginaActual=1,window.scrollTo({top:0,behavior:"smooth"})},async agregarProductoDirecto(e){try{this.guardando=!0;const a=await Object(s["b"])(Object(s["c"])(i["a"],"deudas",this.deudaSeleccionada.id,"productos"),{kilos:e.kilos,producto:e.producto,precio:e.precio,total:e.total});this.productos.push({id:a.id,kilos:e.kilos,producto:e.producto,precio:e.precio,total:e.total,editando:!1,campoEditando:null});const t=this.productos.reduce((e,a)=>e+a.total,0),o=t-this.totalAbonos;await Object(s["s"])(Object(s["e"])(i["a"],"deudas",this.deudaSeleccionada.id),{total:t,saldoPendiente:o,estado:o<=0?"pagado":"pendiente"}),this.deudaSeleccionada.total=t,this.deudaSeleccionada.saldoPendiente=o,this.deudaSeleccionada.estado=o<=0?"pagado":"pendiente",this.deudas=this.deudas.map(e=>e.id===this.deudaSeleccionada.id?{...e,total:t,saldoPendiente:o,estado:o<=0?"pagado":"pendiente"}:e)}catch(a){console.error("Error al agregar producto: ",a),alert("Error al agregar producto: "+a.message)}finally{this.guardando=!1}}},watch:{filtroProveedor(){this.paginaActual=1},filtroEstado(){this.paginaActual=1},filtroFechaDesde(){this.paginaActual=1},filtroFechaHasta(){this.paginaActual=1}},async mounted(){await Promise.all([this.loadDeudas(),this.loadProveedores()])}},p=v,m=(t("ae67"),t("2877")),b=Object(m["a"])(p,o,r,!1,null,"90e0fa96",null);a["a"]=b.exports},ad3c:function(e,a,t){"use strict";t("2155")},ae67:function(e,a,t){"use strict";t("6f4f")},e524:function(e,a,t){"use strict";var o=function(){var e=this,a=e._self._c;return a("div",{staticClass:"bitacoras-container"},[a("h1",{staticClass:"page-title"},[e._v("BitÃ¡coras de Mantenimiento - Cuartos FrÃ­os")]),a("div",{staticClass:"filters-container"},[a("div",{staticClass:"filter-group"},[a("label",{attrs:{for:"cuarto-select"}},[e._v("Cuarto FrÃ­o:")]),a("select",{directives:[{name:"model",rawName:"v-model",value:e.filtrosCuarto,expression:"filtrosCuarto"}],staticClass:"form-control",attrs:{id:"cuarto-select"},on:{change:function(a){var t=Array.prototype.filter.call(a.target.options,(function(e){return e.selected})).map((function(e){var a="_value"in e?e._value:e.value;return a}));e.filtrosCuarto=a.target.multiple?t:t[0]}}},[a("option",{attrs:{value:""}},[e._v("Todos los cuartos")]),a("option",{attrs:{value:"1"}},[e._v("Cuarto FrÃ­o #1")]),a("option",{attrs:{value:"2"}},[e._v("Cuarto FrÃ­o #2")]),a("option",{attrs:{value:"3"}},[e._v("Cuarto FrÃ­o #3")]),a("option",{attrs:{value:"4"}},[e._v("Cuarto FrÃ­o #4")]),a("option",{attrs:{value:"5"}},[e._v("Cuarto FrÃ­o Don Chuy")])])]),a("div",{staticClass:"filter-group"},[a("label",{attrs:{for:"fecha-desde"}},[e._v("Desde:")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.filtroFechaDesde,expression:"filtroFechaDesde"}],staticClass:"form-control",attrs:{type:"date",id:"fecha-desde"},domProps:{value:e.filtroFechaDesde},on:{input:function(a){a.target.composing||(e.filtroFechaDesde=a.target.value)}}})]),a("div",{staticClass:"filter-group"},[a("label",{attrs:{for:"fecha-hasta"}},[e._v("Hasta:")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.filtroFechaHasta,expression:"filtroFechaHasta"}],staticClass:"form-control",attrs:{type:"date",id:"fecha-hasta"},domProps:{value:e.filtroFechaHasta},on:{input:function(a){a.target.composing||(e.filtroFechaHasta=a.target.value)}}})]),a("button",{staticClass:"btn-filtrar",on:{click:e.aplicarFiltros}},[a("i",{staticClass:"fas fa-filter"}),e._v(" Filtrar ")])]),a("div",{staticClass:"actions-row"},[a("button",{staticClass:"btn-nueva-bitacora",on:{click:function(a){e.mostrarFormulario=!0}}},[a("i",{staticClass:"fas fa-plus"}),e._v(" Nueva BitÃ¡cora ")])]),a("div",{staticClass:"table-responsive"},[a("table",{staticClass:"bitacoras-table"},[e._m(0),a("tbody",[e.cargando?a("tr",[a("td",{staticClass:"loading-data",attrs:{colspan:"7"}},[e._v("Cargando bitÃ¡coras...")])]):0===e.bitacoras.length?a("tr",[a("td",{staticClass:"no-data",attrs:{colspan:"7"}},[e._v("No hay bitÃ¡coras registradas")])]):e._e(),e._l(e.bitacorasFiltradas,(function(t,o){return a("tr",{key:t.id},[a("td",[e._v(e._s(e.formatearFecha(t.fecha)))]),a("td",[e._v(e._s(e.formatearNombreCuarto(t.cuartoId)))]),a("td",[e._v(e._s(t.temperatura)+"Â°C")]),a("td",[e._v(e._s(t.tecnico))]),a("td",[e._v(e._s(t.tipoMantenimiento))]),a("td",{class:"estado-"+t.estado.toLowerCase()},[e._v(e._s(t.estado))]),a("td",{staticClass:"acciones"},[a("button",{staticClass:"btn-accion editar",on:{click:function(a){return e.editarBitacora(t)}}},[a("i",{staticClass:"fas fa-edit"})]),a("button",{staticClass:"btn-accion ver",on:{click:function(a){return e.verDetalles(t)}}},[a("i",{staticClass:"fas fa-eye"})]),a("button",{staticClass:"btn-accion eliminar",on:{click:function(a){return e.confirmarEliminarBitacora(t)}}},[a("i",{staticClass:"fas fa-trash"})])])])}))],2)])]),e.mostrarFormulario?a("div",{staticClass:"modal-overlay"},[a("div",{staticClass:"modal-content"},[a("div",{staticClass:"modal-header"},[a("h2",[e._v(e._s(e.modoEdicion?"Editar BitÃ¡cora":"Nueva BitÃ¡cora"))]),a("button",{staticClass:"btn-cerrar",on:{click:e.cerrarFormulario}},[a("i",{staticClass:"fas fa-times"})])]),a("div",{staticClass:"modal-body"},[a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"cuarto"}},[e._v("Cuarto FrÃ­o:")]),a("select",{directives:[{name:"model",rawName:"v-model",value:e.bitacoraActual.cuartoId,expression:"bitacoraActual.cuartoId"}],staticClass:"form-control",attrs:{id:"cuarto",required:""},on:{change:function(a){var t=Array.prototype.filter.call(a.target.options,(function(e){return e.selected})).map((function(e){var a="_value"in e?e._value:e.value;return a}));e.$set(e.bitacoraActual,"cuartoId",a.target.multiple?t:t[0])}}},[a("option",{attrs:{value:"",disabled:""}},[e._v("Seleccione un cuarto frÃ­o")]),a("option",{attrs:{value:"1"}},[e._v("Cuarto FrÃ­o #1")]),a("option",{attrs:{value:"2"}},[e._v("Cuarto FrÃ­o #2")]),a("option",{attrs:{value:"3"}},[e._v("Cuarto FrÃ­o #3")]),a("option",{attrs:{value:"4"}},[e._v("Cuarto FrÃ­o #4")]),a("option",{attrs:{value:"5"}},[e._v("Cuarto FrÃ­o Don Chuy")])])]),a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"fecha"}},[e._v("Fecha:")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.bitacoraActual.fecha,expression:"bitacoraActual.fecha"}],staticClass:"form-control",attrs:{type:"date",id:"fecha",required:""},domProps:{value:e.bitacoraActual.fecha},on:{input:function(a){a.target.composing||e.$set(e.bitacoraActual,"fecha",a.target.value)}}})]),a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"temperatura"}},[e._v("Temperatura (Â°C):")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.bitacoraActual.temperatura,expression:"bitacoraActual.temperatura"}],staticClass:"form-control",attrs:{type:"number",id:"temperatura",step:"0.1",required:""},domProps:{value:e.bitacoraActual.temperatura},on:{input:function(a){a.target.composing||e.$set(e.bitacoraActual,"temperatura",a.target.value)}}})]),a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"tecnico"}},[e._v("TÃ©cnico:")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.bitacoraActual.tecnico,expression:"bitacoraActual.tecnico"}],staticClass:"form-control",attrs:{type:"text",id:"tecnico",required:""},domProps:{value:e.bitacoraActual.tecnico},on:{input:function(a){a.target.composing||e.$set(e.bitacoraActual,"tecnico",a.target.value)}}})]),a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"tipo-mantenimiento"}},[e._v("Tipo de Mantenimiento:")]),a("select",{directives:[{name:"model",rawName:"v-model",value:e.bitacoraActual.tipoMantenimiento,expression:"bitacoraActual.tipoMantenimiento"}],staticClass:"form-control",attrs:{id:"tipo-mantenimiento",required:""},on:{change:function(a){var t=Array.prototype.filter.call(a.target.options,(function(e){return e.selected})).map((function(e){var a="_value"in e?e._value:e.value;return a}));e.$set(e.bitacoraActual,"tipoMantenimiento",a.target.multiple?t:t[0])}}},[a("option",{attrs:{value:"",disabled:""}},[e._v("Seleccione tipo")]),a("option",{attrs:{value:"Preventivo"}},[e._v("Preventivo")]),a("option",{attrs:{value:"Correctivo"}},[e._v("Correctivo")]),a("option",{attrs:{value:"RevisiÃ³n"}},[e._v("RevisiÃ³n")])])]),a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"estado"}},[e._v("Estado:")]),a("select",{directives:[{name:"model",rawName:"v-model",value:e.bitacoraActual.estado,expression:"bitacoraActual.estado"}],staticClass:"form-control",attrs:{id:"estado",required:""},on:{change:function(a){var t=Array.prototype.filter.call(a.target.options,(function(e){return e.selected})).map((function(e){var a="_value"in e?e._value:e.value;return a}));e.$set(e.bitacoraActual,"estado",a.target.multiple?t:t[0])}}},[a("option",{attrs:{value:"",disabled:""}},[e._v("Seleccione estado")]),a("option",{attrs:{value:"Ã“ptimo"}},[e._v("Ã“ptimo")]),a("option",{attrs:{value:"Regular"}},[e._v("Regular")]),a("option",{attrs:{value:"Requiere AtenciÃ³n"}},[e._v("Requiere AtenciÃ³n")]),a("option",{attrs:{value:"CrÃ­tico"}},[e._v("CrÃ­tico")])])]),a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"observaciones"}},[e._v("Observaciones:")]),a("textarea",{directives:[{name:"model",rawName:"v-model",value:e.bitacoraActual.observaciones,expression:"bitacoraActual.observaciones"}],staticClass:"form-control",attrs:{id:"observaciones",rows:"4"},domProps:{value:e.bitacoraActual.observaciones},on:{input:function(a){a.target.composing||e.$set(e.bitacoraActual,"observaciones",a.target.value)}}})]),a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"acciones"}},[e._v("Acciones Realizadas:")]),a("textarea",{directives:[{name:"model",rawName:"v-model",value:e.bitacoraActual.accionesRealizadas,expression:"bitacoraActual.accionesRealizadas"}],staticClass:"form-control",attrs:{id:"acciones",rows:"4"},domProps:{value:e.bitacoraActual.accionesRealizadas},on:{input:function(a){a.target.composing||e.$set(e.bitacoraActual,"accionesRealizadas",a.target.value)}}})])]),a("div",{staticClass:"modal-footer"},[a("button",{staticClass:"btn-cancelar",on:{click:e.cerrarFormulario}},[e._v("Cancelar")]),a("button",{staticClass:"btn-guardar",attrs:{disabled:e.guardando},on:{click:e.guardarBitacora}},[e._v(" "+e._s(e.guardando?"Guardando...":"Guardar")+" ")])])])]):e._e(),e.mostrarDetalles?a("div",{staticClass:"modal-overlay"},[a("div",{staticClass:"modal-content"},[a("div",{staticClass:"modal-header"},[a("h2",[e._v("Detalles de BitÃ¡cora")]),a("button",{staticClass:"btn-cerrar",on:{click:function(a){e.mostrarDetalles=!1}}},[a("i",{staticClass:"fas fa-times"})])]),a("div",{staticClass:"modal-body detalles"},[a("div",{staticClass:"detalle-grupo"},[a("h3",[e._v("InformaciÃ³n General")]),a("p",[a("strong",[e._v("Cuarto FrÃ­o:")]),e._v(" "+e._s(e.formatearNombreCuarto(e.bitacoraDetalle.cuartoId)))]),a("p",[a("strong",[e._v("Fecha:")]),e._v(" "+e._s(e.formatearFecha(e.bitacoraDetalle.fecha)))]),a("p",[a("strong",[e._v("Temperatura:")]),e._v(" "+e._s(e.bitacoraDetalle.temperatura)+"Â°C")]),a("p",[a("strong",[e._v("TÃ©cnico:")]),e._v(" "+e._s(e.bitacoraDetalle.tecnico))])]),a("div",{staticClass:"detalle-grupo"},[a("h3",[e._v("Mantenimiento")]),a("p",[a("strong",[e._v("Tipo:")]),e._v(" "+e._s(e.bitacoraDetalle.tipoMantenimiento))]),a("p",[a("strong",[e._v("Estado:")]),e._v(" "),a("span",{class:"estado-tag estado-"+e.bitacoraDetalle.estado.toLowerCase()},[e._v(e._s(e.bitacoraDetalle.estado))])])]),a("div",{staticClass:"detalle-grupo"},[a("h3",[e._v("Observaciones")]),a("p",{staticClass:"texto-largo"},[e._v(e._s(e.bitacoraDetalle.observaciones||"Sin observaciones"))])]),a("div",{staticClass:"detalle-grupo"},[a("h3",[e._v("Acciones Realizadas")]),a("p",{staticClass:"texto-largo"},[e._v(e._s(e.bitacoraDetalle.accionesRealizadas||"Sin acciones registradas"))])])]),a("div",{staticClass:"modal-footer"},[a("button",{staticClass:"btn-cerrar-detalles",on:{click:function(a){e.mostrarDetalles=!1}}},[e._v("Cerrar")]),a("button",{staticClass:"btn-editar-detalles",on:{click:e.editarBitacoraDesdeDetalles}},[e._v("Editar")])])])]):e._e(),e.mostrarConfirmacionEliminar?a("div",{staticClass:"modal-overlay"},[a("div",{staticClass:"modal-content modal-confirmacion"},[a("div",{staticClass:"modal-header"},[a("h2",[e._v("Confirmar EliminaciÃ³n")]),a("button",{staticClass:"btn-cerrar",on:{click:function(a){e.mostrarConfirmacionEliminar=!1}}},[a("i",{staticClass:"fas fa-times"})])]),a("div",{staticClass:"modal-body"},[a("p",{staticClass:"mensaje-confirmacion"},[e._v(" Â¿EstÃ¡ seguro que desea eliminar la bitÃ¡cora del "+e._s(e.formatearFecha(e.bitacoraEliminar.fecha))+" para el "+e._s(e.formatearNombreCuarto(e.bitacoraEliminar.cuartoId))+"? ")]),a("p",{staticClass:"advertencia"},[e._v("Esta acciÃ³n no se puede deshacer.")])]),a("div",{staticClass:"modal-footer"},[a("button",{staticClass:"btn-cancelar",on:{click:function(a){e.mostrarConfirmacionEliminar=!1}}},[e._v("Cancelar")]),a("button",{staticClass:"btn-eliminar",attrs:{disabled:e.eliminando},on:{click:e.eliminarBitacora}},[e._v(" "+e._s(e.eliminando?"Eliminando...":"Eliminar")+" ")])])])]):e._e()])},r=[function(){var e=this,a=e._self._c;return a("thead",[a("tr",[a("th",[e._v("Fecha")]),a("th",[e._v("Cuarto FrÃ­o")]),a("th",[e._v("Temperatura")]),a("th",[e._v("TÃ©cnico")]),a("th",[e._v("Tipo de Mantenimiento")]),a("th",[e._v("Estado")]),a("th",[e._v("Acciones")])])])}],i=(t("d9e2"),t("dc59")),s=t("1494"),n={name:"Bitacoras",data(){return{bitacoras:[],mostrarFormulario:!1,mostrarDetalles:!1,mostrarConfirmacionEliminar:!1,modoEdicion:!1,bitacoraActual:this.inicializarBitacora(),bitacoraDetalle:{},bitacoraEliminar:{},filtrosCuarto:"",filtroFechaDesde:"",filtroFechaHasta:"",cargando:!0,guardando:!1,eliminando:!1}},computed:{bitacorasFiltradas(){let e=[...this.bitacoras];return this.filtrosCuarto&&(e=e.filter(e=>e.cuartoId.toString()===this.filtrosCuarto)),this.filtroFechaDesde&&(e=e.filter(e=>new Date(e.fecha)>=new Date(this.filtroFechaDesde))),this.filtroFechaHasta&&(e=e.filter(e=>new Date(e.fecha)<=new Date(this.filtroFechaHasta))),e.sort((e,a)=>new Date(a.fecha)-new Date(e.fecha))}},created(){this.cargarBitacoras()},methods:{inicializarBitacora(){return{id:null,cuartoId:"",fecha:(new Date).toISOString().substr(0,10),temperatura:"",tecnico:"",tipoMantenimiento:"",estado:"",observaciones:"",accionesRealizadas:"",createdAt:null,updatedAt:null}},async cargarBitacoras(){this.cargando=!0;try{const e=Object(s["c"])(i["a"],"bitacoras"),a=Object(s["o"])(e,Object(s["l"])("fecha","desc")),t=await Object(s["g"])(a);this.bitacoras=t.docs.map(e=>{const a=e.data(),t=e.id.toString();return console.log("Cargando bitÃ¡cora con ID: "+t),{id:t,cuartoId:a.cuartoId||"",fecha:a.fecha||(new Date).toISOString().substr(0,10),temperatura:a.temperatura||0,tecnico:a.tecnico||"",tipoMantenimiento:a.tipoMantenimiento||"",estado:a.estado||"",observaciones:a.observaciones||"",accionesRealizadas:a.accionesRealizadas||"",createdAt:a.createdAt||null,updatedAt:a.updatedAt||null}}),console.log(`Se cargaron ${this.bitacoras.length} bitÃ¡coras`)}catch(e){console.error("Error al cargar bitÃ¡coras:",e),alert("Error al cargar las bitÃ¡coras: "+(e.message||"Error desconocido"))}finally{this.cargando=!1}},formatearFecha(e){if(!e)return"";const a={year:"numeric",month:"long",day:"numeric"};return new Date(e).toLocaleDateString("es-ES",a)},formatearNombreCuarto(e){return e?"5"===e?"Cuarto FrÃ­o Don Chuy":"Cuarto FrÃ­o #"+e:""},aplicarFiltros(){},editarBitacora(e){this.modoEdicion=!0,this.bitacoraActual={...e},this.mostrarFormulario=!0},verDetalles(e){this.bitacoraDetalle={...e},this.mostrarDetalles=!0},cerrarFormulario(){this.mostrarFormulario=!1,this.modoEdicion=!1,this.bitacoraActual=this.inicializarBitacora(),this.guardando=!1},async guardarBitacora(){if(this.validarFormulario()){this.guardando=!0;try{const e={...this.bitacoraActual,cuartoId:this.bitacoraActual.cuartoId.toString(),temperatura:parseFloat(this.bitacoraActual.temperatura)||0,tecnico:this.bitacoraActual.tecnico.trim(),tipoMantenimiento:this.bitacoraActual.tipoMantenimiento,estado:this.bitacoraActual.estado,observaciones:this.bitacoraActual.observaciones||"",accionesRealizadas:this.bitacoraActual.accionesRealizadas||"",updatedAt:Object(s["q"])()};if(this.modoEdicion){if(!e.id)throw new Error("ID de bitÃ¡cora no vÃ¡lido para actualizaciÃ³n");console.log("Actualizando bitÃ¡cora con ID:",e.id);const{id:a,...t}=e,o=Object(s["e"])(i["a"],"bitacoras",a.toString());await Object(s["s"])(o,t);const r=this.bitacoras.findIndex(e=>e.id===a);-1!==r&&this.bitacoras.splice(r,1,e),console.log("BitÃ¡cora actualizada con Ã©xito")}else{e.createdAt=Object(s["q"])(),console.log("Creando nueva bitÃ¡cora");const a=await Object(s["b"])(Object(s["c"])(i["a"],"bitacoras"),e),t={...e,id:a.id.toString()};console.log("Nueva bitÃ¡cora creada con ID:",t.id),this.bitacoras.unshift(t)}this.cerrarFormulario(),alert(this.modoEdicion?"BitÃ¡cora actualizada con Ã©xito":"BitÃ¡cora creada con Ã©xito")}catch(e){console.error("Error al guardar bitÃ¡cora:",e),alert("Error al guardar la bitÃ¡cora: "+(e.message||"Error desconocido"))}finally{this.guardando=!1}}},validarFormulario(){return!!(this.bitacoraActual.cuartoId&&this.bitacoraActual.fecha&&""!==this.bitacoraActual.temperatura&&this.bitacoraActual.tecnico&&this.bitacoraActual.tipoMantenimiento&&this.bitacoraActual.estado)||(alert("Por favor complete todos los campos obligatorios"),!1)},editarBitacoraDesdeDetalles(){this.editarBitacora(this.bitacoraDetalle),this.mostrarDetalles=!1},confirmarEliminarBitacora(e){if(!e||!e.id)return console.error("Intento de eliminar una bitÃ¡cora sin ID vÃ¡lido:",e),void alert("No se puede eliminar esta bitÃ¡cora porque no tiene un ID vÃ¡lido");console.log("Preparando eliminaciÃ³n de bitÃ¡cora con ID:",e.id),this.bitacoraEliminar={...e},this.mostrarConfirmacionEliminar=!0},async eliminarBitacora(){this.eliminando=!0;try{if(!this.bitacoraEliminar||!this.bitacoraEliminar.id)throw new Error("ID de bitÃ¡cora no vÃ¡lido");const e=this.bitacoraEliminar.id.toString();console.log("Intentando eliminar bitÃ¡cora con ID:",e);const a=Object(s["e"])(i["a"],"bitacoras",e);await Object(s["d"])(a);const t=this.bitacoras.findIndex(a=>a.id===e);-1!==t&&this.bitacoras.splice(t,1),this.mostrarConfirmacionEliminar=!1,alert("BitÃ¡cora eliminada con Ã©xito")}catch(e){console.error("Error al eliminar bitÃ¡cora:",e),alert("Error al eliminar la bitÃ¡cora: "+(e.message||"Error desconocido"))}finally{this.eliminando=!1,this.bitacoraEliminar={}}}}},d=n,c=(t("05e4"),t("2877")),l=Object(c["a"])(d,o,r,!1,null,"fc24882a",null);a["a"]=l.exports},f740:function(e,a,t){"use strict";t("03df")}}]);