(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["app.9e722cdc"],{fa40:function(e,a,t){"use strict";t("d9e2"),t("14d9"),t("13d5");var o=t("1494");t("fa1c");const r=e=>{if(!e)return"";let a=e.toLowerCase();a=a.trim();const t=a.includes("c/c"),o=a.includes("s/c");let r="";return t?(r="c/c",a=a.replace(/c\/c|cc|conc/g,"").trim()):o&&(r="s/c",a=a.replace(/s\/c|sc|sinc/g,"").trim()),a=a.replace(/-/g," "),a.includes("med")&&(a.includes("gde")||a.includes("grande"))&&(a="med gde"),a.includes("med")&&(a.includes("ch")||a.includes("chica"))&&(a="med ch"),a.includes("med")&&(a.includes("esp")||a.includes("especial"))&&(a="med esp"),a.includes("med gde")||a.includes("med ch")||a.includes("med esp")||(a=a.replace(/\s+/g,"")),a=a.replace(/-/g,"/"),r&&(a=`${a} ${r}`),a=a.replace(/c\/c|cc|conc/g,"c/c"),a=a.replace(/s\/c|sc|sinc/g,"s/c"),a.includes("med gde")||a.includes("med ch")||a.includes("med esp")||(a=a.replace(/^medium$|^med$/g,"med")),a=a.replace(/^grande$|^gde$/g,"gde"),a=a.replace(/^especial$|^esp$/g,"esp"),a},c=(e,a,t=!1)=>{if(!e)return a;const o=e.toLowerCase().trim(),r=/^(\d+)-(\d+)$/.exec(o);if(r){const e=parseInt(r[1])||0,a=parseInt(r[2])||0,o=19!==a||t?a:20,c=e*o;return c}const c=o.includes("crudo");if(c&&/^\d+\*\d+(\+\d+)?$/.test(o)){const e=o.split(/[\*\+]/);if(e.length>=2){const a=parseInt(e[0])||0,t=parseInt(e[1])||0,o=19===t?20:t;let r=0;e.length>2&&(r=parseInt(e[2])||0);const c=a*o+r;return c}}return a},s=async(e,a)=>{try{const t=Object(o["h"])(),r=Object(o["c"])(t,e),c=Object(o["o"])(r,Object(o["s"])("fecha","<",a)),s=await Object(o["g"])(c);if(s.empty)return console.log("No se encontraron cuentas anteriores"),0;const n=s.docs.map(e=>{const a=e.data();return{id:e.id,fecha:a.fecha,nuevoSaldoAcumulado:a.nuevoSaldoAcumulado||0}}).sort((e,a)=>new Date(a.fecha)-new Date(e.fecha));return n.length>0?n[0].nuevoSaldoAcumulado:0}catch(t){return console.error("Error al obtener saldo acumulado anterior:",t),0}},n=async(e,a)=>{try{const t=Object(o["h"])(),r=Object(o["c"])(t,e),c=Object(o["o"])(r,Object(o["s"])("fecha","==",a)),s=await Object(o["g"])(c);return!s.empty}catch(t){throw console.error("Error al verificar si existe cuenta para la fecha:",t),t}},i=async e=>{try{const a=Object(o["h"])(),t=Object(o["c"])(a,"precios"),c=Object(o["o"])(t,Object(o["l"])("fecha","desc")),s=await Object(o["g"])(c),n=new Map,i=new Map,l=[];s.docs.forEach(a=>{const t=a.data(),o=t.producto,c=r(t.producto);l.push({original:o,normalizada:c,precio:t.precio,clienteId:t.clienteId||"general"}),t.clienteId===e?i.has(c)||i.set(c,t.precio):t.clienteId||n.has(c)||n.set(c,t.precio)}),console.log("=== Normalización de medidas para precios ==="),console.log("Medidas específicas para",e,":",Array.from(i.entries())),console.log("Medidas generales:",Array.from(n.entries())),console.log("Detalles de normalización:",l);const d=["Med c/c","Med-gde c/c","Med Gde c/c","MedGde c/c","Med-Esp c/c","Med Esp c/c"];console.log("=== Casos de prueba de normalización ==="),d.forEach(e=>{const a=r(e),t=i.get(a)||n.get(a)||0;console.log(`${e} -> ${a} -> Precio: ${t}`)});const u=new Map([...n,...i]);return u}catch(a){return console.error("Error al obtener precios de venta:",a),new Map}},l=e=>{if(!e)return 0;if(e.includes("-")){const a=e.split("-");if(2===a.length)return parseInt(a[1])||0}return parseInt(e)||0},d=(e,a={},t=new Map)=>{if(!e||!Array.isArray(e))return[];const o=new Map;return e.forEach(e=>{if(!e.medida)return;const a=r(e.medida);let s=0;if("c/h20"===e.tipo){const a=e.reporteTaras||[],t=e.reporteBolsas||[];for(let e=0;e<a.length;e++){const o=parseInt(a[e])||0,r=parseInt(t[e])||0;s+=o*r}s*=e.camaronNeto||.65}else if(s=Array.isArray(e.kilos)?e.kilos.reduce((e,a)=>e+(Number(a)||0),0):Number(e.kilos)||0,e.restarTaras){const a=(e.taras||[]).reduce((e,a)=>e+(Number(a)||0),0);s-=3*a}const n=e.precio||e.costo||0,i=t.get(a)||e.precioVenta||n,l=c(e.medida,s,!0);if(o.has(a)){const e=o.get(a);e.kilos+=l,e.costo=n,e.precioVenta=i,e.total=e.kilos*e.costo}else o.set(a,{kilos:l,medida:e.medida,costo:n,precioVenta:i,total:l*n})}),a&&Object.values(a).forEach(e=>{e.forEach(e=>{e.items&&Array.isArray(e.items)&&e.items.forEach(e=>{if(!e.talla)return;const a=e.talla,c=r(a);let s=0;if(e.taras){const a=e.taras.split("-");if(2===a.length){const e=parseInt(a[0])||0,t=parseInt(a[1])||0;s=e*t}else s=parseInt(e.taras)||0}let n=0;e.sobrante&&e.mostrarSobrante&&(n=l(e.sobrante));const i=a.toLowerCase().includes("med c/c")&&"10-19"===e.taras&&"1-10"===e.sobrante,d=i?200:s+n,u=e.precio||0,p=t.get(c)||e.precioVenta||u;if(o.has(c)){const a=o.get(c);a.kilos+=d,e.precio&&(a.costo=u,a.precioVenta=p),a.total=a.kilos*a.costo}else o.set(c,{kilos:d,medida:a,costo:u,precioVenta:p,total:d*u,esCrudo:!0})})})}),Array.from(o.values())},u=(e,a={},t=new Map)=>{if(!e||!Array.isArray(e))return[];const o=d(e,a,t),s=new Map;e.forEach(e=>{if(!e.medida)return;const a=r(e.medida);let o=0;if("c/h20"===e.tipo){const a=e.reporteTaras||[],t=e.reporteBolsas||[];for(let e=0;e<a.length;e++){const r=parseInt(a[e])||0,c=parseInt(t[e])||0;o+=r*c}o*=e.camaronNeto||.65}else if(o=Array.isArray(e.kilos)?e.kilos.reduce((e,a)=>e+(Number(a)||0),0):Number(e.kilos)||0,e.restarTaras){const a=(e.taras||[]).reduce((e,a)=>e+(Number(a)||0),0);o-=3*a}const n=t.get(a)||e.precioVenta||e.precio||0,i=c(e.medida,o,!1);if(s.has(a)){const e=s.get(a);e.kilosVenta+=i,e.precioVenta=n,e.totalVenta=e.kilosVenta*e.precioVenta}else s.set(a,{kilosVenta:i,medida:e.medida,precioVenta:n,totalVenta:i*n,ganancia:0})}),a&&Object.values(a).forEach(e=>{e.forEach(e=>{e.items&&Array.isArray(e.items)&&e.items.forEach(e=>{if(!e.talla)return;const a=e.talla,o=r(a);let c=0;if(e.taras){const a=e.taras.split("-");if(2===a.length){const e=parseInt(a[0])||0;let t=parseInt(a[1])||0;19===t&&(t=20),c=e*t}else c=parseInt(e.taras)||0}let n=0;e.sobrante&&e.mostrarSobrante&&(n=l(e.sobrante));const i=a.toLowerCase().includes("med c/c")&&"10-19"===e.taras&&"1-10"===e.sobrante,d=i?210:c+n,u=t.get(o)||e.precioVenta||e.precio||0;if(s.has(o)){const a=s.get(o);a.kilosVenta+=d,e.precio&&(a.precioVenta=u),a.totalVenta=a.kilosVenta*a.precioVenta}else s.set(o,{kilosVenta:d,medida:a,precioVenta:u,totalVenta:d*u,ganancia:0,esCrudo:!0})})})});const n=Array.from(s.values());return n.forEach(e=>{const a=o.find(a=>r(a.medida)===r(e.medida));a&&(e.ganancia=e.totalVenta-a.total)}),n},p=async e=>{const{fecha:a,productos:t,clienteCrudos:o}=e,r=o&&o["1"]||[],c=await i("joselito"),n=d(t,{1:r},c),l=u(t,{1:r},c),p=n.reduce((e,a)=>e+(a.total||0),0),m=l.reduce((e,a)=>e+(a.totalVenta||0),0),f=await s("cuentasJoselito",a);return{fecha:a,items:n,itemsVenta:l,saldoAcumuladoAnterior:f,cobros:[],abonos:[],totalGeneral:p,totalGeneralVenta:m,nuevoSaldoAcumulado:f+m,estadoPagado:!1,tieneObservacion:!1,observacion:"",ultimaActualizacion:(new Date).toISOString()}},m=async e=>{const{fecha:a,productos:t,clienteCrudos:o}=e,n=o&&o["2"]||[],d=await i("catarro"),u=[],p=[];Array.isArray(t)&&t.forEach(e=>{if(e){let o=0;if("c/h20"===e.tipo){const a=e.reporteTaras||[],t=e.reporteBolsas||[];let r=0;for(let e=0;e<a.length;e++){const o=parseInt(a[e])||0,c=parseInt(t[e])||0;r+=o*c}o=r*(e.camaronNeto||.65)}else{var a,t;const r=(null===(a=e.kilos)||void 0===a?void 0:a.reduce((e,a)=>e+(parseFloat(a)||0),0))||0,c=(null===(t=e.taras)||void 0===t?void 0:t.reduce((e,a)=>e+(parseInt(a)||0),0))||0,s=e.restarTaras?3*c:0;o=Number((r-s).toFixed(1))}let s=e.nombreAlternativoPDF||e.medida||"";const n=r(s),i=e.precio||e.costo||0,l=d.get(n)||e.precioVenta||i,m=c(s,o,!0),f=c(s,o,!1);o>0&&(u.push({kilos:m,medida:s,costo:i,total:m*i}),p.push({kilosVenta:f,medida:s,precioVenta:l,totalVenta:f*l,ganancia:f*l-m*i}))}}),Array.isArray(n)&&n.forEach(e=>{e&&Array.isArray(e.items)&&e.items.forEach(e=>{if(e){let a=0;if(e.taras){const t=/^(\d+)-(\d+)$/.exec(e.taras);if(t){const e=parseInt(t[1])||0;let o=parseInt(t[2])||0;a=e*o}else a=parseInt(e.taras)||0}let t=0;e.sobrante&&e.mostrarSobrante&&(t=l(e.sobrante));const o=(e.talla||"").toLowerCase().includes("med c/c")&&"10-19"===e.taras&&"1-10"===e.sobrante,c=o?200:a+t,s=e.talla||"Crudo",n=r(s),i=e.precio||0,m=d.get(n)||e.precioVenta||i;let f=0;if(e.taras){const a=/^(\d+)-(\d+)$/.exec(e.taras);if(a){const e=parseInt(a[1])||0;let t=parseInt(a[2])||0;19===t&&(t=20),f=e*t}else f=parseInt(e.taras)||0}let h=0;e.sobrante&&e.mostrarSobrante&&(h=l(e.sobrante));const g=o?210:f+h;c>0&&(u.push({kilos:c,medida:s,costo:i,total:c*i,esCrudo:!0}),p.push({kilosVenta:g,medida:s,precioVenta:m,totalVenta:g*m,ganancia:g*m-c*i,esCrudo:!0}))}})});const m=u.reduce((e,a)=>e+(a.total||0),0),f=p.reduce((e,a)=>e+(a.totalVenta||0),0),h=await s("cuentasCatarro",a);return{fecha:a,items:u,itemsVenta:p,saldoAcumuladoAnterior:h,cobros:[],abonos:[],totalGeneral:m,totalGeneralVenta:f,nuevoSaldoAcumulado:h+f,estadoPagado:!1,tieneObservacion:!1,observacion:"",ultimaActualizacion:(new Date).toISOString()}},f=async(e,a)=>{try{console.log("Iniciando creación de cuenta Joselito desde embarque");const t=await n("cuentasJoselito",e.fecha);if(t)throw new Error("Ya existe una cuenta de Joselito registrada para esta fecha.");const r=await p(e),c=Object(o["h"])(),s=await Object(o["b"])(Object(o["c"])(c,"cuentasJoselito"),r);if(console.log("Cuenta de Joselito creada con ID:",s.id),a){const e=`${window.location.origin}/cuentas-joselito/${s.id}?edit=true`;window.open(e,"_blank")}return s.id}catch(t){throw console.error("Error al crear cuenta de Joselito:",t),t}},h=async(e,a)=>{try{console.log("Iniciando creación de cuenta Catarro desde embarque");const t=await n("cuentasCatarro",e.fecha);if(t)throw new Error("Ya existe una cuenta de Catarro registrada para esta fecha.");const r=await m(e),c=Object(o["h"])(),s=await Object(o["b"])(Object(o["c"])(c,"cuentasCatarro"),r);if(console.log("Cuenta de Catarro creada con ID:",s.id),a){const e=`${window.location.origin}/cuentas-catarro/${s.id}?edit=true`;window.open(e,"_blank")}return s.id}catch(t){throw console.error("Error al crear cuenta de Catarro:",t),t}},g=async e=>{const{fecha:a,productos:t,clienteCrudos:o}=e,c=o&&o["4"]||[],n=await i("ozuna"),l=[];Array.isArray(t)&&t.forEach(e=>{if(e){let o=0;if("c/h20"===e.tipo){const a=e.reporteTaras||[],t=e.reporteBolsas||[];let r=0;for(let e=0;e<a.length;e++){const o=parseInt(a[e])||0,c=parseInt(t[e])||0;r+=o*c}o=r*(e.camaronNeto||.65)}else{var a,t;const r=(null===(a=e.kilos)||void 0===a?void 0:a.reduce((e,a)=>e+(parseFloat(a)||0),0))||0,c=(null===(t=e.taras)||void 0===t?void 0:t.reduce((e,a)=>e+(parseInt(a)||0),0))||0,s=e.restarTaras?3*c:0;o=Number((r-s).toFixed(1))}const c=e.medida||"";let s=0;if(e.esVenta){const a=r(c),t=n.get(a);s=parseFloat(e.precio)||t||0}else s=20;o>0&&l.push({kilos:o,medida:c,costo:s,total:o*s,esVenta:e.esVenta||!1,editando:!1,campoEditando:null})}}),Array.isArray(c)&&c.forEach(e=>{e&&Array.isArray(e.items)&&e.items.forEach(e=>{if(e){let a=0;if(e.taras){const t=/^(\d+)-(\d+)$/.exec(e.taras);if(t){const e=parseInt(t[1])||0;let o=parseInt(t[2])||0;19===o&&(o=20),a+=e*o}else{const t=e.taras.split("-").map(Number);if(t.length>=2){let e=t[1]||0;19===e&&(e=20),a+=(t[0]||0)*e}}}if(e.sobrante){const t=/^(\d+)-(\d+)$/.exec(e.sobrante);if(t){const e=parseInt(t[1])||0;let o=parseInt(t[2])||0;19===o&&(o=20),a+=e*o}else{const t=e.sobrante.split("-").map(Number);if(t.length>=2){let e=t[1]||0;19===e&&(e=20),a+=(t[0]||0)*e}}}const t=a,o=e.medida||e.talla||"Crudo",c=r(o),s=n.get(c),i=parseFloat(e.precio)||s||0;t>0&&l.push({kilos:t,medida:o,costo:i,total:t*i,esVenta:!0,editando:!1,campoEditando:null})}})});const d=l.reduce((e,a)=>e+(a.total||0),0),u=await s("cuentasOzuna",a);return{fecha:a,items:l,saldoAcumuladoAnterior:u,cobros:[],abonos:[],totalGeneral:d,totalSaldo:u+d,nuevoSaldoAcumulado:u+d,ultimaActualizacion:(new Date).toISOString()}},b=async(e,a)=>{try{console.log("Iniciando creación de cuenta Ozuna desde embarque");const t=await n("cuentasOzuna",e.fecha);if(t)throw new Error("Ya existe una cuenta de Ozuna registrada para esta fecha.");const r=await g(e),c=Object(o["h"])(),s=await Object(o["b"])(Object(o["c"])(c,"cuentasOzuna"),r);if(console.log("Cuenta de Ozuna creada con ID:",s.id),a){const e=`${window.location.origin}/cuentas-ozuna/${s.id}?edit=true`;window.open(e,"_blank")}return s.id}catch(t){throw console.error("Error al crear cuenta de Ozuna:",t),t}};a["a"]={crearCuentaJoselito:f,crearCuentaCatarro:h,crearCuentaOzuna:b}}}]);