(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["app.e73b60ec"],{"03c4":function(e,t,a){"use strict";var o=function(){var e=this,t=e._self._c;return t("div",{staticClass:"precio-cliente-button-container"},[t("PreciosHistorialModal",{attrs:{clienteActual:e.clienteId}})],1)},r=[],i=a("666c"),s={name:"PreciosClienteButton",components:{PreciosHistorialModal:i["a"]},props:{clienteId:{type:String,required:!0}}},n=s,c=(a("f971"),a("2877")),l=Object(c["a"])(n,o,r,!1,null,"76dcdc36",null);t["a"]=l.exports},"0836":function(e,t,a){},"0b8c":function(e,t,a){"use strict";var o=function(){var e=this,t=e._self._c;return e.mostrar?t("div",{staticClass:"modal-overlay"},[t("div",{staticClass:"modal-content"},[t("h3",[e._v("Nuevo Cliente Temporal")]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"nombreCliente"}},[e._v("Nombre del Cliente:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.nombreCliente,expression:"nombreCliente"}],staticClass:"input-field",attrs:{type:"text",id:"nombreCliente",placeholder:"Ingrese el nombre del cliente"},domProps:{value:e.nombreCliente},on:{input:function(t){t.target.composing||(e.nombreCliente=t.target.value)}}})]),t("div",{staticClass:"buttons-container"},[t("button",{staticClass:"btn-guardar",attrs:{disabled:!e.nombreCliente.trim()},on:{click:e.guardarCliente}},[e._v(" Guardar ")]),t("button",{staticClass:"btn-cancelar",on:{click:function(t){return e.$emit("cerrar")}}},[e._v(" Cancelar ")])])])]):e._e()},r=[],i={name:"NuevoClienteModal",props:{mostrar:{type:Boolean,required:!0}},data(){return{nombreCliente:""}},methods:{guardarCliente(){this.nombreCliente.trim()&&(this.$emit("guardar",{id:this.nombreCliente.toLowerCase().replace(/\s+/g,"-"),nombre:this.nombreCliente.trim()}),this.nombreCliente="")}}},s=i,n=(a("5617"),a("2877")),c=Object(n["a"])(s,o,r,!1,null,"ea897a92",null);t["a"]=c.exports},1155:function(e,t,a){"use strict";var o=function(){var e=this,t=e._self._c;return t("div",{staticClass:"gestionar-productos-container"},[t("div",{staticClass:"back-button-container"},[t("BackButton",{attrs:{to:"/sacadas"}})],1),t("h1",[e._v("Gestión de Productos")]),t("div",{staticClass:"actions-container"},[t("router-link",{staticClass:"action-button",attrs:{to:"/gestionar-medidas"}},[e._v(" Gestionar Medidas ")]),t("router-link",{staticClass:"action-button",attrs:{to:"/gestionar-proveedores"}},[e._v(" Gestionar Proveedores ")])],1),t("div",{staticClass:"modify-product-form"},[t("h2",[e._v("Modificar Existencia de Producto")]),t("form",{on:{submit:function(t){return t.preventDefault(),e.modifyProduct.apply(null,arguments)}}},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"tipo"}},[e._v("Tipo:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:e.modifyProductData.tipo,expression:"modifyProductData.tipo"}],attrs:{id:"tipo",required:""},on:{change:function(t){var a=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(e.modifyProductData,"tipo",t.target.multiple?a:a[0])}}},[t("option",{attrs:{value:"proveedor"}},[e._v("Proveedor")]),t("option",{attrs:{value:"maquila"}},[e._v("Maquila")])])]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"proveedor"}},[e._v("Proveedor/Maquila:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:e.modifyProductData.proveedor,expression:"modifyProductData.proveedor"}],attrs:{id:"proveedor",required:""},on:{change:function(t){var a=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(e.modifyProductData,"proveedor",t.target.multiple?a:a[0])}}},[t("option",{attrs:{value:""}},[e._v("Seleccione un proveedor/maquila")]),e._l(e.proveedoresFiltrados,(function(a){return t("option",{key:a.id,domProps:{value:a.nombre}},[e._v(" "+e._s(a.nombre)+" ")])}))],2)]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"medida"}},[e._v("Medida:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:e.modifyProductData.medida,expression:"modifyProductData.medida"}],attrs:{id:"medida",required:""},on:{change:function(t){var a=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(e.modifyProductData,"medida",t.target.multiple?a:a[0])}}},[t("option",{attrs:{value:""}},[e._v("Seleccione una medida")]),e._l(e.medidasFiltradas,(function(a){return t("option",{key:a.id,domProps:{value:a.nombre}},[e._v(" "+e._s(a.nombre)+" ")])}))],2)]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"kilos"}},[e._v("Kilos:")]),t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.modifyProductData.kilos,expression:"modifyProductData.kilos",modifiers:{number:!0}}],attrs:{id:"kilos",type:"number",step:"0.1",required:""},domProps:{value:e.modifyProductData.kilos},on:{input:function(t){t.target.composing||e.$set(e.modifyProductData,"kilos",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"operacion"}},[e._v("Operación:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:e.modifyProductData.operacion,expression:"modifyProductData.operacion"}],attrs:{id:"operacion",required:""},on:{change:function(t){var a=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(e.modifyProductData,"operacion",t.target.multiple?a:a[0])}}},[t("option",{attrs:{value:"sumar"}},[e._v("Sumar")]),t("option",{attrs:{value:"restar"}},[e._v("Restar")])])]),t("button",{staticClass:"submit-btn",attrs:{type:"submit"}},[e._v("Modificar Existencia")])])]),t("div",{staticClass:"products-list"},[t("h2",[e._v("Existencias Actuales")]),t("ul",e._l(e.existencias,(function(a,o){return t("li",{key:o},[t("strong",[e._v(e._s(o))]),t("ul",e._l(a,(function(a,o){return t("li",{key:o},[e._v(" "+e._s(o)+" - "+e._s(e.formatNumber(a))+" kg ")])})),0)])})),0)]),t("router-link",{staticClass:"back-btn",attrs:{to:"/sacadas"}},[e._v("Volver al Menú de Sacadas")])],1)},r=[],i=(a("14d9"),a("2b0e")),s=a("dc59"),n=a("1494"),c=a("74c9"),l={name:"GestionarProductos",components:{BackButton:c["a"]},setup(){const e=Object(i["ref"])({}),t=Object(i["ref"])([]),a=Object(i["ref"])([]),o=Object(i["ref"])({tipo:"proveedor",proveedor:"",medida:"",kilos:null,operacion:"sumar"}),r=async()=>{try{const t=await Object(n["g"])(Object(n["c"])(s["a"],"sacadas")),a={};t.forEach(e=>{const t=e.data();t.entradas.forEach(e=>{a[e.proveedor]||(a[e.proveedor]={}),a[e.proveedor][e.medida]||(a[e.proveedor][e.medida]=0),a[e.proveedor][e.medida]+=e.kilos}),t.salidas.forEach(e=>{a[e.proveedor]||(a[e.proveedor]={}),a[e.proveedor][e.medida]||(a[e.proveedor][e.medida]=0),a[e.proveedor][e.medida]-=e.kilos})}),Object.keys(a).forEach(e=>{a[e]=Object.fromEntries(Object.entries(a[e]).filter(([e,t])=>t>0))}),e.value=a}catch(t){console.error("Error al cargar existencias: ",t)}},c=async()=>{try{const e=await Object(n["g"])(Object(n["c"])(s["a"],"medidas"));t.value=e.docs.map(e=>({id:e.id,...e.data()}))}catch(e){console.error("Error al cargar medidas: ",e)}},l=async()=>{try{const e=await Object(n["g"])(Object(n["c"])(s["a"],"proveedores"));a.value=e.docs.map(e=>({id:e.id,...e.data()}))}catch(e){console.error("Error al cargar proveedores: ",e)}},d=async()=>{try{const{proveedor:e,medida:t,kilos:a,operacion:i}=o.value,c={fecha:new Date,entradas:[],salidas:[]};"sumar"===i?c.entradas.push({proveedor:e,medida:t,kilos:a}):c.salidas.push({proveedor:e,medida:t,kilos:a}),await Object(n["b"])(Object(n["c"])(s["a"],"sacadas"),c),alert("Existencia modificada con éxito"),o.value={tipo:"proveedor",proveedor:"",medida:"",kilos:null,operacion:"sumar"},r()}catch(e){console.error("Error al modificar producto: ",e),alert("Error al modificar la existencia del producto")}},u=e=>e.toLocaleString("en-US",{minimumFractionDigits:1,maximumFractionDigits:1}),v=Object(i["computed"])(()=>a.value.filter(e=>"proveedor"===o.value.tipo?"maquila"!==e.tipo:"maquila"===e.tipo)),m=Object(i["computed"])(()=>t.value.filter(e=>"proveedor"===o.value.tipo?"general"===e.tipo:"maquila"===e.tipo));return Object(i["onMounted"])(()=>{r(),c(),l()}),{existencias:e,medidas:t,proveedores:a,modifyProductData:o,modifyProduct:d,formatNumber:u,proveedoresFiltrados:v,medidasFiltradas:m}}},d=l,u=(a("e6b2"),a("2877")),v=Object(u["a"])(d,o,r,!1,null,"67f08a69",null);t["a"]=v.exports},"1b56":function(e,t,a){},2729:function(e,t,a){"use strict";var o=function(){var e,t=this,a=t._self._c;return a("div",[a("button",{staticClass:"costos-btn",on:{click:function(e){return t.$emit("update:showModal",!0)}}},[a("i",{staticClass:"fas fa-dollar-sign"}),t._v(" Precios ")]),t.showModal?a("div",{staticClass:"modal-overlay"},[a("div",{staticClass:"modal-content"},[a("div",{staticClass:"modal-header"},[a("h2",[t._v("Precios por Producto")]),a("button",{staticClass:"close-btn",on:{click:t.cerrarModal}},[t._v("×")])]),a("div",{staticClass:"add-cost-form"},[a("h3",[t._v("Agregar Nuevo Producto/Precio")]),a("div",{staticClass:"form-group"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.newCost.medida,expression:"newCost.medida"}],attrs:{type:"text",placeholder:"Nombre del Producto",list:"medidas"},domProps:{value:t.newCost.medida},on:{input:function(e){e.target.composing||t.$set(t.newCost,"medida",e.target.value)}}}),a("datalist",{attrs:{id:"medidas"}},t._l(Object.keys(t.costosPorMedida),(function(e){return a("option",{key:e,domProps:{value:e}})})),0),a("input",{directives:[{name:"model",rawName:"v-model.number",value:t.newCost.costo,expression:"newCost.costo",modifiers:{number:!0}}],attrs:{type:"number",placeholder:"Precio",step:"0.01"},domProps:{value:t.newCost.costo},on:{input:function(e){e.target.composing||t.$set(t.newCost,"costo",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),a("input",{directives:[{name:"model",rawName:"v-model",value:t.newCost.fecha,expression:"newCost.fecha"}],attrs:{type:"date",max:t.currentDate},domProps:{value:t.newCost.fecha},on:{input:function(e){e.target.composing||t.$set(t.newCost,"fecha",e.target.value)}}}),a("button",{staticClass:"add-btn",on:{click:t.agregarCosto}},[t._v("Agregar")])])]),a("div",{staticClass:"current-costs"},[a("h3",[t._v("Precios Actuales")]),a("table",{staticClass:"costs-table"},[t._m(0),a("tbody",t._l(t.costosLocales,(function(e,o){return a("tr",{key:o},[a("td",[t._v(t._s(o))]),a("td",[a("input",{directives:[{name:"model",rawName:"v-model.number",value:t.costosLocales[o].costoBase,expression:"costosLocales[medida].costoBase",modifiers:{number:!0}}],staticClass:"cost-input",attrs:{type:"number",placeholder:"Precio",step:"0.01"},domProps:{value:t.costosLocales[o].costoBase},on:{input:[function(e){e.target.composing||t.$set(t.costosLocales[o],"costoBase",t._n(e.target.value))},function(e){return t.actualizarCostos(o)}],blur:function(e){return t.$forceUpdate()}}})]),a("td",[a("input",{directives:[{name:"model",rawName:"v-model",value:t.costosLocales[o].fecha,expression:"costosLocales[medida].fecha"}],staticClass:"date-input",attrs:{type:"date",max:t.currentDate},domProps:{value:t.costosLocales[o].fecha},on:{change:function(e){return t.actualizarCostos(o)},input:function(e){e.target.composing||t.$set(t.costosLocales[o],"fecha",e.target.value)}}})]),a("td",[a("button",{staticClass:"ver-btn",on:{click:function(e){return t.mostrarHistorial(o)}}},[t._v(" Ver ")])]),a("td",[a("button",{staticClass:"delete-btn",attrs:{title:"Eliminar producto"},on:{click:function(e){return t.eliminarMedida(o)}}},[t._v(" × ")])])])})),0)])]),a("div",{staticClass:"modal-footer"},[a("button",{staticClass:"save-btn",on:{click:t.guardarCostos}},[t._v("Guardar Cambios")]),a("button",{staticClass:"cancel-btn",on:{click:t.cerrarModal}},[t._v("Cancelar")])])])]):t._e(),t.showHistorialModal?a("div",{staticClass:"historial-modal"},[a("div",{staticClass:"historial-content"},[a("div",{staticClass:"historial-header"},[a("h3",[t._v("Historial de Precios - "+t._s(t.medidaSeleccionada))]),a("button",{staticClass:"close-btn",on:{click:function(e){t.showHistorialModal=!1}}},[t._v("×")])]),t.cargandoHistorial?a("div",{staticClass:"estado-carga"},[a("i",{staticClass:"fas fa-spinner fa-spin"}),a("span",[t._v("Cargando historial...")])]):t.errorHistorial?a("div",{staticClass:"estado-error"},[a("i",{staticClass:"fas fa-exclamation-circle"}),a("span",[t._v(t._s(t.errorHistorial))]),a("button",{staticClass:"retry-btn",on:{click:function(e){return t.mostrarHistorial(t.medidaSeleccionada)}}},[a("i",{staticClass:"fas fa-redo"}),t._v(" Reintentar ")])]):[a("div",{staticClass:"precio-evolucion"},[a("div",{staticClass:"precio-actual"},[a("span",{staticClass:"precio-label"},[t._v("Precio Actual:")]),a("span",{staticClass:"precio-valor"},[t._v("$"+t._s(t.formatNumber(null===(e=t.costosLocales[t.medidaSeleccionada])||void 0===e?void 0:e.costoBase)))])])]),a("table",{staticClass:"historial-table"},[t._m(1),a("tbody",t._l(t.historialCostos,(function(e,o){return a("tr",{key:o},[a("td",[t._v(t._s(t.formatDate(e.fecha)))]),a("td",{staticClass:"precio-celda"},[t._v("$"+t._s(t.formatNumber(e.costoBase)))]),e.cambio?a("td",{class:e.cambio.diferencia>0?"precio-subio":"precio-bajo"},[t._v(" "+t._s(e.cambio.diferencia>0?"+":"")+"$"+t._s(t.formatNumber(e.cambio.diferencia))+" ")]):a("td",[t._v("-")]),e.cambio?a("td",{class:e.cambio.diferencia>0?"precio-subio":"precio-bajo"},[t._v(" "+t._s(e.cambio.diferencia>0?"+":"")+t._s(e.cambio.porcentaje.toFixed(2))+"% ")]):a("td",[t._v("-")]),a("td",{staticClass:"actions-cell"},[a("button",{staticClass:"delete-btn",attrs:{title:"Eliminar precio"},on:{click:function(a){return t.eliminarCosto(e.id)}}},[t._v(" × ")])])])})),0)])]],2)]):t._e()])},r=[function(){var e=this,t=e._self._c;return t("thead",[t("tr",[t("th",[e._v("Producto")]),t("th",[e._v("Precio")]),t("th",[e._v("Fecha")]),t("th",[e._v("Historial")]),t("th",[e._v("Acciones")])])])},function(){var e=this,t=e._self._c;return t("thead",[t("tr",[t("th",[e._v("Fecha")]),t("th",[e._v("Precio")]),t("th",[e._v("Cambio")]),t("th",[e._v("Variación %")]),t("th",[e._v("Acciones")])])])}],i=(a("13d5"),a("dc59")),s=a("1494"),n={name:"CostosModal",props:{showModal:{type:Boolean,required:!0},costosPorMedida:{type:Object,required:!0}},data(){return{costosLocales:{},newCost:{medida:"",costo:null,fecha:(new Date).toISOString().split("T")[0]},showHistorialModal:!1,medidaSeleccionada:null,historialCostos:[],historialesPorMedida:{},cargandoHistorial:!1,errorHistorial:null,unsubscribeCostos:null}},computed:{currentDate(){return(new Date).toISOString().split("T")[0]}},async created(){await this.iniciarEscuchaCostos()},beforeDestroy(){this.unsubscribeCostos&&this.unsubscribeCostos()},watch:{showModal(e){e&&this.inicializarCostosLocales()}},methods:{formatNumber(e){return null===e||void 0===e?"0.00":Number(e).toLocaleString("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2})},formatDate(e){if(!e)return"";const[t,a,o]=e.split("-"),r=new Date(t,a-1,o),i={year:"numeric",month:"long",day:"numeric"};return r.toLocaleDateString("es-ES",i)},calcularCambio(e,t){const a=e-t,o=a/t*100,r=a>0?"+":"";return`${r}${this.formatNumber(a)} (${r}${o.toFixed(1)}%)`},inicializarCostosLocales(){this.costosLocales=Object.keys(this.costosPorMedida).reduce((e,t)=>(e[t]={costoBase:this.costosPorMedida[t].costoBase||0,fecha:this.costosPorMedida[t].fecha||(new Date).toISOString().split("T")[0]},e),{})},async actualizarCostos(e){try{const t={medida:e,costoBase:this.costosLocales[e].costoBase,fecha:this.costosLocales[e].fecha,timestamp:Object(s["p"])()};await Object(s["b"])(Object(s["c"])(i["a"],"precios_globales"),t);const a={medida:e,costoBase:this.costosLocales[e].costoBase,fecha:this.costosLocales[e].fecha};await Object(s["b"])(Object(s["c"])(i["a"],"costos"),a),await this.actualizarPreciosProductos(e,t.costoBase),await this.cargarHistorial(e)}catch(t){console.error("Error al actualizar precio:",t),alert("Error al actualizar el precio")}},async agregarCosto(){if(this.newCost.medida&&this.newCost.costo&&this.newCost.fecha)try{const e={medida:this.newCost.medida,costoBase:this.newCost.costo,fecha:this.newCost.fecha,timestamp:Object(s["p"])()};await Object(s["b"])(Object(s["c"])(i["a"],"precios_globales"),e);const t={medida:this.newCost.medida,costoBase:this.newCost.costo,fecha:this.newCost.fecha};await Object(s["b"])(Object(s["c"])(i["a"],"costos"),t),this.$set(this.costosLocales,this.newCost.medida,{costoBase:this.newCost.costo,fecha:this.newCost.fecha}),this.actualizarCostos(this.newCost.medida),this.newCost={medida:"",costo:null,fecha:(new Date).toISOString().split("T")[0]}}catch(e){console.error("Error al agregar precio:",e),alert("Error al guardar el precio")}else alert("Por favor complete todos los campos")},async iniciarEscuchaCostos(){try{const e=getFirestore(),t=Object(s["c"])(e,"precios_globales"),a=Object(s["o"])(t,Object(s["l"])("timestamp","desc"));this.unsubscribeCostos=Object(s["k"])(a,e=>{const t={};e.forEach(e=>{const a=e.data();(!t[a.medida]||new Date(a.fecha)>new Date(t[a.medida].fecha))&&(t[a.medida]={costoBase:a.costoBase,fecha:a.fecha})}),this.costosLocales=t,this.$emit("update:costos",t)})}catch(e){console.error("Error al iniciar escucha de costos:",e)}},async mostrarHistorial(e){this.cargandoHistorial=!0,this.errorHistorial=null;try{this.medidaSeleccionada=e;const t=Object(s["c"])(i["a"],"costos"),a=Object(s["o"])(t,Object(s["s"])("medida","==",e)),o=await Object(s["g"])(a);let r=o.docs.map(e=>({id:e.id,...e.data()})).sort((e,t)=>new Date(t.fecha)-new Date(e.fecha));this.historialCostos=r.map((e,t)=>{const a=r[t+1],o=a?{diferencia:e.costoBase-a.costoBase,porcentaje:(e.costoBase-a.costoBase)/a.costoBase*100}:null;return{...e,cambio:o}}),this.showHistorialModal=!0}catch(t){console.error("Error al cargar historial:",t),this.errorHistorial="Error al cargar el historial de precios. Por favor, intenta de nuevo."}finally{this.cargandoHistorial=!1}},async cargarHistorial(e){try{const t=Object(s["c"])(i["a"],"costos"),a=Object(s["o"])(t,Object(s["s"])("medida","==",e)),o=await Object(s["g"])(a),r=o.docs.map(e=>({id:e.id,...e.data()})).sort((e,t)=>new Date(t.fecha)-new Date(e.fecha));this.$set(this.historialesPorMedida,e,r)}catch(t){console.error("Error al cargar historial:",t),alert("Error al cargar el historial de precios")}},async eliminarCosto(e){if(confirm("¿Estás seguro de que deseas eliminar este precio?"))try{await Object(s["d"])(Object(s["e"])(i["a"],"costos",e)),await this.mostrarHistorial(this.medidaSeleccionada),await this.cargarHistorial(this.medidaSeleccionada);const t=this.historialCostos[0];t&&this.$set(this.costosLocales,this.medidaSeleccionada,{costoBase:t.costoBase,fecha:t.fecha})}catch(t){console.error("Error al eliminar precio:",t),alert("Error al eliminar el precio")}},async eliminarMedida(e){if(confirm("¿Estás seguro de que deseas eliminar este producto y todo su historial?"))try{const t=Object(s["c"])(i["a"],"costos"),a=Object(s["o"])(t,Object(s["s"])("medida","==",e)),o=await Object(s["g"])(a);await Promise.all(o.docs.map(e=>Object(s["d"])(e.ref)));const{[e]:r,...n}=this.costosLocales;this.costosLocales=n;const{[e]:c,...l}=this.costosPorMedida;this.$emit("update:costos",l)}catch(t){console.error("Error al eliminar producto:",t),alert("Error al eliminar el producto")}},guardarCostos(){const e=Object.keys(this.costosLocales).reduce((e,t)=>(e[t]={costoBase:this.costosLocales[t].costoBase,fecha:this.costosLocales[t].fecha},e),{});this.$emit("guardar",e),this.cerrarModal()},cerrarModal(){this.$emit("update:showModal",!1)}}},c=n,l=(a("6044"),a("2877")),d=Object(l["a"])(c,o,r,!1,null,"6daea347",null);t["a"]=d.exports},"2cc6":function(e,t,a){"use strict";var o=function(){var e=this,t=e._self._c;return t("div",{staticClass:"gestionar-medidas-container"},[t("div",{staticClass:"back-button-container"},[t("BackButton",{attrs:{to:"/gestionar-productos"}})],1),t("h1",[e._v("Gestión de Medidas")]),t("div",{staticClass:"add-medida-form"},[t("h2",[e._v("Agregar Medida")]),t("form",{on:{submit:function(t){return t.preventDefault(),e.addMedida.apply(null,arguments)}}},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"medida"}},[e._v("Medida:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.newMedida.nombre,expression:"newMedida.nombre"}],attrs:{id:"medida",required:"",placeholder:"Ej: 16/20, 21/25, 26/30, etc."},domProps:{value:e.newMedida.nombre},on:{input:function(t){t.target.composing||e.$set(e.newMedida,"nombre",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"tipo"}},[e._v("Tipo:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:e.newMedida.tipo,expression:"newMedida.tipo"}],attrs:{id:"tipo",required:""},on:{change:function(t){var a=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(e.newMedida,"tipo",t.target.multiple?a:a[0])}}},[t("option",{attrs:{value:"general"}},[e._v("General")]),t("option",{attrs:{value:"maquila"}},[e._v("Maquila")])])]),"maquila"===e.newMedida.tipo?t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"maquila"}},[e._v("Maquila:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:e.newMedida.maquilaId,expression:"newMedida.maquilaId"}],attrs:{id:"maquila",required:""},on:{change:function(t){var a=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(e.newMedida,"maquilaId",t.target.multiple?a:a[0])}}},[t("option",{attrs:{value:""}},[e._v("Seleccione una maquila")]),e._l(e.maquilas,(function(a){return t("option",{key:a.id,domProps:{value:a.id}},[e._v(" "+e._s(a.nombre)+" ")])}))],2)]):e._e(),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"proveedor"}},[e._v("Proveedor:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:e.newMedida.proveedorId,expression:"newMedida.proveedorId"}],attrs:{id:"proveedor"},on:{change:function(t){var a=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(e.newMedida,"proveedorId",t.target.multiple?a:a[0])}}},[t("option",{attrs:{value:""}},[e._v("General")]),e._l(e.proveedores,(function(a){return t("option",{key:a.id,domProps:{value:a.id}},[e._v(" "+e._s(a.nombre)+" ")])}))],2)]),t("button",{staticClass:"submit-btn",attrs:{type:"submit"}},[e._v("Agregar Medida")])])]),t("div",{staticClass:"medidas-list"},[t("h2",[e._v("Lista de Medidas")]),t("h3",[e._v("Medidas Generales")]),t("ul",e._l(e.medidasGenerales,(function(a){return t("li",{key:a.id},[e._v(" "+e._s(a.nombre)+" "),t("button",{staticClass:"delete-btn",on:{click:function(t){return e.deleteMedida(a.id)}}},[e._v("Eliminar")])])})),0),t("h3",[e._v("Medidas de Proveedores")]),e._l(e.proveedores,(function(a){return t("div",{key:a.id},[t("h4",[e._v(e._s(a.nombre))]),t("ul",e._l(e.getMedidasProveedor(a.id),(function(a){return t("li",{key:a.id},[e._v(" "+e._s(a.nombre)+" "),t("button",{staticClass:"delete-btn",on:{click:function(t){return e.deleteMedida(a.id)}}},[e._v("Eliminar")])])})),0)])})),t("h3",[e._v("Medidas de Maquilas")]),e._l(e.maquilas,(function(a){return t("div",{key:a.id},[t("h4",[e._v(e._s(a.nombre))]),t("ul",e._l(e.getMedidasMaquila(a.id),(function(a){return t("li",{key:a.id},[e._v(" "+e._s(a.nombre)+" "),t("button",{staticClass:"delete-btn",on:{click:function(t){return e.deleteMedida(a.id)}}},[e._v("Eliminar")])])})),0)])}))],2)])},r=[],i=a("2b0e"),s=a("dc59"),n=a("1494"),c=a("74c9"),l={name:"GestionarMedidas",components:{BackButton:c["a"]},setup(){const e=Object(i["ref"])([]),t=Object(i["ref"])([]),a=Object(i["ref"])([]),o=Object(i["ref"])({nombre:"",tipo:"general",maquilaId:"",proveedorId:""}),r=async()=>{try{const t=await Object(n["g"])(Object(n["c"])(s["a"],"medidas"));e.value=t.docs.map(e=>({id:e.id,...e.data()}))}catch(t){console.error("Error al cargar medidas: ",t)}},c=async()=>{try{const e=Object(n["o"])(Object(n["c"])(s["a"],"proveedores"),Object(n["s"])("tipo","==","maquila")),t=await Object(n["g"])(e);a.value=t.docs.map(e=>({id:e.id,...e.data()}))}catch(e){console.error("Error al cargar maquilas: ",e)}},l=async()=>{try{const e=await Object(n["g"])(Object(n["c"])(s["a"],"proveedores"));t.value=e.docs.map(e=>({id:e.id,...e.data()}))}catch(e){console.error("Error al cargar proveedores: ",e)}},d=async()=>{try{await Object(n["b"])(Object(n["c"])(s["a"],"medidas"),{nombre:o.value.nombre,tipo:o.value.tipo,maquilaId:"maquila"===o.value.tipo?o.value.maquilaId:null,proveedorId:"general"===o.value.tipo?o.value.proveedorId:null}),o.value={nombre:"",tipo:"general",maquilaId:"",proveedorId:""},r()}catch(e){console.error("Error al añadir medida: ",e)}},u=async e=>{if(confirm("¿Estás seguro de que quieres eliminar esta medida?"))try{await Object(n["d"])(Object(n["e"])(s["a"],"medidas",e)),r()}catch(t){console.error("Error al eliminar medida: ",t)}},v=Object(i["computed"])(()=>e.value.filter(e=>"general"===e.tipo&&!e.proveedorId)),m=t=>e.value.filter(e=>"maquila"===e.tipo&&e.maquilaId===t),p=t=>e.value.filter(e=>e.proveedorId===t);return Object(i["onMounted"])(()=>{r(),c(),l()}),{medidas:e,proveedores:t,maquilas:a,newMedida:o,addMedida:d,deleteMedida:u,medidasGenerales:v,getMedidasMaquila:m,getMedidasProveedor:p}}},d=l,u=(a("c3cc"),a("2877")),v=Object(u["a"])(d,o,r,!1,null,"48626452",null);t["a"]=v.exports},"2efd":function(e,t,a){},"458c":function(e,t,a){"use strict";a("cec2")},4786:function(e,t,a){"use strict";a("e1ab")},"4a6a":function(e,t,a){},"4c52":function(e,t,a){"use strict";var o=function(){var e=this,t=e._self._c;return t("div",{staticClass:"gestionar-proveedores-container"},[t("div",{staticClass:"back-button-container"},[t("BackButton",{attrs:{to:"/gestionar-productos"}})],1),t("h1",[e._v("Gestión de Proveedores y Maquilas")]),t("div",{staticClass:"add-proveedor-form"},[t("h2",[e._v("Agregar Proveedor/Maquila")]),t("form",{on:{submit:function(t){return t.preventDefault(),e.addProveedor.apply(null,arguments)}}},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"nombre"}},[e._v("Nombre:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.newProveedor.nombre,expression:"newProveedor.nombre"}],attrs:{id:"nombre",required:"",placeholder:"Nombre del proveedor/maquila"},domProps:{value:e.newProveedor.nombre},on:{input:function(t){t.target.composing||e.$set(e.newProveedor,"nombre",t.target.value)}}})]),t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"tipo"}},[e._v("Tipo:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:e.newProveedor.tipo,expression:"newProveedor.tipo"}],attrs:{id:"tipo",required:""},on:{change:function(t){var a=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(e.newProveedor,"tipo",t.target.multiple?a:a[0])}}},[t("option",{attrs:{value:"proveedor"}},[e._v("Proveedor")]),t("option",{attrs:{value:"maquila"}},[e._v("Maquila")])])]),t("button",{staticClass:"submit-btn",attrs:{type:"submit"}},[e._v("Agregar")])])]),t("div",{staticClass:"proveedores-list"},[t("h2",[e._v("Lista de Proveedores y Maquilas")]),t("ul",e._l(e.sortedProveedores,(function(a){return t("li",{key:a.id},[t("div",{staticClass:"proveedor-info"},[t("strong",[e._v(e._s(a.nombre))]),t("span",[e._v("("+e._s("proveedor"===a.tipo?"Proveedor":"Maquila")+")")])]),t("button",{staticClass:"delete-btn",on:{click:function(t){return e.deleteProveedor(a.id)}}},[e._v("Eliminar")])])})),0)])])},r=[],i=a("2b0e"),s=a("dc59"),n=a("1494"),c=a("74c9"),l={name:"GestionarProveedores",components:{BackButton:c["a"]},setup(){const e=Object(i["ref"])([]),t=Object(i["ref"])({nombre:"",tipo:"proveedor"}),a=async()=>{try{const t=await Object(n["g"])(Object(n["c"])(s["a"],"proveedores"));e.value=t.docs.map(e=>({id:e.id,...e.data()}))}catch(t){console.error("Error al cargar proveedores: ",t)}},o=async()=>{try{await Object(n["b"])(Object(n["c"])(s["a"],"proveedores"),{nombre:t.value.nombre,tipo:t.value.tipo}),t.value={nombre:"",tipo:"proveedor"},a()}catch(e){console.error("Error al añadir proveedor: ",e)}},r=async e=>{if(confirm("¿Estás seguro de que quieres eliminar este proveedor/maquila?"))try{await Object(n["d"])(Object(n["e"])(s["a"],"proveedores",e)),a()}catch(t){console.error("Error al eliminar proveedor: ",t)}},c=Object(i["computed"])(()=>[...e.value].sort((e,t)=>e.nombre.localeCompare(t.nombre)));return Object(i["onMounted"])(a),{proveedores:e,newProveedor:t,addProveedor:o,deleteProveedor:r,sortedProveedores:c}}},d=l,u=(a("9226"),a("2877")),v=Object(u["a"])(d,o,r,!1,null,"14c80c33",null);t["a"]=v.exports},"4c57":function(e,t,a){"use strict";a("13d5");var o=function(){var e=this,t=e._self._c;return t("div",{staticClass:"existencias-page"},[t("div",{staticClass:"existencias-container"},[t("div",{staticClass:"header"},[t("h1",[e._v("Reporte de Existencias")]),t("button",{staticClass:"print-button",on:{click:e.imprimirReporte}},[e._v(" Imprimir Reporte ")])]),t("div",{staticClass:"filters"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.search,expression:"search"}],staticClass:"search-input",attrs:{placeholder:"Buscar por proveedor o medida"},domProps:{value:e.search},on:{input:function(t){t.target.composing||(e.search=t.target.value)}}})]),t("div",{staticClass:"existencias-grid"},[e._l(e.filteredExistencias,(function(a,o){return[t("div",{key:o,staticClass:"medida-card",class:{"maquila-card":"Ozuna"===o||"Joselito"===o}},[t("h2",[e._v(e._s(o)+e._s("Ozuna"===o||"Joselito"===o?" (Maquila)":""))]),t("table",{staticClass:"medida-table"},[t("thead",[t("tr",[t("th",[e._v("Medida")]),"Ozuna"!==o&&"Joselito"!==o?t("th",[e._v("Proveedor")]):e._e(),t("th",{staticClass:"kilos-cell"},[e._v("Kilos")])])]),t("tbody",["Ozuna"===o||"Joselito"===o?[e._l(a,(function(a,o){return t("tr",{key:o},[t("td",[e._v(e._s(a.medida))]),t("td",{staticClass:"kilos-cell"},[e._v(e._s(e.formatNumber(a.kilos)))])])})),t("tr",{staticClass:"total-row"},[t("td",[t("strong",[e._v("Total "+e._s(o))])]),t("td",{staticClass:"kilos-cell"},[t("strong",[e._v(e._s(e.formatNumber(Object.values(a).reduce((e,t)=>e+t.kilos,0))))])])])]:[e._l(a,(function(a){return t("tr",{key:a.medida},[t("td",[e._v(e._s(a.medida))]),t("td",[e._v(e._s(a.proveedor))]),t("td",{staticClass:"kilos-cell"},[e._v(e._s(e.formatNumber(a.kilos)))])])})),t("tr",{staticClass:"total-row"},[t("td",[t("strong",[e._v("Total "+e._s(o))])]),t("td"),t("td",{staticClass:"kilos-cell"},[t("strong",[e._v(e._s(e.formatNumber(a.reduce((e,t)=>e+t.kilos,0))))])])])]],2)])])]}))],2),t("div",{staticClass:"total-general"},[t("h2",[e._v("Total General: "+e._s(e.formatNumber(e.totalGeneral)))])])])])},r=[],i=(a("14d9"),a("2b0e")),s=a("dc59"),n=a("1494"),c=a("c1df"),l=a.n(c),d={name:"Existencias",setup(){const e=Object(i["ref"])({}),t=Object(i["ref"])(""),a=async()=>{const t=await Object(n["g"])(Object(n["c"])(s["a"],"sacadas")),a={};console.log("=== Rastreando Selecta 51/60 1ra Nacional ===");let o=0;const r=t.docs.map(e=>({id:e.id,...e.data()})).sort((e,t)=>{const a=e.fecha instanceof Date?e.fecha:e.fecha.toDate(),o=t.fecha instanceof Date?t.fecha:t.fecha.toDate();return a-o});r.forEach(e=>{const t=e.fecha instanceof Date?e.fecha:e.fecha.toDate();e.entradas.forEach(e=>{"Selecta"===e.proveedor&&"51/60 1ra Nacional"===e.medida&&(o+=e.kilos,console.log(`Entrada: ${e.kilos} kg - Fecha: ${l()(t).format("DD/MM/YYYY")} - Total: ${o} kg`)),a[e.proveedor]||(a[e.proveedor]={});const r=e.medida;a[e.proveedor][r]||(a[e.proveedor][r]={kilos:0,medida:e.medida}),a[e.proveedor][r].kilos+=e.kilos}),e.salidas.forEach(e=>{"Selecta"===e.proveedor&&"51/60 1ra Nacional"===e.medida&&(o-=e.kilos,console.log(`Salida: ${e.kilos} kg - Fecha: ${l()(t).format("DD/MM/YYYY")} - Total: ${o} kg`)),a[e.proveedor]||(a[e.proveedor]={});const r=e.medida;a[e.proveedor][r]||(a[e.proveedor][r]={kilos:0,medida:e.medida}),a[e.proveedor][r].kilos-=e.kilos})}),console.log(`=== Total final Selecta 51/60 1ra Nacional: ${o} kg ===`),Object.keys(a).forEach(e=>{"Selecta"===e&&a[e]["51/60 1ra Nacional"]&&console.log("[DEBUG] Resultado final Selecta 51/60 1ra Nacional:",a[e]["51/60 1ra Nacional"].kilos),a[e]=Object.fromEntries(Object.entries(a[e]).filter(([e,t])=>t.kilos>0)),0===Object.keys(a[e]).length&&delete a[e]}),e.value=a},o=Object(i["computed"])(()=>{const a=t.value.toLowerCase(),o={},r={};Object.entries(e.value).forEach(([e,t])=>{"Ozuna"!==e&&"Joselito"!==e&&(r[e]=t)}),e.value["Ozuna"]&&(o["Ozuna"]=e.value["Ozuna"]),e.value["Joselito"]&&(o["Joselito"]=e.value["Joselito"]);const i={};Object.entries(r).forEach(([e,t])=>{Object.entries(t).forEach(([t,a])=>{const o=a.medida.split(" ")[0];i[o]||(i[o]=[]);const r=i[o].findIndex(t=>t.proveedor===e&&t.medida===a.medida);r>=0?i[o][r].kilos+=a.kilos:i[o].push({proveedor:e,medida:a.medida,kilos:a.kilos})})});const s={};return Object.entries(i).sort(([e],[t])=>{const a=parseInt(e.split("/")[0]),o=parseInt(t.split("/")[0]);return a-o}).forEach(([e,t])=>{(!a||e.toLowerCase().includes(a)||t.some(e=>e.proveedor.toLowerCase().includes(a)||e.medida.toLowerCase().includes(a)))&&(s[e]=t)}),Object.entries(o).forEach(([e,t])=>{a&&!e.toLowerCase().includes(a)||(s[e]=Object.entries(t).sort(([e],[t])=>{const a=parseInt(e.split("/")[0]),o=parseInt(t.split("/")[0]);return a-o}).reduce((e,[t,a])=>(e[t]=a,e),{}))}),s}),r=Object(i["computed"])(()=>{let t=0,a=0;return Object.entries(e.value).forEach(([e,o])=>{Object.values(o).forEach(o=>{"ozuna"===e.toLowerCase()?o.kilos>a&&(a=o.kilos):o.kilos>t&&(t=o.kilos)})}),{normal:t,ozuna:a}}),c=Object(i["computed"])(()=>Object.entries(o.value).reduce((e,[t,a])=>"Ozuna"===t||"Joselito"===t?e+Object.values(a).reduce((e,t)=>e+t.kilos,0):e+a.reduce((e,t)=>e+t.kilos,0),0)),d=e=>Math.round(e).toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),u=()=>{const e=(new Date).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}),t='\n        <style>\n          @page { \n            size: A4 landscape; \n            margin: 0.5cm 0.5cm;\n            @bottom-right {\n              content: "Página " counter(page) " de " counter(pages);\n              font-size: 11pt;\n            }\n          }\n          body {\n            font-family: Arial, sans-serif;\n            font-size: 18pt;\n            line-height: 1.2;\n            color: #333;\n            margin: 0;\n            padding: 0;\n          }\n          .header {\n            margin-bottom: 8px;\n            padding-bottom: 4px;\n          }\n          h1 {\n            font-size: 26pt;\n            margin: 0;\n            padding: 0;\n          }\n          .fecha-reporte {\n            font-size: 18pt;\n          }\n          .existencias-grid {\n            display: grid;\n            grid-template-columns: repeat(4, 1fr);\n            gap: 8px;\n            margin-top: 10px;\n          }\n          .medida-card {\n            padding: 8px;\n          }\n          .medida-card h2 {\n            font-size: 20pt;\n            margin: 0 0 6px 0;\n            padding-bottom: 4px;\n          }\n          th, td {\n            padding: 4px;\n            font-size: 16pt;\n          }\n          @media print {\n            .existencias-grid {\n              display: grid;\n              grid-template-columns: repeat(4, 1fr);\n            }\n            .maquila-card {\n              break-before: page;\n              page-break-before: always;\n            }\n            .medida-card {\n              break-inside: avoid;\n              page-break-inside: avoid;\n            }\n          }\n          .total-general {\n            margin-top: 15px;\n            padding: 8px;\n          }\n          .total-general h2 {\n            font-size: 20pt;\n          }\n          table {\n            width: 100%;\n            border-collapse: collapse;\n            margin-top: 8px;\n            border: 2px solid #2c3e50;\n          }\n          th {\n            background-color: #2c3e50;\n            color: white;\n            text-align: left;\n            padding: 8px;\n            font-size: 16pt;\n            border: 1px solid #2c3e50;\n          }\n          td {\n            padding: 6px 8px;\n            font-size: 16pt;\n            border: 1px solid #bdc3c7;\n          }\n          tr:nth-child(even) {\n            background-color: #f8f9fa;\n          }\n          .kilos-cell {\n            text-align: right;\n            font-weight: bold;\n            color: #2c3e50;\n          }\n          .total-row {\n            background-color: #ecf0f1 !important;\n            border-top: 2px solid #2c3e50;\n          }\n          .total-row td {\n            font-weight: bold;\n            color: #2c3e50;\n          }\n          .medida-card {\n            padding: 12px;\n            border: 1px solid #bdc3c7;\n            background-color: white;\n          }\n          .maquila-card {\n            background-color: white;\n            border: 2px solid #f39c12;\n          }\n          .maquila-card h2 {\n            color: #d35400;\n            border-bottom: 2px solid #f39c12;\n            padding-bottom: 8px;\n          }\n          .maquila-card th {\n            background-color: #f39c12;\n            border-color: #f39c12;\n          }\n          .maquila-card .total-row {\n            background-color: #f8f9fa !important;\n            border-top: 2px solid #f39c12;\n          }\n          .maquila-card .total-row td {\n            color: #d35400;\n            font-weight: bold;\n          }\n          @media print {\n            .medida-card {\n              box-shadow: none;\n              border: 1px solid #bdc3c7;\n            }\n            .maquila-card {\n              background-color: white;\n              border: 2px solid #f39c12;\n            }\n            table {\n              page-break-inside: avoid;\n            }\n          }\n        </style>\n      ',a=document.createElement("div");a.innerHTML=`\n        ${t}\n        <div class="header">\n          <h1>Reporte de Existencias</h1>\n          <div class="fecha-reporte">Fecha: ${e}</div>\n        </div>\n        ${document.querySelector(".existencias-grid").outerHTML}\n        ${document.querySelector(".total-general").outerHTML}\n      `;const o=window.open("","_blank");o.document.write(a.innerHTML),o.document.close(),setTimeout(()=>{o.print(),o.close()},250)};let v;return Object(i["onMounted"])(()=>{a(),v=Object(n["k"])(Object(n["c"])(s["a"],"sacadas"),()=>{a()})}),Object(i["onUnmounted"])(()=>{v&&v()}),Object(i["watchEffect"])(()=>{console.log("Existencias actualizadas:",e.value)}),{existencias:e,filteredExistencias:o,search:t,maxKilos:r,totalGeneral:c,formatNumber:d,imprimirReporte:u}}},u=d,v=(a("458c"),a("2877")),m=Object(v["a"])(u,o,r,!1,null,"641ed602",null);t["a"]=m.exports},"4c80":function(e,t,a){},"4e00":function(e,t,a){"use strict";var o=function(){var e=this,t=e._self._c;return t("div",{staticClass:"container"},[t("div",{staticClass:"add-client"},[t("div",{staticClass:"back-button-container"},[t("BackButton",{attrs:{to:"/NoteMenu"}})],1),e._m(0),t("form",{on:{submit:function(t){return t.preventDefault(),e.addClient.apply(null,arguments)}}},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"name"}},[e._v("Nombre:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.name,expression:"name"}],attrs:{type:"text",required:""},domProps:{value:e.name},on:{input:function(t){t.target.composing||(e.name=t.target.value)}}})]),t("button",{attrs:{type:"submit"}},[e._v("Agregar Cliente")])]),e._m(1),t("ul",e._l(e.clients,(function(a){return t("li",{key:a.id},[e._v(" "+e._s(a.name)+" "),t("button",{on:{click:function(t){return e.deleteClient(a.id)}}},[e._v("Eliminar")])])})),0)])])},r=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"add-client-form"},[t("h2",[e._v("Agregar Cliente")])])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"add-client-form"},[t("h2",[e._v("Lista de Clientes")])])}],i=(a("d9e2"),a("74c9")),s=a("dc59"),n=a("1494"),c={components:{BackButton:i["a"]},data(){return{name:"",clients:[]}},methods:{async addClient(){try{if(console.log("DB instance:",s["a"]),!s["a"])throw new Error("Firestore DB is not initialized");await Object(n["b"])(Object(n["c"])(s["a"],"clients"),{name:this.name}),this.name="",this.fetchClients()}catch(e){console.error("Error adding client: ",e)}},async fetchClients(){try{const e=await Object(n["g"])(Object(n["c"])(s["a"],"clients"));this.clients=e.docs.map(e=>({id:e.id,...e.data()}))}catch(e){console.error("Error fetching clients: ",e)}},deleteClient(e){window.confirm("¿Estás seguro de que deseas eliminar este cliente?")&&Object(n["d"])(Object(n["e"])(s["a"],"clients",e)).then(()=>{console.log("Cliente eliminado con éxito")}).catch(e=>{console.error("Error al eliminar el cliente: ",e)})}},async mounted(){this.fetchClients()}},l=c,d=(a("f90b"),a("2877")),u=Object(d["a"])(l,o,r,!1,null,"024a7518",null);t["a"]=u.exports},5355:function(e,t,a){},5617:function(e,t,a){"use strict";a("4c80")},6044:function(e,t,a){"use strict";a("b7d6")},"666c":function(e,t,a){"use strict";var o=function(){var e,t=this,a=t._self._c;return a("div",[a("button",{staticClass:"precio-historial-btn",on:{click:t.abrirModal}},[t._v(" "+t._s(t.clienteActual?"Precios de Venta - "+t.obtenerNombreCliente(t.clienteActual):"Precios de Venta")+" ")]),t.showModal?a("div",{staticClass:"modal-overlay"},[a("div",{staticClass:"modal-content"},[a("div",{staticClass:"modal-header"},[a("h2",[t._v(t._s(t.clienteActual?"Precios de Venta - "+t.obtenerNombreCliente(t.clienteActual):"Precios de Venta"))]),a("button",{staticClass:"close-btn",on:{click:function(e){t.showModal=!1}}},[t._v("×")])]),a("div",{staticClass:"add-price-form"},[a("h3",[t._v("Agregar Nuevo Precio")]),a("div",{staticClass:"form-group"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.newPrice.producto,expression:"newPrice.producto"}],attrs:{type:"text",placeholder:"Producto/Medida",list:"productos"},domProps:{value:t.newPrice.producto},on:{input:function(e){e.target.composing||t.$set(t.newPrice,"producto",e.target.value)}}}),a("datalist",{attrs:{id:"productos"}},t._l(t.preciosActuales,(function(e){return a("option",{key:e.id,domProps:{value:e.producto}})})),0),a("input",{directives:[{name:"model",rawName:"v-model.number",value:t.newPrice.precio,expression:"newPrice.precio",modifiers:{number:!0}}],attrs:{type:"number",placeholder:"Precio"},domProps:{value:t.newPrice.precio},on:{input:function(e){e.target.composing||t.$set(t.newPrice,"precio",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}}),a("input",{directives:[{name:"model",rawName:"v-model",value:t.newPrice.fecha,expression:"newPrice.fecha"}],attrs:{type:"date"},domProps:{value:t.newPrice.fecha},on:{input:function(e){e.target.composing||t.$set(t.newPrice,"fecha",e.target.value)}}}),a("div",{staticClass:"cliente-especifico"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.newPrice.esClienteEspecifico,expression:"newPrice.esClienteEspecifico"}],attrs:{type:"checkbox",id:"clienteEspecifico"},domProps:{checked:Array.isArray(t.newPrice.esClienteEspecifico)?t._i(t.newPrice.esClienteEspecifico,null)>-1:t.newPrice.esClienteEspecifico},on:{change:function(e){var a=t.newPrice.esClienteEspecifico,o=e.target,r=!!o.checked;if(Array.isArray(a)){var i=null,s=t._i(a,i);o.checked?s<0&&t.$set(t.newPrice,"esClienteEspecifico",a.concat([i])):s>-1&&t.$set(t.newPrice,"esClienteEspecifico",a.slice(0,s).concat(a.slice(s+1)))}else t.$set(t.newPrice,"esClienteEspecifico",r)}}}),a("label",{attrs:{for:"clienteEspecifico"}},[t._v("Precio para cliente específico")])]),t.newPrice.esClienteEspecifico?a("div",{staticClass:"cliente-selector"},[a("label",[t._v("Seleccionar cliente:")]),a("div",{staticClass:"cliente-botones"},t._l(t.clientes,(function(e){return a("button",{key:e.id,staticClass:"cliente-btn",class:{"cliente-seleccionado":t.newPrice.clienteId===e.id},style:{backgroundColor:e.color},on:{click:function(a){return t.seleccionarCliente(e.id)}}},[t._v(" "+t._s(e.nombre)+" ")])})),0)]):t._e(),a("button",{staticClass:"add-btn",on:{click:t.agregarPrecio}},[t._v("Agregar")])])]),a("div",{staticClass:"filter-section"},[a("label",[t._v("Filtrar por cliente:")]),a("div",{staticClass:"cliente-filtro-botones"},[a("button",{staticClass:"cliente-filtro-btn",class:{"cliente-filtro-seleccionado":""===t.filtroCliente},on:{click:function(e){t.filtroCliente=""}}},[t._v(" Todos ")]),t._l(t.clientes,(function(e){return a("button",{key:e.id,staticClass:"cliente-filtro-btn",class:{"cliente-filtro-seleccionado":t.filtroCliente===e.id},style:{backgroundColor:e.color},on:{click:function(a){t.filtroCliente=e.id}}},[t._v(" "+t._s(e.nombre)+" ")])}))],2)]),a("div",{staticClass:"current-prices"},[a("h3",[t._v("Precios Actuales")]),t._l(t.categorias,(function(e){return a("div",{key:e,staticClass:"categoria-section"},[a("h4",{staticClass:"categoria-title"},[t._v(t._s(e))]),a("div",{staticClass:"products-grid"},t._l(t.filtrarPreciosPorCliente(t.preciosOrdenados[e]),(function(e){return a("div",{key:e.id,staticClass:"product-card",class:{"precio-especifico":e.clienteId},style:e.clienteId?{borderColor:t.obtenerColorCliente(e.clienteId),backgroundColor:t.obtenerColorClienteConOpacidad(e.clienteId)}:{}},[a("h4",[t._v(t._s(e.producto))]),a("p",{staticClass:"price"},[t._v("$"+t._s(t.formatNumber(e.precio)))]),a("p",{staticClass:"date"},[t._v("Desde: "+t._s(t.formatDate(e.fecha)))]),e.clienteId?a("p",{staticClass:"cliente-especifico-tag",style:{backgroundColor:t.obtenerColorCliente(e.clienteId)}},[t._v(" Cliente: "+t._s(t.obtenerNombreCliente(e.clienteId))+" ")]):t._e(),a("p",{staticClass:"historial-count"},[t._v(" "+t._s(e.historial.length)+" precio"+t._s(1!==e.historial.length?"s":"")+" registrado"+t._s(1!==e.historial.length?"s":"")+" ")]),a("button",{staticClass:"history-btn",on:{click:function(a){return t.mostrarHistorial(e)}}},[t._v(" Ver Historial ")])])})),0)])}))],2),t.showHistorialModal?a("div",{staticClass:"historial-modal"},[a("div",{staticClass:"historial-content"},[a("div",{staticClass:"historial-header"},[a("h3",[t._v("Historial de Precios - "+t._s(null===(e=t.productoSeleccionado)||void 0===e?void 0:e.producto))]),a("button",{staticClass:"close-btn",on:{click:function(e){t.showHistorialModal=!1}}},[t._v("×")])]),a("table",[t._m(0),a("tbody",t._l(t.historialPrecios,(function(e,o){return a("tr",{key:o},[a("td",[t._v(t._s(t.formatDate(e.fecha)))]),a("td",[t._v("$"+t._s(t.formatNumber(e.precio)))]),a("td",[e.clienteId?a("span",{staticClass:"cliente-especifico-tag",style:{backgroundColor:t.obtenerColorCliente(e.clienteId)}},[t._v(" "+t._s(t.obtenerNombreCliente(e.clienteId))+" ")]):a("span",[t._v("General")])]),a("td",[o<t.historialPrecios.length-1?a("span",{class:{"precio-subio":e.precio<t.historialPrecios[o+1].precio,"precio-bajo":e.precio>t.historialPrecios[o+1].precio}},[t._v(" "+t._s(t.calcularCambio(e.precio,t.historialPrecios[o+1].precio))+" ")]):t._e()]),a("td",{staticClass:"actions-cell"},[a("button",{staticClass:"delete-btn",attrs:{title:"Eliminar precio"},on:{click:function(a){return t.eliminarPrecio(e)}}},[a("span",{staticClass:"delete-icon"},[t._v("×")])])])])})),0)])])]):t._e()])]):t._e()])},r=[function(){var e=this,t=e._self._c;return t("thead",[t("tr",[t("th",[e._v("Fecha")]),t("th",[e._v("Precio")]),t("th",[e._v("Cliente")]),t("th",[e._v("Cambio")]),t("th",[e._v("Acciones")])])])}],i=(a("14d9"),a("dc59")),s=a("1494"),n={name:"PreciosHistorialModal",props:{clienteActual:{type:String,default:""}},data(){return{showModal:!1,showHistorialModal:!1,preciosActuales:[],historialPrecios:[],productoSeleccionado:null,categorias:["Camarón S/C","Camarón C/C","Otros"],clientes:[{id:"joselito",nombre:"Joselito",color:"#2196F3"},{id:"catarro",nombre:"Catarro",color:"#d32f2f"},{id:"otilio",nombre:"Otilio",color:"#FFD700"},{id:"ozuna",nombre:"Ozuna",color:"#07711e"}],filtroCliente:"",newPrice:{producto:"",precio:null,fecha:(new Date).toISOString().split("T")[0],categoria:"Otros",esClienteEspecifico:!1,clienteId:""}}},computed:{currentDate(){return(new Date).toISOString().split("T")[0]},preciosOrdenados(){const e={};return this.categorias.forEach(t=>{e[t]=[]}),this.preciosActuales.forEach(t=>{const a=t.producto.toLowerCase();a.includes("s/c")||a.match(/\d+\/\d+/)?e["Camarón S/C"].push(t):a.includes("c/c")?e["Camarón C/C"].push(t):e["Otros"].push(t)}),Object.keys(e).forEach(t=>{e[t].sort((e,t)=>{const a=e=>{const t=e.match(/(\d+)\/(\d+)/);return t?[parseInt(t[1]),parseInt(t[2])]:[0,0]},o=a(e.producto),r=a(t.producto);return o[0]&&r[0]?o[0]-r[0]:e.producto.localeCompare(t.producto)})}),e}},methods:{formatNumber(e){return(null===e||void 0===e?void 0:e.toLocaleString("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2}))||"0.00"},formatDate(e){if(!e)return"";const t={year:"numeric",month:"long",day:"numeric"};return new Date(e).toLocaleDateString("es-ES",t)},calcularCambio(e,t){const a=e-t,o=a/t*100,r=a>0?"+":"";return`${r}${this.formatNumber(a)} (${r}${o.toFixed(1)}%)`},async cargarPreciosActuales(){try{const e=Object(s["c"])(i["a"],"precios"),t=Object(s["o"])(e,Object(s["l"])("fecha","desc")),a=await Object(s["g"])(t),o=new Map;a.docs.forEach(e=>{const t={id:e.id,...e.data()},a=t.clienteId?`${t.producto}-${t.clienteId}`:t.producto;o.has(a)||o.set(a,{producto:t.producto,precioActual:t.precio,fechaActual:t.fecha,clienteId:t.clienteId||null,historial:[]}),o.get(a).historial.push({id:e.id,fecha:t.fecha,precio:t.precio,clienteId:t.clienteId||null})}),this.preciosActuales=Array.from(o.values()).map(e=>({id:e.historial[0].id,producto:e.producto,precio:e.precioActual,fecha:e.fechaActual,clienteId:e.clienteId,historial:e.historial}))}catch(e){console.error("Error al cargar precios:",e)}},obtenerNombreCliente(e){const t=this.clientes.find(t=>t.id===e);return t?t.nombre:"Cliente desconocido"},obtenerColorCliente(e){const t=this.clientes.find(t=>t.id===e);return t?t.color:"#2196F3"},obtenerColorClienteConOpacidad(e){const t=this.clientes.find(t=>t.id===e);if(!t)return"rgba(33, 150, 243, 0.1)";let a=t.color.replace("#",""),o=parseInt(a.substring(0,2),16),r=parseInt(a.substring(2,4),16),i=parseInt(a.substring(4,6),16);return`rgba(${o}, ${r}, ${i}, 0.15)`},seleccionarCliente(e){this.newPrice.clienteId=e},filtrarPreciosPorCliente(e){if(this.filtroCliente){const t=e.filter(e=>e.clienteId===this.filtroCliente),a=e.filter(e=>!e.clienteId),o={};t.forEach(e=>{o[e.producto]=!0});const r=a.filter(e=>!o[e.producto]);return[...t,...r]}{const t={};return e.forEach(e=>{e.clienteId||(t[e.producto]=e)}),e.forEach(e=>{e.clienteId&&(t[e.producto]=e)}),Object.values(t)}},async agregarPrecio(){if(this.newPrice.producto&&this.newPrice.precio&&this.newPrice.fecha)if(!this.newPrice.esClienteEspecifico||this.newPrice.clienteId)try{const e=new Date(this.newPrice.fecha);e.setDate(e.getDate()+1);const t=e.toISOString().split("T")[0],a=this.newPrice.producto.toLowerCase();let o="Otros";a.includes("s/c")||a.match(/\d+\/\d+/)?o="Camarón S/C":a.includes("c/c")&&(o="Camarón C/C");const r={producto:this.newPrice.producto,precio:this.newPrice.precio,fecha:t,categoria:o};this.newPrice.esClienteEspecifico&&this.newPrice.clienteId&&(r.clienteId=this.newPrice.clienteId),await Object(s["b"])(Object(s["c"])(i["a"],"precios"),r),this.newPrice={producto:"",precio:null,fecha:(new Date).toISOString().split("T")[0],categoria:"Otros",esClienteEspecifico:!1,clienteId:""},await this.cargarPreciosActuales()}catch(e){console.error("Error al agregar precio:",e),alert("Error al guardar el precio")}else alert("Por favor seleccione un cliente");else alert("Por favor complete todos los campos")},async eliminarPrecio(e){if(confirm("¿Estás seguro de que deseas eliminar este precio?"))try{if(await Object(s["d"])(Object(s["e"])(i["a"],"precios",e.id)),await this.cargarPreciosActuales(),this.productoSeleccionado){const e=this.preciosActuales.find(e=>e.producto===this.productoSeleccionado.producto);e?this.historialPrecios=e.historial:this.showHistorialModal=!1}}catch(t){console.error("Error al eliminar precio:",t),alert("Error al eliminar el precio")}},async mostrarHistorial(e){try{this.productoSeleccionado=e,this.historialPrecios=e.historial,this.showHistorialModal=!0}catch(t){console.error("Error al cargar historial:",t),alert("Error al cargar el historial de precios")}},abrirModal(){this.clienteActual&&this.clientes.some(e=>e.id===this.clienteActual)&&(this.filtroCliente=this.clienteActual,this.newPrice.esClienteEspecifico=!0,this.newPrice.clienteId=this.clienteActual),this.showModal=!0}},watch:{clienteActual:{immediate:!0,handler(e){e&&this.clientes.some(t=>t.id===e)&&(this.filtroCliente=e,e&&(this.newPrice.esClienteEspecifico=!0,this.newPrice.clienteId=e))}}},mounted(){this.cargarPreciosActuales()}},c=n,l=(a("8fc1"),a("2877")),d=Object(l["a"])(c,o,r,!1,null,"db47f1b8",null);t["a"]=d.exports},"6bfe":function(e,t,a){},"73bd":function(e,t,a){"use strict";var o=function(){var e=this,t=e._self._c;return t("div",[t("button",{staticClass:"medidas-btn",on:{click:function(t){e.showModal=!0}}},[t("i",{staticClass:"fas fa-ruler"}),e._v(" Medidas ")]),e.showModal?t("div",{staticClass:"modal-overlay"},[t("div",{staticClass:"modal-content"},[t("div",{staticClass:"modal-header"},[t("h2",[e._v("Gestión de Medidas")]),t("button",{staticClass:"close-btn",on:{click:e.cerrarModal}},[e._v("×")])]),t("div",{staticClass:"add-medida-form"},[t("h3",[e._v("Agregar Nueva Medida")]),t("div",{staticClass:"form-group"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.newMedida.nombre,expression:"newMedida.nombre"}],staticClass:"medida-input",attrs:{type:"text",placeholder:"Nombre de la medida"},domProps:{value:e.newMedida.nombre},on:{input:function(t){t.target.composing||e.$set(e.newMedida,"nombre",t.target.value)}}}),t("button",{staticClass:"add-btn",on:{click:e.agregarMedida}},[e._v("Agregar")])])]),t("div",{staticClass:"medidas-list"},[t("div",{staticClass:"medidas-grid"},e._l(e.medidasOrdenadas,(function(a){return t("div",{key:a.id,staticClass:"medida-card"},[t("span",{staticClass:"medida-nombre"},[e._v(e._s(a.nombre))]),t("button",{staticClass:"delete-btn",attrs:{title:"Eliminar medida"},on:{click:function(t){return e.eliminarMedida(a.id)}}},[e._v(" × ")])])})),0)]),t("div",{staticClass:"modal-footer"},[t("button",{staticClass:"cancel-btn",on:{click:e.cerrarModal}},[e._v("Cerrar")])])])]):e._e()])},r=[],i=(a("14d9"),a("dc59")),s=a("1494"),n={name:"MedidasModal",data(){return{showModal:!1,medidas:[],newMedida:{tipo:"granja",nombre:""}}},computed:{medidasOrdenadas(){const e=this.medidas.filter(e=>"especial"===e.tipo),t=this.medidas.filter(e=>"granja"===e.tipo);return e.sort((e,t)=>e.nombre.localeCompare(t.nombre)),t.sort((e,t)=>{const a=parseInt(e.nombre.split("/")[0]),o=parseInt(t.nombre.split("/")[0]);return a-o}),[...e,...t]}},methods:{async cargarMedidas(){try{const e=Object(s["c"])(i["a"],"medidas"),t=Object(s["o"])(e,Object(s["l"])("nombre")),a=await Object(s["g"])(t);this.medidas=a.docs.map(e=>({id:e.id,...e.data()}))}catch(e){console.error("Error al cargar medidas:",e),alert("Error al cargar las medidas")}},async agregarMedida(){if(this.newMedida.nombre)try{const e=await Object(s["b"])(Object(s["c"])(i["a"],"medidas"),{tipo:this.newMedida.tipo,nombre:this.newMedida.nombre});this.medidas.push({id:e.id,tipo:this.newMedida.tipo,nombre:this.newMedida.nombre}),this.newMedida.nombre=""}catch(e){console.error("Error al agregar medida:",e),alert("Error al guardar la medida")}else alert("Por favor ingrese el nombre de la medida")},async eliminarMedida(e){if(confirm("¿Estás seguro de que deseas eliminar esta medida?"))try{await Object(s["d"])(Object(s["e"])(i["a"],"medidas",e)),this.medidas=this.medidas.filter(t=>t.id!==e)}catch(t){console.error("Error al eliminar medida:",t),alert("Error al eliminar la medida")}},cerrarModal(){this.showModal=!1,this.$emit("medidas-actualizadas",this.medidas)}},mounted(){this.cargarMedidas()}},c=n,l=(a("4786"),a("2877")),d=Object(l["a"])(c,o,r,!1,null,"60908f5b",null);t["a"]=d.exports},"74c9":function(e,t,a){"use strict";var o=function(){var e=this,t=e._self._c;return t("router-link",{staticClass:"btn-back",attrs:{to:e.to}},[e._v("Atrás")])},r=[],i={props:{to:{type:String,required:!0}}},s=i,n=(a("e0fe"),a("2877")),c=Object(n["a"])(s,o,r,!1,null,null,null);t["a"]=c.exports},"7dfe":function(e,t,a){},"8fc1":function(e,t,a){"use strict";a("904d")},"900f":function(e,t,a){"use strict";var o=function(){var e=this,t=e._self._c;return t("div",{staticClass:"canvas-dibujo-container"},[t("h3",[e._v("Dibujo y Notas")]),t("div",{staticClass:"toolbar"},[t("button",{class:{active:e.isPenMode},attrs:{id:"pen-btn"},on:{click:e.activatePenMode}},[e._v("✏️ Lápiz")]),t("button",{class:{active:!e.isPenMode&&!e.eraserMode},attrs:{id:"select-btn"},on:{click:e.activateSelectMode}},[e._v("👆 Seleccionar")]),t("button",{class:{active:e.eraserMode},attrs:{id:"eraser-btn"},on:{click:e.activateEraserMode}},[e._v("🧹 Borrador")]),t("div",{staticClass:"separator"}),t("button",{attrs:{id:"undo-btn",title:"Retroceder un paso",disabled:e.historyIndex<=0},on:{click:e.undo}},[e._v("↩️ Deshacer")]),t("button",{attrs:{id:"redo-btn",title:"Avanzar un paso",disabled:e.historyIndex>=e.history.length-1},on:{click:e.redo}},[e._v("↪️ Rehacer")]),t("div",{staticClass:"separator"}),t("button",{attrs:{id:"arrow-btn"},on:{click:e.addArrow}},[e._v("↗️ Flecha")]),t("div",{staticClass:"separator"}),t("div",[t("select",{directives:[{name:"model",rawName:"v-model",value:e.currentPenSize,expression:"currentPenSize"}],attrs:{id:"pen-size"},on:{change:[function(t){var a=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.currentPenSize=t.target.multiple?a:a[0]},e.updatePenSize]}},[t("option",{attrs:{value:"1"}},[e._v("Fino")]),t("option",{attrs:{value:"3",selected:""}},[e._v("Medio")]),t("option",{attrs:{value:"5"}},[e._v("Grueso")])])]),t("div",{staticClass:"separator"}),t("div",{staticStyle:{display:"flex",gap:"5px"}},e._l(e.colors,(function(a){return t("div",{key:a,staticClass:"color-btn",style:{backgroundColor:a},attrs:{"data-color":a},on:{click:function(t){return e.changeColor(a)}}})})),0),t("div",{staticClass:"separator"}),t("button",{attrs:{id:"clear-btn"},on:{click:e.clearCanvas}},[e._v("🗑️ Limpiar")])]),t("div",{staticClass:"canvas-container"},[t("div",{staticClass:"canvas-wrapper"},[t("canvas",{ref:"canvas"})])]),t("div",{attrs:{id:"status-bar"}},[e._v(" Presión: "+e._s(e.pressure.toFixed(2))+" | Posición: "+e._s(e.position.x)+", "+e._s(e.position.y)+" ")])])},r=[];a("14d9");const i=window.fabric;var s={name:"CanvasDibujo",data(){return{canvas:null,canvasWidth:800,canvasHeight:400,colors:["#000000","#e74c3c","#3498db","#2ecc71"],currentColor:"#000000",currentPenSize:3,isPenMode:!0,eraserMode:!1,pressure:0,position:{x:0,y:0},history:[],historyIndex:-1,canvasInitialized:!1}},mounted(){console.log("Fabric disponible:","undefined"!==typeof i),this.$nextTick(()=>{setTimeout(()=>{this.initCanvas()},100)}),window.addEventListener("resize",this.resizeCanvas)},beforeDestroy(){window.removeEventListener("resize",this.resizeCanvas),this.canvas&&(this.canvas.dispose(),this.canvas=null)},methods:{initCanvas(){try{if(!this.$refs.canvas)return void console.error("Elemento canvas no encontrado en el DOM");if("undefined"===typeof i)return console.error("Fabric.js no está disponible"),void setTimeout(()=>{console.log("Reintentando inicializar canvas..."),this.initCanvas()},500);if(console.log("Inicializando canvas con fabric:",i),this.resizeCanvasDimensions(),this.canvas=new i.Canvas(this.$refs.canvas,{width:this.canvasWidth,height:this.canvasHeight,isDrawingMode:!0,enableRetinaScaling:!0}),!this.canvas)return void console.error("Error al inicializar el canvas de fabric.js");this.canvas.freeDrawingBrush=new i.PencilBrush(this.canvas),this.canvas.freeDrawingBrush.width=this.currentPenSize,this.canvas.freeDrawingBrush.color=this.currentColor,this.setupCanvasEvents(),this.canvasInitialized=!0,this.saveToHistory(),this.updateHistoryButtons(),console.log("Canvas inicializado correctamente")}catch(e){console.error("Error al inicializar el canvas:",e),setTimeout(()=>{console.log("Reintentando inicializar canvas después de error..."),this.initCanvas()},1e3)}},resizeCanvasDimensions(){try{const e=this.$el?this.$el.clientWidth||document.documentElement.clientWidth:800;this.canvasWidth=Math.min(e-40,800),window.innerWidth<=768?this.canvasHeight=Math.min(window.innerHeight/3,300):this.canvasHeight=Math.min(window.innerHeight/2,400)}catch(e){console.error("Error al dimensionar el canvas:",e)}},resizeCanvas(){try{this.resizeCanvasDimensions(),this.canvas&&(this.canvas.setWidth(this.canvasWidth),this.canvas.setHeight(this.canvasHeight),this.canvas.renderAll())}catch(e){console.error("Error al redimensionar el canvas:",e)}},setupCanvasEvents(){if(this.canvas)try{this.canvas.on("path:created",()=>{this.saveToHistory()}),this.canvas.on("mouse:down",e=>{if(this.canvas){if(this.eraserMode){const t=this.canvas.getPointer(e.e);this.eraseObjectAtPoint(t)}if(this.canvas.isDrawingMode&&e.e.pressure&&(this.pressure=e.e.pressure,this.isPenMode&&this.canvas.freeDrawingBrush)){const e=Math.max(.5,Math.min(2,this.pressure))*this.currentPenSize;this.canvas.freeDrawingBrush.width=e}this.updatePosition(e.e)}}),this.canvas.on("mouse:move",e=>{if(this.canvas){if(this.canvas.isDrawingMode&&e.e.pressure&&this.isPenMode&&this.canvas.freeDrawingBrush){this.pressure=e.e.pressure;const t=Math.max(.5,Math.min(2,this.pressure))*this.currentPenSize;this.canvas.freeDrawingBrush.width=t}this.updatePosition(e.e)}}),this.canvas.on("object:added",()=>{this.canvas&&(this.canvas.isDrawingMode||this.saveToHistory())}),this.canvas.on("object:modified",()=>{this.canvas&&this.saveToHistory()}),this.canvas.on("object:removed",()=>{this.canvas&&(this.eraserMode||this.saveToHistory())})}catch(e){console.error("Error al configurar eventos del canvas:",e)}},saveToHistory(){if(this.canvas)try{this.historyIndex<this.history.length-1&&(this.history=this.history.slice(0,this.historyIndex+1));const e=JSON.stringify(this.canvas.toJSON());this.history.push(e),this.historyIndex=this.history.length-1,this.updateHistoryButtons()}catch(e){console.error("Error al guardar historial:",e)}},undo(){if(this.canvas)try{this.historyIndex>0&&(this.historyIndex--,this.loadFromHistory())}catch(e){console.error("Error en operación deshacer:",e)}},redo(){if(this.canvas)try{this.historyIndex<this.history.length-1&&(this.historyIndex++,this.loadFromHistory())}catch(e){console.error("Error en operación rehacer:",e)}},loadFromHistory(){if(this.canvas)try{this.historyIndex>=0&&this.historyIndex<this.history.length&&this.canvas.loadFromJSON(this.history[this.historyIndex],()=>{this.canvas.renderAll(),this.updateHistoryButtons()})}catch(e){console.error("Error al cargar desde historial:",e)}},updateHistoryButtons(){},activatePenMode(){if(this.canvas)try{this.eraserMode=!1,this.canvas.isDrawingMode=!0,this.canvas.freeDrawingBrush&&(this.canvas.freeDrawingBrush.color=this.currentColor,this.canvas.freeDrawingBrush.width=this.currentPenSize),this.isPenMode=!0,this.canvas.defaultCursor="default"}catch(e){console.error("Error al activar modo lápiz:",e)}},activateSelectMode(){if(this.canvas)try{this.eraserMode=!1,this.canvas.isDrawingMode=!1,this.isPenMode=!1,this.canvas.defaultCursor="default"}catch(e){console.error("Error al activar modo selección:",e)}},activateEraserMode(){if(this.canvas)try{this.eraserMode=!0,this.canvas.isDrawingMode=!1,this.isPenMode=!1,this.canvas.defaultCursor="crosshair"}catch(e){console.error("Error al activar modo borrador:",e)}},eraseObjectAtPoint(e){if(!this.canvas)return!1;try{const t=this.canvas.getObjects();for(let a=t.length-1;a>=0;a--){const o=t[a];if(o.containsPoint(e))return this.canvas.remove(o),this.canvas.renderAll(),this.saveToHistory(),!0}}catch(t){console.error("Error al borrar objeto:",t)}return!1},addArrow(){if(this.canvas)try{this.activateSelectMode();const e=new i.Path("M 0 0 L 100 0 M 90 -10 L 100 0 L 90 10",{stroke:this.currentColor,strokeWidth:2,left:this.canvas.width/2-50,top:this.canvas.height/2,strokeLineCap:"round",strokeLineJoin:"round"});this.canvas.add(e),this.canvas.setActiveObject(e),this.saveToHistory()}catch(e){console.error("Error al añadir flecha:",e)}},clearCanvas(){if(this.canvas)try{confirm("¿Estás seguro que deseas limpiar todo el lienzo?")&&(this.canvas.clear(),this.saveToHistory())}catch(e){console.error("Error al limpiar canvas:",e)}},updatePosition(e){if(this.canvas&&this.canvas.upperCanvasEl)try{const t=this.canvas.upperCanvasEl.getBoundingClientRect();this.position={x:Math.round(e.clientX-t.left),y:Math.round(e.clientY-t.top)}}catch(t){console.error("Error al actualizar posición:",t)}},updatePenSize(){if(this.canvas&&this.isPenMode&&this.canvas.freeDrawingBrush)try{this.canvas.freeDrawingBrush.width=this.currentPenSize}catch(e){console.error("Error al actualizar tamaño de lápiz:",e)}},changeColor(e){if(this.canvas)try{this.currentColor=e,this.isPenMode&&this.canvas.freeDrawingBrush&&(this.canvas.freeDrawingBrush.color=this.currentColor)}catch(t){console.error("Error al cambiar color:",t)}}}},n=s,c=(a("c990"),a("2877")),l=Object(c["a"])(n,o,r,!1,null,"2a16441d",null);t["a"]=l.exports},"904d":function(e,t,a){},9226:function(e,t,a){"use strict";a("928d")},"928d":function(e,t,a){},"9df4":function(e,t,a){"use strict";var o=function(){var e=this,t=e._self._c;return e.isOpen?t("div",{staticClass:"modal-overlay",on:{click:e.closeModal}},[t("div",{staticClass:"modal-content",on:{click:function(e){e.stopPropagation()}}},[t("h2",[e._v("Historial de Producto")]),t("div",{staticClass:"form-group"},[t("select",{directives:[{name:"model",rawName:"v-model",value:e.filtros.tipo,expression:"filtros.tipo"}],on:{change:[function(t){var a=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(e.filtros,"tipo",t.target.multiple?a:a[0])},e.resetSelections]}},[t("option",{attrs:{value:""}},[e._v("Seleccionar Tipo")]),t("option",{attrs:{value:"proveedor"}},[e._v("Proveedor")]),t("option",{attrs:{value:"maquila"}},[e._v("Maquila")])]),t("select",{directives:[{name:"model",rawName:"v-model",value:e.filtros.proveedor,expression:"filtros.proveedor"}],on:{change:[function(t){var a=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(e.filtros,"proveedor",t.target.multiple?a:a[0])},e.onProveedorChange]}},[t("option",{attrs:{value:""}},[e._v("Seleccionar "+e._s("maquila"===e.filtros.tipo?"Maquila":"Proveedor"))]),e._l(e.proveedoresFiltrados,(function(a){return t("option",{key:a.id,domProps:{value:a.nombre}},[e._v(" "+e._s(a.nombre)+" ")])}))],2),t("select",{directives:[{name:"model",rawName:"v-model",value:e.filtros.medida,expression:"filtros.medida"}],on:{change:function(t){var a=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(e.filtros,"medida",t.target.multiple?a:a[0])}}},[t("option",{attrs:{value:""}},[e._v("Seleccionar Medida")]),e._l(e.medidasFiltradas,(function(a){return t("option",{key:a.id,domProps:{value:a.nombre}},[e._v(" "+e._s(a.nombre)+" ")])}))],2),t("select",{directives:[{name:"model",rawName:"v-model",value:e.filtros.movimiento,expression:"filtros.movimiento"}],on:{change:function(t){var a=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(e.filtros,"movimiento",t.target.multiple?a:a[0])}}},[t("option",{attrs:{value:""}},[e._v("Tipo de Movimiento")]),t("option",{attrs:{value:"entradas"}},[e._v("Entradas")]),t("option",{attrs:{value:"salidas"}},[e._v("Salidas")])]),t("button",{attrs:{disabled:!e.isFormValid},on:{click:e.buscarHistorial}},[e._v("Buscar")])]),e.historial.length>0?t("div",{staticClass:"results-container"},[t("table",[e._m(0),t("tbody",e._l(e.historial,(function(a,o){return t("tr",{key:o},[t("td",[e._v(e._s(e.formatDate(a.fecha)))]),t("td",[e._v(e._s(e.formatNumber(a.kilos))+" kg")]),t("td",[e._v(e._s(a.precio?"$"+a.precio:"-"))])])})),0),t("tfoot",[t("tr",[e._m(1),t("td",[t("strong",[e._v(e._s(e.formatNumber(e.totalKilos))+" kg")])]),t("td")])])])]):e.busquedaRealizada?t("div",{staticClass:"no-results"},[e._v(" No se encontraron registros para los criterios seleccionados. ")]):e._e(),t("button",{staticClass:"close-button",on:{click:e.closeModal}},[e._v("×")])])]):e._e()},r=[function(){var e=this,t=e._self._c;return t("thead",[t("tr",[t("th",[e._v("Fecha")]),t("th",[e._v("Kilos")]),t("th",[e._v("Precio")])])])},function(){var e=this,t=e._self._c;return t("td",[t("strong",[e._v("Total")])])}],i=(a("14d9"),a("13d5"),a("dc59")),s=a("1494"),n=a("c1df"),c=a.n(n),l={name:"HistorialProductoModal",props:{isOpen:{type:Boolean,required:!0},proveedores:{type:Array,required:!0},medidas:{type:Array,required:!0}},data(){return{filtros:{tipo:"",proveedor:"",medida:"",movimiento:""},historial:[],busquedaRealizada:!1}},computed:{proveedoresFiltrados(){return this.proveedores.filter(e=>e.tipo===this.filtros.tipo)},medidasFiltradas(){if("maquila"===this.filtros.tipo){const e=this.proveedores.find(e=>e.nombre===this.filtros.proveedor);return e?this.medidas.filter(t=>"maquila"===t.tipo&&t.maquilaId===e.id):[]}{const e=this.proveedores.find(e=>e.nombre===this.filtros.proveedor);return e?this.medidas.filter(t=>t.proveedorId===e.id||!t.proveedorId&&"general"===t.tipo):this.medidas.filter(e=>"general"===e.tipo)}},isFormValid(){return this.filtros.tipo&&this.filtros.proveedor&&this.filtros.medida&&this.filtros.movimiento},totalKilos(){return this.historial.reduce((e,t)=>e+t.kilos,0)}},methods:{resetSelections(){this.filtros.proveedor="",this.filtros.medida="",this.historial=[],this.busquedaRealizada=!1},onProveedorChange(){this.filtros.medida="",this.historial=[],this.busquedaRealizada=!1},async buscarHistorial(){try{const e=Object(s["c"])(i["a"],"sacadas"),t=Object(s["o"])(e,Object(s["l"])("fecha","desc")),a=await Object(s["g"])(t);this.historial=[],a.docs.forEach(e=>{const t=e.data(),a=t[this.filtros.movimiento]||[];a.forEach(e=>{e.tipo===this.filtros.tipo&&e.proveedor===this.filtros.proveedor&&e.medida===this.filtros.medida&&this.historial.push({fecha:t.fecha.toDate(),kilos:e.kilos,precio:e.precio})})}),this.busquedaRealizada=!0}catch(e){console.error("Error al buscar historial:",e),alert("Error al buscar el historial")}},formatDate(e){return c()(e).format("DD/MM/YYYY")},formatNumber(e){return e.toLocaleString("es-ES",{minimumFractionDigits:1,maximumFractionDigits:1})},closeModal(){this.$emit("close"),this.resetSelections()}}},d=l,u=(a("e45f"),a("2877")),v=Object(u["a"])(d,o,r,!1,null,"4cc8972a",null);t["a"]=v.exports},a691:function(e,t,a){},b7d6:function(e,t,a){},c3cc:function(e,t,a){"use strict";a("4a6a")},c990:function(e,t,a){"use strict";a("a691")},cec2:function(e,t,a){},d1d7:function(e,t,a){"use strict";var o=function(){var e=this,t=e._self._c;return e.mostrar?t("div",{staticClass:"modal-overlay",on:{click:function(t){return t.target!==t.currentTarget?null:e.cerrarModal.apply(null,arguments)}}},[t("div",{staticClass:"modal-content"},[t("h3",[e._v("Proveedor")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.proveedorLocal,expression:"proveedorLocal"}],staticClass:"input-proveedor",attrs:{type:"text",placeholder:"Nombre del proveedor"},domProps:{value:e.proveedorLocal},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.guardarProveedor.apply(null,arguments)},input:function(t){t.target.composing||(e.proveedorLocal=t.target.value)}}}),t("div",{staticClass:"modal-buttons"},[t("button",{staticClass:"btn-guardar",on:{click:e.guardarProveedor}},[e._v("Guardar")]),t("button",{staticClass:"btn-cancelar",on:{click:e.cerrarModal}},[e._v("Cancelar")])])])]):e._e()},r=[],i={name:"ProveedorModal",props:{mostrar:{type:Boolean,required:!0},proveedor:{type:String,default:""}},data(){return{proveedorLocal:this.proveedor}},watch:{mostrar(e){e&&(this.proveedorLocal=this.proveedor)}},methods:{cerrarModal(){this.$emit("cerrar")},guardarProveedor(){this.$emit("guardar",this.proveedorLocal),this.cerrarModal()}}},s=i,n=(a("fbdc"),a("2877")),c=Object(n["a"])(s,o,r,!1,null,"69665719",null);t["a"]=c.exports},e0fe:function(e,t,a){"use strict";a("5355")},e1ab:function(e,t,a){},e45f:function(e,t,a){"use strict";a("7dfe")},e6b2:function(e,t,a){"use strict";a("1b56")},f90b:function(e,t,a){"use strict";a("0836")},f971:function(e,t,a){"use strict";a("6bfe")},fbdc:function(e,t,a){"use strict";a("2efd")}}]);