(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["app.ea1f58e8"],{"29a7":function(e,t,o){"use strict";o("14d9");const r={checkAuthState(){const e={localStorage:this.checkLocalStorage(),authStore:this.checkAuthStore(),recommendations:[]};return this.generateRecommendations(e),e},checkLocalStorage(){try{const e=localStorage.getItem("user");if(!e)return{status:"error",message:"No hay datos de usuario en localStorage",data:null};const t=JSON.parse(e),o=!!t.username,r=!!t.userId;return{status:o&&r?"ok":"warning",message:o&&r?"Datos de localStorage v√°lidos":"Datos de localStorage incompletos",data:{hasUsername:o,hasUserId:r,username:t.username,userId:t.userId}}}catch(e){return{status:"error",message:"Error al leer localStorage: "+e.message,data:null}}},checkAuthStore(){try{Promise.resolve().then(o.bind(null,"f549")).then(({useAuthStore:e})=>{var t;const o=e();return{status:o.isAuthenticated?"ok":"error",message:o.isAuthenticated?"Usuario autenticado correctamente":"Usuario no autenticado en el store",data:{isAuthenticated:o.isAuthenticated,userId:o.userId,username:null===(t=o.user)||void 0===t?void 0:t.username}}})}catch(e){return{status:"error",message:"Error al acceder al store de autenticaci√≥n: "+e.message,data:null}}},generateRecommendations(e){"error"===e.localStorage.status&&e.recommendations.push({type:"critical",message:"Limpie el localStorage y vuelva a iniciar sesi√≥n",action:()=>this.clearAuthData()}),"warning"===e.localStorage.status&&e.recommendations.push({type:"warning",message:"Los datos de usuario est√°n incompletos, reinicie la sesi√≥n",action:()=>this.clearAuthData()}),e.authStore&&"error"===e.authStore.status&&e.recommendations.push({type:"warning",message:"Ejecute checkAuth() para restaurar la sesi√≥n",action:()=>this.restoreAuth()})},clearAuthData(){try{return localStorage.removeItem("user"),!0}catch(e){return console.error("Error al limpiar datos de autenticaci√≥n:",e),!1}},async restoreAuth(){try{const{useAuthStore:e}=await Promise.resolve().then(o.bind(null,"f549")),t=e();return t.checkAuth(),t.isAuthenticated}catch(e){return console.error("Error al restaurar autenticaci√≥n:",e),!1}},async runFullDiagnostic(){const e=this.checkAuthState();return e.recommendations.length,e},enableAuthErrorMonitoring(){const e=console.error;console.error=(...t)=>{const o=t.join(" ");o.includes("Unsupported field value: undefined")&&o.includes("userId")&&(console.warn("üö® Error de autenticaci√≥n detectado autom√°ticamente"),this.runFullDiagnostic()),e.apply(console,t)}}};"undefined"!==typeof window&&(window.authDiagnostic=r)},"2ddf":function(e,t,o){"use strict";o.d(t,"b",(function(){return s})),o.d(t,"d",(function(){return l})),o.d(t,"e",(function(){return c})),o.d(t,"f",(function(){return d})),o.d(t,"a",(function(){return u}));var r=o("e499"),a=o.n(r),n=o("4ebb"),i=o.n(n);const s=()=>{"object"===typeof i.a&&(i.a.pdfMake&&i.a.pdfMake.vfs?a.a.vfs=i.a.pdfMake.vfs:i.a.vfs?a.a.vfs=i.a.vfs:a.a.vfs=i.a),"undefined"===typeof window||window.pdfMake||(window.pdfMake=a.a)},l={header:{fontSize:24,bold:!0,color:"#3760b0",margin:[0,0,0,5]},tableHeader:{bold:!0,fontSize:14,color:"white",fillColor:"#3760b0"},rendimientoAlto:{color:"#27ae60",bold:!0},rendimientoBajo:{color:"#000000"},costoStyle:{color:"#e74c3c",bold:!0},gananciaPositiva:{color:"#27ae60",bold:!0},gananciaNegativa:{color:"#e74c3c",bold:!0},tableTotal:{bold:!0,fontSize:20,color:"#2c3e50",fillColor:"#e8f4f8"},tableTotalNegativo:{bold:!0,fontSize:20,color:"#e74c3c",fillColor:"#e8f4f8"}},c={hLineWidth:function(e,t){return 0===e||e===t.table.body.length?1.5:.5},vLineWidth:function(e,t){return 0===e||e===t.table.widths.length?1.5:.5},hLineColor:function(e,t){return 0===e||e===t.table.body.length?"#3760b0":"#cccccc"},vLineColor:function(e,t){return 0===e||e===t.table.widths.length?"#3760b0":"#cccccc"},fillColor:function(e,t,o){return e%2===0?"#f8f9fa":null},paddingLeft:function(e){return 4},paddingRight:function(e){return 4},paddingTop:function(e){return 2},paddingBottom:function(e){return 2}},d={hLineWidth:function(e,t){return 0===e||e===t.table.body.length||e===t.table.body.length-1?1.5:.5},vLineWidth:function(e,t){return 0===e||e===t.table.widths.length?1.5:.5},hLineColor:function(e,t){return 0===e||e===t.table.body.length||e===t.table.body.length-1?"#3760b0":"#cccccc"},vLineColor:function(e,t){return 0===e||e===t.table.widths.length?"#3760b0":"#cccccc"},fillColor:function(e,t,o){return e===t.table.body.length-1?"#e8f4f8":e%2===0?"#f8f9fa":null},paddingLeft:function(e){return 4},paddingRight:function(e){return 4},paddingTop:function(e){return 2},paddingBottom:function(e){return 2}},u={defaultStyle:{fontSize:18},footer:function(e,t){return{columns:[{text:"¬© 2025 Rey Pez - Tampico, Tamps.",alignment:"center",margin:[0,5,0,0],fontSize:8,color:"#3760b0"}]}}};t["c"]=a.a},"2fe3":function(e,t,o){"use strict";o.d(t,"a",(function(){return y}));o("14d9"),o("13d5"),o("88e6"),o("70cc"),o("eb03"),o("22e5c"),o("c01e"),o("fa76"),o("8306");var r=o("e499"),a=o.n(r),n=o("4ebb"),i=o.n(n),s=o("dc59"),l=o("1494");let c=a.a;const d=()=>n&&"object"===typeof n?i.a&&"object"===typeof i.a?i.a:n:null,u=e=>{if(!e)return;const t=d();t&&(e.vfs=t)};try{u(c)}catch(q){console.warn("Error al inicializar pdfMake local:",q)}if("undefined"!==typeof window&&window.pdfMake){c=window.pdfMake;try{u(c)}catch(q){console.warn("Error al inicializar pdfMake global:",q)}}const h="undefined"!==typeof TextDecoder?new TextDecoder:null,g=e=>{if(!e)return"";if("string"===typeof e)return e;if(h)try{return h.decode(e)}catch(q){return console.warn("No se pudo decodificar el buffer del PDF:",q),""}return""},m=e=>{const t=g(e);if(!t)return 1;const o=t.match(/\/Page\b/g);return o?o.length:1},f="https://res.cloudinary.com/hwkcovsmr/image/upload/v1620946647/samples/REY_PEZ_LOGO_nsotww.png",b="https://res.cloudinary.com/hwkcovsmr/image/upload/w_1000,c_fill,ar_1:1,g_auto,r_max,bo_5px_solid_red,f_png,b_transparent/v1757615801/allan_logo_ra8ruv.jpg";async function p(e){try{const t=Object(l["c"])(s["a"],"precios"),o=Object(l["o"])(t,Object(l["t"])("producto","==",e)),r=await Object(l["g"])(o);if(r.empty)return null;const a=[],n=[];r.docs.forEach(e=>{const t=e.data();"catarro"===t.clienteId?a.push(t):t.clienteId||n.push(t)});const i=(e,t)=>{const o=e.fecha?new Date(e.fecha):new Date(0),r=t.fecha?new Date(t.fecha):new Date(0);return r-o};return a.length>0?(a.sort(i),a[0].precio):n.length>0?(n.sort(i),n[0].precio):null}catch(q){return console.error("Error al obtener precio:",q),null}}async function y(e,t,o,r={},a={},n={},i={}){try{if(!e||!e.productos||!Array.isArray(e.productos))return void console.warn("El embarque no contiene datos de productos v√°lidos",{embarque:e});Array.isArray(t)||(console.warn("Lista de clientes no v√°lida, usando array vac√≠o"),t=[]);const s=e=>{const o=(t||[]).find(t=>t.id.toString()===e.toString());return o?(o.nombreNotas||o.nombre||"").toString():""},l=Array.from(new Set((e&&e.productos||[]).map(e=>String(e.clienteId)).filter(Boolean)));let d=!1;if(1===l.length){const e=s(l[0]).toLowerCase();d=e.includes("veronica")||e.includes("lorena")}const u=" 2025 Rey Pez - Tampico, Tamps.",h="Allan Estuardo Reyes Garcia.  C.P 8920.  Tampico, Tamps.",g=d?h:u,p=await P(d?b:f),y="#9b59b6",F="#8e44ad",S="#e67e22",v="#d35400",A=d?S:y,k=d?v:F,L=[{columns:[{image:p,width:100,alignment:"left",margin:[0,0,0,10]},{text:"Nota de Venta",style:"notaVentaHeader",alignment:"center",margin:[0,20,0,0]},{stack:[{text:"Fecha: "+new Date(e.fecha).toLocaleString("es-MX",{timeZone:"UTC",year:"numeric",month:"2-digit",day:"2-digit"}),alignment:"right",margin:[0,20,0,0]},{text:"Carga con: "+(e.cargaCon||"No especificado"),alignment:"right",margin:[0,5,0,0]}]}]},{text:"\n"},...await w(e,t,o,r,a,n,i),...C({...e,kilosCrudos:e.kilosCrudos||{}},t)],T={},O={};Object.keys(a||{}).forEach(e=>{const t=a[e],o=i[e];T[e]=t&&o,O[e]=o});const N=[{columns:[{image:p,width:100,alignment:"left",margin:[0,0,0,10]},{text:"Nota de Embarque",style:"notaVentaHeader",alignment:"center",margin:[0,20,0,0]},{stack:[{text:"Fecha: "+new Date(e.fecha).toLocaleString("es-MX",{timeZone:"UTC",year:"numeric",month:"2-digit",day:"2-digit"}),alignment:"right",margin:[0,20,0,0]},{text:"Carga con: "+(e.cargaCon||"No especificado"),alignment:"right",margin:[0,5,0,0]}]}]},{text:"\n"},...await H(e,t,o,r,T,n,O)],z={content:[...L,{text:"",pageBreak:"before"},...N],styles:{notaVentaHeader:{color:"black",fontSize:40,bold:!0,italics:!0,characterSpacing:1},header:{fontSize:30,bold:!0,color:"#2980b9",margin:[0,0,0,10]},subheader:{fontSize:25,bold:!0,margin:[0,10,0,5]},tableHeader:{bold:!0,fontSize:23,color:"black",fillColor:"#ecf0f1"},clienteJoselito:{color:"#FFFFFF",background:"#0000FF",padding:[2,2,2,2]},clienteCatarro:{color:"#FFFFFF",background:"#FF0000",padding:[2,2,2,2]},clienteOtilio:{color:"#000000",background:"#FFD700",padding:[2,2,2,2]},clienteOzuna:{color:"#FFFFFF",background:"#008000",padding:[2,2,2,2]},clienteElizabeth:{color:"#FFFFFF",background:"#9b59b6",padding:[2,2,2,2]},clienteLorena:{color:"#FFFFFF",background:"#e67e22",padding:[2,2,2,2]},clienteOtro:{color:"#000000",background:"#808080",padding:[2,2,2,2]},medidaHeader:{fontSize:24,bold:!0,color:"#2c3e50",margin:[0,10,0,5]},precio:{color:"#FFFFFF",background:"#FF0000",padding:[2,2,2,2]},totalPrecio:{color:"#FFFFFF",background:A,padding:[2,2,2,2],bold:!0,fontSize:21},totalPrecioVeronica:{color:"#FFFFFF",background:S,padding:[2,2,2,2],bold:!0,fontSize:21},granTotal:{color:"#FFFFFF",background:k,padding:[4,4,4,4],bold:!0,fontSize:24},granTotalVeronica:{color:"#FFFFFF",background:v,padding:[4,4,4,4],bold:!0,fontSize:24},tipoConAgua:{color:"#2980b9",bold:!0},precioInline:{color:"#FFFFFF",background:"#FF0000",padding:[2,2,2,2],bold:!0},nota:{fontSize:18,color:"#666666",italics:!0}},defaultStyle:{fontSize:20},footer:function(e,t){return{columns:[{text:g,alignment:"center",margin:[0,10,0,0]}],margin:[40,0,40,0],fontSize:20,color:"#3760b0"}}};c.createPdf(z).getBuffer(t=>{const o=m(t),r=x(e);console.log(`Total de productos: ${r}, P√°ginas generadas: ${o}`);let a="ninguno";if(r>=8&&r<12?a="moderado":(r>=12||o>2)&&(a="agresivo"),"ninguno"!==a){const e={...z,defaultStyle:{...z.defaultStyle,fontSize:"moderado"===a?16:14},styles:{...z.styles,notaVentaHeader:{...z.styles.notaVentaHeader,fontSize:"moderado"===a?24:20},header:{...z.styles.header,fontSize:"moderado"===a?24:20},subheader:{...z.styles.subheader,fontSize:"moderado"===a?20:17},tableHeader:{...z.styles.tableHeader,fontSize:"moderado"===a?18:15},medidaHeader:{...z.styles.medidaHeader,fontSize:"moderado"===a?20:16},nota:{...z.styles.nota,fontSize:"moderado"===a?15:12},totalPrecio:{...z.styles.totalPrecio,fontSize:"moderado"===a?18:15},granTotal:{...z.styles.granTotal,fontSize:"moderado"===a?20:17}},footer:function(e,t){return{columns:[{text:g,alignment:"center",margin:[0,10,0,0]}],margin:[40,0,40,0],fontSize:"moderado"===a?16:14,color:"#3760b0"}}};c.createPdf(e).download("nota-venta.pdf"),console.log("PDF generado con nivel de reducci√≥n: "+a)}else c.createPdf(z).download("nota-venta.pdf"),console.log("PDF generado sin reducci√≥n de escala")})}catch(q){console.error("Error al generar el PDF:",q)}}function x(e){let t=0;return e.productos&&Array.isArray(e.productos)&&(t+=e.productos.filter(e=>{const t=(e.kilos||[]).reduce((e,t)=>e+(Number(t)||0),0);return t>0}).length),e.clienteCrudos&&Object.values(e.clienteCrudos).forEach(e=>{Array.isArray(e)&&e.forEach(e=>{e&&Array.isArray(e.items)&&(t+=e.items.filter(e=>e&&(e.taras||e.sobrante)).length)})}),t}async function w(e,t,o,r={},a={},n={},i={}){const s=[];let l=0,c=0;if(!e||!e.productos||!Array.isArray(e.productos))return console.warn("Datos de embarque inv√°lidos o productos no encontrados"),[{text:"No hay datos de productos disponibles",italics:!0,margin:[0,5,0,10]}];Array.isArray(t)||(console.warn("Lista de clientes no v√°lida"),t=[]);const d=e.productos.reduce((e,t)=>(e[t.clienteId]||(e[t.clienteId]=[]),e[t.clienteId].push(t),e),{});let u=!1,h=0;Object.entries(d).forEach(([e])=>{const o=z(e,t),r=a&&a[e],n=i&&i[e];(o.toLowerCase().includes("elizabeth")||o.toLowerCase().includes("catarro"))&&r&&n&&(u=!0)});for(const[g,m]of Object.entries(d)){const d=z(g,t),u=T(d),f=o&&o[g],b=r&&r[g],y=a&&a[g],x=i&&i[g],w=d.toLowerCase().includes("catarro"),C=n&&n.hasOwnProperty(g)?n[g]:w;w&&console.log("[DEBUG] Configuraci√≥n para cliente Catarro:",{clienteId:g,nombreCliente:d,esCatarro:w,clientesSumarKgCatarro:n,tienePropiedad:n&&n.hasOwnProperty(g),valorDirecto:n?n[g]:"N/A",sumarKgCatarroCliente:C});const F=m.filter(e=>{const t=M(e,d,b,C);return t>0});if(s.push({text:"Cliente: "+d,style:["subheader",u],margin:[0,5,0,5]}),F.length>0){let e=F;if(f){const t={};F.forEach(e=>{const o=e.nombreAlternativoPDF||e.medida,r=e.tipo||"",a=e.camaronNeto||.65,n="c/h20"===r?`${o}-${r}-${a}`:`${o}-${r}`;t[n]?(t[n].kilos.push(...e.kilos),t[n].taras.push(...e.taras),e.tarasExtra&&t[n].tarasExtra.push(...e.tarasExtra),e.reporteTaras&&t[n].reporteTaras.push(...e.reporteTaras),e.reporteBolsas&&t[n].reporteBolsas.push(...e.reporteBolsas),t[n].tarasInfo.push(...e.taras.map(t=>({valor:t,restarTaras:e.restarTaras}))),t[n].taras=t[n].tarasInfo.map(e=>e.valor)):t[n]={...e,medida:o,kilos:[...e.kilos],taras:[...e.taras],tarasExtra:[...e.tarasExtra||[]],reporteTaras:[...e.reporteTaras||[]],reporteBolsas:[...e.reporteBolsas||[]],tarasInfo:e.taras.map(t=>({valor:t,restarTaras:e.restarTaras}))}}),e=Object.values(t)}let t=v(e);const o=t.some(e=>{const t=M(e,d,b,C);return t>0});if(o){if(y){const e=t.map(async e=>{if(!e.precio&&!e.precioBorradoManualmente){const t=e.nombreAlternativoPDF||e.medida,o=await p(t);o&&(e.precio=o)}return e});t=await Promise.all(e)}s.push({text:"Limpio:",style:["subheader",u],margin:[0,5,0,5]},A(t,u,d,b,C,y,x),{text:"\n"});const e=m.reduce((e,t)=>e+E(t),0);e>0&&(l+=e,s.push({text:"Taras de limpio: "+e,margin:[0,5,0,5]},{text:"\n"}))}}if(e.clienteCrudos&&e.clienteCrudos[g]){const t=_(e.clienteCrudos,g,d);if(t){let t=e.clienteCrudos[g];if(y){const e=t.map(async e=>{const t=await Promise.all(e.items.map(async e=>{if(!e.precio&&!e.precioBorradoManualmente&&e.talla){const t=await p(e.talla);t&&(e.precio=t)}return e}));return{...e,items:t}});t=await Promise.all(e)}s.push({text:"Crudos:",style:["subheader",u],margin:[0,5,0,5]},k(t,u,y,x),{text:"\n"});const o=e.clienteCrudos[g].reduce((e,t)=>e+t.items.reduce((e,t)=>e+N(t),0),0);o>0&&(c+=o,s.push({text:"Taras de crudo: "+o,margin:[0,5,0,5]},{text:"\n"}))}}const S=F.length>0,L=e.clienteCrudos&&e.clienteCrudos[g]&&e.clienteCrudos[g].some(e=>e.items.some(e=>{const t=j(e,d),o=parseFloat(t);return o>0}));if(S||L||s.push({text:"No hay medidas registradas para este cliente",italics:!0,margin:[0,5,0,10]},{text:"\n"}),y&&x){let o=0,r=0;m.forEach(e=>{if(e.precio){let t=0;if("c/h20"===e.tipo){let o=0;const r=e.reporteTaras||[],a=e.reporteBolsas||[],n=e.camaronNeto||.65;for(let e=0;e<r.length;e++){const t=parseInt(r[e])||0,i=parseInt(a[e])||0;o+=t*i*n}t=o*Number(e.precio)}else{const o=M(e,d,b,C),r=d.toLowerCase().includes("ozuna")?Number(o.toFixed(1)):Math.round(o);t=r*Number(e.precio)}o+=t;const a=(e.taras||[]).reduce((e,t)=>e+(t||0),0),n=(e.tarasExtra||[]).reduce((e,t)=>e+(t||0),0);r+=a+n}});const a=d.toLowerCase(),n=a.includes("catarro");let i=o;if(n&&o>0){const e=70,t=Math.round(r*e);i=Math.max(0,Math.round(o)-t)}let s=0,l=0;e.clienteCrudos&&e.clienteCrudos[g]&&U(e.clienteCrudos,g,t,e=>{if(e.precio){const t=parseFloat(j(e,d)),o=Math.round(t);s+=o*Number(e.precio),l+=N(e)}});let c=s;if(n&&s>0){const e=60,t=Math.round(l*e);c=Math.max(0,Math.round(s)-t)}h+=i+c}}return l+c>0&&s.push(...W(l,c,h,u)),s}function C(e,t){const o=[];if(!e||!e.productos||!Array.isArray(e.productos))return console.warn("Datos de embarque inv√°lidos o productos no encontrados para rendimientos"),[];const r=e.productos.filter(e=>"4"===e.clienteId&&!e.esVenta);if(r.length>0){o.push({text:"Rendimientos de Maquila:",style:"subheader",margin:[0,20,0,10]});const t={table:{headerRows:1,widths:["33%","33%","34%"],body:[[{text:"Medida",style:"tableHeader"},{text:"Kilos en Crudo",style:"tableHeader"},{text:"Rendimiento",style:"tableHeader"}]]},layout:{hLineWidth:()=>1,vLineWidth:()=>1,hLineColor:()=>"#008000",vLineColor:()=>"#008000"}};let a=0,n=0;const i=r.reduce((e,t)=>{const o=t.medida;return e[o]||(e[o]=[]),e[o].push(t),e},{});Object.entries(i).forEach(([o,r])=>{const i=r.reduce((e,t)=>e+F(t),0);let s=0;const l=o+" Maquila Ozuna";e.kilosCrudos&&e.kilosCrudos[l]&&(s="object"===typeof e.kilosCrudos[l]?Number(e.kilosCrudos[l].medida1||0)+Number(e.kilosCrudos[l].medida2||0):Number(e.kilosCrudos[l]));const c=i>0?s/i:0;a+=s,n+=i,t.table.body.push([{text:o,alignment:"center"},{text:s.toFixed(2)+" kg",alignment:"center"},{text:c.toFixed(2),alignment:"center",color:c>1?"#27ae60":"#000000",bold:c>1}])});const s=n>0?a/n:0;t.table.body.push([{text:"TOTAL",style:"tableHeader",alignment:"center"},{text:a.toFixed(2)+" kg",style:"tableHeader",alignment:"center"},{text:s.toFixed(2),style:"tableHeader",alignment:"center",color:s>1?"#27ae60":"#000000",bold:s>1}]),o.push(t)}return o}function F(e){if("c/h20"===e.tipo){let t=0;const o=e.reporteTaras||[],r=e.reporteBolsas||[];for(let e=0;e<o.length;e++){const a=parseInt(o[e])||0,n=parseInt(r[e])||0;t+=a*n}return t*(e.camaronNeto||.65)}{const t=e.kilos.reduce((e,t)=>e+(Number(t)||0),0),o=e.taras.reduce((e,t)=>e+(Number(t)||0),0),r=(e.tarasExtra||[]).reduce((e,t)=>e+(Number(t)||0),0),a=o+r,n=e.restarTaras?3*a:0;return t-n}}function S(e){return e.split(" ")[0].toLowerCase()}function v(e){return e.sort((e,t)=>{const o=S(e.nombreAlternativoPDF||e.medida),r=S(t.nombreAlternativoPDF||t.medida);if(o!==r)return o.localeCompare(r);if(e.tipo!==t.tipo)return e.tipo.localeCompare(t.tipo);if("c/h20"===e.tipo&&"c/h20"===t.tipo){const o=e.camaronNeto||.65,r=t.camaronNeto||.65;return o-r}return 0})}function A(e,t,o,r=!0,a=!0,n=!0,i=!1){const s=e.filter(e=>{const t=M(e,o,r,a);return t>0});if(0===s.length)return{table:{headerRows:1,widths:["100%"],body:[[{text:"No hay productos con kilos registrados",italics:!0,alignment:"center"}]]},layout:{hLineWidth:function(e,t){return 0===e||e===t.table.body.length?2:1},vLineWidth:function(e,t){return 0===e||e===t.table.widths.length?2:1},hLineColor:function(e,o){return 0===e||e===o.table.body.length?$(t):"black"},vLineColor:function(e,o){return 0===e||e===o.table.widths.length?$(t):"black"}}};const l=s.some(e=>e.nota&&""!==e.nota.trim()),c=s.some(e=>e.hilos),d=n&&s.some(e=>e.precio&&""!==e.precio.toString().trim()),u=d,h=d&&i,g=[{text:"Kg",style:"tableHeader"},{text:"Producto",style:"tableHeader"},{text:"Taras",style:"tableHeader"}];u&&g.push({text:"Precio",style:"tableHeader"}),h&&g.push({text:"Total",style:"tableHeader"}),c&&g.push({text:"Hilos",style:"tableHeader"}),l&&g.push({text:"Notas",style:"tableHeader"});const m=[g];let f=0,b=0;const p=(o||"").toLowerCase().includes("lorena")||(o||"").toLowerCase().includes("veronica")?"#e67e22":"#9b59b6";if(s.forEach(e=>{const t=(e.taras||[]).reduce((e,t)=>e+(t||0),0),n=(e.tarasExtra||[]).reduce((e,t)=>e+(t||0),0),i=t+n;let s=`${i} ${D(e.reporteTaras,e.reporteBolsas)}`;const g=M(e,o,r,a);if(g>0){const t=o.toLowerCase().includes("ozuna")?Number(g.toFixed(1)):Math.round(g),r=[o.toLowerCase().includes("ozuna")?g.toFixed(1)+" kg":Math.round(g)+" kg",d?u?{text:(e.nombreAlternativoPDF||e.medida||"")+("c/h20"===e.tipo?" c/h2o":"s/h20"===e.tipo?" s/h2o":"otro"===e.tipo?" "+(e.tipoPersonalizado||""):" "+(e.tipo||"")),..."c/h20"===e.tipo?{style:"tipoConAgua"}:{}}:e.precio?{text:[{text:(e.nombreAlternativoPDF||e.medida||"")+("c/h20"===e.tipo?" c/h2o":"s/h20"===e.tipo?" s/h2o":"otro"===e.tipo?" "+(e.tipoPersonalizado||""):" "+(e.tipo||""))+" - ",..."c/h20"===e.tipo?{style:"tipoConAgua"}:{}},{text:"$"+Number(e.precio).toLocaleString("en-US"),style:"precioInline"}]}:{text:(e.nombreAlternativoPDF||e.medida||"")+("c/h20"===e.tipo?" c/h2o":"s/h20"===e.tipo?" s/h2o":"otro"===e.tipo?" "+(e.tipoPersonalizado||""):" "+(e.tipo||"")),..."c/h20"===e.tipo?{style:"tipoConAgua"}:{}}:{text:O(e),..."c/h20"===e.tipo?{style:"tipoConAgua"}:{}},s];if(u&&r.push(e.precio?{text:"$"+Number(e.precio).toLocaleString("en-US"),style:"precio"}:""),h){let o=0;if(e.precio)if("c/h20"===e.tipo){let t=0;const r=e.reporteTaras||[],a=e.reporteBolsas||[],n=e.camaronNeto||.65;for(let e=0;e<r.length;e++){const o=parseInt(r[e])||0,i=parseInt(a[e])||0;t+=o*i*n}o=t*Number(e.precio)}else o=t*Number(e.precio);f+=o,b+=i;const a=Math.round(o),n=a>=1e5?16:21;r.push(e.precio?{text:"$"+a.toLocaleString("en-US"),color:"#FFFFFF",background:"#9b59b6",padding:[2,2,2,2],bold:!0,fontSize:n}:"")}c&&r.push(e.hilos||""),l&&r.push({text:e.nota||"",style:"nota"}),m.push(r)}}),h&&f>0){const e=g.length,t=[{text:"TOTAL:",bold:!0,alignment:"right",color:p,border:[!0,!0,!0,!0],colSpan:e-1}];for(let o=1;o<e-1;o++)t.push({});const r=Math.round(f),a=r>=1e5?18:24;t.push({text:"$"+r.toLocaleString("en-US"),bold:!0,fontSize:a,color:p,border:[!0,!0,!0,!0],alignment:"center"}),m.push(t);const n=(o||"").toLowerCase(),i=n.includes("catarro");if(i){const t=70,o=Math.round((b||0)*t),r=Math.max(0,Math.round(f)-o),a=[{text:"FLETE:",bold:!0,alignment:"right",color:p,border:[!0,!0,!0,!0],colSpan:e-1}];for(let s=1;s<e-1;s++)a.push({});a.push({text:"$"+o.toLocaleString("en-US"),style:"totalPrecio"}),m.push(a);const n=r>=1e5?18:24,i=[{text:"GRAN TOTAL:",bold:!0,alignment:"right",color:p,border:[!0,!0,!0,!0],colSpan:e-1}];for(let s=1;s<e-1;s++)i.push({});i.push({text:"$"+r.toLocaleString("en-US"),bold:!0,fontSize:n,color:"#FFFFFF",background:p,padding:[4,4,4,4],border:[!0,!0,!0,!0],alignment:"center"}),m.push(i)}}if(1===m.length)return{table:{headerRows:1,widths:["100%"],body:[[{text:"No hay productos con kilos registrados",italics:!0,alignment:"center"}]]},layout:{hLineWidth:function(e,t){return 0===e||e===t.table.body.length?2:1},vLineWidth:function(e,t){return 0===e||e===t.table.widths.length?2:1},hLineColor:function(e,o){return 0===e||e===o.table.body.length?$(t):"black"},vLineColor:function(e,o){return 0===e||e===o.table.widths.length?$(t):"black"}}};let y;return y=u&&h?c&&l?["10%","20%","20%","15%","15%","10%","10%"]:c||l?["15%","20%","20%","15%","15%","15%"]:["15%","25%","20%","20%","20%"]:u?c&&l?["12%","22%","22%","18%","13%","13%"]:c||l?["15%","25%","25%","20%","15%"]:["20%","30%","25%","25%"]:c&&l?["15%","25%","25%","15%","20%"]:c||l?["20%","30%","30%","20%"]:["25%","35%","40%"],{table:{headerRows:1,widths:y,body:m},layout:{hLineWidth:function(e,t){return 0===e||e===t.table.body.length?2:1},vLineWidth:function(e,t){return 0===e||e===t.table.widths.length?2:1},hLineColor:function(e,o){return 0===e||e===o.table.body.length?$(t):"black"},vLineColor:function(e,o){return 0===e||e===o.table.widths.length?$(t):"black"}}}}function k(e,t,o=!1,r=!1){const a=I(t),n=[];let i=!1;try{if(!Array.isArray(e))return console.warn("Los crudos proporcionados no son un array v√°lido"),L(t);e.forEach(e=>{e&&Array.isArray(e.items)?e.items.forEach(t=>{if(!t)return void console.warn("Item no v√°lido en crudo",{crudo:e});const r=j(t,a),s=parseFloat(r);s>0&&(n.push(t),o&&t.precio&&""!==t.precio.toString().trim()&&(i=!0))}):console.warn("Estructura de crudo no v√°lida",{crudo:e})})}catch(q){return console.error("Error al procesar crudos:",q),L(t)}if(0===n.length)return L(t);const s=i,l=i&&r,c=[{text:"Cantidad",style:"tableHeader"},{text:"Talla",style:"tableHeader"},{text:"Taras",style:"tableHeader"}];s&&c.push({text:"Precio",style:"tableHeader"}),l&&c.push({text:"Total",style:"tableHeader"});const d=[c];let u=0,h=0;const g=(a||"").toLowerCase().includes("lorena")||(a||"").toLowerCase().includes("veronica")?"#e67e22":"#9b59b6";if(n.forEach(e=>{const t=j(e,a),o=parseFloat(t),r=Math.round(o),n=[r+" kg",{text:e.talla.replace(/\s*c\/\s*c$/i," c/c"),...e.talla&&e.talla.toLowerCase().includes("c/c")?{style:"tipoConAgua"}:{style:"default"},noWrap:!0},N(e)];if(s&&n.push(e.precio?{text:"$"+Number(e.precio).toLocaleString("en-US"),style:"precio"}:""),l){const t=e.precio?r*Number(e.precio):0;u+=t;const o=Math.round(t),a=o>=1e5?16:21;n.push(e.precio?{text:"$"+o.toLocaleString("en-US"),color:"#FFFFFF",background:"#9b59b6",padding:[2,2,2,2],bold:!0,fontSize:a}:""),h+=N(e)}d.push(n)}),l&&u>0){const e=c.length,t=[{text:"TOTAL:",bold:!0,alignment:"right",color:g,border:[!0,!0,!0,!0],colSpan:e-1}];for(let a=1;a<e-1;a++)t.push({});const o=Math.round(u),r=o>=1e5?18:24;t.push({text:"$"+o.toLocaleString("en-US"),bold:!0,fontSize:r,color:g,border:[!0,!0,!0,!0],alignment:"center"}),d.push(t);const n=(a||"").toLowerCase(),i=n.includes("catarro");if(i){const t=60,o=Math.round((h||0)*t),r=Math.max(0,Math.round(u)-o),a=[{text:"FLETE:",bold:!0,alignment:"right",color:g,border:[!0,!0,!0,!0],colSpan:e-1}];for(let s=1;s<e-1;s++)a.push({});a.push({text:"$"+o.toLocaleString("en-US"),style:"totalPrecio"}),d.push(a);const n=r>=1e5?18:24,i=[{text:"GRAN TOTAL:",bold:!0,alignment:"right",color:g,border:[!0,!0,!0,!0],colSpan:e-1}];for(let s=1;s<e-1;s++)i.push({});i.push({text:"$"+r.toLocaleString("en-US"),bold:!0,fontSize:n,color:"#FFFFFF",background:g,padding:[4,4,4,4],border:[!0,!0,!0,!0],alignment:"center"}),d.push(i)}}let m;return m=s&&l?["20%","25%","20%","15%","20%"]:s?["25%","35%","20%","20%"]:["30%","40%","30%"],{table:{headerRows:1,widths:m,body:d},layout:{hLineWidth:function(e,t){return 0===e||e===t.table.body.length?2:1},vLineWidth:function(e,t){return 0===e||e===t.table.widths.length?2:1},hLineColor:function(e,o){return 0===e||e===o.table.body.length?$(t):"black"},vLineColor:function(e,o){return 0===e||e===o.table.widths.length?$(t):"black"}}}}function L(e){return{table:{headerRows:1,widths:["100%"],body:[[{text:"No hay crudos con kilos registrados",italics:!0,alignment:"center"}]]},layout:{hLineWidth:function(e,t){return 0===e||e===t.table.body.length?2:1},vLineWidth:function(e,t){return 0===e||e===t.table.widths.length?2:1},hLineColor:function(t,o){return 0===t||t===o.table.body.length?$(e):"black"},vLineColor:function(t,o){return 0===t||t===o.table.widths.length?$(e):"black"}}}}function T(e){const t=e.toLowerCase();return t.includes("joselito")?"clienteJoselito":t.includes("catarro")?"clienteCatarro":t.includes("otilio")?"clienteOtilio":t.includes("ozuna")?"clienteOzuna":t.includes("elizabeth")?"clienteElizabeth":t.includes("lorena")?"clienteLorena":"clienteOtro"}function O(e){let t=(e.nombreAlternativoPDF||e.medida||"").trim();if("c/h20"===e.tipo)return{text:t+" c/h2o",style:"tipoConAgua"};if("s/h20"===e.tipo)return{text:t+" s/h2o",style:"default"};let o="otro"===e.tipo?e.tipoPersonalizado:e.tipo,r=o?`${t} ${o}`:t;return{text:r,style:"default"}}function N(e){let t=0;if(e.taras){const[o]=e.taras.split("-").map(Number);t+=o}if(e.sobrante){const[o]=e.sobrante.split("-").map(Number);t+=o}return t}function z(e,t){if(!t||!Array.isArray(t))return console.warn("La lista de clientes disponibles no es v√°lida"),"Cliente Desconocido";const o=t.find(t=>t.id.toString()===e.toString());if(!o)return"Cliente Desconocido";const r=o.nombreNotas||o.nombre;return"string"===typeof r&&r.toLowerCase().includes("lorena")?"Lorena-D22":r}function E(e){const t=(e.taras||[]).reduce((e,t)=>e+(t||0),0),o=(e.tarasExtra||[]).reduce((e,t)=>e+(t||0),0);return t+o}function M(e,t,o=!0,r=!0){const a=(e.kilos||[]).reduce((e,t)=>e+(t||0),0);let n=0;if(e.tarasInfo)n=e.tarasInfo.reduce((e,t)=>e+(t.restarTaras?3*(Number(t.valor)||0):0),0);else{const t=(e.taras||[]).reduce((e,t)=>e+(t||0),0);n=e.restarTaras?3*t:0}let i=a-n;const s=t?t.toLowerCase():"",l=e.tipo||"";if(!e.noSumarKilos&&(l.toLowerCase().includes("s/h2o")||l.toLowerCase().includes("s/h20"))&&(s.includes("catarro")&&(console.log("[DEBUG] Cliente Catarro detectado:",{nombreCliente:t,sumarKgCatarro:r,resultadoAntes:i,tipoProducto:e.tipo,medida:e.medida}),r?(i+=1,console.log("[DEBUG] Se sum√≥ 1 kg. Resultado despu√©s:",i)):console.log("[DEBUG] NO se sum√≥ 1 kg porque sumarKgCatarro es false")),o&&(s.includes("otilio")||e.nombreCliente&&e.nombreCliente.toLowerCase().includes("otilio")))){const e=.5*Math.floor(i/100);i+=e}if(s.includes("otilio")){const e=Math.floor(i),t=i-e,o=Math.abs(t-.5)<1e-9;return o?e:Math.round(i)}return s.includes("elizabeth")?Math.round(i):(s.includes("ozuna"),Number(i.toFixed(1)))}function j(e,t){let o=0;if(e.taras){const[t,r]=e.taras.split("-").map(Number),a=20;o+=t*a}if(e.sobrante){const[,t]=e.sobrante.split("-").map(Number);o+=t}return t&&t.toLowerCase().includes("elizabeth")?Math.round(o).toString():o.toFixed(1)}function D(e,t){const o={};return e.forEach((e,r)=>{const a=t[r]||"";o[a]||(o[a]=0),o[a]+=parseInt(e||1)}),Object.entries(o).map(([e,t])=>`(${t}-${e})`).join(" ")}function $(e){const t={clienteJoselito:"#0000FF",clienteCatarro:"#FF0000",clienteOtilio:"#FFD700",clienteOzuna:"#008000",clienteElizabeth:"#9b59b6",clienteLorena:"#e67e22",clienteOtro:"#808080"};return t[e]||"#000000"}function P(e){return new Promise((t,o)=>{const r=new Image;r.crossOrigin="Anonymous",r.onload=function(){const e=document.createElement("canvas");e.width=r.width,e.height=r.height;const o=e.getContext("2d");o.drawImage(r,0,0);const a=e.toDataURL("image/png");t(a)},r.onerror=o,r.src=e})}function I(e){switch(e){case"clienteJoselito":return"joselito";case"clienteCatarro":return"catarro";case"clienteOtilio":return"otilio";case"clienteOzuna":return"ozuna";case"clienteElizabeth":return"elizabeth";case"clienteLorena":return"lorena";default:return"otro"}}async function H(e,t,o,r={},a={},n={},i={}){const s=[];let l=0,c=0;if(!e||!e.productos||!Array.isArray(e.productos))return console.warn("Datos de embarque inv√°lidos o productos no encontrados"),[{text:"No hay datos de productos disponibles",italics:!0,margin:[0,5,0,10]}];Array.isArray(t)||(console.warn("Lista de clientes no v√°lida"),t=[]);const d=e.productos.reduce((e,t)=>(e[t.clienteId]||(e[t.clienteId]=[]),e[t.clienteId].push(t),e),{});let u=!1,h=0;return Object.entries(d).forEach(([e])=>{const o=z(e,t),r=a&&a[e],n=i&&i[e];(o.toLowerCase().includes("elizabeth")||o.toLowerCase().includes("catarro"))&&r&&n&&(u=!0)}),Object.entries(d).forEach(([d,u])=>{const g=z(d,t),m=T(g),f=o&&o[d],b=r&&r[d],p=a&&a[d],y=i&&i[d],x=g.toLowerCase().includes("catarro"),w=n&&n.hasOwnProperty(d)?n[d]:x;x&&console.log("[DEBUG] Configuraci√≥n para cliente Catarro:",{clienteId:d,nombreCliente:g,esCatarro:x,clientesSumarKgCatarro:n,tienePropiedad:n&&n.hasOwnProperty(d),valorDirecto:n?n[d]:"N/A",sumarKgCatarroCliente:w});const C=u.filter(e=>{const t=M(e,g,b,w);return t>0});if(s.push({text:"Cliente: "+g,style:["subheader",m],margin:[0,5,0,5]}),C.length>0){let e=C;if(f){const t={};C.forEach(e=>{const o=e.nombreAlternativoPDF||e.medida,r=e.tipo||"",a=e.camaronNeto||.65,n="c/h20"===r?`${o}-${r}-${a}`:`${o}-${r}`;t[n]?(t[n].kilos.push(...e.kilos),t[n].taras.push(...e.taras),e.tarasExtra&&t[n].tarasExtra.push(...e.tarasExtra),e.reporteTaras&&t[n].reporteTaras.push(...e.reporteTaras),e.reporteBolsas&&t[n].reporteBolsas.push(...e.reporteBolsas),t[n].tarasInfo.push(...e.taras.map(t=>({valor:t,restarTaras:e.restarTaras}))),t[n].taras=t[n].tarasInfo.map(e=>e.valor)):t[n]={...e,medida:o,kilos:[...e.kilos],taras:[...e.taras],tarasExtra:[...e.tarasExtra||[]],reporteTaras:[...e.reporteTaras||[]],reporteBolsas:[...e.reporteBolsas||[]],tarasInfo:e.taras.map(t=>({valor:t,restarTaras:e.restarTaras}))}}),e=Object.values(t)}const t=v(e),o=t.some(e=>{const t=M(e,g,b,w);return t>0});if(o){s.push({text:"Limpio:",style:["subheader",m],margin:[0,5,0,5]},R(t,m,g,b,w,p,y),{text:"\n"});const e=u.reduce((e,t)=>e+E(t),0);e>0&&(l+=e,s.push({text:"Taras de limpio: "+e,margin:[0,5,0,5]},{text:"\n"}))}}if(e.clienteCrudos&&e.clienteCrudos[d]){const t=_(e.clienteCrudos,d,g);if(t){s.push({text:"Crudos:",style:["subheader",m],margin:[0,5,0,5]},k(e.clienteCrudos[d],m,!1),{text:"\n"});const t=e.clienteCrudos[d].reduce((e,t)=>e+t.items.reduce((e,t)=>e+N(t),0),0);t>0&&(c+=t,s.push({text:"Taras de crudo: "+t,margin:[0,5,0,5]},{text:"\n"}))}}const F=C.length>0,S=e.clienteCrudos&&e.clienteCrudos[d]&&e.clienteCrudos[d].some(e=>e.items.some(e=>{const t=j(e,g),o=parseFloat(t);return o>0}));F||S||s.push({text:"No hay medidas registradas para este cliente",italics:!0,margin:[0,5,0,10]},{text:"\n"});let A=0;u.forEach(e=>{if(e.precio){let t=0;if("c/h20"===e.tipo){let o=0;const r=e.reporteTaras||[],a=e.reporteBolsas||[],n=e.camaronNeto||.65;for(let e=0;e<r.length;e++){const t=parseInt(r[e])||0,i=parseInt(a[e])||0;o+=t*i*n}t=o*Number(e.precio)}else{const o=M(e,g,b,w),r=g.toLowerCase().includes("ozuna")?Number(o.toFixed(1)):Math.round(o);t=r*Number(e.precio)}A+=t}}),e.clienteCrudos&&e.clienteCrudos[d]&&U(e.clienteCrudos,d,t,e=>{if(e.precio){const t=parseFloat(j(e,g)),o=Math.round(t);A+=o*Number(e.precio)}}),h+=A}),l+c>0&&s.push(...K(l,c)),s}function R(e,t,o,r=!0,a=!0,n=!1,i=!1){const s=e.filter(e=>{const t=M(e,o,r,a);return t>0});if(0===s.length)return{table:{headerRows:1,widths:["100%"],body:[[{text:"No hay productos con kilos registrados",italics:!0,alignment:"center"}]]},layout:{hLineWidth:function(e,t){return 0===e||e===t.table.body.length?2:1},vLineWidth:function(e,t){return 0===e||e===t.table.widths.length?2:1},hLineColor:function(e,o){return 0===e||e===o.table.body.length?$(t):"black"},vLineColor:function(e,o){return 0===e||e===o.table.widths.length?$(t):"black"}}};const l=s.some(e=>e.nota&&""!==e.nota.trim()),c=s.some(e=>e.hilos),d=[{text:"Kg",style:"tableHeader"},{text:"Producto",style:"tableHeader"},{text:"Taras",style:"tableHeader"}];c&&d.push({text:"Hilos",style:"tableHeader"}),l&&d.push({text:"Notas",style:"tableHeader"});const u=[d];if(s.forEach(e=>{const t=(e.taras||[]).reduce((e,t)=>e+(t||0),0),s=(e.tarasExtra||[]).reduce((e,t)=>e+(t||0),0),d=t+s;let h=`${d} ${D(e.reporteTaras,e.reporteBolsas)}`;const g=M(e,o,r,a);if(g>0){const t=[Math.round(g)+" kg",n?i?{text:B(e),..."c/h20"===e.tipo?{style:"tipoConAgua"}:{}}:e.precio?{text:[{text:B(e)+" - ",..."c/h20"===e.tipo?{style:"tipoConAgua"}:{}},{text:"$"+Number(e.precio).toLocaleString("en-US"),style:"precioInline"}]}:{text:B(e),..."c/h20"===e.tipo?{style:"tipoConAgua"}:{}}:{text:B(e),..."c/h20"===e.tipo?{style:"tipoConAgua"}:{}},h];c&&t.push(e.hilos||""),l&&t.push({text:e.nota||"",style:"nota"}),u.push(t)}}),1===u.length)return{table:{headerRows:1,widths:["100%"],body:[[{text:"No hay productos con kilos registrados",italics:!0,alignment:"center"}]]},layout:{hLineWidth:function(e,t){return 0===e||e===t.table.body.length?2:1},vLineWidth:function(e,t){return 0===e||e===t.table.widths.length?2:1},hLineColor:function(e,o){return 0===e||e===o.table.body.length?$(t):"black"},vLineColor:function(e,o){return 0===e||e===o.table.widths.length?$(t):"black"}}};let h;return h=c&&l?["20%","30%","25%","10%","15%"]:c||l?["25%","35%","25%","15%"]:["25%","45%","30%"],{table:{headerRows:1,widths:h,body:u},layout:{hLineWidth:function(e,t){return 0===e||e===t.table.body.length?2:1},vLineWidth:function(e,t){return 0===e||e===t.table.widths.length?2:1},hLineColor:function(e,o){return 0===e||e===o.table.body.length?$(t):"black"},vLineColor:function(e,o){return 0===e||e===o.table.widths.length?$(t):"black"}}}}function B(e){let t=(e.nombreAlternativoPDF||e.medida||"").trim();if("c/h20"===e.tipo)return{text:t+" c/h2o",style:"tipoConAgua"};if("s/h20"===e.tipo)return{text:t+" s/h2o",style:"default"};let o="otro"===e.tipo?e.tipoPersonalizado:e.tipo,r=o?`${t} ${o}`:t;return{text:r,style:"default"}}function U(e,t,o,r){if(e&&e[t])try{const o=e[t];if(!Array.isArray(o))return void console.warn("Crudos no v√°lidos para el cliente "+t,{crudos:o});for(const e of o)if(e&&Array.isArray(e.items))for(const o of e.items)o?r(o):console.warn("Item no v√°lido en crudo para el cliente "+t,{crudo:e});else console.warn("Estructura de crudo no v√°lida para el cliente "+t,{crudo:e})}catch(q){console.error(`Error al procesar crudos para el cliente ${t}:`,q)}}function _(e,t,o){let r=!1;if(!e||!e[t])return!1;try{const a=e[t];if(!Array.isArray(a))return console.warn("Crudos no v√°lidos para el cliente "+t,{crudos:a}),!1;for(const e of a)if(e&&Array.isArray(e.items)){for(const a of e.items){if(!a){console.warn("Item no v√°lido en crudo para el cliente "+t,{crudo:e});continue}const n=j(a,o),i=parseFloat(n);if(i>0){r=!0;break}}if(r)break}else console.warn("Estructura de crudo no v√°lida para el cliente "+t,{crudo:e})}catch(q){return console.error(`Error al verificar kilos crudos para el cliente ${t}:`,q),!1}return r}function W(e,t,o,r){const a=[];return r&&o>0&&a.push({text:"Total de Cuenta: $"+Math.round(o).toLocaleString("en-US"),style:["subheader","granTotal"],alignment:"center",margin:[0,10,0,5]}),e+t>0&&a.push({text:"Total general de taras: "+(e+t),style:"subheader",alignment:"center",margin:[0,5,0,5]}),a}function K(e,t){const o=[];return e+t>0&&o.push({text:"Total general de taras: "+(e+t),style:"subheader",alignment:"center",margin:[0,5,0,5]}),o}},"6d4d":function(e,t,o){"use strict";o.d(t,"a",(function(){return c}));o("14d9");var r=o("2ddf"),a=o("fcda");o("13d5");const n=(e,t,o)=>{const n=e.reduce((e,o)=>{const r=t[o.medida]||o.medida,a=Boolean(null===o||void 0===o?void 0:o.incluyeCostoFinal),n=Number(null===o||void 0===o?void 0:o.costoFinal),i=r.includes("Maquila Ozuna"),s=i?r.replace(" Maquila Ozuna",""):r,l=i?s+"_MAQUILA_OZUNA":r;if(s.includes("mixta")||s.includes("Mixta")){const t=i?"Mixta_MAQUILA_OZUNA":"Mixta";e[t]||(e[t]={medida:s,kilosCrudos:0,totalEmbarcado:0,costoFinal:0,incluyeCostoFinal:!1,esMaquilaOzuna:i}),o.kilosCrudos&&("object"===typeof o.kilosCrudos?e[t].kilosCrudos+=(parseFloat(o.kilosCrudos.medida1)||0)+(parseFloat(o.kilosCrudos.medida2)||0):e[t].kilosCrudos+=parseFloat(o.kilosCrudos)||0),e[t].totalEmbarcado+=parseFloat(o.totalEmbarcado)||0,a&&Number.isFinite(n)&&(e[t].costoFinal+=n,e[t].incluyeCostoFinal=!0)}else e[l]={medida:s,kilosCrudos:parseFloat(o.kilosCrudos)||0,totalEmbarcado:parseFloat(o.totalEmbarcado)||0,costoFinal:a&&Number.isFinite(n)?n:null,incluyeCostoFinal:a&&Number.isFinite(n),esMaquilaOzuna:i};return e},{}),i=Object.values(n),s=i.some(e=>e.incluyeCostoFinal),l=s&&i.every(e=>!e.incluyeCostoFinal||0===Number(e.costoFinal)),c=o.mostrarColumnaCosto&&s&&!l,d=[[{text:"Kilos en Crudo",style:"tableHeader"},{text:"Medida",style:"tableHeader"},{text:"Rendimiento",style:"tableHeader"},...c?[{text:"Costo Final",style:"tableHeader"}]:[]],...Object.values(n).map(e=>{const t=e.totalEmbarcado>0?e.kilosCrudos/e.totalEmbarcado:0,o=t>1?"rendimientoAlto":"rendimientoBajo";let r=e.medida;if(e.medidasIncluidas){const t=Array.from(e.medidasIncluidas);r=`Mixta (${t.join(", ")})`}return e.esMaquilaOzuna&&(r+=" (Maquila)"),[Object(a["b"])(e.kilosCrudos),r,{text:`(${Object(a["e"])(t)})`,style:o},...c?[{text:e.incluyeCostoFinal?"$"+Number(e.costoFinal||0).toFixed(1):"",style:"costoStyle"}]:[]]})];return{table:{headerRows:1,widths:c?["25%","25%","25%","25%"]:["35%","35%","30%"],body:d},layout:r["e"]}},i=(e,t,o,n={})=>{const i=e&&Object.keys(e).length>0,s=n&&Object.keys(n).length>0;if(!i&&!s)return{text:"No hay datos de ganancias disponibles",style:"header",alignment:"center",margin:[0,10,0,10]};const l=(null===o||void 0===o?void 0:o.medidaOculta)||{},c=i?Object.entries(e).filter(([e])=>!l[e]):[],d=c.map(([e,o])=>{const r=t[e]||e,n=o.gananciaUnitaria||0,i=o.gananciaTotal||0,s=o.totalEmbarcado||0,l=o.precioVenta||0,c=o.costoBase||0,d=o.costoFinal||0;return[r,Object(a["c"])(s)+" kg",{stack:[{text:"Compra: $"+Object(a["d"])(c),fontSize:14,alignment:"center",margin:[0,0,0,2],color:"#e74c3c"},{text:"Costo Final: $"+Object(a["d"])(d),fontSize:14,alignment:"center",margin:[0,0,0,2],color:"#f39c12"},{text:"Venta: $"+Object(a["d"])(l),fontSize:14,alignment:"center",color:"#27ae60"}],alignment:"center"},{text:"$"+Object(a["d"])(n),style:n>=0?"gananciaPositiva":"gananciaNegativa"},{text:"$"+Object(a["d"])(i),style:i>=0?"gananciaPositiva":"gananciaNegativa"}]}),u=Object.entries(n).map(([e,o])=>{const r=t[e]||e,n=o.precioMaquila||0,i=o.gananciaTotal||0,s=o.totalEmbarcado||0;return[r+" (Maquila)",Object(a["c"])(s)+" kg",{stack:[{text:"Compra: N/A",fontSize:14,alignment:"center",margin:[0,0,0,2],color:"#6c757d"},{text:"Venta: $"+Object(a["d"])(n),fontSize:14,alignment:"center",color:"#27ae60"}],alignment:"center"},{text:"$"+Object(a["d"])(n),style:"gananciaPositiva"},{text:"$"+Object(a["d"])(i),style:"gananciaPositiva"}]}),h=c.reduce((e,[t,o])=>e+(o.gananciaTotal||0),0),g=Object.values(n).reduce((e,t)=>e+(t.gananciaTotal||0),0),m=h+g;if(0===d.length&&0===u.length)return{text:"No hay datos de ganancias para mostrar",style:"header",alignment:"center",margin:[0,10,0,10]};const f=[[{text:"Medida",style:"tableHeader"},{text:"Kilos",style:"tableHeader"},{text:"Precios",style:"tableHeader"},{text:"Ganancia/kg",style:"tableHeader"},{text:"Ganancia Total",style:"tableHeader"}],...d,...u,[{text:"TOTAL GANANCIAS",style:"tableTotal"},{text:"",style:"tableTotal"},{text:"",style:"tableTotal"},{text:"",style:"tableTotal"},{text:"$"+Object(a["d"])(m),style:m>=0?"tableTotal":"tableTotalNegativo"}]];return{stack:[{text:"Resumen de limpios",style:"header",alignment:"center",margin:[0,0,0,10]},{table:{headerRows:1,widths:["25%","15%","25%","15%","20%"],body:f},layout:r["f"]}]}},s=(e,t={})=>{if(0===Object.keys(t).length)return{text:""};const o=Object.values(t).reduce((e,t)=>e+(t.gananciaTotal||0),0),n=Object.values(t).reduce((e,t)=>e+(t.totalKilosCosto||0),0),i=Object.values(t).reduce((e,t)=>e+(t.totalKilos||0),0),s=[[{text:"Medida",style:"tableHeader"},{text:"Kilos",style:"tableHeader"},{text:"Precio",style:"tableHeader"},{text:"Costo",style:"tableHeader"},{text:"Ganancia",style:"tableHeader"}],...Object.entries(t).map(([e,t])=>{const o=t.totalKilos||0,r=t.totalKilosCosto||0,n=t.precioVenta||0,i=t.costoBase||0,s=t.gananciaTotal;return[e,{stack:[{text:`Kilos C: ${Math.floor(r)} kg`,fontSize:14,alignment:"center",margin:[0,0,0,2]},{text:`Kilos V: ${Math.floor(o)} kg`,fontSize:14,alignment:"center"}],alignment:"center"},{text:"$"+Object(a["d"])(n),alignment:"center",style:"gananciaPositiva"},{text:"$"+i.toFixed(1),alignment:"center",style:"costoStyle"},{text:"$"+Object(a["d"])(s),alignment:"center",style:s>=0?"gananciaPositiva":"gananciaNegativa"}]}),[{text:"TOTAL",style:"tableTotal"},{stack:[{text:`Kilos C: ${Math.floor(n)} kg`,fontSize:14,alignment:"center",margin:[0,0,0,2],bold:!0},{text:`Kilos V: ${Math.floor(i)} kg`,fontSize:14,alignment:"center",bold:!0}],alignment:"center",fillColor:"#e8f4f8"},{text:"",style:"tableTotal"},{text:"",style:"tableTotal"},{text:"$"+Object(a["d"])(o),style:o>=0?"tableTotal":"tableTotalNegativo",alignment:"center"}]];return{stack:[{text:"Resumen de Crudos",style:"header",alignment:"center",margin:[0,0,0,10]},{table:{headerRows:1,widths:["25%","20%","18%","18%","19%"],body:s},layout:r["f"]}]}},l=(e,t,o)=>{const r=Object.values(e).reduce((e,t)=>e+(t.gananciaTotal||0),0),n=Object.values(t).reduce((e,t)=>e+(t.gananciaTotal||0),0),i=Object.values(o).reduce((e,t)=>e+(t.gananciaTotal||0),0),s=r+n+i;return 0===s?{text:"",margin:[0,0,0,0]}:{text:"TOTAL GENERAL: $"+Object(a["d"])(s),style:s>=0?"tableTotal":"tableTotalNegativo",alignment:"center",fontSize:28,margin:[0,10,0,0]}};Object(r["b"])();const c=async(e,t,o,c={},d={},u={},h={},g={})=>{try{const m=await Object(a["f"])("https://res.cloudinary.com/hwkcovsmr/image/upload/v1620946647/samples/REY_PEZ_LOGO_nsotww.png"),f=(null===t||void 0===t?void 0:t.nombresMedidasPersonalizados)||{},b={content:[{columns:[{image:m,width:80,alignment:"left",margin:[0,0,0,5]},{text:"Reporte de Rendimientos",style:"header",alignment:"center",margin:[0,10,0,0]},{stack:[{text:"Fecha: "+Object(a["a"])(t.fecha),alignment:"right",margin:[0,10,0,0]}]}]},{text:"\n",height:5},n(e,f,t),{text:"",pageBreak:"after"},i(o,f,t,g),{text:"\n",height:10},s(c,d,u,h),{text:"\n",height:10},l(o,g,d)],styles:r["d"],...r["a"]};t.notaRendimientos&&(b.content.push({text:"\n",height:5}),b.content.push({text:"Nota:",style:"header",color:"red",alignment:"center",margin:[0,10,0,0]}),b.content.push({text:" "+t.notaRendimientos,style:"header",alignment:"center",color:"black",margin:[0,10,0,0]})),r["c"].createPdf(b).open()}catch(m){console.error("Error al generar el PDF de rendimientos:",m)}}},b3e1:function(e,t,o){"use strict";o.d(t,"a",(function(){return l}));o("d9e2"),o("14d9"),o("13d5");var r=o("2ddf"),a=o("fcda");const n="https://res.cloudinary.com/hwkcovsmr/image/upload/w_1000,c_fill,ar_1:1,g_auto,r_max,bo_5px_solid_red,f_png,b_transparent/v1757615801/allan_logo_ra8ruv.jpg",i=e=>{const t=Number(e)||0;return"$"+t.toLocaleString("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2})},s=(e=[])=>e.reduce((e,t)=>e+(Number(t.monto)||0),0),l=async({fechaInicio:e,fechaFin:t,registros:o=[]})=>{var l;if(!Array.isArray(o))throw new Error("Los registros de cuentas no tienen el formato esperado.");const c=[...o].sort((e,t)=>{const o=e.fecha||"",r=t.fecha||"";return o.localeCompare(r)});if(!c.length)throw new Error("No hay registros de cuentas en el rango seleccionado.");Object(r["b"])();let d=null;try{d=await Object(a["f"])(n)}catch(x){console.warn("No se pudo cargar el logo de Ver√≥nica para el PDF:",x)}const u=[[{text:"Fecha",style:"tableHeader",alignment:"center"},{text:"Saldo del d√≠a",style:"tableHeader",alignment:"right"},{text:"Abonos",style:"tableHeader",alignment:"right"},{text:"Resta",style:"tableHeader",alignment:"right"},{text:"Saldo acumulado",style:"tableHeader",alignment:"right"}]],h={},g={saldoDia:0,cobros:0,abonos:0,totalDia:0};let m=(null===(l=c[0])||void 0===l?void 0:l.saldoAcumuladoAnterior)||0;c.forEach(e=>{const t=Number(e.totalGeneralVenta)||0,o=Array.isArray(e.cobros)?e.cobros:[],r=Array.isArray(e.abonos)?e.abonos:[],n=s(o),l=s(r),c=t-n-l,d=null!=e.saldoAcumuladoAnterior?Number(e.saldoAcumuladoAnterior):m;let f=null!=e.nuevoSaldoAcumulado?Number(e.nuevoSaldoAcumulado):d+c;f<0&&(f=0),m=f,u.push([{text:Object(a["a"])(e.fecha),alignment:"center"},{text:i(t),alignment:"right"},{text:i(l),alignment:"right"},{text:i(c),alignment:"right"},{text:i(f),alignment:"right"}]),g.saldoDia+=t,g.cobros+=n,g.abonos+=l,g.totalDia+=c,r.length&&r.forEach(t=>{let o=t.descripcion||"Sin descripci√≥n";o=o.replace(/\s*\(Aplicaci√≥n Individual\)\s*/gi,"").trim(),o||(o="Sin descripci√≥n");const r=Number(t.monto)||0;h[o]||(h[o]={descripcion:o,montoTotal:0,fechasAplicadas:[]}),h[o].montoTotal+=r,h[o].fechasAplicadas.push({fecha:e.fecha,monto:r})})}),u.push([{text:"Totales del per√≠odo",alignment:"right",bold:!0,fillColor:"#fdebd0"},{text:i(g.saldoDia),alignment:"right",bold:!0,fillColor:"#fdebd0"},{text:i(g.abonos),alignment:"right",bold:!0,fillColor:"#fdebd0"},{text:i(g.totalDia),alignment:"right",bold:!0,fillColor:"#fdebd0"},{text:i(m),alignment:"right",bold:!0,fillColor:"#fdebd0"}]);const f=e?Object(a["a"])(e):Object(a["a"])(c[0].fecha),b=t?Object(a["a"])(t):Object(a["a"])(c[c.length-1].fecha),p={...r["a"],defaultStyle:{fontSize:13,color:"#2c3e50"},styles:{...r["d"],tituloPrincipal:{fontSize:26,bold:!0,color:"#d35400",margin:[0,0,0,6]},subTitulo:{fontSize:14,color:"#7f8c8d",margin:[0,0,0,14]},resumenItem:{fontSize:14,margin:[0,2,0,2]},saldoAcumuladoActual:{fontSize:16,bold:!0,color:"#d35400",margin:[0,12,0,0]},tableHeader:{fontSize:14,bold:!0}},content:[{columns:[d?{image:d,width:90,alignment:"left",margin:[0,0,10,0]}:{text:"",width:90},{stack:[{text:"Resumen de Cuentas y Abonos",style:"tituloPrincipal",alignment:"center"},{text:`Periodo: ${f} - ${b}`,style:"subTitulo",alignment:"center"}]},{text:"",width:90}]},{table:{headerRows:1,widths:["auto","*","auto","auto","auto"],body:u},layout:r["f"]},{text:`Saldo acumulado al d√≠a de hoy (${Object(a["a"])(new Date)}): ${i(m)}`,style:"saldoAcumuladoActual",fontSize:16,margin:[0,16,0,0]}]},y=Object.values(h);if(y.length){p.content.push({text:"\n"}),p.content.push({text:"Detalle de abonos",style:"tituloPrincipal",fontSize:20,margin:[0,14,0,10]});const e=Math.ceil(y.length/2),t=y.slice(0,e),o=y.slice(e),r=e=>{const t=e.fechasAplicadas.map(e=>`  ‚Ä¢ ${Object(a["a"])(e.fecha)}: ${i(e.monto)}`).join("\n");return{stack:[{text:e.descripcion,bold:!0,fontSize:14,color:"#d35400",margin:[0,0,0,4]},{text:t,margin:[0,0,0,4],fontSize:12},{text:"Total efectuado: "+i(e.montoTotal),bold:!0,color:"#d35400",margin:[0,0,0,12],fontSize:13}]}};p.content.push({columns:[{width:"48%",stack:t.map(r)},{width:"4%",text:""},{width:"48%",stack:o.map(r)}]})}return r["c"].createPdf(p).open(),!0}},f549:function(e,t,o){"use strict";o.r(t),o.d(t,"useAuthStore",(function(){return s}));o("d9e2");var r=o("be92"),a=o("dc59"),n=o("e1bd");const i=[{username:"allan",password:"noseno"},{username:"edgar",password:"noseno"}],s=Object(r["c"])("auth",{state:()=>({user:null,isAuthenticated:!1,userId:null}),actions:{async login(e,t){try{const o=i.find(o=>o.username===e&&o.password===t);if(o){const e=Object(n["a"])();return this.userId=e,this.user={username:o.username},this.isAuthenticated=!0,Object(a["b"])(e,o.username),localStorage.setItem("user",JSON.stringify({...this.user,userId:e})),!0}return!1}catch(o){return console.error("Error en login:",o),!1}},logout(){this.user=null,this.isAuthenticated=!1,this.userId=null,localStorage.removeItem("user")},ensureAuthenticated(){if((!this.isAuthenticated||!this.userId||!this.user)&&(console.warn("Usuario no autenticado, intentando verificar autenticaci√≥n..."),this.checkAuth(),!this.isAuthenticated||!this.userId||!this.user))throw new Error("Usuario no autenticado. Por favor, vuelva a iniciar sesi√≥n.");return!0},checkAuth(){try{const e=localStorage.getItem("user");if(e){const t=JSON.parse(e);t.username&&t.userId?(this.user={username:t.username},this.userId=t.userId,this.isAuthenticated=!0,Object(a["b"])(this.userId,t.username)):(console.warn("Datos de usuario incompletos en localStorage"),this.logout())}else console.log("No hay datos de usuario en localStorage"),this.logout()}catch(e){console.error("Error al verificar autenticaci√≥n:",e),console.error("Datos corruptos en localStorage, limpiando..."),this.logout()}}},getters:{isLoggedIn:e=>e.isAuthenticated,currentUser:e=>e.user}})},fa1c:function(e,t,o){"use strict";o.d(t,"d",(function(){return n})),o.d(t,"c",(function(){return i})),o.d(t,"a",(function(){return s})),o.d(t,"e",(function(){return l})),o.d(t,"b",(function(){return c}));var r=o("c1df"),a=o.n(r);o("898b");a.a.locale("es");const n=()=>{const e=new Date,t=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${t}-${o}-${r}`},i=e=>{if(!e)return n();if("string"===typeof e&&/^\d{4}-\d{2}-\d{2}$/.test(e))return e;const t=new Date(e);if(isNaN(t.getTime()))return console.warn(`Fecha inv√°lida recibida: ${e}, usando fecha actual`),n();const o=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");return`${o}-${r}-${a}`},s=(e,t)=>{const o=i(e),r=i(t);return o<=r},l=()=>Date.now(),c=e=>{if(!e)return"";try{const t=i(e),o=new Date(t+"T00:00:00");return o.toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"})}catch(t){return console.warn("Error al formatear fecha: "+e,t),e}}},fcda:function(e,t,o){"use strict";o.d(t,"b",(function(){return r})),o.d(t,"e",(function(){return a})),o.d(t,"d",(function(){return n})),o.d(t,"c",(function(){return i})),o.d(t,"a",(function(){return s})),o.d(t,"f",(function(){return l}));const r=e=>{if("number"===typeof e)return Math.floor(e)+" kg";if("object"===typeof e&&null!==e){const t=Math.floor((Number(e.medida1)||0)+(Number(e.medida2)||0));return t+" kg"}const t=Math.floor(Number(e));return t+" kg"},a=e=>Number(e).toFixed(2),n=e=>{if(!e)return"0";const t=Math.round(e);return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},i=e=>{if(!e)return"0";const t=Math.floor(e);return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},s=e=>{if(!e)return"Sin fecha";let t;if(e&&"function"===typeof e.toDate?t=e.toDate():"string"===typeof e?t=new Date(e):e instanceof Date&&(t=e),isNaN(t.getTime()))return"Fecha inv√°lida";const o=new Date(t.getTime()+6e4*t.getTimezoneOffset());return o.toLocaleDateString("es-MX",{year:"numeric",month:"2-digit",day:"2-digit",timeZone:"America/Mexico_City"})},l=e=>new Promise((t,o)=>{const r=new Image;r.crossOrigin="Anonymous",r.onload=function(){const e=document.createElement("canvas");e.width=r.width,e.height=r.height;const o=e.getContext("2d");o.drawImage(r,0,0);const a=e.toDataURL("image/png");t(a)},r.onerror=o,r.src=e})}}]);