(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["app.e346c0ac"],{"05e4":function(t,a,o){"use strict";o("959e")},"2b68":function(t,a,o){"use strict";o("d5fa")},"6ad3":function(t,a,o){"use strict";o("e3b7")},"959e":function(t,a,o){},a55b:function(t,a,o){"use strict";var e=function(){var t=this,a=t._self._c;return a("div",{staticClass:"login-container"},[a("div",{staticClass:"login-box"},[a("h2",[t._v("Iniciar Sesión")]),a("form",{on:{submit:function(a){return a.preventDefault(),t.handleLogin.apply(null,arguments)}}},[a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"username"}},[t._v("Usuario:")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.username,expression:"username"}],staticClass:"form-input",attrs:{type:"text",id:"username",required:""},domProps:{value:t.username},on:{input:function(a){a.target.composing||(t.username=a.target.value)}}})]),a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"password"}},[t._v("Contraseña:")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.password,expression:"password"}],staticClass:"form-input",attrs:{type:"password",id:"password",required:""},domProps:{value:t.password},on:{input:function(a){a.target.composing||(t.password=a.target.value)}}})]),t.error?a("div",{staticClass:"error-message"},[t._v(" "+t._s(t.error)+" ")]):t._e(),a("button",{staticClass:"login-button",attrs:{type:"submit"}},[t._v(" Iniciar Sesión ")])])])])},r=[],i=(o("14d9"),o("f549")),s={name:"Login",data(){return{username:"",password:"",error:""}},methods:{async handleLogin(){try{const t=Object(i["a"])(),a=await t.login(this.username,this.password);a?this.$router.push("/"):this.error="Usuario o contraseña incorrectos"}catch(t){console.error("Error en login:",t),this.error="Error al iniciar sesión"}}}},n=s,c=(o("2b68"),o("2877")),l=Object(c["a"])(n,e,r,!1,null,"6889dfef",null);a["a"]=l.exports},bb51:function(t,a,o){"use strict";var e=function(){var t=this,a=t._self._c;return a("div",{attrs:{id:"home"}},[a("b-container",[a("Datos")],1)],1)},r=[],i=o("caa9"),s={name:"home",components:{Datos:i["a"]}},n=s,c=o("2877"),l=Object(c["a"])(n,e,r,!1,null,null,null);a["a"]=l.exports},d5fa:function(t,a,o){},e3b7:function(t,a,o){},e524:function(t,a,o){"use strict";var e=function(){var t=this,a=t._self._c;return a("div",{staticClass:"bitacoras-container"},[a("h1",{staticClass:"page-title"},[t._v("Bitácoras de Mantenimiento - Cuartos Fríos")]),a("div",{staticClass:"filters-container"},[a("div",{staticClass:"filter-group"},[a("label",{attrs:{for:"cuarto-select"}},[t._v("Cuarto Frío:")]),a("select",{directives:[{name:"model",rawName:"v-model",value:t.filtrosCuarto,expression:"filtrosCuarto"}],staticClass:"form-control",attrs:{id:"cuarto-select"},on:{change:function(a){var o=Array.prototype.filter.call(a.target.options,(function(t){return t.selected})).map((function(t){var a="_value"in t?t._value:t.value;return a}));t.filtrosCuarto=a.target.multiple?o:o[0]}}},[a("option",{attrs:{value:""}},[t._v("Todos los cuartos")]),a("option",{attrs:{value:"1"}},[t._v("Cuarto Frío #1")]),a("option",{attrs:{value:"2"}},[t._v("Cuarto Frío #2")]),a("option",{attrs:{value:"3"}},[t._v("Cuarto Frío #3")]),a("option",{attrs:{value:"4"}},[t._v("Cuarto Frío #4")]),a("option",{attrs:{value:"5"}},[t._v("Cuarto Frío Don Chuy")])])]),a("div",{staticClass:"filter-group"},[a("label",{attrs:{for:"fecha-desde"}},[t._v("Desde:")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.filtroFechaDesde,expression:"filtroFechaDesde"}],staticClass:"form-control",attrs:{type:"date",id:"fecha-desde"},domProps:{value:t.filtroFechaDesde},on:{input:function(a){a.target.composing||(t.filtroFechaDesde=a.target.value)}}})]),a("div",{staticClass:"filter-group"},[a("label",{attrs:{for:"fecha-hasta"}},[t._v("Hasta:")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.filtroFechaHasta,expression:"filtroFechaHasta"}],staticClass:"form-control",attrs:{type:"date",id:"fecha-hasta"},domProps:{value:t.filtroFechaHasta},on:{input:function(a){a.target.composing||(t.filtroFechaHasta=a.target.value)}}})]),a("button",{staticClass:"btn-filtrar",on:{click:t.aplicarFiltros}},[a("i",{staticClass:"fas fa-filter"}),t._v(" Filtrar ")])]),a("div",{staticClass:"actions-row"},[a("button",{staticClass:"btn-nueva-bitacora",on:{click:function(a){t.mostrarFormulario=!0}}},[a("i",{staticClass:"fas fa-plus"}),t._v(" Nueva Bitácora ")])]),a("div",{staticClass:"table-responsive"},[a("table",{staticClass:"bitacoras-table"},[t._m(0),a("tbody",[t.cargando?a("tr",[a("td",{staticClass:"loading-data",attrs:{colspan:"7"}},[t._v("Cargando bitácoras...")])]):0===t.bitacoras.length?a("tr",[a("td",{staticClass:"no-data",attrs:{colspan:"7"}},[t._v("No hay bitácoras registradas")])]):t._e(),t._l(t.bitacorasFiltradas,(function(o,e){return a("tr",{key:o.id},[a("td",[t._v(t._s(t.formatearFecha(o.fecha)))]),a("td",[t._v(t._s(t.formatearNombreCuarto(o.cuartoId)))]),a("td",[t._v(t._s(o.temperatura)+"°C")]),a("td",[t._v(t._s(o.tecnico))]),a("td",[t._v(t._s(o.tipoMantenimiento))]),a("td",{class:"estado-"+o.estado.toLowerCase()},[t._v(t._s(o.estado))]),a("td",{staticClass:"acciones"},[a("button",{staticClass:"btn-accion editar",on:{click:function(a){return t.editarBitacora(o)}}},[a("i",{staticClass:"fas fa-edit"})]),a("button",{staticClass:"btn-accion ver",on:{click:function(a){return t.verDetalles(o)}}},[a("i",{staticClass:"fas fa-eye"})]),a("button",{staticClass:"btn-accion eliminar",on:{click:function(a){return t.confirmarEliminarBitacora(o)}}},[a("i",{staticClass:"fas fa-trash"})])])])}))],2)])]),t.mostrarFormulario?a("div",{staticClass:"modal-overlay"},[a("div",{staticClass:"modal-content"},[a("div",{staticClass:"modal-header"},[a("h2",[t._v(t._s(t.modoEdicion?"Editar Bitácora":"Nueva Bitácora"))]),a("button",{staticClass:"btn-cerrar",on:{click:t.cerrarFormulario}},[a("i",{staticClass:"fas fa-times"})])]),a("div",{staticClass:"modal-body"},[a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"cuarto"}},[t._v("Cuarto Frío:")]),a("select",{directives:[{name:"model",rawName:"v-model",value:t.bitacoraActual.cuartoId,expression:"bitacoraActual.cuartoId"}],staticClass:"form-control",attrs:{id:"cuarto",required:""},on:{change:function(a){var o=Array.prototype.filter.call(a.target.options,(function(t){return t.selected})).map((function(t){var a="_value"in t?t._value:t.value;return a}));t.$set(t.bitacoraActual,"cuartoId",a.target.multiple?o:o[0])}}},[a("option",{attrs:{value:"",disabled:""}},[t._v("Seleccione un cuarto frío")]),a("option",{attrs:{value:"1"}},[t._v("Cuarto Frío #1")]),a("option",{attrs:{value:"2"}},[t._v("Cuarto Frío #2")]),a("option",{attrs:{value:"3"}},[t._v("Cuarto Frío #3")]),a("option",{attrs:{value:"4"}},[t._v("Cuarto Frío #4")]),a("option",{attrs:{value:"5"}},[t._v("Cuarto Frío Don Chuy")])])]),a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"fecha"}},[t._v("Fecha:")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.bitacoraActual.fecha,expression:"bitacoraActual.fecha"}],staticClass:"form-control",attrs:{type:"date",id:"fecha",required:""},domProps:{value:t.bitacoraActual.fecha},on:{input:function(a){a.target.composing||t.$set(t.bitacoraActual,"fecha",a.target.value)}}})]),a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"temperatura"}},[t._v("Temperatura (°C):")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.bitacoraActual.temperatura,expression:"bitacoraActual.temperatura"}],staticClass:"form-control",attrs:{type:"number",id:"temperatura",step:"0.1",required:""},domProps:{value:t.bitacoraActual.temperatura},on:{input:function(a){a.target.composing||t.$set(t.bitacoraActual,"temperatura",a.target.value)}}})]),a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"tecnico"}},[t._v("Técnico:")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.bitacoraActual.tecnico,expression:"bitacoraActual.tecnico"}],staticClass:"form-control",attrs:{type:"text",id:"tecnico",required:""},domProps:{value:t.bitacoraActual.tecnico},on:{input:function(a){a.target.composing||t.$set(t.bitacoraActual,"tecnico",a.target.value)}}})]),a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"tipo-mantenimiento"}},[t._v("Tipo de Mantenimiento:")]),a("select",{directives:[{name:"model",rawName:"v-model",value:t.bitacoraActual.tipoMantenimiento,expression:"bitacoraActual.tipoMantenimiento"}],staticClass:"form-control",attrs:{id:"tipo-mantenimiento",required:""},on:{change:function(a){var o=Array.prototype.filter.call(a.target.options,(function(t){return t.selected})).map((function(t){var a="_value"in t?t._value:t.value;return a}));t.$set(t.bitacoraActual,"tipoMantenimiento",a.target.multiple?o:o[0])}}},[a("option",{attrs:{value:"",disabled:""}},[t._v("Seleccione tipo")]),a("option",{attrs:{value:"Preventivo"}},[t._v("Preventivo")]),a("option",{attrs:{value:"Correctivo"}},[t._v("Correctivo")]),a("option",{attrs:{value:"Revisión"}},[t._v("Revisión")])])]),a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"estado"}},[t._v("Estado:")]),a("select",{directives:[{name:"model",rawName:"v-model",value:t.bitacoraActual.estado,expression:"bitacoraActual.estado"}],staticClass:"form-control",attrs:{id:"estado",required:""},on:{change:function(a){var o=Array.prototype.filter.call(a.target.options,(function(t){return t.selected})).map((function(t){var a="_value"in t?t._value:t.value;return a}));t.$set(t.bitacoraActual,"estado",a.target.multiple?o:o[0])}}},[a("option",{attrs:{value:"",disabled:""}},[t._v("Seleccione estado")]),a("option",{attrs:{value:"Óptimo"}},[t._v("Óptimo")]),a("option",{attrs:{value:"Regular"}},[t._v("Regular")]),a("option",{attrs:{value:"Requiere Atención"}},[t._v("Requiere Atención")]),a("option",{attrs:{value:"Crítico"}},[t._v("Crítico")])])]),a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"observaciones"}},[t._v("Observaciones:")]),a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.bitacoraActual.observaciones,expression:"bitacoraActual.observaciones"}],staticClass:"form-control",attrs:{id:"observaciones",rows:"4"},domProps:{value:t.bitacoraActual.observaciones},on:{input:function(a){a.target.composing||t.$set(t.bitacoraActual,"observaciones",a.target.value)}}})]),a("div",{staticClass:"form-group"},[a("label",{attrs:{for:"acciones"}},[t._v("Acciones Realizadas:")]),a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.bitacoraActual.accionesRealizadas,expression:"bitacoraActual.accionesRealizadas"}],staticClass:"form-control",attrs:{id:"acciones",rows:"4"},domProps:{value:t.bitacoraActual.accionesRealizadas},on:{input:function(a){a.target.composing||t.$set(t.bitacoraActual,"accionesRealizadas",a.target.value)}}})])]),a("div",{staticClass:"modal-footer"},[a("button",{staticClass:"btn-cancelar",on:{click:t.cerrarFormulario}},[t._v("Cancelar")]),a("button",{staticClass:"btn-guardar",attrs:{disabled:t.guardando},on:{click:t.guardarBitacora}},[t._v(" "+t._s(t.guardando?"Guardando...":"Guardar")+" ")])])])]):t._e(),t.mostrarDetalles?a("div",{staticClass:"modal-overlay"},[a("div",{staticClass:"modal-content"},[a("div",{staticClass:"modal-header"},[a("h2",[t._v("Detalles de Bitácora")]),a("button",{staticClass:"btn-cerrar",on:{click:function(a){t.mostrarDetalles=!1}}},[a("i",{staticClass:"fas fa-times"})])]),a("div",{staticClass:"modal-body detalles"},[a("div",{staticClass:"detalle-grupo"},[a("h3",[t._v("Información General")]),a("p",[a("strong",[t._v("Cuarto Frío:")]),t._v(" "+t._s(t.formatearNombreCuarto(t.bitacoraDetalle.cuartoId)))]),a("p",[a("strong",[t._v("Fecha:")]),t._v(" "+t._s(t.formatearFecha(t.bitacoraDetalle.fecha)))]),a("p",[a("strong",[t._v("Temperatura:")]),t._v(" "+t._s(t.bitacoraDetalle.temperatura)+"°C")]),a("p",[a("strong",[t._v("Técnico:")]),t._v(" "+t._s(t.bitacoraDetalle.tecnico))])]),a("div",{staticClass:"detalle-grupo"},[a("h3",[t._v("Mantenimiento")]),a("p",[a("strong",[t._v("Tipo:")]),t._v(" "+t._s(t.bitacoraDetalle.tipoMantenimiento))]),a("p",[a("strong",[t._v("Estado:")]),t._v(" "),a("span",{class:"estado-tag estado-"+t.bitacoraDetalle.estado.toLowerCase()},[t._v(t._s(t.bitacoraDetalle.estado))])])]),a("div",{staticClass:"detalle-grupo"},[a("h3",[t._v("Observaciones")]),a("p",{staticClass:"texto-largo"},[t._v(t._s(t.bitacoraDetalle.observaciones||"Sin observaciones"))])]),a("div",{staticClass:"detalle-grupo"},[a("h3",[t._v("Acciones Realizadas")]),a("p",{staticClass:"texto-largo"},[t._v(t._s(t.bitacoraDetalle.accionesRealizadas||"Sin acciones registradas"))])])]),a("div",{staticClass:"modal-footer"},[a("button",{staticClass:"btn-cerrar-detalles",on:{click:function(a){t.mostrarDetalles=!1}}},[t._v("Cerrar")]),a("button",{staticClass:"btn-editar-detalles",on:{click:t.editarBitacoraDesdeDetalles}},[t._v("Editar")])])])]):t._e(),t.mostrarConfirmacionEliminar?a("div",{staticClass:"modal-overlay"},[a("div",{staticClass:"modal-content modal-confirmacion"},[a("div",{staticClass:"modal-header"},[a("h2",[t._v("Confirmar Eliminación")]),a("button",{staticClass:"btn-cerrar",on:{click:function(a){t.mostrarConfirmacionEliminar=!1}}},[a("i",{staticClass:"fas fa-times"})])]),a("div",{staticClass:"modal-body"},[a("p",{staticClass:"mensaje-confirmacion"},[t._v(" ¿Está seguro que desea eliminar la bitácora del "+t._s(t.formatearFecha(t.bitacoraEliminar.fecha))+" para el "+t._s(t.formatearNombreCuarto(t.bitacoraEliminar.cuartoId))+"? ")]),a("p",{staticClass:"advertencia"},[t._v("Esta acción no se puede deshacer.")])]),a("div",{staticClass:"modal-footer"},[a("button",{staticClass:"btn-cancelar",on:{click:function(a){t.mostrarConfirmacionEliminar=!1}}},[t._v("Cancelar")]),a("button",{staticClass:"btn-eliminar",attrs:{disabled:t.eliminando},on:{click:t.eliminarBitacora}},[t._v(" "+t._s(t.eliminando?"Eliminando...":"Eliminar")+" ")])])])]):t._e()])},r=[function(){var t=this,a=t._self._c;return a("thead",[a("tr",[a("th",[t._v("Fecha")]),a("th",[t._v("Cuarto Frío")]),a("th",[t._v("Temperatura")]),a("th",[t._v("Técnico")]),a("th",[t._v("Tipo de Mantenimiento")]),a("th",[t._v("Estado")]),a("th",[t._v("Acciones")])])])}],i=(o("d9e2"),o("dc59")),s=o("1494"),n={name:"Bitacoras",data(){return{bitacoras:[],mostrarFormulario:!1,mostrarDetalles:!1,mostrarConfirmacionEliminar:!1,modoEdicion:!1,bitacoraActual:this.inicializarBitacora(),bitacoraDetalle:{},bitacoraEliminar:{},filtrosCuarto:"",filtroFechaDesde:"",filtroFechaHasta:"",cargando:!0,guardando:!1,eliminando:!1}},computed:{bitacorasFiltradas(){let t=[...this.bitacoras];return this.filtrosCuarto&&(t=t.filter(t=>t.cuartoId.toString()===this.filtrosCuarto)),this.filtroFechaDesde&&(t=t.filter(t=>new Date(t.fecha)>=new Date(this.filtroFechaDesde))),this.filtroFechaHasta&&(t=t.filter(t=>new Date(t.fecha)<=new Date(this.filtroFechaHasta))),t.sort((t,a)=>new Date(a.fecha)-new Date(t.fecha))}},created(){this.cargarBitacoras()},methods:{inicializarBitacora(){return{id:null,cuartoId:"",fecha:(new Date).toISOString().substr(0,10),temperatura:"",tecnico:"",tipoMantenimiento:"",estado:"",observaciones:"",accionesRealizadas:"",createdAt:null,updatedAt:null}},async cargarBitacoras(){this.cargando=!0;try{const t=Object(s["c"])(i["a"],"bitacoras"),a=Object(s["o"])(t,Object(s["l"])("fecha","desc")),o=await Object(s["g"])(a);this.bitacoras=o.docs.map(t=>{const a=t.data(),o=t.id.toString();return console.log("Cargando bitácora con ID: "+o),{id:o,cuartoId:a.cuartoId||"",fecha:a.fecha||(new Date).toISOString().substr(0,10),temperatura:a.temperatura||0,tecnico:a.tecnico||"",tipoMantenimiento:a.tipoMantenimiento||"",estado:a.estado||"",observaciones:a.observaciones||"",accionesRealizadas:a.accionesRealizadas||"",createdAt:a.createdAt||null,updatedAt:a.updatedAt||null}}),console.log(`Se cargaron ${this.bitacoras.length} bitácoras`)}catch(t){console.error("Error al cargar bitácoras:",t),alert("Error al cargar las bitácoras: "+(t.message||"Error desconocido"))}finally{this.cargando=!1}},formatearFecha(t){if(!t)return"";const a={year:"numeric",month:"long",day:"numeric"};return new Date(t).toLocaleDateString("es-ES",a)},formatearNombreCuarto(t){return t?"5"===t?"Cuarto Frío Don Chuy":"Cuarto Frío #"+t:""},aplicarFiltros(){},editarBitacora(t){this.modoEdicion=!0,this.bitacoraActual={...t},this.mostrarFormulario=!0},verDetalles(t){this.bitacoraDetalle={...t},this.mostrarDetalles=!0},cerrarFormulario(){this.mostrarFormulario=!1,this.modoEdicion=!1,this.bitacoraActual=this.inicializarBitacora(),this.guardando=!1},async guardarBitacora(){if(this.validarFormulario()){this.guardando=!0;try{const t={...this.bitacoraActual,cuartoId:this.bitacoraActual.cuartoId.toString(),temperatura:parseFloat(this.bitacoraActual.temperatura)||0,tecnico:this.bitacoraActual.tecnico.trim(),tipoMantenimiento:this.bitacoraActual.tipoMantenimiento,estado:this.bitacoraActual.estado,observaciones:this.bitacoraActual.observaciones||"",accionesRealizadas:this.bitacoraActual.accionesRealizadas||"",updatedAt:Object(s["p"])()};if(this.modoEdicion){if(!t.id)throw new Error("ID de bitácora no válido para actualización");console.log("Actualizando bitácora con ID:",t.id);const{id:a,...o}=t,e=Object(s["e"])(i["a"],"bitacoras",a.toString());await Object(s["r"])(e,o);const r=this.bitacoras.findIndex(t=>t.id===a);-1!==r&&this.bitacoras.splice(r,1,t),console.log("Bitácora actualizada con éxito")}else{t.createdAt=Object(s["p"])(),console.log("Creando nueva bitácora");const a=await Object(s["b"])(Object(s["c"])(i["a"],"bitacoras"),t),o={...t,id:a.id.toString()};console.log("Nueva bitácora creada con ID:",o.id),this.bitacoras.unshift(o)}this.cerrarFormulario(),alert(this.modoEdicion?"Bitácora actualizada con éxito":"Bitácora creada con éxito")}catch(t){console.error("Error al guardar bitácora:",t),alert("Error al guardar la bitácora: "+(t.message||"Error desconocido"))}finally{this.guardando=!1}}},validarFormulario(){return!!(this.bitacoraActual.cuartoId&&this.bitacoraActual.fecha&&""!==this.bitacoraActual.temperatura&&this.bitacoraActual.tecnico&&this.bitacoraActual.tipoMantenimiento&&this.bitacoraActual.estado)||(alert("Por favor complete todos los campos obligatorios"),!1)},editarBitacoraDesdeDetalles(){this.editarBitacora(this.bitacoraDetalle),this.mostrarDetalles=!1},confirmarEliminarBitacora(t){if(!t||!t.id)return console.error("Intento de eliminar una bitácora sin ID válido:",t),void alert("No se puede eliminar esta bitácora porque no tiene un ID válido");console.log("Preparando eliminación de bitácora con ID:",t.id),this.bitacoraEliminar={...t},this.mostrarConfirmacionEliminar=!0},async eliminarBitacora(){this.eliminando=!0;try{if(!this.bitacoraEliminar||!this.bitacoraEliminar.id)throw new Error("ID de bitácora no válido");const t=this.bitacoraEliminar.id.toString();console.log("Intentando eliminar bitácora con ID:",t);const a=Object(s["e"])(i["a"],"bitacoras",t);await Object(s["d"])(a);const o=this.bitacoras.findIndex(a=>a.id===t);-1!==o&&this.bitacoras.splice(o,1),this.mostrarConfirmacionEliminar=!1,alert("Bitácora eliminada con éxito")}catch(t){console.error("Error al eliminar bitácora:",t),alert("Error al eliminar la bitácora: "+(t.message||"Error desconocido"))}finally{this.eliminando=!1,this.bitacoraEliminar={}}}}},c=n,l=(o("05e4"),o("2877")),d=Object(l["a"])(c,e,r,!1,null,"fc24882a",null);a["a"]=d.exports},f411:function(t,a,o){"use strict";var e=function(){var t=this,a=t._self._c;return a("div",{staticClass:"notes-wrapper"},[a("div",{staticClass:"button-container"},[a("div",{staticClass:"button-wrapper"},[a("button",{on:{click:t.goToSaleNote}},[t._v("Nueva nota")])]),a("div",{staticClass:"button-wrapper"},[a("button",{on:{click:t.goToAddClient}},[t._v("Agregar Cliente")])])]),a("div",{staticClass:"notes-container"},[a("div",{staticClass:"filter-container"},[a("select",{directives:[{name:"model",rawName:"v-model",value:t.paymentFilter,expression:"paymentFilter"}],on:{change:function(a){var o=Array.prototype.filter.call(a.target.options,(function(t){return t.selected})).map((function(t){var a="_value"in t?t._value:t.value;return a}));t.paymentFilter=a.target.multiple?o:o[0]}}},[a("option",{attrs:{value:"all"}},[t._v("Todas")]),a("option",{attrs:{value:"paid"}},[t._v("Pagadas")]),a("option",{attrs:{value:"unpaid"}},[t._v("No Pagadas")])])]),a("h2",[t._v("Notas por Cliente")]),t._l(t.filteredNotesByClient,(function(o,e){return a("div",{key:e},[a("details",[a("summary",[t._v(" "+t._s(e)+" - Debe: "+t._s(t._f("currency")(t.totalDebtByClient[e]))+" "),a("span",{staticClass:"note-count"},[t._v("("+t._s(o.length)+")")])]),a("ul",t._l(o,(function(o){return a("li",{key:o.id},[a("button",{attrs:{tabindex:"0"},on:{click:function(a){return t.goToEditNote(o.id)}}},[t._v(" Nota "+t._s(o.folio)+" - "+t._s(o.currentDate)+" ")])])})),0),a("div",{staticClass:"client-actions"},[a("button",{staticClass:"abono-button",on:{click:function(a){return t.showAbonoModal(e)}}},[t._v("Realizar Abono")]),a("button",{staticClass:"abonos-history-button",on:{click:function(a){return t.showAbonosHistory(e)}}},[t._v("Ver Abonos")])])])])}))],2),t.showModal?a("div",{staticClass:"modal"},[a("div",{staticClass:"modal-content"},[a("h2",[t._v("Realizar Abono para "+t._s(t.selectedClient))]),a("input",{directives:[{name:"model",rawName:"v-model.number",value:t.abonoAmount,expression:"abonoAmount",modifiers:{number:!0}}],attrs:{type:"number",placeholder:"Cantidad a abonar"},domProps:{value:t.abonoAmount},on:{input:function(a){a.target.composing||(t.abonoAmount=t._n(a.target.value))},blur:function(a){return t.$forceUpdate()}}}),a("button",{on:{click:t.realizarAbono}},[t._v("Confirmar Abono")]),a("button",{on:{click:t.closeModal}},[t._v("Cancelar")])])]):t._e(),t.showAbonosHistoryModal?a("div",{staticClass:"modal"},[a("div",{staticClass:"modal-content"},[a("h2",[t._v("Historial de Abonos para "+t._s(t.selectedClient))]),a("table",{staticClass:"abonos-history-table"},[t._m(0),a("tbody",t._l(t.paginatedAbonos,(function(o,e){return a("tr",{key:e},[a("td",[t._v(t._s(t.formatDate(o.fecha)))]),a("td",[t._v(t._s(t._f("currency")(o.monto)))]),a("td",[a("button",{staticClass:"delete-button",on:{click:function(a){return t.openDeleteAbonoModal(o.globalIndex)}}},[t._v("Borrar")])])])})),0)]),a("div",{staticClass:"pagination"},[a("button",{attrs:{disabled:1===t.currentPage},on:{click:t.prevPage}},[t._v("Anterior")]),a("span",[t._v("Página "+t._s(t.currentPage)+" de "+t._s(t.totalPages))]),a("button",{attrs:{disabled:t.currentPage===t.totalPages},on:{click:t.nextPage}},[t._v("Siguiente")])]),a("button",{on:{click:t.closeAbonosHistoryModal}},[t._v("Cerrar")])])]):t._e(),t.showDeleteAbonoModal?a("div",{staticClass:"modal"},[a("div",{staticClass:"modal-content"},[a("h2",[t._v("Confirmar borrado de abono")]),a("p",[t._v("¿Estás seguro de que quieres borrar este abono?")]),a("button",{on:{click:t.deleteAbono}},[t._v("Confirmar")]),a("button",{on:{click:t.closeDeleteAbonoModal}},[t._v("Cancelar")])])]):t._e()])},r=[function(){var t=this,a=t._self._c;return a("thead",[a("tr",[a("th",[t._v("Fecha")]),a("th",[t._v("Monto")]),a("th",[t._v("Acciones")])])])}],i=(o("14d9"),o("13d5"),o("dc59")),s=o("1494"),n={name:"NoteMenu",data(){return{notesByClient:{},paymentFilter:"unpaid",showModal:!1,selectedClient:"",abonoAmount:0,showAbonosHistoryModal:!1,clientAbonosHistory:[],showDeleteAbonoModal:!1,selectedAbonoIndex:null,selectedAbonoNote:null,currentPage:1,abonosPerPage:7}},methods:{goToSaleNote(){this.$router.push({name:"SaleNote"})},goToAddClient(){this.$router.push({name:"AddClient"})},async fetchNotes(){try{const t=await Object(s["g"])(Object(s["c"])(i["a"],"notes")),a=t.docs.map(t=>({id:t.id,...t.data()}));this.notesByClient=a.reduce((t,a)=>(t[a.client]||(t[a.client]=[]),t[a.client].push(a),t),{});for(let o in this.notesByClient)this.notesByClient[o].sort((t,a)=>new Date(a.currentDate)-new Date(t.currentDate))}catch(t){console.error("Error fetching notes: ",t)}},goToEditNote(t){this.$router.push({name:"editar-nota",params:{noteId:t}})},showAbonoModal(t){this.selectedClient=t,this.abonoAmount="",this.showModal=!0},closeModal(){this.showModal=!1,this.selectedClient="",this.abonoAmount=0},async realizarAbono(){if(this.abonoAmount<=0)return void alert("Por favor ingrese una cantidad válida");let t=this.abonoAmount;const a=[],o=new Date,e=[...this.notesByClient[this.selectedClient]].sort((t,a)=>new Date(t.currentDate)-new Date(a.currentDate)).filter(t=>!t.isPaid);for(let i of e){if(t<=0)break;const e=i.products.reduce((t,a)=>t+a.kilos*a.pricePerKilo,0),r=i.abonos.reduce((t,a)=>t+a.monto,0),s=e-r;if(s>0){const n=Math.min(t,s);i.abonos.push({monto:n,fecha:o.toISOString().split("T")[0]}),i.isPaid=e<=r+n,t-=n,a.push(i)}}try{for(let t of a){const a=Object(s["e"])(i["a"],"notes",t.id);await Object(s["r"])(a,{abonos:t.abonos,isPaid:t.isPaid})}alert("Abono aplicado con éxito"),this.closeModal(),await this.fetchNotes()}catch(r){console.error("Error al actualizar las notas:",r),alert("Hubo un error al aplicar el abono")}},async showAbonosHistory(t){this.selectedClient=t,this.clientAbonosHistory=[],this.currentPage=1;const a=this.notesByClient[t];let o=0;for(let e of a)e.abonos&&e.abonos.length>0&&e.abonos.forEach((t,a)=>{this.clientAbonosHistory.push({...t,noteId:e.id,abonoIndex:a,globalIndex:o++})});this.clientAbonosHistory.sort((t,a)=>new Date(a.fecha)-new Date(t.fecha)),this.showAbonosHistoryModal=!0},closeAbonosHistoryModal(){this.showAbonosHistoryModal=!1,this.clientAbonosHistory=[]},formatDate(t){const a={year:"numeric",month:"long",day:"numeric"};return new Date(t).toLocaleDateString("es-ES",a)},prevPage(){this.currentPage>1&&this.currentPage--},nextPage(){this.currentPage<this.totalPages&&this.currentPage++},openDeleteAbonoModal(t){const a=this.clientAbonosHistory[t];this.selectedAbonoIndex=a.abonoIndex,this.selectedAbonoNote=a.noteId,this.showDeleteAbonoModal=!0},async deleteAbono(){if(this.selectedAbonoNote)try{const t=Object(s["e"])(i["a"],"notes",this.selectedAbonoNote),a=await Object(s["f"])(t);if(a.exists()){const o=a.data(),e=o.abonos.filter((t,a)=>a!==this.selectedAbonoIndex);await Object(s["r"])(t,{abonos:e}),this.clientAbonosHistory=this.clientAbonosHistory.filter(t=>!(t.noteId===this.selectedAbonoNote&&t.abonoIndex===this.selectedAbonoIndex));const r=this.notesByClient[this.selectedClient].findIndex(t=>t.id===this.selectedAbonoNote);-1!==r&&(this.notesByClient[this.selectedClient][r].abonos=e),this.closeDeleteAbonoModal(),this.currentPage=Math.min(this.currentPage,this.totalPages),alert("Abono eliminado con éxito"),await this.fetchNotes()}}catch(t){console.error("Error al eliminar el abono:",t),alert("Hubo un error al eliminar el abono")}},closeDeleteAbonoModal(){this.showDeleteAbonoModal=!1,this.selectedAbonoIndex=null,this.selectedAbonoNote=null}},computed:{filteredNotesByClient(){const t={};for(const[a,o]of Object.entries(this.notesByClient))t[a]=o.filter(t=>"all"===this.paymentFilter||("paid"===this.paymentFilter?t.isPaid:!t.isPaid)),0===t[a].length&&delete t[a];return t},totalDebtByClient(){const t={};for(const[a,o]of Object.entries(this.notesByClient))t[a]=o.reduce((t,a)=>{const o=a.products.reduce((t,a)=>t+a.kilos*a.pricePerKilo,0)-a.abonos.reduce((t,a)=>t+a.monto,0);return t+(a.isPaid?0:o)},0);return t},paginatedAbonos(){const t=(this.currentPage-1)*this.abonosPerPage,a=t+this.abonosPerPage;return this.clientAbonosHistory.slice(t,a)},totalPages(){return Math.ceil(this.clientAbonosHistory.length/this.abonosPerPage)}},filters:{currency(t){return t?new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(t):"$0.00"}},async mounted(){await this.fetchNotes()}},c=n,l=(o("6ad3"),o("2877")),d=Object(l["a"])(c,e,r,!1,null,"8753db2c",null);a["a"]=d.exports}}]);