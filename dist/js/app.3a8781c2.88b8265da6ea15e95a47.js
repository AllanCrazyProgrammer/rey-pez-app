(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["app.3a8781c2"],{"320e":function(a,t,e){"use strict";var o=function(){var a=this,t=a._self._c;return t("div",{staticClass:"embarques-menu"},[t("div",{staticClass:"crt-overlay"}),t("div",{staticClass:"crt-flicker"}),t("div",{staticClass:"terminal-container"},[a._m(0),t("div",{staticClass:"menu-options"},[t("div",{staticClass:"menu-label"},[a._v(">> SELECCIONE UNA OPCIÓN:")]),t("button",{staticClass:"btn-action btn-nuevo-embarque",on:{click:a.nuevoEmbarque}},[t("span",{staticClass:"btn-prefix"},[a._v("[1]")]),t("span",{staticClass:"btn-icon"},[a._v("+")]),t("span",{staticClass:"btn-text"},[a._v("NUEVO_EMBARQUE")])]),t("button",{staticClass:"btn-action btn-cuenta-fletes",on:{click:a.verCuentaFletes}},[t("span",{staticClass:"btn-prefix"},[a._v("[2]")]),t("span",{staticClass:"btn-icon"},[a._v("$")]),t("span",{staticClass:"btn-text"},[a._v("CUENTA_FLETES")])]),t("button",{staticClass:"btn-action btn-emergencia",on:{click:a.recuperacionEmergencia}},[t("span",{staticClass:"btn-prefix"},[a._v("[!]")]),t("span",{staticClass:"btn-icon"},[a._v("⚠")]),t("span",{staticClass:"btn-text"},[a._v("RECUPERAR_DATOS")])])]),t("div",{staticClass:"matrix-rain",attrs:{"aria-hidden":"true"}},a._l(20,(function(e){return t("span",{key:e,staticClass:"rain-column",style:{"--delay":.3*e+"s","--left":5*e+"%"}},[a._v(" "+a._s(a.randomChars)+" ")])})),0)]),t("ListaEmbarques")],1)},s=[function(){var a=this,t=a._self._c;return t("div",{staticClass:"header-section"},[t("div",{staticClass:"terminal-header"},[t("span",{staticClass:"terminal-dots"},[t("span",{staticClass:"dot"}),t("span",{staticClass:"dot"}),t("span",{staticClass:"dot"})]),t("span",{staticClass:"terminal-title"},[a._v("EMBARQUES_SYSTEM v2.4.80")])]),t("div",{staticClass:"header-content"},[t("pre",{staticClass:"ascii-ship"},[a._v("     |    |    |\n    )_)  )_)  )_)\n   )___))___))___)\n  )____)____)_____)\n_____|____|____|______\n\\                   /\n \\_________________/\n          ")]),t("h1",{staticClass:"main-title"},[t("span",{staticClass:"prompt"},[a._v(">")]),t("span",{staticClass:"typing-text"},[a._v("MENU_EMBARQUES")]),t("span",{staticClass:"cursor-blink"},[a._v("_")])]),t("p",{staticClass:"subtitle"},[t("span",{staticClass:"line-prefix"},[a._v("[SYS]")]),a._v(" Gestiona todos tus embarques de manera eficiente ")]),t("p",{staticClass:"system-status"},[t("span",{staticClass:"status-item"},[t("span",{staticClass:"status-dot online"}),a._v(" SISTEMA: ONLINE")]),t("span",{staticClass:"status-item"},[t("span",{staticClass:"status-dot"}),a._v(" CONEXIÓN: ACTIVA")])])])])}],n=(e("14d9"),e("b34e")),r={name:"EmbarquesMenu",components:{ListaEmbarques:n["a"]},data(){return{}},computed:{randomChars(){const a="アイウエオカキクケコサシスセソタチツテトナニヌネノハヒフヘホマミムメモヤユヨラリルレロワヲン01234567890";let t="";for(let e=0;e<30;e++)t+=a.charAt(Math.floor(Math.random()*a.length))+"\n";return t}},methods:{nuevoEmbarque(){this.$router.push({name:"NuevoEmbarque",params:{id:"nuevo"}})},verCuentaFletes(){this.$router.push({name:"CuentaFletes"})},recuperacionEmergencia(){this.$router.push("/embarques/recuperacion-emergencia")}}},i=r,l=(e("38f3"),e("2877")),c=Object(l["a"])(i,o,s,!1,null,"03e53d4b",null);t["a"]=c.exports},"38f3":function(a,t,e){"use strict";e("4aa5")},"39a5":function(a,t,e){},"4aa5":function(a,t,e){},"9aeb":function(a,t,e){"use strict";var o=function(){var a=this,t=a._self._c;return t("div",{staticClass:"cuenta-fletes"},[t("div",{staticClass:"header-section"},[t("button",{staticClass:"btn-volver",on:{click:a.volverMenu}},[a._v(" ← Volver al Menú ")]),t("h2",[a._v("Cuenta de Fletes")])]),t("div",{staticClass:"chofer-selector"},[t("button",{class:["btn-chofer",{active:"Caminante"===a.choferSeleccionado}],on:{click:function(t){a.choferSeleccionado="Caminante"}}},[a._v(" Caminante ")]),t("button",{class:["btn-chofer",{active:"Porro"===a.choferSeleccionado}],on:{click:function(t){a.choferSeleccionado="Porro"}}},[a._v(" Porro ")]),t("button",{staticClass:"btn-imprimir",on:{click:a.generarPDF}},[a._v(" Imprimir Cuenta Pendiente ")])]),t("div",{staticClass:"abonos-section"},[t("h3",[a._v("Registrar Abono")]),t("div",{staticClass:"abono-inputs"},[t("div",{staticClass:"input-group"},[t("label",[a._v("Monto del Abono:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.nuevoAbono.monto,expression:"nuevoAbono.monto"}],staticClass:"input-abono",attrs:{type:"number",placeholder:"Cantidad"},domProps:{value:a.nuevoAbono.monto},on:{input:function(t){t.target.composing||a.$set(a.nuevoAbono,"monto",t.target.value)}}})]),t("div",{staticClass:"input-group"},[t("label",[a._v("Fecha del Abono:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.nuevoAbono.fecha,expression:"nuevoAbono.fecha"}],staticClass:"input-fecha",attrs:{type:"date"},domProps:{value:a.nuevoAbono.fecha},on:{input:function(t){t.target.composing||a.$set(a.nuevoAbono,"fecha",t.target.value)}}})]),t("div",{staticClass:"input-group"},[t("label",[a._v("Descripción:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.nuevoAbono.descripcion,expression:"nuevoAbono.descripcion"}],staticClass:"input-descripcion",attrs:{type:"text",placeholder:"Descripción del abono"},domProps:{value:a.nuevoAbono.descripcion},on:{input:function(t){t.target.composing||a.$set(a.nuevoAbono,"descripcion",t.target.value)}}})]),t("button",{staticClass:"btn-agregar-abono",attrs:{disabled:!a.nuevoAbono.monto||!a.nuevoAbono.fecha},on:{click:a.agregarAbono}},[a._v(" Agregar Abono ")])])]),t("div",{staticClass:"tabla-container"},[t("div",{staticClass:"tabla-desktop"},[t("table",{staticClass:"tabla-fletes"},[a._m(0),t("tbody",[a._l(a.itemsOrdenados,(function(e,o){return[t("tr",{key:e.id,class:{"fila-abono":"abono"===e.tipo}},[t("td",[a._v(a._s(a.formatearFecha(e.fecha)))]),t("td",[a._v(a._s("abono"===e.tipo?"Abono":"Flete"))]),t("td",[a._v(a._s("abono"===e.tipo?"-":e.tarasLimpioJoselito))]),t("td",[a._v(a._s("abono"===e.tipo?"-":e.tarasCrudoJoselito))]),t("td",[a._v(a._s("abono"===e.tipo?"-":e.tarasLimpioVeronica||0))]),t("td",[a._v(a._s("abono"===e.tipo?"-":e.tarasCrudoVeronica||0))]),t("td",[a._v(a._s("abono"===e.tipo?"-":e.tarasLimpioJoselito+e.tarasCrudoJoselito+((e.tarasLimpioVeronica||0)+(e.tarasCrudoVeronica||0))))]),t("td",[a._v(a._s("abono"===e.tipo?a.formatearMonto(-e.monto):a.formatearMonto(a.calcularMontoDia(e))))]),t("td",[a._v(a._s(a.formatearMonto(a.calcularDeudaAcumulada(o))))]),t("td",["flete"===e.tipo?t("span",{class:["estado",e.pagado?"pagado":"pendiente"]},[a._v(" "+a._s(e.pagado?"Pagado":"Pendiente")+" ")]):t("span",{staticClass:"estado abono"},[a._v("Abono")])]),t("td",["flete"===e.tipo?t("button",{class:["btn-pago",e.pagado?"btn-marcar-pendiente":"btn-marcar-pagado"],on:{click:function(t){return a.togglePago(e)}}},[a._v(" "+a._s(e.pagado?"Marcar Pendiente":"Marcar Pagado")+" ")]):t("button",{staticClass:"btn-eliminar-abono",on:{click:function(t){return a.eliminarAbono(e)}}},[a._v(" Eliminar Abono ")])])])]}))],2)])]),t("div",{staticClass:"tabla-mobile"},a._l(a.itemsOrdenados,(function(e,o){return t("div",{key:e.id,staticClass:"flete-card",class:{pagado:e.pagado,abono:"abono"===e.tipo}},[t("div",{staticClass:"flete-header"},[t("span",{staticClass:"fecha"},[a._v(a._s(a.formatearFecha(e.fecha)))]),"flete"===e.tipo?t("span",{class:["estado",e.pagado?"pagado":"pendiente"]},[a._v(" "+a._s(e.pagado?"Pagado":"Pendiente")+" ")]):t("span",{staticClass:"estado abono"},[a._v("Abono")])]),t("div",{staticClass:"flete-body"},[t("div",{staticClass:"flete-row"},[t("span",{staticClass:"label"},[a._v("Tipo:")]),t("span",{staticClass:"value"},[a._v(a._s("abono"===e.tipo?"Abono":"Flete"))])]),"flete"===e.tipo?[t("div",{staticClass:"cliente-section"},[t("h4",{staticClass:"cliente-title"},[a._v("Joselito")]),t("div",{staticClass:"flete-row"},[t("span",{staticClass:"label"},[a._v("Taras Limpio:")]),t("span",{staticClass:"value"},[a._v(a._s(e.tarasLimpioJoselito))])]),t("div",{staticClass:"flete-row"},[t("span",{staticClass:"label"},[a._v("Taras Crudo:")]),t("span",{staticClass:"value"},[a._v(a._s(e.tarasCrudoJoselito))])])]),t("div",{staticClass:"cliente-section"},[t("h4",{staticClass:"cliente-title"},[a._v("Lorena")]),t("div",{staticClass:"flete-row"},[t("span",{staticClass:"label"},[a._v("Taras Limpio:")]),t("span",{staticClass:"value"},[a._v(a._s(e.tarasLimpioVeronica||0))])]),t("div",{staticClass:"flete-row"},[t("span",{staticClass:"label"},[a._v("Taras Crudo:")]),t("span",{staticClass:"value"},[a._v(a._s(e.tarasCrudoVeronica||0))])]),t("div",{staticClass:"flete-row total-row"},[t("span",{staticClass:"label"},[a._v("Total Taras:")]),t("span",{staticClass:"value"},[a._v(a._s(e.tarasLimpioJoselito+e.tarasCrudoJoselito+((e.tarasLimpioVeronica||0)+(e.tarasCrudoVeronica||0))))])])])]:a._e(),t("div",{staticClass:"flete-row"},[t("span",{staticClass:"label"},[a._v(a._s("abono"===e.tipo?"Monto Abonado:":"Monto del Día:"))]),t("span",{staticClass:"value"},[a._v(a._s("abono"===e.tipo?a.formatearMonto(-e.monto):a.formatearMonto(a.calcularMontoDia(e))))])]),t("div",{staticClass:"flete-row"},[t("span",{staticClass:"label"},[a._v("Deuda Acumulada:")]),t("span",{staticClass:"value"},[a._v(a._s(a.formatearMonto(a.calcularDeudaAcumulada(o))))])])],2),t("div",{staticClass:"flete-footer"},["flete"===e.tipo?t("button",{class:["btn-pago",e.pagado?"btn-marcar-pendiente":"btn-marcar-pagado"],on:{click:function(t){return a.togglePago(e)}}},[a._v(" "+a._s(e.pagado?"Marcar Pendiente":"Marcar Pagado")+" ")]):t("button",{staticClass:"btn-eliminar-abono",on:{click:function(t){return a.eliminarAbono(e)}}},[a._v(" Eliminar Abono ")])])])})),0)]),t("div",{staticClass:"resumen"},[t("h3",[a._v("Resumen de Cuenta")]),t("div",{staticClass:"resumen-detalles"},[t("div",{staticClass:"resumen-cliente"},[t("h4",[a._v("Cliente Joselito")]),t("div",{staticClass:"resumen-grid"},[t("div",{staticClass:"resumen-card"},[t("span",{staticClass:"resumen-label"},[a._v("Taras Limpio:")]),t("span",{staticClass:"resumen-value"},[a._v(a._s(a.totalTarasLimpioJoselito))])]),t("div",{staticClass:"resumen-card"},[t("span",{staticClass:"resumen-label"},[a._v("Taras Crudo:")]),t("span",{staticClass:"resumen-value"},[a._v(a._s(a.totalTarasCrudoJoselito))])]),t("div",{staticClass:"resumen-card"},[t("span",{staticClass:"resumen-label"},[a._v("Total:")]),t("span",{staticClass:"resumen-value"},[a._v(a._s(a.totalTarasLimpioJoselito+a.totalTarasCrudoJoselito))])])])]),t("div",{staticClass:"resumen-cliente"},[t("h4",[a._v("Cliente Lorena")]),t("div",{staticClass:"resumen-grid"},[t("div",{staticClass:"resumen-card"},[t("span",{staticClass:"resumen-label"},[a._v("Taras Limpio:")]),t("span",{staticClass:"resumen-value"},[a._v(a._s(a.totalTarasLimpioVeronica))])]),t("div",{staticClass:"resumen-card"},[t("span",{staticClass:"resumen-label"},[a._v("Taras Crudo:")]),t("span",{staticClass:"resumen-value"},[a._v(a._s(a.totalTarasCrudoVeronica))])]),t("div",{staticClass:"resumen-card"},[t("span",{staticClass:"resumen-label"},[a._v("Total:")]),t("span",{staticClass:"resumen-value"},[a._v(a._s(a.totalTarasLimpioVeronica+a.totalTarasCrudoVeronica))])])])]),t("div",{staticClass:"resumen-totales"},[t("h4",[a._v("Totales Generales")]),t("div",{staticClass:"resumen-grid"},[t("div",{staticClass:"resumen-card"},[t("span",{staticClass:"resumen-label"},[a._v("Deuda Total:")]),t("span",{staticClass:"resumen-value"},[a._v(a._s(a.formatearMonto(a.deudaTotal)))])]),t("div",{staticClass:"resumen-card"},[t("span",{staticClass:"resumen-label"},[a._v("Monto Pagado:")]),t("span",{staticClass:"resumen-value"},[a._v(a._s(a.formatearMonto(a.montoPagado)))])]),t("div",{staticClass:"resumen-card saldo-pendiente"},[t("span",{staticClass:"resumen-label"},[a._v("Saldo Pendiente:")]),t("span",{staticClass:"resumen-value"},[a._v(a._s(a.formatearMonto(a.saldoPendiente)))])])])])])])])},s=[function(){var a=this,t=a._self._c;return t("thead",[t("tr",[t("th",[a._v("Fecha")]),t("th",[a._v("Tipo")]),t("th",{attrs:{colspan:"2"}},[a._v("Joselito")]),t("th",{attrs:{colspan:"2"}},[a._v("Lorena")]),t("th",[a._v("Total Taras")]),t("th",[a._v("Monto del Día")]),t("th",[a._v("Deuda Acumulada")]),t("th",[a._v("Estado")]),t("th",[a._v("Acciones")])]),t("tr",[t("th"),t("th"),t("th",[a._v("Limpio")]),t("th",[a._v("Crudo")]),t("th",[a._v("Limpio")]),t("th",[a._v("Crudo")]),t("th"),t("th"),t("th"),t("th"),t("th")])])}],n=(e("14d9"),e("13d5"),e("1494")),r=e("d67e"),i=e.n(r),l={name:"CuentaFletes",data(){return{fletes:[],abonos:[],choferSeleccionado:"Caminante",costoTaraLimpio:70,costoTaraCrudo:60,cargando:!1,imprimiendo:!1,nuevoAbono:{monto:null,fecha:(new Date).toISOString().split("T")[0],descripcion:""}}},computed:{fletesFiltrados(){return this.fletes.filter(a=>{var t;return null===(t=a.cargaCon)||void 0===t?void 0:t.toLowerCase().includes(this.choferSeleccionado.toLowerCase())})},abonosFiltrados(){return this.abonos.filter(a=>a.chofer.toLowerCase()===this.choferSeleccionado.toLowerCase())},itemsOrdenados(){const a=[...this.fletesFiltrados.map(a=>({...a,tipo:"flete"})),...this.abonosFiltrados.map(a=>({...a,tipo:"abono"}))];return a.sort((a,t)=>t.fecha-a.fecha)},totalTarasLimpioJoselito(){return this.fletesFiltrados.reduce((a,t)=>a+t.tarasLimpioJoselito,0)},totalTarasCrudoJoselito(){return this.fletesFiltrados.reduce((a,t)=>a+t.tarasCrudoJoselito,0)},totalTarasLimpioVeronica(){return this.fletesFiltrados.reduce((a,t)=>a+(t.tarasLimpioVeronica||0),0)},totalTarasCrudoVeronica(){return this.fletesFiltrados.reduce((a,t)=>a+(t.tarasCrudoVeronica||0),0)},deudaTotal(){return this.fletesFiltrados.reduce((a,t)=>a+this.calcularMontoDia(t),0)},montoPagado(){return this.fletesFiltrados.reduce((a,t)=>a+(t.pagado?this.calcularMontoDia(t):0),0)},saldoPendiente(){return this.deudaTotal-this.montoPagado},fletesPendientes(){return this.fletesFiltrados.filter(a=>!a.pagado)}},methods:{async cargarFletes(){this.cargando=!0;try{const a=Object(n["h"])(),t=Object(n["c"])(a,"embarques"),e=await Object(n["g"])(t),o=e.docs.map(a=>{var t,e;const o=a.data();if(!0===o.noEnviadoMexico)return console.log(`[FLETE FILTRADO] Embarque ${a.id} marcado como NO enviado a México - Se excluye de la cuenta`),null;let s=o.fecha.toDate?o.fecha.toDate():new Date(o.fecha);const n=a=>(a||"").toString().normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim(),r=null===(t=o.clientes)||void 0===t?void 0:t.find(a=>{var t;const e=null===(t=a.id)||void 0===t?void 0:t.toString(),o=n(a.nombre||"");return"1"===e||"joselito"===o}),i=null===(e=o.clientes)||void 0===e?void 0:e.find(a=>{var t;const e=null===(t=a.id)||void 0===t?void 0:t.toString(),o=n(a.nombre||""),s=n(a.nombreNotas||"");return"5"===e||"veronica"===o||"lorena"===o||"lorena"===s});let l=0,c=0,d=0,u=0;r&&(console.log("Cliente Joselito encontrado:",{id:r.id,nombre:r.nombre}),r.productos&&Array.isArray(r.productos)&&(l=r.productos.reduce((a,t)=>{let e=0;return Array.isArray(t.taras)&&(e+=t.taras.reduce((a,t)=>a+(parseInt(t)||0),0)),Array.isArray(t.tarasExtra)&&(e+=t.tarasExtra.reduce((a,t)=>a+(parseInt(t)||0),0)),a+e},0)),r.crudos&&Array.isArray(r.crudos)&&(c=r.crudos.reduce((a,t)=>Array.isArray(t.items)?a+t.items.reduce((a,t)=>{let e=0;if(t.taras){const[a]=t.taras.split("-");e+=parseInt(a)||0}if(t.sobrante){const[a]=t.sobrante.split("-");e+=parseInt(a)||0}return a+e},0):a,0)),console.log("Taras calculadas para Joselito:",{limpio:l,crudo:c,total:l+c})),i&&(console.log("Cliente Verónica encontrado:",{id:i.id,nombre:i.nombre,nombreNotas:i.nombreNotas}),i.productos&&Array.isArray(i.productos)&&(d=i.productos.reduce((a,t)=>{let e=0;return Array.isArray(t.taras)&&(e+=t.taras.reduce((a,t)=>a+(parseInt(t)||0),0)),Array.isArray(t.tarasExtra)&&(e+=t.tarasExtra.reduce((a,t)=>a+(parseInt(t)||0),0)),a+e},0)),i.crudos&&Array.isArray(i.crudos)&&(u=i.crudos.reduce((a,t)=>Array.isArray(t.items)?a+t.items.reduce((a,t)=>{let e=0;if(t.taras){const[a]=t.taras.split("-");e+=parseInt(a)||0}if(t.sobrante){const[a]=t.sobrante.split("-");e+=parseInt(a)||0}return a+e},0):a,0)),console.log("Taras calculadas para Verónica:",{limpio:d,crudo:u,total:d+u}));const p=["1","5"],m=(o.clientes||[]).filter(a=>{var t;const e=null===(t=a.id)||void 0===t?void 0:t.toString();return!p.includes(e)});return m.length>0&&console.warn("Embarque con clientes adicionales detectado. Solo se procesarán Joselito y Verónica:",{embarqueId:a.id,clientesNoPermitidos:m.map(a=>({id:a.id,nombre:a.nombre})),clientesPermitidos:(o.clientes||[]).filter(a=>{var t;return p.includes(null===(t=a.id)||void 0===t?void 0:t.toString())})}),console.log("Resumen de taras procesadas:",{embarqueId:a.id,fecha:s.toLocaleDateString(),joselito:{limpio:l,crudo:c,total:l+c},veronica:{limpio:d,crudo:u,total:d+u},totalGeneral:l+c+(d+u)}),r||i?{id:a.id,fecha:s,tarasLimpioJoselito:l,tarasCrudoJoselito:c,tarasLimpioVeronica:d,tarasCrudoVeronica:u,cargaCon:o.cargaCon||"No especificado",pagado:o.fletePagado||!1}:null}).filter(a=>null!==a).sort((a,t)=>t.fecha-a.fecha);this.fletes=o;const s=Object(n["c"])(a,"abonos"),r=await Object(n["g"])(s);this.abonos=r.docs.map(a=>({id:a.id,...a.data(),fecha:a.data().fecha.toDate()}))}catch(a){console.error("Error al cargar los datos:",a)}finally{this.cargando=!1}},formatearFecha(a){const t=new Date(a);return t.setDate(t.getDate()+1),t.toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"})},formatearMonto(a){return new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(a)},calcularMontoDia(a){const t=a.tarasLimpioJoselito||0,e=a.tarasCrudoJoselito||0,o=a.tarasLimpioVeronica||0,s=a.tarasCrudoVeronica||0;return t*this.costoTaraLimpio+e*this.costoTaraCrudo+o*this.costoTaraLimpio+s*this.costoTaraCrudo},calcularDeudaAcumulada(a){const t=[...this.itemsOrdenados].sort((a,t)=>a.fecha-t.fecha),e=this.itemsOrdenados[a];return t.filter(a=>a.fecha<=e.fecha).reduce((a,t)=>{if("abono"===t.tipo)return a-t.monto;{const e=this.calcularMontoDia(t);return a+(t.pagado?0:e)}},0)},async togglePago(a){try{const t=Object(n["h"])(),e=Object(n["e"])(t,"embarques",a.id);await Object(n["s"])(e,{fletePagado:!a.pagado});const o=this.fletes.find(t=>t.id===a.id);o&&(o.pagado=!o.pagado)}catch(t){console.error("Error al actualizar el estado de pago:",t),alert("Error al actualizar el estado de pago. Por favor, intente de nuevo.")}},async agregarAbono(){if(this.nuevoAbono.monto&&this.nuevoAbono.fecha)try{const a=Object(n["h"])(),t=Object(n["c"])(a,"abonos"),e={monto:Number(this.nuevoAbono.monto),fecha:new Date(this.nuevoAbono.fecha),chofer:this.choferSeleccionado,descripcion:this.nuevoAbono.descripcion||"Abono realizado",createdAt:new Date},o=await Object(n["b"])(t,e);this.abonos.push({id:o.id,...e}),this.nuevoAbono={monto:null,fecha:(new Date).toISOString().split("T")[0],descripcion:""},alert("Abono registrado correctamente")}catch(a){console.error("Error al agregar el abono:",a),alert("Error al registrar el abono")}else alert("Por favor complete todos los campos del abono")},async eliminarAbono(a){if(confirm("¿Está seguro de eliminar este abono?"))try{const t=Object(n["h"])();await Object(n["d"])(Object(n["e"])(t,"abonos",a.id)),this.abonos=this.abonos.filter(t=>t.id!==a.id),alert("Abono eliminado correctamente")}catch(t){console.error("Error al eliminar el abono:",t),alert("Error al eliminar el abono")}},async generarPDF(){this.imprimiendo=!0;const a=document.createElement("div");a.innerHTML=`\n        <div class="pdf-container">\n          <h2>Cuenta de Fletes - ${this.choferSeleccionado}</h2>\n          <p class="fecha-impresion">Fecha de impresión: ${(new Date).toLocaleDateString("es-ES")}</p>\n          \n          \x3c!-- Tabla de Fletes Pendientes --\x3e\n          <h3>Fletes Pendientes</h3>\n          <table class="tabla-pdf">\n            <thead>\n              <tr>\n                <th>Fecha</th>\n                <th colspan="2">Joselito</th>\n                <th colspan="2">Lorena</th>\n                <th>Total Taras</th>\n                <th>Monto</th>\n              </tr>\n              <tr>\n                <th></th>\n                <th>Limpio</th>\n                <th>Crudo</th>\n                <th>Limpio</th>\n                <th>Crudo</th>\n                <th></th>\n                <th></th>\n              </tr>\n            </thead>\n            <tbody>\n              ${this.fletesPendientes.map(a=>`\n                <tr>\n                  <td>${this.formatearFecha(a.fecha)}</td>\n                  <td>${a.tarasLimpioJoselito}</td>\n                  <td>${a.tarasCrudoJoselito}</td>\n                  <td>${a.tarasLimpioVeronica||0}</td>\n                  <td>${a.tarasCrudoVeronica||0}</td>\n                  <td>${a.tarasLimpioJoselito+a.tarasCrudoJoselito+((a.tarasLimpioVeronica||0)+(a.tarasCrudoVeronica||0))}</td>\n                  <td>${this.formatearMonto(this.calcularMontoDia(a))}</td>\n                </tr>\n              `).join("")}\n              <tr class="fila-total">\n                <td><strong>TOTAL</strong></td>\n                <td><strong>${this.fletesPendientes.reduce((a,t)=>a+t.tarasLimpioJoselito,0)}</strong></td>\n                <td><strong>${this.fletesPendientes.reduce((a,t)=>a+t.tarasCrudoJoselito,0)}</strong></td>\n                <td><strong>${this.fletesPendientes.reduce((a,t)=>a+(t.tarasLimpioVeronica||0),0)}</strong></td>\n                <td><strong>${this.fletesPendientes.reduce((a,t)=>a+(t.tarasCrudoVeronica||0),0)}</strong></td>\n                <td><strong>${this.fletesPendientes.reduce((a,t)=>a+(t.tarasLimpioJoselito+t.tarasCrudoJoselito)+((t.tarasLimpioVeronica||0)+(t.tarasCrudoVeronica||0)),0)}</strong></td>\n                <td><strong>${this.formatearMonto(this.fletesPendientes.reduce((a,t)=>a+this.calcularMontoDia(t),0))}</strong></td>\n              </tr>\n            </tbody>\n          </table>\n\n          ${this.abonosFiltrados.length>0?`\n            \x3c!-- Tabla de Abonos --\x3e\n            <h3>Abonos Realizados</h3>\n            <table class="tabla-pdf">\n              <thead>\n                <tr>\n                  <th>Fecha</th>\n                  <th colspan="5">Descripción</th>\n                  <th>Monto</th>\n                </tr>\n              </thead>\n              <tbody>\n                ${this.abonosFiltrados.map(a=>`\n                  <tr class="fila-abono">\n                    <td>${this.formatearFecha(a.fecha)}</td>\n                    <td colspan="5">${a.descripcion||"Abono realizado"}</td>\n                    <td>${this.formatearMonto(a.monto)}</td>\n                  </tr>\n                `).join("")}\n                <tr class="fila-total">\n                  <td colspan="6"><strong>TOTAL ABONOS</strong></td>\n                  <td><strong>${this.formatearMonto(this.abonosFiltrados.reduce((a,t)=>a+t.monto,0))}</strong></td>\n                </tr>\n              </tbody>\n            </table>\n          `:""}\n\n          <div class="resumen-pdf">\n            <h3>Resumen de Cuenta</h3>\n            <div class="resumen-grid">\n              <div class="resumen-clientes">\n                <div class="cliente-column">\n                  <h4>Cliente Joselito</h4>\n                  <p><strong>Taras Limpio:</strong> ${this.fletesPendientes.reduce((a,t)=>a+t.tarasLimpioJoselito,0)}</p>\n                  <p><strong>Taras Crudo:</strong> ${this.fletesPendientes.reduce((a,t)=>a+t.tarasCrudoJoselito,0)}</p>\n                  <p><strong>Total Taras Joselito:</strong> ${this.fletesPendientes.reduce((a,t)=>a+t.tarasLimpioJoselito+t.tarasCrudoJoselito,0)}</p>\n                </div>\n                <div class="cliente-column">\n                  <h4>Cliente Lorena</h4>\n                  <p><strong>Taras Limpio:</strong> ${this.fletesPendientes.reduce((a,t)=>a+(t.tarasLimpioVeronica||0),0)}</p>\n                  <p><strong>Taras Crudo:</strong> ${this.fletesPendientes.reduce((a,t)=>a+(t.tarasCrudoVeronica||0),0)}</p>\n                  <p><strong>Total Taras Lorena:</strong> ${this.fletesPendientes.reduce((a,t)=>a+((t.tarasLimpioVeronica||0)+(t.tarasCrudoVeronica||0)),0)}</p>\n                </div>\n              </div>\n              \n              <h4>Totales Generales</h4>\n              <p><strong>Total Taras Limpio:</strong> ${this.fletesPendientes.reduce((a,t)=>a+t.tarasLimpioJoselito+(t.tarasLimpioVeronica||0),0)}</p>\n              <p><strong>Total Taras Crudo:</strong> ${this.fletesPendientes.reduce((a,t)=>a+t.tarasCrudoJoselito+(t.tarasCrudoVeronica||0),0)}</p>\n              <p><strong>Monto Total Fletes:</strong> ${this.formatearMonto(this.fletesPendientes.reduce((a,t)=>a+this.calcularMontoDia(t),0))}</p>\n              ${this.abonosFiltrados.length>0?`\n                <p><strong>Total Abonado:</strong> ${this.formatearMonto(this.abonosFiltrados.reduce((a,t)=>a+t.monto,0))}</p>\n              `:""}\n              <p class="total-final"><strong>Saldo Pendiente:</strong> ${this.formatearMonto(this.fletesPendientes.reduce((a,t)=>a+this.calcularMontoDia(t),0)-this.abonosFiltrados.reduce((a,t)=>a+t.monto,0))}</p>\n            </div>\n          </div>\n        </div>\n      `;const t=document.createElement("style");t.textContent="\n        .pdf-container {\n          padding: 20px;\n          font-family: Arial, sans-serif;\n        }\n        .fecha-impresion {\n          color: #666;\n          margin-bottom: 20px;\n        }\n        h3 {\n          color: #333;\n          margin: 20px 0 10px 0;\n        }\n        h4 {\n          color: #333;\n          margin: 15px 0 5px 0;\n          border-bottom: 1px solid #ddd;\n          padding-bottom: 5px;\n        }\n        .tabla-pdf {\n          width: 100%;\n          border-collapse: collapse;\n          margin-bottom: 20px;\n        }\n        .tabla-pdf th, .tabla-pdf td {\n          border: 1px solid #ddd;\n          padding: 8px;\n          text-align: left;\n        }\n        .tabla-pdf th {\n          background-color: #f8f9fa;\n        }\n        .fila-total {\n          background-color: #f8f9fa;\n          border-top: 2px solid #ddd;\n        }\n        .fila-total td {\n          font-size: 1.1em;\n        }\n        .fila-abono {\n          background-color: #e8f5e9;\n        }\n        .resumen-pdf {\n          margin-top: 30px;\n          padding: 15px;\n          background-color: #f8f9fa;\n          border-radius: 5px;\n        }\n        .resumen-grid {\n          display: grid;\n          gap: 10px;\n        }\n        .total-final {\n          margin-top: 10px;\n          padding-top: 10px;\n          border-top: 2px solid #ddd;\n        }\n        .footer-pdf {\n          margin-top: 30px;\n          padding-top: 15px;\n          border-top: 1px solid #ddd;\n        }\n        .resumen-clientes {\n          display: flex;\n          justify-content: space-between;\n          margin-bottom: 20px;\n          gap: 15px;\n        }\n        .cliente-column {\n          flex: 1;\n          padding: 10px;\n          background-color: #f9f9f9;\n          border-radius: 5px;\n          border: 1px solid #eee;\n        }\n        .cliente-column h4 {\n          text-align: center;\n          margin-top: 0;\n          border-bottom: 1px solid #ddd;\n          padding-bottom: 5px;\n        }\n      ",a.appendChild(t);const e={margin:10,filename:`cuenta_fletes_${this.choferSeleccionado.toLowerCase()}_${(new Date).toISOString().split("T")[0]}.pdf`,image:{type:"jpeg",quality:.98},html2canvas:{scale:2},jsPDF:{unit:"mm",format:"a4",orientation:"portrait"}};try{await i()().from(a).set(e).save()}catch(o){console.error("Error al generar el PDF:",o),alert("Error al generar el PDF. Por favor, intente de nuevo.")}finally{this.imprimiendo=!1}},volverMenu(){this.$router.push({name:"EmbarquesMenu"})}},mounted(){this.cargarFletes()}},c=l,d=(e("cc59"),e("2877")),u=Object(d["a"])(c,o,s,!1,null,"772d8700",null);t["a"]=u.exports},cc59:function(a,t,e){"use strict";e("39a5")},ebad:function(a,t,e){"use strict";e("d9e2"),e("14d9"),e("13d5");var o=e("1494");class s{constructor(){this.db=Object(o["h"])()}async crearRespaldoEmergencia(a,t="eliminacion_automatica"){try{console.log("[BACKUP] Creando respaldo de emergencia para embarque "+a);const e=Object(o["e"])(this.db,"embarques",a),s=await Object(o["f"])(e);if(!s.exists())return console.warn(`[BACKUP] El embarque ${a} no existe, no se puede respaldar`),null;const n=s.data(),r={embarqueOriginalId:a,datosOriginales:n,fechaRespaldo:Object(o["q"])(),razonRespaldo:t,tipoRespaldo:"emergencia",version:"1.0",fechaEmbarqueOriginal:n.fecha,cargaConOriginal:n.cargaCon,cantidadClientes:n.clientes?n.clientes.length:0,totalProductos:this.contarProductosTotal(n),kilosLimpiosAprox:this.calcularKilosLimpiosAprox(n),kilosCrudosAprox:this.calcularKilosCrudosAprox(n)},i=await Object(o["b"])(Object(o["c"])(this.db,"respaldos_emergencia"),r);return console.log("[BACKUP] Respaldo creado exitosamente con ID: "+i.id),i.id}catch(e){throw console.error("[BACKUP] Error al crear respaldo de emergencia:",e),e}}async recuperarDesdeRespaldo(a){try{console.log("[BACKUP] Recuperando embarque desde respaldo "+a);const t=Object(o["e"])(this.db,"respaldos_emergencia",a),e=await Object(o["f"])(t);if(!e.exists())throw new Error(`El respaldo ${a} no existe`);const s=e.data(),n={...s.datosOriginales,recuperadoDesdeRespaldo:!0,respaldoOrigenId:a,fechaRecuperacion:Object(o["q"])()},r=await Object(o["b"])(Object(o["c"])(this.db,"embarques"),n);return console.log("[BACKUP] Embarque recuperado exitosamente con nuevo ID: "+r.id),r.id}catch(t){throw console.error("[BACKUP] Error al recuperar desde respaldo:",t),t}}async buscarRespaldosPorFecha(a){try{const t=new Date(a),e=t.toISOString().split("T")[0],s=Object(o["c"])(this.db,"respaldos_emergencia"),n=await Object(o["g"])(s),r=[];return n.docs.forEach(a=>{const t=a.data();let o;if(t.fechaEmbarqueOriginal&&"function"===typeof t.fechaEmbarqueOriginal.toDate)o=t.fechaEmbarqueOriginal.toDate();else if(t.fechaEmbarqueOriginal instanceof Date)o=t.fechaEmbarqueOriginal;else{if("string"!==typeof t.fechaEmbarqueOriginal)return;o=new Date(t.fechaEmbarqueOriginal)}const s=o.toISOString().split("T")[0];s===e&&r.push({id:a.id,...t})}),r}catch(t){throw console.error("[BACKUP] Error al buscar respaldos por fecha:",t),t}}contarProductosTotal(a){return a.clientes?a.clientes.reduce((a,t)=>a+(t.productos?t.productos.length:0),0):0}calcularKilosLimpiosAprox(a){if(!a.clientes)return 0;let t=0;return a.clientes.forEach(a=>{a.productos&&a.productos.forEach(a=>{if("c/h20"===a.tipo){const e=a.reporteTaras||[],o=a.reporteBolsas||[];let s=0;for(let a=0;a<e.length;a++){const t=parseInt(e[a])||0,n=parseInt(o[a])||0;s+=t*n}t+=.45*s}})}),t.toFixed(1)}calcularKilosCrudosAprox(a){if(!a.clientes)return 0;let t=0;return a.clientes.forEach(a=>{a.crudos&&Array.isArray(a.crudos)&&a.crudos.forEach(a=>{t+=parseFloat(a.kilos)||0})}),t.toFixed(1)}}t["a"]=new s}}]);