(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["app.e73b60ec"],{"0836":function(o,t,e){},"0b03":function(o,t,e){"use strict";e("1a1a")},"1a1a":function(o,t,e){},"260b":function(o,t,e){"use strict";e("9655")},"404e":function(o,t,e){},4918:function(o,t,e){},"4c15":function(o,t,e){"use strict";var a=function(){var o,t=this,e=t._self._c;return t.mostrar?e("div",{staticClass:"modal-overlay",on:{click:t.cerrarModal}},[e("div",{staticClass:"modal-content abono-general-modal",on:{click:function(o){o.stopPropagation()}}},[e("div",{staticClass:"modal-header"},[e("h2",[t._v("Abono General - "+t._s(null===(o=t.proveedor)||void 0===o?void 0:o.nombre))]),e("button",{staticClass:"close-button",on:{click:function(o){return t.$emit("cerrar")}}},[t._v("√ó")])]),e("div",{staticClass:"modal-body"},[t.proveedor?e("div",[e("div",{staticClass:"proveedor-info"},[e("div",{staticClass:"info-card"},[e("h3",[t._v("Resumen de Deudas")]),e("div",{staticClass:"resumen-items"},[e("div",{staticClass:"resumen-item"},[e("span",{staticClass:"label"},[t._v("Total deudas pendientes:")]),e("span",{staticClass:"valor"},[t._v(t._s(t.deudasPendientes.length))])]),e("div",{staticClass:"resumen-item"},[e("span",{staticClass:"label"},[t._v("Saldo total pendiente:")]),e("span",{staticClass:"valor saldo-total"},[t._v("$"+t._s(t.formatNumber(t.saldoTotalPendiente)))])])])])]),e("div",{staticClass:"form-abono"},[e("h3",[t._v("Realizar Abono General")]),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"fechaAbono"}},[t._v("Fecha del abono:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.nuevoAbono.fecha,expression:"nuevoAbono.fecha"}],attrs:{id:"fechaAbono",type:"date",required:""},domProps:{value:t.nuevoAbono.fecha},on:{input:function(o){o.target.composing||t.$set(t.nuevoAbono,"fecha",o.target.value)}}})]),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"descripcionAbono"}},[t._v("Descripci√≥n:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.nuevoAbono.descripcion,expression:"nuevoAbono.descripcion"}],attrs:{id:"descripcionAbono",type:"text",placeholder:"Ej: Pago general, Transferencia, etc.",required:""},domProps:{value:t.nuevoAbono.descripcion},on:{input:function(o){o.target.composing||t.$set(t.nuevoAbono,"descripcion",o.target.value)}}})]),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"montoAbono"}},[t._v("Monto total a abonar:")]),e("input",{directives:[{name:"model",rawName:"v-model.number",value:t.nuevoAbono.monto,expression:"nuevoAbono.monto",modifiers:{number:!0}}],attrs:{id:"montoAbono",type:"number",max:t.saldoTotalPendiente,min:"1",step:"0.01",placeholder:"0.00",required:""},domProps:{value:t.nuevoAbono.monto},on:{input:function(o){o.target.composing||t.$set(t.nuevoAbono,"monto",t._n(o.target.value))},blur:function(o){return t.$forceUpdate()}}})]),t.nuevoAbono.monto>0?e("div",{staticClass:"distribucion-preview"},[e("h4",[t._v("Distribuci√≥n del abono:")]),e("div",{staticClass:"deudas-list"},t._l(t.distribucionCalculada,(function(o,a){return e("div",{key:o.deudaId,staticClass:"deuda-distribucion"},[e("div",{staticClass:"deuda-info"},[e("span",{staticClass:"fecha"},[t._v(t._s(t.formatearFecha(o.fecha)))]),e("span",{staticClass:"saldo-actual"},[t._v("$"+t._s(t.formatNumber(o.saldoActual)))])]),e("div",{staticClass:"abono-aplicado"},[e("span",{staticClass:"monto-abono"},[t._v("$"+t._s(t.formatNumber(o.montoAbono)))]),e("span",{staticClass:"saldo-restante"},[t._v("(Restante: $"+t._s(t.formatNumber(o.saldoRestante))+")")])])])})),0),e("div",{staticClass:"resumen-distribucion"},[e("div",{staticClass:"total-distribuido"},[e("span",[t._v("Total distribuido: $"+t._s(t.formatNumber(t.totalDistribuido)))])]),t.montoSobrante>0?e("div",{staticClass:"monto-sobrante"},[e("span",[t._v("‚ö†Ô∏è Sobrante (se aplicar√° a la primera deuda): $"+t._s(t.formatNumber(t.montoSobrante)))])]):t._e()])]):t._e()]),e("div",{staticClass:"modal-actions"},[e("button",{staticClass:"btn-cancelar",on:{click:function(o){return t.$emit("cerrar")}}},[t._v(" Cancelar ")]),e("button",{staticClass:"btn-aplicar",attrs:{disabled:!t.puedeAplicar||t.guardando},on:{click:t.aplicarAbonoGeneral}},[t._v(" "+t._s(t.guardando?"Aplicando...":"Aplicar Abono General")+" ")])])]):e("div",{staticClass:"error-no-proveedor"},[e("div",{staticClass:"error-icon"},[t._v("‚ö†Ô∏è")]),e("h3",[t._v("No hay proveedor seleccionado")]),e("p",[t._v("Para realizar un abono general, primero debe seleccionar un proveedor en el filtro.")])])])])]):t._e()},r=[],s=(e("14d9"),e("13d5"),e("dc59")),i=e("1494"),n={name:"AbonoGeneralModal",props:{mostrar:{type:Boolean,required:!0},proveedor:{type:Object,required:!1,default:null}},emits:["cerrar","abono-aplicado"],data(){return{deudasPendientes:[],guardando:!1,nuevoAbono:{fecha:this.obtenerFechaActual(),descripcion:"",monto:null}}},computed:{saldoTotalPendiente(){return this.deudasPendientes.reduce((o,t)=>o+t.saldoPendiente,0)},puedeAplicar(){return this.nuevoAbono.fecha&&this.nuevoAbono.descripcion&&this.nuevoAbono.monto>0&&this.nuevoAbono.monto<=this.saldoTotalPendiente&&this.deudasPendientes.length>0},distribucionCalculada(){if(!this.nuevoAbono.monto||0===this.deudasPendientes.length)return[];let o=this.nuevoAbono.monto;const t=[],e=[...this.deudasPendientes].sort((o,t)=>new Date(o.fecha)-new Date(t.fecha));for(const a of e){if(o<=0)break;const e=Math.min(o,a.saldoPendiente),r=a.saldoPendiente-e;t.push({deudaId:a.id,fecha:a.fecha,saldoActual:a.saldoPendiente,montoAbono:e,saldoRestante:r}),o-=e}return t},totalDistribuido(){return this.distribucionCalculada.reduce((o,t)=>o+t.montoAbono,0)},montoSobrante(){return this.nuevoAbono.monto-this.totalDistribuido}},methods:{obtenerFechaActual(){const o=new Date,t=o.getFullYear(),e=String(o.getMonth()+1).padStart(2,"0"),a=String(o.getDate()).padStart(2,"0");return`${t}-${e}-${a}`},cerrarModal(o){o.target===o.currentTarget&&this.$emit("cerrar")},async cargarDeudasPendientes(){var o;if(null===(o=this.proveedor)||void 0===o||!o.id)return console.warn("No se puede cargar deudas: proveedor no seleccionado"),void(this.deudasPendientes=[]);try{const o=Object(i["o"])(Object(i["c"])(s["a"],"deudas"),Object(i["s"])("proveedorId","==",this.proveedor.id),Object(i["s"])("estado","==","pendiente")),t=await Object(i["g"])(o);let e=t.docs.map(o=>({id:o.id,...o.data()}));e.sort((o,t)=>{const e=new Date(o.fecha),a=new Date(t.fecha);return e-a}),this.deudasPendientes=e}catch(t){console.error("Error al cargar deudas pendientes:",t),this.deudasPendientes=[],"failed-precondition"===t.code?alert("Error de base de datos: Se requiere configurar un √≠ndice. Contacte al administrador."):alert("Error al cargar las deudas pendientes. Por favor, intente de nuevo.")}},async aplicarAbonoGeneral(){if(this.puedeAplicar)try{this.guardando=!0;for(const o of this.distribucionCalculada)if(o.montoAbono>0){await Object(i["b"])(Object(i["c"])(s["a"],"deudas",o.deudaId,"abonos"),{descripcion:this.nuevoAbono.descripcion+" (Abono General)",monto:o.montoAbono,fecha:this.nuevoAbono.fecha,fechaCreacion:new Date,esAbonoGeneral:!0});const t=o.saldoRestante,e=t<=0?"pagado":"pendiente";await Object(i["r"])(Object(i["e"])(s["a"],"deudas",o.deudaId),{saldoPendiente:t,estado:e})}if(this.montoSobrante>0&&this.distribucionCalculada.length>0){const o=this.distribucionCalculada[0];await Object(i["b"])(Object(i["c"])(s["a"],"deudas",o.deudaId,"abonos"),{descripcion:this.nuevoAbono.descripcion+" (Abono General - Sobrante)",monto:this.montoSobrante,fecha:this.nuevoAbono.fecha,fechaCreacion:new Date,esAbonoGeneral:!0});const t=o.saldoRestante-this.montoSobrante;await Object(i["r"])(Object(i["e"])(s["a"],"deudas",o.deudaId),{saldoPendiente:Math.max(0,t),estado:t<=0?"pagado":"pendiente"})}alert(`Abono general de $${this.formatNumber(this.nuevoAbono.monto)} aplicado correctamente`),this.$emit("abono-aplicado"),this.$emit("cerrar")}catch(o){console.error("Error al aplicar abono general:",o),alert("Error al aplicar el abono general: "+o.message)}finally{this.guardando=!1}},formatNumber(o){return o?o.toLocaleString("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00"},formatearFecha(o){if(!o)return"";const t=new Date(o+"T00:00:00"),e={day:"numeric",month:"short",year:"numeric"};return t.toLocaleDateString("es-ES",e)}},watch:{mostrar(o){o&&this.proveedor&&(this.cargarDeudasPendientes(),this.nuevoAbono={fecha:this.obtenerFechaActual(),descripcion:"",monto:null})}}},c=n,l=(e("c97b"),e("2877")),d=Object(l["a"])(c,a,r,!1,null,"2d20fc84",null);t["a"]=d.exports},"4e00":function(o,t,e){"use strict";var a=function(){var o=this,t=o._self._c;return t("div",{staticClass:"container"},[t("div",{staticClass:"add-client"},[t("div",{staticClass:"back-button-container"},[t("BackButton",{attrs:{to:"/NoteMenu"}})],1),o._m(0),t("form",{on:{submit:function(t){return t.preventDefault(),o.addClient.apply(null,arguments)}}},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"name"}},[o._v("Nombre:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:o.name,expression:"name"}],attrs:{type:"text",required:""},domProps:{value:o.name},on:{input:function(t){t.target.composing||(o.name=t.target.value)}}})]),t("button",{attrs:{type:"submit"}},[o._v("Agregar Cliente")])]),o._m(1),t("ul",o._l(o.clients,(function(e){return t("li",{key:e.id},[o._v(" "+o._s(e.name)+" "),t("button",{on:{click:function(t){return o.deleteClient(e.id)}}},[o._v("Eliminar")])])})),0)])])},r=[function(){var o=this,t=o._self._c;return t("div",{staticClass:"add-client-form"},[t("h2",[o._v("Agregar Cliente")])])},function(){var o=this,t=o._self._c;return t("div",{staticClass:"add-client-form"},[t("h2",[o._v("Lista de Clientes")])])}],s=(e("d9e2"),e("74c9")),i=e("dc59"),n=e("1494"),c={components:{BackButton:s["a"]},data(){return{name:"",clients:[]}},methods:{async addClient(){try{if(console.log("DB instance:",i["a"]),!i["a"])throw new Error("Firestore DB is not initialized");await Object(n["b"])(Object(n["c"])(i["a"],"clients"),{name:this.name}),this.name="",this.fetchClients()}catch(o){console.error("Error adding client: ",o)}},async fetchClients(){try{const o=await Object(n["g"])(Object(n["c"])(i["a"],"clients"));this.clients=o.docs.map(o=>({id:o.id,...o.data()}))}catch(o){console.error("Error fetching clients: ",o)}},deleteClient(o){window.confirm("¬øEst√°s seguro de que deseas eliminar este cliente?")&&Object(n["d"])(Object(n["e"])(i["a"],"clients",o)).then(()=>{console.log("Cliente eliminado con √©xito")}).catch(o=>{console.error("Error al eliminar el cliente: ",o)})}},async mounted(){this.fetchClients()}},l=c,d=(e("f90b"),e("2877")),u=Object(d["a"])(l,a,r,!1,null,"024a7518",null);t["a"]=u.exports},5355:function(o,t,e){},"687e":function(o,t,e){"use strict";var a=function(){var o=this,t=o._self._c;return t("div",{staticClass:"producto-selector"},[t("div",{staticClass:"input-row"},[t("input",{directives:[{name:"model",rawName:"v-model.number",value:o.kilos,expression:"kilos",modifiers:{number:!0}}],staticClass:"input-kilos",attrs:{type:"number",step:"0.01",placeholder:"Kilos"},domProps:{value:o.kilos},on:{input:[function(t){t.target.composing||(o.kilos=o._n(t.target.value))},function(t){return o.$emit("update:kilos",o.kilos)}],blur:function(t){return o.$forceUpdate()}}}),t("div",{staticClass:"producto-input-container"},[t("select",{directives:[{name:"model",rawName:"v-model",value:o.productoSeleccionado,expression:"productoSeleccionado"}],staticClass:"producto-select",on:{change:[function(t){var e=Array.prototype.filter.call(t.target.options,(function(o){return o.selected})).map((function(o){var t="_value"in o?o._value:o.value;return t}));o.productoSeleccionado=t.target.multiple?e:e[0]},o.onProductoChange]}},[t("option",{attrs:{value:""}},[o._v("Seleccionar producto existente")]),o._l(o.productosDisponibles,(function(e){return t("option",{key:e.nombre,domProps:{value:e.nombre}},[o._v(" "+o._s(e.nombre)+" - $"+o._s(o.formatearPrecio(e.precioActual))+" ")])})),t("option",{attrs:{value:"__nuevo__"}},[o._v("+ Nuevo producto")])],2),"__nuevo__"===o.productoSeleccionado?t("input",{directives:[{name:"model",rawName:"v-model",value:o.productoManual,expression:"productoManual"}],ref:"inputProductoNuevo",staticClass:"input-producto-manual producto-nuevo",attrs:{type:"text",placeholder:"Nombre del nuevo producto"},domProps:{value:o.productoManual},on:{input:[function(t){t.target.composing||(o.productoManual=t.target.value)},o.onProductoManualChange]}}):o._e()]),t("input",{directives:[{name:"model",rawName:"v-model.number",value:o.precio,expression:"precio",modifiers:{number:!0}}],staticClass:"input-precio",attrs:{type:"number",step:"0.01",placeholder:"Precio"},domProps:{value:o.precio},on:{input:[function(t){t.target.composing||(o.precio=o._n(t.target.value))},function(t){return o.$emit("update:precio",o.precio)}],blur:function(t){return o.$forceUpdate()}}}),t("span",{staticClass:"total-calculado"},[o._v(" Total: $"+o._s(o.calcularTotal())+" ")]),t("button",{staticClass:"add-btn",attrs:{disabled:!o.puedeAgregar},on:{click:o.agregarProducto}},[o._v(" "+o._s(o.cargandoProductos?"Cargando...":"Agregar")+" ")])]),o.productoSeleccionado&&"__nuevo__"!==o.productoSeleccionado?t("div",{staticClass:"precio-info"},[t("div",{staticClass:"precio-historico"},[t("span",{staticClass:"label"},[o._v("√öltimo precio:")]),t("span",{staticClass:"precio-valor"},[o._v("$"+o._s(o.formatearPrecio(o.precioUltimoRegistrado)))]),t("span",{staticClass:"fecha-precio"},[o._v("("+o._s(o.formatearFecha(o.fechaUltimoPrecio))+")")]),o.precio!==o.precioUltimoRegistrado?t("button",{staticClass:"btn-usar-precio",on:{click:o.usarPrecioHistorico}},[o._v(" Usar este precio ")]):o._e()]),t("div",{staticClass:"stats-producto"},[t("span",{staticClass:"total-registros"},[o._v(o._s(o.totalRegistros)+" precio(s) registrado(s)")]),t("span",{staticClass:"precio-promedio"},[o._v("Promedio: $"+o._s(o.formatearPrecio(o.precioPromedio)))])])]):o._e()])},r=[],s=(e("14d9"),e("13d5"),e("dc59")),i=e("1494"),n={name:"ProductoSelector",props:{proveedorId:{type:String,required:!0},kilosValue:{type:Number,default:null},productoValue:{type:String,default:""},precioValue:{type:Number,default:null}},emits:["update:kilos","update:producto","update:precio","agregar-producto"],data(){return{productosDisponibles:[],cargandoProductos:!1,productoSeleccionado:"",productoManual:"",kilos:this.kilosValue,precio:this.precioValue,productoHistorial:null}},computed:{puedeAgregar(){return this.kilos&&this.obtenerNombreProducto()&&this.precio&&!this.cargandoProductos},precioUltimoRegistrado(){var o;return(null===(o=this.productoHistorial)||void 0===o?void 0:o.precioActual)||0},fechaUltimoPrecio(){var o;return(null===(o=this.productoHistorial)||void 0===o?void 0:o.fechaUltimoPrecio)||""},totalRegistros(){var o;return(null===(o=this.productoHistorial)||void 0===o?void 0:o.totalRegistros)||0},precioPromedio(){var o;if(null===(o=this.productoHistorial)||void 0===o||null===(o=o.precios)||void 0===o||!o.length)return 0;const t=this.productoHistorial.precios.reduce((o,t)=>o+t.precio,0);return t/this.productoHistorial.precios.length}},methods:{async cargarProductosProveedor(){if(this.proveedorId)try{this.cargandoProductos=!0,console.log("Cargando productos para proveedor:",this.proveedorId);const o=await Object(i["g"])(Object(i["o"])(Object(i["c"])(s["a"],"historialPrecios"),Object(i["s"])("proveedorId","==",this.proveedorId))),t=o.docs.map(o=>o.data());console.log("Precios encontrados:",t.length);const e=new Map;t.forEach(o=>{const t=o.producto;e.has(t)||e.set(t,{nombre:t,precios:[]}),e.get(t).precios.push(o)}),this.productosDisponibles=Array.from(e.values()).map(o=>{const t=o.precios.sort((o,t)=>new Date(t.fecha)-new Date(o.fecha)),e=t[0];return{nombre:o.nombre,precioActual:e.precio,fechaUltimoPrecio:e.fecha,totalRegistros:o.precios.length,precios:t}}),this.productosDisponibles.sort((o,t)=>o.nombre.localeCompare(t.nombre)),console.log("Productos procesados:",this.productosDisponibles.length)}catch(o){console.error("Error al cargar productos: ",o)}finally{this.cargandoProductos=!1}else this.productosDisponibles=[]},onProductoChange(){this.productoSeleccionado&&"__nuevo__"!==this.productoSeleccionado?(this.productoHistorial=this.productosDisponibles.find(o=>o.nombre===this.productoSeleccionado),this.productoHistorial&&(this.precio=this.productoHistorial.precioActual,this.$emit("update:precio",this.precio)),this.productoManual=""):"__nuevo__"===this.productoSeleccionado?(this.productoHistorial=null,this.precio=null,this.$emit("update:precio",null),this.$nextTick(()=>{this.$refs.inputProductoNuevo&&this.$refs.inputProductoNuevo.focus()})):(this.productoHistorial=null,this.productoManual=""),this.$emit("update:producto",this.obtenerNombreProducto())},onProductoManualChange(){this.$emit("update:producto",this.productoManual)},obtenerNombreProducto(){return this.productoSeleccionado&&"__nuevo__"!==this.productoSeleccionado?this.productoSeleccionado:this.productoManual},usarPrecioHistorico(){this.precio=this.precioUltimoRegistrado,this.$emit("update:precio",this.precio)},calcularTotal(){return this.kilos&&this.precio?this.formatearPrecio(this.kilos*this.precio):"0.00"},agregarProducto(){if(!this.puedeAgregar)return;const o={kilos:this.kilos,producto:this.obtenerNombreProducto(),precio:this.precio,total:this.kilos*this.precio};this.$emit("agregar-producto",o),this.limpiarFormulario()},limpiarFormulario(){this.kilos=null,this.productoSeleccionado="",this.productoManual="",this.precio=null,this.productoHistorial=null,this.$emit("update:kilos",null),this.$emit("update:producto",""),this.$emit("update:precio",null)},formatearPrecio(o){return o?o.toLocaleString("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00"},formatearFecha(o){if(!o)return"";const t=new Date(o+"T00:00:00"),e={day:"numeric",month:"short",year:"numeric"};return t.toLocaleDateString("es-ES",e)}},watch:{proveedorId(o){o?this.cargarProductosProveedor():(this.productosDisponibles=[],this.limpiarFormulario())},kilosValue(o){this.kilos=o},productoValue(o){o!==this.obtenerNombreProducto()&&(this.productoManual=o,this.productoSeleccionado="")},precioValue(o){this.precio=o}},mounted(){this.proveedorId&&this.cargarProductosProveedor()}},c=n,l=(e("0b03"),e("2877")),d=Object(l["a"])(c,a,r,!1,null,"4870ae52",null);t["a"]=d.exports},6934:function(o,t,e){"use strict";e("404e")},6959:function(o,t,e){"use strict";e("712a")},"712a":function(o,t,e){},"74c9":function(o,t,e){"use strict";var a=function(){var o=this,t=o._self._c;return t("router-link",{staticClass:"btn-back",attrs:{to:o.to}},[o._v("Atr√°s")])},r=[],s={props:{to:{type:String,required:!0}}},i=s,n=(e("e0fe"),e("2877")),c=Object(n["a"])(i,a,r,!1,null,null,null);t["a"]=c.exports},"7b75":function(o,t,e){"use strict";var a=function(){var o=this,t=o._self._c;return t("BaseModal",{attrs:{mostrar:o.mostrar,titulo:o.titulo,textoBotonConfirmar:o.textoBoton},on:{cerrar:function(t){return o.$emit("cerrar")},confirmar:o.guardarCosto}},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"costoInput"}},[o._v(o._s(o.etiquetaCosto)+":")]),t("input",{directives:[{name:"model",rawName:"v-model",value:o.costoLocal,expression:"costoLocal"}],ref:"costoInput",staticClass:"form-control",attrs:{type:"number",id:"costoInput",placeholder:o.placeholder,step:"0.01",min:"0"},domProps:{value:o.costoLocal},on:{keyup:function(t){return!t.type.indexOf("key")&&o._k(t.keyCode,"enter",13,t.key,"Enter")?null:o.guardarCosto.apply(null,arguments)},input:function(t){t.target.composing||(o.costoLocal=t.target.value)}}})]),o.esCostoEmbarque?o._e():t("div",{staticClass:"form-group"},[t("label",{attrs:{for:"fechaInput"}},[o._v("Fecha:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:o.fechaLocal,expression:"fechaLocal"}],staticClass:"form-control",attrs:{type:"date",id:"fechaInput",max:o.maxDate},domProps:{value:o.fechaLocal},on:{input:function(t){t.target.composing||(o.fechaLocal=t.target.value)}}})]),o.mostrarInfo?t("div",{staticClass:"info-adicional"},[null!==o.costoAnterior?t("p",{staticClass:"costo-anterior"},[t("strong",[o._v("Costo anterior:")]),o._v(" $"+o._s(o.costoAnterior.toFixed(2))+" ")]):o._e(),o.fechaUltimaActualizacion?t("p",{staticClass:"fecha-anterior"},[t("strong",[o._v("√öltima actualizaci√≥n:")]),o._v(" "+o._s(o.fechaUltimaActualizacion)+" ")]):o._e()]):o._e()])},r=[],s=e("ff7a"),i={name:"CostoModal",components:{BaseModal:s["a"]},props:{mostrar:{type:Boolean,required:!0},costo:{type:[Number,String],default:""},medida:{type:String,default:""},esNuevo:{type:Boolean,default:!1},costoAnterior:{type:Number,default:null},fechaUltimaActualizacion:{type:String,default:""},fecha:{type:String,default:()=>(new Date).toISOString().split("T")[0]},esCostoEmbarque:{type:Boolean,default:!1}},data(){return{costoLocal:"",fechaLocal:""}},computed:{titulo(){return this.esNuevo?"Registrar Nueva Medida":this.esCostoEmbarque?"Costo Espec√≠fico - "+this.medida:"Actualizar Costo - "+this.medida},etiquetaCosto(){return this.esNuevo?"Costo Base":this.esCostoEmbarque?"Costo para este embarque":"Nuevo Costo"},placeholder(){return this.esNuevo?"Ingrese el costo base":this.esCostoEmbarque?"Ingrese el costo espec√≠fico":"Ingrese el nuevo costo"},textoBoton(){return this.esNuevo?"Registrar":this.esCostoEmbarque?"Guardar":"Actualizar"},mostrarInfo(){return!this.esNuevo&&(null!==this.costoAnterior||this.fechaUltimaActualizacion)},maxDate(){return(new Date).toISOString().split("T")[0]}},watch:{mostrar(o){o&&(this.costoLocal=this.costo,this.fechaLocal=this.fecha,this.$nextTick(()=>{var o;null===(o=this.$refs.costoInput)||void 0===o||o.focus()}))},costo(o){this.costoLocal=o},fecha(o){this.fechaLocal=o}},methods:{guardarCosto(){const o=parseFloat(this.costoLocal);!isNaN(o)&&o>=0?this.esCostoEmbarque?this.$emit("guardar",o):this.$emit("guardar",{costo:o,fecha:this.fechaLocal}):""===this.costoLocal?this.esCostoEmbarque?this.$emit("guardar",null):this.$emit("guardar",{costo:null,fecha:this.fechaLocal}):alert("Por favor ingrese un costo v√°lido (mayor o igual a 0)")}}},n=i,c=(e("6959"),e("2877")),l=Object(c["a"])(n,a,r,!1,null,"1c9b47e4",null);t["a"]=l.exports},"861c":function(o,t,e){"use strict";e("ca7b")},"900f":function(o,t,e){"use strict";var a=function(){var o=this,t=o._self._c;return t("div",{staticClass:"canvas-dibujo-container"},[t("h3",[o._v("Dibujo y Notas")]),t("div",{staticClass:"toolbar"},[t("button",{class:{active:o.isPenMode},attrs:{id:"pen-btn"},on:{click:o.activatePenMode}},[o._v("‚úèÔ∏è L√°piz")]),t("button",{class:{active:!o.isPenMode&&!o.eraserMode},attrs:{id:"select-btn"},on:{click:o.activateSelectMode}},[o._v("üëÜ Seleccionar")]),t("button",{class:{active:o.eraserMode},attrs:{id:"eraser-btn"},on:{click:o.activateEraserMode}},[o._v("üßπ Borrador")]),t("div",{staticClass:"separator"}),t("button",{attrs:{id:"undo-btn",title:"Retroceder un paso",disabled:o.historyIndex<=0},on:{click:o.undo}},[o._v("‚Ü©Ô∏è Deshacer")]),t("button",{attrs:{id:"redo-btn",title:"Avanzar un paso",disabled:o.historyIndex>=o.history.length-1},on:{click:o.redo}},[o._v("‚Ü™Ô∏è Rehacer")]),t("div",{staticClass:"separator"}),t("button",{attrs:{id:"arrow-btn"},on:{click:o.addArrow}},[o._v("‚ÜóÔ∏è Flecha")]),t("div",{staticClass:"separator"}),t("div",[t("select",{directives:[{name:"model",rawName:"v-model",value:o.currentPenSize,expression:"currentPenSize"}],attrs:{id:"pen-size"},on:{change:[function(t){var e=Array.prototype.filter.call(t.target.options,(function(o){return o.selected})).map((function(o){var t="_value"in o?o._value:o.value;return t}));o.currentPenSize=t.target.multiple?e:e[0]},o.updatePenSize]}},[t("option",{attrs:{value:"1"}},[o._v("Fino")]),t("option",{attrs:{value:"3",selected:""}},[o._v("Medio")]),t("option",{attrs:{value:"5"}},[o._v("Grueso")])])]),t("div",{staticClass:"separator"}),t("div",{staticStyle:{display:"flex",gap:"5px"}},o._l(o.colors,(function(e){return t("div",{key:e,staticClass:"color-btn",style:{backgroundColor:e},attrs:{"data-color":e},on:{click:function(t){return o.changeColor(e)}}})})),0),t("div",{staticClass:"separator"}),t("button",{attrs:{id:"clear-btn"},on:{click:o.clearCanvas}},[o._v("üóëÔ∏è Limpiar")])]),t("div",{staticClass:"canvas-container"},[t("div",{staticClass:"canvas-wrapper"},[t("canvas",{ref:"canvas"})])]),t("div",{attrs:{id:"status-bar"}},[o._v(" Presi√≥n: "+o._s(o.pressure.toFixed(2))+" | Posici√≥n: "+o._s(o.position.x)+", "+o._s(o.position.y)+" ")])])},r=[];e("14d9");const s=window.fabric;var i={name:"CanvasDibujo",data(){return{canvas:null,canvasWidth:800,canvasHeight:400,colors:["#000000","#e74c3c","#3498db","#2ecc71"],currentColor:"#000000",currentPenSize:3,isPenMode:!0,eraserMode:!1,pressure:0,position:{x:0,y:0},history:[],historyIndex:-1,canvasInitialized:!1}},mounted(){console.log("Fabric disponible:","undefined"!==typeof s),this.$nextTick(()=>{setTimeout(()=>{this.initCanvas()},100)}),window.addEventListener("resize",this.resizeCanvas)},beforeDestroy(){window.removeEventListener("resize",this.resizeCanvas),this.canvas&&(this.canvas.dispose(),this.canvas=null)},methods:{initCanvas(){try{if(!this.$refs.canvas)return void console.error("Elemento canvas no encontrado en el DOM");if("undefined"===typeof s)return console.error("Fabric.js no est√° disponible"),void setTimeout(()=>{console.log("Reintentando inicializar canvas..."),this.initCanvas()},500);if(console.log("Inicializando canvas con fabric:",s),this.resizeCanvasDimensions(),this.canvas=new s.Canvas(this.$refs.canvas,{width:this.canvasWidth,height:this.canvasHeight,isDrawingMode:!0,enableRetinaScaling:!0}),!this.canvas)return void console.error("Error al inicializar el canvas de fabric.js");this.canvas.freeDrawingBrush=new s.PencilBrush(this.canvas),this.canvas.freeDrawingBrush.width=this.currentPenSize,this.canvas.freeDrawingBrush.color=this.currentColor,this.setupCanvasEvents(),this.canvasInitialized=!0,this.saveToHistory(),this.updateHistoryButtons(),console.log("Canvas inicializado correctamente")}catch(o){console.error("Error al inicializar el canvas:",o),setTimeout(()=>{console.log("Reintentando inicializar canvas despu√©s de error..."),this.initCanvas()},1e3)}},resizeCanvasDimensions(){try{const o=this.$el?this.$el.clientWidth||document.documentElement.clientWidth:800;this.canvasWidth=Math.min(o-40,800),window.innerWidth<=768?this.canvasHeight=Math.min(window.innerHeight/3,300):this.canvasHeight=Math.min(window.innerHeight/2,400)}catch(o){console.error("Error al dimensionar el canvas:",o)}},resizeCanvas(){try{this.resizeCanvasDimensions(),this.canvas&&(this.canvas.setWidth(this.canvasWidth),this.canvas.setHeight(this.canvasHeight),this.canvas.renderAll())}catch(o){console.error("Error al redimensionar el canvas:",o)}},setupCanvasEvents(){if(this.canvas)try{this.canvas.on("path:created",()=>{this.saveToHistory()}),this.canvas.on("mouse:down",o=>{if(this.canvas){if(this.eraserMode){const t=this.canvas.getPointer(o.e);this.eraseObjectAtPoint(t)}if(this.canvas.isDrawingMode&&o.e.pressure&&(this.pressure=o.e.pressure,this.isPenMode&&this.canvas.freeDrawingBrush)){const o=Math.max(.5,Math.min(2,this.pressure))*this.currentPenSize;this.canvas.freeDrawingBrush.width=o}this.updatePosition(o.e)}}),this.canvas.on("mouse:move",o=>{if(this.canvas){if(this.canvas.isDrawingMode&&o.e.pressure&&this.isPenMode&&this.canvas.freeDrawingBrush){this.pressure=o.e.pressure;const t=Math.max(.5,Math.min(2,this.pressure))*this.currentPenSize;this.canvas.freeDrawingBrush.width=t}this.updatePosition(o.e)}}),this.canvas.on("object:added",()=>{this.canvas&&(this.canvas.isDrawingMode||this.saveToHistory())}),this.canvas.on("object:modified",()=>{this.canvas&&this.saveToHistory()}),this.canvas.on("object:removed",()=>{this.canvas&&(this.eraserMode||this.saveToHistory())})}catch(o){console.error("Error al configurar eventos del canvas:",o)}},saveToHistory(){if(this.canvas)try{this.historyIndex<this.history.length-1&&(this.history=this.history.slice(0,this.historyIndex+1));const o=JSON.stringify(this.canvas.toJSON());this.history.push(o),this.historyIndex=this.history.length-1,this.updateHistoryButtons()}catch(o){console.error("Error al guardar historial:",o)}},undo(){if(this.canvas)try{this.historyIndex>0&&(this.historyIndex--,this.loadFromHistory())}catch(o){console.error("Error en operaci√≥n deshacer:",o)}},redo(){if(this.canvas)try{this.historyIndex<this.history.length-1&&(this.historyIndex++,this.loadFromHistory())}catch(o){console.error("Error en operaci√≥n rehacer:",o)}},loadFromHistory(){if(this.canvas)try{this.historyIndex>=0&&this.historyIndex<this.history.length&&this.canvas.loadFromJSON(this.history[this.historyIndex],()=>{this.canvas.renderAll(),this.updateHistoryButtons()})}catch(o){console.error("Error al cargar desde historial:",o)}},updateHistoryButtons(){},activatePenMode(){if(this.canvas)try{this.eraserMode=!1,this.canvas.isDrawingMode=!0,this.canvas.freeDrawingBrush&&(this.canvas.freeDrawingBrush.color=this.currentColor,this.canvas.freeDrawingBrush.width=this.currentPenSize),this.isPenMode=!0,this.canvas.defaultCursor="default"}catch(o){console.error("Error al activar modo l√°piz:",o)}},activateSelectMode(){if(this.canvas)try{this.eraserMode=!1,this.canvas.isDrawingMode=!1,this.isPenMode=!1,this.canvas.defaultCursor="default"}catch(o){console.error("Error al activar modo selecci√≥n:",o)}},activateEraserMode(){if(this.canvas)try{this.eraserMode=!0,this.canvas.isDrawingMode=!1,this.isPenMode=!1,this.canvas.defaultCursor="crosshair"}catch(o){console.error("Error al activar modo borrador:",o)}},eraseObjectAtPoint(o){if(!this.canvas)return!1;try{const t=this.canvas.getObjects();for(let e=t.length-1;e>=0;e--){const a=t[e];if(a.containsPoint(o))return this.canvas.remove(a),this.canvas.renderAll(),this.saveToHistory(),!0}}catch(t){console.error("Error al borrar objeto:",t)}return!1},addArrow(){if(this.canvas)try{this.activateSelectMode();const o=new s.Path("M 0 0 L 100 0 M 90 -10 L 100 0 L 90 10",{stroke:this.currentColor,strokeWidth:2,left:this.canvas.width/2-50,top:this.canvas.height/2,strokeLineCap:"round",strokeLineJoin:"round"});this.canvas.add(o),this.canvas.setActiveObject(o),this.saveToHistory()}catch(o){console.error("Error al a√±adir flecha:",o)}},clearCanvas(){if(this.canvas)try{confirm("¬øEst√°s seguro que deseas limpiar todo el lienzo?")&&(this.canvas.clear(),this.saveToHistory())}catch(o){console.error("Error al limpiar canvas:",o)}},updatePosition(o){if(this.canvas&&this.canvas.upperCanvasEl)try{const t=this.canvas.upperCanvasEl.getBoundingClientRect();this.position={x:Math.round(o.clientX-t.left),y:Math.round(o.clientY-t.top)}}catch(t){console.error("Error al actualizar posici√≥n:",t)}},updatePenSize(){if(this.canvas&&this.isPenMode&&this.canvas.freeDrawingBrush)try{this.canvas.freeDrawingBrush.width=this.currentPenSize}catch(o){console.error("Error al actualizar tama√±o de l√°piz:",o)}},changeColor(o){if(this.canvas)try{this.currentColor=o,this.isPenMode&&this.canvas.freeDrawingBrush&&(this.canvas.freeDrawingBrush.color=this.currentColor)}catch(t){console.error("Error al cambiar color:",t)}}}},n=i,c=(e("c990"),e("2877")),l=Object(c["a"])(n,a,r,!1,null,"2a16441d",null);t["a"]=l.exports},9655:function(o,t,e){},a54e:function(o,t,e){"use strict";var a=function(){var o,t=this,e=t._self._c;return t.mostrar?e("div",{staticClass:"modal-overlay",on:{click:t.cerrarModal}},[e("div",{staticClass:"modal-content historial-abonos-modal",on:{click:function(o){o.stopPropagation()}}},[e("div",{staticClass:"modal-header"},[e("h2",[t._v("Historial de Abonos - "+t._s(null===(o=t.proveedor)||void 0===o?void 0:o.nombre))]),e("button",{staticClass:"close-button",on:{click:function(o){return t.$emit("cerrar")}}},[t._v("√ó")])]),e("div",{staticClass:"modal-body"},[e("div",{staticClass:"filtros-container"},[e("div",{staticClass:"filtros-row"},[e("div",{staticClass:"filtro-grupo"},[e("label",{attrs:{for:"filtroFechaDesde"}},[t._v("Desde:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.filtros.fechaDesde,expression:"filtros.fechaDesde"}],attrs:{id:"filtroFechaDesde",type:"date"},domProps:{value:t.filtros.fechaDesde},on:{change:t.aplicarFiltros,input:function(o){o.target.composing||t.$set(t.filtros,"fechaDesde",o.target.value)}}})]),e("div",{staticClass:"filtro-grupo"},[e("label",{attrs:{for:"filtroFechaHasta"}},[t._v("Hasta:")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.filtros.fechaHasta,expression:"filtros.fechaHasta"}],attrs:{id:"filtroFechaHasta",type:"date"},domProps:{value:t.filtros.fechaHasta},on:{change:t.aplicarFiltros,input:function(o){o.target.composing||t.$set(t.filtros,"fechaHasta",o.target.value)}}})]),e("div",{staticClass:"filtro-grupo"},[e("label",{attrs:{for:"filtroTipo"}},[t._v("Tipo:")]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.filtros.tipo,expression:"filtros.tipo"}],attrs:{id:"filtroTipo"},on:{change:[function(o){var e=Array.prototype.filter.call(o.target.options,(function(o){return o.selected})).map((function(o){var t="_value"in o?o._value:o.value;return t}));t.$set(t.filtros,"tipo",o.target.multiple?e:e[0])},t.aplicarFiltros]}},[e("option",{attrs:{value:""}},[t._v("Todos")]),e("option",{attrs:{value:"individual"}},[t._v("Individual")]),e("option",{attrs:{value:"general"}},[t._v("Abono General")])])]),e("div",{staticClass:"filtro-grupo"},[e("button",{staticClass:"btn-limpiar",on:{click:t.limpiarFiltros}},[t._v(" Limpiar Filtros ")])])])]),e("div",{staticClass:"estadisticas-container"},[e("div",{staticClass:"estadistica-card"},[e("div",{staticClass:"estadistica-valor"},[t._v("$"+t._s(t.formatNumber(t.estadisticas.totalAbonos)))]),e("div",{staticClass:"estadistica-label"},[t._v("Total Abonos")])]),e("div",{staticClass:"estadistica-card"},[e("div",{staticClass:"estadistica-valor"},[t._v(t._s(t.estadisticas.cantidadAbonos))]),e("div",{staticClass:"estadistica-label"},[t._v("Cantidad de Abonos")])]),e("div",{staticClass:"estadistica-card"},[e("div",{staticClass:"estadistica-valor"},[t._v("$"+t._s(t.formatNumber(t.estadisticas.promedioAbono)))]),e("div",{staticClass:"estadistica-label"},[t._v("Promedio por Abono")])])]),t.cargando?e("div",{staticClass:"loading-container"},[e("div",{staticClass:"spinner"}),e("p",[t._v("Cargando historial de abonos...")])]):t.abonosFiltrados.length>0?e("div",{staticClass:"abonos-container"},[e("div",{staticClass:"paginacion-info"},[e("p",[t._v("Mostrando "+t._s((t.paginaActual-1)*t.abonosPorPagina+1)+" - "+t._s(Math.min(t.paginaActual*t.abonosPorPagina,t.abonosFiltrados.length))+" de "+t._s(t.abonosFiltrados.length)+" abonos")])]),e("div",{staticClass:"abonos-list"},t._l(t.abonosPaginados,(function(o,a){return e("div",{key:`${o.deudaId}-${o.id}`,staticClass:"abono-item",class:{"abono-general":o.esAbonoGeneral}},[e("div",{staticClass:"abono-header"},[e("div",{staticClass:"abono-fecha"},[e("i",{staticClass:"fas fa-calendar-alt"}),t._v(" "+t._s(t.formatearFecha(o.fecha))+" ")]),e("div",{staticClass:"abono-monto"},[t._v(" $"+t._s(t.formatNumber(o.monto))+" ")]),e("div",{staticClass:"abono-tipo"},[e("span",{class:o.esAbonoGeneral?"tipo-general":"tipo-individual"},[t._v(" "+t._s(o.esAbonoGeneral?"General":"Individual")+" ")])]),e("div",{staticClass:"abono-acciones"},[e("button",{staticClass:"btn-eliminar-abono",attrs:{title:"Eliminar abono"},on:{click:function(e){return t.confirmarEliminarAbono(o)}}},[e("i",{staticClass:"fas fa-trash-alt"})])])]),e("div",{staticClass:"abono-body"},[e("div",{staticClass:"abono-descripcion"},[e("i",{staticClass:"fas fa-comment-alt"}),t._v(" "+t._s(o.descripcion)+" ")]),e("div",{staticClass:"abono-deuda-info"},[e("span",{staticClass:"deuda-fecha"},[t._v("Deuda del "+t._s(t.formatearFecha(o.deudaFecha)))]),e("span",{staticClass:"deuda-total"},[t._v("Total deuda: $"+t._s(t.formatNumber(o.deudaTotal)))])])]),e("div",{staticClass:"abono-footer"},[e("div",{staticClass:"fecha-creacion"},[t._v(" Registrado: "+t._s(t.formatearFechaHora(o.fechaCreacion))+" ")])])])})),0),t.totalPaginas>1?e("div",{staticClass:"paginacion-container"},[e("button",{staticClass:"btn-paginacion",attrs:{disabled:1===t.paginaActual},on:{click:function(o){return t.cambiarPagina(t.paginaActual-1)}}},[e("i",{staticClass:"fas fa-chevron-left"}),t._v(" Anterior ")]),e("div",{staticClass:"paginas-numeros"},t._l(t.paginasVisibles,(function(o){return e("button",{key:o,class:["btn-pagina",{activa:o===t.paginaActual}],on:{click:function(e){return t.cambiarPagina(o)}}},[t._v(" "+t._s(o)+" ")])})),0),e("button",{staticClass:"btn-paginacion",attrs:{disabled:t.paginaActual===t.totalPaginas},on:{click:function(o){return t.cambiarPagina(t.paginaActual+1)}}},[t._v(" Siguiente "),e("i",{staticClass:"fas fa-chevron-right"})])]):t._e()]):e("div",{staticClass:"no-data"},[t._m(0),e("h3",[t._v("No hay abonos registrados")]),Object.values(t.filtros).some(o=>o)?e("p",[t._v(" No se encontraron abonos con los filtros aplicados. ")]):e("p",[t._v(" Este proveedor no tiene abonos registrados a√∫n. ")])])])])]):t._e()},r=[function(){var o=this,t=o._self._c;return t("div",{staticClass:"no-data-icon"},[t("i",{staticClass:"fas fa-money-bill-wave"})])}],s=(e("14d9"),e("13d5"),e("dc59")),i=e("1494"),n={name:"HistorialAbonosModal",props:{mostrar:{type:Boolean,required:!0},proveedor:{type:Object,required:!0}},emits:["cerrar","abono-eliminado"],data(){return{cargando:!1,abonos:[],abonosFiltrados:[],paginaActual:1,abonosPorPagina:10,filtros:{fechaDesde:"",fechaHasta:"",tipo:""}}},computed:{totalPaginas(){return Math.ceil(this.abonosFiltrados.length/this.abonosPorPagina)},abonosPaginados(){const o=(this.paginaActual-1)*this.abonosPorPagina,t=o+this.abonosPorPagina;return this.abonosFiltrados.slice(o,t)},paginasVisibles(){const o=[],t=this.totalPaginas,e=this.paginaActual;let a=Math.max(1,e-2),r=Math.min(t,a+4);r-a<4&&(a=Math.max(1,r-4));for(let s=a;s<=r;s++)o.push(s);return o},estadisticas(){const o=this.abonosFiltrados.reduce((o,t)=>o+t.monto,0),t=this.abonosFiltrados.length,e=t>0?o/t:0;return{totalAbonos:o,cantidadAbonos:t,promedioAbono:e}}},methods:{cerrarModal(o){o.target===o.currentTarget&&this.$emit("cerrar")},cambiarPagina(o){o>=1&&o<=this.totalPaginas&&(this.paginaActual=o)},async cargarHistorialAbonos(){var o;if(null!==(o=this.proveedor)&&void 0!==o&&o.id)try{this.cargando=!0,this.abonos=[];const o=Object(i["o"])(Object(i["c"])(s["a"],"deudas"),Object(i["s"])("proveedorId","==",this.proveedor.id)),t=await Object(i["g"])(o),e=t.docs.map(o=>({id:o.id,...o.data()}));for(const a of e){const o=Object(i["o"])(Object(i["c"])(s["a"],"deudas",a.id,"abonos"),Object(i["l"])("fechaCreacion","desc")),t=await Object(i["g"])(o),e=t.docs.map(o=>({id:o.id,deudaId:a.id,deudaFecha:a.fecha,deudaTotal:a.total,...o.data()}));this.abonos.push(...e)}this.abonos.sort((o,t)=>{var e,a,r,s;const i=(null===(e=o.fechaCreacion)||void 0===e||null===(a=e.toDate)||void 0===a?void 0:a.call(e))||new Date(o.fechaCreacion),n=(null===(r=t.fechaCreacion)||void 0===r||null===(s=r.toDate)||void 0===s?void 0:s.call(r))||new Date(t.fechaCreacion);return n-i}),this.aplicarFiltros()}catch(t){console.error("Error al cargar historial de abonos:",t),alert("Error al cargar el historial de abonos")}finally{this.cargando=!1}},aplicarFiltros(){this.abonosFiltrados=this.abonos.filter(o=>{if(this.filtros.fechaDesde&&o.fecha<this.filtros.fechaDesde)return!1;if(this.filtros.fechaHasta&&o.fecha>this.filtros.fechaHasta)return!1;if(this.filtros.tipo){if("general"===this.filtros.tipo&&!o.esAbonoGeneral)return!1;if("individual"===this.filtros.tipo&&o.esAbonoGeneral)return!1}return!0}),this.paginaActual=1},limpiarFiltros(){this.filtros={fechaDesde:"",fechaHasta:"",tipo:""},this.aplicarFiltros()},formatNumber(o){return o?o.toLocaleString("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00"},formatearFecha(o){if(!o)return"";const t=new Date(o+"T00:00:00"),e={day:"numeric",month:"short",year:"numeric"};return t.toLocaleDateString("es-ES",e)},formatearFechaHora(o){var t;if(!o)return"";const e=(null===o||void 0===o||null===(t=o.toDate)||void 0===t?void 0:t.call(o))||new Date(o),a={day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"};return e.toLocaleDateString("es-ES",a)},confirmarEliminarAbono(o){const t=`¬øEst√° seguro de que desea eliminar este abono?\n\nFecha: ${this.formatearFecha(o.fecha)}\nMonto: $${this.formatNumber(o.monto)}\nTipo: ${o.esAbonoGeneral?"Abono General":"Individual"}\nDescripci√≥n: ${o.descripcion}\n\nEsta acci√≥n no se puede deshacer y afectar√° el saldo de la deuda.`;confirm(t)&&this.eliminarAbono(o)},async eliminarAbono(o){try{const t=Object(i["e"])(s["a"],"deudas",o.deudaId),e=await Object(i["f"])(t);if(!e.exists())return void alert("Error: No se encontr√≥ la deuda asociada a este abono.");const a=e.data(),r=a.saldoPendiente||0,n=a.total||0,c=r+o.monto;let l;l=c<=0?"pagado":"pendiente",console.log("=== ELIMINANDO ABONO ==="),console.log("Deuda ID:",o.deudaId),console.log("Monto total de la deuda:",n),console.log("Saldo antes de eliminar:",r),console.log("Monto del abono eliminado:",o.monto),console.log("Nuevo saldo calculado:",c),console.log("Estado actual:",a.estado),console.log("Nuevo estado calculado:",l);const d=Object(i["e"])(s["a"],"deudas",o.deudaId,"abonos",o.id);await Object(i["d"])(d),console.log("Abono eliminado de Firebase");const u={saldoPendiente:Math.max(0,c),estado:l,fechaActualizacion:(new Date).toISOString()};c>n&&(console.warn("Saldo calculado mayor que el total, ajustando..."),u.saldoPendiente=n,u.estado="pendiente"),console.log("Datos que se actualizar√°n en Firebase:",u),await Object(i["r"])(t,u),console.log("Deuda actualizada en Firebase exitosamente");const p=await Object(i["f"])(t);if(p.exists()){const o=p.data();console.log("=== VERIFICACI√ìN POST-ACTUALIZACI√ìN ==="),console.log("Estado en Firebase:",o.estado),console.log("Saldo Pendiente en Firebase:",o.saldoPendiente),console.log("Fecha actualizaci√≥n:",o.fechaActualizacion),o.estado!==l&&(console.error("¬°ALERTA! El estado no se actualiz√≥ correctamente en Firebase"),console.error("Esperado:",l,"Encontrado:",o.estado)),Math.abs(o.saldoPendiente-u.saldoPendiente)>.01&&(console.error("¬°ALERTA! El saldo pendiente no se actualiz√≥ correctamente en Firebase"),console.error("Esperado:",u.saldoPendiente,"Encontrado:",o.saldoPendiente))}alert(`Abono eliminado exitosamente.\n\nDetalles:\n‚Ä¢ Nuevo saldo pendiente: $${this.formatNumber(u.saldoPendiente)}\n‚Ä¢ Estado: ${l.toUpperCase()}\n‚Ä¢ Fecha: ${(new Date).toLocaleString("es-MX")}`),await this.cargarHistorialAbonos(),this.$emit("abono-eliminado",{deudaId:o.deudaId,proveedorId:this.proveedor.id,nuevoSaldo:u.saldoPendiente,nuevoEstado:l})}catch(t){console.error("Error al eliminar el abono:",t),alert("Error al eliminar el abono. Por favor, intente de nuevo.")}}},watch:{mostrar(o){o&&this.proveedor&&(this.cargarHistorialAbonos(),this.limpiarFiltros())}}},c=n,l=(e("861c"),e("2877")),d=Object(l["a"])(c,a,r,!1,null,"7f1e717b",null);t["a"]=d.exports},a691:function(o,t,e){},a947:function(o,t,e){"use strict";var a=function(){var o=this,t=o._self._c;return o.mostrar?t("div",{staticClass:"modal-overlay",on:{click:o.cerrarModal}},[t("div",{staticClass:"modal-content",on:{click:function(o){o.stopPropagation()}}},[t("div",{staticClass:"modal-header"},[t("h2",[o._v("Precios por Proveedor")]),t("button",{staticClass:"close-button",on:{click:function(t){return o.$emit("cerrar")}}},[o._v("√ó")])]),t("div",{staticClass:"modal-body"},[t("div",{staticClass:"proveedor-selector"},[t("label",{attrs:{for:"proveedorSelect"}},[o._v("Seleccionar Proveedor:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:o.proveedorSeleccionado,expression:"proveedorSeleccionado"}],attrs:{id:"proveedorSelect"},on:{change:[function(t){var e=Array.prototype.filter.call(t.target.options,(function(o){return o.selected})).map((function(o){var t="_value"in o?o._value:o.value;return t}));o.proveedorSeleccionado=t.target.multiple?e:e[0]},o.cargarProductosProveedor]}},[t("option",{attrs:{value:""}},[o._v("Seleccione un proveedor")]),o._l(o.proveedores,(function(e){return t("option",{key:e.id,domProps:{value:e.id}},[o._v(" "+o._s(e.nombre)+" ")])}))],2)]),o.proveedorSeleccionado?t("div",{staticClass:"productos-container"},[t("div",{staticClass:"productos-header"},[t("h3",[o._v("Productos - "+o._s(o.getNombreProveedor()))]),t("button",{staticClass:"btn-agregar-producto",on:{click:function(t){o.mostrarFormularioNuevo=!o.mostrarFormularioNuevo}}},[t("i",{staticClass:"fas fa-plus"}),o._v(" Nuevo Producto ")])]),o.mostrarFormularioNuevo?t("div",{staticClass:"nuevo-producto-form"},[t("div",{staticClass:"form-row"},[t("input",{directives:[{name:"model",rawName:"v-model",value:o.nuevoProducto.nombre,expression:"nuevoProducto.nombre"}],staticClass:"form-input",attrs:{placeholder:"Nombre del producto",required:""},domProps:{value:o.nuevoProducto.nombre},on:{input:function(t){t.target.composing||o.$set(o.nuevoProducto,"nombre",t.target.value)}}}),t("input",{directives:[{name:"model",rawName:"v-model.number",value:o.nuevoProducto.precio,expression:"nuevoProducto.precio",modifiers:{number:!0}}],staticClass:"form-input precio-input",attrs:{type:"number",step:"0.01",placeholder:"Precio actual",required:""},domProps:{value:o.nuevoProducto.precio},on:{input:function(t){t.target.composing||o.$set(o.nuevoProducto,"precio",o._n(t.target.value))},blur:function(t){return o.$forceUpdate()}}}),t("button",{staticClass:"btn-guardar-producto",attrs:{disabled:o.guardando},on:{click:o.agregarNuevoProducto}},[o._v(" "+o._s(o.guardando?"Guardando...":"Guardar")+" ")]),t("button",{staticClass:"btn-cancelar-producto",on:{click:o.cancelarNuevoProducto}},[o._v(" Cancelar ")])])]):o._e(),o.productosConPrecios.length>0?t("div",{staticClass:"productos-grid"},o._l(o.productosConPrecios,(function(e){return t("div",{key:e.nombre,staticClass:"producto-card",on:{click:function(t){return o.abrirHistorialProducto(e)}}},[t("div",{staticClass:"producto-info"},[t("h4",{staticClass:"producto-nombre"},[o._v(o._s(e.nombre))]),t("div",{staticClass:"precio-actual"},[t("span",{staticClass:"precio-valor"},[o._v("$"+o._s(o.formatearPrecio(e.precioActual)))]),t("span",{staticClass:"precio-fecha"},[o._v(o._s(o.formatearFecha(e.fechaUltimoPrecio)))])]),t("div",{staticClass:"precio-estadisticas"},[t("span",{staticClass:"total-registros"},[o._v(o._s(e.totalRegistros)+" precio(s)")]),t("i",{staticClass:"fas fa-chart-line precio-icono"})])])])})),0):o.cargandoProductos?o._e():t("div",{staticClass:"no-productos"},[t("p",[o._v("No hay productos registrados para este proveedor.")]),t("p",{staticClass:"sugerencia"},[o._v('Haz click en "Nuevo Producto" para agregar el primer producto.')])]),o.cargandoProductos?t("div",{staticClass:"loading-productos"},[t("div",{staticClass:"spinner-small"}),t("p",[o._v("Cargando productos...")])]):o._e()]):o._e(),t("HistorialProductoModal",{attrs:{mostrar:o.showHistorialProducto,producto:o.productoSeleccionado,"proveedor-id":o.proveedorSeleccionado,"proveedor-nombre":o.getNombreProveedor()},on:{cerrar:function(t){o.showHistorialProducto=!1},actualizado:o.cargarProductosProveedor}})],1)])]):o._e()},r=[],s=(e("14d9"),e("dc59")),i=e("1494"),n=function(){var o,t,e,a,r,s=this,i=s._self._c;return s.mostrar?i("div",{staticClass:"modal-overlay",on:{click:s.cerrarModal}},[i("div",{staticClass:"modal-content",on:{click:function(o){o.stopPropagation()}}},[i("div",{staticClass:"modal-header"},[i("div",{staticClass:"modal-title-info"},[i("h2",[s._v(s._s((null===(o=s.producto)||void 0===o?void 0:o.nombre)||"Producto"))]),i("span",{staticClass:"proveedor-badge"},[s._v(s._s(s.proveedorNombre))])]),i("button",{staticClass:"close-button",on:{click:function(o){return s.$emit("cerrar")}}},[s._v("√ó")])]),i("div",{staticClass:"modal-body"},[i("div",{staticClass:"producto-resumen"},[i("div",{staticClass:"precio-actual-section"},[i("div",{staticClass:"precio-principal"},[i("span",{staticClass:"label"},[s._v("Precio Actual")]),i("span",{staticClass:"precio-valor"},[s._v("$"+s._s(s.formatearPrecio(null===(t=s.producto)||void 0===t?void 0:t.precioActual)))]),i("span",{staticClass:"fecha-actual"},[s._v(s._s(s.formatearFecha(null===(e=s.producto)||void 0===e?void 0:e.fechaUltimoPrecio)))])]),i("div",{staticClass:"precio-estadisticas"},[i("div",{staticClass:"stat-item"},[i("span",{staticClass:"stat-numero"},[s._v(s._s((null===(a=s.producto)||void 0===a?void 0:a.totalRegistros)||0))]),i("span",{staticClass:"stat-label"},[s._v("Registros")])]),i("div",{staticClass:"stat-item"},[i("span",{staticClass:"stat-numero"},[s._v("$"+s._s(s.formatearPrecio(s.precioPromedio)))]),i("span",{staticClass:"stat-label"},[s._v("Promedio")])])])])]),i("div",{staticClass:"agregar-precio-section"},[i("div",{staticClass:"section-header"},[i("h3",[s._v("Actualizar Precio")]),i("button",{staticClass:"btn-toggle-form",class:{active:s.mostrarFormulario},on:{click:function(o){s.mostrarFormulario=!s.mostrarFormulario}}},[i("i",{staticClass:"fas",class:s.mostrarFormulario?"fa-minus":"fa-plus"})])]),s.mostrarFormulario?i("div",{staticClass:"precio-form"},[i("div",{staticClass:"form-grid"},[i("div",{staticClass:"form-group"},[i("label",{attrs:{for:"nuevoPrecio"}},[s._v("Nuevo Precio:")]),i("input",{directives:[{name:"model",rawName:"v-model.number",value:s.nuevoPrecio.precio,expression:"nuevoPrecio.precio",modifiers:{number:!0}}],ref:"precioInput",staticClass:"form-control precio-input",attrs:{id:"nuevoPrecio",type:"number",step:"0.01",placeholder:"0.00",required:""},domProps:{value:s.nuevoPrecio.precio},on:{keyup:function(o){return!o.type.indexOf("key")&&s._k(o.keyCode,"enter",13,o.key,"Enter")?null:s.agregarPrecio.apply(null,arguments)},input:function(o){o.target.composing||s.$set(s.nuevoPrecio,"precio",s._n(o.target.value))},blur:function(o){return s.$forceUpdate()}}})]),i("div",{staticClass:"form-group"},[i("label",{attrs:{for:"fechaPrecio"}},[s._v("Fecha:")]),i("input",{directives:[{name:"model",rawName:"v-model",value:s.nuevoPrecio.fecha,expression:"nuevoPrecio.fecha"}],staticClass:"form-control",attrs:{id:"fechaPrecio",type:"date",required:""},domProps:{value:s.nuevoPrecio.fecha},on:{input:function(o){o.target.composing||s.$set(s.nuevoPrecio,"fecha",o.target.value)}}})])]),i("div",{staticClass:"form-group"},[i("label",{attrs:{for:"notasPrecio"}},[s._v("Notas (opcional):")]),i("input",{directives:[{name:"model",rawName:"v-model",value:s.nuevoPrecio.notas,expression:"nuevoPrecio.notas"}],staticClass:"form-control",attrs:{id:"notasPrecio",type:"text",placeholder:"Ej: Nuevo proveedor, Oferta especial, etc."},domProps:{value:s.nuevoPrecio.notas},on:{input:function(o){o.target.composing||s.$set(s.nuevoPrecio,"notas",o.target.value)}}})]),i("div",{staticClass:"form-actions"},[i("button",{staticClass:"btn-guardar",attrs:{disabled:s.guardando},on:{click:s.agregarPrecio}},[i("i",{staticClass:"fas fa-save"}),s._v(" "+s._s(s.guardando?"Guardando...":"Guardar Precio")+" ")])])]):s._e()]),i("div",{staticClass:"historial-section"},[i("h3",[s._v("Historial de Precios")]),(null===(r=s.producto)||void 0===r||null===(r=r.precios)||void 0===r?void 0:r.length)>0?i("div",{staticClass:"precios-timeline"},s._l(s.preciosOrdenados,(function(o,t){return i("div",{key:t,staticClass:"precio-item",class:{"precio-actual":0===t}},[i("div",{staticClass:"precio-fecha-badge"},[s._v(" "+s._s(s.formatearFecha(o.fecha))+" ")]),i("div",{staticClass:"precio-info"},[i("div",{staticClass:"precio-monto"},[i("span",{staticClass:"precio-valor"},[s._v("$"+s._s(s.formatearPrecio(o.precio)))]),0===t?i("span",{staticClass:"actual-badge"},[s._v("Actual")]):s._e(),t>0?i("span",{staticClass:"cambio-precio",class:s.getCambioPrecioClass(o,s.preciosOrdenados[t-1])},[s._v(" "+s._s(s.getCambioPrecioTexto(o,s.preciosOrdenados[t-1]))+" ")]):s._e()]),o.notas?i("div",{staticClass:"precio-notas"},[i("i",{staticClass:"fas fa-sticky-note"}),s._v(" "+s._s(o.notas)+" ")]):s._e()]),i("div",{staticClass:"precio-actions"},[i("button",{staticClass:"btn-editar",attrs:{title:"Editar precio"},on:{click:function(e){return s.editarPrecio(o,t)}}},[i("i",{staticClass:"fas fa-edit"})]),t>0?i("button",{staticClass:"btn-eliminar",attrs:{title:"Eliminar precio"},on:{click:function(e){return s.eliminarPrecio(o,t)}}},[i("i",{staticClass:"fas fa-trash"})]):s._e()])])})),0):i("div",{staticClass:"no-historial"},[i("i",{staticClass:"fas fa-chart-line"}),i("p",[s._v("No hay historial de precios disponible")])])])])])]):s._e()},c=[],l=(e("13d5"),{name:"HistorialProductoModal",props:{mostrar:{type:Boolean,required:!0},producto:{type:Object,default:null},proveedorId:{type:String,required:!0},proveedorNombre:{type:String,required:!0}},data(){return{mostrarFormulario:!1,guardando:!1,nuevoPrecio:{precio:null,fecha:this.obtenerFechaActual(),notas:""}}},computed:{preciosOrdenados(){var o;return null!==(o=this.producto)&&void 0!==o&&o.precios?[...this.producto.precios].sort((o,t)=>new Date(t.fecha)-new Date(o.fecha)):[]},precioPromedio(){var o;if(null===(o=this.producto)||void 0===o||null===(o=o.precios)||void 0===o||!o.length)return 0;const t=this.producto.precios.reduce((o,t)=>o+t.precio,0);return t/this.producto.precios.length}},methods:{cerrarModal(o){o.target===o.currentTarget&&this.$emit("cerrar")},obtenerFechaActual(){const o=new Date;return o.toISOString().split("T")[0]},async agregarPrecio(){if(this.nuevoPrecio.precio&&this.nuevoPrecio.fecha)try{this.guardando=!0;const o={proveedorId:this.proveedorId,proveedorNombre:this.proveedorNombre,producto:this.producto.nombre,precio:this.nuevoPrecio.precio,fecha:this.nuevoPrecio.fecha,notas:this.nuevoPrecio.notas||"",fechaCreacion:new Date};console.log("Guardando nuevo precio:",o),await Object(i["b"])(Object(i["c"])(s["a"],"historialPrecios"),o),this.nuevoPrecio={precio:null,fecha:this.obtenerFechaActual(),notas:""},this.mostrarFormulario=!1,this.$emit("actualizado"),alert("Precio agregado correctamente")}catch(o){console.error("Error al agregar precio: ",o),alert("Error al agregar precio: "+o.message)}finally{this.guardando=!1}else alert("Por favor complete el precio y la fecha")},editarPrecio(o,t){const e=prompt("Nuevo precio:",o.precio);e&&!isNaN(parseFloat(e))&&console.log("Editar precio:",o,"Nuevo valor:",e)},eliminarPrecio(o,t){confirm(`¬øEst√° seguro de eliminar el precio del ${this.formatearFecha(o.fecha)}?`)&&console.log("Eliminar precio:",o)},getCambioPrecioClass(o,t){if(!t)return"";const e=o.precio-t.precio;return e>0?"aumento":e<0?"disminucion":"igual"},getCambioPrecioTexto(o,t){if(!t)return"";const e=o.precio-t.precio;if(0===e)return"";const a=(e/t.precio*100).toFixed(1),r=e>0?"+":"";return`${r}${a}%`},formatearFecha(o){if(!o)return"";const t=new Date(o+"T00:00:00"),e={day:"numeric",month:"short",year:"numeric"};return t.toLocaleDateString("es-ES",e)},formatearPrecio(o){return o?o.toLocaleString("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00"}},watch:{mostrar(o){o&&(this.mostrarFormulario=!1,this.nuevoPrecio={precio:null,fecha:this.obtenerFechaActual(),notas:""},this.$nextTick(()=>{this.mostrarFormulario&&this.$refs.precioInput&&this.$refs.precioInput.focus()}))},mostrarFormulario(o){o&&this.$nextTick(()=>{this.$refs.precioInput&&this.$refs.precioInput.focus()})}}}),d=l,u=(e("6934"),e("2877")),p=Object(u["a"])(d,n,c,!1,null,"1be7bc51",null),h=p.exports,v={name:"PreciosProveedorPanel",components:{HistorialProductoModal:h},props:{mostrar:{type:Boolean,required:!0},proveedores:{type:Array,default:()=>[]}},data(){return{proveedorSeleccionado:"",productosConPrecios:[],cargandoProductos:!1,guardando:!1,mostrarFormularioNuevo:!1,showHistorialProducto:!1,productoSeleccionado:null,nuevoProducto:{nombre:"",precio:null}}},methods:{cerrarModal(o){o.target===o.currentTarget&&this.$emit("cerrar")},getNombreProveedor(){const o=this.proveedores.find(o=>o.id===this.proveedorSeleccionado);return o?o.nombre:""},async cargarProductosProveedor(){if(this.proveedorSeleccionado)try{this.cargandoProductos=!0,console.log("Cargando productos para proveedor:",this.proveedorSeleccionado);const o=await Object(i["g"])(Object(i["o"])(Object(i["c"])(s["a"],"historialPrecios"),Object(i["s"])("proveedorId","==",this.proveedorSeleccionado))),t=o.docs.map(o=>o.data());console.log("Precios encontrados:",t.length);const e=new Map;t.forEach(o=>{const t=o.producto;e.has(t)||e.set(t,{nombre:t,precios:[]}),e.get(t).precios.push(o)}),this.productosConPrecios=Array.from(e.values()).map(o=>{const t=o.precios.sort((o,t)=>new Date(t.fecha)-new Date(o.fecha)),e=t[0];return{nombre:o.nombre,precioActual:e.precio,fechaUltimoPrecio:e.fecha,totalRegistros:o.precios.length,precios:t}}),this.productosConPrecios.sort((o,t)=>o.nombre.localeCompare(t.nombre)),console.log("Productos procesados:",this.productosConPrecios.length)}catch(o){console.error("Error al cargar productos: ",o),alert("Error al cargar productos: "+o.message)}finally{this.cargandoProductos=!1}else this.productosConPrecios=[]},async agregarNuevoProducto(){if(this.nuevoProducto.nombre&&this.nuevoProducto.precio)try{this.guardando=!0;const o={proveedorId:this.proveedorSeleccionado,proveedorNombre:this.getNombreProveedor(),producto:this.nuevoProducto.nombre,precio:this.nuevoProducto.precio,fecha:this.obtenerFechaActual(),notas:"Precio inicial del producto",fechaCreacion:new Date};console.log("Guardando nuevo producto:",o),await Object(i["b"])(Object(i["c"])(s["a"],"historialPrecios"),o),this.nuevoProducto={nombre:"",precio:null},this.mostrarFormularioNuevo=!1,await this.cargarProductosProveedor(),alert("Producto agregado correctamente")}catch(o){console.error("Error al agregar producto: ",o),alert("Error al agregar producto: "+o.message)}finally{this.guardando=!1}else alert("Por favor complete el nombre del producto y el precio")},cancelarNuevoProducto(){this.nuevoProducto={nombre:"",precio:null},this.mostrarFormularioNuevo=!1},abrirHistorialProducto(o){this.productoSeleccionado=o,this.showHistorialProducto=!0},obtenerFechaActual(){const o=new Date;return o.toISOString().split("T")[0]},formatearFecha(o){if(!o)return"";const t=new Date(o+"T00:00:00"),e={day:"numeric",month:"short",year:"numeric"};return t.toLocaleDateString("es-ES",e)},formatearPrecio(o){return o?o.toLocaleString("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00"}},watch:{mostrar(o){o&&(this.proveedorSeleccionado="",this.productosConPrecios=[],this.mostrarFormularioNuevo=!1)}}},m=v,f=(e("260b"),Object(u["a"])(m,a,r,!1,null,"6c7af0bb",null));t["a"]=f.exports},c97b:function(o,t,e){"use strict";e("4918")},c990:function(o,t,e){"use strict";e("a691")},ca7b:function(o,t,e){},e0fe:function(o,t,e){"use strict";e("5355")},f90b:function(o,t,e){"use strict";e("0836")}}]);