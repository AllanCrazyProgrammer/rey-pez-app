(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["app.be1b1ab5"],{"02c2":function(e,t,a){"use strict";a("8c82")},3229:function(e,t,a){"use strict";var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"resumen-mensual-barcos"},[t("div",{staticClass:"back-button-container"},[t("BackButton",{attrs:{to:"/barcos"}})],1),t("div",{staticClass:"header-section",style:{background:e.gradientePrimario}},[e._m(0)]),t("div",{staticClass:"navegacion-mes-card"},[t("div",{staticClass:"mes-navegacion"},[t("button",{staticClass:"btn-nav",on:{click:e.mesAnterior}},[t("i",{staticClass:"nav-icon"},[e._v("â¬…ï¸")]),e._v(" Anterior ")]),t("div",{staticClass:"mes-actual"},[t("h2",[e._v(e._s(e.mesActualFormatted))]),t("p",[e._v(e._s(e.aÃ±oActual))])]),t("button",{staticClass:"btn-nav",attrs:{disabled:e.esMesFuturo},on:{click:e.mesSiguiente}},[t("i",{staticClass:"nav-icon"},[e._v("âž¡ï¸")]),e._v(" Siguiente ")])]),t("div",{staticClass:"acceso-rapido"},[t("button",{staticClass:"btn-hoy",on:{click:e.irAMesActual}},[t("i",{staticClass:"icon"},[e._v("ðŸ“…")]),e._v(" Mes Actual ")]),t("select",{directives:[{name:"model",rawName:"v-model",value:e.mesSeleccionadoRapido,expression:"mesSeleccionadoRapido"}],staticClass:"selector-mes-rapido",on:{change:[function(t){var a=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.mesSeleccionadoRapido=t.target.multiple?a:a[0]},e.irAMesSeleccionado]}},[t("option",{attrs:{value:""}},[e._v("Ir a mes especÃ­fico...")]),e._l(e.opcionesMeses,(function(a){return t("option",{key:a.value,domProps:{value:a.value}},[e._v(" "+e._s(a.label)+" ")])}))],2)])]),e.loading?t("div",{staticClass:"loading-container"},[t("div",{staticClass:"loading-spinner"},[e._v("â³")]),t("p",[e._v("Cargando datos del mes...")])]):e._e(),e.loading?e._e():t("div",{staticClass:"resumen-general-card"},[t("h3",{staticClass:"section-title"},[t("i",{staticClass:"icon-summary"},[e._v("ðŸ“ˆ")]),e._v(" Resumen General - "+e._s(e.mesActualFormatted)+" "+e._s(e.aÃ±oActual)+" ")]),t("div",{staticClass:"metricas-generales"},[t("div",{staticClass:"metrica-card"},[t("i",{staticClass:"metrica-icon"},[e._v("ðŸ’°")]),t("div",{staticClass:"metrica-content"},[t("h4",[e._v("$"+e._s(e.formatNumber(e.resumenGeneral.totalGastado)))]),t("p",[e._v("Total Gastado")])])]),t("div",{staticClass:"metrica-card"},[t("i",{staticClass:"metrica-icon"},[e._v("ðŸ“")]),t("div",{staticClass:"metrica-content"},[t("h4",[e._v(e._s(e.resumenGeneral.totalDeudas))]),t("p",[e._v("Deudas Registradas")])])]),t("div",{staticClass:"metrica-card"},[t("i",{staticClass:"metrica-icon"},[e._v("â³")]),t("div",{staticClass:"metrica-content"},[t("h4",[e._v("$"+e._s(e.formatNumber(e.resumenGeneral.saldoPendiente)))]),t("p",[e._v("Saldo Pendiente")])])]),t("div",{staticClass:"metrica-card"},[t("i",{staticClass:"metrica-icon"},[e._v("ðŸ­")]),t("div",{staticClass:"metrica-content"},[t("h4",[e._v(e._s(e.resumenGeneral.proveedoresActivos))]),t("p",[e._v("Proveedores Activos")])])])])]),e.loading?e._e():t("div",{staticClass:"barcos-resumen-container"},e._l(e.barcosConDatos,(function(a){return t("div",{key:a.id,staticClass:"barco-resumen-card",style:{borderTopColor:e.getBarcoColors(a.id).primary}},[t("div",{staticClass:"barco-header",style:{background:e.getBarcoColors(a.id).gradient}},[t("div",{staticClass:"barco-info"},[t("i",{staticClass:"barco-icon"},[e._v(e._s("galileo"===a.id?"ðŸš¢":"ðŸ›¥ï¸"))]),t("div",{staticClass:"barco-details"},[t("h3",[e._v(e._s(a.nombre))]),t("p",[e._v(e._s(a.resumen.deudas)+" deudas en el mes")])])]),t("div",{staticClass:"barco-totales"},[t("div",{staticClass:"total-item"},[t("span",{staticClass:"label"},[e._v("Total:")]),t("span",{staticClass:"value"},[e._v("$"+e._s(e.formatNumber(a.resumen.total)))])]),t("div",{staticClass:"total-item"},[t("span",{staticClass:"label"},[e._v("Pendiente:")]),t("span",{staticClass:"value pendiente"},[e._v("$"+e._s(e.formatNumber(a.resumen.pendiente)))])])])]),t("div",{staticClass:"proveedores-desglose"},[e._m(1,!0),t("div",{staticClass:"proveedores-lista"},e._l(a.proveedores,(function(a){return t("div",{key:a.id,staticClass:"proveedor-item"},[t("div",{staticClass:"proveedor-info"},[t("div",{staticClass:"proveedor-color",style:{backgroundColor:a.color}}),t("div",{staticClass:"proveedor-nombre"},[e._v(e._s(a.nombre))])]),t("div",{staticClass:"proveedor-montos"},[t("div",{staticClass:"monto-item"},[t("span",{staticClass:"label"},[e._v("Deudas:")]),t("span",{staticClass:"value"},[e._v(e._s(a.cantidadDeudas))])]),t("div",{staticClass:"monto-item"},[t("span",{staticClass:"label"},[e._v("Total:")]),t("span",{staticClass:"value"},[e._v("$"+e._s(e.formatNumber(a.total)))])]),t("div",{staticClass:"monto-item"},[t("span",{staticClass:"label"},[e._v("Pendiente:")]),t("span",{staticClass:"value pendiente"},[e._v("$"+e._s(e.formatNumber(a.pendiente)))])])])])})),0)]),t("div",{staticClass:"grafico-barras"},[e._m(2,!0),t("div",{staticClass:"barras-container"},e._l(a.proveedores,(function(s){return t("div",{key:"chart-"+s.id,staticClass:"barra-item"},[t("div",{staticClass:"barra-info"},[t("span",{staticClass:"barra-label"},[e._v(e._s(s.nombre))]),t("span",{staticClass:"barra-value"},[e._v("$"+e._s(e.formatNumber(s.total)))])]),t("div",{staticClass:"barra-visual"},[t("div",{staticClass:"barra-fill",style:{width:e.calcularPorcentaje(s.total,a.resumen.total)+"%",backgroundColor:s.color}})])])})),0)])])})),0),!e.loading&&e.resumenGeneral.totalDeudas>0?t("div",{staticClass:"acciones-exportacion"},[t("button",{staticClass:"btn-exportar pdf",on:{click:e.exportarPDF}},[t("i",{staticClass:"icon"},[e._v("ðŸ“„")]),e._v(" Exportar PDF ")]),t("button",{staticClass:"btn-exportar compartir",on:{click:e.compartirReporte}},[t("i",{staticClass:"icon"},[e._v("ðŸ“¤")]),e._v(" Compartir ")])]):e._e(),e.loading||0!==e.resumenGeneral.totalDeudas?e._e():t("div",{staticClass:"no-datos-container"},[t("div",{staticClass:"no-datos-content"},[t("i",{staticClass:"no-datos-icon"},[e._v("ðŸ“…")]),t("h3",[e._v("No hay actividad registrada")]),t("p",[e._v("No se encontraron deudas para "+e._s(e.mesActualFormatted)+" "+e._s(e.aÃ±oActual))]),t("router-link",{staticClass:"btn-crear-deuda",attrs:{to:"/barcos/deudas/nueva"}},[t("i",{staticClass:"icon"},[e._v("âž•")]),e._v(" Registrar Nueva Deuda ")])],1)])])},o=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"header-content"},[t("h1",{staticClass:"main-title"},[t("i",{staticClass:"icon-chart"},[e._v("ðŸ“Š")]),e._v(" Reporte Mensual de Barcos ")]),t("p",{staticClass:"subtitle"},[e._v("Resumen detallado de actividades y gastos mensuales")])])},function(){var e=this,t=e._self._c;return t("h4",{staticClass:"desglose-title"},[t("i",{staticClass:"icon"},[e._v("ðŸ­")]),e._v(" Desglose por Proveedor ")])},function(){var e=this,t=e._self._c;return t("h4",{staticClass:"desglose-title"},[t("i",{staticClass:"icon"},[e._v("ðŸ“Š")]),e._v(" DistribuciÃ³n de Gastos ")])}],r=(a("14d9"),a("13d5"),a("88e6"),a("70cc"),a("eb03"),a("22e5c"),a("c01e"),a("fa76"),a("8306"),a("dc59")),l=a("1494"),i=a("74c9"),n=a("8baf"),c=(a("0da4"),{name:"ResumenMensualBarcos",components:{BackButton:i["a"]},data(){return{loading:!0,mesActual:(new Date).getMonth(),"aÃ±oActual":(new Date).getFullYear(),deudas:[],proveedores:[],resumenGeneral:{totalGastado:0,totalDeudas:0,saldoPendiente:0,proveedoresActivos:0},"mesesDelAÃ±o":["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],mesSeleccionadoRapido:""}},computed:{colorPrimario(){return"#3498db"},colorSecundario(){return"#2980b9"},gradientePrimario(){return"linear-gradient(135deg, #3498db 0%, #2980b9 100%)"},getBarcoColors(){return e=>"maria-guadalupe"===e?{primary:"#27ae60",secondary:"#2ecc71",gradient:"linear-gradient(135deg, #27ae60 0%, #2ecc71 100%)",shadowColor:"rgba(39, 174, 96, 0.3)"}:{primary:"#3498db",secondary:"#2980b9",gradient:"linear-gradient(135deg, #3498db 0%, #2980b9 100%)",shadowColor:"rgba(52, 152, 219, 0.3)"}},mesActualFormatted(){return this.mesesDelAÃ±o[this.mesActual]},esMesFuturo(){const e=new Date,t=new Date(this.aÃ±oActual,this.mesActual),a=new Date(e.getFullYear(),e.getMonth());return t>a},opcionesMeses(){const e=[],t=new Date;for(let a=11;a>=0;a--){const s=new Date(t.getFullYear(),t.getMonth()-a);e.push({value:`${s.getFullYear()}-${s.getMonth()}`,label:`${this.mesesDelAÃ±o[s.getMonth()]} ${s.getFullYear()}`})}return e}},async mounted(){await this.cargarProveedores(),await this.cargarDatosMes(),0===this.deudas.length&&this.esMesFuturo&&(console.log("No hay datos en mes futuro, navegando al mes actual"),this.irAMesActual())},methods:{async cargarProveedores(){try{const e=await Object(l["g"])(Object(l["c"])(r["a"],"proveedoresBarcos"));this.proveedores=e.docs.map(e=>({id:e.id,...e.data()}))}catch(e){console.error("Error al cargar proveedores:",e)}},async cargarDatosMes(){this.loading=!0;try{console.log("Cargando datos para:",this.mesActualFormatted,this.aÃ±oActual);const e=await Object(l["g"])(Object(l["c"])(r["a"],"deudasBarcos")),t=e.docs.map(e=>({id:e.id,...e.data()}));console.log("Total de deudas encontradas:",t.length);const a=`${this.aÃ±oActual}-${(this.mesActual+1).toString().padStart(2,"0")}`;this.deudas=t.filter(e=>{if(!e.fecha)return!1;let t;if("string"===typeof e.fecha)t=e.fecha;else if(e.fecha&&e.fecha.toDate)t=e.fecha.toDate().toISOString().split("T")[0];else{if(!(e.fecha instanceof Date))return console.warn("Formato de fecha no reconocido:",e.fecha),!1;t=e.fecha.toISOString().split("T")[0]}const s=t.startsWith(a);return s&&console.log("Deuda del mes encontrada:",{id:e.id,fecha:t,total:e.totalDeuda||e.total,proveedor:e.nombreProveedor}),s}),console.log("Deudas filtradas para el mes:",this.deudas.length),this.calcularResumenes()}catch(e){console.error("Error al cargar datos del mes:",e),alert("Error al cargar los datos del mes: "+e.message)}finally{this.loading=!1}},calcularResumenes(){console.log("Calculando resÃºmenes con",this.deudas.length,"deudas"),this.resumenGeneral={totalGastado:0,totalDeudas:this.deudas.length,saldoPendiente:0,proveedoresActivos:0};const e={galileo:{id:"galileo",nombre:"El Galileo",deudas:[],proveedores:{}},"maria-guadalupe":{id:"maria-guadalupe",nombre:"MarÃ­a Guadalupe",deudas:[],proveedores:{}}},t=new Set;this.deudas.forEach(a=>{console.log("Procesando deuda:",a);const s=a.barco||"galileo",o=a.totalDeuda||a.total||0,r=a.totalAbonado||0,l=o-r;console.log("Valores calculados:",{total:o,abonado:r,pendiente:l}),this.resumenGeneral.totalGastado+=o,this.resumenGeneral.saldoPendiente+=l;const i=a.proveedorId||a.proveedor||"sin-proveedor";if("sin-proveedor"!==i&&t.add(i),e[s]){if(e[s].deudas.push(a),!e[s].proveedores[i]){const t=this.proveedores.find(e=>e.id===i);e[s].proveedores[i]={id:i,nombre:a.nombreProveedor||(null===t||void 0===t?void 0:t.nombre)||"Sin proveedor",color:(null===t||void 0===t?void 0:t.color)||"#6c757d",cantidadDeudas:0,total:0,pendiente:0}}e[s].proveedores[i].cantidadDeudas++,e[s].proveedores[i].total+=o,e[s].proveedores[i].pendiente+=l}}),this.resumenGeneral.proveedoresActivos=t.size,console.log("Resumen general calculado:",this.resumenGeneral),this.barcosConDatos=Object.values(e).filter(e=>e.deudas.length>0).map(e=>({...e,resumen:{deudas:e.deudas.length,total:e.deudas.reduce((e,t)=>e+(t.totalDeuda||t.total||0),0),pendiente:e.deudas.reduce((e,t)=>e+((t.totalDeuda||t.total||0)-(t.totalAbonado||0)),0)},proveedores:Object.values(e.proveedores).sort((e,t)=>t.total-e.total)})),console.log("Barcos con datos:",this.barcosConDatos)},mesAnterior(){0===this.mesActual?(this.mesActual=11,this.aÃ±oActual--):this.mesActual--,this.cargarDatosMes()},mesSiguiente(){this.esMesFuturo||(11===this.mesActual?(this.mesActual=0,this.aÃ±oActual++):this.mesActual++,this.cargarDatosMes())},irAMesActual(){const e=new Date;this.mesActual=e.getMonth(),this.aÃ±oActual=e.getFullYear(),this.cargarDatosMes()},irAMesSeleccionado(){if(this.mesSeleccionadoRapido){const[e,t]=this.mesSeleccionadoRapido.split("-");this.aÃ±oActual=parseInt(e),this.mesActual=parseInt(t),this.mesSeleccionadoRapido="",this.cargarDatosMes()}},calcularPorcentaje(e,t){return t>0?Math.round(e/t*100):0},formatNumber(e){return new Intl.NumberFormat("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2}).format(e||0)},async exportarPDF(){try{const e=new n["default"],t=[102,126,234],a=[44,62,80],s=[127,140,141];let o=20;e.setFontSize(20),e.setTextColor(...t),e.text("REPORTE MENSUAL DE BARCOS",20,o),o+=10,e.setFontSize(14),e.setTextColor(...s),e.text(`${this.mesActualFormatted} ${this.aÃ±oActual}`,20,o),e.setFontSize(10);const r=(new Date).toLocaleDateString("es-MX",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});e.text("Generado el: "+r,150,o),o+=20,e.setFontSize(14),e.setTextColor(...a),e.text("RESUMEN GENERAL",20,o),o+=10;const l=[["Total Gastado","$"+this.formatNumber(this.resumenGeneral.totalGastado)],["Deudas Registradas",this.resumenGeneral.totalDeudas.toString()],["Saldo Pendiente","$"+this.formatNumber(this.resumenGeneral.saldoPendiente)],["Proveedores Activos",this.resumenGeneral.proveedoresActivos.toString()]];if(e.autoTable({startY:o,head:[["Concepto","Valor"]],body:l,theme:"grid",headStyles:{fillColor:t,textColor:[255,255,255],fontSize:11,fontStyle:"bold"},bodyStyles:{fontSize:10,textColor:a},columnStyles:{0:{cellWidth:80},1:{cellWidth:50,halign:"right",fontStyle:"bold"}},margin:{left:20,right:20}}),o=e.lastAutoTable.finalY+15,this.barcosConDatos.length>0){e.setFontSize(14),e.setTextColor(...a),e.text("ANALISIS POR BARCO",20,o),o+=10;const t=[];this.barcosConDatos.forEach((e,a)=>{const s="galileo"===e.id?"El Galileo":"Maria Guadalupe";t.push([""+s,"","",""]);const o=e.proveedores.slice(0,5);if(o.forEach(e=>{t.push(["   > "+e.nombre,e.cantidadDeudas.toString(),"$"+this.formatNumber(e.total),"$"+this.formatNumber(e.pendiente)])}),e.proveedores.length>5){const a=e.proveedores.slice(5),s=a.reduce((e,t)=>e+t.total,0),o=a.reduce((e,t)=>e+t.pendiente,0),r=a.reduce((e,t)=>e+t.cantidadDeudas,0);t.push([`   > Otros (${a.length})`,r.toString(),"$"+this.formatNumber(s),"$"+this.formatNumber(o)])}t.push([`--- TOTAL ${s.toUpperCase()} ---`,e.resumen.deudas.toString(),"$"+this.formatNumber(e.resumen.total),"$"+this.formatNumber(e.resumen.pendiente)]),a<this.barcosConDatos.length-1&&t.push(["","","",""])}),this.barcosConDatos.length>1&&(t.push(["","","",""]),t.push(["=== TOTAL GENERAL ===",this.resumenGeneral.totalDeudas.toString(),"$"+this.formatNumber(this.resumenGeneral.totalGastado),"$"+this.formatNumber(this.resumenGeneral.saldoPendiente)])),e.autoTable({startY:o,head:[["Barco / Proveedor","Deudas","Total","Pendiente"]],body:t,theme:"striped",headStyles:{fillColor:[52,152,219],textColor:[255,255,255],fontSize:11,fontStyle:"bold"},bodyStyles:{fontSize:9,textColor:a},columnStyles:{0:{cellWidth:70},1:{cellWidth:25,halign:"center"},2:{cellWidth:40,halign:"right"},3:{cellWidth:40,halign:"right"}},margin:{left:20,right:20},didParseCell:function(e){e.cell.raw&&e.cell.raw.includes("=== TOTAL GENERAL ===")?(e.cell.styles.fontStyle="bold",e.cell.styles.fillColor=[102,126,234],e.cell.styles.textColor=[255,255,255],e.cell.styles.fontSize=11):e.cell.raw&&e.cell.raw.includes("--- TOTAL")?(e.cell.styles.fontStyle="bold",e.cell.styles.fillColor=[52,152,219],e.cell.styles.textColor=[255,255,255],e.cell.styles.fontSize=10):!e.cell.raw||!e.cell.raw.includes("El Galileo")&&!e.cell.raw.includes("Maria Guadalupe")||e.cell.raw.includes(">")||e.cell.raw.includes("---")||e.cell.raw.includes("===")?e.cell.raw&&e.cell.raw.includes(">")&&(e.cell.styles.fontSize=9,e.cell.styles.textColor=[52,73,94]):(e.cell.styles.fontStyle="bold",e.cell.styles.fillColor=[236,240,241],e.cell.styles.fontSize=11)}}),o=e.lastAutoTable.finalY+10}o<250&&(e.setFontSize(8),e.setTextColor(...s),e.text("Sistema de GestiÃ³n Rey Pez - Reporte generado automÃ¡ticamente",20,280),e.text("Total de pÃ¡ginas: 1",150,280));const i=`Reporte_Barcos_${this.mesActualFormatted}_${this.aÃ±oActual}.pdf`;e.save(i),alert("âœ… Reporte PDF generado exitosamente: "+i)}catch(e){console.error("Error al generar PDF:",e),alert("âŒ Error al generar el reporte PDF. Por favor, intÃ©ntalo de nuevo.")}},async compartirReporte(){if(navigator.share)try{await navigator.share({title:`Reporte Mensual de Barcos - ${this.mesActualFormatted} ${this.aÃ±oActual}`,text:`Resumen mensual: $${this.formatNumber(this.resumenGeneral.totalGastado)} gastados en ${this.resumenGeneral.totalDeudas} deudas`,url:window.location.href})}catch(e){console.log("Error al compartir:",e)}else{const e=`Reporte Mensual de Barcos - ${this.mesActualFormatted} ${this.aÃ±oActual}\nTotal gastado: $${this.formatNumber(this.resumenGeneral.totalGastado)}\nDeudas: ${this.resumenGeneral.totalDeudas}`;navigator.clipboard.writeText(e),alert("Resumen copiado al portapapeles")}}}}),d=c,u=(a("02c2"),a("2877")),m=Object(u["a"])(d,s,o,!1,null,"940c7e28",null);t["a"]=m.exports},"8c82":function(e,t,a){}}]);