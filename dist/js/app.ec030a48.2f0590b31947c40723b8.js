(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["app.ec030a48"],{"4dc0":function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e._self._c;return t("div",{staticClass:"rendimientos-container"},[t("div",{staticClass:"header-container"},[t("button",{staticClass:"btn-volver",on:{click:e.volverAEmbarque}},[t("i",{staticClass:"fas fa-arrow-left"}),e._v(" Volver al Embarque ")]),t("h2",[e._v("Rendimientos por Medida")]),t("button",{staticClass:"btn-nota",on:{click:e.abrirModalNota}},[t("i",{staticClass:"fas fa-sticky-note"}),e._v(" Agregar Nota ")]),t("button",{staticClass:"btn-costos",on:{click:e.abrirModalCostos}},[t("i",{staticClass:"fas fa-dollar-sign"}),e._v(" Costos ")]),t("button",{staticClass:"btn-pdf",on:{click:e.generarPDF}},[t("i",{staticClass:"fas fa-file-pdf"}),e._v(" Generar PDF ")])]),e.embarqueData?t("div",{staticClass:"rendimientos-grid"},e._l(e.medidasUnicas,(function(a,o){return t("div",{key:o,staticClass:"rendimiento-card"},[t("div",{staticClass:"medida-info"},[t("div",{staticClass:"medida-header"},[t("span",{staticClass:"medida-label editable-label",on:{click:function(t){return e.editarNombreMedida(a)}}},[e._v(" "+e._s(e.obtenerNombreMedidaPersonalizado(a))+" ")]),t("div",{staticClass:"ocultar-control"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.medidaOculta[a],expression:"medidaOculta[medida]"}],attrs:{type:"checkbox",id:"ocultar-"+o},domProps:{checked:Array.isArray(e.medidaOculta[a])?e._i(e.medidaOculta[a],null)>-1:e.medidaOculta[a]},on:{change:[function(t){var o=e.medidaOculta[a],r=t.target,i=!!r.checked;if(Array.isArray(o)){var s=null,n=e._i(o,s);r.checked?n<0&&e.$set(e.medidaOculta,a,o.concat([s])):n>-1&&e.$set(e.medidaOculta,a,o.slice(0,n).concat(o.slice(n+1)))}else e.$set(e.medidaOculta,a,i)},e.guardarEstadoOculto]}}),t("label",{attrs:{for:"ocultar-"+o}},[e._v("Ocultar en PDF")])])]),t("div",{staticClass:"costo-input"},[t("div",{staticClass:"costo-container"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.costosPorMedida[a],expression:"costosPorMedida[medida]"}],attrs:{type:"number",placeholder:"Precio",step:"0.01"},domProps:{value:e.costosPorMedida[a]},on:{input:[function(t){t.target.composing||e.$set(e.costosPorMedida,a,t.target.value)},e.guardarCostos]}}),e.costosPorMedida[a]?t("span",{staticClass:"costo-final"},[e._v(" Costo Final: $"+e._s(e.calcularCostoFinal(a))+" ")]):e._e()])]),t("div",{staticClass:"input-group"},[e.esMedidaMix(a)?[t("div",{staticClass:"mix-inputs"},[t("div",{staticClass:"mix-input"},[t("label",{staticClass:"editable-label",on:{click:function(t){return e.editarEtiqueta(a,"medida1")}}},[e._v(" "+e._s(e.obtenerEtiqueta(a,"medida1"))+": ")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.kilosCrudos[a].medida1,expression:"kilosCrudos[medida].medida1"}],attrs:{type:"number",placeholder:"Kilos medida 1"},domProps:{value:e.kilosCrudos[a].medida1},on:{input:[function(t){t.target.composing||e.$set(e.kilosCrudos[a],"medida1",t.target.value)},function(t){return e.calcularRendimiento(a)}]}})]),t("div",{staticClass:"mix-input"},[t("label",{staticClass:"editable-label",on:{click:function(t){return e.editarEtiqueta(a,"medida2")}}},[e._v(" "+e._s(e.obtenerEtiqueta(a,"medida2"))+": ")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.kilosCrudos[a].medida2,expression:"kilosCrudos[medida].medida2"}],attrs:{type:"number",placeholder:"Kilos medida 2"},domProps:{value:e.kilosCrudos[a].medida2},on:{input:[function(t){t.target.composing||e.$set(e.kilosCrudos[a],"medida2",t.target.value)},function(t){return e.calcularRendimiento(a)}]}})])])]:[t("label",[e._v("Kilos en crudo:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.kilosCrudos[a],expression:"kilosCrudos[medida]"}],attrs:{type:"number",placeholder:"Ingrese kilos"},domProps:{value:e.kilosCrudos[a]},on:{input:[function(t){t.target.composing||e.$set(e.kilosCrudos,a,t.target.value)},function(t){return e.calcularRendimiento(a)}]}})]],2),t("div",{staticClass:"resultados"},[t("p",[e._v("Total embarcado: "+e._s(e.obtenerTotalEmbarcado(a).toFixed(1))+" kg")]),t("p",{staticClass:"rendimiento"},[e._v(" Rendimiento: "),t("span",{class:{"rendimiento-alto":e.getRendimiento(a)>1}},[e._v(" "+e._s(e.getRendimiento(a).toFixed(2))+" ")])])])])])})),0):t("div",[t("p",[e._v("Cargando datos del embarque...")])]),e.mostrarModal?t("div",{staticClass:"modal-overlay"},[t("div",{staticClass:"modal-content"},[t("h3",[e._v("Agregar Nota")]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.nota,expression:"nota"}],attrs:{placeholder:"Escriba su nota aqu칤...",rows:"4"},domProps:{value:e.nota},on:{input:function(t){t.target.composing||(e.nota=t.target.value)}}}),t("div",{staticClass:"modal-buttons"},[t("button",{staticClass:"btn-guardar",on:{click:e.guardarNota}},[e._v("Guardar")]),t("button",{staticClass:"btn-cancelar",on:{click:e.cerrarModal}},[e._v("Cancelar")])])])]):e._e(),t("CostosModal",{attrs:{showModal:e.showCostosModal,costosPorMedida:e.costosPorMedida,rendimientos:e.rendimientosPorMedida},on:{"update:showModal":function(t){e.showCostosModal=t},guardar:e.guardarCostos}})],1)},r=[],i=(a("14d9"),a("13d5"),a("1494")),s=a("2ef0"),n=a("6d4d"),c=a("2729"),d={name:"Rendimientos",components:{CostosModal:c["a"]},data(){return{kilosCrudos:{},medidasUnicas:[],embarqueData:null,guardadoAutomaticoActivo:!1,nombresMedidasPersonalizados:{},mostrarModal:!1,nota:"",medidaOculta:{},costosPorMedida:{},showCostosModal:!1,unsubscribePreciosGlobales:null}},async created(){await this.cargarEmbarque(),await this.iniciarEscuchaPreciosGlobales(),this.guardarCambiosEnTiempoReal=Object(s["debounce"])(this.guardarCambiosEnTiempoReal,300)},methods:{obtenerNombreCliente(e){if(!this.embarqueData||!this.embarqueData.clientes)return"";const t=this.embarqueData.clientes.find(t=>t.id.toString()===e.toString());return t?t.nombre:""},async cargarEmbarque(){try{const e=Object(i["h"])(),t=this.$route.params.id,a=Object(i["e"])(e,"embarques",t),o=await Object(i["f"])(a);if(o.exists()){this.embarqueData=o.data(),this.nombresMedidasPersonalizados=this.embarqueData.nombresMedidasPersonalizados||{},this.obtenerMedidasUnicas(),this.medidaOculta=this.embarqueData.medidaOculta||{},this.costosPorMedida=this.embarqueData.costosPorMedida||{};const e=this.embarqueData.kilosCrudos||{};this.kilosCrudos={...e},this.medidasUnicas.forEach(e=>{this.kilosCrudos[e]||(this.esMedidaMix(e)?this.$set(this.kilosCrudos,e,{medida1:0,medida2:0,etiqueta1:"Kilos en crudo (Medida 1)",etiqueta2:"Kilos en crudo (Medida 2)"}):this.$set(this.kilosCrudos,e,0))}),console.log("Datos cargados:",this.kilosCrudos),this.guardadoAutomaticoActivo=!0}else console.error("No se encontr칩 el embarque")}catch(e){console.error("Error al cargar el embarque:",e)}},async guardarCambiosEnTiempoReal(){if(this.guardadoAutomaticoActivo)try{const e=Object(i["h"])(),t=this.$route.params.id,a=Object(i["e"])(e,"embarques",t);await Object(i["r"])(a,{kilosCrudos:this.kilosCrudos}),console.log("Rendimientos guardados:",this.kilosCrudos)}catch(e){console.error("Error al guardar los rendimientos:",e)}},obtenerMedidasUnicas(){if(!this.embarqueData||!this.embarqueData.clientes)return;const e=new Map,t=new Map;this.embarqueData.clientes.forEach(a=>{a.productos.forEach(o=>{if(o.medida){const r=o.medida.toLowerCase().trim();let i=o.medida;if("Ozuna"!==a.nombre||o.esVenta||(i=o.medida+" Maquila Ozuna"),r.endsWith("mix")){const e=r.split(" ")[0];t.set(e,i)}else e.has(i)||e.set(i,i)}})});const a=Array.from(t.keys()).sort();if(a.length>=2)for(let o=0;o<a.length;o+=2)if(o+1<a.length){const t=`${a[o]}-${a[o+1]} mix`;e.set(t,t),this.kilosCrudos[t]||this.$set(this.kilosCrudos,t,{medida1:0,medida2:0,etiqueta1:`Kilos en crudo (${a[o]})`,etiqueta2:`Kilos en crudo (${a[o+1]})`})}this.medidasUnicas=Array.from(e.values())},obtenerTotalEmbarcado(e){if(!this.embarqueData||!this.embarqueData.clientes)return 0;if(e.includes("-")&&e.endsWith("mix")){const[t,a]=e.split("-").map(e=>e.trim()),o=this.calcularTotalParaMedida(t+" mix"),r=this.calcularTotalParaMedida(a.replace(" mix","")+" mix");return o+r}return this.calcularTotalParaMedida(e)},calcularTotalParaMedida(e){const t=e.includes("Maquila Ozuna"),a=e.replace(" Maquila Ozuna","").toLowerCase().trim();return this.embarqueData.clientes.reduce((e,o)=>e+o.productos.filter(e=>!!e.medida&&(t?e.medida.toLowerCase().trim()===a&&"Ozuna"===o.nombre&&!e.esVenta:e.medida.toLowerCase().trim()===a&&("Ozuna"!==o.nombre||e.esVenta))).reduce((e,t)=>{if("c/h20"===t.tipo){const a=this.calcularTotalBolsas(t),o=parseFloat(t.camaronNeto)||.65;return e+a*o}{const a=t.kilos.reduce((e,t)=>e+(Number(t)||0),0),o=this.calcularTotalTaras(t),r=t.restarTaras?3*o:0;return e+(a-r)}},0),0)},obtenerTotalParaRendimiento(e){if(!this.embarqueData||!this.embarqueData.clientes)return 0;const t=e.toLowerCase(),a=this.embarqueData.clientes.flatMap(e=>e.productos.filter(e=>e.medida&&e.medida.toLowerCase()===t)),o=a.some(e=>"c/h20"===e.tipo);return o?this.obtenerTotalEmbarcado(e):this.obtenerTotalReal(e)},obtenerTotalReal(e){if(!this.embarqueData||!this.embarqueData.clientes)return 0;const t=e.includes("Maquila Ozuna"),a=e.replace(" Maquila Ozuna","").toLowerCase().trim();return this.embarqueData.clientes.reduce((e,o)=>e+o.productos.filter(e=>!!e.medida&&(t?e.medida.toLowerCase().trim()===a&&"Ozuna"===o.nombre&&!e.esVenta:e.medida.toLowerCase().trim()===a&&("Ozuna"!==o.nombre||e.esVenta))).reduce((e,t)=>e+this.calcularTotalKilos(t),0),0)},calcularTotalKilos(e){if(!e.kilos)return 0;const t=e.kilos.reduce((e,t)=>e+(Number(t)||0),0),a=(e.taras||[]).reduce((e,t)=>e+(Number(t)||0),0),o=e.restarTaras?3*a:0;return t-o},calcularTotalTaras(e){const t=(e.taras||[]).reduce((e,t)=>e+(Number(t)||0),0),a=(e.tarasExtra||[]).reduce((e,t)=>e+(Number(t)||0),0);return t+a},calcularTotalBolsas(e){const t=e.reporteTaras||[],a=e.reporteBolsas||[];let o=0;for(let r=0;r<t.length;r++){const e=parseInt(t[r])||0,i=parseInt(a[r])||0;o+=e*i}return o},calcularRendimiento(e){const t=this.obtenerTotalEmbarcado(e);if(0===t)return 0;let a;var o,r;this.esMedidaMix(e)?a=Number((null===(o=this.kilosCrudos[e])||void 0===o?void 0:o.medida1)||0)+Number((null===(r=this.kilosCrudos[e])||void 0===r?void 0:r.medida2)||0):a=Number(this.kilosCrudos[e]||0);const i=a/t;return this.guardarCambiosEnTiempoReal(),i},getRendimiento(e){return this.calcularRendimiento(e)||0},volverAEmbarque(){this.$router.push({name:"EditarEmbarque",params:{id:this.$route.params.id}})},esMedidaMix(e){return e.toLowerCase().includes("mix")},obtenerEtiqueta(e,t){return this.kilosCrudos[e]?"medida1"===t?this.kilosCrudos[e].etiqueta1||"Kilos en crudo (Medida 1)":this.kilosCrudos[e].etiqueta2||"Kilos en crudo (Medida 2)":"medida1"===t?"Kilos en crudo (Medida 1)":"Kilos en crudo (Medida 2)"},editarEtiqueta(e,t){this.kilosCrudos[e]||this.$set(this.kilosCrudos,e,{medida1:0,medida2:0,etiqueta1:"Kilos en crudo (Medida 1)",etiqueta2:"Kilos en crudo (Medida 2)"});const a="medida1"===t?this.kilosCrudos[e].etiqueta1:this.kilosCrudos[e].etiqueta2,o=prompt("Ingrese el nuevo nombre para la medida:",a);null!==o&&("medida1"===t?this.$set(this.kilosCrudos[e],"etiqueta1",o):this.$set(this.kilosCrudos[e],"etiqueta2",o),this.guardarCambiosEnTiempoReal())},generarPDF(){var e;const t=Object.values(this.costosPorMedida).some(e=>Number(e)>0),a=this.medidasUnicas.filter(e=>!this.medidaOculta[e]).map(e=>{let t;var a,o;this.esMedidaMix(e)?t={medida1:Number((null===(a=this.kilosCrudos[e])||void 0===a?void 0:a.medida1)||0),medida2:Number((null===(o=this.kilosCrudos[e])||void 0===o?void 0:o.medida2)||0)}:t=Number(this.kilosCrudos[e]||0);const r=Number(this.costosPorMedida[e])||0,i=this.getRendimiento(e),s=r>0?(r*i+20).toFixed(1):null;return{medida:e,kilosCrudos:t,totalEmbarcado:this.obtenerTotalEmbarcado(e),rendimiento:i,costo:r,costoFinal:s}}),o={...this.embarqueData,notaRendimientos:(null===(e=this.embarqueData)||void 0===e?void 0:e.notaRendimientos)||"",mostrarColumnaCosto:t};Object(n["a"])(a,o)},obtenerNombreMedidaPersonalizado(e){return this.nombresMedidasPersonalizados[e]||e},async editarNombreMedida(e){const t=this.obtenerNombreMedidaPersonalizado(e),a=prompt("Ingrese el nuevo nombre para la medida:",t);if(null!==a&&""!==a.trim()){this.$set(this.nombresMedidasPersonalizados,e,a.trim());try{const e=Object(i["h"])(),t=this.$route.params.id,a=Object(i["e"])(e,"embarques",t);await Object(i["r"])(a,{nombresMedidasPersonalizados:this.nombresMedidasPersonalizados}),console.log("Nombre de medida actualizado correctamente")}catch(o){console.error("Error al guardar el nuevo nombre:",o)}}},abrirModalNota(){var e;this.nota=(null===(e=this.embarqueData)||void 0===e?void 0:e.notaRendimientos)||"",this.mostrarModal=!0},async guardarNota(){try{const e=Object(i["h"])(),t=this.$route.params.id,a=Object(i["e"])(e,"embarques",t);await Object(i["r"])(a,{notaRendimientos:this.nota}),this.embarqueData.notaRendimientos=this.nota,this.cerrarModal(),console.log("Nota guardada correctamente")}catch(e){console.error("Error al guardar la nota:",e)}},cerrarModal(){this.mostrarModal=!1,this.nota=""},async guardarEstadoOculto(){try{const e=Object(i["h"])(),t=this.$route.params.id,a=Object(i["e"])(e,"embarques",t);await Object(i["r"])(a,{medidaOculta:this.medidaOculta}),console.log("Estado de ocultaci칩n guardado correctamente")}catch(e){console.error("Error al guardar estado de ocultaci칩n:",e)}},abrirModalCostos(){this.showCostosModal=!0},async guardarCostos(e){try{const t=Object(i["h"])(),a=this.$route.params.id;Object(i["e"])(t,"embarques",a);this.costosPorMedida=e,console.log("Costos actualizados correctamente")}catch(t){console.error("Error al actualizar los costos:",t)}},calcularCostoFinal(e){const t=Number(this.costosPorMedida[e])||0,a=Number(this.getRendimiento(e).toFixed(2)),o=t*a+20;return o.toFixed(1)},rendimientosPorMedida(){return this.medidasUnicas.reduce((e,t)=>(e[t]=this.getRendimiento(t),e),{})},async iniciarEscuchaPreciosGlobales(){try{const e=Object(i["h"])(),t=Object(i["c"])(e,"precios_globales"),a=Object(i["o"])(t,Object(i["l"])("timestamp","desc"));this.unsubscribePreciosGlobales=Object(i["k"])(a,e=>{const t={};e.forEach(e=>{const a=e.data();(!t[a.medida]||new Date(a.fecha)>new Date(t[a.medida].fecha))&&(t[a.medida]=a.costoBase)}),this.costosPorMedida=t})}catch(e){console.error("Error al iniciar escucha de precios globales:",e)}}},watch:{kilosCrudos:{handler(){this.guardarCambiosEnTiempoReal()},deep:!0}},beforeDestroy(){this.unsubscribePreciosGlobales&&this.unsubscribePreciosGlobales(),this.guardarCambiosEnTiempoReal.cancel&&this.guardarCambiosEnTiempoReal.cancel()}},l=d,u=(a("dc98"),a("2877")),m=Object(u["a"])(l,o,r,!1,null,"7e5e8ec2",null);t["default"]=m.exports},"50c7":function(e,t,a){"use strict";a("9ff0")},"9ff0":function(e,t,a){},b34e:function(e,t,a){"use strict";var o=function(){var e=this,t=e._self._c;return t("div",{staticClass:"lista-embarques"},[e.cargando?t("div",{staticClass:"cargando"},[e._v("Cargando embarques...")]):e.error?t("div",{staticClass:"error"},[e._v(e._s(e.error))]):t("div",[e.embarques.length>0?t("table",{staticClass:"tabla-embarques"},[e._m(0),t("tbody",e._l(e.embarques,(function(a){return t("tr",{key:a.id,class:{"fila-bloqueada":a.embarqueBloqueado}},[t("td",[e._v(" "+e._s(e.formatearFecha(a.fecha))+" "),a.embarqueBloqueado?t("span",{staticClass:"indicador-bloqueado",attrs:{title:"Este embarque est치 bloqueado"}},[e._v("游")]):e._e()]),t("td",[e._v(e._s(e.calcularKilosLimpios(a))+" kg")]),t("td",[e._v(e._s(e.calcularKilosCrudos(a))+" kg")]),t("td",[e._v(e._s((Number(e.calcularKilosLimpios(a))+Number(e.calcularKilosCrudos(a))).toFixed(1))+" kg")]),t("td",[e._v(e._s(e.calcularTotalTaras(a)))]),t("td",[t("button",{staticClass:"btn-detalles",on:{click:function(t){return e.editarEmbarque(a.id)}}},[e._v("Editar")]),t("button",{staticClass:"btn-eliminar",class:{"btn-deshabilitado":a.embarqueBloqueado},attrs:{title:a.embarqueBloqueado?"Este embarque est치 bloqueado y no puede ser eliminado":""},on:{click:function(t){a.embarqueBloqueado?e.mostrarMensajeBloqueado():e.eliminarEmbarque(a.id)}}},[e._v("Eliminar")])])])})),0)]):t("div",{staticClass:"sin-embarques"},[e._v("No hay embarques registrados.")])])])},r=[function(){var e=this,t=e._self._c;return t("thead",[t("tr",[t("th",[e._v("Fecha")]),t("th",[e._v("Kilos Limpios")]),t("th",[e._v("Kilos Crudos")]),t("th",[e._v("Total Kilos")]),t("th",[e._v("Total Taras")]),t("th",[e._v("Acciones")])])])}],i=(a("14d9"),a("13d5"),a("1494")),s={name:"ListaEmbarques",data(){return{embarques:[],cargando:!0,error:null}},methods:{async cargarEmbarques(){try{const t=Object(i["h"])(),a=Object(i["c"])(t,"embarques"),o=await Object(i["g"])(a),r={};o.docs.forEach(e=>{const t=e.data();let a;if(t.fecha&&"function"===typeof t.fecha.toDate)a=t.fecha.toDate();else if(t.fecha instanceof Date)a=t.fecha;else{if("string"!==typeof t.fecha)return void(r[e.id]=[{id:e.id,data:t}]);a=new Date(t.fecha)}const o=a.toISOString().split("T")[0];r[o]||(r[o]=[]),r[o].push({id:e.id,data:t,fecha:a})});const s=[];for(const e in r)if(r[e].length>1){console.warn(`Se encontraron ${r[e].length} embarques con la fecha ${e}`),r[e].sort((e,t)=>{const a=e.data.clientes?e.data.clientes.reduce((e,t)=>e+(t.productos?t.productos.length:0),0):0,o=t.data.clientes?t.data.clientes.reduce((e,t)=>e+(t.productos?t.productos.length:0),0):0;return o-a});for(let t=1;t<r[e].length;t++)s.push(r[e][t].id)}if(s.length>0){console.warn(`Se eliminar치n ${s.length} embarques duplicados`);for(const a of s)try{await Object(i["d"])(Object(i["e"])(t,"embarques",a)),console.log(`Embarque duplicado con ID ${a} eliminado correctamente`)}catch(e){console.error(`Error al eliminar embarque duplicado con ID ${a}:`,e)}if(s.length>0)return this.cargarEmbarques()}const n=[];for(const e in r)if(r[e].length>0){const t=r[e][0];let a=!1;void 0!==t.data.embarqueBloqueado&&("boolean"===typeof t.data.embarqueBloqueado?a=t.data.embarqueBloqueado:"string"===typeof t.data.embarqueBloqueado?a=["true","1","si","yes","verdadero"].includes(t.data.embarqueBloqueado.toLowerCase()):"number"===typeof t.data.embarqueBloqueado&&(a=0!==t.data.embarqueBloqueado)),n.push({id:t.id,...t.data,embarqueBloqueado:a})}this.embarques=n.sort((e,t)=>{const a=e.fecha.toDate?e.fecha.toDate():new Date(e.fecha),o=t.fecha.toDate?t.fecha.toDate():new Date(t.fecha);return o-a}),this.cargando=!1}catch(e){console.error("Error al cargar los embarques:",e),this.error="Hubo un error al cargar los embarques. Por favor, intente de nuevo m치s tarde.",this.cargando=!1}},formatearFecha(e){if(!e)return"Fecha no disponible";const t=e.toDate?e.toDate():new Date(e);return t.setDate(t.getDate()+1),t.toLocaleDateString("es-ES")},calcularTotalKilos(e){let t=0;return e.clientes.forEach(e=>{e.productos.forEach(e=>{if("c/h20"===e.tipo){const a=e.reporteTaras||[],o=e.reporteBolsas||[];let r=0;for(let e=0;e<a.length;e++){const t=parseInt(a[e])||0,i=parseInt(o[e])||0;r+=t*i}const i=r*(e.camaronNeto||.65);t+=i}else{const a=(e.kilos||[]).reduce((e,t)=>e+(Number(t)||0),0),o=this.calcularTotalTarasProducto(e),r=e.restarTaras?3*o:0;t+=a-r}})}),t.toFixed(1)},calcularTotalTaras(e){let t=0;const a=["OTILIO","JOSELITO","CATARRO","OZUNA","CANELO"];return e.clientes.forEach(e=>{a.includes(e.nombre.toUpperCase())&&(e.productos.forEach(e=>{t+=this.calcularTotalTarasProducto(e)}),e.crudos&&Array.isArray(e.crudos)&&e.crudos.forEach(e=>{e&&e.items&&Array.isArray(e.items)&&e.items.forEach(e=>{if(e.taras){const[a]=e.taras.split("-").map(Number);t+=a||0}if(e.sobrante){const[a]=e.sobrante.split("-").map(Number);t+=a||0}})}))}),t},calcularTotalTarasProducto(e){const t=(e.taras||[]).reduce((e,t)=>e+(Number(t)||0),0),a=(e.tarasExtra||[]).reduce((e,t)=>e+(Number(t)||0),0);return t+a},verDetalles(e){console.log("Navegando a detalles del embarque:",e),this.$router.push({name:"DetallesEmbarque",params:{id:e}})},editarEmbarque(e){this.$router.push({name:"NuevoEmbarque",params:{id:e}})},regresarAMenu(){this.$router.push({name:"EmbarquesMenu"})},async eliminarEmbarque(e){const t=this.embarques.find(t=>t.id===e);if(t&&t.embarqueBloqueado)alert("Este embarque est치 bloqueado y no puede ser eliminado.");else if(confirm("쮼st치s seguro de que quieres eliminar este embarque?"))try{const t=Object(i["h"])();await Object(i["d"])(Object(i["e"])(t,"embarques",e)),this.embarques=this.embarques.filter(t=>t.id!==e),alert("Embarque eliminado con 칠xito")}catch(a){console.error("Error al eliminar el embarque:",a),alert("Hubo un error al eliminar el embarque. Por favor, intente de nuevo.")}},calcularKilosLimpios(e){let t=0;return e.clientes.forEach(e=>{e.productos.forEach(e=>{if("c/h20"===e.tipo){const a=e.reporteTaras||[],o=e.reporteBolsas||[];let r=0;for(let e=0;e<a.length;e++){const t=parseInt(a[e])||0,i=parseInt(o[e])||0;r+=t*i}const i=r*(e.camaronNeto||.65);t+=i}else{const a=(e.kilos||[]).reduce((e,t)=>e+(Number(t)||0),0),o=this.calcularTotalTarasProducto(e),r=e.restarTaras?3*o:0;t+=a-r}})}),t.toFixed(1)},calcularKilosCrudos(e){let t=0;return e.clientes.forEach(e=>{e.crudos&&Array.isArray(e.crudos)&&e.crudos.forEach(e=>{e&&e.items&&Array.isArray(e.items)&&e.items.forEach(e=>{if(e.taras){const a=/^(\d+)-(\d+)$/.exec(e.taras);if(a){const e=parseInt(a[1])||0;let o=parseInt(a[2])||0;19===o&&(o=20),t+=(e||0)*(o||0)}else{const[a,o]=e.taras.split("-").map(Number);t+=(a||0)*(o||0)}}if(e.sobrante){const a=/^(\d+)-(\d+)$/.exec(e.sobrante);if(a){const e=parseInt(a[1])||0;let o=parseInt(a[2])||0;19===o&&(o=20),t+=(e||0)*(o||0)}else{const[a,o]=e.sobrante.split("-").map(Number);t+=(a||0)*(o||0)}}})})}),t.toFixed(1)},mostrarMensajeBloqueado(){alert("Este embarque est치 bloqueado y no puede ser eliminado.")}},mounted(){this.cargarEmbarques()},created(){this.$nextTick(()=>{setTimeout(()=>{},1e3)})}},n=s,c=(a("50c7"),a("2877")),d=Object(c["a"])(n,o,r,!1,null,"54296ffe",null);t["a"]=d.exports},c12b:function(e,t,a){},dc98:function(e,t,a){"use strict";a("ecde")},ecde:function(e,t,a){},f458:function(e,t,a){"use strict";var o=function(){var e,t,a,o,r,i,s=this,n=s._self._c;return n("div",{staticClass:"nuevo-embarque-container"},[n("Sidebar",{attrs:{embarque:s.embarque,clientesPredefinidos:s.clientesPredefinidos,clientesPersonalizadosEmbarque:s.clientesPersonalizadosEmbarque,clienteCrudos:s.clienteCrudos,clienteActivo:s.clienteActivo},on:{"seleccionar-cliente":function(e){s.clienteActivo=e},"toggle-sidebar":function(e){s.sidebarCollapsed=e},"mostrar-modal-nuevo-cliente":function(e){s.mostrarModalNuevoCliente=!0}}}),n("div",{staticClass:"nuevo-embarque",class:{"sidebar-collapsed":s.sidebarCollapsed}},[n("header-embarque",{attrs:{"modo-edicion":s.modoEdicion,"embarque-bloqueado":s.embarqueBloqueado,embarque:s.embarque,"is-generating-pdf":s.isGeneratingPdf,"pdf-type":s.pdfType,"embarque-id":s.embarqueId},on:{volver:s.volverAEmbarquesMenu,"toggle-bloqueo":s.toggleBloqueo,"update:fecha":function(e){s.embarque.fecha=e},"update:cargaCon":function(e){s.embarque.cargaCon=e},"generar-taras":function(e){return s.generarPDF("taras")},"generar-resumen":function(e){return s.generarPDF("resumen")},"verificar-fecha":s.verificarFechaExistente}}),n("div",{staticClass:"botones-undo-redo"},[n("button",{staticClass:"btn btn-secondary btn-sm",attrs:{type:"button",disabled:s.undoStack.length<=1},on:{click:s.undo}},[s._v(" Deshacer ")]),n("button",{staticClass:"btn btn-secondary btn-sm",attrs:{type:"button",disabled:0===s.redoStack.length},on:{click:s.redo}},[s._v(" Rehacer ")])]),n("form",{on:{submit:function(e){return e.preventDefault(),s.guardarEmbarque.apply(null,arguments)},keydown:function(e){if(!e.type.indexOf("key")&&s._k(e.keyCode,"enter",13,e.key,"Enter"))return null;e.preventDefault()}}},s._l(s.productosPorCliente,(function(e,t){return n("ClienteProductos",{key:t,attrs:{"cliente-id":t,productos:e,crudos:s.clienteCrudos[t]||[],"clientes-juntar-medidas":s.clientesJuntarMedidas,"nombre-cliente":s.obtenerNombreCliente(t),"cliente-activo":s.clienteActivo,"embarque-bloqueado":s.embarqueBloqueado,"medidas-usadas":s.medidasUsadas,"is-generating-pdf":s.isGeneratingPdf,"pdf-type":s.pdfType,"is-creating-account":s.isCreatingAccount},on:{"update:productos":function(e){return s.actualizarProductosCliente(t,e)},"update:crudos":function(e){return s.actualizarCrudosCliente(t,e)},"juntarMedidas-change":s.handleJuntarMedidasChange,"eliminar-cliente":s.eliminarCliente,"eliminar-producto":s.eliminarProducto,"eliminar-crudo":s.eliminarCrudo,"eliminar-crudo-item":s.eliminarCrudoItem,"agregar-producto":s.agregarProducto,"agregar-crudo":s.agregarCrudo,"agregar-crudo-item":s.agregarCrudoItem,"toggle-sobrante":s.toggleSobrante,"mostrar-modal-precio":s.abrirModalPrecio,"mostrar-modal-hilos":s.abrirModalHilos,"mostrar-modal-nota":s.abrirModalNota,"mostrar-modal-nombre-alternativo":s.abrirModalNombreAlternativo,"mostrar-modal-alt":s.abrirModalAlt,"seleccionar-medida":s.seleccionarMedida,"generar-pdf":s.generarPDF,"crear-cuenta-joselito":s.crearCuentaJoselito,"crear-cuenta-catarro":s.crearCuentaCatarro,"crear-cuenta-ozuna":s.crearCuentaOzuna}})})),1)],1),n("NuevoClienteModal",{attrs:{mostrar:s.mostrarModalNuevoCliente},on:{cerrar:function(e){s.mostrarModalNuevoCliente=!1},agregar:s.agregarNuevoCliente}}),n("NombreAlternativoModal",{attrs:{mostrar:s.mostrarModalNombreAlternativo,"nombre-original":(null===(e=s.productoSeleccionado)||void 0===e?void 0:e.medida)||"","nombre-alternativo":(null===(t=s.productoSeleccionado)||void 0===t?void 0:t.nombreAlternativoPDF)||""},on:{cerrar:function(e){s.mostrarModalNombreAlternativo=!1},guardar:s.guardarNombreAlternativo}}),n("PrecioModal",{attrs:{mostrar:s.mostrarModalPrecio,precio:(null===(a=s.itemSeleccionado)||void 0===a?void 0:a.precio)||""},on:{cerrar:s.cerrarModalPrecio,guardar:s.guardarPrecio}}),n("HilosModal",{attrs:{mostrar:s.mostrarModalHilos,hilos:(null===(o=s.itemSeleccionado)||void 0===o?void 0:o.hilos)||""},on:{cerrar:s.cerrarModalHilos,guardar:s.guardarHilos}}),n("NotaModal",{attrs:{mostrar:s.mostrarModalNota,nota:(null===(r=s.itemSeleccionado)||void 0===r?void 0:r.nota)||""},on:{cerrar:s.cerrarModalNota,guardar:s.guardarNota}}),n("AltModal",{attrs:{mostrar:s.mostrarModalAlt,alt:(null===(i=s.itemSeleccionado)||void 0===i?void 0:i.textoAlternativo)||""},on:{cerrar:s.cerrarModalAlt,guardar:s.guardarAlt}})],1)},r=[],i=(a("14d9"),a("88e6"),a("70cc"),a("eb03"),a("22e5c"),a("c01e"),a("fa76"),a("8306"),a("1494")),s=a("2ef0"),n=a("7c01"),c=a("dc59"),d=a("f549"),l=a("2b0e"),u=a("5ea5"),m=a("fdb2"),h=a("e7ae"),b=a("ad72"),p=a("b9b6"),f=a("e7e0"),g=a("eb99"),q=a("57d4"),C=a("6123"),v=a("c005"),E=a("6d00"),M=a("c0b0"),S=a("fa40");const O=Object(l["defineAsyncComponent"])(()=>Promise.resolve().then(a.bind(null,"4dc0")));var P={mixins:[h["a"],b["a"]],name:"NuevoEmbarque",components:{Rendimientos:O,Sidebar:u["a"],HeaderEmbarque:m["a"],ClienteProductos:p["a"],NuevoClienteModal:g["a"],NombreAlternativoModal:q["a"],PrecioModal:C["a"],HilosModal:v["a"],NotaModal:E["a"],AltModal:M["a"]},setup(){const e=Object(d["a"])();return{authStore:e}},data(){return{usuariosActivos:[],clientesJuntarMedidas:{},clientesPredefinidos:f["a"],clientesPersonalizados:[],ultimoIdPersonalizado:0,embarque:{fecha:null,cargaCon:"",productos:[],crudos:[]},nuevoClienteId:"",undoStack:[],redoStack:[],isUndoRedo:!1,cambios:[],producto:{reporteTaras:[],reporteBolsas:[]},embarqueId:null,modoEdicion:!1,guardadoAutomaticoActivo:!1,clienteCrudos:{},unsubscribe:null,medidasSugeridas:[],medidasUsadas:[],mostrarSugerencias:!1,sugerenciasMedidas:[],mostrarModalNuevoCliente:!1,nuevoClienteNombre:"",nuevoClienteColor:"#007bff",mostrarModalNombreAlternativo:!1,nombreAlternativoTemp:"",productoSeleccionado:null,mostrarModalPrecio:!1,precioTemp:"",itemSeleccionado:null,mostrarModalHilos:!1,hilosTemp:"",mostrarModalNota:!1,notaTemp:"",mostrarModalAlt:!1,altTemp:"",clientesOffsets:{},embarqueBloqueado:!1,clienteActivo:null,sidebarCollapsed:!1,isGeneratingPdf:!1,pdfType:null,isCreatingAccount:!1,_creandoEmbarque:!1,_guardandoEmbarque:!1}},computed:{clientesDisponibles(){const e=new Set,t=this.clientesPredefinidos.filter(t=>!e.has(t.nombre)&&(e.add(t.nombre),!0)),a=this.clientesPersonalizados.filter(t=>!e.has(t.nombre)&&(e.add(t.nombre),!0));return[...t,...a,{id:"otro",nombre:"Otro",key:"otro"}]},productosPorCliente(){console.log("Calculando productosPorCliente. Contenido de embarque.productos:",this.embarque.productos);const e={};return this.embarque.productos.forEach(t=>{const a=t.clienteId;e[a]||(e[a]=[]),e[a].push(t),t.isEditing||e[a].sort((e,t)=>e.medida&&e.tipo&&t.medida&&t.tipo?this.compararMedidas(t.medida,e.medida):e.medida&&e.tipo?t.medida&&t.tipo?0:-1:1)}),e},clientesPersonalizadosEmbarque(){const e=Object.keys(this.productosPorCliente),t=this.clientesPredefinidos.map(e=>e.id.toString());return this.clientesPersonalizados.filter(a=>e.includes(a.id.toString())&&!t.includes(a.id.toString()))}},methods:{actualizarProductosCliente(e,t){this.embarque.productos=this.embarque.productos.filter(t=>t.clienteId!==e),this.embarque.productos=[...this.embarque.productos,...t],this.guardadoAutomaticoActivo&&this.embarqueId&&this.guardarCambiosEnTiempoReal()},actualizarCrudosCliente(e,t){this.$set(this.clienteCrudos,e,t),this.guardadoAutomaticoActivo&&this.embarqueId&&this.guardarCambiosEnTiempoReal()},agregarProducto(e){const t=Object(f["c"])(e);this.setTipoDefaultParaCliente(t),t.nombreCliente=this.obtenerNombreCliente(e),this.embarque.productos.push(t),!this.guardadoAutomaticoActivo&&this.embarqueId&&(this.guardadoAutomaticoActivo=!0),this.embarqueId&&this.guardarCambiosEnTiempoReal(),this.actualizarMedidasUsadas(),this.$nextTick(()=>{const e=document.querySelectorAll(".medida-input"),a=Array.from(e).find(e=>{var a;const o=null===(a=e.closest(".producto"))||void 0===a||null===(a=a.dataset)||void 0===a?void 0:a.productoId;return o===String(t.id)});a&&a.focus()})},eliminarProducto(e){const t=this.embarque.productos.indexOf(e);if(t>-1){const a=e.clienteId;this.embarque.productos.splice(t,1);const o=this.embarque.productos.some(e=>e.clienteId===a);if(!o){const e=Object(f["c"])(a);this.setTipoDefaultParaCliente(e),e.nombreCliente=this.obtenerNombreCliente(a),this.embarque.productos.push(e),this.embarqueId&&this.guardarCambiosEnTiempoReal()}}},async agregarClienteProducto(){const e=this.mostrarModalPrecio||this.mostrarModalHilos||this.mostrarModalNota||this.mostrarModalAlt||this.mostrarModalNombreAlternativo||this.mostrarModalNuevoCliente;if(!e)if(this.embarque.fecha){if("otro"===this.nuevoClienteId){const e=prompt("Ingrese el nombre del nuevo cliente:");if(e&&""!==e.trim()){this.ultimoIdPersonalizado++;const t="personalizado_"+this.ultimoIdPersonalizado,a={id:t,nombre:e.trim(),editable:!0,personalizado:!0};this.clientesPersonalizados.push(a),await this.guardarEmbarqueInicial(t)}}else this.nuevoClienteId&&await this.guardarEmbarqueInicial(this.nuevoClienteId);this.nuevoClienteId=""}else alert("Por favor, seleccione una fecha para el embarque.")},async guardarEmbarqueInicial(e){const t=this.mostrarModalPrecio||this.mostrarModalHilos||this.mostrarModalNota||this.mostrarModalAlt||this.mostrarModalNombreAlternativo||this.mostrarModalNuevoCliente;if(t)return null;if(this._creandoEmbarque)return console.warn("Ya hay una operaci칩n de creaci칩n de embarque en curso"),null;this._creandoEmbarque=!0;try{if(this.embarqueId)return this.agregarProducto(e),this.clienteActivo=e,this._creandoEmbarque=!1,this.embarqueId;{const o=Object(i["h"])();try{const t=new Date(this.embarque.fecha),r=t.toISOString().split("T")[0],s=Object(i["c"])(o,"embarques"),n=await Object(i["g"])(s),c=n.docs.filter(e=>{const t=e.data();let a;if(t.fecha&&"function"===typeof t.fecha.toDate)a=t.fecha.toDate();else if(t.fecha instanceof Date)a=t.fecha;else{if("string"!==typeof t.fecha)return!1;a=new Date(t.fecha)}const o=a.toISOString().split("T")[0];return o===r&&e.id!==this.embarqueId});if(c.length>0)return alert("Ya existe un embarque para la fecha seleccionada. Por favor, seleccione otra fecha."),this._creandoEmbarque=!1,null;const d=Object(i["e"])(o,"reservas_fechas",r);await Object(i["q"])(d,{fecha:r,timestamp:Object(i["p"])(),usuario:this.authStore.userId||"an칩nimo","expiraci칩n":new Date(Date.now()+6e4)});const l=this.prepararDatosEmbarque(),u=await Object(i["b"])(Object(i["c"])(o,"embarques"),l);try{await Object(i["d"])(d)}catch(a){console.error("Error al eliminar la reserva de fecha:",a)}return this.embarqueId=u.id,this.modoEdicion=!0,this.guardadoAutomaticoActivo=!0,this.agregarProducto(e),this.clienteActivo=e,this._creandoEmbarque=!1,this.embarqueId}catch(a){return this._creandoEmbarque=!1,console.error("Error al crear el embarque inicial:",a),t||alert("Hubo un error al crear el embarque. Por favor, intente nuevamente."),null}}}catch(a){return this._creandoEmbarque=!1,console.error("Error inesperado en guardarEmbarqueInicial:",a),null}},eliminarCliente(e){this.embarque.productos=this.embarque.productos.filter(t=>t.clienteId!==e),this.$forceUpdate(),this.cambios.push(`Cliente ${this.obtenerNombreCliente(e)} eliminado`)},obtenerNombreCliente(e){const t=this.clientesDisponibles.find(t=>t.id.toString()===e.toString());if(t)return t.nombre;const a=this.embarque.productos.find(t=>t.clienteId.toString()===e.toString());return a?a.nombreCliente:"Cliente Desconocido"},editarNombreCliente(e){const t=this.clientesDisponibles.find(t=>t.id===e);if(t&&t.editable){const a=prompt("Ingrese el nuevo nombre del cliente:",t.nombre);null!==a&&""!==a.trim()&&(t.nombre=a.trim(),this.embarque.productos.forEach(t=>{t.clienteId===e&&(t.nombreCliente=a.trim())}))}},async cargarEmbarque(e){if("nuevo"===e)return void this.resetearEmbarque();const t=Object(i["h"])(),a=Object(i["e"])(t,"embarques",e);this.unsubscribe=Object(i["k"])(a,t=>{if(t.exists()){const a=t.data();let o;this.embarqueBloqueado=a.embarqueBloqueado||!1,a.clientesJuntarMedidas?this.clientesJuntarMedidas=a.clientesJuntarMedidas:(this.clientesJuntarMedidas={},a.clientes.forEach(e=>{this.$set(this.clientesJuntarMedidas,e.id,!1)})),a.fecha&&"function"===typeof a.fecha.toDate?o=a.fecha.toDate():a.fecha instanceof Date?o=a.fecha:"string"===typeof a.fecha?o=new Date(a.fecha):(console.warn("Formato de fecha no reconocido, usando la fecha actual"),o=new Date);const r=new Map(this.clientesPredefinidos.map(e=>[e.id,e]));this.clientesPersonalizados=a.clientes.filter(e=>!r.has(e.id)).map(e=>({id:e.id,nombre:e.nombre,editable:!0,personalizado:!0,key:"personalizado_"+e.id})),this.embarque={fecha:o.toISOString().split("T")[0],cargaCon:a.cargaCon||"",productos:a.clientes.flatMap(e=>{const t=r.get(e.id)||e;return e.productos.map(a=>({...a,clienteId:e.id,nombreCliente:t.nombre,restarTaras:a.restarTaras||!1}))}),kilosCrudos:a.kilosCrudos||{}};const i=a.clientes.map(e=>e.id.toString());i.forEach(e=>{const t=this.embarque.productos.some(t=>t.clienteId.toString()===e);if(!t){const t=Object(f["c"])(e),o=r.get(parseInt(e))||a.clientes.find(t=>t.id.toString()===e);t.nombreCliente=o?o.nombre:"Cliente Desconocido",this.setTipoDefaultParaCliente(t),this.embarque.productos.push(t),console.log(`Se ha creado un producto para el cliente ${t.nombreCliente} que no ten칤a ninguno.`)}}),this.clienteCrudos={},a.clientes.forEach(e=>{e.crudos&&e.crudos.length>0&&this.$set(this.clienteCrudos,e.id,e.crudos)}),this.embarqueId=e,this.modoEdicion=!0,this.guardadoAutomaticoActivo=!0}else localStorage.removeItem("embarque"),localStorage.removeItem("ultimoEmbarqueId"),localStorage.removeItem("ultimaRuta"),alert("El embarque no existe o est치 corrupto. Se reiniciar치 el formulario para evitar errores."),this.resetearEmbarque()},e=>{console.error("Error al escuchar cambios del embarque:",e)})},async resetearEmbarque(){const e=this.mostrarModalPrecio||this.mostrarModalHilos||this.mostrarModalNota||this.mostrarModalAlt||this.mostrarModalNombreAlternativo||this.mostrarModalNuevoCliente;if(e)return;const t=performance&&performance.navigation&&1===performance.navigation.type;if(t&&localStorage.getItem("ultimoEmbarqueId"))return void console.log("Recarga detectada con ID existente, no creando un nuevo embarque");const a=(new Date).toISOString().split("T")[0];try{const e=Object(i["h"])(),o=Object(i["c"])(e,"embarques"),r=await Object(i["g"])(o),s={};r.docs.forEach(e=>{const t=e.data();let a;if(t.fecha&&"function"===typeof t.fecha.toDate)a=t.fecha.toDate();else if(t.fecha instanceof Date)a=t.fecha;else{if("string"!==typeof t.fecha)return;a=new Date(t.fecha)}const o=a.toISOString().split("T")[0];s[o]||(s[o]=[]),s[o].push({id:e.id,fecha:o,data:e.data()})});const n=s[a]||[];let c=a;if(n.length>0){let e=new Date(a),o=!1;for(let t=1;t<=7&&!o;t++){e.setDate(e.getDate()+1);const t=e.toISOString().split("T")[0];s[t]&&0!==s[t].length||(o=!0,c=t)}if(!o)return console.warn("No se encontr칩 una fecha disponible en los pr칩ximos 7 d칤as"),this.embarque={fecha:a,cargaCon:"",productos:[]},this.clientesJuntarMedidas={},this.embarqueId=null,this.modoEdicion=!1,this.guardadoAutomaticoActivo=!1,this.embarqueBloqueado=!1,this.clientesPersonalizados=[],void(t||alert("Ya existe un embarque para hoy y los pr칩ximos d칤as. Por favor, seleccione manualmente una fecha diferente."))}this.embarque={fecha:c,cargaCon:"",productos:[]},this.clientesJuntarMedidas={},this.embarqueId=null,this.modoEdicion=!1,this.guardadoAutomaticoActivo=!1,this.embarqueBloqueado=!1,this.clientesPersonalizados=[],this.$nextTick(async()=>{if(this.embarque.fecha)try{const t=Object(i["c"])(e,"embarques"),a=await Object(i["g"])(t),o=a.docs.some(e=>{const t=e.data();let a;if(t.fecha&&"function"===typeof t.fecha.toDate)a=t.fecha.toDate();else if(t.fecha instanceof Date)a=t.fecha;else{if("string"!==typeof t.fecha)return!1;a=new Date(t.fecha)}const o=a.toISOString().split("T")[0];return o===this.embarque.fecha});if(o)return console.warn("Se detect칩 un embarque con la misma fecha durante la inicializaci칩n"),void alert("Ya existe un embarque para la fecha seleccionada. Se cancelar치 la creaci칩n autom치tica.");await this.guardarEmbarqueInicial(this.clientesPredefinidos[0].id.toString()),await new Promise(e=>setTimeout(e,100));for(let e=1;e<this.clientesPredefinidos.length;e++){const t=this.clientesPredefinidos[e].id.toString(),a=this.embarque.productos.some(e=>e.clienteId.toString()===t);if(!a){const e=Object(f["c"])(t);this.setTipoDefaultParaCliente(e),this.embarque.productos.push(e),await new Promise(e=>setTimeout(e,50))}}this.clienteActivo=this.clientesPredefinidos[0].id.toString(),this.$forceUpdate(),this.guardarCambiosEnTiempoReal()}catch(t){console.error("Error al crear clientes predeterminados:",t)}})}catch(o){console.error("Error al verificar fechas de embarques existentes:",o),this.embarque={fecha:a,cargaCon:"",productos:[]},this.clientesJuntarMedidas={},this.embarqueId=null,this.modoEdicion=!1,this.guardadoAutomaticoActivo=!1,this.embarqueBloqueado=!1,this.clientesPersonalizados=[]}},guardarCambiosEnTiempoReal:Object(s["debounce"])((function(){if(!this.guardadoAutomaticoActivo||!this.embarqueId||this.mostrarModalPrecio||this.mostrarModalHilos||this.mostrarModalNota||this.mostrarModalAlt||this.mostrarModalNombreAlternativo||this.mostrarModalNuevoCliente)return;const e={...JSON.parse(JSON.stringify(this.prepararDatosEmbarque())),clientesJuntarMedidas:{...this.clientesJuntarMedidas}},t=Object(i["h"])();Object(i["r"])(Object(i["e"])(t,"embarques",this.embarqueId),e).then(()=>{console.log("Cambios guardados autom치ticamente:",(new Date).toLocaleString()),this.$emit("guardado-automatico")}).catch(e=>{console.error("Error al guardar autom치ticamente:",e)})}),2e3),async guardarEmbarque(){if(!this.embarque.fecha)return void alert("Por favor, seleccione una fecha para el embarque.");const e=this.mostrarModalPrecio||this.mostrarModalHilos||this.mostrarModalNota||this.mostrarModalAlt||this.mostrarModalNombreAlternativo||this.mostrarModalNuevoCliente;if(e)return;if(this._guardandoEmbarque)return void console.warn("Ya hay una operaci칩n de guardado en curso");this._guardandoEmbarque=!0;const t=this.prepararDatosEmbarque(),a=Object(i["h"])();try{if(this.modoEdicion)await Object(i["r"])(Object(i["e"])(a,"embarques",this.embarqueId),t),alert("Embarque actualizado exitosamente."),this._guardandoEmbarque=!1;else{const e=new Date(this.embarque.fecha),r=e.toISOString().split("T")[0],s=Object(i["c"])(a,"embarques"),d=await Object(i["g"])(s),l=d.docs.filter(e=>{const t=e.data();let a;if(t.fecha&&"function"===typeof t.fecha.toDate)a=t.fecha.toDate();else if(t.fecha instanceof Date)a=t.fecha;else{if("string"!==typeof t.fecha)return!1;a=new Date(t.fecha)}const o=a.toISOString().split("T")[0];return o===r});if(l.length>0)return alert("Ya existe un embarque para la fecha seleccionada. Por favor, seleccione otra fecha."),void(this._guardandoEmbarque=!1);const u=Object(i["e"])(a,"reservas_fechas",r);await Object(i["q"])(u,{fecha:r,timestamp:Object(i["p"])(),usuario:this.authStore.userId||"an칩nimo","expiraci칩n":new Date(Date.now()+6e4)});try{const e=await Object(i["b"])(Object(i["c"])(a,"embarques"),{...t,ultimaEdicion:{userId:this.authStore.userId,username:this.authStore.user.username,timestamp:Object(i["p"])()}}),r=Object(n["d"])(c["c"],"cambios/"+e.id);await Object(n["e"])(r,{tipo:"guardar",userId:this.authStore.userId,username:this.authStore.user.username,timestamp:Object(i["p"])()}),this.embarqueId=e.id,alert("Embarque creado exitosamente y guardado en la base de datos."),this.modoEdicion=!0}finally{try{await Object(i["d"])(u)}catch(o){console.error("Error al eliminar la reserva de fecha:",o)}this._guardandoEmbarque=!1}}this.guardadoAutomaticoActivo=!0,this.$router.push("/lista-embarques")}catch(o){this._guardandoEmbarque=!1,console.error("Error al guardar el embarque: ",o),alert("Hubo un error al guardar el embarque. Por favor, intente nuevamente.")}},prepararDatosEmbarque(){console.log("Preparando datos del embarque:",this.embarque);const e={fecha:new Date(this.embarque.fecha),cargaCon:this.embarque.cargaCon,clientes:[],clientesJuntarMedidas:this.clientesJuntarMedidas,embarqueBloqueado:this.embarqueBloqueado},t=new Map(this.clientesPredefinidos.map(e=>[e.id,e]));if(0===Object.keys(this.productosPorCliente).length&&this.clientesPredefinidos.length>0){const e=this.clientesPredefinidos[0].id.toString(),t=this.clientesPredefinidos[0],a=Object(f["c"])(e);a.nombreCliente=t.nombre,this.embarque.productos.push(a),this.clienteActivo=e,this.$forceUpdate()}const a=this.clientesDisponibles.filter(e=>"otro"!==e.id).map(e=>e.id.toString());return a.forEach(e=>{const a=this.embarque.productos.some(t=>t.clienteId.toString()===e);if(!a){const a=t.get(parseInt(e))||this.clientesDisponibles.find(t=>t.id.toString()===e);if(a){const t=Object(f["c"])(e);t.nombreCliente=a.nombre,this.setTipoDefaultParaCliente(t),this.embarque.productos.push(t),console.log(`Se ha creado un producto para el cliente ${t.nombreCliente} que no ten칤a ninguno.`)}}}),Object.entries(this.productosPorCliente).forEach(([a,o])=>{const r=t.get(parseInt(a)),i={id:a,nombre:r?r.nombre:this.obtenerNombreCliente(a),productos:o.map(e=>({...e,restarTaras:e.restarTaras||!1,noSumarKilos:e.noSumarKilos||!1})),crudos:this.clienteCrudos[a]||[]};e.clientes.push(i)}),console.log("Datos del embarque preparados:",e),e},setTipoDefaultParaCliente(e){const t=this.obtenerNombreCliente(e.clienteId);"Catarro"===t&&(e.tipo="s/h20")},undo(){if(this.undoStack.length>1){const e=this.undoStack.pop();this.redoStack.push(e);const t=this.undoStack[this.undoStack.length-1];this.isUndoRedo=!0,this.embarque=JSON.parse(t),console.log("Undo realizado. Estado actual restaurado."),this.guardarCambiosEnTiempoReal()}else console.log("No hay m치s acciones para deshacer.")},redo(){if(this.redoStack.length>0){const e=this.redoStack.pop();this.undoStack.push(e),this.isUndoRedo=!0,this.embarque=JSON.parse(e),console.log("Redo realizado. Estado actual restaurado."),this.guardarCambiosEnTiempoReal()}else console.log("No hay m치s acciones para rehacer.")},actualizarProducto(e){const t=this.embarque.productos.findIndex(t=>t.id===e.id);if(-1!==t){const a=JSON.parse(JSON.stringify(e));this.$set(this.embarque.productos,t,a),this.$forceUpdate()}},onTipoChange(e){"otro"!==e.tipo&&(e.tipoPersonalizado=""),"c/h20"!==e.tipo||e.camaronNeto||(e.camaronNeto=.65),e.isEditing=!0,this.$nextTick(()=>{setTimeout(()=>{e.medida&&e.tipo&&(e.isEditing=!1)},100)})},agregarCrudo(e){this.clienteCrudos[e]||this.$set(this.clienteCrudos,e,[]),this.clienteCrudos[e].push({items:[Object(f["b"])()]}),this.guardarCambiosEnTiempoReal()},agregarCrudoItem(e,t){this.clienteCrudos[e]||this.$set(this.clienteCrudos,e,[]),this.clienteCrudos[e][t]||this.$set(this.clienteCrudos[e],t,{items:[]}),Array.isArray(this.clienteCrudos[e][t].items)||this.$set(this.clienteCrudos[e][t],"items",[]),this.clienteCrudos[e][t].items.push(Object(f["b"])()),this.guardarCambiosEnTiempoReal()},eliminarCrudoItem(e,t,a){this.clienteCrudos[e]?this.clienteCrudos[e][t]?this.clienteCrudos[e][t].items?(this.clienteCrudos[e][t].items.splice(a,1),0===this.clienteCrudos[e][t].items.length&&this.eliminarCrudo(e,t),this.guardarCambiosEnTiempoReal()):console.error("El objeto crudo no tiene propiedad items"):console.error("칈ndice de crudo no v치lido:",t):console.error("Cliente no encontrado:",e)},eliminarCrudo(e,t){this.clienteCrudos[t]?(this.clienteCrudos[t].splice(e,1),0===this.clienteCrudos[t].length&&this.$delete(this.clienteCrudos,t),this.guardarCambiosEnTiempoReal()):console.error("Cliente no encontrado:",t)},toggleSobrante(e,t,a){if(!this.clienteCrudos[e])return void console.error("Cliente no encontrado:",e);if(!this.clienteCrudos[e][t])return void console.error("칈ndice de crudo no v치lido:",t);if(!this.clienteCrudos[e][t].items)return this.$set(this.clienteCrudos[e][t],"items",[]),void console.error("El objeto crudo no tiene propiedad items");if(!this.clienteCrudos[e][t].items[a])return void console.error("칈ndice de item no v치lido:",a);const o=this.clienteCrudos[e][t].items[a];o.hasOwnProperty("mostrarSobrante")?o.mostrarSobrante=!o.mostrarSobrante:this.$set(o,"mostrarSobrante",!0),this.guardarCambiosEnTiempoReal()},actualizarTotalCrudos(e,t){this.$forceUpdate(),this.guardarCambiosEnTiempoReal()},actualizarCrudos(){this.guardarCambiosEnTiempoReal()},onRestarTarasChange(e){console.log("Restar taras cambiado:",e.restarTaras),this.$nextTick(()=>{this.actualizarProducto(e)})},handleJuntarMedidasChange(e,t){this.$set(this.clientesJuntarMedidas,e,t),this.modoEdicion&&this.embarqueId&&this.guardarCambiosEnTiempoReal()},agregarNuevoCliente(e){if(!e||!e.nombre)return;const t={id:Date.now().toString(),nombre:e.nombre,color:e.color||this.nuevoClienteColor,editable:!0,personalizado:!0,key:"personalizado_"+Date.now()};this.clientesPersonalizados.push(t);const a=Object(f["c"])(t.id);this.embarque.productos.push(a),this.guardarClientesPersonalizados(),this.guardarCambiosEnTiempoReal(),this.mostrarModalNuevoCliente=!1,this.seleccionarCliente(t.id)},abrirModalNombreAlternativo(e){this.productoSeleccionado=e,this.mostrarModalNombreAlternativo=!0},guardarNombreAlternativo(e){if(this.productoSeleccionado){const t=this.guardadoAutomaticoActivo;this.guardadoAutomaticoActivo=!1,e?this.$set(this.productoSeleccionado,"nombreAlternativoPDF",e):this.$delete(this.productoSeleccionado,"nombreAlternativoPDF"),this.actualizarProducto(this.productoSeleccionado),this.$nextTick(()=>{this.guardadoAutomaticoActivo=t,this.guardarCambiosEnTiempoReal(),this.mostrarModalNombreAlternativo=!1})}else this.mostrarModalNombreAlternativo=!1},abrirModalPrecio(e){this.itemSeleccionado=e,this.mostrarModalPrecio=!0},cerrarModalPrecio(){this.mostrarModalPrecio=!1,this.itemSeleccionado=null},guardarPrecio(e){if(this.itemSeleccionado){null!==e?this.$set(this.itemSeleccionado,"precio",e):this.$delete(this.itemSeleccionado,"precio");const t=this.guardadoAutomaticoActivo;this.guardadoAutomaticoActivo=!1,this.$nextTick(()=>{this.guardadoAutomaticoActivo=t,this.guardarCambiosEnTiempoReal()})}this.cerrarModalPrecio()},abrirModalHilos(e){this.itemSeleccionado=e,this.mostrarModalHilos=!0},cerrarModalHilos(){this.mostrarModalHilos=!1,this.itemSeleccionado=null},guardarHilos(e){if(this.itemSeleccionado){e?this.$set(this.itemSeleccionado,"hilos",e):this.$delete(this.itemSeleccionado,"hilos");const t=this.guardadoAutomaticoActivo;this.guardadoAutomaticoActivo=!1,this.$nextTick(()=>{this.guardadoAutomaticoActivo=t,this.guardarCambiosEnTiempoReal()})}this.cerrarModalHilos()},abrirModalNota(e){this.itemSeleccionado=e,this.mostrarModalNota=!0},cerrarModalNota(){this.mostrarModalNota=!1,this.itemSeleccionado=null},guardarNota(e){if(this.itemSeleccionado){e?this.$set(this.itemSeleccionado,"nota",e):this.$delete(this.itemSeleccionado,"nota");const t=this.guardadoAutomaticoActivo;this.guardadoAutomaticoActivo=!1,this.$nextTick(()=>{this.guardadoAutomaticoActivo=t,this.guardarCambiosEnTiempoReal()})}this.cerrarModalNota()},abrirModalAlt(e){this.itemSeleccionado=e,this.mostrarModalAlt=!0},cerrarModalAlt(){this.mostrarModalAlt=!1,this.itemSeleccionado=null},guardarAlt(e){this.itemSeleccionado&&(e?this.$set(this.itemSeleccionado,"textoAlternativo",e):this.$delete(this.itemSeleccionado,"textoAlternativo"),this.guardarCambiosEnTiempoReal()),this.cerrarModalAlt()},seleccionarCliente(e){const t=this.mostrarModalPrecio||this.mostrarModalHilos||this.mostrarModalNota||this.mostrarModalAlt||this.mostrarModalNombreAlternativo||this.mostrarModalNuevoCliente;if(t)return;if(!this.embarque.fecha)return void alert("Por favor, seleccione una fecha para el embarque.");const a=this.embarque.productos.some(t=>t.clienteId.toString()===e.toString());a?this.clienteActivo=e:this.guardarEmbarqueInicial(e).then(()=>{this.clienteActivo=e})},scrollToCliente(e){this.$nextTick(()=>{const t=document.querySelector(`.cliente-header[data-cliente="${this.obtenerNombreCliente(e)}"]`);t&&(document.querySelectorAll(".cliente-header").forEach(e=>{e.classList.remove("cliente-seleccionado")}),t.classList.add("cliente-seleccionado"),t.scrollIntoView({behavior:"smooth",block:"start"}),setTimeout(()=>{t.classList.remove("cliente-seleccionado")},2e3))})},toggleSidebar(){this.sidebarCollapsed=!this.sidebarCollapsed},toggleBloqueo(){if(this.embarqueBloqueado=!this.embarqueBloqueado,this.modoEdicion&&this.embarqueId){const e=Object(i["h"])();Object(i["r"])(Object(i["e"])(e,"embarques",this.embarqueId),{embarqueBloqueado:this.embarqueBloqueado}).catch(e=>{console.error("Error al guardar estado de bloqueo:",e)})}},actualizarMedidasUsadas(){const e=this.embarque.productos.map(e=>e.medida).filter(e=>e&&e.trim()).filter((e,t,a)=>a.indexOf(e)===t);this.medidasUsadas=e},onMedidaInput(e,t){const a=t.target.value.toLowerCase();this.productoEditandoId=e.id,e.medida=t.target.value,this.sugerenciasMedidas=a?this.medidasUsadas.filter(e=>e.toLowerCase().includes(a)&&e.toLowerCase()!==a):[],e.isEditing=!0,this.actualizarProducto(e)},onMedidaBlur(e){setTimeout(()=>{this.productoEditandoId=null},200),e.medida&&e.medida.length>0&&e.tipo&&(e.isEditing=!1,e.isNew=!1)},seleccionarMedida(e,t){e.medida=t,this.productoEditandoId=null,this.actualizarProducto(e)},onTallaCrudoChange(e){e.medida||(e.medida=e.talla),this.guardarCambiosEnTiempoReal()},guardarClientesPersonalizados(){localStorage.setItem("clientesPersonalizados",JSON.stringify(this.clientesPersonalizados))},cargarClientesPersonalizados(){const e=localStorage.getItem("clientesPersonalizados");e&&(this.clientesPersonalizados=JSON.parse(e))},async escucharUsuariosActivos(){try{console.log("Iniciando escucha de usuarios activos");const t=Object(n["d"])(c["c"],"status");if(this.authStore.isLoggedIn&&this.authStore.user){console.log("Usuario autenticado:",this.authStore.user.username);const t=Object(n["d"])(c["c"],"status/"+this.authStore.userId);try{await Object(n["e"])(t,{username:this.authStore.user.username,status:"online",lastSeen:(new Date).toISOString()}),console.log("Estado del usuario actualizado correctamente")}catch(e){console.error("Error al actualizar estado del usuario:",e)}}else console.log("Usuario no autenticado");this.unsubscribeUsuarios=Object(n["c"])(t,e=>{const t=[];console.log("Recibiendo actualizaci칩n de usuarios activos"),e.forEach(e=>{const a=e.val();console.log("Usuario encontrado:",a),a&&a.username&&t.push({userId:e.key,username:a.username,status:a.status||"online",lastSeen:a.lastSeen})}),console.log("Total usuarios activos:",t.length),this.usuariosActivos=t},e=>{console.error("Error al escuchar usuarios activos:",e)})}catch(e){console.error("Error al iniciar escucha de usuarios:",e)}},async iniciarPresenciaUsuario(){try{if(!this.authStore.isLoggedIn||!this.authStore.user)return void console.log("Usuario no autenticado");const e=Object(n["d"])(c["c"],"status/"+this.authStore.userId);await Object(n["b"])(e).remove(),await Object(n["e"])(e,{username:this.authStore.user.username,status:"online",lastSeen:(new Date).toISOString()})}catch(e){console.error("Error al iniciar presencia:",e.message,e.stack)}},volverAEmbarquesMenu(){this.$router.push({name:"EmbarquesMenu"})},calcularPosicionSticky(e){const t=Object.keys(this.productosPorCliente),a=t.indexOf(e.toString());if(0===a)return 0;let o=0;for(let i=0;i<a;i++){var r;const e=t[i],a=(null===(r=this.$el.querySelector(`[data-cliente="${this.obtenerNombreCliente(e)}"]`))||void 0===r?void 0:r.offsetHeight)||0;o+=a}return o},async crearCuentaJoselito(e,t,a){try{this.isCreatingAccount=!0;const e={...this.embarque,productos:t,crudos:a};await S["a"].crearCuentaJoselito(e,this.$router)}catch(o){console.error("Error al crear cuenta para Joselito:",o),alert("Error al crear cuenta para Joselito")}finally{this.isCreatingAccount=!1}},async crearCuentaCatarro(e,t,a){try{this.isCreatingAccount=!0;const e="2",o={...this.embarque,productos:t,clienteCrudos:{[e]:a}};await S["a"].crearCuentaCatarro(o,this.$router),alert("Cuenta de Catarro creada exitosamente y abierta en una nueva pesta침a.")}catch(o){console.error("Error al crear cuenta para Catarro:",o),alert("Error al crear cuenta para Catarro: "+o.message)}finally{this.isCreatingAccount=!1}},esClienteJoselito(e){const t=this.clientesDisponibles.find(t=>t.id.toString()===e.toString());return t&&t.nombre.toLowerCase().includes("joselito")},esClienteCatarro(e){const t=this.clientesDisponibles.find(t=>t.id.toString()===e.toString());return t&&t.nombre.toLowerCase().includes("catarro")},obtenerEmbarqueCliente(e){const t=this.productosPorCliente[e],a=this.clienteCrudos[e];return{fecha:this.embarque.fecha,cargaCon:this.embarque.cargaCon,productos:t,clienteCrudos:{[e]:a},kilosCrudos:this.embarque.kilosCrudos||{}}},async verificarFechaExistente(e){if(this.embarqueBloqueado)alert("El embarque est치 bloqueado. No se puede cambiar la fecha.");else if(e!==this.embarque.fecha)try{const t=Object(i["h"])(),a=new Date(e),o=a.toISOString().split("T")[0],r=Object(i["c"])(t,"embarques"),s=await Object(i["g"])(r),n=s.docs.filter(e=>{if(this.embarqueId&&e.id===this.embarqueId)return!1;const t=e.data();let a;if(t.fecha&&"function"===typeof t.fecha.toDate)a=t.fecha.toDate();else if(t.fecha instanceof Date)a=t.fecha;else{if("string"!==typeof t.fecha)return!1;a=new Date(t.fecha)}const r=a.toISOString().split("T")[0];return r===o});if(n.length>0)return void alert("Ya existe un embarque para la fecha seleccionada. Por favor, seleccione otra fecha.");this.embarqueId&&localStorage.setItem("ultimoEmbarqueId",this.embarqueId),this.embarque.fecha=e,this.modoEdicion&&this.embarqueId&&this.guardarCambiosEnTiempoReal()}catch(t){console.error("Error al verificar fecha existente:",t),alert("Hubo un error al verificar la fecha. Por favor, intente nuevamente.")}},async crearCuentaCatarro(e,t,a){try{this.isCreatingAccount=!0;const e="2",o={...this.embarque,productos:t,clienteCrudos:{[e]:a}};await S["a"].crearCuentaCatarro(o,this.$router),alert("Cuenta de Catarro creada exitosamente y abierta en una nueva pesta침a.")}catch(o){console.error("Error al crear cuenta para Catarro:",o),alert("Error al crear cuenta para Catarro: "+o.message)}finally{this.isCreatingAccount=!1}},async crearCuentaOzuna(e,t,a){try{this.isCreatingAccount=!0;const e="4",o={...this.embarque,productos:t,clienteCrudos:{[e]:a}};await S["a"].crearCuentaOzuna(o,this.$router),alert("Cuenta de Ozuna creada exitosamente y abierta en una nueva pesta침a.")}catch(o){console.error("Error al crear cuenta para Ozuna:",o),alert("Error al crear cuenta para Ozuna: "+o.message)}finally{this.isCreatingAccount=!1}},syncOffline(){this.embarqueId?this.guardarCambiosEnTiempoReal():this.guardarEmbarque().catch(e=>console.error("Error al sincronizar embarque offline:",e))}},watch:{embarque:{handler(e){this.isUndoRedo?this.isUndoRedo=!1:(localStorage.setItem("embarque",JSON.stringify(e)),this.undoStack.push(JSON.stringify(e)),this.redoStack=[],this.guardarCambiosEnTiempoReal())},deep:!0},clienteCrudos:{handler(){localStorage.setItem("clienteCrudos",JSON.stringify(this.clienteCrudos)),this.guardarCambiosEnTiempoReal()},deep:!0},"embarque.productos":{handler(e){e.forEach(e=>{})},deep:!0}},async created(){const e=localStorage.getItem("embarque");if(!navigator.onLine&&e){this.embarque=JSON.parse(e);const t=localStorage.getItem("clienteCrudos");return t&&(this.clienteCrudos=JSON.parse(t)),this.undoStack.push(JSON.stringify(this.embarque)),this.actualizarMedidasUsadas(),this.cargarClientesPersonalizados(),this.guardadoAutomaticoActivo=!0,void window.addEventListener("online",this.syncOffline)}const t=this.$route.params.id;await this.cargarEmbarque(t),this.undoStack.push(JSON.stringify(this.embarque)),this.actualizarMedidasUsadas(),this.cargarClientesPersonalizados(),await this.iniciarPresenciaUsuario(),this.escucharUsuariosActivos()},mounted(){const e=this.detectarRecarga(),t=this.$route.params.id;if(t&&"nuevo"!==t)this.cargarEmbarque(t);else{const t=localStorage.getItem("ultimoEmbarqueId"),a=localStorage.getItem("ultimaRuta");if(e&&t&&a&&a.includes("nuevo-embarque"))return console.log("Detectada recarga de p치gina, restaurando embarque "+t),void this.$router.replace({name:"NuevoEmbarque",params:{id:t}});this.resetearEmbarque()}localStorage.setItem("ultimaRuta",window.location.pathname),t&&"nuevo"!==t&&localStorage.setItem("ultimoEmbarqueId",t),this.cargarClientesPersonalizados(),this.authStore.user&&this.embarqueId&&this.iniciarPresencia(),window.addEventListener("beforeunload",this.handleBeforeUnload),this.$nextTick(()=>{const e=document.querySelectorAll(".crudo input, .crudo select");e.forEach(e=>{e.addEventListener("input",this.actualizarCrudos)})})},detectarRecarga(){if(window.performance&&window.performance.navigation)return 1===window.performance.navigation.type;if(window.performance&&window.performance.getEntriesByType&&window.performance.getEntriesByType("navigation")){const e=window.performance.getEntriesByType("navigation");if(e.length>0&&e[0].type)return"reload"===e[0].type}const e=localStorage.getItem("ultimaVisita"),t=Date.now();return localStorage.setItem("ultimaVisita",t),!!(e&&t-parseInt(e)<5e3)},handleBeforeUnload(e){this.embarqueId&&(localStorage.setItem("ultimoEmbarqueId",this.embarqueId),localStorage.setItem("ultimaRuta",window.location.pathname))},beforeDestroy(){this.unsubscribe&&this.unsubscribe();const e=document.querySelectorAll(".crudo input, .crudo select");e.forEach(e=>{e.removeEventListener("input",this.actualizarCrudos)}),this.unsubscribeUsuarios&&(console.log("Limpiando escucha de usuarios activos"),this.unsubscribeUsuarios()),window.removeEventListener("beforeunload",this.handleBeforeUnload),window.removeEventListener("online",this.syncOffline)},updated(){}},y=P,A=(a("fe37"),a("2877")),w=Object(A["a"])(y,o,r,!1,null,"d564cc3a",null);t["a"]=w.exports},fe37:function(e,t,a){"use strict";a("c12b")}}]);