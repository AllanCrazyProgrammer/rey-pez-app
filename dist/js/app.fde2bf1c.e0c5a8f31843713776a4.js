(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["app.fde2bf1c"],{"03c4":function(e,i,t){"use strict";var s=function(){var e=this,i=e._self._c;return i("div",{staticClass:"precio-cliente-button-container"},[i("PreciosHistorialModal",{attrs:{clienteActual:e.clienteId}})],1)},a=[],c=t("666c"),o={name:"PreciosClienteButton",components:{PreciosHistorialModal:c["a"]},props:{clienteId:{type:String,required:!0}}},r=o,n=(t("f971"),t("2877")),l=Object(n["a"])(r,s,a,!1,null,"76dcdc36",null);i["a"]=l.exports},"0b8c":function(e,i,t){"use strict";var s=function(){var e=this,i=e._self._c;return e.mostrar?i("div",{staticClass:"modal-overlay"},[i("div",{staticClass:"modal-content"},[i("h3",[e._v("Nuevo Cliente Temporal")]),i("div",{staticClass:"form-group"},[i("label",{attrs:{for:"nombreCliente"}},[e._v("Nombre del Cliente:")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.nombreCliente,expression:"nombreCliente"}],staticClass:"input-field",attrs:{type:"text",id:"nombreCliente",placeholder:"Ingrese el nombre del cliente"},domProps:{value:e.nombreCliente},on:{input:function(i){i.target.composing||(e.nombreCliente=i.target.value)}}})]),i("div",{staticClass:"buttons-container"},[i("button",{staticClass:"btn-guardar",attrs:{disabled:!e.nombreCliente.trim()},on:{click:e.guardarCliente}},[e._v(" Guardar ")]),i("button",{staticClass:"btn-cancelar",on:{click:function(i){return e.$emit("cerrar")}}},[e._v(" Cancelar ")])])])]):e._e()},a=[],c={name:"NuevoClienteModal",props:{mostrar:{type:Boolean,required:!0}},data(){return{nombreCliente:""}},methods:{guardarCliente(){this.nombreCliente.trim()&&(this.$emit("guardar",{id:this.nombreCliente.toLowerCase().replace(/\s+/g,"-"),nombre:this.nombreCliente.trim()}),this.nombreCliente="")}}},o=c,r=(t("5617e"),t("2877")),n=Object(r["a"])(o,s,a,!1,null,"ea897a92",null);i["a"]=n.exports},"4c80":function(e,i,t){},"5617e":function(e,i,t){"use strict";t("4c80")},6148:function(e,i,t){},"666c":function(e,i,t){"use strict";var s=function(){var e,i,t=this,s=t._self._c;return s("div",[s("button",{staticClass:"precio-historial-btn",on:{click:t.abrirModal}},[s("i",{staticClass:"nav-icon"},[t._v("üí∞")]),s("span",[t._v(t._s(t.clienteActual?"Precios de Venta - "+t.obtenerNombreCliente(t.clienteActual):"Precios de Venta"))])]),t.showModal?s("div",{staticClass:"modal-overlay",on:{click:function(e){if(e.target!==e.currentTarget)return null;t.showModal=!1}}},[s("div",{staticClass:"modal-content"},[s("div",{staticClass:"modal-header"},[s("h2",[s("i",{staticClass:"header-icon"},[t._v("üìä")]),t._v(" "+t._s(t.clienteActual?"Precios de Venta - "+t.obtenerNombreCliente(t.clienteActual):"Precios de Venta")+" ")]),s("button",{staticClass:"close-btn",on:{click:function(e){t.showModal=!1}}},[s("i",{staticClass:"close-icon"},[t._v("‚úï")])])]),s("div",{staticClass:"add-price-form"},[t._m(0),s("div",{staticClass:"form-group"},[s("div",{staticClass:"input-wrapper"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.newPrice.producto,expression:"newPrice.producto"}],staticClass:"form-input",attrs:{type:"text",placeholder:"Producto/Medida",list:"productos"},domProps:{value:t.newPrice.producto},on:{input:function(e){e.target.composing||t.$set(t.newPrice,"producto",e.target.value)}}}),s("datalist",{attrs:{id:"productos"}},t._l(t.preciosActuales,(function(e){return s("option",{key:e.id,domProps:{value:e.producto}})})),0),t.precioActualMostrar?s("div",{staticClass:"precio-actual-indicator"},[s("i",{staticClass:"precio-icon"},[t._v("üí∞")]),s("span",{staticClass:"precio-texto"},[t._v("Precio actual: ")]),s("span",{staticClass:"precio-valor"},[t._v("$"+t._s(t.formatNumber(t.precioActualMostrar.precio)))]),t.precioActualMostrar.clienteId?s("span",{staticClass:"precio-cliente"},[t._v(" ("+t._s(t.obtenerNombreCliente(t.precioActualMostrar.clienteId))+") ")]):s("span",{staticClass:"precio-general"},[t._v("(General)")]),s("span",{staticClass:"precio-fecha"},[t._v("desde "+t._s(t.formatDate(t.precioActualMostrar.fecha)))])]):t._e()]),s("div",{staticClass:"input-wrapper"},[s("input",{directives:[{name:"model",rawName:"v-model.number",value:t.newPrice.precio,expression:"newPrice.precio",modifiers:{number:!0}}],staticClass:"form-input",attrs:{type:"number",placeholder:"Precio"},domProps:{value:t.newPrice.precio},on:{input:function(e){e.target.composing||t.$set(t.newPrice,"precio",t._n(e.target.value))},blur:function(e){return t.$forceUpdate()}}})]),s("div",{staticClass:"input-wrapper"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.newPrice.fecha,expression:"newPrice.fecha"}],staticClass:"form-input",attrs:{type:"date"},domProps:{value:t.newPrice.fecha},on:{input:function(e){e.target.composing||t.$set(t.newPrice,"fecha",e.target.value)}}})]),s("div",{staticClass:"cliente-especifico-wrapper"},[s("label",{staticClass:"checkbox-wrapper"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.newPrice.esClienteEspecifico,expression:"newPrice.esClienteEspecifico"}],attrs:{type:"checkbox",id:"clienteEspecifico"},domProps:{checked:Array.isArray(t.newPrice.esClienteEspecifico)?t._i(t.newPrice.esClienteEspecifico,null)>-1:t.newPrice.esClienteEspecifico},on:{change:function(e){var i=t.newPrice.esClienteEspecifico,s=e.target,a=!!s.checked;if(Array.isArray(i)){var c=null,o=t._i(i,c);s.checked?o<0&&t.$set(t.newPrice,"esClienteEspecifico",i.concat([c])):o>-1&&t.$set(t.newPrice,"esClienteEspecifico",i.slice(0,o).concat(i.slice(o+1)))}else t.$set(t.newPrice,"esClienteEspecifico",a)}}}),s("span",{staticClass:"checkmark"}),s("span",{staticClass:"checkbox-label"},[t._v("Precio para cliente espec√≠fico")])])]),t.newPrice.esClienteEspecifico?s("div",{staticClass:"cliente-selector"},[s("label",{staticClass:"selector-label"},[t._v("Seleccionar cliente:")]),s("div",{staticClass:"cliente-botones"},t._l(t.clientes,(function(e){return s("button",{key:e.id,staticClass:"cliente-btn",class:{"cliente-seleccionado":t.newPrice.clienteId===e.id},style:{"--cliente-color":e.color},on:{click:function(i){return t.seleccionarCliente(e.id)}}},[t._v(" "+t._s(e.nombre)+" ")])})),0)]):t._e(),s("button",{staticClass:"add-btn",on:{click:t.agregarPrecio}},[s("i",{staticClass:"btn-icon"},[t._v("üíæ")]),s("span",[t._v("Agregar Precio")])])])]),s("div",{staticClass:"filter-section"},[t._m(1),s("div",{staticClass:"cliente-filtro-botones"},[s("button",{staticClass:"cliente-filtro-btn",class:{"cliente-filtro-seleccionado":""===t.filtroCliente},on:{click:function(e){t.filtroCliente=""}}},[s("i",{staticClass:"filter-all-icon"},[t._v("üåê")]),t._v(" Todos ")]),t._l(t.clientes,(function(e){return s("button",{key:e.id,staticClass:"cliente-filtro-btn",class:{"cliente-filtro-seleccionado":t.filtroCliente===e.id},style:{"--cliente-color":e.color},on:{click:function(i){t.filtroCliente=e.id}}},[t._v(" "+t._s(e.nombre)+" ")])}))],2)]),s("div",{staticClass:"current-prices"},[t._m(2),t._l(t.categorias,(function(e){return s("div",{key:e,staticClass:"categoria-section"},[s("h4",{staticClass:"categoria-title"},[s("i",{staticClass:"categoria-icon"},[t._v("üìÇ")]),t._v(" "+t._s(e)+" ")]),s("div",{staticClass:"products-grid"},t._l(t.filtrarPreciosPorCliente(t.preciosOrdenados[e]),(function(e){return s("div",{key:e.id,staticClass:"product-card",class:{"precio-especifico":e.clienteId},style:e.clienteId?{"--border-color":t.obtenerColorCliente(e.clienteId),"--bg-color":t.obtenerColorClienteConOpacidad(e.clienteId)}:{}},[s("div",{staticClass:"product-header"},[s("h4",{staticClass:"product-name"},[t._v(t._s(e.producto))]),s("div",{staticClass:"product-actions"},[s("button",{staticClass:"history-btn",attrs:{title:"Ver historial"},on:{click:function(i){return t.mostrarHistorial(e)}}},[s("i",{staticClass:"history-icon"},[t._v("üìà")])])])]),s("div",{staticClass:"product-info"},[s("p",{staticClass:"price"},[t._v("$"+t._s(t.formatNumber(e.precio)))]),s("p",{staticClass:"date"},[s("i",{staticClass:"date-icon"},[t._v("üìÖ")]),t._v(" Desde: "+t._s(t.formatDate(e.fecha))+" ")]),e.clienteId?s("p",{staticClass:"cliente-especifico-tag",style:{"--tag-color":t.obtenerColorCliente(e.clienteId)}},[s("i",{staticClass:"client-icon"},[t._v("üë§")]),t._v(" Cliente: "+t._s(t.obtenerNombreCliente(e.clienteId))+" ")]):t._e(),s("p",{staticClass:"historial-count"},[s("i",{staticClass:"count-icon"},[t._v("üìä")]),t._v(" "+t._s(e.historial.length)+" precio"+t._s(1!==e.historial.length?"s":"")+" registrado"+t._s(1!==e.historial.length?"s":"")+" ")])])])})),0)])}))],2),t.showHistorialModal?s("div",{staticClass:"historial-modal-overlay",on:{click:function(e){if(e.target!==e.currentTarget)return null;t.showHistorialModal=!1}}},[s("div",{staticClass:"historial-modal"},[s("div",{staticClass:"historial-content"},[s("div",{staticClass:"historial-header"},[s("h3",[s("i",{staticClass:"historial-icon"},[t._v("üìà")]),t._v(" Historial de Precios - "+t._s(null===(e=t.productoSeleccionado)||void 0===e?void 0:e.producto)+" ")]),s("button",{staticClass:"close-btn",on:{click:function(e){t.showHistorialModal=!1}}},[s("i",{staticClass:"close-icon"},[t._v("‚úï")])])]),s("div",{staticClass:"table-wrapper"},[s("table",{staticClass:"historial-table"},[t._m(3),s("tbody",t._l(t.historialPaginado,(function(e,i){return s("tr",{key:i,staticClass:"historial-row"},[s("td",{staticClass:"date-cell"},[t._v(t._s(t.formatDate(e.fecha)))]),s("td",{staticClass:"price-cell"},[t._v("$"+t._s(t.formatNumber(e.precio)))]),s("td",{staticClass:"client-cell"},[e.clienteId?s("span",{staticClass:"cliente-especifico-tag",style:{"--tag-color":t.obtenerColorCliente(e.clienteId)}},[s("i",{staticClass:"client-icon"},[t._v("üë§")]),t._v(" "+t._s(t.obtenerNombreCliente(e.clienteId))+" ")]):s("span",{staticClass:"general-tag"},[s("i",{staticClass:"general-icon"},[t._v("üåê")]),t._v(" General ")])]),s("td",{staticClass:"change-cell"},[t.calcularIndiceGlobal(i)<t.historialPrecios.length-1?s("span",{staticClass:"change-indicator",class:{"precio-subio":e.precio<t.historialPrecios[t.calcularIndiceGlobal(i)+1].precio,"precio-bajo":e.precio>t.historialPrecios[t.calcularIndiceGlobal(i)+1].precio}},[t._v(" "+t._s(t.calcularCambio(e.precio,t.historialPrecios[t.calcularIndiceGlobal(i)+1].precio))+" ")]):t._e()]),s("td",{staticClass:"actions-cell"},[s("button",{staticClass:"delete-btn",attrs:{title:"Eliminar precio"},on:{click:function(i){return t.eliminarPrecio(e)}}},[s("i",{staticClass:"delete-icon"},[t._v("üóëÔ∏è")])])])])})),0)])]),t.historialPrecios.length>0?s("div",{staticClass:"pagination-info"},[s("span",{staticClass:"pagination-text"},[s("i",{staticClass:"info-icon"},[t._v("‚ÑπÔ∏è")]),t._v(" Mostrando "+t._s(t.infoPaginacion.inicio)+"-"+t._s(t.infoPaginacion.fin)+" de "+t._s(t.infoPaginacion.total)+" registros ")]),s("div",{staticClass:"items-per-page"},[s("label",[t._v("Registros por p√°gina:")]),s("select",{directives:[{name:"model",rawName:"v-model",value:t.itemsPorPagina,expression:"itemsPorPagina"}],staticClass:"pagination-select",on:{change:[function(e){var i=Array.prototype.filter.call(e.target.options,(function(e){return e.selected})).map((function(e){var i="_value"in e?e._value:e.value;return i}));t.itemsPorPagina=e.target.multiple?i:i[0]},function(e){t.paginaActual=1}]}},[s("option",{domProps:{value:5}},[t._v("5")]),s("option",{domProps:{value:10}},[t._v("10")]),s("option",{domProps:{value:20}},[t._v("20")]),s("option",{domProps:{value:50}},[t._v("50")])])])]):t._e(),t.totalPaginas>1?s("div",{staticClass:"pagination-controls"},[s("button",{staticClass:"pagination-btn",attrs:{disabled:1===t.paginaActual},on:{click:function(e){t.paginaActual=1}}},[s("i",{staticClass:"pagination-icon"},[t._v("‚èÆÔ∏è")])]),s("button",{staticClass:"pagination-btn",attrs:{disabled:1===t.paginaActual},on:{click:function(e){t.paginaActual--}}},[s("i",{staticClass:"pagination-icon"},[t._v("‚óÄÔ∏è")])]),s("div",{staticClass:"pagination-numbers"},t._l(t.numerosVisibles,(function(e){return s("button",{key:e,class:{"pagination-number":!0,active:e===t.paginaActual},on:{click:function(i){t.paginaActual=e}}},[t._v(" "+t._s(e)+" ")])})),0),s("button",{staticClass:"pagination-btn",attrs:{disabled:t.paginaActual===t.totalPaginas},on:{click:function(e){t.paginaActual++}}},[s("i",{staticClass:"pagination-icon"},[t._v("‚ñ∂Ô∏è")])]),s("button",{staticClass:"pagination-btn",attrs:{disabled:t.paginaActual===t.totalPaginas},on:{click:function(e){t.paginaActual=t.totalPaginas}}},[s("i",{staticClass:"pagination-icon"},[t._v("‚è≠Ô∏è")])])]):t._e()])])]):t._e(),t.showConfirmacionModal?s("div",{staticClass:"confirmacion-modal-overlay",on:{click:function(e){return e.target!==e.currentTarget?null:t.cancelarConfirmacion.apply(null,arguments)}}},[s("div",{staticClass:"confirmacion-modal-content"},[s("div",{staticClass:"confirmacion-header"},[t._m(4),s("button",{staticClass:"close-btn",on:{click:t.cancelarConfirmacion}},[s("i",{staticClass:"close-icon"},[t._v("‚úï")])])]),s("div",{staticClass:"confirmacion-body"},[s("p",{staticClass:"confirmacion-mensaje"},[t._v(" Ya existen precios espec√≠ficos para "),s("strong",[t._v(t._s(null===(i=t.nuevoPrecioTemporal)||void 0===i?void 0:i.producto))]),t._v(" para los siguientes clientes: ")]),s("div",{staticClass:"clientes-afectados"},t._l(t.preciosEspecificosAfectados,(function(e){var i;return s("div",{key:e.clienteId,staticClass:"cliente-afectado"},[s("div",{staticClass:"cliente-info"},[s("span",{staticClass:"cliente-tag",style:{"--tag-color":t.obtenerColorCliente(e.clienteId)}},[s("i",{staticClass:"client-icon"},[t._v("üë§")]),t._v(" "+t._s(t.obtenerNombreCliente(e.clienteId))+" ")]),s("div",{staticClass:"precio-info"},[s("span",{staticClass:"precio-actual"},[s("i",{staticClass:"price-icon"},[t._v("üí∞")]),t._v(" Precio actual: $"+t._s(t.formatNumber(e.precio))+" ")]),s("span",{staticClass:"precio-nuevo"},[s("i",{staticClass:"new-price-icon"},[t._v("üÜï")]),t._v(" Precio nuevo: $"+t._s(t.formatNumber(null===(i=t.nuevoPrecioTemporal)||void 0===i?void 0:i.precio))+" ")])])]),s("div",{staticClass:"decision-opciones"},[s("label",{staticClass:"decision-label"},[t._v("¬øQu√© deseas hacer?")]),s("div",{staticClass:"radio-group"},[s("label",{staticClass:"radio-option"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.decisionesClientes[e.clienteId],expression:"decisionesClientes[precioEspecifico.clienteId]"}],attrs:{type:"radio",name:"decision_"+e.clienteId,value:"mantener"},domProps:{checked:t._q(t.decisionesClientes[e.clienteId],"mantener")},on:{change:function(i){return t.$set(t.decisionesClientes,e.clienteId,"mantener")}}}),s("span",{staticClass:"radio-custom"}),t._m(5,!0)]),s("label",{staticClass:"radio-option"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.decisionesClientes[e.clienteId],expression:"decisionesClientes[precioEspecifico.clienteId]"}],attrs:{type:"radio",name:"decision_"+e.clienteId,value:"sobreescribir"},domProps:{checked:t._q(t.decisionesClientes[e.clienteId],"sobreescribir")},on:{change:function(i){return t.$set(t.decisionesClientes,e.clienteId,"sobreescribir")}}}),s("span",{staticClass:"radio-custom"}),t._m(6,!0)])])])])})),0)]),s("div",{staticClass:"confirmacion-footer"},[s("button",{staticClass:"btn-cancelar",on:{click:t.cancelarConfirmacion}},[s("i",{staticClass:"cancel-icon"},[t._v("‚ùå")]),s("span",[t._v("Cancelar")])]),s("button",{staticClass:"btn-confirmar",attrs:{disabled:!t.todasDecisionesTomadas},on:{click:t.confirmarAgregarPrecio}},[s("i",{staticClass:"confirm-icon"},[t._v("‚úÖ")]),s("span",[t._v("Confirmar y Agregar")])])])])]):t._e()]),s("button",{staticClass:"floating-close-btn",attrs:{title:"Cerrar modal"},on:{click:function(e){t.showModal=!1}}},[s("i",{staticClass:"floating-close-icon"},[t._v("‚ùå")]),s("span",{staticClass:"floating-close-text"},[t._v("Cerrar")])])]):t._e()])},a=[function(){var e=this,i=e._self._c;return i("div",{staticClass:"form-header"},[i("h3",[i("i",{staticClass:"form-icon"},[e._v("‚ûï")]),e._v(" Agregar Nuevo Precio ")])])},function(){var e=this,i=e._self._c;return i("div",{staticClass:"filter-header"},[i("i",{staticClass:"filter-icon"},[e._v("üîç")]),i("label",[e._v("Filtrar por cliente:")])])},function(){var e=this,i=e._self._c;return i("div",{staticClass:"prices-header"},[i("h3",[i("i",{staticClass:"prices-icon"},[e._v("üíº")]),e._v(" Precios Actuales ")])])},function(){var e=this,i=e._self._c;return i("thead",[i("tr",[i("th",[i("i",{staticClass:"table-icon"},[e._v("üìÖ")]),e._v(" Fecha")]),i("th",[i("i",{staticClass:"table-icon"},[e._v("üí∞")]),e._v(" Precio")]),i("th",[i("i",{staticClass:"table-icon"},[e._v("üë§")]),e._v(" Cliente")]),i("th",[i("i",{staticClass:"table-icon"},[e._v("üìä")]),e._v(" Cambio")]),i("th",[i("i",{staticClass:"table-icon"},[e._v("‚öôÔ∏è")]),e._v(" Acciones")])])])},function(){var e=this,i=e._self._c;return i("h3",[i("i",{staticClass:"warning-icon"},[e._v("‚ö†Ô∏è")]),e._v(" Precios Espec√≠ficos Existentes ")])},function(){var e=this,i=e._self._c;return i("span",{staticClass:"radio-text mantener"},[i("i",{staticClass:"keep-icon"},[e._v("üîí")]),e._v(" Mantener precio espec√≠fico actual ")])},function(){var e=this,i=e._self._c;return i("span",{staticClass:"radio-text sobreescribir"},[i("i",{staticClass:"overwrite-icon"},[e._v("üîÑ")]),e._v(" Sobreescribir con precio general ")])}],c=(t("14d9"),t("dc59")),o=t("1494"),r=t("fa1c"),n={name:"PreciosHistorialModal",props:{clienteActual:{type:String,default:""}},data(){return{showModal:!1,showHistorialModal:!1,showConfirmacionModal:!1,preciosActuales:[],historialPrecios:[],productoSeleccionado:null,preciosEspecificosAfectados:[],nuevoPrecioTemporal:null,decisionesClientes:{},paginaActual:1,itemsPorPagina:10,categorias:["Camar√≥n S/C","Camar√≥n C/C","Otros"],clientes:[{id:"joselito",nombre:"Joselito",color:"#2196F3"},{id:"catarro",nombre:"Catarro",color:"#d32f2f"},{id:"otilio",nombre:"Otilio",color:"#FFD700"},{id:"ozuna",nombre:"Ozuna",color:"#07711e"},{id:"veronica",nombre:"Ver√≥nica",color:"#e67e22"}],filtroCliente:"",newPrice:{producto:"",precio:null,fecha:Object(r["d"])(),categoria:"Otros",esClienteEspecifico:!1,clienteId:""},precioActualMostrar:null,buscarPrecioTimeout:null,nombresNormalizados:{"Med Esp c/c":"Med-Esp c/c","med esp c/c":"Med-Esp c/c","Med esp c/c":"Med-Esp c/c","MED ESP c/c":"Med-Esp c/c","MED-ESP c/c":"Med-Esp c/c","Med-esp c/c":"Med-Esp c/c","Med Gde c/c":"Med-Gde c/c","med gde c/c":"Med-Gde c/c","Med gde c/c":"Med-Gde c/c","Med-gde c/c":"Med-Gde c/c","MED GDE c/c":"Med-Gde c/c","MED-GDE c/c":"Med-Gde c/c"}}},computed:{currentDate(){return Object(r["d"])()},totalPaginas(){return Math.ceil(this.historialPrecios.length/this.itemsPorPagina)},historialPaginado(){const e=(this.paginaActual-1)*this.itemsPorPagina,i=e+this.itemsPorPagina;return this.historialPrecios.slice(e,i)},infoPaginacion(){const e=(this.paginaActual-1)*this.itemsPorPagina+1,i=Math.min(this.paginaActual*this.itemsPorPagina,this.historialPrecios.length);return{inicio:e,fin:i,total:this.historialPrecios.length}},numerosVisibles(){const e=5,i=this.totalPaginas,t=this.paginaActual;if(i<=e)return Array.from({length:i},(e,i)=>i+1);let s=Math.max(1,t-Math.floor(e/2)),a=Math.min(i,s+e-1);return a-s+1<e&&(s=Math.max(1,a-e+1)),Array.from({length:a-s+1},(e,i)=>s+i)},preciosOrdenados(){const e={};return this.categorias.forEach(i=>{e[i]=[]}),this.preciosActuales.forEach(i=>{const t=i.producto.toLowerCase();t.includes("s/c")||t.match(/\d+\/\d+/)?e["Camar√≥n S/C"].push(i):t.includes("c/c")?e["Camar√≥n C/C"].push(i):e["Otros"].push(i)}),Object.keys(e).forEach(i=>{e[i].sort((e,i)=>{const t=e=>{const i=e.match(/(\d+)\/(\d+)/);return i?[parseInt(i[1]),parseInt(i[2])]:[0,0]},s=t(e.producto),a=t(i.producto);return s[0]&&a[0]?s[0]-a[0]:e.producto.localeCompare(i.producto)})}),e},todasDecisionesTomadas(){return this.preciosEspecificosAfectados.every(e=>this.decisionesClientes[e.clienteId]&&("mantener"===this.decisionesClientes[e.clienteId]||"sobreescribir"===this.decisionesClientes[e.clienteId]))}},methods:{normalizarNombreProducto(e){if(!e)return e;const i=e.trim();if(this.nombresNormalizados[i])return this.nombresNormalizados[i];const t=i.toLowerCase();for(const[s,a]of Object.entries(this.nombresNormalizados))if(s.toLowerCase()===t)return a;return i},formatNumber(e){return(null===e||void 0===e?void 0:e.toLocaleString("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2}))||"0.00"},formatDate(e){return Object(r["b"])(e)},calcularCambio(e,i){const t=e-i,s=t/i*100,a=t>0?"+":"";return`${a}${this.formatNumber(t)} (${a}${s.toFixed(1)}%)`},calcularIndiceGlobal(e){return(this.paginaActual-1)*this.itemsPorPagina+e},async cargarPreciosActuales(){try{const e=Object(o["c"])(c["a"],"precios"),i=Object(o["o"])(e,Object(o["l"])("fecha","desc")),t=await Object(o["g"])(i),s=new Map;t.docs.forEach(e=>{const i={id:e.id,...e.data()},t=this.normalizarNombreProducto(i.producto),a=i.clienteId?`${t}-${i.clienteId}`:t;if(s.has(a)){const e=s.get(a);new Date(i.fecha)>new Date(e.fechaActual)&&(e.precioActual=i.precio,e.fechaActual=i.fecha)}else s.set(a,{producto:t,productoOriginal:i.producto,precioActual:i.precio,fechaActual:i.fecha,clienteId:i.clienteId||null,historial:[]});s.get(a).historial.push({id:e.id,fecha:i.fecha,precio:i.precio,clienteId:i.clienteId||null,productoOriginal:i.producto})}),s.forEach(e=>{e.historial.sort((e,i)=>new Date(i.fecha)-new Date(e.fecha))}),this.preciosActuales=Array.from(s.values()).map(e=>({id:e.historial[0].id,producto:e.producto,precio:e.precioActual,fecha:e.fechaActual,clienteId:e.clienteId,historial:e.historial})),console.log("[PRECIOS] Productos cargados con nombres normalizados:",this.preciosActuales.map(e=>e.producto))}catch(e){console.error("Error al cargar precios:",e)}},obtenerNombreCliente(e){const i=this.clientes.find(i=>i.id===e);return i?i.nombre:"Cliente desconocido"},obtenerColorCliente(e){const i=this.clientes.find(i=>i.id===e);return i?i.color:"#2196F3"},obtenerColorClienteConOpacidad(e){const i=this.clientes.find(i=>i.id===e);if(!i)return"rgba(33, 150, 243, 0.1)";let t=i.color.replace("#",""),s=parseInt(t.substring(0,2),16),a=parseInt(t.substring(2,4),16),c=parseInt(t.substring(4,6),16);return`rgba(${s}, ${a}, ${c}, 0.15)`},seleccionarCliente(e){this.newPrice.clienteId=e},filtrarPreciosPorCliente(e){if(this.filtroCliente){const i=e.filter(e=>e.clienteId===this.filtroCliente),t=e.filter(e=>!e.clienteId),s={};i.forEach(e=>{s[e.producto]=!0});const a=t.filter(e=>!s[e.producto]);return[...i,...a]}return e.filter(e=>!e.clienteId)},async agregarPrecio(){if(this.newPrice.producto&&this.newPrice.precio&&this.newPrice.fecha)if(!this.newPrice.esClienteEspecifico||this.newPrice.clienteId){if(!this.newPrice.esClienteEspecifico){const e=this.preciosActuales.filter(e=>e.producto.toLowerCase()===this.newPrice.producto.toLowerCase()&&e.clienteId);if(e.length>0)return this.preciosEspecificosAfectados=e,this.nuevoPrecioTemporal={...this.newPrice},this.decisionesClientes={},e.forEach(e=>{this.decisionesClientes[e.clienteId]="mantener"}),void(this.showConfirmacionModal=!0)}await this.guardarPrecio(this.newPrice)}else alert("Por favor seleccione un cliente");else alert("Por favor complete todos los campos")},async guardarPrecio(e,i=!1){try{const t=Object(r["c"])(e.fecha),s=Object(r["e"])(),a=this.normalizarNombreProducto(e.producto);console.log(`[PRECIOS] Guardando precio - Producto original: "${e.producto}", Producto normalizado: "${a}", Fecha: ${t}, Timestamp: ${s}`);const n=a.toLowerCase();let l="Otros";n.includes("s/c")||n.match(/\d+\/\d+/)?l="Camar√≥n S/C":n.includes("c/c")&&(l="Camar√≥n C/C");const d={producto:a,precio:parseFloat(e.precio),fecha:t,categoria:l,timestamp:s,fechaCreacion:Object(r["d"])(),horaCreacion:(new Date).toLocaleTimeString("es-ES")};if(e.esClienteEspecifico&&e.clienteId?(d.clienteId=e.clienteId,console.log("[PRECIOS] Precio espec√≠fico para cliente: "+e.clienteId)):console.log("[PRECIOS] Precio general (sin cliente espec√≠fico)"),console.log("[PRECIOS] Datos finales a guardar:",d),await Object(o["b"])(Object(o["c"])(c["a"],"precios"),d),i&&this.preciosEspecificosAfectados.length>0)for(const e of this.preciosEspecificosAfectados){const i=this.decisionesClientes[e.clienteId];"sobreescribir"===i&&await Object(o["d"])(Object(o["e"])(c["a"],"precios",e.id))}this.newPrice={producto:"",precio:null,fecha:Object(r["d"])(),categoria:"Otros",esClienteEspecifico:!1,clienteId:""},console.log("[PRECIOS] Precio guardado exitosamente y formulario limpiado"),await this.cargarPreciosActuales(),this.$emit("precio-agregado",{producto:a,precio:e.precio,fecha:t,clienteId:e.clienteId,timestamp:s})}catch(t){console.error("Error al agregar precio:",t),alert("Error al guardar el precio")}},async confirmarAgregarPrecio(){this.todasDecisionesTomadas?(await this.guardarPrecio(this.nuevoPrecioTemporal,!0),this.cerrarConfirmacionModal()):alert("Por favor tome una decisi√≥n para todos los clientes afectados")},cancelarConfirmacion(){this.cerrarConfirmacionModal()},cerrarConfirmacionModal(){this.showConfirmacionModal=!1,this.preciosEspecificosAfectados=[],this.nuevoPrecioTemporal=null,this.decisionesClientes={}},async eliminarPrecio(e){if(confirm("¬øEst√°s seguro de que deseas eliminar este precio?"))try{if(await Object(o["d"])(Object(o["e"])(c["a"],"precios",e.id)),await this.cargarPreciosActuales(),this.productoSeleccionado){const e=this.preciosActuales.find(e=>e.producto===this.productoSeleccionado.producto);e?this.historialPrecios=e.historial:this.showHistorialModal=!1}}catch(i){console.error("Error al eliminar precio:",i),alert("Error al eliminar el precio")}},async mostrarHistorial(e){try{this.productoSeleccionado=e,this.historialPrecios=e.historial,this.paginaActual=1,this.showHistorialModal=!0}catch(i){console.error("Error al cargar historial:",i),alert("Error al cargar el historial de precios")}},abrirModal(){this.clienteActual&&this.clientes.some(e=>e.id===this.clienteActual)&&(this.filtroCliente=this.clienteActual,this.newPrice.esClienteEspecifico=!0,this.newPrice.clienteId=this.clienteActual),this.showModal=!0},obtenerPrecioProductoCliente(e,i="catarro"){const t=this.preciosActuales.find(t=>t.producto.toLowerCase()===e.toLowerCase()&&t.clienteId===i);if(t)return t.precio;const s=this.preciosActuales.find(i=>i.producto.toLowerCase()===e.toLowerCase()&&!i.clienteId);return s?s.precio:null},buscarPrecioActual(e){if(!e||""===e.trim())return void(this.precioActualMostrar=null);const i=e.trim().toLowerCase();if(this.newPrice.esClienteEspecifico&&this.newPrice.clienteId){const e=this.preciosActuales.find(e=>e.producto.toLowerCase()===i&&e.clienteId===this.newPrice.clienteId);if(e)return this.precioActualMostrar=e,void(this.newPrice.precio=e.precio)}const t=this.preciosActuales.find(e=>e.producto.toLowerCase()===i&&!e.clienteId);if(t)return this.precioActualMostrar=t,void(this.newPrice.precio=t.precio);const s=this.preciosActuales.find(e=>e.producto.toLowerCase().includes(i)||i.includes(e.producto.toLowerCase()));if(s)return this.precioActualMostrar=s,void(this.newPrice.precio=s.precio);this.precioActualMostrar=null}},watch:{clienteActual:{immediate:!0,handler(e){e&&this.clientes.some(i=>i.id===e)&&(this.filtroCliente=e,e&&(this.newPrice.esClienteEspecifico=!0,this.newPrice.clienteId=e))}},"newPrice.producto":{handler(e){clearTimeout(this.buscarPrecioTimeout),this.buscarPrecioTimeout=setTimeout(()=>{this.buscarPrecioActual(e)},500)}},"newPrice.esClienteEspecifico":{handler(){this.newPrice.producto&&this.buscarPrecioActual(this.newPrice.producto)}},"newPrice.clienteId":{handler(){this.newPrice.producto&&this.buscarPrecioActual(this.newPrice.producto)}}},mounted(){this.cargarPreciosActuales()},beforeDestroy(){this.buscarPrecioTimeout&&clearTimeout(this.buscarPrecioTimeout)}},l=n,d=(t("97a7"),t("2877")),u=Object(d["a"])(l,s,a,!1,null,"fd1a02a6",null);i["a"]=u.exports},"6bfe":function(e,i,t){},"912b":function(e,i,t){"use strict";var s=function(){var e=this,i=e._self._c;return e.isVisible?i("div",{staticClass:"modal-overlay",on:{click:e.cerrarModal}},[i("div",{staticClass:"modal-content",on:{click:function(e){e.stopPropagation()}}},[i("div",{staticClass:"modal-header"},[i("h2",[e._v("Observaciones Registradas")]),i("button",{staticClass:"close-modal-btn",on:{click:e.cerrarModal}},[e._v("√ó")])]),i("div",{staticClass:"observaciones-section"},[i("div",{staticClass:"observaciones-header"},[i("h3",[e._v("Total de Observaciones: "+e._s(e.observaciones.length))])]),e.isLoading?i("div",{staticClass:"loading"},[e._v(" Cargando observaciones... ")]):0===e.observaciones.length?i("div",{staticClass:"no-observaciones"},[i("p",[e._v("No hay observaciones registradas.")])]):i("div",{staticClass:"observaciones-lista"},e._l(e.observaciones,(function(t){return i("div",{key:t.id,staticClass:"observacion-item"},[i("div",{staticClass:"observacion-header-item"},[i("span",{staticClass:"observacion-fecha"},[e._v(e._s(e.formatearFecha(t.fecha)))])]),i("div",{staticClass:"observacion-contenido"},[i("p",[e._v(e._s(t.observacion))])]),i("div",{staticClass:"observacion-meta"},[i("span",{staticClass:"observacion-saldo"},[e._v("Saldo del d√≠a: $"+e._s(e.formatNumber(t.saldoHoy)))]),i("span",{staticClass:"observacion-total"},[e._v("Total acumulado: $"+e._s(e.formatNumber(t.totalNota)))])]),i("div",{staticClass:"observacion-acciones"},[i("button",{staticClass:"btn-eliminar",on:{click:function(i){return e.eliminarObservacion(t.id)}}},[e._v(" Eliminar Observaci√≥n ")])])])})),0)]),i("div",{staticClass:"modal-footer"},[i("button",{staticClass:"btn-cerrar",on:{click:e.cerrarModal}},[e._v("Cerrar")])])])]):e._e()},a=[],c=t("dc59"),o=t("1494"),r={name:"ObservacionesModal",props:{isVisible:{type:Boolean,default:!1}},emits:["cerrar"],data(){return{observaciones:[],isLoading:!1,unsubscribe:null}},methods:{async cargarObservaciones(){try{this.isLoading=!0;const e=Object(o["c"])(c["a"],"cuentasOtilio"),i=Object(o["o"])(e,Object(o["l"])("fecha","desc"));this.unsubscribe=Object(o["k"])(i,e=>{this.observaciones=e.docs.map(e=>{const i=e.data();return{id:e.id,fecha:i.fecha,observacion:i.observacion||"",saldoHoy:i.totalGeneralVenta||0,totalNota:i.nuevoSaldoAcumulado||0,tieneObservacion:i.tieneObservacion||!1}}).filter(e=>!0===e.tieneObservacion&&""!==e.observacion.trim()),this.isLoading=!1})}catch(e){console.error("Error al cargar observaciones:",e),this.isLoading=!1}},async eliminarObservacion(e){if(confirm("¬øEst√°s seguro de que quieres eliminar esta observaci√≥n?"))try{const i=Object(o["e"])(c["a"],"cuentasOtilio",e);await Object(o["s"])(i,{observacion:"",tieneObservacion:!1})}catch(i){console.error("Error al eliminar observaci√≥n:",i)}},cerrarModal(){this.$emit("cerrar")},formatearFecha(e){if(!e)return"";const i=new Date(e);return i.setMinutes(i.getMinutes()+i.getTimezoneOffset()),i.toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"})},formatNumber(e){return e.toLocaleString("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2})}},watch:{isVisible(e){e?this.cargarObservaciones():this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=null)}},beforeUnmount(){this.unsubscribe&&this.unsubscribe()}},n=r,l=(t("a2ba"),t("2877")),d=Object(l["a"])(n,s,a,!1,null,"657b7707",null);i["a"]=d.exports},"97a7":function(e,i,t){"use strict";t("6148")},a2ba:function(e,i,t){"use strict";t("bc32")},bc32:function(e,i,t){},f971:function(e,i,t){"use strict";t("6bfe")}}]);