(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["app.51a12d86"],{"035c":function(a,t,o){"use strict";o("8986")},"089a":function(a,t,o){},"0ae9":function(a,t,o){"use strict";var s=function(){var a=this,t=a._self._c;return t("div",{staticClass:"ventas-ganancias-catarro"},[t("div",{staticClass:"header"},[t("button",{staticClass:"back-button",on:{click:a.volverAlMenu}},[a._v("Volver")]),t("h2",[a._v("Análisis de Ventas y Ganancias - Catarro")])]),t("div",{staticClass:"filtros"},[t("label",{attrs:{for:"periodo-select"}},[a._v("Seleccionar período:")]),t("select",{directives:[{name:"model",rawName:"v-model",value:a.periodoSeleccionado,expression:"periodoSeleccionado"}],attrs:{id:"periodo-select"},on:{change:[function(t){var o=Array.prototype.filter.call(t.target.options,(function(a){return a.selected})).map((function(a){var t="_value"in a?a._value:a.value;return t}));a.periodoSeleccionado=t.target.multiple?o:o[0]},a.cargarDatos]}},[t("option",{attrs:{value:"semanal"}},[a._v("Semanal")]),t("option",{attrs:{value:"mensual"}},[a._v("Mensual")])])]),t("div",{staticClass:"graficas"},[t("div",{staticClass:"grafica"},[t("h3",[a._v("Ventas "+a._s("semanal"===a.periodoSeleccionado?"Semanales":"Mensuales"))]),t("canvas",{ref:"ventasChart"})]),t("div",{staticClass:"grafica"},[t("h3",[a._v("Ganancias "+a._s("semanal"===a.periodoSeleccionado?"Semanales":"Mensuales"))]),t("canvas",{ref:"gananciasChart"})])]),t("div",{staticClass:"resumen"},[t("h3",[a._v("Resumen")]),t("p",[a._v("Total de ventas: $"+a._s(a.formatNumber(a.totalVentas)))]),t("p",[a._v("Total de ganancias: $"+a._s(a.formatNumber(a.totalGanancias)))]),t("p",[a._v("Promedio de ventas por "+a._s("semanal"===a.periodoSeleccionado?"semana":"mes")+": $"+a._s(a.formatNumber(a.promedioVentas)))]),t("p",[a._v("Promedio de ganancias por "+a._s("semanal"===a.periodoSeleccionado?"semana":"mes")+": $"+a._s(a.formatNumber(a.promedioGanancias)))])])])},e=[],n=(o("14d9"),o("13d5"),o("dc59")),i=o("1494"),c=o("796e"),r={name:"VentasYGananciasCatarro",data(){return{periodoSeleccionado:"semanal",ventas:[],ganancias:[],totalVentas:0,totalGanancias:0,promedioVentas:0,promedioGanancias:0,ventasChart:null,gananciasChart:null,periodos:[]}},mounted(){this.cargarDatos()},methods:{async cargarDatos(){try{const a=Object(i["c"])(n["a"],"cuentasCatarro"),t=Object(i["o"])(a,Object(i["l"])("fecha","desc")),o=await Object(i["g"])(t),s=o.docs.map(a=>{const t=a.data();return{fecha:new Date(t.fecha),ventas:t.totalGeneralVenta||0,ganancias:this.calcularGanancias(t),estadoPagado:t.estadoPagado||!1}});this.procesarDatos(s),this.crearGraficas()}catch(a){console.error("Error al cargar datos:",a)}},procesarDatos(a){const t="semanal"===this.periodoSeleccionado?this.procesarDatosSemanal(a):this.procesarDatosMensual(a);this.periodos=t.map(a=>a.periodo),this.ventas=t.map(a=>a.ventas),this.ganancias=t.map(a=>a.ganancias),this.totalVentas=this.ventas.reduce((a,t)=>a+t,0),this.totalGanancias=this.ganancias.reduce((a,t)=>a+t,0),this.promedioVentas=this.totalVentas/this.ventas.length,this.promedioGanancias=this.totalGanancias/this.ganancias.length},procesarDatosSemanal(a){const t=a.reduce((a,t)=>{const o=this.obtenerNumeroSemana(t.fecha);return a[o]||(a[o]={ventas:0,ganancias:0}),a[o].ventas+=t.ventas,a[o].ganancias+=t.ganancias,a},{});return Object.entries(t).map(([a,t])=>({periodo:"Semana "+a,...t}))},procesarDatosMensual(a){const t=a.reduce((a,t)=>{const o=t.fecha.toLocaleString("default",{month:"long",year:"numeric"});return a[o]||(a[o]={ventas:0,ganancias:0}),a[o].ventas+=t.ventas,a[o].ganancias+=t.ganancias,a},{}),o=a.map(a=>a.fecha),s=new Date(Math.min.apply(null,o)),e=new Date(Math.max.apply(null,o)),n=this.obtenerMesesEntreFechas(s,e);return n.map(a=>({periodo:a,ventas:t[a]?t[a].ventas:0,ganancias:t[a]?t[a].ganancias:0})).sort((a,t)=>new Date(a.periodo)-new Date(t.periodo))},obtenerMesesEntreFechas(a,t){const o=[],s=new Date(a.getFullYear(),a.getMonth(),1);while(s<=t)o.push(s.toLocaleString("default",{month:"long",year:"numeric"})),s.setMonth(s.getMonth()+1);return o},obtenerNumeroSemana(a){const t=new Date(a.getFullYear(),0,1);return Math.ceil(((a-t)/864e5+t.getDay()+1)/7)},crearGraficas(){this.crearGrafica("ventasChart","Ventas",this.ventas,"#4CAF50"),this.crearGrafica("gananciasChart","Ganancias",this.ganancias,"#2196F3")},crearGrafica(a,t,o,s){const e=this.$refs[a].getContext("2d");this[a]&&this[a].destroy(),this[a]=new c["a"](e,{type:"bar",data:{labels:this.periodos,datasets:[{label:t,data:o,backgroundColor:s,borderColor:s,borderWidth:1}]},options:{responsive:!0,scales:{y:{beginAtZero:!0,ticks:{callback:function(a){return"$"+a.toLocaleString()}}}},plugins:{tooltip:{callbacks:{label:function(a){let t=a.dataset.label||"";return t&&(t+=": "),null!==a.parsed.y&&(t+="$"+a.parsed.y.toLocaleString()),t}}}}}})},formatNumber(a){return"number"!==typeof a?"0.00":a.toLocaleString("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2})},volverAlMenu(){this.$router.push("/cuentas-catarro")},calcularGanancias(a){return a.estadoPagado&&a.gananciaDelDia||0}}},l=r,u=(o("535b"),o("2877")),d=Object(u["a"])(l,s,e,!1,null,"cee72e80",null);t["a"]=d.exports},"17af":function(a,t,o){"use strict";o("2baf")},"28ce":function(a,t,o){"use strict";var s=function(){var a=this,t=a._self._c;return t("div",{staticClass:"joselito-cuentas-menu-container"},[t("h1",[a._v("Menú de Cuentas Joselito")]),t("div",{staticClass:"actions-container"},[t("router-link",{staticClass:"action-button back-btn",attrs:{to:"/cuentas-mexico"}},[a._v(" Cuentas México ")]),t("router-link",{staticClass:"action-button new-cuenta-btn",attrs:{to:"/cuentas-joselito/nueva"}},[a._v(" Nueva Cuenta ")]),t("router-link",{staticClass:"action-button ventas-ganancias-btn",attrs:{to:"/ventas-ganancias-joselito"}},[a._v(" Ventas y Ganancias ")]),t("button",{staticClass:"action-button abonos-btn",on:{click:function(t){a.showAbonosModal=!0}}},[a._v(" Abonos ")]),t("PreciosHistorialModal",{attrs:{clienteActual:"joselito"}}),t("StashModal",{attrs:{cliente:"joselito"}})],1),a.showAbonosModal?t("div",{staticClass:"modal"},[t("div",{staticClass:"modal-content"},[t("div",{staticClass:"modal-header"},[t("h2",[a._v("Historial de Abonos")]),t("button",{staticClass:"close-modal-btn",on:{click:function(t){a.showAbonosModal=!1}}},[a._v("×")])]),t("div",{staticClass:"fecha-filtros"},[t("div",{staticClass:"fecha-grupo"},[t("label",[a._v("Desde:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.fechaInicio,expression:"fechaInicio"}],staticClass:"fecha-input",attrs:{type:"date"},domProps:{value:a.fechaInicio},on:{change:a.calcularTotalAbonos,input:function(t){t.target.composing||(a.fechaInicio=t.target.value)}}})]),t("div",{staticClass:"fecha-grupo"},[t("label",[a._v("Hasta:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.fechaFin,expression:"fechaFin"}],staticClass:"fecha-input",attrs:{type:"date"},domProps:{value:a.fechaFin},on:{change:a.calcularTotalAbonos,input:function(t){t.target.composing||(a.fechaFin=t.target.value)}}})])]),null!==a.totalAbonosPeriodo?t("div",{staticClass:"total-abonos"},[t("span",{staticClass:"total-label"},[a._v("Total de abonos en el periodo:")]),t("span",{staticClass:"total-monto"},[a._v("$"+a._s(a.formatNumber(a.totalAbonosPeriodo)))])]):a._e(),t("div",{staticClass:"abonos-list"},[0===a.abonosHistorial.length?t("div",{staticClass:"no-records"},[a._v(" No hay abonos registrados. ")]):t("div",a._l(a.abonosHistorial,(function(o,s){return t("div",{key:s,staticClass:"abono-item"},[t("div",{staticClass:"abono-fecha"},[a._v(a._s(a.formatDate(o.fecha)))]),t("div",{staticClass:"abono-details"},[t("span",{staticClass:"abono-monto"},[a._v("$"+a._s(a.formatNumber(o.monto)))]),t("span",{staticClass:"abono-descripcion"},[a._v(a._s(o.descripcion))])])])})),0)]),t("button",{staticClass:"close-btn",on:{click:function(t){a.showAbonosModal=!1}}},[a._v("Cerrar")])])]):a._e(),t("div",{staticClass:"cuentas-list"},[t("h2",[a._v("Registros de Cuentas")]),a.error?t("div",{staticClass:"error-message"},[a._v(" Error al cargar los datos: "+a._s(a.error)+" ")]):a.isLoading?t("div",{staticClass:"loading"},[a._v("Cargando registros...")]):0===a.cuentas.length?t("div",{staticClass:"no-records"},[a._v(" No hay registros de cuentas que coincidan con el filtro. ")]):t("ul",a._l(a.cuentas,(function(o){return t("li",{key:o.id,staticClass:"cuenta-item",class:{"tiene-observacion":o.tieneObservacion}},[t("div",{staticClass:"cuenta-content"},[t("span",{staticClass:"cuenta-date"},[a._v(a._s(a.formatDate(o.fecha)))]),t("p",{staticClass:"cuenta-summary"},[t("span",[a._v("Saldo Hoy: $"+a._s(a.formatNumber(o.saldoHoy)))]),t("span",[a._v("Total Acumulado: $"+a._s(a.formatNumber(o.totalNota)))])]),o.tieneObservacion?t("div",{staticClass:"observacion-badge",on:{click:function(t){return a.mostrarObservacion(o)}}},[a._v(" Ver observación ")]):a._e(),o.abonos&&o.abonos.length>0?t("div",{staticClass:"abonos-info"},a._l(o.abonos,(function(o,s){return t("p",{key:s,staticClass:"abono-detail"},[t("span",{staticClass:"abono-label"},[a._v("Abono:")]),t("span",{staticClass:"abono-monto"},[a._v("$"+a._s(a.formatNumber(o.monto)))]),t("span",{staticClass:"abono-descripcion"},[a._v(a._s(o.descripcion||"Sin descripción"))])])})),0):a._e()]),t("div",{staticClass:"cuenta-actions"},[t("button",{staticClass:"edit-btn",on:{click:function(t){return a.editarCuenta(o.id)}}},[a._v("Editar")]),t("button",{staticClass:"delete-btn",on:{click:function(t){return a.borrarCuenta(o.id)}}},[a._v("Borrar")])])])})),0)]),a.showObservacionModal?t("div",{staticClass:"modal-overlay"},[t("div",{staticClass:"modal-content"},[t("h3",[a._v("Observación")]),t("p",{staticClass:"observacion-text"},[a._v(a._s(a.observacionActual))]),t("div",{staticClass:"modal-buttons"},[t("button",{staticClass:"btn-cerrar",on:{click:function(t){a.showObservacionModal=!1}}},[a._v("Cerrar")])])])]):a._e()])},e=[],n=(o("14d9"),o("13d5"),o("dc59")),i=o("1494"),c=o("74c9"),r=o("666c"),l=o("19aa"),u={name:"JoselitoCuentasMenu",components:{BackButton:c["a"],PreciosHistorialModal:r["a"],StashModal:l["a"]},data(){return{cuentas:[],isLoading:!0,unsubscribe:null,error:null,showAbonosModal:!1,fechaInicio:"",fechaFin:"",totalAbonosPeriodo:null,abonosHistorial:[],showObservacionModal:!1,observacionActual:""}},methods:{async loadCuentas(){try{this.isLoading=!0;const a=Object(i["c"])(n["a"],"cuentasJoselito"),t=Object(i["o"])(a,Object(i["l"])("fecha","asc"));this.unsubscribe=Object(i["k"])(t,async a=>{const t=a.docs.map(a=>{const t=a.data(),o=(t.cobros||[]).reduce((a,t)=>a+(parseFloat(t.monto)||0),0),s=(t.abonos||[]).reduce((a,t)=>a+(parseFloat(t.monto)||0),0);return{id:a.id,fecha:t.fecha,saldoHoy:t.totalGeneralVenta||0,totalCobros:o,totalAbonos:s,totalNota:t.nuevoSaldoAcumulado||0,nuevoSaldoAcumulado:t.nuevoSaldoAcumulado||0,saldoAcumuladoAnterior:t.saldoAcumuladoAnterior||0,abonos:t.abonos||[],tieneObservacion:t.tieneObservacion||!1,observacion:t.observacion||""}}),o=t.sort((a,t)=>new Date(a.fecha)-new Date(t.fecha));let s=0;const e=[];for(let n=0;n<o.length;n++){const a=o[n],t=a.saldoHoy-a.totalCobros-a.totalAbonos;s+=t;const i=0===n?0:o[n-1].nuevoSaldoAcumulado;a.saldoAcumuladoAnterior===i&&a.nuevoSaldoAcumulado===s||e.push({id:a.id,updates:{saldoAcumuladoAnterior:i,nuevoSaldoAcumulado:s}}),a.totalNota=s,a.saldoAcumuladoAnterior=i,s<=0&&(s=0)}e.length>0&&await Promise.all(e.map(({id:a,updates:t})=>Object(i["r"])(Object(i["e"])(n["a"],"cuentasJoselito",a),t))),this.cuentas=o.reverse(),this.isLoading=!1})}catch(a){console.error("Error al cargar cuentas: ",a),this.error=a.message,this.cuentas=[],this.isLoading=!1}},formatDate(a){const t=new Date(a);return t.setMinutes(t.getMinutes()+t.getTimezoneOffset()),t.toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"})},formatNumber(a){return a.toLocaleString("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2})},editarCuenta(a){this.$router.push(`/cuentas-joselito/${a}?edit=true`)},async borrarCuenta(a){if(confirm("¿Estás seguro de que quieres borrar este registro de cuenta?"))try{await Object(i["d"])(Object(i["e"])(n["a"],"cuentasJoselito",a)),alert("Registro de cuenta borrado con éxito")}catch(t){console.error("Error al borrar el registro de cuenta: ",t),alert("Error al borrar el registro de cuenta")}},calcularTotalAbonos(){if(!this.fechaInicio||!this.fechaFin)return void(this.totalAbonosPeriodo=null);const a=new Date(this.fechaInicio),t=new Date(this.fechaFin);t.setHours(23,59,59,999);const o=this.abonosHistorial.filter(o=>{const s=new Date(o.fecha);return s>=a&&s<=t});this.totalAbonosPeriodo=o.reduce((a,t)=>a+(parseFloat(t.monto)||0),0)},async cargarHistorialAbonos(){try{const a=Object(i["c"])(n["a"],"cuentasJoselito"),t=await Object(i["g"])(a);let o=[];t.forEach(a=>{const t=a.data();t.abonos&&t.abonos.length>0&&t.abonos.forEach(a=>{o.push({...a,fecha:t.fecha})})}),this.abonosHistorial=o.sort((a,t)=>new Date(t.fecha)-new Date(a.fecha)),this.fechaInicio&&this.fechaFin&&this.calcularTotalAbonos()}catch(a){console.error("Error al cargar historial de abonos:",a)}},mostrarObservacion(a){this.observacionActual=a.observacion,this.showObservacionModal=!0}},watch:{showAbonosModal(a){a&&this.cargarHistorialAbonos()}},created(){this.loadCuentas()},beforeUnmount(){this.unsubscribe&&this.unsubscribe()}},d=u,h=(o("035c"),o("2877")),b=Object(h["a"])(d,s,e,!1,null,"eac67d30",null);t["a"]=b.exports},"2baf":function(a,t,o){},"505e":function(a,t,o){"use strict";var s=function(){var a=this,t=a._self._c;return t("div",{staticClass:"page-container"},[t("div",{staticClass:"content-wrap"},[t("div",{staticClass:"cuentas-mexico-container"},[t("h1",[a._v("Cuentas México")]),t("div",{staticClass:"agenda-container"},[t("div",{staticClass:"card agenda",on:{click:function(t){return a.abrirAgenda()}}},[a._m(0)])]),t("div",{staticClass:"precios-container"},[t("PreciosHistorialModal")],1),t("div",{staticClass:"botones-container"},[t("router-link",{staticClass:"boton-cuenta",attrs:{to:"/cuentas-ozuna"}},[t("div",{staticClass:"card ozuna"},[t("h2",[a._v("Ozuna")])])]),t("router-link",{staticClass:"boton-cuenta",attrs:{to:"/cuentas-catarro"}},[t("div",{staticClass:"card catarro"},[t("h2",[a._v("Catarro")])])]),t("router-link",{staticClass:"boton-cuenta",attrs:{to:"/cuentas-joselito"}},[t("div",{staticClass:"card joselito"},[t("h2",[a._v("Joselito")])])]),t("router-link",{staticClass:"boton-cuenta",attrs:{to:"/cuentas-otilio"}},[t("div",{staticClass:"card otilio"},[t("h2",[a._v("Otilio")])])])],1)])]),t("TransaccionesAgendaModal",{attrs:{mostrar:a.mostrarModalAgenda,cliente:a.clienteSeleccionado},on:{cerrar:a.cerrarModalAgenda}})],1)},e=[function(){var a=this,t=a._self._c;return t("div",{staticClass:"card-content"},[t("i",{staticClass:"fas fa-calendar-alt"}),t("h2",[a._v("Agenda de Transacciones")])])}],n=o("fe3d"),i=o("666c"),c={name:"CuentasMexico",components:{TransaccionesAgendaModal:n["a"],PreciosHistorialModal:i["a"]},data(){return{mostrarModalAgenda:!1,clienteSeleccionado:"mexico"}},methods:{abrirAgenda(){this.mostrarModalAgenda=!0},cerrarModalAgenda(){this.mostrarModalAgenda=!1}}},r=c,l=(o("17af"),o("2877")),u=Object(l["a"])(r,s,e,!1,null,"1bead3eb",null);t["a"]=u.exports},"535b":function(a,t,o){"use strict";o("089a")},"623b":function(a,t,o){},8986:function(a,t,o){},"8a2a":function(a,t,o){},"95c6":function(a,t,o){"use strict";o("623b")},"9f85":function(a,t,o){"use strict";o("13d5");var s=function(){var a=this,t=a._self._c;return t("div",{staticClass:"otilio-cuentas-menu-container"},[t("h1",[a._v("Menú de Cuentas Otilio")]),t("div",{staticClass:"actions-container"},[t("router-link",{staticClass:"action-button back-btn",attrs:{to:"/cuentas-mexico"}},[a._v(" Cuentas México ")]),t("router-link",{staticClass:"action-button new-cuenta-btn",attrs:{to:"/cuentas-otilio/nueva"}},[a._v(" Nueva Cuenta ")]),t("button",{staticClass:"action-button abonos-btn",on:{click:function(t){a.showAbonosModal=!0}}},[a._v(" Abonos ")]),t("PreciosHistorialModal",{attrs:{clienteActual:"otilio"}}),t("StashModal",{attrs:{cliente:"otilio"}})],1),a.showAbonosModal?t("div",{staticClass:"modal"},[t("div",{staticClass:"modal-content"},[t("div",{staticClass:"modal-header"},[t("h2",[a._v("Historial de Abonos")]),t("button",{staticClass:"close-modal-btn",on:{click:function(t){a.showAbonosModal=!1}}},[a._v("×")])]),t("div",{staticClass:"fecha-filtros"},[t("div",{staticClass:"fecha-grupo"},[t("label",[a._v("Desde:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.fechaInicio,expression:"fechaInicio"}],staticClass:"fecha-input",attrs:{type:"date"},domProps:{value:a.fechaInicio},on:{change:a.calcularTotalAbonos,input:function(t){t.target.composing||(a.fechaInicio=t.target.value)}}})]),t("div",{staticClass:"fecha-grupo"},[t("label",[a._v("Hasta:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.fechaFin,expression:"fechaFin"}],staticClass:"fecha-input",attrs:{type:"date"},domProps:{value:a.fechaFin},on:{change:a.calcularTotalAbonos,input:function(t){t.target.composing||(a.fechaFin=t.target.value)}}})])]),null!==a.totalAbonosPeriodo?t("div",{staticClass:"total-abonos"},[t("span",{staticClass:"total-label"},[a._v("Total de abonos en el periodo:")]),t("span",{staticClass:"total-monto"},[a._v("$"+a._s(a.formatNumber(a.totalAbonosPeriodo)))])]):a._e(),t("div",{staticClass:"abonos-list"},[0===a.abonosHistorial.length?t("div",{staticClass:"no-records"},[a._v(" No hay abonos registrados. ")]):t("div",a._l(a.abonosHistorial,(function(o,s){return t("div",{key:s,staticClass:"abono-item"},[t("div",{staticClass:"abono-fecha"},[a._v(a._s(a.formatDate(o.fecha)))]),t("div",{staticClass:"abono-details"},[t("span",{staticClass:"abono-monto"},[a._v("$"+a._s(a.formatNumber(o.monto)))]),t("span",{staticClass:"abono-descripcion"},[a._v(a._s(o.descripcion))])])])})),0)]),t("button",{staticClass:"close-btn",on:{click:function(t){a.showAbonosModal=!1}}},[a._v("Cerrar")])])]):a._e(),t("div",{staticClass:"cuentas-list"},[t("h2",[a._v("Registros de Cuentas")]),a.error?t("div",{staticClass:"error-message"},[a._v(" Error al cargar los datos: "+a._s(a.error)+" ")]):a.isLoading?t("div",{staticClass:"loading"},[a._v("Cargando registros...")]):0===a.cuentas.length?t("div",{staticClass:"no-records"},[a._v(" No hay registros de cuentas que coincidan con el filtro. ")]):t("ul",a._l(a.cuentas,(function(o){return t("li",{key:o.id,staticClass:"cuenta-item",class:{"tiene-observacion":o.tieneObservacion}},[t("div",{staticClass:"cuenta-content"},[t("span",{staticClass:"cuenta-date"},[a._v(a._s(a.formatDate(o.fecha)))]),t("p",{staticClass:"cuenta-summary"},[t("span",[a._v("Saldo Hoy: $"+a._s(a.formatNumber(o.saldoHoy)))]),t("span",[a._v("Total Acumulado: $"+a._s(a.formatNumber(o.totalNota)))])]),o.tieneObservacion?t("div",{staticClass:"observacion-badge",on:{click:function(t){return a.mostrarObservacion(o)}}},[a._v(" Ver observación ")]):a._e(),o.abonos&&o.abonos.length>0?t("div",{staticClass:"abonos-info"},[a._l(o.abonos,(function(o,s){return t("p",{key:s,staticClass:"abono-detail"},[t("span",{staticClass:"abono-label"},[a._v("Abono:")]),t("span",{staticClass:"abono-monto"},[a._v("$"+a._s(a.formatNumber(o.monto)))]),t("span",{staticClass:"abono-descripcion"},[a._v(a._s(o.descripcion||"Sin descripción"))])])})),t("p",{staticClass:"total-abonos-dia"},[t("span",{staticClass:"total-label"},[a._v("Total")]),t("span",{staticClass:"total-monto"},[a._v("$"+a._s(a.formatNumber(o.abonos.reduce((a,t)=>a+(parseFloat(t.monto)||0),0))))])])],2):a._e()]),t("div",{staticClass:"cuenta-actions"},[t("button",{staticClass:"edit-btn",on:{click:function(t){return a.editarCuenta(o.id)}}},[a._v("Editar")]),t("button",{staticClass:"delete-btn",on:{click:function(t){return a.borrarCuenta(o.id)}}},[a._v("Borrar")])])])})),0)]),a.showObservacionModal?t("div",{staticClass:"modal-overlay"},[t("div",{staticClass:"modal-content"},[t("h3",[a._v("Observación")]),t("p",{staticClass:"observacion-text"},[a._v(a._s(a.observacionActual))]),t("div",{staticClass:"modal-buttons"},[t("button",{staticClass:"btn-cerrar",on:{click:function(t){a.showObservacionModal=!1}}},[a._v("Cerrar")])])])]):a._e()])},e=[],n=(o("14d9"),o("dc59")),i=o("1494"),c=o("74c9"),r=o("666c"),l=o("19aa"),u={name:"OtilioCuentasMenu",components:{BackButton:c["a"],PreciosHistorialModal:r["a"],StashModal:l["a"]},data(){return{cuentas:[],isLoading:!0,unsubscribe:null,error:null,showAbonosModal:!1,abonosHistorial:[],fechaInicio:"",fechaFin:"",totalAbonosPeriodo:null,showObservacionModal:!1,observacionActual:""}},methods:{async loadCuentas(){try{this.isLoading=!0;const a=Object(i["c"])(n["a"],"cuentasOtilio"),t=Object(i["o"])(a,Object(i["l"])("fecha","asc"));this.unsubscribe=Object(i["k"])(t,async a=>{const t=a.docs.map(a=>{const t=a.data(),o=(t.cobros||[]).reduce((a,t)=>a+(parseFloat(t.monto)||0),0),s=(t.abonos||[]).reduce((a,t)=>a+(parseFloat(t.monto)||0),0);return{id:a.id,fecha:t.fecha,saldoHoy:t.totalGeneralVenta||0,totalCobros:o,totalAbonos:s,totalNota:t.nuevoSaldoAcumulado||0,nuevoSaldoAcumulado:t.nuevoSaldoAcumulado||0,saldoAcumuladoAnterior:t.saldoAcumuladoAnterior||0,abonos:t.abonos||[],tieneObservacion:Boolean(t.tieneObservacion)||!1,observacion:String(t.observacion||"")}}),o=t.sort((a,t)=>new Date(a.fecha)-new Date(t.fecha));let s=0;const e=[];for(let n=0;n<o.length;n++){const a=o[n],t=a.saldoHoy-a.totalCobros-a.totalAbonos;s+=t;const i=0===n?0:o[n-1].nuevoSaldoAcumulado;a.saldoAcumuladoAnterior===i&&a.nuevoSaldoAcumulado===s||e.push({id:a.id,updates:{saldoAcumuladoAnterior:i,nuevoSaldoAcumulado:s}}),a.totalNota=s,a.saldoAcumuladoAnterior=i,s<=0&&(s=0)}e.length>0&&await Promise.all(e.map(({id:a,updates:t})=>Object(i["r"])(Object(i["e"])(n["a"],"cuentasOtilio",a),t))),this.cuentas=o.reverse(),this.isLoading=!1})}catch(a){console.error("Error al cargar cuentas: ",a),this.error=a.message,this.cuentas=[],this.isLoading=!1}},formatDate(a){const t=new Date(a);return t.setMinutes(t.getMinutes()+t.getTimezoneOffset()),t.toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"})},formatNumber(a){return a.toLocaleString("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2})},editarCuenta(a){this.$router.push(`/cuentas-otilio/${a}?edit=true`)},async borrarCuenta(a){if(confirm("¿Estás seguro de que quieres borrar este registro de cuenta?"))try{await Object(i["d"])(Object(i["e"])(n["a"],"cuentasOtilio",a)),alert("Registro de cuenta borrado con éxito")}catch(t){console.error("Error al borrar el registro de cuenta: ",t),alert("Error al borrar el registro de cuenta")}},calcularTotalAbonos(){if(!this.fechaInicio||!this.fechaFin)return void(this.totalAbonosPeriodo=null);const a=new Date(this.fechaInicio),t=new Date(this.fechaFin);t.setHours(23,59,59,999);const o=this.abonosHistorial.filter(o=>{const s=new Date(o.fecha);return s>=a&&s<=t});this.totalAbonosPeriodo=o.reduce((a,t)=>a+(parseFloat(t.monto)||0),0)},async cargarHistorialAbonos(){try{const a=Object(i["c"])(n["a"],"cuentasOtilio"),t=await Object(i["g"])(a);let o=[];t.forEach(a=>{const t=a.data();t.abonos&&t.abonos.length>0&&t.abonos.forEach(a=>{o.push({...a,fecha:t.fecha})})}),this.abonosHistorial=o.sort((a,t)=>new Date(t.fecha)-new Date(a.fecha)),this.fechaInicio&&this.fechaFin&&this.calcularTotalAbonos()}catch(a){console.error("Error al cargar historial de abonos:",a)}},mostrarObservacion(a){a&&a.observacion?(this.observacionActual=a.observacion,this.showObservacionModal=!0):console.error("No hay observación disponible para mostrar")}},watch:{showAbonosModal(a){a&&this.cargarHistorialAbonos()}},created(){this.loadCuentas()},beforeUnmount(){this.unsubscribe&&this.unsubscribe()}},d=u,h=(o("e48d"),o("2877")),b=Object(h["a"])(d,s,e,!1,null,"2152a88e",null);t["a"]=b.exports},a918:function(a,t,o){},bee8:function(a,t,o){"use strict";o("a918")},c8b7:function(a,t,o){"use strict";var s=function(){var a=this,t=a._self._c;return t("div",{staticClass:"ventas-ganancias-container"},[t("div",{staticClass:"back-button-container"},[t("BackButton",{attrs:{to:"/cuentas-joselito"}})],1),t("h1",[a._v("Ventas y Ganancias de Joselito")]),t("div",{staticClass:"date-range-selector"},[t("div",{staticClass:"date-input"},[t("label",[a._v("Fecha Inicial:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.fechaInicial,expression:"fechaInicial"}],attrs:{type:"date"},domProps:{value:a.fechaInicial},on:{input:function(t){t.target.composing||(a.fechaInicial=t.target.value)}}})]),t("div",{staticClass:"date-input"},[t("label",[a._v("Fecha Final:")]),t("input",{directives:[{name:"model",rawName:"v-model",value:a.fechaFinal,expression:"fechaFinal"}],attrs:{type:"date"},domProps:{value:a.fechaFinal},on:{input:function(t){t.target.composing||(a.fechaFinal=t.target.value)}}})]),t("button",{staticClass:"search-btn",on:{click:a.buscarVentas}},[a._v("Buscar")])]),a.isLoading?t("div",{staticClass:"loading"},[a._v(" Cargando datos... ")]):t("div",[t("div",{staticClass:"summary-cards"},[t("div",{staticClass:"summary-card"},[t("h3",[a._v("Total Ventas")]),t("p",[a._v("$"+a._s(a.formatNumber(a.totalVentas)))])]),t("div",{staticClass:"summary-card"},[t("h3",[a._v("Total Costos")]),t("p",[a._v("$"+a._s(a.formatNumber(a.totalCostos)))])]),t("div",{staticClass:"summary-card"},[t("h3",[a._v("Ganancia Total")]),t("p",{class:{positive:a.gananciaTotal>0,negative:a.gananciaTotal<0}},[a._v(" $"+a._s(a.formatNumber(a.gananciaTotal))+" ")])])]),t("div",{staticClass:"ventas-table"},[t("h2",[a._v("Detalle de Ventas por Fecha")]),t("table",[a._m(0),t("tbody",a._l(a.ventasPorFecha,(function(o){return t("tr",{key:o.fecha},[t("td",[a._v(a._s(a.formatDate(o.fecha)))]),t("td",[a._v("$"+a._s(a.formatNumber(o.ventas)))]),t("td",[a._v("$"+a._s(a.formatNumber(o.costos)))]),t("td",{class:{positive:o.ganancia>0,negative:o.ganancia<0}},[a._v(" $"+a._s(a.formatNumber(o.ganancia))+" ")])])})),0)])]),t("div",{staticClass:"print-section"},[t("button",{staticClass:"print-btn",on:{click:a.imprimirReporte}},[a._v(" Imprimir Reporte ")])])])])},e=[function(){var a=this,t=a._self._c;return t("thead",[t("tr",[t("th",[a._v("Fecha")]),t("th",[a._v("Ventas")]),t("th",[a._v("Costos")]),t("th",[a._v("Ganancia")])])])}],n=(o("13d5"),o("dc59")),i=o("1494"),c=o("74c9"),r={name:"VentasYGananciasJoselito",components:{BackButton:c["a"]},data(){return{fechaInicial:"",fechaFinal:"",ventasPorFecha:[],isLoading:!1}},computed:{totalVentas(){return this.ventasPorFecha.reduce((a,t)=>a+t.ventas,0)},totalCostos(){return this.ventasPorFecha.reduce((a,t)=>a+t.costos,0)},gananciaTotal(){return this.totalVentas-this.totalCostos}},methods:{async buscarVentas(){if(this.fechaInicial&&this.fechaFinal){this.isLoading=!0;try{const a=Object(i["c"])(n["a"],"cuentasJoselito"),t=Object(i["o"])(a,Object(i["s"])("fecha",">=",this.fechaInicial),Object(i["s"])("fecha","<=",this.fechaFinal),Object(i["l"])("fecha","asc")),o=await Object(i["g"])(t);this.ventasPorFecha=o.docs.map(a=>{const t=a.data(),o=t.totalGeneralVenta||0,s=t.totalGeneral||0;return{fecha:t.fecha,ventas:o,costos:s,ganancia:o-s}})}catch(a){console.error("Error al buscar ventas:",a),alert("Error al cargar los datos")}finally{this.isLoading=!1}}else alert("Por favor seleccione ambas fechas")},formatNumber(a){return a.toLocaleString("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2})},formatDate(a){return new Date(a).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"})},imprimirReporte(){const a=`\n        <html>\n          <head>\n            <title>Reporte de Ventas y Ganancias - Joselito</title>\n            <style>\n              body {\n                font-family: Arial, sans-serif;\n                padding: 20px;\n              }\n              h1 { color: #2196F3; }\n              table {\n                width: 100%;\n                border-collapse: collapse;\n                margin: 20px 0;\n              }\n              th, td {\n                border: 1px solid #ddd;\n                padding: 8px;\n                text-align: left;\n              }\n              th { background-color: #f5f5f5; }\n              .total { font-weight: bold; }\n              .positive { color: #4CAF50; }\n              .negative { color: #f44336; }\n            </style>\n          </head>\n          <body>\n            <h1>Reporte de Ventas y Ganancias - Joselito</h1>\n            <p>Período: ${this.formatDate(this.fechaInicial)} - ${this.formatDate(this.fechaFinal)}</p>\n            \n            <h2>Resumen</h2>\n            <table>\n              <tr>\n                <th>Total Ventas</th>\n                <td>$${this.formatNumber(this.totalVentas)}</td>\n              </tr>\n              <tr>\n                <th>Total Costos</th>\n                <td>$${this.formatNumber(this.totalCostos)}</td>\n              </tr>\n              <tr class="total">\n                <th>Ganancia Total</th>\n                <td class="${this.gananciaTotal>0?"positive":"negative"}">\n                  $${this.formatNumber(this.gananciaTotal)}\n                </td>\n              </tr>\n            </table>\n\n            <h2>Detalle por Fecha</h2>\n            <table>\n              <thead>\n                <tr>\n                  <th>Fecha</th>\n                  <th>Ventas</th>\n                  <th>Costos</th>\n                  <th>Ganancia</th>\n                </tr>\n              </thead>\n              <tbody>\n                ${this.ventasPorFecha.map(a=>`\n                  <tr>\n                    <td>${this.formatDate(a.fecha)}</td>\n                    <td>$${this.formatNumber(a.ventas)}</td>\n                    <td>$${this.formatNumber(a.costos)}</td>\n                    <td class="${a.ganancia>0?"positive":"negative"}">\n                      $${this.formatNumber(a.ganancia)}\n                    </td>\n                  </tr>\n                `).join("")}\n              </tbody>\n            </table>\n          </body>\n        </html>\n      `,t=window.open("","_blank");t.document.write(a),t.document.close(),t.print()}},mounted(){const a=new Date;this.fechaFinal=a.toISOString().split("T")[0],a.setMonth(a.getMonth()-1),this.fechaInicial=a.toISOString().split("T")[0],this.buscarVentas()}},l=r,u=(o("95c6"),o("2877")),d=Object(u["a"])(l,s,e,!1,null,"f6742926",null);t["a"]=d.exports},e48d:function(a,t,o){"use strict";o("8a2a")},f515:function(a,t,o){"use strict";var s=function(){var a=this,t=a._self._c;return t("div",{staticClass:"ozuna-cuentas-menu-container"},[t("h1",[a._v("Menú de Cuentas Ozuna")]),t("div",{staticClass:"actions-container"},[t("router-link",{staticClass:"action-button back-btn",attrs:{to:"/cuentas-mexico"}},[a._v(" Cuentas México ")]),t("router-link",{staticClass:"action-button new-cuenta-btn",attrs:{to:"/cuentas-ozuna/nueva"}},[a._v(" Nueva Cuenta ")])],1),t("div",{staticClass:"cuentas-list"},[t("h2",[a._v("Registros de Cuentas")]),a.isLoading?t("div",{staticClass:"loading"},[a._v("Cargando registros...")]):0===a.cuentas.length?t("div",{staticClass:"no-records"},[a._v(" No hay registros de cuentas. ")]):t("ul",a._l(a.cuentas,(function(o){return t("li",{key:o.id,staticClass:"cuenta-item"},[t("div",{staticClass:"cuenta-content"},[t("span",{staticClass:"cuenta-date"},[a._v(a._s(a.formatDate(o.fecha)))]),t("p",{staticClass:"cuenta-summary"},[t("span",[a._v("Saldo Hoy: $"+a._s(a.formatNumber(o.saldoHoy)))]),t("span",[a._v("Total Acumulado: $"+a._s(a.formatNumber(o.totalNota)))]),o.totalAbonos>0?t("span",{staticClass:"abono-indicator"},[a._v(" Abono: $"+a._s(a.formatNumber(o.totalAbonos))+" ")]):a._e(),o.totalCobros>0?t("span",{staticClass:"cobro-indicator"},[a._v(" Cobro: $"+a._s(a.formatNumber(o.totalCobros))+" ")]):a._e()])]),t("div",{staticClass:"cuenta-actions"},[t("button",{staticClass:"edit-btn",on:{click:function(t){return a.editarCuenta(o.id)}}},[a._v("Editar")]),t("button",{staticClass:"delete-btn",on:{click:function(t){return a.borrarCuenta(o.id)}}},[a._v("Borrar")])])])})),0)])])},e=[],n=(o("14d9"),o("13d5"),o("dc59")),i=o("1494"),c={name:"OzunaCuentasMenu",data(){return{cuentas:[],isLoading:!0}},methods:{async loadCuentas(){try{this.isLoading=!0;const a=Object(i["c"])(n["a"],"cuentasOzuna"),t=Object(i["o"])(a,Object(i["l"])("fecha","desc")),o=await Object(i["g"])(t);this.cuentas=o.docs.map(a=>{const t=a.data(),o=(t.abonos||[]).reduce((a,t)=>a+(t.monto||0),0),s=(t.cobros||[]).reduce((a,t)=>a+(t.monto||0),0);return{id:a.id,fecha:t.fecha,saldoHoy:t.totalGeneral||0,totalNota:t.totalSaldo||0,totalAbonos:o,totalCobros:s}}),console.log("Cuentas cargadas:",this.cuentas)}catch(a){console.error("Error al cargar cuentas: ",a),this.cuentas=[]}finally{this.isLoading=!1}},formatDate(a){const t=new Date(a);return t.setMinutes(t.getMinutes()+t.getTimezoneOffset()),t.toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"})},formatNumber(a){return a.toLocaleString("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2})},editarCuenta(a){this.$router.push(`/cuentas-ozuna/${a}?edit=true`)},async borrarCuenta(a){if(confirm("¿Estás seguro de que quieres borrar este registro de cuenta?"))try{await Object(i["d"])(Object(i["e"])(n["a"],"cuentasOzuna",a)),this.cuentas=this.cuentas.filter(t=>t.id!==a),alert("Registro de cuenta borrado con éxito"),this.loadCuentas()}catch(t){console.error("Error al borrar el registro de cuenta: ",t),alert("Error al borrar el registro de cuenta")}}},mounted(){this.loadCuentas()}},r=c,l=(o("bee8"),o("2877")),u=Object(l["a"])(r,s,e,!1,null,"0777a32c",null);t["a"]=u.exports}}]);